var fq=e=>{throw TypeError(e)};var yM=(e,t,r)=>t.has(e)||fq("Cannot "+r);var St=(e,t,r)=>(yM(e,t,"read from private field"),r?r.call(e):t.get(e)),Fn=(e,t,r)=>t.has(e)?fq("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),rn=(e,t,r,n)=>(yM(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Ni=(e,t,r)=>(yM(e,t,"access private method"),r);var $A=(e,t,r,n)=>({set _(a){rn(e,t,a,r)},get _(){return St(e,t,n)}});function cme(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const d=Object.getOwnPropertyDescriptor(n,a);d&&Object.defineProperty(e,a,d.get?d:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(a){if(a.ep)return;a.ep=!0;const d=r(a);fetch(a.href,d)}})();var gS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function es(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pY={exports:{}},yI={},mY={exports:{}},_i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k2=Symbol.for("react.element"),ume=Symbol.for("react.portal"),dme=Symbol.for("react.fragment"),hme=Symbol.for("react.strict_mode"),fme=Symbol.for("react.profiler"),pme=Symbol.for("react.provider"),mme=Symbol.for("react.context"),gme=Symbol.for("react.forward_ref"),yme=Symbol.for("react.suspense"),vme=Symbol.for("react.memo"),_me=Symbol.for("react.lazy"),pq=Symbol.iterator;function xme(e){return e===null||typeof e!="object"?null:(e=pq&&e[pq]||e["@@iterator"],typeof e=="function"?e:null)}var gY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yY=Object.assign,vY={};function cb(e,t,r){this.props=e,this.context=t,this.refs=vY,this.updater=r||gY}cb.prototype.isReactComponent={};cb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};cb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function _Y(){}_Y.prototype=cb.prototype;function iB(e,t,r){this.props=e,this.context=t,this.refs=vY,this.updater=r||gY}var sB=iB.prototype=new _Y;sB.constructor=iB;yY(sB,cb.prototype);sB.isPureReactComponent=!0;var mq=Array.isArray,xY=Object.prototype.hasOwnProperty,aB={current:null},bY={key:!0,ref:!0,__self:!0,__source:!0};function wY(e,t,r){var n,a={},d=null,p=null;if(t!=null)for(n in t.ref!==void 0&&(p=t.ref),t.key!==void 0&&(d=""+t.key),t)xY.call(t,n)&&!bY.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var _=Array(s),b=0;b<s;b++)_[b]=arguments[b+2];a.children=_}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:k2,type:e,key:d,ref:p,props:a,_owner:aB.current}}function bme(e,t){return{$$typeof:k2,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function oB(e){return typeof e=="object"&&e!==null&&e.$$typeof===k2}function wme(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var gq=/\/+/g;function vM(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wme(""+e.key):t.toString(36)}function FC(e,t,r,n,a){var d=typeof e;(d==="undefined"||d==="boolean")&&(e=null);var p=!1;if(e===null)p=!0;else switch(d){case"string":case"number":p=!0;break;case"object":switch(e.$$typeof){case k2:case ume:p=!0}}if(p)return p=e,a=a(p),e=n===""?"."+vM(p,0):n,mq(a)?(r="",e!=null&&(r=e.replace(gq,"$&/")+"/"),FC(a,t,r,"",function(b){return b})):a!=null&&(oB(a)&&(a=bme(a,r+(!a.key||p&&p.key===a.key?"":(""+a.key).replace(gq,"$&/")+"/")+e)),t.push(a)),1;if(p=0,n=n===""?".":n+":",mq(e))for(var s=0;s<e.length;s++){d=e[s];var _=n+vM(d,s);p+=FC(d,t,r,_,a)}else if(_=xme(e),typeof _=="function")for(e=_.call(e),s=0;!(d=e.next()).done;)d=d.value,_=n+vM(d,s++),p+=FC(d,t,r,_,a);else if(d==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return p}function VA(e,t,r){if(e==null)return e;var n=[],a=0;return FC(e,n,"","",function(d){return t.call(r,d,a++)}),n}function Sme(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Vl={current:null},zC={transition:null},Tme={ReactCurrentDispatcher:Vl,ReactCurrentBatchConfig:zC,ReactCurrentOwner:aB};function SY(){throw Error("act(...) is not supported in production builds of React.")}_i.Children={map:VA,forEach:function(e,t,r){VA(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return VA(e,function(){t++}),t},toArray:function(e){return VA(e,function(t){return t})||[]},only:function(e){if(!oB(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};_i.Component=cb;_i.Fragment=dme;_i.Profiler=fme;_i.PureComponent=iB;_i.StrictMode=hme;_i.Suspense=yme;_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tme;_i.act=SY;_i.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=yY({},e.props),a=e.key,d=e.ref,p=e._owner;if(t!=null){if(t.ref!==void 0&&(d=t.ref,p=aB.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(_ in t)xY.call(t,_)&&!bY.hasOwnProperty(_)&&(n[_]=t[_]===void 0&&s!==void 0?s[_]:t[_])}var _=arguments.length-2;if(_===1)n.children=r;else if(1<_){s=Array(_);for(var b=0;b<_;b++)s[b]=arguments[b+2];n.children=s}return{$$typeof:k2,type:e.type,key:a,ref:d,props:n,_owner:p}};_i.createContext=function(e){return e={$$typeof:mme,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pme,_context:e},e.Consumer=e};_i.createElement=wY;_i.createFactory=function(e){var t=wY.bind(null,e);return t.type=e,t};_i.createRef=function(){return{current:null}};_i.forwardRef=function(e){return{$$typeof:gme,render:e}};_i.isValidElement=oB;_i.lazy=function(e){return{$$typeof:_me,_payload:{_status:-1,_result:e},_init:Sme}};_i.memo=function(e,t){return{$$typeof:vme,type:e,compare:t===void 0?null:t}};_i.startTransition=function(e){var t=zC.transition;zC.transition={};try{e()}finally{zC.transition=t}};_i.unstable_act=SY;_i.useCallback=function(e,t){return Vl.current.useCallback(e,t)};_i.useContext=function(e){return Vl.current.useContext(e)};_i.useDebugValue=function(){};_i.useDeferredValue=function(e){return Vl.current.useDeferredValue(e)};_i.useEffect=function(e,t){return Vl.current.useEffect(e,t)};_i.useId=function(){return Vl.current.useId()};_i.useImperativeHandle=function(e,t,r){return Vl.current.useImperativeHandle(e,t,r)};_i.useInsertionEffect=function(e,t){return Vl.current.useInsertionEffect(e,t)};_i.useLayoutEffect=function(e,t){return Vl.current.useLayoutEffect(e,t)};_i.useMemo=function(e,t){return Vl.current.useMemo(e,t)};_i.useReducer=function(e,t,r){return Vl.current.useReducer(e,t,r)};_i.useRef=function(e){return Vl.current.useRef(e)};_i.useState=function(e){return Vl.current.useState(e)};_i.useSyncExternalStore=function(e,t,r){return Vl.current.useSyncExternalStore(e,t,r)};_i.useTransition=function(){return Vl.current.useTransition()};_i.version="18.3.1";mY.exports=_i;var F=mY.exports;const De=es(F),lB=cme({__proto__:null,default:De},[F]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eme=F,jme=Symbol.for("react.element"),Ame=Symbol.for("react.fragment"),Cme=Object.prototype.hasOwnProperty,Pme=Eme.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nme={key:!0,ref:!0,__self:!0,__source:!0};function TY(e,t,r){var n,a={},d=null,p=null;r!==void 0&&(d=""+r),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(p=t.ref);for(n in t)Cme.call(t,n)&&!Nme.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:jme,type:e,key:d,ref:p,props:a,_owner:Pme.current}}yI.Fragment=Ame;yI.jsx=TY;yI.jsxs=TY;pY.exports=yI;var c=pY.exports,EY={exports:{}},qc={},jY={exports:{}},AY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ve,We){var Ee=Ve.length;Ve.push(We);e:for(;0<Ee;){var ot=Ee-1>>>1,yt=Ve[ot];if(0<a(yt,We))Ve[ot]=We,Ve[Ee]=yt,Ee=ot;else break e}}function r(Ve){return Ve.length===0?null:Ve[0]}function n(Ve){if(Ve.length===0)return null;var We=Ve[0],Ee=Ve.pop();if(Ee!==We){Ve[0]=Ee;e:for(var ot=0,yt=Ve.length,Je=yt>>>1;ot<Je;){var Bt=2*(ot+1)-1,Pt=Ve[Bt],pt=Bt+1,Gt=Ve[pt];if(0>a(Pt,Ee))pt<yt&&0>a(Gt,Pt)?(Ve[ot]=Gt,Ve[pt]=Ee,ot=pt):(Ve[ot]=Pt,Ve[Bt]=Ee,ot=Bt);else if(pt<yt&&0>a(Gt,Ee))Ve[ot]=Gt,Ve[pt]=Ee,ot=pt;else break e}}return We}function a(Ve,We){var Ee=Ve.sortIndex-We.sortIndex;return Ee!==0?Ee:Ve.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var p=Date,s=p.now();e.unstable_now=function(){return p.now()-s}}var _=[],b=[],T=1,C=null,P=3,k=!1,B=!1,R=!1,D=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(Ve){for(var We=r(b);We!==null;){if(We.callback===null)n(b);else if(We.startTime<=Ve)n(b),We.sortIndex=We.expirationTime,t(_,We);else break;We=r(b)}}function K(Ve){if(R=!1,$(Ve),!B)if(r(_)!==null)B=!0,Me(Y);else{var We=r(b);We!==null&&Be(K,We.startTime-Ve)}}function Y(Ve,We){B=!1,R&&(R=!1,G(ie),ie=-1),k=!0;var Ee=P;try{for($(We),C=r(_);C!==null&&(!(C.expirationTime>We)||Ve&&!be());){var ot=C.callback;if(typeof ot=="function"){C.callback=null,P=C.priorityLevel;var yt=ot(C.expirationTime<=We);We=e.unstable_now(),typeof yt=="function"?C.callback=yt:C===r(_)&&n(_),$(We)}else n(_);C=r(_)}if(C!==null)var Je=!0;else{var Bt=r(b);Bt!==null&&Be(K,Bt.startTime-We),Je=!1}return Je}finally{C=null,P=Ee,k=!1}}var ee=!1,ae=null,ie=-1,ge=5,fe=-1;function be(){return!(e.unstable_now()-fe<ge)}function ue(){if(ae!==null){var Ve=e.unstable_now();fe=Ve;var We=!0;try{We=ae(!0,Ve)}finally{We?Ce():(ee=!1,ae=null)}}else ee=!1}var Ce;if(typeof V=="function")Ce=function(){V(ue)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,ze=ve.port2;ve.port1.onmessage=ue,Ce=function(){ze.postMessage(null)}}else Ce=function(){D(ue,0)};function Me(Ve){ae=Ve,ee||(ee=!0,Ce())}function Be(Ve,We){ie=D(function(){Ve(e.unstable_now())},We)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ve){Ve.callback=null},e.unstable_continueExecution=function(){B||k||(B=!0,Me(Y))},e.unstable_forceFrameRate=function(Ve){0>Ve||125<Ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<Ve?Math.floor(1e3/Ve):5},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return r(_)},e.unstable_next=function(Ve){switch(P){case 1:case 2:case 3:var We=3;break;default:We=P}var Ee=P;P=We;try{return Ve()}finally{P=Ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ve,We){switch(Ve){case 1:case 2:case 3:case 4:case 5:break;default:Ve=3}var Ee=P;P=Ve;try{return We()}finally{P=Ee}},e.unstable_scheduleCallback=function(Ve,We,Ee){var ot=e.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?ot+Ee:ot):Ee=ot,Ve){case 1:var yt=-1;break;case 2:yt=250;break;case 5:yt=1073741823;break;case 4:yt=1e4;break;default:yt=5e3}return yt=Ee+yt,Ve={id:T++,callback:We,priorityLevel:Ve,startTime:Ee,expirationTime:yt,sortIndex:-1},Ee>ot?(Ve.sortIndex=Ee,t(b,Ve),r(_)===null&&Ve===r(b)&&(R?(G(ie),ie=-1):R=!0,Be(K,Ee-ot))):(Ve.sortIndex=yt,t(_,Ve),B||k||(B=!0,Me(Y))),Ve},e.unstable_shouldYield=be,e.unstable_wrapCallback=function(Ve){var We=P;return function(){var Ee=P;P=We;try{return Ve.apply(this,arguments)}finally{P=Ee}}}})(AY);jY.exports=AY;var Ime=jY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kme=F,zc=Ime;function wr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var CY=new Set,aT={};function yv(e,t){m0(e,t),m0(e+"Capture",t)}function m0(e,t){for(aT[e]=t,e=0;e<t.length;e++)CY.add(t[e])}var Cf=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dL=Object.prototype.hasOwnProperty,Ome=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yq={},vq={};function Rme(e){return dL.call(vq,e)?!0:dL.call(yq,e)?!1:Ome.test(e)?vq[e]=!0:(yq[e]=!0,!1)}function Mme(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Dme(e,t,r,n){if(t===null||typeof t>"u"||Mme(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ul(e,t,r,n,a,d,p){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=d,this.removeEmptyString=p}var Uo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Uo[e]=new Ul(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Uo[t]=new Ul(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Uo[e]=new Ul(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Uo[e]=new Ul(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Uo[e]=new Ul(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Uo[e]=new Ul(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Uo[e]=new Ul(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Uo[e]=new Ul(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Uo[e]=new Ul(e,5,!1,e.toLowerCase(),null,!1,!1)});var cB=/[\-:]([a-z])/g;function uB(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(cB,uB);Uo[t]=new Ul(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(cB,uB);Uo[t]=new Ul(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(cB,uB);Uo[t]=new Ul(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Uo[e]=new Ul(e,1,!1,e.toLowerCase(),null,!1,!1)});Uo.xlinkHref=new Ul("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Uo[e]=new Ul(e,1,!1,e.toLowerCase(),null,!0,!0)});function dB(e,t,r,n){var a=Uo.hasOwnProperty(t)?Uo[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Dme(t,r,a,n)&&(r=null),n||a===null?Rme(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Uf=kme.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,UA=Symbol.for("react.element"),vx=Symbol.for("react.portal"),_x=Symbol.for("react.fragment"),hB=Symbol.for("react.strict_mode"),hL=Symbol.for("react.profiler"),PY=Symbol.for("react.provider"),NY=Symbol.for("react.context"),fB=Symbol.for("react.forward_ref"),fL=Symbol.for("react.suspense"),pL=Symbol.for("react.suspense_list"),pB=Symbol.for("react.memo"),Wp=Symbol.for("react.lazy"),IY=Symbol.for("react.offscreen"),_q=Symbol.iterator;function H1(e){return e===null||typeof e!="object"?null:(e=_q&&e[_q]||e["@@iterator"],typeof e=="function"?e:null)}var ra=Object.assign,_M;function yS(e){if(_M===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);_M=t&&t[1]||""}return`
`+_M+e}var xM=!1;function bM(e,t){if(!e||xM)return"";xM=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(b){var n=b}Reflect.construct(e,[],t)}else{try{t.call()}catch(b){n=b}e.call(t.prototype)}else{try{throw Error()}catch(b){n=b}e()}}catch(b){if(b&&n&&typeof b.stack=="string"){for(var a=b.stack.split(`
`),d=n.stack.split(`
`),p=a.length-1,s=d.length-1;1<=p&&0<=s&&a[p]!==d[s];)s--;for(;1<=p&&0<=s;p--,s--)if(a[p]!==d[s]){if(p!==1||s!==1)do if(p--,s--,0>s||a[p]!==d[s]){var _=`
`+a[p].replace(" at new "," at ");return e.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",e.displayName)),_}while(1<=p&&0<=s);break}}}finally{xM=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?yS(e):""}function Lme(e){switch(e.tag){case 5:return yS(e.type);case 16:return yS("Lazy");case 13:return yS("Suspense");case 19:return yS("SuspenseList");case 0:case 2:case 15:return e=bM(e.type,!1),e;case 11:return e=bM(e.type.render,!1),e;case 1:return e=bM(e.type,!0),e;default:return""}}function mL(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _x:return"Fragment";case vx:return"Portal";case hL:return"Profiler";case hB:return"StrictMode";case fL:return"Suspense";case pL:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case NY:return(e.displayName||"Context")+".Consumer";case PY:return(e._context.displayName||"Context")+".Provider";case fB:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case pB:return t=e.displayName||null,t!==null?t:mL(e.type)||"Memo";case Wp:t=e._payload,e=e._init;try{return mL(e(t))}catch{}}return null}function Fme(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mL(t);case 8:return t===hB?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Cm(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function kY(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function zme(e){var t=kY(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,d=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(p){n=""+p,d.call(this,p)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(p){n=""+p},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function qA(e){e._valueTracker||(e._valueTracker=zme(e))}function OY(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=kY(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function lP(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function gL(e,t){var r=t.checked;return ra({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function xq(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Cm(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function RY(e,t){t=t.checked,t!=null&&dB(e,"checked",t,!1)}function yL(e,t){RY(e,t);var r=Cm(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?vL(e,t.type,r):t.hasOwnProperty("defaultValue")&&vL(e,t.type,Cm(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function bq(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function vL(e,t,r){(t!=="number"||lP(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var vS=Array.isArray;function Bx(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Cm(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function _L(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(wr(91));return ra({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function wq(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(wr(92));if(vS(r)){if(1<r.length)throw Error(wr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Cm(r)}}function MY(e,t){var r=Cm(t.value),n=Cm(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Sq(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function DY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xL(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?DY(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var GA,LY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(GA=GA||document.createElement("div"),GA.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=GA.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function oT(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var RS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bme=["Webkit","ms","Moz","O"];Object.keys(RS).forEach(function(e){Bme.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),RS[t]=RS[e]})});function FY(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||RS.hasOwnProperty(e)&&RS[e]?(""+t).trim():t+"px"}function zY(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=FY(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var $me=ra({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bL(e,t){if(t){if($me[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(wr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(wr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(wr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(wr(62))}}function wL(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var SL=null;function mB(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var TL=null,$x=null,Vx=null;function Tq(e){if(e=M2(e)){if(typeof TL!="function")throw Error(wr(280));var t=e.stateNode;t&&(t=wI(t),TL(e.stateNode,e.type,t))}}function BY(e){$x?Vx?Vx.push(e):Vx=[e]:$x=e}function $Y(){if($x){var e=$x,t=Vx;if(Vx=$x=null,Tq(e),t)for(e=0;e<t.length;e++)Tq(t[e])}}function VY(e,t){return e(t)}function UY(){}var wM=!1;function qY(e,t,r){if(wM)return e(t,r);wM=!0;try{return VY(e,t,r)}finally{wM=!1,($x!==null||Vx!==null)&&(UY(),$Y())}}function lT(e,t){var r=e.stateNode;if(r===null)return null;var n=wI(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(wr(231,t,typeof r));return r}var EL=!1;if(Cf)try{var Z1={};Object.defineProperty(Z1,"passive",{get:function(){EL=!0}}),window.addEventListener("test",Z1,Z1),window.removeEventListener("test",Z1,Z1)}catch{EL=!1}function Vme(e,t,r,n,a,d,p,s,_){var b=Array.prototype.slice.call(arguments,3);try{t.apply(r,b)}catch(T){this.onError(T)}}var MS=!1,cP=null,uP=!1,jL=null,Ume={onError:function(e){MS=!0,cP=e}};function qme(e,t,r,n,a,d,p,s,_){MS=!1,cP=null,Vme.apply(Ume,arguments)}function Gme(e,t,r,n,a,d,p,s,_){if(qme.apply(this,arguments),MS){if(MS){var b=cP;MS=!1,cP=null}else throw Error(wr(198));uP||(uP=!0,jL=b)}}function vv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function GY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Eq(e){if(vv(e)!==e)throw Error(wr(188))}function Wme(e){var t=e.alternate;if(!t){if(t=vv(e),t===null)throw Error(wr(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var d=a.alternate;if(d===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===d.child){for(d=a.child;d;){if(d===r)return Eq(a),e;if(d===n)return Eq(a),t;d=d.sibling}throw Error(wr(188))}if(r.return!==n.return)r=a,n=d;else{for(var p=!1,s=a.child;s;){if(s===r){p=!0,r=a,n=d;break}if(s===n){p=!0,n=a,r=d;break}s=s.sibling}if(!p){for(s=d.child;s;){if(s===r){p=!0,r=d,n=a;break}if(s===n){p=!0,n=d,r=a;break}s=s.sibling}if(!p)throw Error(wr(189))}}if(r.alternate!==n)throw Error(wr(190))}if(r.tag!==3)throw Error(wr(188));return r.stateNode.current===r?e:t}function WY(e){return e=Wme(e),e!==null?HY(e):null}function HY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=HY(e);if(t!==null)return t;e=e.sibling}return null}var ZY=zc.unstable_scheduleCallback,jq=zc.unstable_cancelCallback,Hme=zc.unstable_shouldYield,Zme=zc.unstable_requestPaint,xa=zc.unstable_now,Xme=zc.unstable_getCurrentPriorityLevel,gB=zc.unstable_ImmediatePriority,XY=zc.unstable_UserBlockingPriority,dP=zc.unstable_NormalPriority,Kme=zc.unstable_LowPriority,KY=zc.unstable_IdlePriority,vI=null,vh=null;function Yme(e){if(vh&&typeof vh.onCommitFiberRoot=="function")try{vh.onCommitFiberRoot(vI,e,void 0,(e.current.flags&128)===128)}catch{}}var pd=Math.clz32?Math.clz32:ege,Jme=Math.log,Qme=Math.LN2;function ege(e){return e>>>=0,e===0?32:31-(Jme(e)/Qme|0)|0}var WA=64,HA=4194304;function _S(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function hP(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,d=e.pingedLanes,p=r&268435455;if(p!==0){var s=p&~a;s!==0?n=_S(s):(d&=p,d!==0&&(n=_S(d)))}else p=r&~a,p!==0?n=_S(p):d!==0&&(n=_S(d));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,d=t&-t,a>=d||a===16&&(d&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-pd(t),a=1<<r,n|=e[r],t&=~a;return n}function tge(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rge(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,d=e.pendingLanes;0<d;){var p=31-pd(d),s=1<<p,_=a[p];_===-1?(!(s&r)||s&n)&&(a[p]=tge(s,t)):_<=t&&(e.expiredLanes|=s),d&=~s}}function AL(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function YY(){var e=WA;return WA<<=1,!(WA&4194240)&&(WA=64),e}function SM(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function O2(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-pd(t),e[t]=r}function nge(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-pd(r),d=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~d}}function yB(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-pd(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var us=0;function JY(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var QY,vB,eJ,tJ,rJ,CL=!1,ZA=[],gm=null,ym=null,vm=null,cT=new Map,uT=new Map,Yp=[],ige="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Aq(e,t){switch(e){case"focusin":case"focusout":gm=null;break;case"dragenter":case"dragleave":ym=null;break;case"mouseover":case"mouseout":vm=null;break;case"pointerover":case"pointerout":cT.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":uT.delete(t.pointerId)}}function X1(e,t,r,n,a,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:d,targetContainers:[a]},t!==null&&(t=M2(t),t!==null&&vB(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function sge(e,t,r,n,a){switch(t){case"focusin":return gm=X1(gm,e,t,r,n,a),!0;case"dragenter":return ym=X1(ym,e,t,r,n,a),!0;case"mouseover":return vm=X1(vm,e,t,r,n,a),!0;case"pointerover":var d=a.pointerId;return cT.set(d,X1(cT.get(d)||null,e,t,r,n,a)),!0;case"gotpointercapture":return d=a.pointerId,uT.set(d,X1(uT.get(d)||null,e,t,r,n,a)),!0}return!1}function nJ(e){var t=by(e.target);if(t!==null){var r=vv(t);if(r!==null){if(t=r.tag,t===13){if(t=GY(r),t!==null){e.blockedOn=t,rJ(e.priority,function(){eJ(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function BC(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=PL(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);SL=n,r.target.dispatchEvent(n),SL=null}else return t=M2(r),t!==null&&vB(t),e.blockedOn=r,!1;t.shift()}return!0}function Cq(e,t,r){BC(e)&&r.delete(t)}function age(){CL=!1,gm!==null&&BC(gm)&&(gm=null),ym!==null&&BC(ym)&&(ym=null),vm!==null&&BC(vm)&&(vm=null),cT.forEach(Cq),uT.forEach(Cq)}function K1(e,t){e.blockedOn===t&&(e.blockedOn=null,CL||(CL=!0,zc.unstable_scheduleCallback(zc.unstable_NormalPriority,age)))}function dT(e){function t(a){return K1(a,e)}if(0<ZA.length){K1(ZA[0],e);for(var r=1;r<ZA.length;r++){var n=ZA[r];n.blockedOn===e&&(n.blockedOn=null)}}for(gm!==null&&K1(gm,e),ym!==null&&K1(ym,e),vm!==null&&K1(vm,e),cT.forEach(t),uT.forEach(t),r=0;r<Yp.length;r++)n=Yp[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Yp.length&&(r=Yp[0],r.blockedOn===null);)nJ(r),r.blockedOn===null&&Yp.shift()}var Ux=Uf.ReactCurrentBatchConfig,fP=!0;function oge(e,t,r,n){var a=us,d=Ux.transition;Ux.transition=null;try{us=1,_B(e,t,r,n)}finally{us=a,Ux.transition=d}}function lge(e,t,r,n){var a=us,d=Ux.transition;Ux.transition=null;try{us=4,_B(e,t,r,n)}finally{us=a,Ux.transition=d}}function _B(e,t,r,n){if(fP){var a=PL(e,t,r,n);if(a===null)OM(e,t,n,pP,r),Aq(e,n);else if(sge(a,e,t,r,n))n.stopPropagation();else if(Aq(e,n),t&4&&-1<ige.indexOf(e)){for(;a!==null;){var d=M2(a);if(d!==null&&QY(d),d=PL(e,t,r,n),d===null&&OM(e,t,n,pP,r),d===a)break;a=d}a!==null&&n.stopPropagation()}else OM(e,t,n,null,r)}}var pP=null;function PL(e,t,r,n){if(pP=null,e=mB(n),e=by(e),e!==null)if(t=vv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=GY(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return pP=e,null}function iJ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xme()){case gB:return 1;case XY:return 4;case dP:case Kme:return 16;case KY:return 536870912;default:return 16}default:return 16}}var cm=null,xB=null,$C=null;function sJ(){if($C)return $C;var e,t=xB,r=t.length,n,a="value"in cm?cm.value:cm.textContent,d=a.length;for(e=0;e<r&&t[e]===a[e];e++);var p=r-e;for(n=1;n<=p&&t[r-n]===a[d-n];n++);return $C=a.slice(e,1<n?1-n:void 0)}function VC(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function XA(){return!0}function Pq(){return!1}function Gc(e){function t(r,n,a,d,p){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=d,this.target=p,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(d):d[s]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?XA:Pq,this.isPropagationStopped=Pq,this}return ra(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=XA)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=XA)},persist:function(){},isPersistent:XA}),t}var ub={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bB=Gc(ub),R2=ra({},ub,{view:0,detail:0}),cge=Gc(R2),TM,EM,Y1,_I=ra({},R2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wB,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Y1&&(Y1&&e.type==="mousemove"?(TM=e.screenX-Y1.screenX,EM=e.screenY-Y1.screenY):EM=TM=0,Y1=e),TM)},movementY:function(e){return"movementY"in e?e.movementY:EM}}),Nq=Gc(_I),uge=ra({},_I,{dataTransfer:0}),dge=Gc(uge),hge=ra({},R2,{relatedTarget:0}),jM=Gc(hge),fge=ra({},ub,{animationName:0,elapsedTime:0,pseudoElement:0}),pge=Gc(fge),mge=ra({},ub,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gge=Gc(mge),yge=ra({},ub,{data:0}),Iq=Gc(yge),vge={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_ge={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xge={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bge(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=xge[e])?!!t[e]:!1}function wB(){return bge}var wge=ra({},R2,{key:function(e){if(e.key){var t=vge[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=VC(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?_ge[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wB,charCode:function(e){return e.type==="keypress"?VC(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?VC(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Sge=Gc(wge),Tge=ra({},_I,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kq=Gc(Tge),Ege=ra({},R2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wB}),jge=Gc(Ege),Age=ra({},ub,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cge=Gc(Age),Pge=ra({},_I,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nge=Gc(Pge),Ige=[9,13,27,32],SB=Cf&&"CompositionEvent"in window,DS=null;Cf&&"documentMode"in document&&(DS=document.documentMode);var kge=Cf&&"TextEvent"in window&&!DS,aJ=Cf&&(!SB||DS&&8<DS&&11>=DS),Oq=" ",Rq=!1;function oJ(e,t){switch(e){case"keyup":return Ige.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lJ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var xx=!1;function Oge(e,t){switch(e){case"compositionend":return lJ(t);case"keypress":return t.which!==32?null:(Rq=!0,Oq);case"textInput":return e=t.data,e===Oq&&Rq?null:e;default:return null}}function Rge(e,t){if(xx)return e==="compositionend"||!SB&&oJ(e,t)?(e=sJ(),$C=xB=cm=null,xx=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return aJ&&t.locale!=="ko"?null:t.data;default:return null}}var Mge={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mq(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Mge[e.type]:t==="textarea"}function cJ(e,t,r,n){BY(n),t=mP(t,"onChange"),0<t.length&&(r=new bB("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var LS=null,hT=null;function Dge(e){xJ(e,0)}function xI(e){var t=Sx(e);if(OY(t))return e}function Lge(e,t){if(e==="change")return t}var uJ=!1;if(Cf){var AM;if(Cf){var CM="oninput"in document;if(!CM){var Dq=document.createElement("div");Dq.setAttribute("oninput","return;"),CM=typeof Dq.oninput=="function"}AM=CM}else AM=!1;uJ=AM&&(!document.documentMode||9<document.documentMode)}function Lq(){LS&&(LS.detachEvent("onpropertychange",dJ),hT=LS=null)}function dJ(e){if(e.propertyName==="value"&&xI(hT)){var t=[];cJ(t,hT,e,mB(e)),qY(Dge,t)}}function Fge(e,t,r){e==="focusin"?(Lq(),LS=t,hT=r,LS.attachEvent("onpropertychange",dJ)):e==="focusout"&&Lq()}function zge(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return xI(hT)}function Bge(e,t){if(e==="click")return xI(t)}function $ge(e,t){if(e==="input"||e==="change")return xI(t)}function Vge(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var vd=typeof Object.is=="function"?Object.is:Vge;function fT(e,t){if(vd(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!dL.call(t,a)||!vd(e[a],t[a]))return!1}return!0}function Fq(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function zq(e,t){var r=Fq(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Fq(r)}}function hJ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?hJ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function fJ(){for(var e=window,t=lP();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=lP(e.document)}return t}function TB(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Uge(e){var t=fJ(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&hJ(r.ownerDocument.documentElement,r)){if(n!==null&&TB(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,d=Math.min(n.start,a);n=n.end===void 0?d:Math.min(n.end,a),!e.extend&&d>n&&(a=n,n=d,d=a),a=zq(r,d);var p=zq(r,n);a&&p&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==p.node||e.focusOffset!==p.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),d>n?(e.addRange(t),e.extend(p.node,p.offset)):(t.setEnd(p.node,p.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var qge=Cf&&"documentMode"in document&&11>=document.documentMode,bx=null,NL=null,FS=null,IL=!1;function Bq(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;IL||bx==null||bx!==lP(n)||(n=bx,"selectionStart"in n&&TB(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),FS&&fT(FS,n)||(FS=n,n=mP(NL,"onSelect"),0<n.length&&(t=new bB("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=bx)))}function KA(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var wx={animationend:KA("Animation","AnimationEnd"),animationiteration:KA("Animation","AnimationIteration"),animationstart:KA("Animation","AnimationStart"),transitionend:KA("Transition","TransitionEnd")},PM={},pJ={};Cf&&(pJ=document.createElement("div").style,"AnimationEvent"in window||(delete wx.animationend.animation,delete wx.animationiteration.animation,delete wx.animationstart.animation),"TransitionEvent"in window||delete wx.transitionend.transition);function bI(e){if(PM[e])return PM[e];if(!wx[e])return e;var t=wx[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in pJ)return PM[e]=t[r];return e}var mJ=bI("animationend"),gJ=bI("animationiteration"),yJ=bI("animationstart"),vJ=bI("transitionend"),_J=new Map,$q="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Um(e,t){_J.set(e,t),yv(t,[e])}for(var NM=0;NM<$q.length;NM++){var IM=$q[NM],Gge=IM.toLowerCase(),Wge=IM[0].toUpperCase()+IM.slice(1);Um(Gge,"on"+Wge)}Um(mJ,"onAnimationEnd");Um(gJ,"onAnimationIteration");Um(yJ,"onAnimationStart");Um("dblclick","onDoubleClick");Um("focusin","onFocus");Um("focusout","onBlur");Um(vJ,"onTransitionEnd");m0("onMouseEnter",["mouseout","mouseover"]);m0("onMouseLeave",["mouseout","mouseover"]);m0("onPointerEnter",["pointerout","pointerover"]);m0("onPointerLeave",["pointerout","pointerover"]);yv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yv("onBeforeInput",["compositionend","keypress","textInput","paste"]);yv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hge=new Set("cancel close invalid load scroll toggle".split(" ").concat(xS));function Vq(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Gme(n,t,void 0,e),e.currentTarget=null}function xJ(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var d=void 0;if(t)for(var p=n.length-1;0<=p;p--){var s=n[p],_=s.instance,b=s.currentTarget;if(s=s.listener,_!==d&&a.isPropagationStopped())break e;Vq(a,s,b),d=_}else for(p=0;p<n.length;p++){if(s=n[p],_=s.instance,b=s.currentTarget,s=s.listener,_!==d&&a.isPropagationStopped())break e;Vq(a,s,b),d=_}}}if(uP)throw e=jL,uP=!1,jL=null,e}function Ms(e,t){var r=t[DL];r===void 0&&(r=t[DL]=new Set);var n=e+"__bubble";r.has(n)||(bJ(t,e,2,!1),r.add(n))}function kM(e,t,r){var n=0;t&&(n|=4),bJ(r,e,n,t)}var YA="_reactListening"+Math.random().toString(36).slice(2);function pT(e){if(!e[YA]){e[YA]=!0,CY.forEach(function(r){r!=="selectionchange"&&(Hge.has(r)||kM(r,!1,e),kM(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[YA]||(t[YA]=!0,kM("selectionchange",!1,t))}}function bJ(e,t,r,n){switch(iJ(t)){case 1:var a=oge;break;case 4:a=lge;break;default:a=_B}r=a.bind(null,t,r,e),a=void 0,!EL||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function OM(e,t,r,n,a){var d=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(p===4)for(p=n.return;p!==null;){var _=p.tag;if((_===3||_===4)&&(_=p.stateNode.containerInfo,_===a||_.nodeType===8&&_.parentNode===a))return;p=p.return}for(;s!==null;){if(p=by(s),p===null)return;if(_=p.tag,_===5||_===6){n=d=p;continue e}s=s.parentNode}}n=n.return}qY(function(){var b=d,T=mB(r),C=[];e:{var P=_J.get(e);if(P!==void 0){var k=bB,B=e;switch(e){case"keypress":if(VC(r)===0)break e;case"keydown":case"keyup":k=Sge;break;case"focusin":B="focus",k=jM;break;case"focusout":B="blur",k=jM;break;case"beforeblur":case"afterblur":k=jM;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=Nq;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=dge;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=jge;break;case mJ:case gJ:case yJ:k=pge;break;case vJ:k=Cge;break;case"scroll":k=cge;break;case"wheel":k=Nge;break;case"copy":case"cut":case"paste":k=gge;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=kq}var R=(t&4)!==0,D=!R&&e==="scroll",G=R?P!==null?P+"Capture":null:P;R=[];for(var V=b,$;V!==null;){$=V;var K=$.stateNode;if($.tag===5&&K!==null&&($=K,G!==null&&(K=lT(V,G),K!=null&&R.push(mT(V,K,$)))),D)break;V=V.return}0<R.length&&(P=new k(P,B,null,r,T),C.push({event:P,listeners:R}))}}if(!(t&7)){e:{if(P=e==="mouseover"||e==="pointerover",k=e==="mouseout"||e==="pointerout",P&&r!==SL&&(B=r.relatedTarget||r.fromElement)&&(by(B)||B[Pf]))break e;if((k||P)&&(P=T.window===T?T:(P=T.ownerDocument)?P.defaultView||P.parentWindow:window,k?(B=r.relatedTarget||r.toElement,k=b,B=B?by(B):null,B!==null&&(D=vv(B),B!==D||B.tag!==5&&B.tag!==6)&&(B=null)):(k=null,B=b),k!==B)){if(R=Nq,K="onMouseLeave",G="onMouseEnter",V="mouse",(e==="pointerout"||e==="pointerover")&&(R=kq,K="onPointerLeave",G="onPointerEnter",V="pointer"),D=k==null?P:Sx(k),$=B==null?P:Sx(B),P=new R(K,V+"leave",k,r,T),P.target=D,P.relatedTarget=$,K=null,by(T)===b&&(R=new R(G,V+"enter",B,r,T),R.target=$,R.relatedTarget=D,K=R),D=K,k&&B)t:{for(R=k,G=B,V=0,$=R;$;$=J_($))V++;for($=0,K=G;K;K=J_(K))$++;for(;0<V-$;)R=J_(R),V--;for(;0<$-V;)G=J_(G),$--;for(;V--;){if(R===G||G!==null&&R===G.alternate)break t;R=J_(R),G=J_(G)}R=null}else R=null;k!==null&&Uq(C,P,k,R,!1),B!==null&&D!==null&&Uq(C,D,B,R,!0)}}e:{if(P=b?Sx(b):window,k=P.nodeName&&P.nodeName.toLowerCase(),k==="select"||k==="input"&&P.type==="file")var Y=Lge;else if(Mq(P))if(uJ)Y=$ge;else{Y=zge;var ee=Fge}else(k=P.nodeName)&&k.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(Y=Bge);if(Y&&(Y=Y(e,b))){cJ(C,Y,r,T);break e}ee&&ee(e,P,b),e==="focusout"&&(ee=P._wrapperState)&&ee.controlled&&P.type==="number"&&vL(P,"number",P.value)}switch(ee=b?Sx(b):window,e){case"focusin":(Mq(ee)||ee.contentEditable==="true")&&(bx=ee,NL=b,FS=null);break;case"focusout":FS=NL=bx=null;break;case"mousedown":IL=!0;break;case"contextmenu":case"mouseup":case"dragend":IL=!1,Bq(C,r,T);break;case"selectionchange":if(qge)break;case"keydown":case"keyup":Bq(C,r,T)}var ae;if(SB)e:{switch(e){case"compositionstart":var ie="onCompositionStart";break e;case"compositionend":ie="onCompositionEnd";break e;case"compositionupdate":ie="onCompositionUpdate";break e}ie=void 0}else xx?oJ(e,r)&&(ie="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ie="onCompositionStart");ie&&(aJ&&r.locale!=="ko"&&(xx||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&xx&&(ae=sJ()):(cm=T,xB="value"in cm?cm.value:cm.textContent,xx=!0)),ee=mP(b,ie),0<ee.length&&(ie=new Iq(ie,e,null,r,T),C.push({event:ie,listeners:ee}),ae?ie.data=ae:(ae=lJ(r),ae!==null&&(ie.data=ae)))),(ae=kge?Oge(e,r):Rge(e,r))&&(b=mP(b,"onBeforeInput"),0<b.length&&(T=new Iq("onBeforeInput","beforeinput",null,r,T),C.push({event:T,listeners:b}),T.data=ae))}xJ(C,t)})}function mT(e,t,r){return{instance:e,listener:t,currentTarget:r}}function mP(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,d=a.stateNode;a.tag===5&&d!==null&&(a=d,d=lT(e,r),d!=null&&n.unshift(mT(e,d,a)),d=lT(e,t),d!=null&&n.push(mT(e,d,a))),e=e.return}return n}function J_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Uq(e,t,r,n,a){for(var d=t._reactName,p=[];r!==null&&r!==n;){var s=r,_=s.alternate,b=s.stateNode;if(_!==null&&_===n)break;s.tag===5&&b!==null&&(s=b,a?(_=lT(r,d),_!=null&&p.unshift(mT(r,_,s))):a||(_=lT(r,d),_!=null&&p.push(mT(r,_,s)))),r=r.return}p.length!==0&&e.push({event:t,listeners:p})}var Zge=/\r\n?/g,Xge=/\u0000|\uFFFD/g;function qq(e){return(typeof e=="string"?e:""+e).replace(Zge,`
`).replace(Xge,"")}function JA(e,t,r){if(t=qq(t),qq(e)!==t&&r)throw Error(wr(425))}function gP(){}var kL=null,OL=null;function RL(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ML=typeof setTimeout=="function"?setTimeout:void 0,Kge=typeof clearTimeout=="function"?clearTimeout:void 0,Gq=typeof Promise=="function"?Promise:void 0,Yge=typeof queueMicrotask=="function"?queueMicrotask:typeof Gq<"u"?function(e){return Gq.resolve(null).then(e).catch(Jge)}:ML;function Jge(e){setTimeout(function(){throw e})}function RM(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),dT(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);dT(t)}function _m(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Wq(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var db=Math.random().toString(36).slice(2),uh="__reactFiber$"+db,gT="__reactProps$"+db,Pf="__reactContainer$"+db,DL="__reactEvents$"+db,Qge="__reactListeners$"+db,eye="__reactHandles$"+db;function by(e){var t=e[uh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Pf]||r[uh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Wq(e);e!==null;){if(r=e[uh])return r;e=Wq(e)}return t}e=r,r=e.parentNode}return null}function M2(e){return e=e[uh]||e[Pf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Sx(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(wr(33))}function wI(e){return e[gT]||null}var LL=[],Tx=-1;function qm(e){return{current:e}}function Fs(e){0>Tx||(e.current=LL[Tx],LL[Tx]=null,Tx--)}function Ts(e,t){Tx++,LL[Tx]=e.current,e.current=t}var Pm={},cl=qm(Pm),oc=qm(!1),Ky=Pm;function g0(e,t){var r=e.type.contextTypes;if(!r)return Pm;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},d;for(d in r)a[d]=t[d];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function lc(e){return e=e.childContextTypes,e!=null}function yP(){Fs(oc),Fs(cl)}function Hq(e,t,r){if(cl.current!==Pm)throw Error(wr(168));Ts(cl,t),Ts(oc,r)}function wJ(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(wr(108,Fme(e)||"Unknown",a));return ra({},r,n)}function vP(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Pm,Ky=cl.current,Ts(cl,e),Ts(oc,oc.current),!0}function Zq(e,t,r){var n=e.stateNode;if(!n)throw Error(wr(169));r?(e=wJ(e,t,Ky),n.__reactInternalMemoizedMergedChildContext=e,Fs(oc),Fs(cl),Ts(cl,e)):Fs(oc),Ts(oc,r)}var pf=null,SI=!1,MM=!1;function SJ(e){pf===null?pf=[e]:pf.push(e)}function tye(e){SI=!0,SJ(e)}function Gm(){if(!MM&&pf!==null){MM=!0;var e=0,t=us;try{var r=pf;for(us=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}pf=null,SI=!1}catch(a){throw pf!==null&&(pf=pf.slice(e+1)),ZY(gB,Gm),a}finally{us=t,MM=!1}}return null}var Ex=[],jx=0,_P=null,xP=0,mu=[],gu=0,Yy=null,yf=1,vf="";function uy(e,t){Ex[jx++]=xP,Ex[jx++]=_P,_P=e,xP=t}function TJ(e,t,r){mu[gu++]=yf,mu[gu++]=vf,mu[gu++]=Yy,Yy=e;var n=yf;e=vf;var a=32-pd(n)-1;n&=~(1<<a),r+=1;var d=32-pd(t)+a;if(30<d){var p=a-a%5;d=(n&(1<<p)-1).toString(32),n>>=p,a-=p,yf=1<<32-pd(t)+a|r<<a|n,vf=d+e}else yf=1<<d|r<<a|n,vf=e}function EB(e){e.return!==null&&(uy(e,1),TJ(e,1,0))}function jB(e){for(;e===_P;)_P=Ex[--jx],Ex[jx]=null,xP=Ex[--jx],Ex[jx]=null;for(;e===Yy;)Yy=mu[--gu],mu[gu]=null,vf=mu[--gu],mu[gu]=null,yf=mu[--gu],mu[gu]=null}var Oc=null,kc=null,qs=!1,cd=null;function EJ(e,t){var r=vu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function Xq(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Oc=e,kc=_m(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Oc=e,kc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Yy!==null?{id:yf,overflow:vf}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=vu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Oc=e,kc=null,!0):!1;default:return!1}}function FL(e){return(e.mode&1)!==0&&(e.flags&128)===0}function zL(e){if(qs){var t=kc;if(t){var r=t;if(!Xq(e,t)){if(FL(e))throw Error(wr(418));t=_m(r.nextSibling);var n=Oc;t&&Xq(e,t)?EJ(n,r):(e.flags=e.flags&-4097|2,qs=!1,Oc=e)}}else{if(FL(e))throw Error(wr(418));e.flags=e.flags&-4097|2,qs=!1,Oc=e}}}function Kq(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Oc=e}function QA(e){if(e!==Oc)return!1;if(!qs)return Kq(e),qs=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!RL(e.type,e.memoizedProps)),t&&(t=kc)){if(FL(e))throw jJ(),Error(wr(418));for(;t;)EJ(e,t),t=_m(t.nextSibling)}if(Kq(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(wr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){kc=_m(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}kc=null}}else kc=Oc?_m(e.stateNode.nextSibling):null;return!0}function jJ(){for(var e=kc;e;)e=_m(e.nextSibling)}function y0(){kc=Oc=null,qs=!1}function AB(e){cd===null?cd=[e]:cd.push(e)}var rye=Uf.ReactCurrentBatchConfig;function J1(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(wr(309));var n=r.stateNode}if(!n)throw Error(wr(147,e));var a=n,d=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===d?t.ref:(t=function(p){var s=a.refs;p===null?delete s[d]:s[d]=p},t._stringRef=d,t)}if(typeof e!="string")throw Error(wr(284));if(!r._owner)throw Error(wr(290,e))}return e}function eC(e,t){throw e=Object.prototype.toString.call(t),Error(wr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yq(e){var t=e._init;return t(e._payload)}function AJ(e){function t(G,V){if(e){var $=G.deletions;$===null?(G.deletions=[V],G.flags|=16):$.push(V)}}function r(G,V){if(!e)return null;for(;V!==null;)t(G,V),V=V.sibling;return null}function n(G,V){for(G=new Map;V!==null;)V.key!==null?G.set(V.key,V):G.set(V.index,V),V=V.sibling;return G}function a(G,V){return G=Sm(G,V),G.index=0,G.sibling=null,G}function d(G,V,$){return G.index=$,e?($=G.alternate,$!==null?($=$.index,$<V?(G.flags|=2,V):$):(G.flags|=2,V)):(G.flags|=1048576,V)}function p(G){return e&&G.alternate===null&&(G.flags|=2),G}function s(G,V,$,K){return V===null||V.tag!==6?(V=VM($,G.mode,K),V.return=G,V):(V=a(V,$),V.return=G,V)}function _(G,V,$,K){var Y=$.type;return Y===_x?T(G,V,$.props.children,K,$.key):V!==null&&(V.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Wp&&Yq(Y)===V.type)?(K=a(V,$.props),K.ref=J1(G,V,$),K.return=G,K):(K=XC($.type,$.key,$.props,null,G.mode,K),K.ref=J1(G,V,$),K.return=G,K)}function b(G,V,$,K){return V===null||V.tag!==4||V.stateNode.containerInfo!==$.containerInfo||V.stateNode.implementation!==$.implementation?(V=UM($,G.mode,K),V.return=G,V):(V=a(V,$.children||[]),V.return=G,V)}function T(G,V,$,K,Y){return V===null||V.tag!==7?(V=Gy($,G.mode,K,Y),V.return=G,V):(V=a(V,$),V.return=G,V)}function C(G,V,$){if(typeof V=="string"&&V!==""||typeof V=="number")return V=VM(""+V,G.mode,$),V.return=G,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case UA:return $=XC(V.type,V.key,V.props,null,G.mode,$),$.ref=J1(G,null,V),$.return=G,$;case vx:return V=UM(V,G.mode,$),V.return=G,V;case Wp:var K=V._init;return C(G,K(V._payload),$)}if(vS(V)||H1(V))return V=Gy(V,G.mode,$,null),V.return=G,V;eC(G,V)}return null}function P(G,V,$,K){var Y=V!==null?V.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return Y!==null?null:s(G,V,""+$,K);if(typeof $=="object"&&$!==null){switch($.$$typeof){case UA:return $.key===Y?_(G,V,$,K):null;case vx:return $.key===Y?b(G,V,$,K):null;case Wp:return Y=$._init,P(G,V,Y($._payload),K)}if(vS($)||H1($))return Y!==null?null:T(G,V,$,K,null);eC(G,$)}return null}function k(G,V,$,K,Y){if(typeof K=="string"&&K!==""||typeof K=="number")return G=G.get($)||null,s(V,G,""+K,Y);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case UA:return G=G.get(K.key===null?$:K.key)||null,_(V,G,K,Y);case vx:return G=G.get(K.key===null?$:K.key)||null,b(V,G,K,Y);case Wp:var ee=K._init;return k(G,V,$,ee(K._payload),Y)}if(vS(K)||H1(K))return G=G.get($)||null,T(V,G,K,Y,null);eC(V,K)}return null}function B(G,V,$,K){for(var Y=null,ee=null,ae=V,ie=V=0,ge=null;ae!==null&&ie<$.length;ie++){ae.index>ie?(ge=ae,ae=null):ge=ae.sibling;var fe=P(G,ae,$[ie],K);if(fe===null){ae===null&&(ae=ge);break}e&&ae&&fe.alternate===null&&t(G,ae),V=d(fe,V,ie),ee===null?Y=fe:ee.sibling=fe,ee=fe,ae=ge}if(ie===$.length)return r(G,ae),qs&&uy(G,ie),Y;if(ae===null){for(;ie<$.length;ie++)ae=C(G,$[ie],K),ae!==null&&(V=d(ae,V,ie),ee===null?Y=ae:ee.sibling=ae,ee=ae);return qs&&uy(G,ie),Y}for(ae=n(G,ae);ie<$.length;ie++)ge=k(ae,G,ie,$[ie],K),ge!==null&&(e&&ge.alternate!==null&&ae.delete(ge.key===null?ie:ge.key),V=d(ge,V,ie),ee===null?Y=ge:ee.sibling=ge,ee=ge);return e&&ae.forEach(function(be){return t(G,be)}),qs&&uy(G,ie),Y}function R(G,V,$,K){var Y=H1($);if(typeof Y!="function")throw Error(wr(150));if($=Y.call($),$==null)throw Error(wr(151));for(var ee=Y=null,ae=V,ie=V=0,ge=null,fe=$.next();ae!==null&&!fe.done;ie++,fe=$.next()){ae.index>ie?(ge=ae,ae=null):ge=ae.sibling;var be=P(G,ae,fe.value,K);if(be===null){ae===null&&(ae=ge);break}e&&ae&&be.alternate===null&&t(G,ae),V=d(be,V,ie),ee===null?Y=be:ee.sibling=be,ee=be,ae=ge}if(fe.done)return r(G,ae),qs&&uy(G,ie),Y;if(ae===null){for(;!fe.done;ie++,fe=$.next())fe=C(G,fe.value,K),fe!==null&&(V=d(fe,V,ie),ee===null?Y=fe:ee.sibling=fe,ee=fe);return qs&&uy(G,ie),Y}for(ae=n(G,ae);!fe.done;ie++,fe=$.next())fe=k(ae,G,ie,fe.value,K),fe!==null&&(e&&fe.alternate!==null&&ae.delete(fe.key===null?ie:fe.key),V=d(fe,V,ie),ee===null?Y=fe:ee.sibling=fe,ee=fe);return e&&ae.forEach(function(ue){return t(G,ue)}),qs&&uy(G,ie),Y}function D(G,V,$,K){if(typeof $=="object"&&$!==null&&$.type===_x&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case UA:e:{for(var Y=$.key,ee=V;ee!==null;){if(ee.key===Y){if(Y=$.type,Y===_x){if(ee.tag===7){r(G,ee.sibling),V=a(ee,$.props.children),V.return=G,G=V;break e}}else if(ee.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Wp&&Yq(Y)===ee.type){r(G,ee.sibling),V=a(ee,$.props),V.ref=J1(G,ee,$),V.return=G,G=V;break e}r(G,ee);break}else t(G,ee);ee=ee.sibling}$.type===_x?(V=Gy($.props.children,G.mode,K,$.key),V.return=G,G=V):(K=XC($.type,$.key,$.props,null,G.mode,K),K.ref=J1(G,V,$),K.return=G,G=K)}return p(G);case vx:e:{for(ee=$.key;V!==null;){if(V.key===ee)if(V.tag===4&&V.stateNode.containerInfo===$.containerInfo&&V.stateNode.implementation===$.implementation){r(G,V.sibling),V=a(V,$.children||[]),V.return=G,G=V;break e}else{r(G,V);break}else t(G,V);V=V.sibling}V=UM($,G.mode,K),V.return=G,G=V}return p(G);case Wp:return ee=$._init,D(G,V,ee($._payload),K)}if(vS($))return B(G,V,$,K);if(H1($))return R(G,V,$,K);eC(G,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,V!==null&&V.tag===6?(r(G,V.sibling),V=a(V,$),V.return=G,G=V):(r(G,V),V=VM($,G.mode,K),V.return=G,G=V),p(G)):r(G,V)}return D}var v0=AJ(!0),CJ=AJ(!1),bP=qm(null),wP=null,Ax=null,CB=null;function PB(){CB=Ax=wP=null}function NB(e){var t=bP.current;Fs(bP),e._currentValue=t}function BL(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function qx(e,t){wP=e,CB=Ax=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(sc=!0),e.firstContext=null)}function Tu(e){var t=e._currentValue;if(CB!==e)if(e={context:e,memoizedValue:t,next:null},Ax===null){if(wP===null)throw Error(wr(308));Ax=e,wP.dependencies={lanes:0,firstContext:e}}else Ax=Ax.next=e;return t}var wy=null;function IB(e){wy===null?wy=[e]:wy.push(e)}function PJ(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,IB(t)):(r.next=a.next,a.next=r),t.interleaved=r,Nf(e,n)}function Nf(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Hp=!1;function kB(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function NJ(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Sf(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function xm(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Fi&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Nf(e,r)}return a=n.interleaved,a===null?(t.next=t,IB(n)):(t.next=a.next,a.next=t),n.interleaved=t,Nf(e,r)}function UC(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,yB(e,r)}}function Jq(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?a=d=p:d=d.next=p,r=r.next}while(r!==null);d===null?a=d=t:d=d.next=t}else a=d=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:d,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function SP(e,t,r,n){var a=e.updateQueue;Hp=!1;var d=a.firstBaseUpdate,p=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var _=s,b=_.next;_.next=null,p===null?d=b:p.next=b,p=_;var T=e.alternate;T!==null&&(T=T.updateQueue,s=T.lastBaseUpdate,s!==p&&(s===null?T.firstBaseUpdate=b:s.next=b,T.lastBaseUpdate=_))}if(d!==null){var C=a.baseState;p=0,T=b=_=null,s=d;do{var P=s.lane,k=s.eventTime;if((n&P)===P){T!==null&&(T=T.next={eventTime:k,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var B=e,R=s;switch(P=t,k=r,R.tag){case 1:if(B=R.payload,typeof B=="function"){C=B.call(k,C,P);break e}C=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=R.payload,P=typeof B=="function"?B.call(k,C,P):B,P==null)break e;C=ra({},C,P);break e;case 2:Hp=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,P=a.effects,P===null?a.effects=[s]:P.push(s))}else k={eventTime:k,lane:P,tag:s.tag,payload:s.payload,callback:s.callback,next:null},T===null?(b=T=k,_=C):T=T.next=k,p|=P;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;P=s,s=P.next,P.next=null,a.lastBaseUpdate=P,a.shared.pending=null}}while(!0);if(T===null&&(_=C),a.baseState=_,a.firstBaseUpdate=b,a.lastBaseUpdate=T,t=a.shared.interleaved,t!==null){a=t;do p|=a.lane,a=a.next;while(a!==t)}else d===null&&(a.shared.lanes=0);Qy|=p,e.lanes=p,e.memoizedState=C}}function Qq(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(wr(191,a));a.call(n)}}}var D2={},_h=qm(D2),yT=qm(D2),vT=qm(D2);function Sy(e){if(e===D2)throw Error(wr(174));return e}function OB(e,t){switch(Ts(vT,t),Ts(yT,e),Ts(_h,D2),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:xL(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=xL(t,e)}Fs(_h),Ts(_h,t)}function _0(){Fs(_h),Fs(yT),Fs(vT)}function IJ(e){Sy(vT.current);var t=Sy(_h.current),r=xL(t,e.type);t!==r&&(Ts(yT,e),Ts(_h,r))}function RB(e){yT.current===e&&(Fs(_h),Fs(yT))}var Qs=qm(0);function TP(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var DM=[];function MB(){for(var e=0;e<DM.length;e++)DM[e]._workInProgressVersionPrimary=null;DM.length=0}var qC=Uf.ReactCurrentDispatcher,LM=Uf.ReactCurrentBatchConfig,Jy=0,ta=null,Ja=null,yo=null,EP=!1,zS=!1,_T=0,nye=0;function el(){throw Error(wr(321))}function DB(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!vd(e[r],t[r]))return!1;return!0}function LB(e,t,r,n,a,d){if(Jy=d,ta=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,qC.current=e===null||e.memoizedState===null?oye:lye,e=r(n,a),zS){d=0;do{if(zS=!1,_T=0,25<=d)throw Error(wr(301));d+=1,yo=Ja=null,t.updateQueue=null,qC.current=cye,e=r(n,a)}while(zS)}if(qC.current=jP,t=Ja!==null&&Ja.next!==null,Jy=0,yo=Ja=ta=null,EP=!1,t)throw Error(wr(300));return e}function FB(){var e=_T!==0;return _T=0,e}function ih(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yo===null?ta.memoizedState=yo=e:yo=yo.next=e,yo}function Eu(){if(Ja===null){var e=ta.alternate;e=e!==null?e.memoizedState:null}else e=Ja.next;var t=yo===null?ta.memoizedState:yo.next;if(t!==null)yo=t,Ja=e;else{if(e===null)throw Error(wr(310));Ja=e,e={memoizedState:Ja.memoizedState,baseState:Ja.baseState,baseQueue:Ja.baseQueue,queue:Ja.queue,next:null},yo===null?ta.memoizedState=yo=e:yo=yo.next=e}return yo}function xT(e,t){return typeof t=="function"?t(e):t}function FM(e){var t=Eu(),r=t.queue;if(r===null)throw Error(wr(311));r.lastRenderedReducer=e;var n=Ja,a=n.baseQueue,d=r.pending;if(d!==null){if(a!==null){var p=a.next;a.next=d.next,d.next=p}n.baseQueue=a=d,r.pending=null}if(a!==null){d=a.next,n=n.baseState;var s=p=null,_=null,b=d;do{var T=b.lane;if((Jy&T)===T)_!==null&&(_=_.next={lane:0,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null}),n=b.hasEagerState?b.eagerState:e(n,b.action);else{var C={lane:T,action:b.action,hasEagerState:b.hasEagerState,eagerState:b.eagerState,next:null};_===null?(s=_=C,p=n):_=_.next=C,ta.lanes|=T,Qy|=T}b=b.next}while(b!==null&&b!==d);_===null?p=n:_.next=s,vd(n,t.memoizedState)||(sc=!0),t.memoizedState=n,t.baseState=p,t.baseQueue=_,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do d=a.lane,ta.lanes|=d,Qy|=d,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function zM(e){var t=Eu(),r=t.queue;if(r===null)throw Error(wr(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,d=t.memoizedState;if(a!==null){r.pending=null;var p=a=a.next;do d=e(d,p.action),p=p.next;while(p!==a);vd(d,t.memoizedState)||(sc=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),r.lastRenderedState=d}return[d,n]}function kJ(){}function OJ(e,t){var r=ta,n=Eu(),a=t(),d=!vd(n.memoizedState,a);if(d&&(n.memoizedState=a,sc=!0),n=n.queue,zB(DJ.bind(null,r,n,e),[e]),n.getSnapshot!==t||d||yo!==null&&yo.memoizedState.tag&1){if(r.flags|=2048,bT(9,MJ.bind(null,r,n,a,t),void 0,null),_o===null)throw Error(wr(349));Jy&30||RJ(r,t,a)}return a}function RJ(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=ta.updateQueue,t===null?(t={lastEffect:null,stores:null},ta.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function MJ(e,t,r,n){t.value=r,t.getSnapshot=n,LJ(t)&&FJ(e)}function DJ(e,t,r){return r(function(){LJ(t)&&FJ(e)})}function LJ(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!vd(e,r)}catch{return!0}}function FJ(e){var t=Nf(e,1);t!==null&&md(t,e,1,-1)}function eG(e){var t=ih();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xT,lastRenderedState:e},t.queue=e,e=e.dispatch=aye.bind(null,ta,e),[t.memoizedState,e]}function bT(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=ta.updateQueue,t===null?(t={lastEffect:null,stores:null},ta.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function zJ(){return Eu().memoizedState}function GC(e,t,r,n){var a=ih();ta.flags|=e,a.memoizedState=bT(1|t,r,void 0,n===void 0?null:n)}function TI(e,t,r,n){var a=Eu();n=n===void 0?null:n;var d=void 0;if(Ja!==null){var p=Ja.memoizedState;if(d=p.destroy,n!==null&&DB(n,p.deps)){a.memoizedState=bT(t,r,d,n);return}}ta.flags|=e,a.memoizedState=bT(1|t,r,d,n)}function tG(e,t){return GC(8390656,8,e,t)}function zB(e,t){return TI(2048,8,e,t)}function BJ(e,t){return TI(4,2,e,t)}function $J(e,t){return TI(4,4,e,t)}function VJ(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function UJ(e,t,r){return r=r!=null?r.concat([e]):null,TI(4,4,VJ.bind(null,t,e),r)}function BB(){}function qJ(e,t){var r=Eu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&DB(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function GJ(e,t){var r=Eu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&DB(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function WJ(e,t,r){return Jy&21?(vd(r,t)||(r=YY(),ta.lanes|=r,Qy|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,sc=!0),e.memoizedState=r)}function iye(e,t){var r=us;us=r!==0&&4>r?r:4,e(!0);var n=LM.transition;LM.transition={};try{e(!1),t()}finally{us=r,LM.transition=n}}function HJ(){return Eu().memoizedState}function sye(e,t,r){var n=wm(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},ZJ(e))XJ(t,r);else if(r=PJ(e,t,r,n),r!==null){var a=zl();md(r,e,n,a),KJ(r,t,n)}}function aye(e,t,r){var n=wm(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(ZJ(e))XJ(t,a);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var p=t.lastRenderedState,s=d(p,r);if(a.hasEagerState=!0,a.eagerState=s,vd(s,p)){var _=t.interleaved;_===null?(a.next=a,IB(t)):(a.next=_.next,_.next=a),t.interleaved=a;return}}catch{}finally{}r=PJ(e,t,a,n),r!==null&&(a=zl(),md(r,e,n,a),KJ(r,t,n))}}function ZJ(e){var t=e.alternate;return e===ta||t!==null&&t===ta}function XJ(e,t){zS=EP=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function KJ(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,yB(e,r)}}var jP={readContext:Tu,useCallback:el,useContext:el,useEffect:el,useImperativeHandle:el,useInsertionEffect:el,useLayoutEffect:el,useMemo:el,useReducer:el,useRef:el,useState:el,useDebugValue:el,useDeferredValue:el,useTransition:el,useMutableSource:el,useSyncExternalStore:el,useId:el,unstable_isNewReconciler:!1},oye={readContext:Tu,useCallback:function(e,t){return ih().memoizedState=[e,t===void 0?null:t],e},useContext:Tu,useEffect:tG,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,GC(4194308,4,VJ.bind(null,t,e),r)},useLayoutEffect:function(e,t){return GC(4194308,4,e,t)},useInsertionEffect:function(e,t){return GC(4,2,e,t)},useMemo:function(e,t){var r=ih();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=ih();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=sye.bind(null,ta,e),[n.memoizedState,e]},useRef:function(e){var t=ih();return e={current:e},t.memoizedState=e},useState:eG,useDebugValue:BB,useDeferredValue:function(e){return ih().memoizedState=e},useTransition:function(){var e=eG(!1),t=e[0];return e=iye.bind(null,e[1]),ih().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=ta,a=ih();if(qs){if(r===void 0)throw Error(wr(407));r=r()}else{if(r=t(),_o===null)throw Error(wr(349));Jy&30||RJ(n,t,r)}a.memoizedState=r;var d={value:r,getSnapshot:t};return a.queue=d,tG(DJ.bind(null,n,d,e),[e]),n.flags|=2048,bT(9,MJ.bind(null,n,d,r,t),void 0,null),r},useId:function(){var e=ih(),t=_o.identifierPrefix;if(qs){var r=vf,n=yf;r=(n&~(1<<32-pd(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=_T++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=nye++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lye={readContext:Tu,useCallback:qJ,useContext:Tu,useEffect:zB,useImperativeHandle:UJ,useInsertionEffect:BJ,useLayoutEffect:$J,useMemo:GJ,useReducer:FM,useRef:zJ,useState:function(){return FM(xT)},useDebugValue:BB,useDeferredValue:function(e){var t=Eu();return WJ(t,Ja.memoizedState,e)},useTransition:function(){var e=FM(xT)[0],t=Eu().memoizedState;return[e,t]},useMutableSource:kJ,useSyncExternalStore:OJ,useId:HJ,unstable_isNewReconciler:!1},cye={readContext:Tu,useCallback:qJ,useContext:Tu,useEffect:zB,useImperativeHandle:UJ,useInsertionEffect:BJ,useLayoutEffect:$J,useMemo:GJ,useReducer:zM,useRef:zJ,useState:function(){return zM(xT)},useDebugValue:BB,useDeferredValue:function(e){var t=Eu();return Ja===null?t.memoizedState=e:WJ(t,Ja.memoizedState,e)},useTransition:function(){var e=zM(xT)[0],t=Eu().memoizedState;return[e,t]},useMutableSource:kJ,useSyncExternalStore:OJ,useId:HJ,unstable_isNewReconciler:!1};function td(e,t){if(e&&e.defaultProps){t=ra({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function $L(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ra({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var EI={isMounted:function(e){return(e=e._reactInternals)?vv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=zl(),a=wm(e),d=Sf(n,a);d.payload=t,r!=null&&(d.callback=r),t=xm(e,d,a),t!==null&&(md(t,e,a,n),UC(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=zl(),a=wm(e),d=Sf(n,a);d.tag=1,d.payload=t,r!=null&&(d.callback=r),t=xm(e,d,a),t!==null&&(md(t,e,a,n),UC(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=zl(),n=wm(e),a=Sf(r,n);a.tag=2,t!=null&&(a.callback=t),t=xm(e,a,n),t!==null&&(md(t,e,n,r),UC(t,e,n))}};function rG(e,t,r,n,a,d,p){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,d,p):t.prototype&&t.prototype.isPureReactComponent?!fT(r,n)||!fT(a,d):!0}function YJ(e,t,r){var n=!1,a=Pm,d=t.contextType;return typeof d=="object"&&d!==null?d=Tu(d):(a=lc(t)?Ky:cl.current,n=t.contextTypes,d=(n=n!=null)?g0(e,a):Pm),t=new t(r,d),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=EI,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=d),t}function nG(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&EI.enqueueReplaceState(t,t.state,null)}function VL(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},kB(e);var d=t.contextType;typeof d=="object"&&d!==null?a.context=Tu(d):(d=lc(t)?Ky:cl.current,a.context=g0(e,d)),a.state=e.memoizedState,d=t.getDerivedStateFromProps,typeof d=="function"&&($L(e,t,d,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&EI.enqueueReplaceState(a,a.state,null),SP(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function x0(e,t){try{var r="",n=t;do r+=Lme(n),n=n.return;while(n);var a=r}catch(d){a=`
Error generating stack: `+d.message+`
`+d.stack}return{value:e,source:t,stack:a,digest:null}}function BM(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function UL(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var uye=typeof WeakMap=="function"?WeakMap:Map;function JJ(e,t,r){r=Sf(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){CP||(CP=!0,QL=n),UL(e,t)},r}function QJ(e,t,r){r=Sf(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){UL(e,t)}}var d=e.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){UL(e,t),typeof n!="function"&&(bm===null?bm=new Set([this]):bm.add(this));var p=t.stack;this.componentDidCatch(t.value,{componentStack:p!==null?p:""})}),r}function iG(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new uye;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=Tye.bind(null,e,t,r),t.then(e,e))}function sG(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function aG(e,t,r,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Sf(-1,1),t.tag=2,xm(r,t,1))),r.lanes|=1),e)}var dye=Uf.ReactCurrentOwner,sc=!1;function kl(e,t,r,n){t.child=e===null?CJ(t,null,r,n):v0(t,e.child,r,n)}function oG(e,t,r,n,a){r=r.render;var d=t.ref;return qx(t,a),n=LB(e,t,r,n,d,a),r=FB(),e!==null&&!sc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,If(e,t,a)):(qs&&r&&EB(t),t.flags|=1,kl(e,t,n,a),t.child)}function lG(e,t,r,n,a){if(e===null){var d=r.type;return typeof d=="function"&&!ZB(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=d,eQ(e,t,d,n,a)):(e=XC(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!(e.lanes&a)){var p=d.memoizedProps;if(r=r.compare,r=r!==null?r:fT,r(p,n)&&e.ref===t.ref)return If(e,t,a)}return t.flags|=1,e=Sm(d,n),e.ref=t.ref,e.return=t,t.child=e}function eQ(e,t,r,n,a){if(e!==null){var d=e.memoizedProps;if(fT(d,n)&&e.ref===t.ref)if(sc=!1,t.pendingProps=n=d,(e.lanes&a)!==0)e.flags&131072&&(sc=!0);else return t.lanes=e.lanes,If(e,t,a)}return qL(e,t,r,n,a)}function tQ(e,t,r){var n=t.pendingProps,a=n.children,d=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ts(Px,Ec),Ec|=r;else{if(!(r&1073741824))return e=d!==null?d.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ts(Px,Ec),Ec|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=d!==null?d.baseLanes:r,Ts(Px,Ec),Ec|=n}else d!==null?(n=d.baseLanes|r,t.memoizedState=null):n=r,Ts(Px,Ec),Ec|=n;return kl(e,t,a,r),t.child}function rQ(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function qL(e,t,r,n,a){var d=lc(r)?Ky:cl.current;return d=g0(t,d),qx(t,a),r=LB(e,t,r,n,d,a),n=FB(),e!==null&&!sc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,If(e,t,a)):(qs&&n&&EB(t),t.flags|=1,kl(e,t,r,a),t.child)}function cG(e,t,r,n,a){if(lc(r)){var d=!0;vP(t)}else d=!1;if(qx(t,a),t.stateNode===null)WC(e,t),YJ(t,r,n),VL(t,r,n,a),n=!0;else if(e===null){var p=t.stateNode,s=t.memoizedProps;p.props=s;var _=p.context,b=r.contextType;typeof b=="object"&&b!==null?b=Tu(b):(b=lc(r)?Ky:cl.current,b=g0(t,b));var T=r.getDerivedStateFromProps,C=typeof T=="function"||typeof p.getSnapshotBeforeUpdate=="function";C||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(s!==n||_!==b)&&nG(t,p,n,b),Hp=!1;var P=t.memoizedState;p.state=P,SP(t,n,p,a),_=t.memoizedState,s!==n||P!==_||oc.current||Hp?(typeof T=="function"&&($L(t,r,T,n),_=t.memoizedState),(s=Hp||rG(t,r,s,n,P,_,b))?(C||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(t.flags|=4194308)):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=_),p.props=n,p.state=_,p.context=b,n=s):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{p=t.stateNode,NJ(e,t),s=t.memoizedProps,b=t.type===t.elementType?s:td(t.type,s),p.props=b,C=t.pendingProps,P=p.context,_=r.contextType,typeof _=="object"&&_!==null?_=Tu(_):(_=lc(r)?Ky:cl.current,_=g0(t,_));var k=r.getDerivedStateFromProps;(T=typeof k=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(s!==C||P!==_)&&nG(t,p,n,_),Hp=!1,P=t.memoizedState,p.state=P,SP(t,n,p,a);var B=t.memoizedState;s!==C||P!==B||oc.current||Hp?(typeof k=="function"&&($L(t,r,k,n),B=t.memoizedState),(b=Hp||rG(t,r,b,n,P,B,_)||!1)?(T||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(n,B,_),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(n,B,_)),typeof p.componentDidUpdate=="function"&&(t.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof p.componentDidUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=B),p.props=n,p.state=B,p.context=_,n=b):(typeof p.componentDidUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),n=!1)}return GL(e,t,r,n,d,a)}function GL(e,t,r,n,a,d){rQ(e,t);var p=(t.flags&128)!==0;if(!n&&!p)return a&&Zq(t,r,!1),If(e,t,d);n=t.stateNode,dye.current=t;var s=p&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&p?(t.child=v0(t,e.child,null,d),t.child=v0(t,null,s,d)):kl(e,t,s,d),t.memoizedState=n.state,a&&Zq(t,r,!0),t.child}function nQ(e){var t=e.stateNode;t.pendingContext?Hq(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Hq(e,t.context,!1),OB(e,t.containerInfo)}function uG(e,t,r,n,a){return y0(),AB(a),t.flags|=256,kl(e,t,r,n),t.child}var WL={dehydrated:null,treeContext:null,retryLane:0};function HL(e){return{baseLanes:e,cachePool:null,transitions:null}}function iQ(e,t,r){var n=t.pendingProps,a=Qs.current,d=!1,p=(t.flags&128)!==0,s;if((s=p)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(d=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Ts(Qs,a&1),e===null)return zL(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(p=n.children,e=n.fallback,d?(n=t.mode,d=t.child,p={mode:"hidden",children:p},!(n&1)&&d!==null?(d.childLanes=0,d.pendingProps=p):d=CI(p,n,0,null),e=Gy(e,n,r,null),d.return=t,e.return=t,d.sibling=e,t.child=d,t.child.memoizedState=HL(r),t.memoizedState=WL,e):$B(t,p));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return hye(e,t,p,n,s,a,r);if(d){d=n.fallback,p=t.mode,a=e.child,s=a.sibling;var _={mode:"hidden",children:n.children};return!(p&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=_,t.deletions=null):(n=Sm(a,_),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?d=Sm(s,d):(d=Gy(d,p,r,null),d.flags|=2),d.return=t,n.return=t,n.sibling=d,t.child=n,n=d,d=t.child,p=e.child.memoizedState,p=p===null?HL(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},d.memoizedState=p,d.childLanes=e.childLanes&~r,t.memoizedState=WL,n}return d=e.child,e=d.sibling,n=Sm(d,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function $B(e,t){return t=CI({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function tC(e,t,r,n){return n!==null&&AB(n),v0(t,e.child,null,r),e=$B(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function hye(e,t,r,n,a,d,p){if(r)return t.flags&256?(t.flags&=-257,n=BM(Error(wr(422))),tC(e,t,p,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(d=n.fallback,a=t.mode,n=CI({mode:"visible",children:n.children},a,0,null),d=Gy(d,a,p,null),d.flags|=2,n.return=t,d.return=t,n.sibling=d,t.child=n,t.mode&1&&v0(t,e.child,null,p),t.child.memoizedState=HL(p),t.memoizedState=WL,d);if(!(t.mode&1))return tC(e,t,p,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,d=Error(wr(419)),n=BM(d,n,void 0),tC(e,t,p,n)}if(s=(p&e.childLanes)!==0,sc||s){if(n=_o,n!==null){switch(p&-p){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|p)?0:a,a!==0&&a!==d.retryLane&&(d.retryLane=a,Nf(e,a),md(n,e,a,-1))}return HB(),n=BM(Error(wr(421))),tC(e,t,p,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Eye.bind(null,e),a._reactRetry=t,null):(e=d.treeContext,kc=_m(a.nextSibling),Oc=t,qs=!0,cd=null,e!==null&&(mu[gu++]=yf,mu[gu++]=vf,mu[gu++]=Yy,yf=e.id,vf=e.overflow,Yy=t),t=$B(t,n.children),t.flags|=4096,t)}function dG(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),BL(e.return,t,r)}function $M(e,t,r,n,a){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=r,d.tailMode=a)}function sQ(e,t,r){var n=t.pendingProps,a=n.revealOrder,d=n.tail;if(kl(e,t,n.children,r),n=Qs.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&dG(e,r,t);else if(e.tag===19)dG(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ts(Qs,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&TP(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),$M(t,!1,a,r,d);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&TP(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}$M(t,!0,r,null,d);break;case"together":$M(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function WC(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function If(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Qy|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(wr(153));if(t.child!==null){for(e=t.child,r=Sm(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Sm(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function fye(e,t,r){switch(t.tag){case 3:nQ(t),y0();break;case 5:IJ(t);break;case 1:lc(t.type)&&vP(t);break;case 4:OB(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Ts(bP,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Ts(Qs,Qs.current&1),t.flags|=128,null):r&t.child.childLanes?iQ(e,t,r):(Ts(Qs,Qs.current&1),e=If(e,t,r),e!==null?e.sibling:null);Ts(Qs,Qs.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return sQ(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ts(Qs,Qs.current),n)break;return null;case 22:case 23:return t.lanes=0,tQ(e,t,r)}return If(e,t,r)}var aQ,ZL,oQ,lQ;aQ=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};ZL=function(){};oQ=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,Sy(_h.current);var d=null;switch(r){case"input":a=gL(e,a),n=gL(e,n),d=[];break;case"select":a=ra({},a,{value:void 0}),n=ra({},n,{value:void 0}),d=[];break;case"textarea":a=_L(e,a),n=_L(e,n),d=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=gP)}bL(r,n);var p;r=null;for(b in a)if(!n.hasOwnProperty(b)&&a.hasOwnProperty(b)&&a[b]!=null)if(b==="style"){var s=a[b];for(p in s)s.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else b!=="dangerouslySetInnerHTML"&&b!=="children"&&b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(aT.hasOwnProperty(b)?d||(d=[]):(d=d||[]).push(b,null));for(b in n){var _=n[b];if(s=a!=null?a[b]:void 0,n.hasOwnProperty(b)&&_!==s&&(_!=null||s!=null))if(b==="style")if(s){for(p in s)!s.hasOwnProperty(p)||_&&_.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in _)_.hasOwnProperty(p)&&s[p]!==_[p]&&(r||(r={}),r[p]=_[p])}else r||(d||(d=[]),d.push(b,r)),r=_;else b==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,s=s?s.__html:void 0,_!=null&&s!==_&&(d=d||[]).push(b,_)):b==="children"?typeof _!="string"&&typeof _!="number"||(d=d||[]).push(b,""+_):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&(aT.hasOwnProperty(b)?(_!=null&&b==="onScroll"&&Ms("scroll",e),d||s===_||(d=[])):(d=d||[]).push(b,_))}r&&(d=d||[]).push("style",r);var b=d;(t.updateQueue=b)&&(t.flags|=4)}};lQ=function(e,t,r,n){r!==n&&(t.flags|=4)};function Q1(e,t){if(!qs)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function tl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function pye(e,t,r){var n=t.pendingProps;switch(jB(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tl(t),null;case 1:return lc(t.type)&&yP(),tl(t),null;case 3:return n=t.stateNode,_0(),Fs(oc),Fs(cl),MB(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(QA(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,cd!==null&&(r3(cd),cd=null))),ZL(e,t),tl(t),null;case 5:RB(t);var a=Sy(vT.current);if(r=t.type,e!==null&&t.stateNode!=null)oQ(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(wr(166));return tl(t),null}if(e=Sy(_h.current),QA(t)){n=t.stateNode,r=t.type;var d=t.memoizedProps;switch(n[uh]=t,n[gT]=d,e=(t.mode&1)!==0,r){case"dialog":Ms("cancel",n),Ms("close",n);break;case"iframe":case"object":case"embed":Ms("load",n);break;case"video":case"audio":for(a=0;a<xS.length;a++)Ms(xS[a],n);break;case"source":Ms("error",n);break;case"img":case"image":case"link":Ms("error",n),Ms("load",n);break;case"details":Ms("toggle",n);break;case"input":xq(n,d),Ms("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!d.multiple},Ms("invalid",n);break;case"textarea":wq(n,d),Ms("invalid",n)}bL(r,d),a=null;for(var p in d)if(d.hasOwnProperty(p)){var s=d[p];p==="children"?typeof s=="string"?n.textContent!==s&&(d.suppressHydrationWarning!==!0&&JA(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(d.suppressHydrationWarning!==!0&&JA(n.textContent,s,e),a=["children",""+s]):aT.hasOwnProperty(p)&&s!=null&&p==="onScroll"&&Ms("scroll",n)}switch(r){case"input":qA(n),bq(n,d,!0);break;case"textarea":qA(n),Sq(n);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(n.onclick=gP)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{p=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=DY(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=p.createElement(r,{is:n.is}):(e=p.createElement(r),r==="select"&&(p=e,n.multiple?p.multiple=!0:n.size&&(p.size=n.size))):e=p.createElementNS(e,r),e[uh]=t,e[gT]=n,aQ(e,t,!1,!1),t.stateNode=e;e:{switch(p=wL(r,n),r){case"dialog":Ms("cancel",e),Ms("close",e),a=n;break;case"iframe":case"object":case"embed":Ms("load",e),a=n;break;case"video":case"audio":for(a=0;a<xS.length;a++)Ms(xS[a],e);a=n;break;case"source":Ms("error",e),a=n;break;case"img":case"image":case"link":Ms("error",e),Ms("load",e),a=n;break;case"details":Ms("toggle",e),a=n;break;case"input":xq(e,n),a=gL(e,n),Ms("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=ra({},n,{value:void 0}),Ms("invalid",e);break;case"textarea":wq(e,n),a=_L(e,n),Ms("invalid",e);break;default:a=n}bL(r,a),s=a;for(d in s)if(s.hasOwnProperty(d)){var _=s[d];d==="style"?zY(e,_):d==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&LY(e,_)):d==="children"?typeof _=="string"?(r!=="textarea"||_!=="")&&oT(e,_):typeof _=="number"&&oT(e,""+_):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(aT.hasOwnProperty(d)?_!=null&&d==="onScroll"&&Ms("scroll",e):_!=null&&dB(e,d,_,p))}switch(r){case"input":qA(e),bq(e,n,!1);break;case"textarea":qA(e),Sq(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Cm(n.value));break;case"select":e.multiple=!!n.multiple,d=n.value,d!=null?Bx(e,!!n.multiple,d,!1):n.defaultValue!=null&&Bx(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=gP)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return tl(t),null;case 6:if(e&&t.stateNode!=null)lQ(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(wr(166));if(r=Sy(vT.current),Sy(_h.current),QA(t)){if(n=t.stateNode,r=t.memoizedProps,n[uh]=t,(d=n.nodeValue!==r)&&(e=Oc,e!==null))switch(e.tag){case 3:JA(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&JA(n.nodeValue,r,(e.mode&1)!==0)}d&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[uh]=t,t.stateNode=n}return tl(t),null;case 13:if(Fs(Qs),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(qs&&kc!==null&&t.mode&1&&!(t.flags&128))jJ(),y0(),t.flags|=98560,d=!1;else if(d=QA(t),n!==null&&n.dehydrated!==null){if(e===null){if(!d)throw Error(wr(318));if(d=t.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(wr(317));d[uh]=t}else y0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;tl(t),d=!1}else cd!==null&&(r3(cd),cd=null),d=!0;if(!d)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Qs.current&1?eo===0&&(eo=3):HB())),t.updateQueue!==null&&(t.flags|=4),tl(t),null);case 4:return _0(),ZL(e,t),e===null&&pT(t.stateNode.containerInfo),tl(t),null;case 10:return NB(t.type._context),tl(t),null;case 17:return lc(t.type)&&yP(),tl(t),null;case 19:if(Fs(Qs),d=t.memoizedState,d===null)return tl(t),null;if(n=(t.flags&128)!==0,p=d.rendering,p===null)if(n)Q1(d,!1);else{if(eo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(p=TP(e),p!==null){for(t.flags|=128,Q1(d,!1),n=p.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)d=r,e=n,d.flags&=14680066,p=d.alternate,p===null?(d.childLanes=0,d.lanes=e,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=p.childLanes,d.lanes=p.lanes,d.child=p.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=p.memoizedProps,d.memoizedState=p.memoizedState,d.updateQueue=p.updateQueue,d.type=p.type,e=p.dependencies,d.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ts(Qs,Qs.current&1|2),t.child}e=e.sibling}d.tail!==null&&xa()>b0&&(t.flags|=128,n=!0,Q1(d,!1),t.lanes=4194304)}else{if(!n)if(e=TP(p),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Q1(d,!0),d.tail===null&&d.tailMode==="hidden"&&!p.alternate&&!qs)return tl(t),null}else 2*xa()-d.renderingStartTime>b0&&r!==1073741824&&(t.flags|=128,n=!0,Q1(d,!1),t.lanes=4194304);d.isBackwards?(p.sibling=t.child,t.child=p):(r=d.last,r!==null?r.sibling=p:t.child=p,d.last=p)}return d.tail!==null?(t=d.tail,d.rendering=t,d.tail=t.sibling,d.renderingStartTime=xa(),t.sibling=null,r=Qs.current,Ts(Qs,n?r&1|2:r&1),t):(tl(t),null);case 22:case 23:return WB(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Ec&1073741824&&(tl(t),t.subtreeFlags&6&&(t.flags|=8192)):tl(t),null;case 24:return null;case 25:return null}throw Error(wr(156,t.tag))}function mye(e,t){switch(jB(t),t.tag){case 1:return lc(t.type)&&yP(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return _0(),Fs(oc),Fs(cl),MB(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return RB(t),null;case 13:if(Fs(Qs),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(wr(340));y0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Fs(Qs),null;case 4:return _0(),null;case 10:return NB(t.type._context),null;case 22:case 23:return WB(),null;case 24:return null;default:return null}}var rC=!1,sl=!1,gye=typeof WeakSet=="function"?WeakSet:Set,Yr=null;function Cx(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){pa(e,t,n)}else r.current=null}function XL(e,t,r){try{r()}catch(n){pa(e,t,n)}}var hG=!1;function yye(e,t){if(kL=fP,e=fJ(),TB(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var p=0,s=-1,_=-1,b=0,T=0,C=e,P=null;t:for(;;){for(var k;C!==r||a!==0&&C.nodeType!==3||(s=p+a),C!==d||n!==0&&C.nodeType!==3||(_=p+n),C.nodeType===3&&(p+=C.nodeValue.length),(k=C.firstChild)!==null;)P=C,C=k;for(;;){if(C===e)break t;if(P===r&&++b===a&&(s=p),P===d&&++T===n&&(_=p),(k=C.nextSibling)!==null)break;C=P,P=C.parentNode}C=k}r=s===-1||_===-1?null:{start:s,end:_}}else r=null}r=r||{start:0,end:0}}else r=null;for(OL={focusedElem:e,selectionRange:r},fP=!1,Yr=t;Yr!==null;)if(t=Yr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Yr=e;else for(;Yr!==null;){t=Yr;try{var B=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var R=B.memoizedProps,D=B.memoizedState,G=t.stateNode,V=G.getSnapshotBeforeUpdate(t.elementType===t.type?R:td(t.type,R),D);G.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var $=t.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(wr(163))}}catch(K){pa(t,t.return,K)}if(e=t.sibling,e!==null){e.return=t.return,Yr=e;break}Yr=t.return}return B=hG,hG=!1,B}function BS(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var d=a.destroy;a.destroy=void 0,d!==void 0&&XL(t,r,d)}a=a.next}while(a!==n)}}function jI(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function KL(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function cQ(e){var t=e.alternate;t!==null&&(e.alternate=null,cQ(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[uh],delete t[gT],delete t[DL],delete t[Qge],delete t[eye])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function uQ(e){return e.tag===5||e.tag===3||e.tag===4}function fG(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||uQ(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function YL(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=gP));else if(n!==4&&(e=e.child,e!==null))for(YL(e,t,r),e=e.sibling;e!==null;)YL(e,t,r),e=e.sibling}function JL(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(JL(e,t,r),e=e.sibling;e!==null;)JL(e,t,r),e=e.sibling}var Do=null,sd=!1;function Lp(e,t,r){for(r=r.child;r!==null;)dQ(e,t,r),r=r.sibling}function dQ(e,t,r){if(vh&&typeof vh.onCommitFiberUnmount=="function")try{vh.onCommitFiberUnmount(vI,r)}catch{}switch(r.tag){case 5:sl||Cx(r,t);case 6:var n=Do,a=sd;Do=null,Lp(e,t,r),Do=n,sd=a,Do!==null&&(sd?(e=Do,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Do.removeChild(r.stateNode));break;case 18:Do!==null&&(sd?(e=Do,r=r.stateNode,e.nodeType===8?RM(e.parentNode,r):e.nodeType===1&&RM(e,r),dT(e)):RM(Do,r.stateNode));break;case 4:n=Do,a=sd,Do=r.stateNode.containerInfo,sd=!0,Lp(e,t,r),Do=n,sd=a;break;case 0:case 11:case 14:case 15:if(!sl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var d=a,p=d.destroy;d=d.tag,p!==void 0&&(d&2||d&4)&&XL(r,t,p),a=a.next}while(a!==n)}Lp(e,t,r);break;case 1:if(!sl&&(Cx(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){pa(r,t,s)}Lp(e,t,r);break;case 21:Lp(e,t,r);break;case 22:r.mode&1?(sl=(n=sl)||r.memoizedState!==null,Lp(e,t,r),sl=n):Lp(e,t,r);break;default:Lp(e,t,r)}}function pG(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new gye),t.forEach(function(n){var a=jye.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function Zu(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var d=e,p=t,s=p;e:for(;s!==null;){switch(s.tag){case 5:Do=s.stateNode,sd=!1;break e;case 3:Do=s.stateNode.containerInfo,sd=!0;break e;case 4:Do=s.stateNode.containerInfo,sd=!0;break e}s=s.return}if(Do===null)throw Error(wr(160));dQ(d,p,a),Do=null,sd=!1;var _=a.alternate;_!==null&&(_.return=null),a.return=null}catch(b){pa(a,t,b)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)hQ(t,e),t=t.sibling}function hQ(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Zu(t,e),rh(e),n&4){try{BS(3,e,e.return),jI(3,e)}catch(R){pa(e,e.return,R)}try{BS(5,e,e.return)}catch(R){pa(e,e.return,R)}}break;case 1:Zu(t,e),rh(e),n&512&&r!==null&&Cx(r,r.return);break;case 5:if(Zu(t,e),rh(e),n&512&&r!==null&&Cx(r,r.return),e.flags&32){var a=e.stateNode;try{oT(a,"")}catch(R){pa(e,e.return,R)}}if(n&4&&(a=e.stateNode,a!=null)){var d=e.memoizedProps,p=r!==null?r.memoizedProps:d,s=e.type,_=e.updateQueue;if(e.updateQueue=null,_!==null)try{s==="input"&&d.type==="radio"&&d.name!=null&&RY(a,d),wL(s,p);var b=wL(s,d);for(p=0;p<_.length;p+=2){var T=_[p],C=_[p+1];T==="style"?zY(a,C):T==="dangerouslySetInnerHTML"?LY(a,C):T==="children"?oT(a,C):dB(a,T,C,b)}switch(s){case"input":yL(a,d);break;case"textarea":MY(a,d);break;case"select":var P=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!d.multiple;var k=d.value;k!=null?Bx(a,!!d.multiple,k,!1):P!==!!d.multiple&&(d.defaultValue!=null?Bx(a,!!d.multiple,d.defaultValue,!0):Bx(a,!!d.multiple,d.multiple?[]:"",!1))}a[gT]=d}catch(R){pa(e,e.return,R)}}break;case 6:if(Zu(t,e),rh(e),n&4){if(e.stateNode===null)throw Error(wr(162));a=e.stateNode,d=e.memoizedProps;try{a.nodeValue=d}catch(R){pa(e,e.return,R)}}break;case 3:if(Zu(t,e),rh(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{dT(t.containerInfo)}catch(R){pa(e,e.return,R)}break;case 4:Zu(t,e),rh(e);break;case 13:Zu(t,e),rh(e),a=e.child,a.flags&8192&&(d=a.memoizedState!==null,a.stateNode.isHidden=d,!d||a.alternate!==null&&a.alternate.memoizedState!==null||(qB=xa())),n&4&&pG(e);break;case 22:if(T=r!==null&&r.memoizedState!==null,e.mode&1?(sl=(b=sl)||T,Zu(t,e),sl=b):Zu(t,e),rh(e),n&8192){if(b=e.memoizedState!==null,(e.stateNode.isHidden=b)&&!T&&e.mode&1)for(Yr=e,T=e.child;T!==null;){for(C=Yr=T;Yr!==null;){switch(P=Yr,k=P.child,P.tag){case 0:case 11:case 14:case 15:BS(4,P,P.return);break;case 1:Cx(P,P.return);var B=P.stateNode;if(typeof B.componentWillUnmount=="function"){n=P,r=P.return;try{t=n,B.props=t.memoizedProps,B.state=t.memoizedState,B.componentWillUnmount()}catch(R){pa(n,r,R)}}break;case 5:Cx(P,P.return);break;case 22:if(P.memoizedState!==null){gG(C);continue}}k!==null?(k.return=P,Yr=k):gG(C)}T=T.sibling}e:for(T=null,C=e;;){if(C.tag===5){if(T===null){T=C;try{a=C.stateNode,b?(d=a.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(s=C.stateNode,_=C.memoizedProps.style,p=_!=null&&_.hasOwnProperty("display")?_.display:null,s.style.display=FY("display",p))}catch(R){pa(e,e.return,R)}}}else if(C.tag===6){if(T===null)try{C.stateNode.nodeValue=b?"":C.memoizedProps}catch(R){pa(e,e.return,R)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;T===C&&(T=null),C=C.return}T===C&&(T=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Zu(t,e),rh(e),n&4&&pG(e);break;case 21:break;default:Zu(t,e),rh(e)}}function rh(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(uQ(r)){var n=r;break e}r=r.return}throw Error(wr(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(oT(a,""),n.flags&=-33);var d=fG(e);JL(e,d,a);break;case 3:case 4:var p=n.stateNode.containerInfo,s=fG(e);YL(e,s,p);break;default:throw Error(wr(161))}}catch(_){pa(e,e.return,_)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function vye(e,t,r){Yr=e,fQ(e)}function fQ(e,t,r){for(var n=(e.mode&1)!==0;Yr!==null;){var a=Yr,d=a.child;if(a.tag===22&&n){var p=a.memoizedState!==null||rC;if(!p){var s=a.alternate,_=s!==null&&s.memoizedState!==null||sl;s=rC;var b=sl;if(rC=p,(sl=_)&&!b)for(Yr=a;Yr!==null;)p=Yr,_=p.child,p.tag===22&&p.memoizedState!==null?yG(a):_!==null?(_.return=p,Yr=_):yG(a);for(;d!==null;)Yr=d,fQ(d),d=d.sibling;Yr=a,rC=s,sl=b}mG(e)}else a.subtreeFlags&8772&&d!==null?(d.return=a,Yr=d):mG(e)}}function mG(e){for(;Yr!==null;){var t=Yr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:sl||jI(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!sl)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:td(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var d=t.updateQueue;d!==null&&Qq(t,d,n);break;case 3:var p=t.updateQueue;if(p!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Qq(t,p,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var _=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&r.focus();break;case"img":_.src&&(r.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var b=t.alternate;if(b!==null){var T=b.memoizedState;if(T!==null){var C=T.dehydrated;C!==null&&dT(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(wr(163))}sl||t.flags&512&&KL(t)}catch(P){pa(t,t.return,P)}}if(t===e){Yr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Yr=r;break}Yr=t.return}}function gG(e){for(;Yr!==null;){var t=Yr;if(t===e){Yr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Yr=r;break}Yr=t.return}}function yG(e){for(;Yr!==null;){var t=Yr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{jI(4,t)}catch(_){pa(t,r,_)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(_){pa(t,a,_)}}var d=t.return;try{KL(t)}catch(_){pa(t,d,_)}break;case 5:var p=t.return;try{KL(t)}catch(_){pa(t,p,_)}}}catch(_){pa(t,t.return,_)}if(t===e){Yr=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Yr=s;break}Yr=t.return}}var _ye=Math.ceil,AP=Uf.ReactCurrentDispatcher,VB=Uf.ReactCurrentOwner,bu=Uf.ReactCurrentBatchConfig,Fi=0,_o=null,Ra=null,Bo=0,Ec=0,Px=qm(0),eo=0,wT=null,Qy=0,AI=0,UB=0,$S=null,ic=null,qB=0,b0=1/0,df=null,CP=!1,QL=null,bm=null,nC=!1,um=null,PP=0,VS=0,e3=null,HC=-1,ZC=0;function zl(){return Fi&6?xa():HC!==-1?HC:HC=xa()}function wm(e){return e.mode&1?Fi&2&&Bo!==0?Bo&-Bo:rye.transition!==null?(ZC===0&&(ZC=YY()),ZC):(e=us,e!==0||(e=window.event,e=e===void 0?16:iJ(e.type)),e):1}function md(e,t,r,n){if(50<VS)throw VS=0,e3=null,Error(wr(185));O2(e,r,n),(!(Fi&2)||e!==_o)&&(e===_o&&(!(Fi&2)&&(AI|=r),eo===4&&Jp(e,Bo)),cc(e,n),r===1&&Fi===0&&!(t.mode&1)&&(b0=xa()+500,SI&&Gm()))}function cc(e,t){var r=e.callbackNode;rge(e,t);var n=hP(e,e===_o?Bo:0);if(n===0)r!==null&&jq(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&jq(r),t===1)e.tag===0?tye(vG.bind(null,e)):SJ(vG.bind(null,e)),Yge(function(){!(Fi&6)&&Gm()}),r=null;else{switch(JY(n)){case 1:r=gB;break;case 4:r=XY;break;case 16:r=dP;break;case 536870912:r=KY;break;default:r=dP}r=bQ(r,pQ.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function pQ(e,t){if(HC=-1,ZC=0,Fi&6)throw Error(wr(327));var r=e.callbackNode;if(Gx()&&e.callbackNode!==r)return null;var n=hP(e,e===_o?Bo:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=NP(e,n);else{t=n;var a=Fi;Fi|=2;var d=gQ();(_o!==e||Bo!==t)&&(df=null,b0=xa()+500,qy(e,t));do try{wye();break}catch(s){mQ(e,s)}while(!0);PB(),AP.current=d,Fi=a,Ra!==null?t=0:(_o=null,Bo=0,t=eo)}if(t!==0){if(t===2&&(a=AL(e),a!==0&&(n=a,t=t3(e,a))),t===1)throw r=wT,qy(e,0),Jp(e,n),cc(e,xa()),r;if(t===6)Jp(e,n);else{if(a=e.current.alternate,!(n&30)&&!xye(a)&&(t=NP(e,n),t===2&&(d=AL(e),d!==0&&(n=d,t=t3(e,d))),t===1))throw r=wT,qy(e,0),Jp(e,n),cc(e,xa()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(wr(345));case 2:dy(e,ic,df);break;case 3:if(Jp(e,n),(n&130023424)===n&&(t=qB+500-xa(),10<t)){if(hP(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){zl(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ML(dy.bind(null,e,ic,df),t);break}dy(e,ic,df);break;case 4:if(Jp(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var p=31-pd(n);d=1<<p,p=t[p],p>a&&(a=p),n&=~d}if(n=a,n=xa()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*_ye(n/1960))-n,10<n){e.timeoutHandle=ML(dy.bind(null,e,ic,df),n);break}dy(e,ic,df);break;case 5:dy(e,ic,df);break;default:throw Error(wr(329))}}}return cc(e,xa()),e.callbackNode===r?pQ.bind(null,e):null}function t3(e,t){var r=$S;return e.current.memoizedState.isDehydrated&&(qy(e,t).flags|=256),e=NP(e,t),e!==2&&(t=ic,ic=r,t!==null&&r3(t)),e}function r3(e){ic===null?ic=e:ic.push.apply(ic,e)}function xye(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],d=a.getSnapshot;a=a.value;try{if(!vd(d(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Jp(e,t){for(t&=~UB,t&=~AI,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-pd(t),n=1<<r;e[r]=-1,t&=~n}}function vG(e){if(Fi&6)throw Error(wr(327));Gx();var t=hP(e,0);if(!(t&1))return cc(e,xa()),null;var r=NP(e,t);if(e.tag!==0&&r===2){var n=AL(e);n!==0&&(t=n,r=t3(e,n))}if(r===1)throw r=wT,qy(e,0),Jp(e,t),cc(e,xa()),r;if(r===6)throw Error(wr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,dy(e,ic,df),cc(e,xa()),null}function GB(e,t){var r=Fi;Fi|=1;try{return e(t)}finally{Fi=r,Fi===0&&(b0=xa()+500,SI&&Gm())}}function ev(e){um!==null&&um.tag===0&&!(Fi&6)&&Gx();var t=Fi;Fi|=1;var r=bu.transition,n=us;try{if(bu.transition=null,us=1,e)return e()}finally{us=n,bu.transition=r,Fi=t,!(Fi&6)&&Gm()}}function WB(){Ec=Px.current,Fs(Px)}function qy(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Kge(r)),Ra!==null)for(r=Ra.return;r!==null;){var n=r;switch(jB(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&yP();break;case 3:_0(),Fs(oc),Fs(cl),MB();break;case 5:RB(n);break;case 4:_0();break;case 13:Fs(Qs);break;case 19:Fs(Qs);break;case 10:NB(n.type._context);break;case 22:case 23:WB()}r=r.return}if(_o=e,Ra=e=Sm(e.current,null),Bo=Ec=t,eo=0,wT=null,UB=AI=Qy=0,ic=$S=null,wy!==null){for(t=0;t<wy.length;t++)if(r=wy[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,d=r.pending;if(d!==null){var p=d.next;d.next=a,n.next=p}r.pending=n}wy=null}return e}function mQ(e,t){do{var r=Ra;try{if(PB(),qC.current=jP,EP){for(var n=ta.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}EP=!1}if(Jy=0,yo=Ja=ta=null,zS=!1,_T=0,VB.current=null,r===null||r.return===null){eo=1,wT=t,Ra=null;break}e:{var d=e,p=r.return,s=r,_=t;if(t=Bo,s.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var b=_,T=s,C=T.tag;if(!(T.mode&1)&&(C===0||C===11||C===15)){var P=T.alternate;P?(T.updateQueue=P.updateQueue,T.memoizedState=P.memoizedState,T.lanes=P.lanes):(T.updateQueue=null,T.memoizedState=null)}var k=sG(p);if(k!==null){k.flags&=-257,aG(k,p,s,d,t),k.mode&1&&iG(d,b,t),t=k,_=b;var B=t.updateQueue;if(B===null){var R=new Set;R.add(_),t.updateQueue=R}else B.add(_);break e}else{if(!(t&1)){iG(d,b,t),HB();break e}_=Error(wr(426))}}else if(qs&&s.mode&1){var D=sG(p);if(D!==null){!(D.flags&65536)&&(D.flags|=256),aG(D,p,s,d,t),AB(x0(_,s));break e}}d=_=x0(_,s),eo!==4&&(eo=2),$S===null?$S=[d]:$S.push(d),d=p;do{switch(d.tag){case 3:d.flags|=65536,t&=-t,d.lanes|=t;var G=JJ(d,_,t);Jq(d,G);break e;case 1:s=_;var V=d.type,$=d.stateNode;if(!(d.flags&128)&&(typeof V.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(bm===null||!bm.has($)))){d.flags|=65536,t&=-t,d.lanes|=t;var K=QJ(d,s,t);Jq(d,K);break e}}d=d.return}while(d!==null)}vQ(r)}catch(Y){t=Y,Ra===r&&r!==null&&(Ra=r=r.return);continue}break}while(!0)}function gQ(){var e=AP.current;return AP.current=jP,e===null?jP:e}function HB(){(eo===0||eo===3||eo===2)&&(eo=4),_o===null||!(Qy&268435455)&&!(AI&268435455)||Jp(_o,Bo)}function NP(e,t){var r=Fi;Fi|=2;var n=gQ();(_o!==e||Bo!==t)&&(df=null,qy(e,t));do try{bye();break}catch(a){mQ(e,a)}while(!0);if(PB(),Fi=r,AP.current=n,Ra!==null)throw Error(wr(261));return _o=null,Bo=0,eo}function bye(){for(;Ra!==null;)yQ(Ra)}function wye(){for(;Ra!==null&&!Hme();)yQ(Ra)}function yQ(e){var t=xQ(e.alternate,e,Ec);e.memoizedProps=e.pendingProps,t===null?vQ(e):Ra=t,VB.current=null}function vQ(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=mye(r,t),r!==null){r.flags&=32767,Ra=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{eo=6,Ra=null;return}}else if(r=pye(r,t,Ec),r!==null){Ra=r;return}if(t=t.sibling,t!==null){Ra=t;return}Ra=t=e}while(t!==null);eo===0&&(eo=5)}function dy(e,t,r){var n=us,a=bu.transition;try{bu.transition=null,us=1,Sye(e,t,r,n)}finally{bu.transition=a,us=n}return null}function Sye(e,t,r,n){do Gx();while(um!==null);if(Fi&6)throw Error(wr(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(wr(177));e.callbackNode=null,e.callbackPriority=0;var d=r.lanes|r.childLanes;if(nge(e,d),e===_o&&(Ra=_o=null,Bo=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||nC||(nC=!0,bQ(dP,function(){return Gx(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=bu.transition,bu.transition=null;var p=us;us=1;var s=Fi;Fi|=4,VB.current=null,yye(e,r),hQ(r,e),Uge(OL),fP=!!kL,OL=kL=null,e.current=r,vye(r),Zme(),Fi=s,us=p,bu.transition=d}else e.current=r;if(nC&&(nC=!1,um=e,PP=a),d=e.pendingLanes,d===0&&(bm=null),Yme(r.stateNode),cc(e,xa()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(CP)throw CP=!1,e=QL,QL=null,e;return PP&1&&e.tag!==0&&Gx(),d=e.pendingLanes,d&1?e===e3?VS++:(VS=0,e3=e):VS=0,Gm(),null}function Gx(){if(um!==null){var e=JY(PP),t=bu.transition,r=us;try{if(bu.transition=null,us=16>e?16:e,um===null)var n=!1;else{if(e=um,um=null,PP=0,Fi&6)throw Error(wr(331));var a=Fi;for(Fi|=4,Yr=e.current;Yr!==null;){var d=Yr,p=d.child;if(Yr.flags&16){var s=d.deletions;if(s!==null){for(var _=0;_<s.length;_++){var b=s[_];for(Yr=b;Yr!==null;){var T=Yr;switch(T.tag){case 0:case 11:case 15:BS(8,T,d)}var C=T.child;if(C!==null)C.return=T,Yr=C;else for(;Yr!==null;){T=Yr;var P=T.sibling,k=T.return;if(cQ(T),T===b){Yr=null;break}if(P!==null){P.return=k,Yr=P;break}Yr=k}}}var B=d.alternate;if(B!==null){var R=B.child;if(R!==null){B.child=null;do{var D=R.sibling;R.sibling=null,R=D}while(R!==null)}}Yr=d}}if(d.subtreeFlags&2064&&p!==null)p.return=d,Yr=p;else e:for(;Yr!==null;){if(d=Yr,d.flags&2048)switch(d.tag){case 0:case 11:case 15:BS(9,d,d.return)}var G=d.sibling;if(G!==null){G.return=d.return,Yr=G;break e}Yr=d.return}}var V=e.current;for(Yr=V;Yr!==null;){p=Yr;var $=p.child;if(p.subtreeFlags&2064&&$!==null)$.return=p,Yr=$;else e:for(p=V;Yr!==null;){if(s=Yr,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:jI(9,s)}}catch(Y){pa(s,s.return,Y)}if(s===p){Yr=null;break e}var K=s.sibling;if(K!==null){K.return=s.return,Yr=K;break e}Yr=s.return}}if(Fi=a,Gm(),vh&&typeof vh.onPostCommitFiberRoot=="function")try{vh.onPostCommitFiberRoot(vI,e)}catch{}n=!0}return n}finally{us=r,bu.transition=t}}return!1}function _G(e,t,r){t=x0(r,t),t=JJ(e,t,1),e=xm(e,t,1),t=zl(),e!==null&&(O2(e,1,t),cc(e,t))}function pa(e,t,r){if(e.tag===3)_G(e,e,r);else for(;t!==null;){if(t.tag===3){_G(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(bm===null||!bm.has(n))){e=x0(r,e),e=QJ(t,e,1),t=xm(t,e,1),e=zl(),t!==null&&(O2(t,1,e),cc(t,e));break}}t=t.return}}function Tye(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=zl(),e.pingedLanes|=e.suspendedLanes&r,_o===e&&(Bo&r)===r&&(eo===4||eo===3&&(Bo&130023424)===Bo&&500>xa()-qB?qy(e,0):UB|=r),cc(e,t)}function _Q(e,t){t===0&&(e.mode&1?(t=HA,HA<<=1,!(HA&130023424)&&(HA=4194304)):t=1);var r=zl();e=Nf(e,t),e!==null&&(O2(e,t,r),cc(e,r))}function Eye(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),_Q(e,r)}function jye(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(wr(314))}n!==null&&n.delete(t),_Q(e,r)}var xQ;xQ=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||oc.current)sc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return sc=!1,fye(e,t,r);sc=!!(e.flags&131072)}else sc=!1,qs&&t.flags&1048576&&TJ(t,xP,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;WC(e,t),e=t.pendingProps;var a=g0(t,cl.current);qx(t,r),a=LB(null,t,n,e,a,r);var d=FB();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,lc(n)?(d=!0,vP(t)):d=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,kB(t),a.updater=EI,t.stateNode=a,a._reactInternals=t,VL(t,n,e,r),t=GL(null,t,n,!0,d,r)):(t.tag=0,qs&&d&&EB(t),kl(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(WC(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=Cye(n),e=td(n,e),a){case 0:t=qL(null,t,n,e,r);break e;case 1:t=cG(null,t,n,e,r);break e;case 11:t=oG(null,t,n,e,r);break e;case 14:t=lG(null,t,n,td(n.type,e),r);break e}throw Error(wr(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:td(n,a),qL(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:td(n,a),cG(e,t,n,a,r);case 3:e:{if(nQ(t),e===null)throw Error(wr(387));n=t.pendingProps,d=t.memoizedState,a=d.element,NJ(e,t),SP(t,n,null,r);var p=t.memoizedState;if(n=p.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){a=x0(Error(wr(423)),t),t=uG(e,t,n,r,a);break e}else if(n!==a){a=x0(Error(wr(424)),t),t=uG(e,t,n,r,a);break e}else for(kc=_m(t.stateNode.containerInfo.firstChild),Oc=t,qs=!0,cd=null,r=CJ(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(y0(),n===a){t=If(e,t,r);break e}kl(e,t,n,r)}t=t.child}return t;case 5:return IJ(t),e===null&&zL(t),n=t.type,a=t.pendingProps,d=e!==null?e.memoizedProps:null,p=a.children,RL(n,a)?p=null:d!==null&&RL(n,d)&&(t.flags|=32),rQ(e,t),kl(e,t,p,r),t.child;case 6:return e===null&&zL(t),null;case 13:return iQ(e,t,r);case 4:return OB(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=v0(t,null,n,r):kl(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:td(n,a),oG(e,t,n,a,r);case 7:return kl(e,t,t.pendingProps,r),t.child;case 8:return kl(e,t,t.pendingProps.children,r),t.child;case 12:return kl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,d=t.memoizedProps,p=a.value,Ts(bP,n._currentValue),n._currentValue=p,d!==null)if(vd(d.value,p)){if(d.children===a.children&&!oc.current){t=If(e,t,r);break e}}else for(d=t.child,d!==null&&(d.return=t);d!==null;){var s=d.dependencies;if(s!==null){p=d.child;for(var _=s.firstContext;_!==null;){if(_.context===n){if(d.tag===1){_=Sf(-1,r&-r),_.tag=2;var b=d.updateQueue;if(b!==null){b=b.shared;var T=b.pending;T===null?_.next=_:(_.next=T.next,T.next=_),b.pending=_}}d.lanes|=r,_=d.alternate,_!==null&&(_.lanes|=r),BL(d.return,r,t),s.lanes|=r;break}_=_.next}}else if(d.tag===10)p=d.type===t.type?null:d.child;else if(d.tag===18){if(p=d.return,p===null)throw Error(wr(341));p.lanes|=r,s=p.alternate,s!==null&&(s.lanes|=r),BL(p,r,t),p=d.sibling}else p=d.child;if(p!==null)p.return=d;else for(p=d;p!==null;){if(p===t){p=null;break}if(d=p.sibling,d!==null){d.return=p.return,p=d;break}p=p.return}d=p}kl(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,qx(t,r),a=Tu(a),n=n(a),t.flags|=1,kl(e,t,n,r),t.child;case 14:return n=t.type,a=td(n,t.pendingProps),a=td(n.type,a),lG(e,t,n,a,r);case 15:return eQ(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:td(n,a),WC(e,t),t.tag=1,lc(n)?(e=!0,vP(t)):e=!1,qx(t,r),YJ(t,n,a),VL(t,n,a,r),GL(null,t,n,!0,e,r);case 19:return sQ(e,t,r);case 22:return tQ(e,t,r)}throw Error(wr(156,t.tag))};function bQ(e,t){return ZY(e,t)}function Aye(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vu(e,t,r,n){return new Aye(e,t,r,n)}function ZB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cye(e){if(typeof e=="function")return ZB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===fB)return 11;if(e===pB)return 14}return 2}function Sm(e,t){var r=e.alternate;return r===null?(r=vu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function XC(e,t,r,n,a,d){var p=2;if(n=e,typeof e=="function")ZB(e)&&(p=1);else if(typeof e=="string")p=5;else e:switch(e){case _x:return Gy(r.children,a,d,t);case hB:p=8,a|=8;break;case hL:return e=vu(12,r,t,a|2),e.elementType=hL,e.lanes=d,e;case fL:return e=vu(13,r,t,a),e.elementType=fL,e.lanes=d,e;case pL:return e=vu(19,r,t,a),e.elementType=pL,e.lanes=d,e;case IY:return CI(r,a,d,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case PY:p=10;break e;case NY:p=9;break e;case fB:p=11;break e;case pB:p=14;break e;case Wp:p=16,n=null;break e}throw Error(wr(130,e==null?e:typeof e,""))}return t=vu(p,r,t,a),t.elementType=e,t.type=n,t.lanes=d,t}function Gy(e,t,r,n){return e=vu(7,e,n,t),e.lanes=r,e}function CI(e,t,r,n){return e=vu(22,e,n,t),e.elementType=IY,e.lanes=r,e.stateNode={isHidden:!1},e}function VM(e,t,r){return e=vu(6,e,null,t),e.lanes=r,e}function UM(e,t,r){return t=vu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pye(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=SM(0),this.expirationTimes=SM(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=SM(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function XB(e,t,r,n,a,d,p,s,_){return e=new Pye(e,t,r,s,_),t===1?(t=1,d===!0&&(t|=8)):t=0,d=vu(3,null,null,t),e.current=d,d.stateNode=e,d.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},kB(d),e}function Nye(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vx,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function wQ(e){if(!e)return Pm;e=e._reactInternals;e:{if(vv(e)!==e||e.tag!==1)throw Error(wr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(lc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(wr(171))}if(e.tag===1){var r=e.type;if(lc(r))return wJ(e,r,t)}return t}function SQ(e,t,r,n,a,d,p,s,_){return e=XB(r,n,!0,e,a,d,p,s,_),e.context=wQ(null),r=e.current,n=zl(),a=wm(r),d=Sf(n,a),d.callback=t??null,xm(r,d,a),e.current.lanes=a,O2(e,a,n),cc(e,n),e}function PI(e,t,r,n){var a=t.current,d=zl(),p=wm(a);return r=wQ(r),t.context===null?t.context=r:t.pendingContext=r,t=Sf(d,p),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=xm(a,t,p),e!==null&&(md(e,a,p,d),UC(e,a,p)),p}function IP(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function xG(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function KB(e,t){xG(e,t),(e=e.alternate)&&xG(e,t)}function Iye(){return null}var TQ=typeof reportError=="function"?reportError:function(e){console.error(e)};function YB(e){this._internalRoot=e}NI.prototype.render=YB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(wr(409));PI(e,t,null,null)};NI.prototype.unmount=YB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ev(function(){PI(null,e,null,null)}),t[Pf]=null}};function NI(e){this._internalRoot=e}NI.prototype.unstable_scheduleHydration=function(e){if(e){var t=tJ();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Yp.length&&t!==0&&t<Yp[r].priority;r++);Yp.splice(r,0,e),r===0&&nJ(e)}};function JB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function II(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function bG(){}function kye(e,t,r,n,a){if(a){if(typeof n=="function"){var d=n;n=function(){var b=IP(p);d.call(b)}}var p=SQ(t,n,e,0,null,!1,!1,"",bG);return e._reactRootContainer=p,e[Pf]=p.current,pT(e.nodeType===8?e.parentNode:e),ev(),p}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var b=IP(_);s.call(b)}}var _=XB(e,0,!1,null,null,!1,!1,"",bG);return e._reactRootContainer=_,e[Pf]=_.current,pT(e.nodeType===8?e.parentNode:e),ev(function(){PI(t,_,r,n)}),_}function kI(e,t,r,n,a){var d=r._reactRootContainer;if(d){var p=d;if(typeof a=="function"){var s=a;a=function(){var _=IP(p);s.call(_)}}PI(t,p,e,a)}else p=kye(r,t,e,a,n);return IP(p)}QY=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=_S(t.pendingLanes);r!==0&&(yB(t,r|1),cc(t,xa()),!(Fi&6)&&(b0=xa()+500,Gm()))}break;case 13:ev(function(){var n=Nf(e,1);if(n!==null){var a=zl();md(n,e,1,a)}}),KB(e,1)}};vB=function(e){if(e.tag===13){var t=Nf(e,134217728);if(t!==null){var r=zl();md(t,e,134217728,r)}KB(e,134217728)}};eJ=function(e){if(e.tag===13){var t=wm(e),r=Nf(e,t);if(r!==null){var n=zl();md(r,e,t,n)}KB(e,t)}};tJ=function(){return us};rJ=function(e,t){var r=us;try{return us=e,t()}finally{us=r}};TL=function(e,t,r){switch(t){case"input":if(yL(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=wI(n);if(!a)throw Error(wr(90));OY(n),yL(n,a)}}}break;case"textarea":MY(e,r);break;case"select":t=r.value,t!=null&&Bx(e,!!r.multiple,t,!1)}};VY=GB;UY=ev;var Oye={usingClientEntryPoint:!1,Events:[M2,Sx,wI,BY,$Y,GB]},eS={findFiberByHostInstance:by,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Rye={bundleType:eS.bundleType,version:eS.version,rendererPackageName:eS.rendererPackageName,rendererConfig:eS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Uf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=WY(e),e===null?null:e.stateNode},findFiberByHostInstance:eS.findFiberByHostInstance||Iye,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iC.isDisabled&&iC.supportsFiber)try{vI=iC.inject(Rye),vh=iC}catch{}}qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Oye;qc.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!JB(t))throw Error(wr(200));return Nye(e,t,null,r)};qc.createRoot=function(e,t){if(!JB(e))throw Error(wr(299));var r=!1,n="",a=TQ;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=XB(e,1,!1,null,null,r,!1,n,a),e[Pf]=t.current,pT(e.nodeType===8?e.parentNode:e),new YB(t)};qc.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(wr(188)):(e=Object.keys(e).join(","),Error(wr(268,e)));return e=WY(t),e=e===null?null:e.stateNode,e};qc.flushSync=function(e){return ev(e)};qc.hydrate=function(e,t,r){if(!II(t))throw Error(wr(200));return kI(null,e,t,!0,r)};qc.hydrateRoot=function(e,t,r){if(!JB(e))throw Error(wr(405));var n=r!=null&&r.hydratedSources||null,a=!1,d="",p=TQ;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),t=SQ(t,null,e,1,r??null,a,!1,d,p),e[Pf]=t.current,pT(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new NI(t)};qc.render=function(e,t,r){if(!II(t))throw Error(wr(200));return kI(null,e,t,!1,r)};qc.unmountComponentAtNode=function(e){if(!II(e))throw Error(wr(40));return e._reactRootContainer?(ev(function(){kI(null,null,e,!1,function(){e._reactRootContainer=null,e[Pf]=null})}),!0):!1};qc.unstable_batchedUpdates=GB;qc.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!II(r))throw Error(wr(200));if(e==null||e._reactInternals===void 0)throw Error(wr(38));return kI(e,t,r,!1,n)};qc.version="18.3.1-next-f1338f8080-20240426";function EQ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(EQ)}catch(e){console.error(e)}}EQ(),EY.exports=qc;var _v=EY.exports;const jQ=es(_v);var AQ,wG=_v;AQ=wG.createRoot,wG.hydrateRoot;const Mye=1,Dye=1e6;let qM=0;function Lye(){return qM=(qM+1)%Number.MAX_SAFE_INTEGER,qM.toString()}const GM=new Map,SG=e=>{if(GM.has(e))return;const t=setTimeout(()=>{GM.delete(e),US({type:"REMOVE_TOAST",toastId:e})},Dye);GM.set(e,t)},Fye=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Mye)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?SG(r):e.toasts.forEach(n=>{SG(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},KC=[];let YC={toasts:[]};function US(e){YC=Fye(YC,e),KC.forEach(t=>{t(YC)})}function zye({...e}){const t=Lye(),r=a=>US({type:"UPDATE_TOAST",toast:{...a,id:t}}),n=()=>US({type:"DISMISS_TOAST",toastId:t});return US({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:a=>{a||n()}}}),{id:t,dismiss:n,update:r}}function CQ(){const[e,t]=F.useState(YC);return F.useEffect(()=>(KC.push(t),()=>{const r=KC.indexOf(t);r>-1&&KC.splice(r,1)}),[e]),{...e,toast:zye,dismiss:r=>US({type:"DISMISS_TOAST",toastId:r})}}function Fr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(a){if(e==null||e(a),r===!1||!a.defaultPrevented)return t==null?void 0:t(a)}}function TG(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function OI(...e){return t=>{let r=!1;const n=e.map(a=>{const d=TG(a,t);return!r&&typeof d=="function"&&(r=!0),d});if(r)return()=>{for(let a=0;a<n.length;a++){const d=n[a];typeof d=="function"?d():TG(e[a],null)}}}}function Ti(...e){return F.useCallback(OI(...e),e)}function Bye(e,t){const r=F.createContext(t),n=d=>{const{children:p,...s}=d,_=F.useMemo(()=>s,Object.values(s));return c.jsx(r.Provider,{value:_,children:p})};n.displayName=e+"Provider";function a(d){const p=F.useContext(r);if(p)return p;if(t!==void 0)return t;throw new Error(`\`${d}\` must be used within \`${e}\``)}return[n,a]}function hc(e,t=[]){let r=[];function n(d,p){const s=F.createContext(p),_=r.length;r=[...r,p];const b=C=>{var G;const{scope:P,children:k,...B}=C,R=((G=P==null?void 0:P[e])==null?void 0:G[_])||s,D=F.useMemo(()=>B,Object.values(B));return c.jsx(R.Provider,{value:D,children:k})};b.displayName=d+"Provider";function T(C,P){var R;const k=((R=P==null?void 0:P[e])==null?void 0:R[_])||s,B=F.useContext(k);if(B)return B;if(p!==void 0)return p;throw new Error(`\`${C}\` must be used within \`${d}\``)}return[b,T]}const a=()=>{const d=r.map(p=>F.createContext(p));return function(s){const _=(s==null?void 0:s[e])||d;return F.useMemo(()=>({[`__scope${e}`]:{...s,[e]:_}}),[s,_])}};return a.scopeName=e,[n,$ye(a,...t)]}function $ye(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(d){const p=n.reduce((s,{useScope:_,scopeName:b})=>{const C=_(d)[`__scope${b}`];return{...s,...C}},{});return F.useMemo(()=>({[`__scope${t.scopeName}`]:p}),[p])}};return r.scopeName=t.scopeName,r}function tv(e){const t=Vye(e),r=F.forwardRef((n,a)=>{const{children:d,...p}=n,s=F.Children.toArray(d),_=s.find(Uye);if(_){const b=_.props.children,T=s.map(C=>C===_?F.Children.count(b)>1?F.Children.only(null):F.isValidElement(b)?b.props.children:null:C);return c.jsx(t,{...p,ref:a,children:F.isValidElement(b)?F.cloneElement(b,void 0,T):null})}return c.jsx(t,{...p,ref:a,children:d})});return r.displayName=`${e}.Slot`,r}var PQ=tv("Slot");function Vye(e){const t=F.forwardRef((r,n)=>{const{children:a,...d}=r;if(F.isValidElement(a)){const p=Gye(a),s=qye(d,a.props);return a.type!==F.Fragment&&(s.ref=n?OI(n,p):p),F.cloneElement(a,s)}return F.Children.count(a)>1?F.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var NQ=Symbol("radix.slottable");function IQ(e){const t=({children:r})=>c.jsx(c.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=NQ,t}function Uye(e){return F.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===NQ}function qye(e,t){const r={...t};for(const n in t){const a=e[n],d=t[n];/^on[A-Z]/.test(n)?a&&d?r[n]=(...s)=>{const _=d(...s);return a(...s),_}:a&&(r[n]=a):n==="style"?r[n]={...a,...d}:n==="className"&&(r[n]=[a,d].filter(Boolean).join(" "))}return{...e,...r}}function Gye(e){var n,a;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function RI(e){const t=e+"CollectionProvider",[r,n]=hc(t),[a,d]=r(t,{collectionRef:{current:null},itemMap:new Map}),p=R=>{const{scope:D,children:G}=R,V=De.useRef(null),$=De.useRef(new Map).current;return c.jsx(a,{scope:D,itemMap:$,collectionRef:V,children:G})};p.displayName=t;const s=e+"CollectionSlot",_=tv(s),b=De.forwardRef((R,D)=>{const{scope:G,children:V}=R,$=d(s,G),K=Ti(D,$.collectionRef);return c.jsx(_,{ref:K,children:V})});b.displayName=s;const T=e+"CollectionItemSlot",C="data-radix-collection-item",P=tv(T),k=De.forwardRef((R,D)=>{const{scope:G,children:V,...$}=R,K=De.useRef(null),Y=Ti(D,K),ee=d(T,G);return De.useEffect(()=>(ee.itemMap.set(K,{ref:K,...$}),()=>void ee.itemMap.delete(K))),c.jsx(P,{[C]:"",ref:Y,children:V})});k.displayName=T;function B(R){const D=d(e+"CollectionConsumer",R);return De.useCallback(()=>{const V=D.collectionRef.current;if(!V)return[];const $=Array.from(V.querySelectorAll(`[${C}]`));return Array.from(D.itemMap.values()).sort((ee,ae)=>$.indexOf(ee.ref.current)-$.indexOf(ae.ref.current))},[D.collectionRef,D.itemMap])}return[{Provider:p,Slot:b,ItemSlot:k},B,n]}var Wye=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],vn=Wye.reduce((e,t)=>{const r=tv(`Primitive.${t}`),n=F.forwardRef((a,d)=>{const{asChild:p,...s}=a,_=p?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(_,{...s,ref:d})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function QB(e,t){e&&_v.flushSync(()=>e.dispatchEvent(t))}function Bl(e){const t=F.useRef(e);return F.useEffect(()=>{t.current=e}),F.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function Hye(e,t=globalThis==null?void 0:globalThis.document){const r=Bl(e);F.useEffect(()=>{const n=a=>{a.key==="Escape"&&r(a)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Zye="DismissableLayer",n3="dismissableLayer.update",Xye="dismissableLayer.pointerDownOutside",Kye="dismissableLayer.focusOutside",EG,kQ=F.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hb=F.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:a,onFocusOutside:d,onInteractOutside:p,onDismiss:s,..._}=e,b=F.useContext(kQ),[T,C]=F.useState(null),P=(T==null?void 0:T.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,k]=F.useState({}),B=Ti(t,ae=>C(ae)),R=Array.from(b.layers),[D]=[...b.layersWithOutsidePointerEventsDisabled].slice(-1),G=R.indexOf(D),V=T?R.indexOf(T):-1,$=b.layersWithOutsidePointerEventsDisabled.size>0,K=V>=G,Y=Jye(ae=>{const ie=ae.target,ge=[...b.branches].some(fe=>fe.contains(ie));!K||ge||(a==null||a(ae),p==null||p(ae),ae.defaultPrevented||s==null||s())},P),ee=Qye(ae=>{const ie=ae.target;[...b.branches].some(fe=>fe.contains(ie))||(d==null||d(ae),p==null||p(ae),ae.defaultPrevented||s==null||s())},P);return Hye(ae=>{V===b.layers.size-1&&(n==null||n(ae),!ae.defaultPrevented&&s&&(ae.preventDefault(),s()))},P),F.useEffect(()=>{if(T)return r&&(b.layersWithOutsidePointerEventsDisabled.size===0&&(EG=P.body.style.pointerEvents,P.body.style.pointerEvents="none"),b.layersWithOutsidePointerEventsDisabled.add(T)),b.layers.add(T),jG(),()=>{r&&b.layersWithOutsidePointerEventsDisabled.size===1&&(P.body.style.pointerEvents=EG)}},[T,P,r,b]),F.useEffect(()=>()=>{T&&(b.layers.delete(T),b.layersWithOutsidePointerEventsDisabled.delete(T),jG())},[T,b]),F.useEffect(()=>{const ae=()=>k({});return document.addEventListener(n3,ae),()=>document.removeEventListener(n3,ae)},[]),c.jsx(vn.div,{..._,ref:B,style:{pointerEvents:$?K?"auto":"none":void 0,...e.style},onFocusCapture:Fr(e.onFocusCapture,ee.onFocusCapture),onBlurCapture:Fr(e.onBlurCapture,ee.onBlurCapture),onPointerDownCapture:Fr(e.onPointerDownCapture,Y.onPointerDownCapture)})});hb.displayName=Zye;var Yye="DismissableLayerBranch",OQ=F.forwardRef((e,t)=>{const r=F.useContext(kQ),n=F.useRef(null),a=Ti(t,n);return F.useEffect(()=>{const d=n.current;if(d)return r.branches.add(d),()=>{r.branches.delete(d)}},[r.branches]),c.jsx(vn.div,{...e,ref:a})});OQ.displayName=Yye;function Jye(e,t=globalThis==null?void 0:globalThis.document){const r=Bl(e),n=F.useRef(!1),a=F.useRef(()=>{});return F.useEffect(()=>{const d=s=>{if(s.target&&!n.current){let _=function(){RQ(Xye,r,b,{discrete:!0})};const b={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=_,t.addEventListener("click",a.current,{once:!0})):_()}else t.removeEventListener("click",a.current);n.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",d),t.removeEventListener("click",a.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Qye(e,t=globalThis==null?void 0:globalThis.document){const r=Bl(e),n=F.useRef(!1);return F.useEffect(()=>{const a=d=>{d.target&&!n.current&&RQ(Kye,r,{originalEvent:d},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function jG(){const e=new CustomEvent(n3);document.dispatchEvent(e)}function RQ(e,t,r,{discrete:n}){const a=r.originalEvent.target,d=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&a.addEventListener(e,t,{once:!0}),n?QB(a,d):a.dispatchEvent(d)}var eve=hb,tve=OQ,Sa=globalThis!=null&&globalThis.document?F.useLayoutEffect:()=>{},rve="Portal",L2=F.forwardRef((e,t)=>{var s;const{container:r,...n}=e,[a,d]=F.useState(!1);Sa(()=>d(!0),[]);const p=r||a&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return p?jQ.createPortal(c.jsx(vn.div,{...n,ref:t}),p):null});L2.displayName=rve;function nve(e,t){return F.useReducer((r,n)=>t[r][n]??r,e)}var Cu=e=>{const{present:t,children:r}=e,n=ive(t),a=typeof r=="function"?r({present:n.isPresent}):F.Children.only(r),d=Ti(n.ref,sve(a));return typeof r=="function"||n.isPresent?F.cloneElement(a,{ref:d}):null};Cu.displayName="Presence";function ive(e){const[t,r]=F.useState(),n=F.useRef(null),a=F.useRef(e),d=F.useRef("none"),p=e?"mounted":"unmounted",[s,_]=nve(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return F.useEffect(()=>{const b=sC(n.current);d.current=s==="mounted"?b:"none"},[s]),Sa(()=>{const b=n.current,T=a.current;if(T!==e){const P=d.current,k=sC(b);e?_("MOUNT"):k==="none"||(b==null?void 0:b.display)==="none"?_("UNMOUNT"):_(T&&P!==k?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,_]),Sa(()=>{if(t){let b;const T=t.ownerDocument.defaultView??window,C=k=>{const R=sC(n.current).includes(k.animationName);if(k.target===t&&R&&(_("ANIMATION_END"),!a.current)){const D=t.style.animationFillMode;t.style.animationFillMode="forwards",b=T.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=D)})}},P=k=>{k.target===t&&(d.current=sC(n.current))};return t.addEventListener("animationstart",P),t.addEventListener("animationcancel",C),t.addEventListener("animationend",C),()=>{T.clearTimeout(b),t.removeEventListener("animationstart",P),t.removeEventListener("animationcancel",C),t.removeEventListener("animationend",C)}}else _("ANIMATION_END")},[t,_]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:F.useCallback(b=>{n.current=b?getComputedStyle(b):null,r(b)},[])}}function sC(e){return(e==null?void 0:e.animationName)||"none"}function sve(e){var n,a;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var ave=lB[" useInsertionEffect ".trim().toString()]||Sa;function kf({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[a,d,p]=ove({defaultProp:t,onChange:r}),s=e!==void 0,_=s?e:a;{const T=F.useRef(e!==void 0);F.useEffect(()=>{const C=T.current;C!==s&&console.warn(`${n} is changing from ${C?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=s},[s,n])}const b=F.useCallback(T=>{var C;if(s){const P=lve(T)?T(e):T;P!==e&&((C=p.current)==null||C.call(p,P))}else d(T)},[s,e,d,p]);return[_,b]}function ove({defaultProp:e,onChange:t}){const[r,n]=F.useState(e),a=F.useRef(r),d=F.useRef(t);return ave(()=>{d.current=t},[t]),F.useEffect(()=>{var p;a.current!==r&&((p=d.current)==null||p.call(d,r),a.current=r)},[r,a]),[r,n,d]}function lve(e){return typeof e=="function"}var MQ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),cve="VisuallyHidden",MI=F.forwardRef((e,t)=>c.jsx(vn.span,{...e,ref:t,style:{...MQ,...e.style}}));MI.displayName=cve;var uve=MI,e4="ToastProvider",[t4,dve,hve]=RI("Toast"),[DQ]=hc("Toast",[hve]),[fve,DI]=DQ(e4),LQ=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:a="right",swipeThreshold:d=50,children:p}=e,[s,_]=F.useState(null),[b,T]=F.useState(0),C=F.useRef(!1),P=F.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${e4}\`. Expected non-empty \`string\`.`),c.jsx(t4.Provider,{scope:t,children:c.jsx(fve,{scope:t,label:r,duration:n,swipeDirection:a,swipeThreshold:d,toastCount:b,viewport:s,onViewportChange:_,onToastAdd:F.useCallback(()=>T(k=>k+1),[]),onToastRemove:F.useCallback(()=>T(k=>k-1),[]),isFocusedToastEscapeKeyDownRef:C,isClosePausedRef:P,children:p})})};LQ.displayName=e4;var FQ="ToastViewport",pve=["F8"],i3="toast.viewportPause",s3="toast.viewportResume",zQ=F.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=pve,label:a="Notifications ({hotkey})",...d}=e,p=DI(FQ,r),s=dve(r),_=F.useRef(null),b=F.useRef(null),T=F.useRef(null),C=F.useRef(null),P=Ti(t,C,p.onViewportChange),k=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),B=p.toastCount>0;F.useEffect(()=>{const D=G=>{var $;n.length!==0&&n.every(K=>G[K]||G.code===K)&&(($=C.current)==null||$.focus())};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[n]),F.useEffect(()=>{const D=_.current,G=C.current;if(B&&D&&G){const V=()=>{if(!p.isClosePausedRef.current){const ee=new CustomEvent(i3);G.dispatchEvent(ee),p.isClosePausedRef.current=!0}},$=()=>{if(p.isClosePausedRef.current){const ee=new CustomEvent(s3);G.dispatchEvent(ee),p.isClosePausedRef.current=!1}},K=ee=>{!D.contains(ee.relatedTarget)&&$()},Y=()=>{D.contains(document.activeElement)||$()};return D.addEventListener("focusin",V),D.addEventListener("focusout",K),D.addEventListener("pointermove",V),D.addEventListener("pointerleave",Y),window.addEventListener("blur",V),window.addEventListener("focus",$),()=>{D.removeEventListener("focusin",V),D.removeEventListener("focusout",K),D.removeEventListener("pointermove",V),D.removeEventListener("pointerleave",Y),window.removeEventListener("blur",V),window.removeEventListener("focus",$)}}},[B,p.isClosePausedRef]);const R=F.useCallback(({tabbingDirection:D})=>{const V=s().map($=>{const K=$.ref.current,Y=[K,...Ave(K)];return D==="forwards"?Y:Y.reverse()});return(D==="forwards"?V.reverse():V).flat()},[s]);return F.useEffect(()=>{const D=C.current;if(D){const G=V=>{var Y,ee,ae;const $=V.altKey||V.ctrlKey||V.metaKey;if(V.key==="Tab"&&!$){const ie=document.activeElement,ge=V.shiftKey;if(V.target===D&&ge){(Y=b.current)==null||Y.focus();return}const ue=R({tabbingDirection:ge?"backwards":"forwards"}),Ce=ue.findIndex(ve=>ve===ie);WM(ue.slice(Ce+1))?V.preventDefault():ge?(ee=b.current)==null||ee.focus():(ae=T.current)==null||ae.focus()}};return D.addEventListener("keydown",G),()=>D.removeEventListener("keydown",G)}},[s,R]),c.jsxs(tve,{ref:_,role:"region","aria-label":a.replace("{hotkey}",k),tabIndex:-1,style:{pointerEvents:B?void 0:"none"},children:[B&&c.jsx(a3,{ref:b,onFocusFromOutsideViewport:()=>{const D=R({tabbingDirection:"forwards"});WM(D)}}),c.jsx(t4.Slot,{scope:r,children:c.jsx(vn.ol,{tabIndex:-1,...d,ref:P})}),B&&c.jsx(a3,{ref:T,onFocusFromOutsideViewport:()=>{const D=R({tabbingDirection:"backwards"});WM(D)}})]})});zQ.displayName=FQ;var BQ="ToastFocusProxy",a3=F.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...a}=e,d=DI(BQ,r);return c.jsx(MI,{"aria-hidden":!0,tabIndex:0,...a,ref:t,style:{position:"fixed"},onFocus:p=>{var b;const s=p.relatedTarget;!((b=d.viewport)!=null&&b.contains(s))&&n()}})});a3.displayName=BQ;var F2="Toast",mve="toast.swipeStart",gve="toast.swipeMove",yve="toast.swipeCancel",vve="toast.swipeEnd",$Q=F.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:a,onOpenChange:d,...p}=e,[s,_]=kf({prop:n,defaultProp:a??!0,onChange:d,caller:F2});return c.jsx(Cu,{present:r||s,children:c.jsx(bve,{open:s,...p,ref:t,onClose:()=>_(!1),onPause:Bl(e.onPause),onResume:Bl(e.onResume),onSwipeStart:Fr(e.onSwipeStart,b=>{b.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Fr(e.onSwipeMove,b=>{const{x:T,y:C}=b.detail.delta;b.currentTarget.setAttribute("data-swipe","move"),b.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${T}px`),b.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${C}px`)}),onSwipeCancel:Fr(e.onSwipeCancel,b=>{b.currentTarget.setAttribute("data-swipe","cancel"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),b.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Fr(e.onSwipeEnd,b=>{const{x:T,y:C}=b.detail.delta;b.currentTarget.setAttribute("data-swipe","end"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),b.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),b.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${T}px`),b.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${C}px`),_(!1)})})})});$Q.displayName=F2;var[_ve,xve]=DQ(F2,{onClose(){}}),bve=F.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:a,open:d,onClose:p,onEscapeKeyDown:s,onPause:_,onResume:b,onSwipeStart:T,onSwipeMove:C,onSwipeCancel:P,onSwipeEnd:k,...B}=e,R=DI(F2,r),[D,G]=F.useState(null),V=Ti(t,ve=>G(ve)),$=F.useRef(null),K=F.useRef(null),Y=a||R.duration,ee=F.useRef(0),ae=F.useRef(Y),ie=F.useRef(0),{onToastAdd:ge,onToastRemove:fe}=R,be=Bl(()=>{var ze;(D==null?void 0:D.contains(document.activeElement))&&((ze=R.viewport)==null||ze.focus()),p()}),ue=F.useCallback(ve=>{!ve||ve===1/0||(window.clearTimeout(ie.current),ee.current=new Date().getTime(),ie.current=window.setTimeout(be,ve))},[be]);F.useEffect(()=>{const ve=R.viewport;if(ve){const ze=()=>{ue(ae.current),b==null||b()},Me=()=>{const Be=new Date().getTime()-ee.current;ae.current=ae.current-Be,window.clearTimeout(ie.current),_==null||_()};return ve.addEventListener(i3,Me),ve.addEventListener(s3,ze),()=>{ve.removeEventListener(i3,Me),ve.removeEventListener(s3,ze)}}},[R.viewport,Y,_,b,ue]),F.useEffect(()=>{d&&!R.isClosePausedRef.current&&ue(Y)},[d,Y,R.isClosePausedRef,ue]),F.useEffect(()=>(ge(),()=>fe()),[ge,fe]);const Ce=F.useMemo(()=>D?ZQ(D):null,[D]);return R.viewport?c.jsxs(c.Fragment,{children:[Ce&&c.jsx(wve,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:Ce}),c.jsx(_ve,{scope:r,onClose:be,children:_v.createPortal(c.jsx(t4.ItemSlot,{scope:r,children:c.jsx(eve,{asChild:!0,onEscapeKeyDown:Fr(s,()=>{R.isFocusedToastEscapeKeyDownRef.current||be(),R.isFocusedToastEscapeKeyDownRef.current=!1}),children:c.jsx(vn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":d?"open":"closed","data-swipe-direction":R.swipeDirection,...B,ref:V,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Fr(e.onKeyDown,ve=>{ve.key==="Escape"&&(s==null||s(ve.nativeEvent),ve.nativeEvent.defaultPrevented||(R.isFocusedToastEscapeKeyDownRef.current=!0,be()))}),onPointerDown:Fr(e.onPointerDown,ve=>{ve.button===0&&($.current={x:ve.clientX,y:ve.clientY})}),onPointerMove:Fr(e.onPointerMove,ve=>{if(!$.current)return;const ze=ve.clientX-$.current.x,Me=ve.clientY-$.current.y,Be=!!K.current,Ve=["left","right"].includes(R.swipeDirection),We=["left","up"].includes(R.swipeDirection)?Math.min:Math.max,Ee=Ve?We(0,ze):0,ot=Ve?0:We(0,Me),yt=ve.pointerType==="touch"?10:2,Je={x:Ee,y:ot},Bt={originalEvent:ve,delta:Je};Be?(K.current=Je,aC(gve,C,Bt,{discrete:!1})):AG(Je,R.swipeDirection,yt)?(K.current=Je,aC(mve,T,Bt,{discrete:!1}),ve.target.setPointerCapture(ve.pointerId)):(Math.abs(ze)>yt||Math.abs(Me)>yt)&&($.current=null)}),onPointerUp:Fr(e.onPointerUp,ve=>{const ze=K.current,Me=ve.target;if(Me.hasPointerCapture(ve.pointerId)&&Me.releasePointerCapture(ve.pointerId),K.current=null,$.current=null,ze){const Be=ve.currentTarget,Ve={originalEvent:ve,delta:ze};AG(ze,R.swipeDirection,R.swipeThreshold)?aC(vve,k,Ve,{discrete:!0}):aC(yve,P,Ve,{discrete:!0}),Be.addEventListener("click",We=>We.preventDefault(),{once:!0})}})})})}),R.viewport)})]}):null}),wve=e=>{const{__scopeToast:t,children:r,...n}=e,a=DI(F2,t),[d,p]=F.useState(!1),[s,_]=F.useState(!1);return Eve(()=>p(!0)),F.useEffect(()=>{const b=window.setTimeout(()=>_(!0),1e3);return()=>window.clearTimeout(b)},[]),s?null:c.jsx(L2,{asChild:!0,children:c.jsx(MI,{...n,children:d&&c.jsxs(c.Fragment,{children:[a.label," ",r]})})})},Sve="ToastTitle",VQ=F.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return c.jsx(vn.div,{...n,ref:t})});VQ.displayName=Sve;var Tve="ToastDescription",UQ=F.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return c.jsx(vn.div,{...n,ref:t})});UQ.displayName=Tve;var qQ="ToastAction",GQ=F.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?c.jsx(HQ,{altText:r,asChild:!0,children:c.jsx(r4,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${qQ}\`. Expected non-empty \`string\`.`),null)});GQ.displayName=qQ;var WQ="ToastClose",r4=F.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,a=xve(WQ,r);return c.jsx(HQ,{asChild:!0,children:c.jsx(vn.button,{type:"button",...n,ref:t,onClick:Fr(e.onClick,a.onClose)})})});r4.displayName=WQ;var HQ=F.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...a}=e;return c.jsx(vn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...a,ref:t})});function ZQ(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),jve(n)){const a=n.ariaHidden||n.hidden||n.style.display==="none",d=n.dataset.radixToastAnnounceExclude==="";if(!a)if(d){const p=n.dataset.radixToastAnnounceAlt;p&&t.push(p)}else t.push(...ZQ(n))}}),t}function aC(e,t,r,{discrete:n}){const a=r.originalEvent.currentTarget,d=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&a.addEventListener(e,t,{once:!0}),n?QB(a,d):a.dispatchEvent(d)}var AG=(e,t,r=0)=>{const n=Math.abs(e.x),a=Math.abs(e.y),d=n>a;return t==="left"||t==="right"?d&&n>r:!d&&a>r};function Eve(e=()=>{}){const t=Bl(e);Sa(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function jve(e){return e.nodeType===e.ELEMENT_NODE}function Ave(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function WM(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Cve=LQ,XQ=zQ,KQ=$Q,YQ=VQ,JQ=UQ,QQ=GQ,eee=r4;function tee(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=tee(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Zn(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=tee(e))&&(n&&(n+=" "),n+=t);return n}const CG=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,PG=Zn,LI=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return PG(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:a,defaultVariants:d}=t,p=Object.keys(a).map(b=>{const T=r==null?void 0:r[b],C=d==null?void 0:d[b];if(T===null)return null;const P=CG(T)||CG(C);return a[b][P]}),s=r&&Object.entries(r).reduce((b,T)=>{let[C,P]=T;return P===void 0||(b[C]=P),b},{}),_=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((b,T)=>{let{class:C,className:P,...k}=T;return Object.entries(k).every(B=>{let[R,D]=B;return Array.isArray(D)?D.includes({...d,...s}[R]):{...d,...s}[R]===D})?[...b,C,P]:b},[]);return PG(e,p,_,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pve=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ree=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nve={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ive=F.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:d,iconNode:p,...s},_)=>F.createElement("svg",{ref:_,...Nve,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:ree("lucide",a),...s},[...p.map(([b,T])=>F.createElement(b,T)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=(e,t)=>{const r=F.forwardRef(({className:n,...a},d)=>F.createElement(Ive,{ref:d,iconNode:t,className:ree(`lucide-${Pve(e)}`,n),...a}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uc=fr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kve=fr("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ty=fr("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ove=fr("Beef",[["circle",{cx:"12.5",cy:"8.5",r:"2.5",key:"9738u8"}],["path",{d:"M12.5 2a6.5 6.5 0 0 0-6.22 4.6c-1.1 3.13-.78 3.9-3.18 6.08A3 3 0 0 0 5 18c4 0 8.4-1.8 11.4-4.3A6.5 6.5 0 0 0 12.5 2Z",key:"o0f6za"}],["path",{d:"m18.5 6 2.19 4.5a6.48 6.48 0 0 1 .31 2 6.49 6.49 0 0 1-2.6 5.2C15.4 20.2 11 22 7 22a3 3 0 0 1-2.68-1.66L2.4 16.5",key:"k7p6i0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rve=fr("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z2=fr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=fr("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NG=fr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n4=fr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B2=fr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kP=fr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mve=fr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w0=fr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nee=fr("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i4=fr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=fr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dve=fr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lve=fr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o3=fr("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IG=fr("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=fr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fve=fr("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Of=fr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zve=fr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ki=fr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bve=fr("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ve=fr("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nm=fr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vve=fr("Croissant",[["path",{d:"m4.6 13.11 5.79-3.21c1.89-1.05 4.79 1.78 3.71 3.71l-3.22 5.81C8.8 23.16.79 15.23 4.6 13.11Z",key:"1ozxlb"}],["path",{d:"m10.5 9.5-1-2.29C9.2 6.48 8.8 6 8 6H4.5C2.79 6 2 6.5 2 8.5a7.71 7.71 0 0 0 2 4.83",key:"ffuyb5"}],["path",{d:"M8 6c0-1.55.24-4-2-4-2 0-2.5 2.17-2.5 4",key:"osnpzi"}],["path",{d:"m14.5 13.5 2.29 1c.73.3 1.21.7 1.21 1.5v3.5c0 1.71-.5 2.5-2.5 2.5a7.71 7.71 0 0 1-4.83-2",key:"1vubaw"}],["path",{d:"M18 16c1.55 0 4-.24 4 2 0 2-2.17 2.5-4 2.5",key:"wxr772"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uve=fr("Dog",[["path",{d:"M11.25 16.25h1.5L12 17z",key:"w7jh35"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444a11.702 11.702 0 0 0-.493-3.309",key:"u7s9ue"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M8.5 8.5c-.384 1.05-1.083 2.028-2.344 2.5-1.931.722-3.576-.297-3.656-1-.113-.994 1.177-6.53 4-7 1.923-.321 3.651.845 3.651 2.235A7.497 7.497 0 0 1 14 5.277c0-1.39 1.844-2.598 3.767-2.277 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"v8hric"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=fr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qve=fr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gve=fr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wve=fr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rc=fr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hve=fr("Flower2",[["path",{d:"M12 5a3 3 0 1 1 3 3m-3-3a3 3 0 1 0-3 3m3-3v1M9 8a3 3 0 1 0 3 3M9 8h1m5 0a3 3 0 1 1-3 3m3-3h-1m-2 3v-1",key:"3pnvol"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M12 10v12",key:"6ubwww"}],["path",{d:"M12 22c4.2 0 7-1.667 7-5-4.2 0-7 1.667-7 5Z",key:"9hd38g"}],["path",{d:"M12 22c-4.2 0-7-1.667-7-5 4.2 0 7 1.667 7 5Z",key:"ufn41s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zve=fr("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $2=fr("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xve=fr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kve=fr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l3=fr("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kG=fr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yve=fr("IceCreamCone",[["path",{d:"m7 11 4.08 10.35a1 1 0 0 0 1.84 0L17 11",key:"1v6356"}],["path",{d:"M17 7A5 5 0 0 0 7 7",key:"151p3v"}],["path",{d:"M17 7a2 2 0 0 1 0 4H7a2 2 0 0 1 0-4",key:"1sdaij"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OP=fr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jve=fr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qve=fr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s4=fr("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=fr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OG=fr("Locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0=fr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=fr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fb=fr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zi=fr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e_e=fr("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iee=fr("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ri=fr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t_e=fr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r_e=fr("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=fr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=fr("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Im=fr("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FI=fr("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=fr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n_e=fr("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2V5z",key:"1ivx2i"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h.01",key:"xkw8gn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_e=fr("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s_e=fr("Pizza",[["path",{d:"m12 14-1 1",key:"11onhr"}],["path",{d:"m13.75 18.25-1.25 1.42",key:"1yisr3"}],["path",{d:"M17.775 5.654a15.68 15.68 0 0 0-12.121 12.12",key:"1qtqk6"}],["path",{d:"M18.8 9.3a1 1 0 0 0 2.1 7.7",key:"fbbbr2"}],["path",{d:"M21.964 20.732a1 1 0 0 1-1.232 1.232l-18-5a1 1 0 0 1-.695-1.232A19.68 19.68 0 0 1 15.732 2.037a1 1 0 0 1 1.232.695z",key:"1hyfdd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dc=fr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a4=fr("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a_e=fr("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c3=fr("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_e=fr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RG=fr("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l_e=fr("Sandwich",[["path",{d:"m2.37 11.223 8.372-6.777a2 2 0 0 1 2.516 0l8.371 6.777",key:"f1wd0e"}],["path",{d:"M21 15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-5.25",key:"1pfu07"}],["path",{d:"M3 15a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h9",key:"1oq9qw"}],["path",{d:"m6.67 15 6.13 4.6a2 2 0 0 0 2.8-.4l3.15-4.2",key:"1fnwu5"}],["rect",{width:"20",height:"4",x:"2",y:"11",rx:"1",key:"itshg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=fr("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _d=fr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V2=fr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c_e=fr("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rv=fr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u_e=fr("Shirt",[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=fr("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d_e=fr("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h_e=fr("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_e=fr("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mc=fr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=fr("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MG=fr("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_e=fr("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m_e=fr("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const see=fr("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aee=fr("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oee=fr("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=fr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_e=fr("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ey=fr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=fr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tf=fr("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_e=fr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=fr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rf=fr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_e=fr("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lee=fr("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=fr("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __e=fr("Wine",[["path",{d:"M8 22h8",key:"rmew8v"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M12 15v7",key:"t2xh3l"}],["path",{d:"M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",key:"10ffi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wd=fr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j0=fr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),o4="-",x_e=e=>{const t=w_e(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:p=>{const s=p.split(o4);return s[0]===""&&s.length!==1&&s.shift(),cee(s,t)||b_e(p)},getConflictingClassGroupIds:(p,s)=>{const _=r[p]||[];return s&&n[p]?[..._,...n[p]]:_}}},cee=(e,t)=>{var p;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),a=n?cee(e.slice(1),n):void 0;if(a)return a;if(t.validators.length===0)return;const d=e.join(o4);return(p=t.validators.find(({validator:s})=>s(d)))==null?void 0:p.classGroupId},DG=/^\[(.+)\]$/,b_e=e=>{if(DG.test(e)){const t=DG.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},w_e=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return T_e(Object.entries(e.classGroups),r).forEach(([d,p])=>{u3(p,n,d,t)}),n},u3=(e,t,r,n)=>{e.forEach(a=>{if(typeof a=="string"){const d=a===""?t:LG(t,a);d.classGroupId=r;return}if(typeof a=="function"){if(S_e(a)){u3(a(n),t,r,n);return}t.validators.push({validator:a,classGroupId:r});return}Object.entries(a).forEach(([d,p])=>{u3(p,LG(t,d),r,n)})})},LG=(e,t)=>{let r=e;return t.split(o4).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},S_e=e=>e.isThemeGetter,T_e=(e,t)=>t?e.map(([r,n])=>{const a=n.map(d=>typeof d=="string"?t+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([p,s])=>[t+p,s])):d);return[r,a]}):e,E_e=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const a=(d,p)=>{r.set(d,p),t++,t>e&&(t=0,n=r,r=new Map)};return{get(d){let p=r.get(d);if(p!==void 0)return p;if((p=n.get(d))!==void 0)return a(d,p),p},set(d,p){r.has(d)?r.set(d,p):a(d,p)}}},uee="!",j_e=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,a=t[0],d=t.length,p=s=>{const _=[];let b=0,T=0,C;for(let D=0;D<s.length;D++){let G=s[D];if(b===0){if(G===a&&(n||s.slice(D,D+d)===t)){_.push(s.slice(T,D)),T=D+d;continue}if(G==="/"){C=D;continue}}G==="["?b++:G==="]"&&b--}const P=_.length===0?s:s.substring(T),k=P.startsWith(uee),B=k?P.substring(1):P,R=C&&C>T?C-T:void 0;return{modifiers:_,hasImportantModifier:k,baseClassName:B,maybePostfixModifierPosition:R}};return r?s=>r({className:s,parseClassName:p}):p},A_e=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},C_e=e=>({cache:E_e(e.cacheSize),parseClassName:j_e(e),...x_e(e)}),P_e=/\s+/,N_e=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:a}=t,d=[],p=e.trim().split(P_e);let s="";for(let _=p.length-1;_>=0;_-=1){const b=p[_],{modifiers:T,hasImportantModifier:C,baseClassName:P,maybePostfixModifierPosition:k}=r(b);let B=!!k,R=n(B?P.substring(0,k):P);if(!R){if(!B){s=b+(s.length>0?" "+s:s);continue}if(R=n(P),!R){s=b+(s.length>0?" "+s:s);continue}B=!1}const D=A_e(T).join(":"),G=C?D+uee:D,V=G+R;if(d.includes(V))continue;d.push(V);const $=a(R,B);for(let K=0;K<$.length;++K){const Y=$[K];d.push(G+Y)}s=b+(s.length>0?" "+s:s)}return s};function I_e(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=dee(t))&&(n&&(n+=" "),n+=r);return n}const dee=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=dee(e[n]))&&(r&&(r+=" "),r+=t);return r};function k_e(e,...t){let r,n,a,d=p;function p(_){const b=t.reduce((T,C)=>C(T),e());return r=C_e(b),n=r.cache.get,a=r.cache.set,d=s,s(_)}function s(_){const b=n(_);if(b)return b;const T=N_e(_,r);return a(_,T),T}return function(){return d(I_e.apply(null,arguments))}}const Rs=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},hee=/^\[(?:([a-z-]+):)?(.+)\]$/i,O_e=/^\d+\/\d+$/,R_e=new Set(["px","full","screen"]),M_e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,D_e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,L_e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,F_e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,z_e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,of=e=>Wx(e)||R_e.has(e)||O_e.test(e),Fp=e=>pb(e,"length",H_e),Wx=e=>!!e&&!Number.isNaN(Number(e)),HM=e=>pb(e,"number",Wx),tS=e=>!!e&&Number.isInteger(Number(e)),B_e=e=>e.endsWith("%")&&Wx(e.slice(0,-1)),ri=e=>hee.test(e),zp=e=>M_e.test(e),$_e=new Set(["length","size","percentage"]),V_e=e=>pb(e,$_e,fee),U_e=e=>pb(e,"position",fee),q_e=new Set(["image","url"]),G_e=e=>pb(e,q_e,X_e),W_e=e=>pb(e,"",Z_e),rS=()=>!0,pb=(e,t,r)=>{const n=hee.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},H_e=e=>D_e.test(e)&&!L_e.test(e),fee=()=>!1,Z_e=e=>F_e.test(e),X_e=e=>z_e.test(e),K_e=()=>{const e=Rs("colors"),t=Rs("spacing"),r=Rs("blur"),n=Rs("brightness"),a=Rs("borderColor"),d=Rs("borderRadius"),p=Rs("borderSpacing"),s=Rs("borderWidth"),_=Rs("contrast"),b=Rs("grayscale"),T=Rs("hueRotate"),C=Rs("invert"),P=Rs("gap"),k=Rs("gradientColorStops"),B=Rs("gradientColorStopPositions"),R=Rs("inset"),D=Rs("margin"),G=Rs("opacity"),V=Rs("padding"),$=Rs("saturate"),K=Rs("scale"),Y=Rs("sepia"),ee=Rs("skew"),ae=Rs("space"),ie=Rs("translate"),ge=()=>["auto","contain","none"],fe=()=>["auto","hidden","clip","visible","scroll"],be=()=>["auto",ri,t],ue=()=>[ri,t],Ce=()=>["",of,Fp],ve=()=>["auto",Wx,ri],ze=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Me=()=>["solid","dashed","dotted","double","none"],Be=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ve=()=>["start","end","center","between","around","evenly","stretch"],We=()=>["","0",ri],Ee=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ot=()=>[Wx,ri];return{cacheSize:500,separator:":",theme:{colors:[rS],spacing:[of,Fp],blur:["none","",zp,ri],brightness:ot(),borderColor:[e],borderRadius:["none","","full",zp,ri],borderSpacing:ue(),borderWidth:Ce(),contrast:ot(),grayscale:We(),hueRotate:ot(),invert:We(),gap:ue(),gradientColorStops:[e],gradientColorStopPositions:[B_e,Fp],inset:be(),margin:be(),opacity:ot(),padding:ue(),saturate:ot(),scale:ot(),sepia:We(),skew:ot(),space:ue(),translate:ue()},classGroups:{aspect:[{aspect:["auto","square","video",ri]}],container:["container"],columns:[{columns:[zp]}],"break-after":[{"break-after":Ee()}],"break-before":[{"break-before":Ee()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ze(),ri]}],overflow:[{overflow:fe()}],"overflow-x":[{"overflow-x":fe()}],"overflow-y":[{"overflow-y":fe()}],overscroll:[{overscroll:ge()}],"overscroll-x":[{"overscroll-x":ge()}],"overscroll-y":[{"overscroll-y":ge()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[R]}],"inset-x":[{"inset-x":[R]}],"inset-y":[{"inset-y":[R]}],start:[{start:[R]}],end:[{end:[R]}],top:[{top:[R]}],right:[{right:[R]}],bottom:[{bottom:[R]}],left:[{left:[R]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",tS,ri]}],basis:[{basis:be()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ri]}],grow:[{grow:We()}],shrink:[{shrink:We()}],order:[{order:["first","last","none",tS,ri]}],"grid-cols":[{"grid-cols":[rS]}],"col-start-end":[{col:["auto",{span:["full",tS,ri]},ri]}],"col-start":[{"col-start":ve()}],"col-end":[{"col-end":ve()}],"grid-rows":[{"grid-rows":[rS]}],"row-start-end":[{row:["auto",{span:[tS,ri]},ri]}],"row-start":[{"row-start":ve()}],"row-end":[{"row-end":ve()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ri]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ri]}],gap:[{gap:[P]}],"gap-x":[{"gap-x":[P]}],"gap-y":[{"gap-y":[P]}],"justify-content":[{justify:["normal",...Ve()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ve(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ve(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[D]}],mx:[{mx:[D]}],my:[{my:[D]}],ms:[{ms:[D]}],me:[{me:[D]}],mt:[{mt:[D]}],mr:[{mr:[D]}],mb:[{mb:[D]}],ml:[{ml:[D]}],"space-x":[{"space-x":[ae]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ae]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ri,t]}],"min-w":[{"min-w":[ri,t,"min","max","fit"]}],"max-w":[{"max-w":[ri,t,"none","full","min","max","fit","prose",{screen:[zp]},zp]}],h:[{h:[ri,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ri,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ri,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ri,t,"auto","min","max","fit"]}],"font-size":[{text:["base",zp,Fp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",HM]}],"font-family":[{font:[rS]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ri]}],"line-clamp":[{"line-clamp":["none",Wx,HM]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",of,ri]}],"list-image":[{"list-image":["none",ri]}],"list-style-type":[{list:["none","disc","decimal",ri]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[G]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[G]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Me(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",of,Fp]}],"underline-offset":[{"underline-offset":["auto",of,ri]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ri]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ri]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[G]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ze(),U_e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",V_e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},G_e]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[B]}],"gradient-via-pos":[{via:[B]}],"gradient-to-pos":[{to:[B]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[G]}],"border-style":[{border:[...Me(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[G]}],"divide-style":[{divide:Me()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...Me()]}],"outline-offset":[{"outline-offset":[of,ri]}],"outline-w":[{outline:[of,Fp]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Ce()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[G]}],"ring-offset-w":[{"ring-offset":[of,Fp]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",zp,W_e]}],"shadow-color":[{shadow:[rS]}],opacity:[{opacity:[G]}],"mix-blend":[{"mix-blend":[...Be(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Be()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[_]}],"drop-shadow":[{"drop-shadow":["","none",zp,ri]}],grayscale:[{grayscale:[b]}],"hue-rotate":[{"hue-rotate":[T]}],invert:[{invert:[C]}],saturate:[{saturate:[$]}],sepia:[{sepia:[Y]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[_]}],"backdrop-grayscale":[{"backdrop-grayscale":[b]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[T]}],"backdrop-invert":[{"backdrop-invert":[C]}],"backdrop-opacity":[{"backdrop-opacity":[G]}],"backdrop-saturate":[{"backdrop-saturate":[$]}],"backdrop-sepia":[{"backdrop-sepia":[Y]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[p]}],"border-spacing-x":[{"border-spacing-x":[p]}],"border-spacing-y":[{"border-spacing-y":[p]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ri]}],duration:[{duration:ot()}],ease:[{ease:["linear","in","out","in-out",ri]}],delay:[{delay:ot()}],animate:[{animate:["none","spin","ping","pulse","bounce",ri]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[K]}],"scale-x":[{"scale-x":[K]}],"scale-y":[{"scale-y":[K]}],rotate:[{rotate:[tS,ri]}],"translate-x":[{"translate-x":[ie]}],"translate-y":[{"translate-y":[ie]}],"skew-x":[{"skew-x":[ee]}],"skew-y":[{"skew-y":[ee]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ri]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ri]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ue()}],"scroll-mx":[{"scroll-mx":ue()}],"scroll-my":[{"scroll-my":ue()}],"scroll-ms":[{"scroll-ms":ue()}],"scroll-me":[{"scroll-me":ue()}],"scroll-mt":[{"scroll-mt":ue()}],"scroll-mr":[{"scroll-mr":ue()}],"scroll-mb":[{"scroll-mb":ue()}],"scroll-ml":[{"scroll-ml":ue()}],"scroll-p":[{"scroll-p":ue()}],"scroll-px":[{"scroll-px":ue()}],"scroll-py":[{"scroll-py":ue()}],"scroll-ps":[{"scroll-ps":ue()}],"scroll-pe":[{"scroll-pe":ue()}],"scroll-pt":[{"scroll-pt":ue()}],"scroll-pr":[{"scroll-pr":ue()}],"scroll-pb":[{"scroll-pb":ue()}],"scroll-pl":[{"scroll-pl":ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ri]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[of,Fp,HM]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Y_e=k_e(K_e);function Dr(...e){return Y_e(Zn(e))}const J_e=Cve,pee=F.forwardRef(({className:e,...t},r)=>c.jsx(XQ,{ref:r,className:Dr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));pee.displayName=XQ.displayName;const Q_e=LI("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),mee=F.forwardRef(({className:e,variant:t,...r},n)=>c.jsx(KQ,{ref:n,className:Dr(Q_e({variant:t}),e),...r}));mee.displayName=KQ.displayName;const exe=F.forwardRef(({className:e,...t},r)=>c.jsx(QQ,{ref:r,className:Dr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));exe.displayName=QQ.displayName;const gee=F.forwardRef(({className:e,...t},r)=>c.jsx(eee,{ref:r,className:Dr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:c.jsx(wd,{className:"h-4 w-4"})}));gee.displayName=eee.displayName;const yee=F.forwardRef(({className:e,...t},r)=>c.jsx(YQ,{ref:r,className:Dr("text-sm font-semibold",e),...t}));yee.displayName=YQ.displayName;const vee=F.forwardRef(({className:e,...t},r)=>c.jsx(JQ,{ref:r,className:Dr("text-sm opacity-90",e),...t}));vee.displayName=JQ.displayName;function txe(){const{toasts:e}=CQ();return c.jsxs(J_e,{children:[e.map(function({id:t,title:r,description:n,action:a,...d}){return c.jsxs(mee,{...d,children:[c.jsxs("div",{className:"grid gap-1",children:[r&&c.jsx(yee,{children:r}),n&&c.jsx(vee,{children:n})]}),a,c.jsx(gee,{})]},t)}),c.jsx(pee,{})]})}var FG=["light","dark"],rxe="(prefers-color-scheme: dark)",nxe=F.createContext(void 0),ixe={setTheme:e=>{},themes:[]},sxe=()=>{var e;return(e=F.useContext(nxe))!=null?e:ixe};F.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:a,defaultTheme:d,value:p,attrs:s,nonce:_})=>{let b=d==="system",T=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(B=>`'${B}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,C=a?FG.includes(d)&&d?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${d}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",P=(B,R=!1,D=!0)=>{let G=p?p[B]:B,V=R?B+"|| ''":`'${G}'`,$="";return a&&D&&!R&&FG.includes(B)&&($+=`d.style.colorScheme = '${B}';`),r==="class"?R||G?$+=`c.add(${V})`:$+="null":G&&($+=`d[s](n,${V})`),$},k=e?`!function(){${T}${P(e)}}()`:n?`!function(){try{${T}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${b})){var t='${rxe}',m=window.matchMedia(t);if(m.media!==t||m.matches){${P("dark")}}else{${P("light")}}}else if(e){${p?`var x=${JSON.stringify(p)};`:""}${P(p?"x[e]":"e",!0)}}${b?"":"else{"+P(d,!1,!1)+"}"}${C}}catch(e){}}()`:`!function(){try{${T}var e=localStorage.getItem('${t}');if(e){${p?`var x=${JSON.stringify(p)};`:""}${P(p?"x[e]":"e",!0)}}else{${P(d,!1,!1)};}${C}}catch(t){}}();`;return F.createElement("script",{nonce:_,dangerouslySetInnerHTML:{__html:k}})});var axe=e=>{switch(e){case"success":return cxe;case"info":return dxe;case"warning":return uxe;case"error":return hxe;default:return null}},oxe=Array(12).fill(0),lxe=({visible:e,className:t})=>De.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},De.createElement("div",{className:"sonner-spinner"},oxe.map((r,n)=>De.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),cxe=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),uxe=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),dxe=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),hxe=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),fxe=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},De.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),De.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),pxe=()=>{let[e,t]=De.useState(document.hidden);return De.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},d3=1,mxe=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,a=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:d3++,d=this.toasts.find(s=>s.id===a),p=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),d?this.toasts=this.toasts.map(s=>s.id===a?(this.publish({...s,...e,id:a,title:r}),{...s,...e,id:a,dismissible:p,title:r}):s):this.addToast({title:r,...n,dismissible:p,id:a}),a},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),a=r!==void 0,d,p=n.then(async _=>{if(d=["resolve",_],De.isValidElement(_))a=!1,this.create({id:r,type:"default",message:_});else if(yxe(_)&&!_.ok){a=!1;let b=typeof t.error=="function"?await t.error(`HTTP error! status: ${_.status}`):t.error,T=typeof t.description=="function"?await t.description(`HTTP error! status: ${_.status}`):t.description;this.create({id:r,type:"error",message:b,description:T})}else if(t.success!==void 0){a=!1;let b=typeof t.success=="function"?await t.success(_):t.success,T=typeof t.description=="function"?await t.description(_):t.description;this.create({id:r,type:"success",message:b,description:T})}}).catch(async _=>{if(d=["reject",_],t.error!==void 0){a=!1;let b=typeof t.error=="function"?await t.error(_):t.error,T=typeof t.description=="function"?await t.description(_):t.description;this.create({id:r,type:"error",message:b,description:T})}}).finally(()=>{var _;a&&(this.dismiss(r),r=void 0),(_=t.finally)==null||_.call(t)}),s=()=>new Promise((_,b)=>p.then(()=>d[0]==="reject"?b(d[1]):_(d[1])).catch(b));return typeof r!="string"&&typeof r!="number"?{unwrap:s}:Object.assign(r,{unwrap:s})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||d3++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},tc=new mxe,gxe=(e,t)=>{let r=(t==null?void 0:t.id)||d3++;return tc.addToast({title:e,...t,id:r}),r},yxe=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",vxe=gxe,_xe=()=>tc.toasts,xxe=()=>tc.getActiveToasts(),gt=Object.assign(vxe,{success:tc.success,info:tc.info,warning:tc.warning,error:tc.error,custom:tc.custom,message:tc.message,promise:tc.promise,dismiss:tc.dismiss,loading:tc.loading},{getHistory:_xe,getToasts:xxe});function bxe(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}bxe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function oC(e){return e.label!==void 0}var wxe=3,Sxe="32px",Txe="16px",zG=4e3,Exe=356,jxe=14,Axe=20,Cxe=200;function Xu(...e){return e.filter(Boolean).join(" ")}function Pxe(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var Nxe=e=>{var t,r,n,a,d,p,s,_,b,T,C;let{invert:P,toast:k,unstyled:B,interacting:R,setHeights:D,visibleToasts:G,heights:V,index:$,toasts:K,expanded:Y,removeToast:ee,defaultRichColors:ae,closeButton:ie,style:ge,cancelButtonStyle:fe,actionButtonStyle:be,className:ue="",descriptionClassName:Ce="",duration:ve,position:ze,gap:Me,loadingIcon:Be,expandByDefault:Ve,classNames:We,icons:Ee,closeButtonAriaLabel:ot="Close toast",pauseWhenPageIsHidden:yt}=e,[Je,Bt]=De.useState(null),[Pt,pt]=De.useState(null),[Gt,Pr]=De.useState(!1),[Ot,nr]=De.useState(!1),[ur,Et]=De.useState(!1),[pr,Kr]=De.useState(!1),[Xn,Jn]=De.useState(!1),[ni,zn]=De.useState(0),[hs,lt]=De.useState(0),Ct=De.useRef(k.duration||ve||zG),Xt=De.useRef(null),Sr=De.useRef(null),yr=$===0,hr=$+1<=G,Or=k.type,Mn=k.dismissible!==!1,oi=k.className||"",$s=k.descriptionClassName||"",fs=De.useMemo(()=>V.findIndex(jn=>jn.toastId===k.id)||0,[V,k.id]),za=De.useMemo(()=>{var jn;return(jn=k.closeButton)!=null?jn:ie},[k.closeButton,ie]),Ta=De.useMemo(()=>k.duration||ve||zG,[k.duration,ve]),fl=De.useRef(0),na=De.useRef(0),js=De.useRef(0),ga=De.useRef(null),[pl,ml]=ze.split("-"),Wl=De.useMemo(()=>V.reduce((jn,mi,ii)=>ii>=fs?jn:jn+mi.height,0),[V,fs]),pc=pxe(),Wc=k.invert||P,Hc=Or==="loading";na.current=De.useMemo(()=>fs*Me+Wl,[fs,Wl]),De.useEffect(()=>{Ct.current=Ta},[Ta]),De.useEffect(()=>{Pr(!0)},[]),De.useEffect(()=>{let jn=Sr.current;if(jn){let mi=jn.getBoundingClientRect().height;return lt(mi),D(ii=>[{toastId:k.id,height:mi,position:k.position},...ii]),()=>D(ii=>ii.filter(bo=>bo.toastId!==k.id))}},[D,k.id]),De.useLayoutEffect(()=>{if(!Gt)return;let jn=Sr.current,mi=jn.style.height;jn.style.height="auto";let ii=jn.getBoundingClientRect().height;jn.style.height=mi,lt(ii),D(bo=>bo.find(Ea=>Ea.toastId===k.id)?bo.map(Ea=>Ea.toastId===k.id?{...Ea,height:ii}:Ea):[{toastId:k.id,height:ii,position:k.position},...bo])},[Gt,k.title,k.description,D,k.id]);let Gn=De.useCallback(()=>{nr(!0),zn(na.current),D(jn=>jn.filter(mi=>mi.toastId!==k.id)),setTimeout(()=>{ee(k)},Cxe)},[k,ee,D,na]);De.useEffect(()=>{if(k.promise&&Or==="loading"||k.duration===1/0||k.type==="loading")return;let jn;return Y||R||yt&&pc?(()=>{if(js.current<fl.current){let mi=new Date().getTime()-fl.current;Ct.current=Ct.current-mi}js.current=new Date().getTime()})():Ct.current!==1/0&&(fl.current=new Date().getTime(),jn=setTimeout(()=>{var mi;(mi=k.onAutoClose)==null||mi.call(k,k),Gn()},Ct.current)),()=>clearTimeout(jn)},[Y,R,k,Or,yt,pc,Gn]),De.useEffect(()=>{k.delete&&Gn()},[Gn,k.delete]);function Ws(){var jn,mi,ii;return Ee!=null&&Ee.loading?De.createElement("div",{className:Xu(We==null?void 0:We.loader,(jn=k==null?void 0:k.classNames)==null?void 0:jn.loader,"sonner-loader"),"data-visible":Or==="loading"},Ee.loading):Be?De.createElement("div",{className:Xu(We==null?void 0:We.loader,(mi=k==null?void 0:k.classNames)==null?void 0:mi.loader,"sonner-loader"),"data-visible":Or==="loading"},Be):De.createElement(lxe,{className:Xu(We==null?void 0:We.loader,(ii=k==null?void 0:k.classNames)==null?void 0:ii.loader),visible:Or==="loading"})}return De.createElement("li",{tabIndex:0,ref:Sr,className:Xu(ue,oi,We==null?void 0:We.toast,(t=k==null?void 0:k.classNames)==null?void 0:t.toast,We==null?void 0:We.default,We==null?void 0:We[Or],(r=k==null?void 0:k.classNames)==null?void 0:r[Or]),"data-sonner-toast":"","data-rich-colors":(n=k.richColors)!=null?n:ae,"data-styled":!(k.jsx||k.unstyled||B),"data-mounted":Gt,"data-promise":!!k.promise,"data-swiped":Xn,"data-removed":Ot,"data-visible":hr,"data-y-position":pl,"data-x-position":ml,"data-index":$,"data-front":yr,"data-swiping":ur,"data-dismissible":Mn,"data-type":Or,"data-invert":Wc,"data-swipe-out":pr,"data-swipe-direction":Pt,"data-expanded":!!(Y||Ve&&Gt),style:{"--index":$,"--toasts-before":$,"--z-index":K.length-$,"--offset":`${Ot?ni:na.current}px`,"--initial-height":Ve?"auto":`${hs}px`,...ge,...k.style},onDragEnd:()=>{Et(!1),Bt(null),ga.current=null},onPointerDown:jn=>{Hc||!Mn||(Xt.current=new Date,zn(na.current),jn.target.setPointerCapture(jn.pointerId),jn.target.tagName!=="BUTTON"&&(Et(!0),ga.current={x:jn.clientX,y:jn.clientY}))},onPointerUp:()=>{var jn,mi,ii,bo;if(pr||!Mn)return;ga.current=null;let Ea=Number(((jn=Sr.current)==null?void 0:jn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),kt=Number(((mi=Sr.current)==null?void 0:mi.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ba=new Date().getTime()-((ii=Xt.current)==null?void 0:ii.getTime()),wo=Je==="x"?Ea:kt,qo=Math.abs(wo)/Ba;if(Math.abs(wo)>=Axe||qo>.11){zn(na.current),(bo=k.onDismiss)==null||bo.call(k,k),pt(Je==="x"?Ea>0?"right":"left":kt>0?"down":"up"),Gn(),Kr(!0),Jn(!1);return}Et(!1),Bt(null)},onPointerMove:jn=>{var mi,ii,bo,Ea;if(!ga.current||!Mn||((mi=window.getSelection())==null?void 0:mi.toString().length)>0)return;let kt=jn.clientY-ga.current.y,Ba=jn.clientX-ga.current.x,wo=(ii=e.swipeDirections)!=null?ii:Pxe(ze);!Je&&(Math.abs(Ba)>1||Math.abs(kt)>1)&&Bt(Math.abs(Ba)>Math.abs(kt)?"x":"y");let qo={x:0,y:0};Je==="y"?(wo.includes("top")||wo.includes("bottom"))&&(wo.includes("top")&&kt<0||wo.includes("bottom")&&kt>0)&&(qo.y=kt):Je==="x"&&(wo.includes("left")||wo.includes("right"))&&(wo.includes("left")&&Ba<0||wo.includes("right")&&Ba>0)&&(qo.x=Ba),(Math.abs(qo.x)>0||Math.abs(qo.y)>0)&&Jn(!0),(bo=Sr.current)==null||bo.style.setProperty("--swipe-amount-x",`${qo.x}px`),(Ea=Sr.current)==null||Ea.style.setProperty("--swipe-amount-y",`${qo.y}px`)}},za&&!k.jsx?De.createElement("button",{"aria-label":ot,"data-disabled":Hc,"data-close-button":!0,onClick:Hc||!Mn?()=>{}:()=>{var jn;Gn(),(jn=k.onDismiss)==null||jn.call(k,k)},className:Xu(We==null?void 0:We.closeButton,(a=k==null?void 0:k.classNames)==null?void 0:a.closeButton)},(d=Ee==null?void 0:Ee.close)!=null?d:fxe):null,k.jsx||F.isValidElement(k.title)?k.jsx?k.jsx:typeof k.title=="function"?k.title():k.title:De.createElement(De.Fragment,null,Or||k.icon||k.promise?De.createElement("div",{"data-icon":"",className:Xu(We==null?void 0:We.icon,(p=k==null?void 0:k.classNames)==null?void 0:p.icon)},k.promise||k.type==="loading"&&!k.icon?k.icon||Ws():null,k.type!=="loading"?k.icon||(Ee==null?void 0:Ee[Or])||axe(Or):null):null,De.createElement("div",{"data-content":"",className:Xu(We==null?void 0:We.content,(s=k==null?void 0:k.classNames)==null?void 0:s.content)},De.createElement("div",{"data-title":"",className:Xu(We==null?void 0:We.title,(_=k==null?void 0:k.classNames)==null?void 0:_.title)},typeof k.title=="function"?k.title():k.title),k.description?De.createElement("div",{"data-description":"",className:Xu(Ce,$s,We==null?void 0:We.description,(b=k==null?void 0:k.classNames)==null?void 0:b.description)},typeof k.description=="function"?k.description():k.description):null),F.isValidElement(k.cancel)?k.cancel:k.cancel&&oC(k.cancel)?De.createElement("button",{"data-button":!0,"data-cancel":!0,style:k.cancelButtonStyle||fe,onClick:jn=>{var mi,ii;oC(k.cancel)&&Mn&&((ii=(mi=k.cancel).onClick)==null||ii.call(mi,jn),Gn())},className:Xu(We==null?void 0:We.cancelButton,(T=k==null?void 0:k.classNames)==null?void 0:T.cancelButton)},k.cancel.label):null,F.isValidElement(k.action)?k.action:k.action&&oC(k.action)?De.createElement("button",{"data-button":!0,"data-action":!0,style:k.actionButtonStyle||be,onClick:jn=>{var mi,ii;oC(k.action)&&((ii=(mi=k.action).onClick)==null||ii.call(mi,jn),!jn.defaultPrevented&&Gn())},className:Xu(We==null?void 0:We.actionButton,(C=k==null?void 0:k.classNames)==null?void 0:C.actionButton)},k.action.label):null))};function BG(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Ixe(e,t){let r={};return[e,t].forEach((n,a)=>{let d=a===1,p=d?"--mobile-offset":"--offset",s=d?Txe:Sxe;function _(b){["top","right","bottom","left"].forEach(T=>{r[`${p}-${T}`]=typeof b=="number"?`${b}px`:b})}typeof n=="number"||typeof n=="string"?_(n):typeof n=="object"?["top","right","bottom","left"].forEach(b=>{n[b]===void 0?r[`${p}-${b}`]=s:r[`${p}-${b}`]=typeof n[b]=="number"?`${n[b]}px`:n[b]}):_(s)}),r}var kxe=F.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:a=["altKey","KeyT"],expand:d,closeButton:p,className:s,offset:_,mobileOffset:b,theme:T="light",richColors:C,duration:P,style:k,visibleToasts:B=wxe,toastOptions:R,dir:D=BG(),gap:G=jxe,loadingIcon:V,icons:$,containerAriaLabel:K="Notifications",pauseWhenPageIsHidden:Y}=e,[ee,ae]=De.useState([]),ie=De.useMemo(()=>Array.from(new Set([n].concat(ee.filter(yt=>yt.position).map(yt=>yt.position)))),[ee,n]),[ge,fe]=De.useState([]),[be,ue]=De.useState(!1),[Ce,ve]=De.useState(!1),[ze,Me]=De.useState(T!=="system"?T:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Be=De.useRef(null),Ve=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),We=De.useRef(null),Ee=De.useRef(!1),ot=De.useCallback(yt=>{ae(Je=>{var Bt;return(Bt=Je.find(Pt=>Pt.id===yt.id))!=null&&Bt.delete||tc.dismiss(yt.id),Je.filter(({id:Pt})=>Pt!==yt.id)})},[]);return De.useEffect(()=>tc.subscribe(yt=>{if(yt.dismiss){ae(Je=>Je.map(Bt=>Bt.id===yt.id?{...Bt,delete:!0}:Bt));return}setTimeout(()=>{jQ.flushSync(()=>{ae(Je=>{let Bt=Je.findIndex(Pt=>Pt.id===yt.id);return Bt!==-1?[...Je.slice(0,Bt),{...Je[Bt],...yt},...Je.slice(Bt+1)]:[yt,...Je]})})})}),[]),De.useEffect(()=>{if(T!=="system"){Me(T);return}if(T==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Me("dark"):Me("light")),typeof window>"u")return;let yt=window.matchMedia("(prefers-color-scheme: dark)");try{yt.addEventListener("change",({matches:Je})=>{Me(Je?"dark":"light")})}catch{yt.addListener(({matches:Bt})=>{try{Me(Bt?"dark":"light")}catch(Pt){console.error(Pt)}})}},[T]),De.useEffect(()=>{ee.length<=1&&ue(!1)},[ee]),De.useEffect(()=>{let yt=Je=>{var Bt,Pt;a.every(pt=>Je[pt]||Je.code===pt)&&(ue(!0),(Bt=Be.current)==null||Bt.focus()),Je.code==="Escape"&&(document.activeElement===Be.current||(Pt=Be.current)!=null&&Pt.contains(document.activeElement))&&ue(!1)};return document.addEventListener("keydown",yt),()=>document.removeEventListener("keydown",yt)},[a]),De.useEffect(()=>{if(Be.current)return()=>{We.current&&(We.current.focus({preventScroll:!0}),We.current=null,Ee.current=!1)}},[Be.current]),De.createElement("section",{ref:t,"aria-label":`${K} ${Ve}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ie.map((yt,Je)=>{var Bt;let[Pt,pt]=yt.split("-");return ee.length?De.createElement("ol",{key:yt,dir:D==="auto"?BG():D,tabIndex:-1,ref:Be,className:s,"data-sonner-toaster":!0,"data-theme":ze,"data-y-position":Pt,"data-lifted":be&&ee.length>1&&!d,"data-x-position":pt,style:{"--front-toast-height":`${((Bt=ge[0])==null?void 0:Bt.height)||0}px`,"--width":`${Exe}px`,"--gap":`${G}px`,...k,...Ixe(_,b)},onBlur:Gt=>{Ee.current&&!Gt.currentTarget.contains(Gt.relatedTarget)&&(Ee.current=!1,We.current&&(We.current.focus({preventScroll:!0}),We.current=null))},onFocus:Gt=>{Gt.target instanceof HTMLElement&&Gt.target.dataset.dismissible==="false"||Ee.current||(Ee.current=!0,We.current=Gt.relatedTarget)},onMouseEnter:()=>ue(!0),onMouseMove:()=>ue(!0),onMouseLeave:()=>{Ce||ue(!1)},onDragEnd:()=>ue(!1),onPointerDown:Gt=>{Gt.target instanceof HTMLElement&&Gt.target.dataset.dismissible==="false"||ve(!0)},onPointerUp:()=>ve(!1)},ee.filter(Gt=>!Gt.position&&Je===0||Gt.position===yt).map((Gt,Pr)=>{var Ot,nr;return De.createElement(Nxe,{key:Gt.id,icons:$,index:Pr,toast:Gt,defaultRichColors:C,duration:(Ot=R==null?void 0:R.duration)!=null?Ot:P,className:R==null?void 0:R.className,descriptionClassName:R==null?void 0:R.descriptionClassName,invert:r,visibleToasts:B,closeButton:(nr=R==null?void 0:R.closeButton)!=null?nr:p,interacting:Ce,position:yt,style:R==null?void 0:R.style,unstyled:R==null?void 0:R.unstyled,classNames:R==null?void 0:R.classNames,cancelButtonStyle:R==null?void 0:R.cancelButtonStyle,actionButtonStyle:R==null?void 0:R.actionButtonStyle,removeToast:ot,toasts:ee.filter(ur=>ur.position==Gt.position),heights:ge.filter(ur=>ur.position==Gt.position),setHeights:fe,expandByDefault:d,gap:G,loadingIcon:V,expanded:be,pauseWhenPageIsHidden:Y,swipeDirections:e.swipeDirections})})):null}))});const Oxe=({...e})=>{const{theme:t="system"}=sxe();return c.jsx(kxe,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var Rxe=lB[" useId ".trim().toString()]||(()=>{}),Mxe=0;function gd(e){const[t,r]=F.useState(Rxe());return Sa(()=>{r(n=>n??String(Mxe++))},[e]),t?`radix-${t}`:""}const Dxe=["top","right","bottom","left"],km=Math.min,Cc=Math.max,RP=Math.round,lC=Math.floor,bh=e=>({x:e,y:e}),Lxe={left:"right",right:"left",bottom:"top",top:"bottom"},Fxe={start:"end",end:"start"};function h3(e,t,r){return Cc(e,km(t,r))}function Mf(e,t){return typeof e=="function"?e(t):e}function Df(e){return e.split("-")[0]}function mb(e){return e.split("-")[1]}function l4(e){return e==="x"?"y":"x"}function c4(e){return e==="y"?"height":"width"}const zxe=new Set(["top","bottom"]);function ph(e){return zxe.has(Df(e))?"y":"x"}function u4(e){return l4(ph(e))}function Bxe(e,t,r){r===void 0&&(r=!1);const n=mb(e),a=u4(e),d=c4(a);let p=a==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[d]>t.floating[d]&&(p=MP(p)),[p,MP(p)]}function $xe(e){const t=MP(e);return[f3(e),t,f3(t)]}function f3(e){return e.replace(/start|end/g,t=>Fxe[t])}const $G=["left","right"],VG=["right","left"],Vxe=["top","bottom"],Uxe=["bottom","top"];function qxe(e,t,r){switch(e){case"top":case"bottom":return r?t?VG:$G:t?$G:VG;case"left":case"right":return t?Vxe:Uxe;default:return[]}}function Gxe(e,t,r,n){const a=mb(e);let d=qxe(Df(e),r==="start",n);return a&&(d=d.map(p=>p+"-"+a),t&&(d=d.concat(d.map(f3)))),d}function MP(e){return e.replace(/left|right|bottom|top/g,t=>Lxe[t])}function Wxe(e){return{top:0,right:0,bottom:0,left:0,...e}}function _ee(e){return typeof e!="number"?Wxe(e):{top:e,right:e,bottom:e,left:e}}function DP(e){const{x:t,y:r,width:n,height:a}=e;return{width:n,height:a,top:r,left:t,right:t+n,bottom:r+a,x:t,y:r}}function UG(e,t,r){let{reference:n,floating:a}=e;const d=ph(t),p=u4(t),s=c4(p),_=Df(t),b=d==="y",T=n.x+n.width/2-a.width/2,C=n.y+n.height/2-a.height/2,P=n[s]/2-a[s]/2;let k;switch(_){case"top":k={x:T,y:n.y-a.height};break;case"bottom":k={x:T,y:n.y+n.height};break;case"right":k={x:n.x+n.width,y:C};break;case"left":k={x:n.x-a.width,y:C};break;default:k={x:n.x,y:n.y}}switch(mb(t)){case"start":k[p]-=P*(r&&b?-1:1);break;case"end":k[p]+=P*(r&&b?-1:1);break}return k}const Hxe=async(e,t,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:d=[],platform:p}=r,s=d.filter(Boolean),_=await(p.isRTL==null?void 0:p.isRTL(t));let b=await p.getElementRects({reference:e,floating:t,strategy:a}),{x:T,y:C}=UG(b,n,_),P=n,k={},B=0;for(let R=0;R<s.length;R++){const{name:D,fn:G}=s[R],{x:V,y:$,data:K,reset:Y}=await G({x:T,y:C,initialPlacement:n,placement:P,strategy:a,middlewareData:k,rects:b,platform:p,elements:{reference:e,floating:t}});T=V??T,C=$??C,k={...k,[D]:{...k[D],...K}},Y&&B<=50&&(B++,typeof Y=="object"&&(Y.placement&&(P=Y.placement),Y.rects&&(b=Y.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:a}):Y.rects),{x:T,y:C}=UG(b,P,_)),R=-1)}return{x:T,y:C,placement:P,strategy:a,middlewareData:k}};async function ET(e,t){var r;t===void 0&&(t={});const{x:n,y:a,platform:d,rects:p,elements:s,strategy:_}=e,{boundary:b="clippingAncestors",rootBoundary:T="viewport",elementContext:C="floating",altBoundary:P=!1,padding:k=0}=Mf(t,e),B=_ee(k),D=s[P?C==="floating"?"reference":"floating":C],G=DP(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(D)))==null||r?D:D.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(s.floating)),boundary:b,rootBoundary:T,strategy:_})),V=C==="floating"?{x:n,y:a,width:p.floating.width,height:p.floating.height}:p.reference,$=await(d.getOffsetParent==null?void 0:d.getOffsetParent(s.floating)),K=await(d.isElement==null?void 0:d.isElement($))?await(d.getScale==null?void 0:d.getScale($))||{x:1,y:1}:{x:1,y:1},Y=DP(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:V,offsetParent:$,strategy:_}):V);return{top:(G.top-Y.top+B.top)/K.y,bottom:(Y.bottom-G.bottom+B.bottom)/K.y,left:(G.left-Y.left+B.left)/K.x,right:(Y.right-G.right+B.right)/K.x}}const Zxe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:a,rects:d,platform:p,elements:s,middlewareData:_}=t,{element:b,padding:T=0}=Mf(e,t)||{};if(b==null)return{};const C=_ee(T),P={x:r,y:n},k=u4(a),B=c4(k),R=await p.getDimensions(b),D=k==="y",G=D?"top":"left",V=D?"bottom":"right",$=D?"clientHeight":"clientWidth",K=d.reference[B]+d.reference[k]-P[k]-d.floating[B],Y=P[k]-d.reference[k],ee=await(p.getOffsetParent==null?void 0:p.getOffsetParent(b));let ae=ee?ee[$]:0;(!ae||!await(p.isElement==null?void 0:p.isElement(ee)))&&(ae=s.floating[$]||d.floating[B]);const ie=K/2-Y/2,ge=ae/2-R[B]/2-1,fe=km(C[G],ge),be=km(C[V],ge),ue=fe,Ce=ae-R[B]-be,ve=ae/2-R[B]/2+ie,ze=h3(ue,ve,Ce),Me=!_.arrow&&mb(a)!=null&&ve!==ze&&d.reference[B]/2-(ve<ue?fe:be)-R[B]/2<0,Be=Me?ve<ue?ve-ue:ve-Ce:0;return{[k]:P[k]+Be,data:{[k]:ze,centerOffset:ve-ze-Be,...Me&&{alignmentOffset:Be}},reset:Me}}}),Xxe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:a,middlewareData:d,rects:p,initialPlacement:s,platform:_,elements:b}=t,{mainAxis:T=!0,crossAxis:C=!0,fallbackPlacements:P,fallbackStrategy:k="bestFit",fallbackAxisSideDirection:B="none",flipAlignment:R=!0,...D}=Mf(e,t);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const G=Df(a),V=ph(s),$=Df(s)===s,K=await(_.isRTL==null?void 0:_.isRTL(b.floating)),Y=P||($||!R?[MP(s)]:$xe(s)),ee=B!=="none";!P&&ee&&Y.push(...Gxe(s,R,B,K));const ae=[s,...Y],ie=await ET(t,D),ge=[];let fe=((n=d.flip)==null?void 0:n.overflows)||[];if(T&&ge.push(ie[G]),C){const ve=Bxe(a,p,K);ge.push(ie[ve[0]],ie[ve[1]])}if(fe=[...fe,{placement:a,overflows:ge}],!ge.every(ve=>ve<=0)){var be,ue;const ve=(((be=d.flip)==null?void 0:be.index)||0)+1,ze=ae[ve];if(ze&&(!(C==="alignment"?V!==ph(ze):!1)||fe.every(Ve=>Ve.overflows[0]>0&&ph(Ve.placement)===V)))return{data:{index:ve,overflows:fe},reset:{placement:ze}};let Me=(ue=fe.filter(Be=>Be.overflows[0]<=0).sort((Be,Ve)=>Be.overflows[1]-Ve.overflows[1])[0])==null?void 0:ue.placement;if(!Me)switch(k){case"bestFit":{var Ce;const Be=(Ce=fe.filter(Ve=>{if(ee){const We=ph(Ve.placement);return We===V||We==="y"}return!0}).map(Ve=>[Ve.placement,Ve.overflows.filter(We=>We>0).reduce((We,Ee)=>We+Ee,0)]).sort((Ve,We)=>Ve[1]-We[1])[0])==null?void 0:Ce[0];Be&&(Me=Be);break}case"initialPlacement":Me=s;break}if(a!==Me)return{reset:{placement:Me}}}return{}}}};function qG(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function GG(e){return Dxe.some(t=>e[t]>=0)}const Kxe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...a}=Mf(e,t);switch(n){case"referenceHidden":{const d=await ET(t,{...a,elementContext:"reference"}),p=qG(d,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:GG(p)}}}case"escaped":{const d=await ET(t,{...a,altBoundary:!0}),p=qG(d,r.floating);return{data:{escapedOffsets:p,escaped:GG(p)}}}default:return{}}}}},xee=new Set(["left","top"]);async function Yxe(e,t){const{placement:r,platform:n,elements:a}=e,d=await(n.isRTL==null?void 0:n.isRTL(a.floating)),p=Df(r),s=mb(r),_=ph(r)==="y",b=xee.has(p)?-1:1,T=d&&_?-1:1,C=Mf(t,e);let{mainAxis:P,crossAxis:k,alignmentAxis:B}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return s&&typeof B=="number"&&(k=s==="end"?B*-1:B),_?{x:k*T,y:P*b}:{x:P*b,y:k*T}}const Jxe=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:a,y:d,placement:p,middlewareData:s}=t,_=await Yxe(t,e);return p===((r=s.offset)==null?void 0:r.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:a+_.x,y:d+_.y,data:{..._,placement:p}}}}},Qxe=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:a}=t,{mainAxis:d=!0,crossAxis:p=!1,limiter:s={fn:D=>{let{x:G,y:V}=D;return{x:G,y:V}}},..._}=Mf(e,t),b={x:r,y:n},T=await ET(t,_),C=ph(Df(a)),P=l4(C);let k=b[P],B=b[C];if(d){const D=P==="y"?"top":"left",G=P==="y"?"bottom":"right",V=k+T[D],$=k-T[G];k=h3(V,k,$)}if(p){const D=C==="y"?"top":"left",G=C==="y"?"bottom":"right",V=B+T[D],$=B-T[G];B=h3(V,B,$)}const R=s.fn({...t,[P]:k,[C]:B});return{...R,data:{x:R.x-r,y:R.y-n,enabled:{[P]:d,[C]:p}}}}}},e0e=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:a,rects:d,middlewareData:p}=t,{offset:s=0,mainAxis:_=!0,crossAxis:b=!0}=Mf(e,t),T={x:r,y:n},C=ph(a),P=l4(C);let k=T[P],B=T[C];const R=Mf(s,t),D=typeof R=="number"?{mainAxis:R,crossAxis:0}:{mainAxis:0,crossAxis:0,...R};if(_){const $=P==="y"?"height":"width",K=d.reference[P]-d.floating[$]+D.mainAxis,Y=d.reference[P]+d.reference[$]-D.mainAxis;k<K?k=K:k>Y&&(k=Y)}if(b){var G,V;const $=P==="y"?"width":"height",K=xee.has(Df(a)),Y=d.reference[C]-d.floating[$]+(K&&((G=p.offset)==null?void 0:G[C])||0)+(K?0:D.crossAxis),ee=d.reference[C]+d.reference[$]+(K?0:((V=p.offset)==null?void 0:V[C])||0)-(K?D.crossAxis:0);B<Y?B=Y:B>ee&&(B=ee)}return{[P]:k,[C]:B}}}},t0e=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:a,rects:d,platform:p,elements:s}=t,{apply:_=()=>{},...b}=Mf(e,t),T=await ET(t,b),C=Df(a),P=mb(a),k=ph(a)==="y",{width:B,height:R}=d.floating;let D,G;C==="top"||C==="bottom"?(D=C,G=P===(await(p.isRTL==null?void 0:p.isRTL(s.floating))?"start":"end")?"left":"right"):(G=C,D=P==="end"?"top":"bottom");const V=R-T.top-T.bottom,$=B-T.left-T.right,K=km(R-T[D],V),Y=km(B-T[G],$),ee=!t.middlewareData.shift;let ae=K,ie=Y;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ie=$),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(ae=V),ee&&!P){const fe=Cc(T.left,0),be=Cc(T.right,0),ue=Cc(T.top,0),Ce=Cc(T.bottom,0);k?ie=B-2*(fe!==0||be!==0?fe+be:Cc(T.left,T.right)):ae=R-2*(ue!==0||Ce!==0?ue+Ce:Cc(T.top,T.bottom))}await _({...t,availableWidth:ie,availableHeight:ae});const ge=await p.getDimensions(s.floating);return B!==ge.width||R!==ge.height?{reset:{rects:!0}}:{}}}};function zI(){return typeof window<"u"}function gb(e){return bee(e)?(e.nodeName||"").toLowerCase():"#document"}function Dc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Rh(e){var t;return(t=(bee(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function bee(e){return zI()?e instanceof Node||e instanceof Dc(e).Node:!1}function Sd(e){return zI()?e instanceof Element||e instanceof Dc(e).Element:!1}function Ah(e){return zI()?e instanceof HTMLElement||e instanceof Dc(e).HTMLElement:!1}function WG(e){return!zI()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Dc(e).ShadowRoot}const r0e=new Set(["inline","contents"]);function U2(e){const{overflow:t,overflowX:r,overflowY:n,display:a}=Td(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!r0e.has(a)}const n0e=new Set(["table","td","th"]);function i0e(e){return n0e.has(gb(e))}const s0e=[":popover-open",":modal"];function BI(e){return s0e.some(t=>{try{return e.matches(t)}catch{return!1}})}const a0e=["transform","translate","scale","rotate","perspective"],o0e=["transform","translate","scale","rotate","perspective","filter"],l0e=["paint","layout","strict","content"];function d4(e){const t=h4(),r=Sd(e)?Td(e):e;return a0e.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||o0e.some(n=>(r.willChange||"").includes(n))||l0e.some(n=>(r.contain||"").includes(n))}function c0e(e){let t=Om(e);for(;Ah(t)&&!A0(t);){if(d4(t))return t;if(BI(t))return null;t=Om(t)}return null}function h4(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const u0e=new Set(["html","body","#document"]);function A0(e){return u0e.has(gb(e))}function Td(e){return Dc(e).getComputedStyle(e)}function $I(e){return Sd(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Om(e){if(gb(e)==="html")return e;const t=e.assignedSlot||e.parentNode||WG(e)&&e.host||Rh(e);return WG(t)?t.host:t}function wee(e){const t=Om(e);return A0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ah(t)&&U2(t)?t:wee(t)}function jT(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const a=wee(e),d=a===((n=e.ownerDocument)==null?void 0:n.body),p=Dc(a);if(d){const s=p3(p);return t.concat(p,p.visualViewport||[],U2(a)?a:[],s&&r?jT(s):[])}return t.concat(a,jT(a,[],r))}function p3(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function See(e){const t=Td(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=Ah(e),d=a?e.offsetWidth:r,p=a?e.offsetHeight:n,s=RP(r)!==d||RP(n)!==p;return s&&(r=d,n=p),{width:r,height:n,$:s}}function f4(e){return Sd(e)?e:e.contextElement}function Hx(e){const t=f4(e);if(!Ah(t))return bh(1);const r=t.getBoundingClientRect(),{width:n,height:a,$:d}=See(t);let p=(d?RP(r.width):r.width)/n,s=(d?RP(r.height):r.height)/a;return(!p||!Number.isFinite(p))&&(p=1),(!s||!Number.isFinite(s))&&(s=1),{x:p,y:s}}const d0e=bh(0);function Tee(e){const t=Dc(e);return!h4()||!t.visualViewport?d0e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function h0e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Dc(e)?!1:t}function nv(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const a=e.getBoundingClientRect(),d=f4(e);let p=bh(1);t&&(n?Sd(n)&&(p=Hx(n)):p=Hx(e));const s=h0e(d,r,n)?Tee(d):bh(0);let _=(a.left+s.x)/p.x,b=(a.top+s.y)/p.y,T=a.width/p.x,C=a.height/p.y;if(d){const P=Dc(d),k=n&&Sd(n)?Dc(n):n;let B=P,R=p3(B);for(;R&&n&&k!==B;){const D=Hx(R),G=R.getBoundingClientRect(),V=Td(R),$=G.left+(R.clientLeft+parseFloat(V.paddingLeft))*D.x,K=G.top+(R.clientTop+parseFloat(V.paddingTop))*D.y;_*=D.x,b*=D.y,T*=D.x,C*=D.y,_+=$,b+=K,B=Dc(R),R=p3(B)}}return DP({width:T,height:C,x:_,y:b})}function p4(e,t){const r=$I(e).scrollLeft;return t?t.left+r:nv(Rh(e)).left+r}function Eee(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),a=n.left+t.scrollLeft-(r?0:p4(e,n)),d=n.top+t.scrollTop;return{x:a,y:d}}function f0e(e){let{elements:t,rect:r,offsetParent:n,strategy:a}=e;const d=a==="fixed",p=Rh(n),s=t?BI(t.floating):!1;if(n===p||s&&d)return r;let _={scrollLeft:0,scrollTop:0},b=bh(1);const T=bh(0),C=Ah(n);if((C||!C&&!d)&&((gb(n)!=="body"||U2(p))&&(_=$I(n)),Ah(n))){const k=nv(n);b=Hx(n),T.x=k.x+n.clientLeft,T.y=k.y+n.clientTop}const P=p&&!C&&!d?Eee(p,_,!0):bh(0);return{width:r.width*b.x,height:r.height*b.y,x:r.x*b.x-_.scrollLeft*b.x+T.x+P.x,y:r.y*b.y-_.scrollTop*b.y+T.y+P.y}}function p0e(e){return Array.from(e.getClientRects())}function m0e(e){const t=Rh(e),r=$I(e),n=e.ownerDocument.body,a=Cc(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),d=Cc(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let p=-r.scrollLeft+p4(e);const s=-r.scrollTop;return Td(n).direction==="rtl"&&(p+=Cc(t.clientWidth,n.clientWidth)-a),{width:a,height:d,x:p,y:s}}function g0e(e,t){const r=Dc(e),n=Rh(e),a=r.visualViewport;let d=n.clientWidth,p=n.clientHeight,s=0,_=0;if(a){d=a.width,p=a.height;const b=h4();(!b||b&&t==="fixed")&&(s=a.offsetLeft,_=a.offsetTop)}return{width:d,height:p,x:s,y:_}}const y0e=new Set(["absolute","fixed"]);function v0e(e,t){const r=nv(e,!0,t==="fixed"),n=r.top+e.clientTop,a=r.left+e.clientLeft,d=Ah(e)?Hx(e):bh(1),p=e.clientWidth*d.x,s=e.clientHeight*d.y,_=a*d.x,b=n*d.y;return{width:p,height:s,x:_,y:b}}function HG(e,t,r){let n;if(t==="viewport")n=g0e(e,r);else if(t==="document")n=m0e(Rh(e));else if(Sd(t))n=v0e(t,r);else{const a=Tee(e);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return DP(n)}function jee(e,t){const r=Om(e);return r===t||!Sd(r)||A0(r)?!1:Td(r).position==="fixed"||jee(r,t)}function _0e(e,t){const r=t.get(e);if(r)return r;let n=jT(e,[],!1).filter(s=>Sd(s)&&gb(s)!=="body"),a=null;const d=Td(e).position==="fixed";let p=d?Om(e):e;for(;Sd(p)&&!A0(p);){const s=Td(p),_=d4(p);!_&&s.position==="fixed"&&(a=null),(d?!_&&!a:!_&&s.position==="static"&&!!a&&y0e.has(a.position)||U2(p)&&!_&&jee(e,p))?n=n.filter(T=>T!==p):a=s,p=Om(p)}return t.set(e,n),n}function x0e(e){let{element:t,boundary:r,rootBoundary:n,strategy:a}=e;const p=[...r==="clippingAncestors"?BI(t)?[]:_0e(t,this._c):[].concat(r),n],s=p[0],_=p.reduce((b,T)=>{const C=HG(t,T,a);return b.top=Cc(C.top,b.top),b.right=km(C.right,b.right),b.bottom=km(C.bottom,b.bottom),b.left=Cc(C.left,b.left),b},HG(t,s,a));return{width:_.right-_.left,height:_.bottom-_.top,x:_.left,y:_.top}}function b0e(e){const{width:t,height:r}=See(e);return{width:t,height:r}}function w0e(e,t,r){const n=Ah(t),a=Rh(t),d=r==="fixed",p=nv(e,!0,d,t);let s={scrollLeft:0,scrollTop:0};const _=bh(0);function b(){_.x=p4(a)}if(n||!n&&!d)if((gb(t)!=="body"||U2(a))&&(s=$I(t)),n){const k=nv(t,!0,d,t);_.x=k.x+t.clientLeft,_.y=k.y+t.clientTop}else a&&b();d&&!n&&a&&b();const T=a&&!n&&!d?Eee(a,s):bh(0),C=p.left+s.scrollLeft-_.x-T.x,P=p.top+s.scrollTop-_.y-T.y;return{x:C,y:P,width:p.width,height:p.height}}function ZM(e){return Td(e).position==="static"}function ZG(e,t){if(!Ah(e)||Td(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Rh(e)===r&&(r=r.ownerDocument.body),r}function Aee(e,t){const r=Dc(e);if(BI(e))return r;if(!Ah(e)){let a=Om(e);for(;a&&!A0(a);){if(Sd(a)&&!ZM(a))return a;a=Om(a)}return r}let n=ZG(e,t);for(;n&&i0e(n)&&ZM(n);)n=ZG(n,t);return n&&A0(n)&&ZM(n)&&!d4(n)?r:n||c0e(e)||r}const S0e=async function(e){const t=this.getOffsetParent||Aee,r=this.getDimensions,n=await r(e.floating);return{reference:w0e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function T0e(e){return Td(e).direction==="rtl"}const E0e={convertOffsetParentRelativeRectToViewportRelativeRect:f0e,getDocumentElement:Rh,getClippingRect:x0e,getOffsetParent:Aee,getElementRects:S0e,getClientRects:p0e,getDimensions:b0e,getScale:Hx,isElement:Sd,isRTL:T0e};function Cee(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function j0e(e,t){let r=null,n;const a=Rh(e);function d(){var s;clearTimeout(n),(s=r)==null||s.disconnect(),r=null}function p(s,_){s===void 0&&(s=!1),_===void 0&&(_=1),d();const b=e.getBoundingClientRect(),{left:T,top:C,width:P,height:k}=b;if(s||t(),!P||!k)return;const B=lC(C),R=lC(a.clientWidth-(T+P)),D=lC(a.clientHeight-(C+k)),G=lC(T),$={rootMargin:-B+"px "+-R+"px "+-D+"px "+-G+"px",threshold:Cc(0,km(1,_))||1};let K=!0;function Y(ee){const ae=ee[0].intersectionRatio;if(ae!==_){if(!K)return p();ae?p(!1,ae):n=setTimeout(()=>{p(!1,1e-7)},1e3)}ae===1&&!Cee(b,e.getBoundingClientRect())&&p(),K=!1}try{r=new IntersectionObserver(Y,{...$,root:a.ownerDocument})}catch{r=new IntersectionObserver(Y,$)}r.observe(e)}return p(!0),d}function A0e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:d=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:_=!1}=n,b=f4(e),T=a||d?[...b?jT(b):[],...jT(t)]:[];T.forEach(G=>{a&&G.addEventListener("scroll",r,{passive:!0}),d&&G.addEventListener("resize",r)});const C=b&&s?j0e(b,r):null;let P=-1,k=null;p&&(k=new ResizeObserver(G=>{let[V]=G;V&&V.target===b&&k&&(k.unobserve(t),cancelAnimationFrame(P),P=requestAnimationFrame(()=>{var $;($=k)==null||$.observe(t)})),r()}),b&&!_&&k.observe(b),k.observe(t));let B,R=_?nv(e):null;_&&D();function D(){const G=nv(e);R&&!Cee(R,G)&&r(),R=G,B=requestAnimationFrame(D)}return r(),()=>{var G;T.forEach(V=>{a&&V.removeEventListener("scroll",r),d&&V.removeEventListener("resize",r)}),C==null||C(),(G=k)==null||G.disconnect(),k=null,_&&cancelAnimationFrame(B)}}const C0e=Jxe,P0e=Qxe,N0e=Xxe,I0e=t0e,k0e=Kxe,XG=Zxe,O0e=e0e,R0e=(e,t,r)=>{const n=new Map,a={platform:E0e,...r},d={...a.platform,_c:n};return Hxe(e,t,{...a,platform:d})};var M0e=typeof document<"u",D0e=function(){},JC=M0e?F.useLayoutEffect:D0e;function LP(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!LP(e[n],t[n]))return!1;return!0}if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,a[n]))return!1;for(n=r;n--!==0;){const d=a[n];if(!(d==="_owner"&&e.$$typeof)&&!LP(e[d],t[d]))return!1}return!0}return e!==e&&t!==t}function Pee(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function KG(e,t){const r=Pee(e);return Math.round(t*r)/r}function XM(e){const t=F.useRef(e);return JC(()=>{t.current=e}),t}function L0e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:d,floating:p}={},transform:s=!0,whileElementsMounted:_,open:b}=e,[T,C]=F.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[P,k]=F.useState(n);LP(P,n)||k(n);const[B,R]=F.useState(null),[D,G]=F.useState(null),V=F.useCallback(Ve=>{Ve!==ee.current&&(ee.current=Ve,R(Ve))},[]),$=F.useCallback(Ve=>{Ve!==ae.current&&(ae.current=Ve,G(Ve))},[]),K=d||B,Y=p||D,ee=F.useRef(null),ae=F.useRef(null),ie=F.useRef(T),ge=_!=null,fe=XM(_),be=XM(a),ue=XM(b),Ce=F.useCallback(()=>{if(!ee.current||!ae.current)return;const Ve={placement:t,strategy:r,middleware:P};be.current&&(Ve.platform=be.current),R0e(ee.current,ae.current,Ve).then(We=>{const Ee={...We,isPositioned:ue.current!==!1};ve.current&&!LP(ie.current,Ee)&&(ie.current=Ee,_v.flushSync(()=>{C(Ee)}))})},[P,t,r,be,ue]);JC(()=>{b===!1&&ie.current.isPositioned&&(ie.current.isPositioned=!1,C(Ve=>({...Ve,isPositioned:!1})))},[b]);const ve=F.useRef(!1);JC(()=>(ve.current=!0,()=>{ve.current=!1}),[]),JC(()=>{if(K&&(ee.current=K),Y&&(ae.current=Y),K&&Y){if(fe.current)return fe.current(K,Y,Ce);Ce()}},[K,Y,Ce,fe,ge]);const ze=F.useMemo(()=>({reference:ee,floating:ae,setReference:V,setFloating:$}),[V,$]),Me=F.useMemo(()=>({reference:K,floating:Y}),[K,Y]),Be=F.useMemo(()=>{const Ve={position:r,left:0,top:0};if(!Me.floating)return Ve;const We=KG(Me.floating,T.x),Ee=KG(Me.floating,T.y);return s?{...Ve,transform:"translate("+We+"px, "+Ee+"px)",...Pee(Me.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:We,top:Ee}},[r,s,Me.floating,T.x,T.y]);return F.useMemo(()=>({...T,update:Ce,refs:ze,elements:Me,floatingStyles:Be}),[T,Ce,ze,Me,Be])}const F0e=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:a}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?XG({element:n.current,padding:a}).fn(r):{}:n?XG({element:n,padding:a}).fn(r):{}}}},z0e=(e,t)=>({...C0e(e),options:[e,t]}),B0e=(e,t)=>({...P0e(e),options:[e,t]}),$0e=(e,t)=>({...O0e(e),options:[e,t]}),V0e=(e,t)=>({...N0e(e),options:[e,t]}),U0e=(e,t)=>({...I0e(e),options:[e,t]}),q0e=(e,t)=>({...k0e(e),options:[e,t]}),G0e=(e,t)=>({...F0e(e),options:[e,t]});var W0e="Arrow",Nee=F.forwardRef((e,t)=>{const{children:r,width:n=10,height:a=5,...d}=e;return c.jsx(vn.svg,{...d,ref:t,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:c.jsx("polygon",{points:"0,0 30,0 15,10"})})});Nee.displayName=W0e;var H0e=Nee;function Iee(e){const[t,r]=F.useState(void 0);return Sa(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const d=a[0];let p,s;if("borderBoxSize"in d){const _=d.borderBoxSize,b=Array.isArray(_)?_[0]:_;p=b.inlineSize,s=b.blockSize}else p=e.offsetWidth,s=e.offsetHeight;r({width:p,height:s})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var m4="Popper",[kee,yb]=hc(m4),[Z0e,Oee]=kee(m4),Ree=e=>{const{__scopePopper:t,children:r}=e,[n,a]=F.useState(null);return c.jsx(Z0e,{scope:t,anchor:n,onAnchorChange:a,children:r})};Ree.displayName=m4;var Mee="PopperAnchor",Dee=F.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...a}=e,d=Oee(Mee,r),p=F.useRef(null),s=Ti(t,p);return F.useEffect(()=>{d.onAnchorChange((n==null?void 0:n.current)||p.current)}),n?null:c.jsx(vn.div,{...a,ref:s})});Dee.displayName=Mee;var g4="PopperContent",[X0e,K0e]=kee(g4),Lee=F.forwardRef((e,t)=>{var Gt,Pr,Ot,nr,ur,Et;const{__scopePopper:r,side:n="bottom",sideOffset:a=0,align:d="center",alignOffset:p=0,arrowPadding:s=0,avoidCollisions:_=!0,collisionBoundary:b=[],collisionPadding:T=0,sticky:C="partial",hideWhenDetached:P=!1,updatePositionStrategy:k="optimized",onPlaced:B,...R}=e,D=Oee(g4,r),[G,V]=F.useState(null),$=Ti(t,pr=>V(pr)),[K,Y]=F.useState(null),ee=Iee(K),ae=(ee==null?void 0:ee.width)??0,ie=(ee==null?void 0:ee.height)??0,ge=n+(d!=="center"?"-"+d:""),fe=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},be=Array.isArray(b)?b:[b],ue=be.length>0,Ce={padding:fe,boundary:be.filter(J0e),altBoundary:ue},{refs:ve,floatingStyles:ze,placement:Me,isPositioned:Be,middlewareData:Ve}=L0e({strategy:"fixed",placement:ge,whileElementsMounted:(...pr)=>A0e(...pr,{animationFrame:k==="always"}),elements:{reference:D.anchor},middleware:[z0e({mainAxis:a+ie,alignmentAxis:p}),_&&B0e({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?$0e():void 0,...Ce}),_&&V0e({...Ce}),U0e({...Ce,apply:({elements:pr,rects:Kr,availableWidth:Xn,availableHeight:Jn})=>{const{width:ni,height:zn}=Kr.reference,hs=pr.floating.style;hs.setProperty("--radix-popper-available-width",`${Xn}px`),hs.setProperty("--radix-popper-available-height",`${Jn}px`),hs.setProperty("--radix-popper-anchor-width",`${ni}px`),hs.setProperty("--radix-popper-anchor-height",`${zn}px`)}}),K&&G0e({element:K,padding:s}),Q0e({arrowWidth:ae,arrowHeight:ie}),P&&q0e({strategy:"referenceHidden",...Ce})]}),[We,Ee]=Bee(Me),ot=Bl(B);Sa(()=>{Be&&(ot==null||ot())},[Be,ot]);const yt=(Gt=Ve.arrow)==null?void 0:Gt.x,Je=(Pr=Ve.arrow)==null?void 0:Pr.y,Bt=((Ot=Ve.arrow)==null?void 0:Ot.centerOffset)!==0,[Pt,pt]=F.useState();return Sa(()=>{G&&pt(window.getComputedStyle(G).zIndex)},[G]),c.jsx("div",{ref:ve.setFloating,"data-radix-popper-content-wrapper":"",style:{...ze,transform:Be?ze.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Pt,"--radix-popper-transform-origin":[(nr=Ve.transformOrigin)==null?void 0:nr.x,(ur=Ve.transformOrigin)==null?void 0:ur.y].join(" "),...((Et=Ve.hide)==null?void 0:Et.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:c.jsx(X0e,{scope:r,placedSide:We,onArrowChange:Y,arrowX:yt,arrowY:Je,shouldHideArrow:Bt,children:c.jsx(vn.div,{"data-side":We,"data-align":Ee,...R,ref:$,style:{...R.style,animation:Be?void 0:"none"}})})})});Lee.displayName=g4;var Fee="PopperArrow",Y0e={top:"bottom",right:"left",bottom:"top",left:"right"},zee=F.forwardRef(function(t,r){const{__scopePopper:n,...a}=t,d=K0e(Fee,n),p=Y0e[d.placedSide];return c.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:c.jsx(H0e,{...a,ref:r,style:{...a.style,display:"block"}})})});zee.displayName=Fee;function J0e(e){return e!==null}var Q0e=e=>({name:"transformOrigin",options:e,fn(t){var D,G,V;const{placement:r,rects:n,middlewareData:a}=t,p=((D=a.arrow)==null?void 0:D.centerOffset)!==0,s=p?0:e.arrowWidth,_=p?0:e.arrowHeight,[b,T]=Bee(r),C={start:"0%",center:"50%",end:"100%"}[T],P=(((G=a.arrow)==null?void 0:G.x)??0)+s/2,k=(((V=a.arrow)==null?void 0:V.y)??0)+_/2;let B="",R="";return b==="bottom"?(B=p?C:`${P}px`,R=`${-_}px`):b==="top"?(B=p?C:`${P}px`,R=`${n.floating.height+_}px`):b==="right"?(B=`${-_}px`,R=p?C:`${k}px`):b==="left"&&(B=`${n.floating.width+_}px`,R=p?C:`${k}px`),{data:{x:B,y:R}}}});function Bee(e){const[t,r="center"]=e.split("-");return[t,r]}var $ee=Ree,y4=Dee,v4=Lee,_4=zee,[VI]=hc("Tooltip",[yb]),x4=yb(),Vee="TooltipProvider",ebe=700,YG="tooltip.open",[tbe,Uee]=VI(Vee),qee=e=>{const{__scopeTooltip:t,delayDuration:r=ebe,skipDelayDuration:n=300,disableHoverableContent:a=!1,children:d}=e,p=F.useRef(!0),s=F.useRef(!1),_=F.useRef(0);return F.useEffect(()=>{const b=_.current;return()=>window.clearTimeout(b)},[]),c.jsx(tbe,{scope:t,isOpenDelayedRef:p,delayDuration:r,onOpen:F.useCallback(()=>{window.clearTimeout(_.current),p.current=!1},[]),onClose:F.useCallback(()=>{window.clearTimeout(_.current),_.current=window.setTimeout(()=>p.current=!0,n)},[n]),isPointerInTransitRef:s,onPointerInTransitChange:F.useCallback(b=>{s.current=b},[]),disableHoverableContent:a,children:d})};qee.displayName=Vee;var Gee="Tooltip",[Rit,UI]=VI(Gee),m3="TooltipTrigger",rbe=F.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,a=UI(m3,r),d=Uee(m3,r),p=x4(r),s=F.useRef(null),_=Ti(t,s,a.onTriggerChange),b=F.useRef(!1),T=F.useRef(!1),C=F.useCallback(()=>b.current=!1,[]);return F.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),c.jsx(y4,{asChild:!0,...p,children:c.jsx(vn.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...n,ref:_,onPointerMove:Fr(e.onPointerMove,P=>{P.pointerType!=="touch"&&!T.current&&!d.isPointerInTransitRef.current&&(a.onTriggerEnter(),T.current=!0)}),onPointerLeave:Fr(e.onPointerLeave,()=>{a.onTriggerLeave(),T.current=!1}),onPointerDown:Fr(e.onPointerDown,()=>{a.open&&a.onClose(),b.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:Fr(e.onFocus,()=>{b.current||a.onOpen()}),onBlur:Fr(e.onBlur,a.onClose),onClick:Fr(e.onClick,a.onClose)})})});rbe.displayName=m3;var nbe="TooltipPortal",[Mit,ibe]=VI(nbe,{forceMount:void 0}),C0="TooltipContent",Wee=F.forwardRef((e,t)=>{const r=ibe(C0,e.__scopeTooltip),{forceMount:n=r.forceMount,side:a="top",...d}=e,p=UI(C0,e.__scopeTooltip);return c.jsx(Cu,{present:n||p.open,children:p.disableHoverableContent?c.jsx(Hee,{side:a,...d,ref:t}):c.jsx(sbe,{side:a,...d,ref:t})})}),sbe=F.forwardRef((e,t)=>{const r=UI(C0,e.__scopeTooltip),n=Uee(C0,e.__scopeTooltip),a=F.useRef(null),d=Ti(t,a),[p,s]=F.useState(null),{trigger:_,onClose:b}=r,T=a.current,{onPointerInTransitChange:C}=n,P=F.useCallback(()=>{s(null),C(!1)},[C]),k=F.useCallback((B,R)=>{const D=B.currentTarget,G={x:B.clientX,y:B.clientY},V=ube(G,D.getBoundingClientRect()),$=dbe(G,V),K=hbe(R.getBoundingClientRect()),Y=pbe([...$,...K]);s(Y),C(!0)},[C]);return F.useEffect(()=>()=>P(),[P]),F.useEffect(()=>{if(_&&T){const B=D=>k(D,T),R=D=>k(D,_);return _.addEventListener("pointerleave",B),T.addEventListener("pointerleave",R),()=>{_.removeEventListener("pointerleave",B),T.removeEventListener("pointerleave",R)}}},[_,T,k,P]),F.useEffect(()=>{if(p){const B=R=>{const D=R.target,G={x:R.clientX,y:R.clientY},V=(_==null?void 0:_.contains(D))||(T==null?void 0:T.contains(D)),$=!fbe(G,p);V?P():$&&(P(),b())};return document.addEventListener("pointermove",B),()=>document.removeEventListener("pointermove",B)}},[_,T,p,b,P]),c.jsx(Hee,{...e,ref:d})}),[abe,obe]=VI(Gee,{isInside:!1}),lbe=IQ("TooltipContent"),Hee=F.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":a,onEscapeKeyDown:d,onPointerDownOutside:p,...s}=e,_=UI(C0,r),b=x4(r),{onClose:T}=_;return F.useEffect(()=>(document.addEventListener(YG,T),()=>document.removeEventListener(YG,T)),[T]),F.useEffect(()=>{if(_.trigger){const C=P=>{const k=P.target;k!=null&&k.contains(_.trigger)&&T()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[_.trigger,T]),c.jsx(hb,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:C=>C.preventDefault(),onDismiss:T,children:c.jsxs(v4,{"data-state":_.stateAttribute,...b,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[c.jsx(lbe,{children:n}),c.jsx(abe,{scope:r,isInside:!0,children:c.jsx(uve,{id:_.contentId,role:"tooltip",children:a||n})})]})})});Wee.displayName=C0;var Zee="TooltipArrow",cbe=F.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,a=x4(r);return obe(Zee,r).isInside?null:c.jsx(_4,{...a,...n,ref:t})});cbe.displayName=Zee;function ube(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),d=Math.abs(t.left-e.x);switch(Math.min(r,n,a,d)){case d:return"left";case a:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function dbe(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function hbe(e){const{top:t,right:r,bottom:n,left:a}=e;return[{x:a,y:t},{x:r,y:t},{x:r,y:n},{x:a,y:n}]}function fbe(e,t){const{x:r,y:n}=e;let a=!1;for(let d=0,p=t.length-1;d<t.length;p=d++){const s=t[d],_=t[p],b=s.x,T=s.y,C=_.x,P=_.y;T>n!=P>n&&r<(C-b)*(n-T)/(P-T)+b&&(a=!a)}return a}function pbe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),mbe(t)}function mbe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const a=e[n];for(;t.length>=2;){const d=t[t.length-1],p=t[t.length-2];if((d.x-p.x)*(a.y-p.y)>=(d.y-p.y)*(a.x-p.x))t.pop();else break}t.push(a)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const a=e[n];for(;r.length>=2;){const d=r[r.length-1],p=r[r.length-2];if((d.x-p.x)*(a.y-p.y)>=(d.y-p.y)*(a.x-p.x))r.pop();else break}r.push(a)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var gbe=qee,Xee=Wee;const ybe=gbe,vbe=F.forwardRef(({className:e,sideOffset:t=4,...r},n)=>c.jsx(Xee,{ref:n,sideOffset:t,className:Dr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));vbe.displayName=Xee.displayName;var q2=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},iv=typeof window>"u"||"Deno"in globalThis;function rc(){}function _be(e,t){return typeof e=="function"?e(t):e}function g3(e){return typeof e=="number"&&e>=0&&e!==1/0}function Kee(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Tm(e,t){return typeof e=="function"?e(t):e}function pu(e,t){return typeof e=="function"?e(t):e}function JG(e,t){const{type:r="all",exact:n,fetchStatus:a,predicate:d,queryKey:p,stale:s}=e;if(p){if(n){if(t.queryHash!==b4(p,t.options))return!1}else if(!CT(t.queryKey,p))return!1}if(r!=="all"){const _=t.isActive();if(r==="active"&&!_||r==="inactive"&&_)return!1}return!(typeof s=="boolean"&&t.isStale()!==s||a&&a!==t.state.fetchStatus||d&&!d(t))}function QG(e,t){const{exact:r,status:n,predicate:a,mutationKey:d}=e;if(d){if(!t.options.mutationKey)return!1;if(r){if(AT(t.options.mutationKey)!==AT(d))return!1}else if(!CT(t.options.mutationKey,d))return!1}return!(n&&t.state.status!==n||a&&!a(t))}function b4(e,t){return((t==null?void 0:t.queryKeyHashFn)||AT)(e)}function AT(e){return JSON.stringify(e,(t,r)=>v3(r)?Object.keys(r).sort().reduce((n,a)=>(n[a]=r[a],n),{}):r)}function CT(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>CT(e[r],t[r])):!1}function Yee(e,t){if(e===t)return e;const r=eW(e)&&eW(t);if(r||v3(e)&&v3(t)){const n=r?e:Object.keys(e),a=n.length,d=r?t:Object.keys(t),p=d.length,s=r?[]:{},_=new Set(n);let b=0;for(let T=0;T<p;T++){const C=r?T:d[T];(!r&&_.has(C)||r)&&e[C]===void 0&&t[C]===void 0?(s[C]=void 0,b++):(s[C]=Yee(e[C],t[C]),s[C]===e[C]&&e[C]!==void 0&&b++)}return a===p&&b===a?e:s}return t}function y3(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function eW(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function v3(e){if(!tW(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!tW(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function tW(e){return Object.prototype.toString.call(e)==="[object Object]"}function xbe(e){return new Promise(t=>{setTimeout(t,e)})}function _3(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?Yee(e,t):t}function bbe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function wbe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var w4=Symbol();function Jee(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===w4?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Sbe(e,t){return typeof e=="function"?e(...t):!!e}var My,tm,n0,sY,Tbe=(sY=class extends q2{constructor(){super();Fn(this,My);Fn(this,tm);Fn(this,n0);rn(this,n0,t=>{if(!iv&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){St(this,tm)||this.setEventListener(St(this,n0))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,tm))==null||t.call(this),rn(this,tm,void 0))}setEventListener(t){var r;rn(this,n0,t),(r=St(this,tm))==null||r.call(this),rn(this,tm,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){St(this,My)!==t&&(rn(this,My,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof St(this,My)=="boolean"?St(this,My):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},My=new WeakMap,tm=new WeakMap,n0=new WeakMap,sY),S4=new Tbe,i0,rm,s0,aY,Ebe=(aY=class extends q2{constructor(){super();Fn(this,i0,!0);Fn(this,rm);Fn(this,s0);rn(this,s0,t=>{if(!iv&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){St(this,rm)||this.setEventListener(St(this,s0))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,rm))==null||t.call(this),rn(this,rm,void 0))}setEventListener(t){var r;rn(this,s0,t),(r=St(this,rm))==null||r.call(this),rn(this,rm,t(this.setOnline.bind(this)))}setOnline(t){St(this,i0)!==t&&(rn(this,i0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return St(this,i0)}},i0=new WeakMap,rm=new WeakMap,s0=new WeakMap,aY),FP=new Ebe;function x3(){let e,t;const r=new Promise((a,d)=>{e=a,t=d});r.status="pending",r.catch(()=>{});function n(a){Object.assign(r,a),delete r.resolve,delete r.reject}return r.resolve=a=>{n({status:"fulfilled",value:a}),e(a)},r.reject=a=>{n({status:"rejected",reason:a}),t(a)},r}function jbe(e){return Math.min(1e3*2**e,3e4)}function Qee(e){return(e??"online")==="online"?FP.isOnline():!0}var ete=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function KM(e){return e instanceof ete}function tte(e){let t=!1,r=0,n=!1,a;const d=x3(),p=R=>{var D;n||(P(new ete(R)),(D=e.abort)==null||D.call(e))},s=()=>{t=!0},_=()=>{t=!1},b=()=>S4.isFocused()&&(e.networkMode==="always"||FP.isOnline())&&e.canRun(),T=()=>Qee(e.networkMode)&&e.canRun(),C=R=>{var D;n||(n=!0,(D=e.onSuccess)==null||D.call(e,R),a==null||a(),d.resolve(R))},P=R=>{var D;n||(n=!0,(D=e.onError)==null||D.call(e,R),a==null||a(),d.reject(R))},k=()=>new Promise(R=>{var D;a=G=>{(n||b())&&R(G)},(D=e.onPause)==null||D.call(e)}).then(()=>{var R;a=void 0,n||(R=e.onContinue)==null||R.call(e)}),B=()=>{if(n)return;let R;const D=r===0?e.initialPromise:void 0;try{R=D??e.fn()}catch(G){R=Promise.reject(G)}Promise.resolve(R).then(C).catch(G=>{var ee;if(n)return;const V=e.retry??(iv?0:3),$=e.retryDelay??jbe,K=typeof $=="function"?$(r,G):$,Y=V===!0||typeof V=="number"&&r<V||typeof V=="function"&&V(r,G);if(t||!Y){P(G);return}r++,(ee=e.onFail)==null||ee.call(e,r,G),xbe(K).then(()=>b()?void 0:k()).then(()=>{t?P(G):B()})})};return{promise:d,cancel:p,continue:()=>(a==null||a(),d),cancelRetry:s,continueRetry:_,canStart:T,start:()=>(T()?B():k().then(B),d)}}var Abe=e=>setTimeout(e,0);function Cbe(){let e=[],t=0,r=s=>{s()},n=s=>{s()},a=Abe;const d=s=>{t?e.push(s):a(()=>{r(s)})},p=()=>{const s=e;e=[],s.length&&a(()=>{n(()=>{s.forEach(_=>{r(_)})})})};return{batch:s=>{let _;t++;try{_=s()}finally{t--,t||p()}return _},batchCalls:s=>(..._)=>{d(()=>{s(..._)})},schedule:d,setNotifyFunction:s=>{r=s},setBatchNotifyFunction:s=>{n=s},setScheduler:s=>{a=s}}}var Fo=Cbe(),Dy,oY,rte=(oY=class{constructor(){Fn(this,Dy)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),g3(this.gcTime)&&rn(this,Dy,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(iv?1/0:5*60*1e3))}clearGcTimeout(){St(this,Dy)&&(clearTimeout(St(this,Dy)),rn(this,Dy,void 0))}},Dy=new WeakMap,oY),a0,Ly,fu,Fy,rl,C2,zy,nd,uf,lY,Pbe=(lY=class extends rte{constructor(t){super();Fn(this,nd);Fn(this,a0);Fn(this,Ly);Fn(this,fu);Fn(this,Fy);Fn(this,rl);Fn(this,C2);Fn(this,zy);rn(this,zy,!1),rn(this,C2,t.defaultOptions),this.setOptions(t.options),this.observers=[],rn(this,Fy,t.client),rn(this,fu,St(this,Fy).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,rn(this,a0,Nbe(this.options)),this.state=t.state??St(this,a0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=St(this,rl))==null?void 0:t.promise}setOptions(t){this.options={...St(this,C2),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&St(this,fu).remove(this)}setData(t,r){const n=_3(this.state.data,t,this.options);return Ni(this,nd,uf).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Ni(this,nd,uf).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,a;const r=(n=St(this,rl))==null?void 0:n.promise;return(a=St(this,rl))==null||a.cancel(t),r?r.then(rc).catch(rc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(St(this,a0))}isActive(){return this.observers.some(t=>pu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===w4||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Tm(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Kee(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,rl))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,rl))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),St(this,fu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(St(this,rl)&&(St(this,zy)?St(this,rl).cancel({revert:!0}):St(this,rl).cancelRetry()),this.scheduleGc()),St(this,fu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ni(this,nd,uf).call(this,{type:"invalidate"})}fetch(t,r){var b,T,C;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(St(this,rl))return St(this,rl).continueRetry(),St(this,rl).promise}if(t&&this.setOptions(t),!this.options.queryFn){const P=this.observers.find(k=>k.options.queryFn);P&&this.setOptions(P.options)}const n=new AbortController,a=P=>{Object.defineProperty(P,"signal",{enumerable:!0,get:()=>(rn(this,zy,!0),n.signal)})},d=()=>{const P=Jee(this.options,r),B=(()=>{const R={client:St(this,Fy),queryKey:this.queryKey,meta:this.meta};return a(R),R})();return rn(this,zy,!1),this.options.persister?this.options.persister(P,B,this):P(B)},s=(()=>{const P={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:St(this,Fy),state:this.state,fetchFn:d};return a(P),P})();(b=this.options.behavior)==null||b.onFetch(s,this),rn(this,Ly,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((T=s.fetchOptions)==null?void 0:T.meta))&&Ni(this,nd,uf).call(this,{type:"fetch",meta:(C=s.fetchOptions)==null?void 0:C.meta});const _=P=>{var k,B,R,D;KM(P)&&P.silent||Ni(this,nd,uf).call(this,{type:"error",error:P}),KM(P)||((B=(k=St(this,fu).config).onError)==null||B.call(k,P,this),(D=(R=St(this,fu).config).onSettled)==null||D.call(R,this.state.data,P,this)),this.scheduleGc()};return rn(this,rl,tte({initialPromise:r==null?void 0:r.initialPromise,fn:s.fetchFn,abort:n.abort.bind(n),onSuccess:P=>{var k,B,R,D;if(P===void 0){_(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(P)}catch(G){_(G);return}(B=(k=St(this,fu).config).onSuccess)==null||B.call(k,P,this),(D=(R=St(this,fu).config).onSettled)==null||D.call(R,P,this.state.error,this),this.scheduleGc()},onError:_,onFail:(P,k)=>{Ni(this,nd,uf).call(this,{type:"failed",failureCount:P,error:k})},onPause:()=>{Ni(this,nd,uf).call(this,{type:"pause"})},onContinue:()=>{Ni(this,nd,uf).call(this,{type:"continue"})},retry:s.options.retry,retryDelay:s.options.retryDelay,networkMode:s.options.networkMode,canRun:()=>!0})),St(this,rl).start()}},a0=new WeakMap,Ly=new WeakMap,fu=new WeakMap,Fy=new WeakMap,rl=new WeakMap,C2=new WeakMap,zy=new WeakMap,nd=new WeakSet,uf=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...nte(n.data,this.options),fetchMeta:t.meta??null};case"success":return rn(this,Ly,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=t.error;return KM(a)&&a.revert&&St(this,Ly)?{...St(this,Ly),fetchStatus:"idle"}:{...n,error:a,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),Fo.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),St(this,fu).notify({query:this,type:"updated",action:t})})},lY);function nte(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Qee(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Nbe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ah,cY,Ibe=(cY=class extends q2{constructor(t={}){super();Fn(this,ah);this.config=t,rn(this,ah,new Map)}build(t,r,n){const a=r.queryKey,d=r.queryHash??b4(a,r);let p=this.get(d);return p||(p=new Pbe({client:t,queryKey:a,queryHash:d,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(a)}),this.add(p)),p}add(t){St(this,ah).has(t.queryHash)||(St(this,ah).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=St(this,ah).get(t.queryHash);r&&(t.destroy(),r===t&&St(this,ah).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Fo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return St(this,ah).get(t)}getAll(){return[...St(this,ah).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>JG(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>JG(t,n)):r}notify(t){Fo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Fo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Fo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ah=new WeakMap,cY),oh,Nl,By,lh,Vp,uY,kbe=(uY=class extends rte{constructor(t){super();Fn(this,lh);Fn(this,oh);Fn(this,Nl);Fn(this,By);this.mutationId=t.mutationId,rn(this,Nl,t.mutationCache),rn(this,oh,[]),this.state=t.state||Obe(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){St(this,oh).includes(t)||(St(this,oh).push(t),this.clearGcTimeout(),St(this,Nl).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){rn(this,oh,St(this,oh).filter(r=>r!==t)),this.scheduleGc(),St(this,Nl).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){St(this,oh).length||(this.state.status==="pending"?this.scheduleGc():St(this,Nl).remove(this))}continue(){var t;return((t=St(this,By))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var d,p,s,_,b,T,C,P,k,B,R,D,G,V,$,K,Y,ee,ae,ie;const r=()=>{Ni(this,lh,Vp).call(this,{type:"continue"})};rn(this,By,tte({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ge,fe)=>{Ni(this,lh,Vp).call(this,{type:"failed",failureCount:ge,error:fe})},onPause:()=>{Ni(this,lh,Vp).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>St(this,Nl).canRun(this)}));const n=this.state.status==="pending",a=!St(this,By).canStart();try{if(n)r();else{Ni(this,lh,Vp).call(this,{type:"pending",variables:t,isPaused:a}),await((p=(d=St(this,Nl).config).onMutate)==null?void 0:p.call(d,t,this));const fe=await((_=(s=this.options).onMutate)==null?void 0:_.call(s,t));fe!==this.state.context&&Ni(this,lh,Vp).call(this,{type:"pending",context:fe,variables:t,isPaused:a})}const ge=await St(this,By).start();return await((T=(b=St(this,Nl).config).onSuccess)==null?void 0:T.call(b,ge,t,this.state.context,this)),await((P=(C=this.options).onSuccess)==null?void 0:P.call(C,ge,t,this.state.context)),await((B=(k=St(this,Nl).config).onSettled)==null?void 0:B.call(k,ge,null,this.state.variables,this.state.context,this)),await((D=(R=this.options).onSettled)==null?void 0:D.call(R,ge,null,t,this.state.context)),Ni(this,lh,Vp).call(this,{type:"success",data:ge}),ge}catch(ge){try{throw await((V=(G=St(this,Nl).config).onError)==null?void 0:V.call(G,ge,t,this.state.context,this)),await((K=($=this.options).onError)==null?void 0:K.call($,ge,t,this.state.context)),await((ee=(Y=St(this,Nl).config).onSettled)==null?void 0:ee.call(Y,void 0,ge,this.state.variables,this.state.context,this)),await((ie=(ae=this.options).onSettled)==null?void 0:ie.call(ae,void 0,ge,t,this.state.context)),ge}finally{Ni(this,lh,Vp).call(this,{type:"error",error:ge})}}finally{St(this,Nl).runNext(this)}}},oh=new WeakMap,Nl=new WeakMap,By=new WeakMap,lh=new WeakSet,Vp=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Fo.batch(()=>{St(this,oh).forEach(n=>{n.onMutationUpdate(t)}),St(this,Nl).notify({mutation:this,type:"updated",action:t})})},uY);function Obe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var mf,id,P2,dY,Rbe=(dY=class extends q2{constructor(t={}){super();Fn(this,mf);Fn(this,id);Fn(this,P2);this.config=t,rn(this,mf,new Set),rn(this,id,new Map),rn(this,P2,0)}build(t,r,n){const a=new kbe({mutationCache:this,mutationId:++$A(this,P2)._,options:t.defaultMutationOptions(r),state:n});return this.add(a),a}add(t){St(this,mf).add(t);const r=cC(t);if(typeof r=="string"){const n=St(this,id).get(r);n?n.push(t):St(this,id).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(St(this,mf).delete(t)){const r=cC(t);if(typeof r=="string"){const n=St(this,id).get(r);if(n)if(n.length>1){const a=n.indexOf(t);a!==-1&&n.splice(a,1)}else n[0]===t&&St(this,id).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=cC(t);if(typeof r=="string"){const n=St(this,id).get(r),a=n==null?void 0:n.find(d=>d.state.status==="pending");return!a||a===t}else return!0}runNext(t){var n;const r=cC(t);if(typeof r=="string"){const a=(n=St(this,id).get(r))==null?void 0:n.find(d=>d!==t&&d.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Fo.batch(()=>{St(this,mf).forEach(t=>{this.notify({type:"removed",mutation:t})}),St(this,mf).clear(),St(this,id).clear()})}getAll(){return Array.from(St(this,mf))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>QG(r,n))}findAll(t={}){return this.getAll().filter(r=>QG(t,r))}notify(t){Fo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Fo.batch(()=>Promise.all(t.map(r=>r.continue().catch(rc))))}},mf=new WeakMap,id=new WeakMap,P2=new WeakMap,dY);function cC(e){var t;return(t=e.options.scope)==null?void 0:t.id}function rW(e){return{onFetch:(t,r)=>{var T,C,P,k,B;const n=t.options,a=(P=(C=(T=t.fetchOptions)==null?void 0:T.meta)==null?void 0:C.fetchMore)==null?void 0:P.direction,d=((k=t.state.data)==null?void 0:k.pages)||[],p=((B=t.state.data)==null?void 0:B.pageParams)||[];let s={pages:[],pageParams:[]},_=0;const b=async()=>{let R=!1;const D=$=>{Object.defineProperty($,"signal",{enumerable:!0,get:()=>(t.signal.aborted?R=!0:t.signal.addEventListener("abort",()=>{R=!0}),t.signal)})},G=Jee(t.options,t.fetchOptions),V=async($,K,Y)=>{if(R)return Promise.reject();if(K==null&&$.pages.length)return Promise.resolve($);const ae=(()=>{const be={client:t.client,queryKey:t.queryKey,pageParam:K,direction:Y?"backward":"forward",meta:t.options.meta};return D(be),be})(),ie=await G(ae),{maxPages:ge}=t.options,fe=Y?wbe:bbe;return{pages:fe($.pages,ie,ge),pageParams:fe($.pageParams,K,ge)}};if(a&&d.length){const $=a==="backward",K=$?Mbe:nW,Y={pages:d,pageParams:p},ee=K(n,Y);s=await V(Y,ee,$)}else{const $=e??d.length;do{const K=_===0?p[0]??n.initialPageParam:nW(n,s);if(_>0&&K==null)break;s=await V(s,K),_++}while(_<$)}return s};t.options.persister?t.fetchFn=()=>{var R,D;return(D=(R=t.options).persister)==null?void 0:D.call(R,b,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=b}}}function nW(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Mbe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var da,nm,im,o0,l0,sm,c0,u0,hY,Dbe=(hY=class{constructor(e={}){Fn(this,da);Fn(this,nm);Fn(this,im);Fn(this,o0);Fn(this,l0);Fn(this,sm);Fn(this,c0);Fn(this,u0);rn(this,da,e.queryCache||new Ibe),rn(this,nm,e.mutationCache||new Rbe),rn(this,im,e.defaultOptions||{}),rn(this,o0,new Map),rn(this,l0,new Map),rn(this,sm,0)}mount(){$A(this,sm)._++,St(this,sm)===1&&(rn(this,c0,S4.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,da).onFocus())})),rn(this,u0,FP.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,da).onOnline())})))}unmount(){var e,t;$A(this,sm)._--,St(this,sm)===0&&((e=St(this,c0))==null||e.call(this),rn(this,c0,void 0),(t=St(this,u0))==null||t.call(this),rn(this,u0,void 0))}isFetching(e){return St(this,da).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return St(this,nm).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,da).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=St(this,da).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(Tm(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return St(this,da).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),a=St(this,da).get(n.queryHash),d=a==null?void 0:a.state.data,p=_be(t,d);if(p!==void 0)return St(this,da).build(this,n).setData(p,{...r,manual:!0})}setQueriesData(e,t,r){return Fo.batch(()=>St(this,da).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,da).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=St(this,da);Fo.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=St(this,da);return Fo.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=Fo.batch(()=>St(this,da).findAll(e).map(a=>a.cancel(r)));return Promise.all(n).then(rc).catch(rc)}invalidateQueries(e,t={}){return Fo.batch(()=>(St(this,da).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=Fo.batch(()=>St(this,da).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let d=a.fetch(void 0,r);return r.throwOnError||(d=d.catch(rc)),a.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(n).then(rc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=St(this,da).build(this,t);return r.isStaleByTime(Tm(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(rc).catch(rc)}fetchInfiniteQuery(e){return e.behavior=rW(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(rc).catch(rc)}ensureInfiniteQueryData(e){return e.behavior=rW(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return FP.isOnline()?St(this,nm).resumePausedMutations():Promise.resolve()}getQueryCache(){return St(this,da)}getMutationCache(){return St(this,nm)}getDefaultOptions(){return St(this,im)}setDefaultOptions(e){rn(this,im,e)}setQueryDefaults(e,t){St(this,o0).set(AT(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...St(this,o0).values()],r={};return t.forEach(n=>{CT(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){St(this,l0).set(AT(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...St(this,l0).values()],r={};return t.forEach(n=>{CT(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...St(this,im).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=b4(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===w4&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...St(this,im).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){St(this,da).clear(),St(this,nm).clear()}},da=new WeakMap,nm=new WeakMap,im=new WeakMap,o0=new WeakMap,l0=new WeakMap,sm=new WeakMap,c0=new WeakMap,u0=new WeakMap,hY),Ql,Ii,N2,Il,$y,d0,am,om,I2,h0,f0,Vy,Uy,lm,p0,ss,bS,b3,w3,S3,T3,E3,j3,A3,ite,fY,Lbe=(fY=class extends q2{constructor(t,r){super();Fn(this,ss);Fn(this,Ql);Fn(this,Ii);Fn(this,N2);Fn(this,Il);Fn(this,$y);Fn(this,d0);Fn(this,am);Fn(this,om);Fn(this,I2);Fn(this,h0);Fn(this,f0);Fn(this,Vy);Fn(this,Uy);Fn(this,lm);Fn(this,p0,new Set);this.options=r,rn(this,Ql,t),rn(this,om,null),rn(this,am,x3()),this.options.experimental_prefetchInRender||St(this,am).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(St(this,Ii).addObserver(this),iW(St(this,Ii),this.options)?Ni(this,ss,bS).call(this):this.updateResult(),Ni(this,ss,T3).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return C3(St(this,Ii),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return C3(St(this,Ii),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Ni(this,ss,E3).call(this),Ni(this,ss,j3).call(this),St(this,Ii).removeObserver(this)}setOptions(t){const r=this.options,n=St(this,Ii);if(this.options=St(this,Ql).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof pu(this.options.enabled,St(this,Ii))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Ni(this,ss,A3).call(this),St(this,Ii).setOptions(this.options),r._defaulted&&!y3(this.options,r)&&St(this,Ql).getQueryCache().notify({type:"observerOptionsUpdated",query:St(this,Ii),observer:this});const a=this.hasListeners();a&&sW(St(this,Ii),n,this.options,r)&&Ni(this,ss,bS).call(this),this.updateResult(),a&&(St(this,Ii)!==n||pu(this.options.enabled,St(this,Ii))!==pu(r.enabled,St(this,Ii))||Tm(this.options.staleTime,St(this,Ii))!==Tm(r.staleTime,St(this,Ii)))&&Ni(this,ss,b3).call(this);const d=Ni(this,ss,w3).call(this);a&&(St(this,Ii)!==n||pu(this.options.enabled,St(this,Ii))!==pu(r.enabled,St(this,Ii))||d!==St(this,lm))&&Ni(this,ss,S3).call(this,d)}getOptimisticResult(t){const r=St(this,Ql).getQueryCache().build(St(this,Ql),t),n=this.createResult(r,t);return zbe(this,n)&&(rn(this,Il,n),rn(this,d0,this.options),rn(this,$y,St(this,Ii).state)),n}getCurrentResult(){return St(this,Il)}trackResult(t,r){return new Proxy(t,{get:(n,a)=>(this.trackProp(a),r==null||r(a),Reflect.get(n,a))})}trackProp(t){St(this,p0).add(t)}getCurrentQuery(){return St(this,Ii)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=St(this,Ql).defaultQueryOptions(t),n=St(this,Ql).getQueryCache().build(St(this,Ql),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Ni(this,ss,bS).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),St(this,Il)))}createResult(t,r){var ge;const n=St(this,Ii),a=this.options,d=St(this,Il),p=St(this,$y),s=St(this,d0),b=t!==n?t.state:St(this,N2),{state:T}=t;let C={...T},P=!1,k;if(r._optimisticResults){const fe=this.hasListeners(),be=!fe&&iW(t,r),ue=fe&&sW(t,n,r,a);(be||ue)&&(C={...C,...nte(T.data,t.options)}),r._optimisticResults==="isRestoring"&&(C.fetchStatus="idle")}let{error:B,errorUpdatedAt:R,status:D}=C;k=C.data;let G=!1;if(r.placeholderData!==void 0&&k===void 0&&D==="pending"){let fe;d!=null&&d.isPlaceholderData&&r.placeholderData===(s==null?void 0:s.placeholderData)?(fe=d.data,G=!0):fe=typeof r.placeholderData=="function"?r.placeholderData((ge=St(this,f0))==null?void 0:ge.state.data,St(this,f0)):r.placeholderData,fe!==void 0&&(D="success",k=_3(d==null?void 0:d.data,fe,r),P=!0)}if(r.select&&k!==void 0&&!G)if(d&&k===(p==null?void 0:p.data)&&r.select===St(this,I2))k=St(this,h0);else try{rn(this,I2,r.select),k=r.select(k),k=_3(d==null?void 0:d.data,k,r),rn(this,h0,k),rn(this,om,null)}catch(fe){rn(this,om,fe)}St(this,om)&&(B=St(this,om),k=St(this,h0),R=Date.now(),D="error");const V=C.fetchStatus==="fetching",$=D==="pending",K=D==="error",Y=$&&V,ee=k!==void 0,ie={status:D,fetchStatus:C.fetchStatus,isPending:$,isSuccess:D==="success",isError:K,isInitialLoading:Y,isLoading:Y,data:k,dataUpdatedAt:C.dataUpdatedAt,error:B,errorUpdatedAt:R,failureCount:C.fetchFailureCount,failureReason:C.fetchFailureReason,errorUpdateCount:C.errorUpdateCount,isFetched:C.dataUpdateCount>0||C.errorUpdateCount>0,isFetchedAfterMount:C.dataUpdateCount>b.dataUpdateCount||C.errorUpdateCount>b.errorUpdateCount,isFetching:V,isRefetching:V&&!$,isLoadingError:K&&!ee,isPaused:C.fetchStatus==="paused",isPlaceholderData:P,isRefetchError:K&&ee,isStale:T4(t,r),refetch:this.refetch,promise:St(this,am),isEnabled:pu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const fe=Ce=>{ie.status==="error"?Ce.reject(ie.error):ie.data!==void 0&&Ce.resolve(ie.data)},be=()=>{const Ce=rn(this,am,ie.promise=x3());fe(Ce)},ue=St(this,am);switch(ue.status){case"pending":t.queryHash===n.queryHash&&fe(ue);break;case"fulfilled":(ie.status==="error"||ie.data!==ue.value)&&be();break;case"rejected":(ie.status!=="error"||ie.error!==ue.reason)&&be();break}}return ie}updateResult(){const t=St(this,Il),r=this.createResult(St(this,Ii),this.options);if(rn(this,$y,St(this,Ii).state),rn(this,d0,this.options),St(this,$y).data!==void 0&&rn(this,f0,St(this,Ii)),y3(r,t))return;rn(this,Il,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,d=typeof a=="function"?a():a;if(d==="all"||!d&&!St(this,p0).size)return!0;const p=new Set(d??St(this,p0));return this.options.throwOnError&&p.add("error"),Object.keys(St(this,Il)).some(s=>{const _=s;return St(this,Il)[_]!==t[_]&&p.has(_)})};Ni(this,ss,ite).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Ni(this,ss,T3).call(this)}},Ql=new WeakMap,Ii=new WeakMap,N2=new WeakMap,Il=new WeakMap,$y=new WeakMap,d0=new WeakMap,am=new WeakMap,om=new WeakMap,I2=new WeakMap,h0=new WeakMap,f0=new WeakMap,Vy=new WeakMap,Uy=new WeakMap,lm=new WeakMap,p0=new WeakMap,ss=new WeakSet,bS=function(t){Ni(this,ss,A3).call(this);let r=St(this,Ii).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(rc)),r},b3=function(){Ni(this,ss,E3).call(this);const t=Tm(this.options.staleTime,St(this,Ii));if(iv||St(this,Il).isStale||!g3(t))return;const n=Kee(St(this,Il).dataUpdatedAt,t)+1;rn(this,Vy,setTimeout(()=>{St(this,Il).isStale||this.updateResult()},n))},w3=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(St(this,Ii)):this.options.refetchInterval)??!1},S3=function(t){Ni(this,ss,j3).call(this),rn(this,lm,t),!(iv||pu(this.options.enabled,St(this,Ii))===!1||!g3(St(this,lm))||St(this,lm)===0)&&rn(this,Uy,setInterval(()=>{(this.options.refetchIntervalInBackground||S4.isFocused())&&Ni(this,ss,bS).call(this)},St(this,lm)))},T3=function(){Ni(this,ss,b3).call(this),Ni(this,ss,S3).call(this,Ni(this,ss,w3).call(this))},E3=function(){St(this,Vy)&&(clearTimeout(St(this,Vy)),rn(this,Vy,void 0))},j3=function(){St(this,Uy)&&(clearInterval(St(this,Uy)),rn(this,Uy,void 0))},A3=function(){const t=St(this,Ql).getQueryCache().build(St(this,Ql),this.options);if(t===St(this,Ii))return;const r=St(this,Ii);rn(this,Ii,t),rn(this,N2,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},ite=function(t){Fo.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(St(this,Il))}),St(this,Ql).getQueryCache().notify({query:St(this,Ii),type:"observerResultsUpdated"})})},fY);function Fbe(e,t){return pu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function iW(e,t){return Fbe(e,t)||e.state.data!==void 0&&C3(e,t,t.refetchOnMount)}function C3(e,t,r){if(pu(t.enabled,e)!==!1&&Tm(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&T4(e,t)}return!1}function sW(e,t,r,n){return(e!==t||pu(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&T4(e,r)}function T4(e,t){return pu(t.enabled,e)!==!1&&e.isStaleByTime(Tm(t.staleTime,e))}function zbe(e,t){return!y3(e.getCurrentResult(),t)}var ste=F.createContext(void 0),Bbe=e=>{const t=F.useContext(ste);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},$be=({client:e,children:t})=>(F.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),c.jsx(ste.Provider,{value:e,children:t})),ate=F.createContext(!1),Vbe=()=>F.useContext(ate);ate.Provider;function Ube(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var qbe=F.createContext(Ube()),Gbe=()=>F.useContext(qbe),Wbe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Hbe=e=>{F.useEffect(()=>{e.clearReset()},[e])},Zbe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(a&&e.data===void 0||Sbe(r,[e.error,n])),Xbe=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Kbe=(e,t)=>e.isLoading&&e.isFetching&&!t,Ybe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,aW=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function Jbe(e,t,r){var C,P,k,B,R;const n=Vbe(),a=Gbe(),d=Bbe(),p=d.defaultQueryOptions(e);(P=(C=d.getDefaultOptions().queries)==null?void 0:C._experimental_beforeQuery)==null||P.call(C,p),p._optimisticResults=n?"isRestoring":"optimistic",Xbe(p),Wbe(p,a),Hbe(a);const s=!d.getQueryCache().get(p.queryHash),[_]=F.useState(()=>new t(d,p)),b=_.getOptimisticResult(p),T=!n&&e.subscribed!==!1;if(F.useSyncExternalStore(F.useCallback(D=>{const G=T?_.subscribe(Fo.batchCalls(D)):rc;return _.updateResult(),G},[_,T]),()=>_.getCurrentResult(),()=>_.getCurrentResult()),F.useEffect(()=>{_.setOptions(p)},[p,_]),Ybe(p,b))throw aW(p,_,a);if(Zbe({result:b,errorResetBoundary:a,throwOnError:p.throwOnError,query:d.getQueryCache().get(p.queryHash),suspense:p.suspense}))throw b.error;if((B=(k=d.getDefaultOptions().queries)==null?void 0:k._experimental_afterQuery)==null||B.call(k,p,b),p.experimental_prefetchInRender&&!iv&&Kbe(b,n)){const D=s?aW(p,_,a):(R=d.getQueryCache().get(p.queryHash))==null?void 0:R.promise;D==null||D.catch(rc).finally(()=>{_.updateResult()})}return p.notifyOnChangeProps?b:_.trackResult(b)}function ote(e,t){return Jbe(e,Lbe)}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function PT(){return PT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PT.apply(this,arguments)}var dm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(dm||(dm={}));const oW="popstate";function Qbe(e){e===void 0&&(e={});function t(a,d){let{pathname:p="/",search:s="",hash:_=""}=xv(a.location.hash.substr(1));return!p.startsWith("/")&&!p.startsWith(".")&&(p="/"+p),P3("",{pathname:p,search:s,hash:_},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function r(a,d){let p=a.document.querySelector("base"),s="";if(p&&p.getAttribute("href")){let _=a.location.href,b=_.indexOf("#");s=b===-1?_:_.slice(0,b)}return s+"#"+(typeof d=="string"?d:zP(d))}function n(a,d){E4(a.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(d)+")")}return twe(t,r,n,e)}function La(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function E4(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function ewe(){return Math.random().toString(36).substr(2,8)}function lW(e,t){return{usr:e.state,key:e.key,idx:t}}function P3(e,t,r,n){return r===void 0&&(r=null),PT({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?xv(t):t,{state:r,key:t&&t.key||n||ewe()})}function zP(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function xv(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function twe(e,t,r,n){n===void 0&&(n={});let{window:a=document.defaultView,v5Compat:d=!1}=n,p=a.history,s=dm.Pop,_=null,b=T();b==null&&(b=0,p.replaceState(PT({},p.state,{idx:b}),""));function T(){return(p.state||{idx:null}).idx}function C(){s=dm.Pop;let D=T(),G=D==null?null:D-b;b=D,_&&_({action:s,location:R.location,delta:G})}function P(D,G){s=dm.Push;let V=P3(R.location,D,G);r&&r(V,D),b=T()+1;let $=lW(V,b),K=R.createHref(V);try{p.pushState($,"",K)}catch(Y){if(Y instanceof DOMException&&Y.name==="DataCloneError")throw Y;a.location.assign(K)}d&&_&&_({action:s,location:R.location,delta:1})}function k(D,G){s=dm.Replace;let V=P3(R.location,D,G);r&&r(V,D),b=T();let $=lW(V,b),K=R.createHref(V);p.replaceState($,"",K),d&&_&&_({action:s,location:R.location,delta:0})}function B(D){let G=a.location.origin!=="null"?a.location.origin:a.location.href,V=typeof D=="string"?D:zP(D);return V=V.replace(/ $/,"%20"),La(G,"No window.location.(origin|href) available to create URL for href: "+V),new URL(V,G)}let R={get action(){return s},get location(){return e(a,p)},listen(D){if(_)throw new Error("A history only accepts one active listener");return a.addEventListener(oW,C),_=D,()=>{a.removeEventListener(oW,C),_=null}},createHref(D){return t(a,D)},createURL:B,encodeLocation(D){let G=B(D);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:P,replace:k,go(D){return p.go(D)}};return R}var cW;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(cW||(cW={}));function rwe(e,t,r){return r===void 0&&(r="/"),nwe(e,t,r)}function nwe(e,t,r,n){let a=typeof t=="string"?xv(t):t,d=j4(a.pathname||"/",r);if(d==null)return null;let p=lte(e);iwe(p);let s=null;for(let _=0;s==null&&_<p.length;++_){let b=gwe(d);s=fwe(p[_],b)}return s}function lte(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let a=(d,p,s)=>{let _={relativePath:s===void 0?d.path||"":s,caseSensitive:d.caseSensitive===!0,childrenIndex:p,route:d};_.relativePath.startsWith("/")&&(La(_.relativePath.startsWith(n),'Absolute route path "'+_.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),_.relativePath=_.relativePath.slice(n.length));let b=Em([n,_.relativePath]),T=r.concat(_);d.children&&d.children.length>0&&(La(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+b+'".')),lte(d.children,t,T,b)),!(d.path==null&&!d.index)&&t.push({path:b,score:dwe(b,d.index),routesMeta:T})};return e.forEach((d,p)=>{var s;if(d.path===""||!((s=d.path)!=null&&s.includes("?")))a(d,p);else for(let _ of cte(d.path))a(d,p,_)}),t}function cte(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,a=r.endsWith("?"),d=r.replace(/\?$/,"");if(n.length===0)return a?[d,""]:[d];let p=cte(n.join("/")),s=[];return s.push(...p.map(_=>_===""?d:[d,_].join("/"))),a&&s.push(...p),s.map(_=>e.startsWith("/")&&_===""?"/":_)}function iwe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:hwe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const swe=/^:[\w-]+$/,awe=3,owe=2,lwe=1,cwe=10,uwe=-2,uW=e=>e==="*";function dwe(e,t){let r=e.split("/"),n=r.length;return r.some(uW)&&(n+=uwe),t&&(n+=owe),r.filter(a=>!uW(a)).reduce((a,d)=>a+(swe.test(d)?awe:d===""?lwe:cwe),n)}function hwe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,a)=>n===t[a])?e[e.length-1]-t[t.length-1]:0}function fwe(e,t,r){let{routesMeta:n}=e,a={},d="/",p=[];for(let s=0;s<n.length;++s){let _=n[s],b=s===n.length-1,T=d==="/"?t:t.slice(d.length)||"/",C=pwe({path:_.relativePath,caseSensitive:_.caseSensitive,end:b},T),P=_.route;if(!C)return null;Object.assign(a,C.params),p.push({params:a,pathname:Em([d,C.pathname]),pathnameBase:xwe(Em([d,C.pathnameBase])),route:P}),C.pathnameBase!=="/"&&(d=Em([d,C.pathnameBase]))}return p}function pwe(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=mwe(e.path,e.caseSensitive,e.end),a=t.match(r);if(!a)return null;let d=a[0],p=d.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((b,T,C)=>{let{paramName:P,isOptional:k}=T;if(P==="*"){let R=s[C]||"";p=d.slice(0,d.length-R.length).replace(/(.)\/+$/,"$1")}const B=s[C];return k&&!B?b[P]=void 0:b[P]=(B||"").replace(/%2F/g,"/"),b},{}),pathname:d,pathnameBase:p,pattern:e}}function mwe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),E4(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(p,s,_)=>(n.push({paramName:s,isOptional:_!=null}),_?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),n]}function gwe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return E4(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function j4(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function ywe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:a=""}=typeof e=="string"?xv(e):e;return{pathname:r?r.startsWith("/")?r:vwe(r,t):t,search:bwe(n),hash:wwe(a)}}function vwe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function YM(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function _we(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function ute(e,t){let r=_we(e);return t?r.map((n,a)=>a===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function dte(e,t,r,n){n===void 0&&(n=!1);let a;typeof e=="string"?a=xv(e):(a=PT({},e),La(!a.pathname||!a.pathname.includes("?"),YM("?","pathname","search",a)),La(!a.pathname||!a.pathname.includes("#"),YM("#","pathname","hash",a)),La(!a.search||!a.search.includes("#"),YM("#","search","hash",a)));let d=e===""||a.pathname==="",p=d?"/":a.pathname,s;if(p==null)s=r;else{let C=t.length-1;if(!n&&p.startsWith("..")){let P=p.split("/");for(;P[0]==="..";)P.shift(),C-=1;a.pathname=P.join("/")}s=C>=0?t[C]:"/"}let _=ywe(a,s),b=p&&p!=="/"&&p.endsWith("/"),T=(d||p===".")&&r.endsWith("/");return!_.pathname.endsWith("/")&&(b||T)&&(_.pathname+="/"),_}const Em=e=>e.join("/").replace(/\/\/+/g,"/"),xwe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),bwe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,wwe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Swe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const hte=["post","put","patch","delete"];new Set(hte);const Twe=["get",...hte];new Set(Twe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function NT(){return NT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NT.apply(this,arguments)}const A4=F.createContext(null),Ewe=F.createContext(null),bv=F.createContext(null),qI=F.createContext(null),Wm=F.createContext({outlet:null,matches:[],isDataRoute:!1}),fte=F.createContext(null);function jwe(e,t){let{relative:r}=t===void 0?{}:t;G2()||La(!1);let{basename:n,navigator:a}=F.useContext(bv),{hash:d,pathname:p,search:s}=mte(e,{relative:r}),_=p;return n!=="/"&&(_=p==="/"?n:Em([n,p])),a.createHref({pathname:_,search:s,hash:d})}function G2(){return F.useContext(qI)!=null}function qf(){return G2()||La(!1),F.useContext(qI).location}function pte(e){F.useContext(bv).static||F.useLayoutEffect(e)}function di(){let{isDataRoute:e}=F.useContext(Wm);return e?zwe():Awe()}function Awe(){G2()||La(!1);let e=F.useContext(A4),{basename:t,future:r,navigator:n}=F.useContext(bv),{matches:a}=F.useContext(Wm),{pathname:d}=qf(),p=JSON.stringify(ute(a,r.v7_relativeSplatPath)),s=F.useRef(!1);return pte(()=>{s.current=!0}),F.useCallback(function(b,T){if(T===void 0&&(T={}),!s.current)return;if(typeof b=="number"){n.go(b);return}let C=dte(b,JSON.parse(p),d,T.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:Em([t,C.pathname])),(T.replace?n.replace:n.push)(C,T.state,T)},[t,n,p,d,e])}function GI(){let{matches:e}=F.useContext(Wm),t=e[e.length-1];return t?t.params:{}}function mte(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=F.useContext(bv),{matches:a}=F.useContext(Wm),{pathname:d}=qf(),p=JSON.stringify(ute(a,n.v7_relativeSplatPath));return F.useMemo(()=>dte(e,JSON.parse(p),d,r==="path"),[e,p,d,r])}function Cwe(e,t){return Pwe(e,t)}function Pwe(e,t,r,n){G2()||La(!1);let{navigator:a}=F.useContext(bv),{matches:d}=F.useContext(Wm),p=d[d.length-1],s=p?p.params:{};p&&p.pathname;let _=p?p.pathnameBase:"/";p&&p.route;let b=qf(),T;if(t){var C;let D=typeof t=="string"?xv(t):t;_==="/"||(C=D.pathname)!=null&&C.startsWith(_)||La(!1),T=D}else T=b;let P=T.pathname||"/",k=P;if(_!=="/"){let D=_.replace(/^\//,"").split("/");k="/"+P.replace(/^\//,"").split("/").slice(D.length).join("/")}let B=rwe(e,{pathname:k}),R=Rwe(B&&B.map(D=>Object.assign({},D,{params:Object.assign({},s,D.params),pathname:Em([_,a.encodeLocation?a.encodeLocation(D.pathname).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?_:Em([_,a.encodeLocation?a.encodeLocation(D.pathnameBase).pathname:D.pathnameBase])})),d,r,n);return t&&R?F.createElement(qI.Provider,{value:{location:NT({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:dm.Pop}},R):R}function Nwe(){let e=Fwe(),t=Swe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},t),r?F.createElement("pre",{style:a},r):null,null)}const Iwe=F.createElement(Nwe,null);class kwe extends F.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?F.createElement(Wm.Provider,{value:this.props.routeContext},F.createElement(fte.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Owe(e){let{routeContext:t,match:r,children:n}=e,a=F.useContext(A4);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),F.createElement(Wm.Provider,{value:t},n)}function Rwe(e,t,r,n){var a;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var d;if(!r)return null;if(r.errors)e=r.matches;else if((d=n)!=null&&d.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let p=e,s=(a=r)==null?void 0:a.errors;if(s!=null){let T=p.findIndex(C=>C.route.id&&(s==null?void 0:s[C.route.id])!==void 0);T>=0||La(!1),p=p.slice(0,Math.min(p.length,T+1))}let _=!1,b=-1;if(r&&n&&n.v7_partialHydration)for(let T=0;T<p.length;T++){let C=p[T];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(b=T),C.route.id){let{loaderData:P,errors:k}=r,B=C.route.loader&&P[C.route.id]===void 0&&(!k||k[C.route.id]===void 0);if(C.route.lazy||B){_=!0,b>=0?p=p.slice(0,b+1):p=[p[0]];break}}}return p.reduceRight((T,C,P)=>{let k,B=!1,R=null,D=null;r&&(k=s&&C.route.id?s[C.route.id]:void 0,R=C.route.errorElement||Iwe,_&&(b<0&&P===0?(Bwe("route-fallback"),B=!0,D=null):b===P&&(B=!0,D=C.route.hydrateFallbackElement||null)));let G=t.concat(p.slice(0,P+1)),V=()=>{let $;return k?$=R:B?$=D:C.route.Component?$=F.createElement(C.route.Component,null):C.route.element?$=C.route.element:$=T,F.createElement(Owe,{match:C,routeContext:{outlet:T,matches:G,isDataRoute:r!=null},children:$})};return r&&(C.route.ErrorBoundary||C.route.errorElement||P===0)?F.createElement(kwe,{location:r.location,revalidation:r.revalidation,component:R,error:k,children:V(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):V()},null)}var gte=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(gte||{}),yte=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(yte||{});function Mwe(e){let t=F.useContext(A4);return t||La(!1),t}function Dwe(e){let t=F.useContext(Ewe);return t||La(!1),t}function Lwe(e){let t=F.useContext(Wm);return t||La(!1),t}function vte(e){let t=Lwe(),r=t.matches[t.matches.length-1];return r.route.id||La(!1),r.route.id}function Fwe(){var e;let t=F.useContext(fte),r=Dwe(),n=vte();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function zwe(){let{router:e}=Mwe(gte.UseNavigateStable),t=vte(yte.UseNavigateStable),r=F.useRef(!1);return pte(()=>{r.current=!0}),F.useCallback(function(a,d){d===void 0&&(d={}),r.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,NT({fromRouteId:t},d)))},[e,t])}const dW={};function Bwe(e,t,r){dW[e]||(dW[e]=!0)}function $we(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Sn(e){La(!1)}function Vwe(e){let{basename:t="/",children:r=null,location:n,navigationType:a=dm.Pop,navigator:d,static:p=!1,future:s}=e;G2()&&La(!1);let _=t.replace(/^\/*/,"/"),b=F.useMemo(()=>({basename:_,navigator:d,static:p,future:NT({v7_relativeSplatPath:!1},s)}),[_,s,d,p]);typeof n=="string"&&(n=xv(n));let{pathname:T="/",search:C="",hash:P="",state:k=null,key:B="default"}=n,R=F.useMemo(()=>{let D=j4(T,_);return D==null?null:{location:{pathname:D,search:C,hash:P,state:k,key:B},navigationType:a}},[_,T,C,P,k,B,a]);return R==null?null:F.createElement(bv.Provider,{value:b},F.createElement(qI.Provider,{children:r,value:R}))}function Uwe(e){let{children:t,location:r}=e;return Cwe(N3(t),r)}new Promise(()=>{});function N3(e,t){t===void 0&&(t=[]);let r=[];return F.Children.forEach(e,(n,a)=>{if(!F.isValidElement(n))return;let d=[...t,a];if(n.type===F.Fragment){r.push.apply(r,N3(n.props.children,d));return}n.type!==Sn&&La(!1),!n.props.index||!n.props.children||La(!1);let p={id:n.props.id||d.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(p.children=N3(n.props.children,d)),r.push(p)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function I3(){return I3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I3.apply(this,arguments)}function qwe(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,d;for(d=0;d<n.length;d++)a=n[d],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Gwe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Wwe(e,t){return e.button===0&&(!t||t==="_self")&&!Gwe(e)}function k3(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(a=>[r,a]):[[r,n]])},[]))}function Hwe(e,t){let r=k3(e);return t&&t.forEach((n,a)=>{r.has(a)||t.getAll(a).forEach(d=>{r.append(a,d)})}),r}const Zwe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Xwe="6";try{window.__reactRouterVersion=Xwe}catch{}const Kwe="startTransition",hW=lB[Kwe];function Ywe(e){let{basename:t,children:r,future:n,window:a}=e,d=F.useRef();d.current==null&&(d.current=Qbe({window:a,v5Compat:!0}));let p=d.current,[s,_]=F.useState({action:p.action,location:p.location}),{v7_startTransition:b}=n||{},T=F.useCallback(C=>{b&&hW?hW(()=>_(C)):_(C)},[_,b]);return F.useLayoutEffect(()=>p.listen(T),[p,T]),F.useEffect(()=>$we(n),[n]),F.createElement(Vwe,{basename:t,children:r,location:s.location,navigationType:s.action,navigator:p,future:n})}const Jwe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Qwe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Oi=F.forwardRef(function(t,r){let{onClick:n,relative:a,reloadDocument:d,replace:p,state:s,target:_,to:b,preventScrollReset:T,viewTransition:C}=t,P=qwe(t,Zwe),{basename:k}=F.useContext(bv),B,R=!1;if(typeof b=="string"&&Qwe.test(b)&&(B=b,Jwe))try{let $=new URL(window.location.href),K=b.startsWith("//")?new URL($.protocol+b):new URL(b),Y=j4(K.pathname,k);K.origin===$.origin&&Y!=null?b=Y+K.search+K.hash:R=!0}catch{}let D=jwe(b,{relative:a}),G=e1e(b,{replace:p,state:s,target:_,preventScrollReset:T,relative:a,viewTransition:C});function V($){n&&n($),$.defaultPrevented||G($)}return F.createElement("a",I3({},P,{href:B||D,onClick:R||d?n:V,ref:r,target:_}))});var fW;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(fW||(fW={}));var pW;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(pW||(pW={}));function e1e(e,t){let{target:r,replace:n,state:a,preventScrollReset:d,relative:p,viewTransition:s}=t===void 0?{}:t,_=di(),b=qf(),T=mte(e,{relative:p});return F.useCallback(C=>{if(Wwe(C,r)){C.preventDefault();let P=n!==void 0?n:zP(b)===zP(T);_(e,{replace:P,state:a,preventScrollReset:d,relative:p,viewTransition:s})}},[b,_,T,n,a,r,e,d,p,s])}function _te(e){let t=F.useRef(k3(e)),r=F.useRef(!1),n=qf(),a=F.useMemo(()=>Hwe(n.search,r.current?null:t.current),[n.search]),d=di(),p=F.useCallback((s,_)=>{const b=k3(typeof s=="function"?s(a):s);r.current=!0,d("?"+b,_)},[d,a]);return[a,p]}const xte="vaija-cart",bte=F.createContext(void 0),t1e=()=>{try{const e=localStorage.getItem(xte);if(e)return JSON.parse(e)}catch(e){console.error("Erro ao carregar carrinho:",e)}return[]},r1e=e=>{try{localStorage.setItem(xte,JSON.stringify(e))}catch(t){console.error("Erro ao salvar carrinho:",t)}},n1e=({children:e})=>{const[t,r]=F.useState(()=>t1e());F.useEffect(()=>{r1e(t)},[t]);const n=b=>{r(T=>T.find(P=>P.id===b.id)?T.map(P=>P.id===b.id?{...P,quantity:P.quantity+1}:P):[...T,{...b,quantity:1}])},a=b=>{r(T=>T.filter(C=>C.id!==b))},d=(b,T)=>{if(T<=0){a(b);return}r(C=>C.map(P=>P.id===b?{...P,quantity:T}:P))},p=()=>r([]),s=t.reduce((b,T)=>b+T.price*T.quantity,0),_=t.length>0&&t[0].establishmentId||null;return c.jsx(bte.Provider,{value:{items:t,addItem:n,removeItem:a,updateQuantity:d,clearCart:p,total:s,establishmentId:_},children:e})},WI=()=>{const e=F.useContext(bte);if(!e)throw new Error("useCart must be used within a CartProvider");return e};var dh=function(){return dh=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(t[d]=r[d])}return t},dh.apply(this,arguments)};function vb(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}function i1e(e,t,r,n){function a(d){return d instanceof r?d:new r(function(p){p(d)})}return new(r||(r=Promise))(function(d,p){function s(T){try{b(n.next(T))}catch(C){p(C)}}function _(T){try{b(n.throw(T))}catch(C){p(C)}}function b(T){T.done?d(T.value):a(T.value).then(s,_)}b((n=n.apply(e,t||[])).next())})}function s1e(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,d;n<a;n++)(d||!(n in t))&&(d||(d=Array.prototype.slice.call(t,0,n)),d[n]=t[n]);return e.concat(d||Array.prototype.slice.call(t))}const a1e=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class C4 extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class o1e extends C4{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class mW extends C4{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class gW extends C4{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var O3;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(O3||(O3={}));class l1e{constructor(t,{headers:r={},customFetch:n,region:a=O3.Any}={}){this.url=t,this.headers=r,this.region=a,this.fetch=a1e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return i1e(this,arguments,void 0,function*(r,n={}){var a;let d,p;try{const{headers:s,method:_,body:b,signal:T,timeout:C}=n;let P={},{region:k}=n;k||(k=this.region);const B=new URL(`${this.url}/${r}`);k&&k!=="any"&&(P["x-region"]=k,B.searchParams.set("forceFunctionRegion",k));let R;b&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)?typeof Blob<"u"&&b instanceof Blob||b instanceof ArrayBuffer?(P["Content-Type"]="application/octet-stream",R=b):typeof b=="string"?(P["Content-Type"]="text/plain",R=b):typeof FormData<"u"&&b instanceof FormData?R=b:(P["Content-Type"]="application/json",R=JSON.stringify(b)):b&&typeof b!="string"&&!(typeof Blob<"u"&&b instanceof Blob)&&!(b instanceof ArrayBuffer)&&!(typeof FormData<"u"&&b instanceof FormData)?R=JSON.stringify(b):R=b;let D=T;C&&(p=new AbortController,d=setTimeout(()=>p.abort(),C),T?(D=p.signal,T.addEventListener("abort",()=>p.abort())):D=p.signal);const G=yield this.fetch(B.toString(),{method:_||"POST",headers:Object.assign(Object.assign(Object.assign({},P),this.headers),s),body:R,signal:D}).catch(Y=>{throw new o1e(Y)}),V=G.headers.get("x-relay-error");if(V&&V==="true")throw new mW(G);if(!G.ok)throw new gW(G);let $=((a=G.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),K;return $==="application/json"?K=yield G.json():$==="application/octet-stream"||$==="application/pdf"?K=yield G.blob():$==="text/event-stream"?K=G:$==="multipart/form-data"?K=yield G.formData():K=yield G.text(),{data:K,error:null,response:G}}catch(s){return{data:null,error:s,response:s instanceof gW||s instanceof mW?s.context:void 0}}finally{d&&clearTimeout(d)}})}}var c1e=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},u1e=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{let p=null,s=null,_=null,b=d.status,T=d.statusText;if(d.ok){var C,P;if(r.method!=="HEAD"){var k;const G=await d.text();G===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((k=r.headers.get("Accept"))===null||k===void 0)&&k.includes("application/vnd.pgrst.plan+text"))?s=G:s=JSON.parse(G))}const R=(C=r.headers.get("Prefer"))===null||C===void 0?void 0:C.match(/count=(exact|planned|estimated)/),D=(P=d.headers.get("content-range"))===null||P===void 0?void 0:P.split("/");R&&D&&D.length>1&&(_=parseInt(D[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(s)&&(s.length>1?(p={code:"PGRST116",details:`Results contain ${s.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,_=null,b=406,T="Not Acceptable"):s.length===1?s=s[0]:s=null)}else{var B;const R=await d.text();try{p=JSON.parse(R),Array.isArray(p)&&d.status===404&&(s=[],p=null,b=200,T="OK")}catch{d.status===404&&R===""?(b=204,T="No Content"):p={message:R}}if(p&&r.isMaybeSingle&&(!(p==null||(B=p.details)===null||B===void 0)&&B.includes("0 rows"))&&(p=null,b=200,T="OK"),p&&r.shouldThrowOnError)throw new c1e(p)}return{error:p,data:s,count:_,status:b,statusText:T}});return this.shouldThrowOnError||(a=a.catch(d=>{var p;let s="";const _=d==null?void 0:d.cause;if(_){var b,T,C,P;const B=(b=_==null?void 0:_.message)!==null&&b!==void 0?b:"",R=(T=_==null?void 0:_.code)!==null&&T!==void 0?T:"";s=`${(C=d==null?void 0:d.name)!==null&&C!==void 0?C:"FetchError"}: ${d==null?void 0:d.message}`,s+=`

Caused by: ${(P=_==null?void 0:_.name)!==null&&P!==void 0?P:"Error"}: ${B}`,R&&(s+=` (${R})`),_!=null&&_.stack&&(s+=`
${_.stack}`)}else{var k;s=(k=d==null?void 0:d.stack)!==null&&k!==void 0?k:""}return{error:{message:`${(p=d==null?void 0:d.name)!==null&&p!==void 0?p:"FetchError"}: ${d==null?void 0:d.message}`,details:s,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),a.then(e,t)}returns(){return this}overrideTypes(){return this}},d1e=class extends u1e{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:a=n}={}){const d=a?`${a}.order`:"order",p=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${p?`${p},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const a=typeof n>"u"?"offset":`${n}.offset`,d=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(d,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:a=!1,format:d="text"}={}){var p;const s=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,a?"wal":null].filter(Boolean).join("|"),_=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${_}"; options=${s};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const yW=new RegExp("[,()]");var px=class extends d1e{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&yW.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&yW.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let a="";n==="plain"?a="pl":n==="phrase"?a="ph":n==="websearch"&&(a="w");const d=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${a}fts${d}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},h1e=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:r=!1,count:n}=t??{},a=r?"HEAD":"GET";let d=!1;const p=(e??"*").split("").map(b=>/\s/.test(b)&&!d?"":(b==='"'&&(d=!d),b)).join(""),{url:s,headers:_}=this.cloneRequestState();return s.searchParams.set("select",p),n&&_.append("Prefer",`count=${n}`),new px({method:a,url:s,headers:_,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;const a="POST",{url:d,headers:p}=this.cloneRequestState();if(t&&p.append("Prefer",`count=${t}`),r||p.append("Prefer","missing=default"),Array.isArray(e)){const s=e.reduce((_,b)=>_.concat(Object.keys(b)),[]);if(s.length>0){const _=[...new Set(s)].map(b=>`"${b}"`);d.searchParams.set("columns",_.join(","))}}return new px({method:a,url:d,headers:p,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:a=!0}={}){var d;const p="POST",{url:s,headers:_}=this.cloneRequestState();if(_.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&s.searchParams.set("on_conflict",t),n&&_.append("Prefer",`count=${n}`),a||_.append("Prefer","missing=default"),Array.isArray(e)){const b=e.reduce((T,C)=>T.concat(Object.keys(C)),[]);if(b.length>0){const T=[...new Set(b)].map(C=>`"${C}"`);s.searchParams.set("columns",T.join(","))}}return new px({method:p,url:s,headers:_,schema:this.schema,body:e,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(e,{count:t}={}){var r;const n="PATCH",{url:a,headers:d}=this.cloneRequestState();return t&&d.append("Prefer",`count=${t}`),new px({method:n,url:a,headers:d,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE",{url:n,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new px({method:r,url:n,headers:a,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},f1e=class wte{constructor(t,{headers:r={},schema:n,fetch:a}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new h1e(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new wte(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:a=!1,count:d}={}){var p;let s;const _=new URL(`${this.url}/rpc/${t}`);let b;const T=k=>k!==null&&typeof k=="object"&&(!Array.isArray(k)||k.some(T)),C=n&&Object.values(r).some(T);C?(s="POST",b=r):n||a?(s=n?"HEAD":"GET",Object.entries(r).filter(([k,B])=>B!==void 0).map(([k,B])=>[k,Array.isArray(B)?`{${B.join(",")}}`:`${B}`]).forEach(([k,B])=>{_.searchParams.append(k,B)})):(s="POST",b=r);const P=new Headers(this.headers);return C?P.set("Prefer",d?`count=${d},return=minimal`:"return=minimal"):d&&P.set("Prefer",`count=${d}`),new px({method:s,url:_,headers:P,schema:this.schemaName,body:b,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}};class p1e{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const n=r.versions;if(n&&n.node){const a=n.node,d=parseInt(a.replace(/^v/,"").split(".")[0]);return d>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${d} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${d} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const m1e="2.90.1",g1e=`realtime-js/${m1e}`,Ste="1.0.0",y1e="2.0.0",vW=Ste,R3=1e4,v1e=1e3,_1e=100;var Zp;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Zp||(Zp={}));var Xa;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Xa||(Xa={}));var ad;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(ad||(ad={}));var M3;(function(e){e.websocket="websocket"})(M3||(M3={}));var vy;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(vy||(vy={}));class x1e{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n;const a=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(t){var r,n;const a=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},p=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,p)}_encodeUserBroadcastPush(t,r,n){var a,d;const p=t.topic,s=(a=t.ref)!==null&&a!==void 0?a:"",_=(d=t.join_ref)!==null&&d!==void 0?d:"",b=t.payload.event,T=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},C=Object.keys(T).length===0?"":JSON.stringify(T);if(_.length>255)throw new Error(`joinRef length ${_.length} exceeds maximum of 255`);if(s.length>255)throw new Error(`ref length ${s.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`topic length ${p.length} exceeds maximum of 255`);if(b.length>255)throw new Error(`userEvent length ${b.length} exceeds maximum of 255`);if(C.length>255)throw new Error(`metadata length ${C.length} exceeds maximum of 255`);const P=this.USER_BROADCAST_PUSH_META_LENGTH+_.length+s.length+p.length+b.length+C.length,k=new ArrayBuffer(this.HEADER_LENGTH+P);let B=new DataView(k),R=0;B.setUint8(R++,this.KINDS.userBroadcastPush),B.setUint8(R++,_.length),B.setUint8(R++,s.length),B.setUint8(R++,p.length),B.setUint8(R++,b.length),B.setUint8(R++,C.length),B.setUint8(R++,r),Array.from(_,G=>B.setUint8(R++,G.charCodeAt(0))),Array.from(s,G=>B.setUint8(R++,G.charCodeAt(0))),Array.from(p,G=>B.setUint8(R++,G.charCodeAt(0))),Array.from(b,G=>B.setUint8(R++,G.charCodeAt(0))),Array.from(C,G=>B.setUint8(R++,G.charCodeAt(0)));var D=new Uint8Array(k.byteLength+n.byteLength);return D.set(new Uint8Array(k),0),D.set(new Uint8Array(n),k.byteLength),D.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[a,d,p,s,_]=n;return r({join_ref:a,ref:d,topic:p,event:s,payload:_})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),a=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,a)}}_decodeUserBroadcast(t,r,n){const a=r.getUint8(1),d=r.getUint8(2),p=r.getUint8(3),s=r.getUint8(4);let _=this.HEADER_LENGTH+4;const b=n.decode(t.slice(_,_+a));_=_+a;const T=n.decode(t.slice(_,_+d));_=_+d;const C=n.decode(t.slice(_,_+p));_=_+p;const P=t.slice(_,t.byteLength),k=s===this.JSON_ENCODING?JSON.parse(n.decode(P)):P,B={type:this.BROADCAST_EVENT,event:T,payload:k};return p>0&&(B.meta=JSON.parse(C)),{join_ref:null,ref:null,topic:b,event:this.BROADCAST_EVENT,payload:B}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(t,r){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([n])=>r.includes(n)))}}class Tte{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var bs;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(bs||(bs={}));const _W=(e,t,r={})=>{var n;const a=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((d,p)=>(d[p]=b1e(p,e,t,a),d),{}):{}},b1e=(e,t,r,n)=>{const a=t.find(s=>s.name===e),d=a==null?void 0:a.type,p=r[e];return d&&!n.includes(d)?Ete(d,p):D3(p)},Ete=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return E1e(t,r)}switch(e){case bs.bool:return w1e(t);case bs.float4:case bs.float8:case bs.int2:case bs.int4:case bs.int8:case bs.numeric:case bs.oid:return S1e(t);case bs.json:case bs.jsonb:return T1e(t);case bs.timestamp:return j1e(t);case bs.abstime:case bs.date:case bs.daterange:case bs.int4range:case bs.int8range:case bs.money:case bs.reltime:case bs.text:case bs.time:case bs.timestamptz:case bs.timetz:case bs.tsrange:case bs.tstzrange:return D3(t);default:return D3(t)}},D3=e=>e,w1e=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},S1e=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},T1e=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},E1e=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let d;const p=e.slice(1,r);try{d=JSON.parse("["+p+"]")}catch{d=p?p.split(","):[]}return d.map(s=>Ete(t,s))}return e},j1e=e=>typeof e=="string"?e.replace(" ","T"):e,jte=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class JM{constructor(t,r,n={},a=R3){this.channel=t,this.event=r,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var xW;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(xW||(xW={}));class GS{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:d,onLeave:p,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=GS.syncState(this.state,a,d,p),this.pendingDiffs.forEach(_=>{this.state=GS.syncDiff(this.state,_,d,p)}),this.pendingDiffs=[],s()}),this.channel._on(n.diff,{},a=>{const{onJoin:d,onLeave:p,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=GS.syncDiff(this.state,a,d,p),s())}),this.onJoin((a,d,p)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:d,newPresences:p})}),this.onLeave((a,d,p)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:d,leftPresences:p})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,a){const d=this.cloneDeep(t),p=this.transformState(r),s={},_={};return this.map(d,(b,T)=>{p[b]||(_[b]=T)}),this.map(p,(b,T)=>{const C=d[b];if(C){const P=T.map(D=>D.presence_ref),k=C.map(D=>D.presence_ref),B=T.filter(D=>k.indexOf(D.presence_ref)<0),R=C.filter(D=>P.indexOf(D.presence_ref)<0);B.length>0&&(s[b]=B),R.length>0&&(_[b]=R)}else s[b]=T}),this.syncDiff(d,{joins:s,leaves:_},n,a)}static syncDiff(t,r,n,a){const{joins:d,leaves:p}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(d,(s,_)=>{var b;const T=(b=t[s])!==null&&b!==void 0?b:[];if(t[s]=this.cloneDeep(_),T.length>0){const C=t[s].map(k=>k.presence_ref),P=T.filter(k=>C.indexOf(k.presence_ref)<0);t[s].unshift(...P)}n(s,T,_)}),this.map(p,(s,_)=>{let b=t[s];if(!b)return;const T=_.map(C=>C.presence_ref);b=b.filter(C=>T.indexOf(C.presence_ref)<0),t[s]=b,a(s,b,_),b.length===0&&delete t[s]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const a=t[n];return"metas"in a?r[n]=a.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[n]=a,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bW;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(bW||(bW={}));var WS;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(WS||(WS={}));var hf;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(hf||(hf={}));class Nx{constructor(t,r={config:{}},n){var a,d;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=Xa.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new JM(this,ad.join,this.params,this.timeout),this.rejoinTimer=new Tte(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Xa.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(p=>p.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Xa.closed,this.socket._remove(this)}),this._onError(p=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,p),this.state=Xa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Xa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",p=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,p),this.state=Xa.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ad.reply,{},(p,s)=>{this._trigger(this._replyEventName(s),p)}),this.presence=new GS(this),this.broadcastEndpointURL=jte(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((d=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||d===void 0)&&d.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,a,d;if(this.socket.isConnected()||this.socket.connect(),this.state==Xa.closed){const{config:{broadcast:p,presence:s,private:_}}=this.params,b=(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(k=>k.filter))!==null&&a!==void 0?a:[],T=!!this.bindings[WS.PRESENCE]&&this.bindings[WS.PRESENCE].length>0||((d=this.params.config.presence)===null||d===void 0?void 0:d.enabled)===!0,C={},P={broadcast:p,presence:Object.assign(Object.assign({},s),{enabled:T}),postgres_changes:b,private:_};this.socket.accessTokenValue&&(C.access_token=this.socket.accessTokenValue),this._onError(k=>t==null?void 0:t(hf.CHANNEL_ERROR,k)),this._onClose(()=>t==null?void 0:t(hf.CLOSED)),this.updateJoinPayload(Object.assign({config:P},C)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:k})=>{var B;if(this.socket._isManualToken()||this.socket.setAuth(),k===void 0){t==null||t(hf.SUBSCRIBED);return}else{const R=this.bindings.postgres_changes,D=(B=R==null?void 0:R.length)!==null&&B!==void 0?B:0,G=[];for(let V=0;V<D;V++){const $=R[V],{filter:{event:K,schema:Y,table:ee,filter:ae}}=$,ie=k&&k[V];if(ie&&ie.event===K&&Nx.isFilterValueEqual(ie.schema,Y)&&Nx.isFilterValueEqual(ie.table,ee)&&Nx.isFilterValueEqual(ie.filter,ae))G.push(Object.assign(Object.assign({},$),{id:ie.id}));else{this.unsubscribe(),this.state=Xa.errored,t==null||t(hf.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,t&&t(hf.SUBSCRIBED);return}}).receive("error",k=>{this.state=Xa.errored,t==null||t(hf.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(k).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(hf.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===Xa.joined&&t===WS.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var a;if(r==null)return Promise.reject("Payload is required for httpSend()");const d={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(d.Authorization=`Bearer ${this.socket.accessTokenValue}`);const p={method:"POST",headers:d,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},s=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(a=n.timeout)!==null&&a!==void 0?a:this.timeout);if(s.status===202)return{success:!0};let _=s.statusText;try{const b=await s.json();_=b.error||b.message||_}catch{}return Promise.reject(new Error(_))}async send(t,r={}){var n,a;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:d,payload:p}=t,s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const _={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:p,private:this.private}]})};try{const b=await this._fetchWithTimeout(this.broadcastEndpointURL,_,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=b.body)===null||a===void 0?void 0:a.cancel()),b.ok?"ok":"error"}catch(b){return b.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var p,s,_;const b=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((_=(s=(p=this.params)===null||p===void 0?void 0:p.config)===null||s===void 0?void 0:s.broadcast)===null||_===void 0)&&_.ack)&&d("ok"),b.receive("ok",()=>d("ok")),b.receive("error",()=>d("error")),b.receive("timeout",()=>d("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Xa.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ad.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new JM(this,ad.leave,{},t),n.receive("ok",()=>{r(),a("ok")}).receive("timeout",()=>{r(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Xa.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const a=new AbortController,d=setTimeout(()=>a.abort(),n),p=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:a.signal}));return clearTimeout(d),p}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new JM(this,t,r,n);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>_1e){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var a,d;const p=t.toLocaleLowerCase(),{close:s,error:_,leave:b,join:T}=ad;if(n&&[s,_,b,T].indexOf(p)>=0&&n!==this._joinRef())return;let P=this._onMessage(p,r,n);if(r&&!P)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(p)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(k=>{var B,R,D;return((B=k.filter)===null||B===void 0?void 0:B.event)==="*"||((D=(R=k.filter)===null||R===void 0?void 0:R.event)===null||D===void 0?void 0:D.toLocaleLowerCase())===p}).map(k=>k.callback(P,n)):(d=this.bindings[p])===null||d===void 0||d.filter(k=>{var B,R,D,G,V,$,K,Y;if(["broadcast","presence","postgres_changes"].includes(p))if("id"in k){const ee=k.id,ae=(B=k.filter)===null||B===void 0?void 0:B.event;return ee&&((R=r.ids)===null||R===void 0?void 0:R.includes(ee))&&(ae==="*"||(ae==null?void 0:ae.toLocaleLowerCase())===((D=r.data)===null||D===void 0?void 0:D.type.toLocaleLowerCase()))&&(!(!((G=k.filter)===null||G===void 0)&&G.table)||k.filter.table===((V=r.data)===null||V===void 0?void 0:V.table))}else{const ee=(K=($=k==null?void 0:k.filter)===null||$===void 0?void 0:$.event)===null||K===void 0?void 0:K.toLocaleLowerCase();return ee==="*"||ee===((Y=r==null?void 0:r.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase())}else return k.type.toLocaleLowerCase()===p}).map(k=>{if(typeof P=="object"&&"ids"in P){const B=P.data,{schema:R,table:D,commit_timestamp:G,type:V,errors:$}=B;P=Object.assign(Object.assign({},{schema:R,table:D,commit_timestamp:G,eventType:V,new:{},old:{},errors:$}),this._getPayloadRecords(B))}k.callback(P,n)})}_isClosed(){return this.state===Xa.closed}_isJoined(){return this.state===Xa.joined}_isJoining(){return this.state===Xa.joining}_isLeaving(){return this.state===Xa.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const a=t.toLocaleLowerCase(),d={type:a,filter:r,callback:n};return this.bindings[a]?this.bindings[a].push(d):this.bindings[a]=[d],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(a=>{var d;return!(((d=a.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===n&&Nx.isEqual(a.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}static isFilterValueEqual(t,r){return(t??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ad.close,{},t)}_onError(t){this._on(ad.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Xa.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=_W(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=_W(t.columns,t.old_record)),r}}const QM=()=>{},uC={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},A1e=[1e3,2e3,5e3,1e4],C1e=1e4,P1e=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class N1e{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=R3,this.transport=null,this.heartbeatIntervalMs=uC.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=QM,this.ref=0,this.reconnectTimer=null,this.vsn=vW,this.logger=QM,this.conn=null,this.sendBuffer=[],this.serializer=new x1e,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...d)=>a(...d):(...d)=>fetch(...d),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${M3.websocket}`,this.httpEndpoint=jte(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=p1e.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Zp.connecting:return vy.Connecting;case Zp.open:return vy.Open;case Zp.closing:return vy.Closing;default:return vy.Closed}}isConnected(){return this.connectionState()===vy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,a=this.getChannels().find(d=>d.topic===n);if(a)return a;{const d=new Nx(`realtime:${t}`,r,this);return this.channels.push(d),d}}push(t){const{topic:r,event:n,payload:a,ref:d}=t,p=()=>{this.encode(t,s=>{var _;(_=this.conn)===null||_===void 0||_.send(s)})};this.log("push",`${r} ${n} (${d})`,a),this.isConnected()?p():this.sendBuffer.push(p)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(v1e,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},uC.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const b=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",b)}catch(T){this.log("error","error in heartbeat callback",T)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:a,payload:d,ref:p}=r,s=p?`(${p})`:"",_=d.status||"";this.log("receive",`${_} ${n} ${a} ${s}`.trim(),d),this.channels.filter(b=>b._isMember(n)).forEach(b=>b._trigger(a,d,p)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Zp.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Zp.open||this.conn.readyState===Zp.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(ad.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",a=new URLSearchParams(r);return`${t}${n}${a}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([P1e],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r,n=!1;if(t)r=t,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(a=>{const d={access_token:r,version:g1e};r&&a.updateJoinPayload(d),a.joinedOnce&&a._isJoined()&&a._push(ad.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Tte(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},uC.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,a,d,p,s,_,b,T,C,P,k;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:R3,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:uC.HEARTBEAT_INTERVAL,this.worker=(d=t==null?void 0:t.worker)!==null&&d!==void 0?d:!1,this.accessToken=(p=t==null?void 0:t.accessToken)!==null&&p!==void 0?p:null,this.heartbeatCallback=(s=t==null?void 0:t.heartbeatCallback)!==null&&s!==void 0?s:QM,this.vsn=(_=t==null?void 0:t.vsn)!==null&&_!==void 0?_:vW,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(b=t==null?void 0:t.reconnectAfterMs)!==null&&b!==void 0?b:B=>A1e[B-1]||C1e,this.vsn){case Ste:this.encode=(T=t==null?void 0:t.encode)!==null&&T!==void 0?T:(B,R)=>R(JSON.stringify(B)),this.decode=(C=t==null?void 0:t.decode)!==null&&C!==void 0?C:(B,R)=>R(JSON.parse(B));break;case y1e:this.encode=(P=t==null?void 0:t.encode)!==null&&P!==void 0?P:this.serializer.encode.bind(this.serializer),this.decode=(k=t==null?void 0:t.decode)!==null&&k!==void 0?k:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var IT=class extends Error{constructor(e,t){var r;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((r=t.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function I1e(e,t,r){const n=new URL(t,e);if(r)for(const[a,d]of Object.entries(r))d!==void 0&&n.searchParams.set(a,d);return n.toString()}async function k1e(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function O1e(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:a,body:d,headers:p}){const s=I1e(e.baseUrl,n,a),_=await k1e(e.auth),b=await t(s,{method:r,headers:{...d?{"Content-Type":"application/json"}:{},..._,...p},body:d?JSON.stringify(d):void 0}),T=await b.text(),C=(b.headers.get("content-type")||"").includes("application/json"),P=C&&T?JSON.parse(T):T;if(!b.ok){const k=C?P:void 0,B=k==null?void 0:k.error;throw new IT((B==null?void 0:B.message)??`Request failed with status ${b.status}`,{status:b.status,icebergType:B==null?void 0:B.type,icebergCode:B==null?void 0:B.code,details:k})}return{status:b.status,headers:b.headers,data:P}}}}function dC(e){return e.join("")}var R1e=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:dC(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${dC(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${dC(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${dC(e.namespace)}`}),!0}catch(t){if(t instanceof IT&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(r){if(r instanceof IT&&r.status===409)return;throw r}}};function Q_(e){return e.join("")}var M1e=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Q_(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(r){if(r instanceof IT&&r.status===404)return!1;throw r}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof IT&&r.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},D1e=class{constructor(e){var n;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=O1e({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(n=e.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new R1e(this.client,t),this.tableOps=new M1e(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},HI=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Js(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var L1e=class extends HI{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},L3=class extends HI{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const P4=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),F1e=()=>Response,F3=e=>{if(Array.isArray(e))return e.map(r=>F3(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const a=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));t[a]=F3(n)}),t},z1e=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},B1e=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function kT(e){"@babel/helpers - typeof";return kT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kT(e)}function $1e(e,t){if(kT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(kT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function V1e(e){var t=$1e(e,"string");return kT(t)=="symbol"?t:t+""}function U1e(e,t,r){return(t=V1e(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wW(Object(r),!0).forEach(function(n){U1e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const eD=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},q1e=async(e,t,r)=>{e instanceof await F1e()&&!(r!=null&&r.noResolveJson)?e.json().then(n=>{const a=e.status||500,d=(n==null?void 0:n.statusCode)||a+"";t(new L1e(eD(n),a,d))}).catch(n=>{t(new L3(eD(n),n))}):t(new L3(eD(e),e))},G1e=(e,t,r,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?a:(z1e(n)?(a.headers=kn({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(n)):a.body=n,t!=null&&t.duplex&&(a.duplex=t.duplex),kn(kn({},a),r))};async function W2(e,t,r,n,a,d){return new Promise((p,s)=>{e(r,G1e(t,n,a,d)).then(_=>{if(!_.ok)throw _;return n!=null&&n.noResolveJson?_:_.json()}).then(_=>p(_)).catch(_=>q1e(_,s,n))})}async function OT(e,t,r,n){return W2(e,"GET",t,r,n)}async function rd(e,t,r,n,a){return W2(e,"POST",t,n,a,r)}async function z3(e,t,r,n,a){return W2(e,"PUT",t,n,a,r)}async function W1e(e,t,r,n){return W2(e,"HEAD",t,kn(kn({},r),{},{noResolveJson:!0}),n)}async function N4(e,t,r,n,a){return W2(e,"DELETE",t,n,a,r)}var H1e=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Js(t))return{data:null,error:t};throw t}}};let Ate;Ate=Symbol.toStringTag;var Z1e=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ate]="BlobDownloadBuilder",this.promise=null}asStream(){return new H1e(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Js(t))return{data:null,error:t};throw t}}};const X1e={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},SW={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var K1e=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=P4(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var a=this;try{let d;const p=kn(kn({},SW),n);let s=kn(kn({},a.headers),e==="POST"&&{"x-upsert":String(p.upsert)});const _=p.metadata;typeof Blob<"u"&&r instanceof Blob?(d=new FormData,d.append("cacheControl",p.cacheControl),_&&d.append("metadata",a.encodeMetadata(_)),d.append("",r)):typeof FormData<"u"&&r instanceof FormData?(d=r,d.has("cacheControl")||d.append("cacheControl",p.cacheControl),_&&!d.has("metadata")&&d.append("metadata",a.encodeMetadata(_))):(d=r,s["cache-control"]=`max-age=${p.cacheControl}`,s["content-type"]=p.contentType,_&&(s["x-metadata"]=a.toBase64(a.encodeMetadata(_))),(typeof ReadableStream<"u"&&d instanceof ReadableStream||d&&typeof d=="object"&&"pipe"in d&&typeof d.pipe=="function")&&!p.duplex&&(p.duplex="half")),n!=null&&n.headers&&(s=kn(kn({},s),n.headers));const b=a._removeEmptyFolders(t),T=a._getFinalPath(b),C=await(e=="PUT"?z3:rd)(a.fetch,`${a.url}/object/${T}`,d,kn({headers:s},p!=null&&p.duplex?{duplex:p.duplex}:{}));return{data:{path:b,id:C.Id,fullPath:C.Key},error:null}}catch(d){if(a.shouldThrowOnError)throw d;if(Js(d))return{data:null,error:d};throw d}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var a=this;const d=a._removeEmptyFolders(e),p=a._getFinalPath(d),s=new URL(a.url+`/object/upload/sign/${p}`);s.searchParams.set("token",t);try{let _;const b=kn({upsert:SW.upsert},n),T=kn(kn({},a.headers),{"x-upsert":String(b.upsert)});return typeof Blob<"u"&&r instanceof Blob?(_=new FormData,_.append("cacheControl",b.cacheControl),_.append("",r)):typeof FormData<"u"&&r instanceof FormData?(_=r,_.append("cacheControl",b.cacheControl)):(_=r,T["cache-control"]=`max-age=${b.cacheControl}`,T["content-type"]=b.contentType),{data:{path:d,fullPath:(await z3(a.fetch,s.toString(),_,{headers:T})).Key},error:null}}catch(_){if(a.shouldThrowOnError)throw _;if(Js(_))return{data:null,error:_};throw _}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const a=kn({},r.headers);t!=null&&t.upsert&&(a["x-upsert"]="true");const d=await rd(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:a}),p=new URL(r.url+d.url),s=p.searchParams.get("token");if(!s)throw new HI("No token returned by API");return{data:{signedUrl:p.toString(),path:e,token:s},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Js(n))return{data:null,error:n};throw n}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await rd(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Js(a))return{data:null,error:a};throw a}}async copy(e,t,r){var n=this;try{return{data:{path:(await rd(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Js(a))return{data:null,error:a};throw a}}async createSignedUrl(e,t,r){var n=this;try{let a=n._getFinalPath(e),d=await rd(n.fetch,`${n.url}/object/sign/${a}`,kn({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:n.headers});const p=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return d={signedUrl:encodeURI(`${n.url}${d.signedURL}${p}`)},{data:d,error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Js(a))return{data:null,error:a};throw a}}async createSignedUrls(e,t,r){var n=this;try{const a=await rd(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),d=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(p=>kn(kn({},p),{},{signedUrl:p.signedURL?encodeURI(`${n.url}${p.signedURL}${d}`):null})),error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Js(a))return{data:null,error:a};throw a}}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"",d=this._getFinalPath(e),p=()=>OT(this.fetch,`${this.url}/${r}/${d}${a}`,{headers:this.headers,noResolveJson:!0});return new Z1e(p,this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:F3(await OT(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Js(n))return{data:null,error:n};throw n}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await W1e(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Js(n)&&n instanceof L3){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],a=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&n.push(a);const d=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",p=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});p!==""&&n.push(p);let s=n.join("&");return s!==""&&(s=`?${s}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${s}`)}}}async remove(e){var t=this;try{return{data:await N4(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async list(e,t,r){var n=this;try{const a=kn(kn(kn({},X1e),t),{},{prefix:e||""});return{data:await rd(n.fetch,`${n.url}/object/list/${n.bucketId}`,a,{headers:n.headers},r),error:null}}catch(a){if(n.shouldThrowOnError)throw a;if(Js(a))return{data:null,error:a};throw a}}async listV2(e,t){var r=this;try{const n=kn({},e);return{data:await rd(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Js(n))return{data:null,error:n};throw n}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const Cte="2.90.1",Pte={"X-Client-Info":`storage-js/${Cte}`};var Y1e=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const a=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=kn(kn({},Pte),t),this.fetch=P4(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await OT(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await OT(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await rd(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Js(n))return{data:null,error:n};throw n}}async updateBucket(e,t){var r=this;try{return{data:await z3(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Js(n))return{data:null,error:n};throw n}}async emptyBucket(e){var t=this;try{return{data:await rd(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await N4(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},J1e=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=kn(kn({},Pte),t),this.fetch=P4(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await rd(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&r.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&r.set("sortOrder",e.sortOrder),e!=null&&e.search&&r.set("search",e.search);const n=r.toString(),a=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await OT(t.fetch,a,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await N4(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Js(r))return{data:null,error:r};throw r}}from(e){var t=this;if(!B1e(e))throw new HI("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new D1e({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(a,d){const p=a[d];return typeof p!="function"?p:async(...s)=>{try{return{data:await p.apply(a,s),error:null}}catch(_){if(n)throw _;return{data:null,error:_}}}}})}};const I4={"X-Client-Info":`storage-js/${Cte}`,"Content-Type":"application/json"};var Nte=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Pc(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}var tD=class extends Nte{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Q1e=class extends Nte{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const k4=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),eSe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},TW=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tSe=async(e,t,r)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const n=e.status||500,a=e;if(typeof a.json=="function")a.json().then(d=>{const p=(d==null?void 0:d.statusCode)||(d==null?void 0:d.code)||n+"";t(new tD(TW(d),n,p))}).catch(()=>{const d=n+"";t(new tD(a.statusText||`HTTP ${n} error`,n,d))});else{const d=n+"";t(new tD(a.statusText||`HTTP ${n} error`,n,d))}}else t(new Q1e(TW(e),e))},rSe=(e,t,r,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(eSe(n)?(a.headers=kn({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(n)):a.body=n,kn(kn({},a),r)):a};async function nSe(e,t,r,n,a,d){return new Promise((p,s)=>{e(r,rSe(t,n,a,d)).then(_=>{if(!_.ok)throw _;if(n!=null&&n.noResolveJson)return _;const b=_.headers.get("content-type");return!b||!b.includes("application/json")?{}:_.json()}).then(_=>p(_)).catch(_=>tSe(_,s,n))})}async function Nc(e,t,r,n,a){return nSe(e,"POST",t,n,a,r)}var iSe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=kn(kn({},I4),t),this.fetch=k4(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async getIndex(e,t){var r=this;try{return{data:await Nc(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Pc(n))return{data:null,error:n};throw n}}async listIndexes(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async deleteIndex(e,t){var r=this;try{return{data:await Nc(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Pc(n))return{data:null,error:n};throw n}}},sSe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=kn(kn({},I4),t),this.fetch=k4(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Nc(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async getVectors(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async listVectors(e){var t=this;try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await Nc(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async queryVectors(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Nc(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}},aSe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=kn(kn({},I4),t),this.fetch=k4(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async listBuckets(e={}){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await Nc(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Pc(r))return{data:null,error:r};throw r}}},oSe=class extends aSe{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new lSe(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,r=this;return t().call(r,e)}async getBucket(e){var t=()=>super.getBucket,r=this;return t().call(r,e)}async listBuckets(e={}){var t=()=>super.listBuckets,r=this;return t().call(r,e)}async deleteBucket(e){var t=()=>super.deleteBucket,r=this;return t().call(r,e)}},lSe=class extends iSe{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){var t=()=>super.createIndex,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,r=this;return t().call(r,r.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,r=this;return t().call(r,r.vectorBucketName,e)}index(e){return new cSe(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},cSe=class extends sSe{constructor(e,t,r,n,a){super(e,t,a),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=()=>super.putVectors,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(e){var t=()=>super.getVectors,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,r=this;return t().call(r,kn(kn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},uSe=class extends Y1e{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new K1e(this.url,this.headers,e,this.fetch)}get vectors(){return new oSe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new J1e(this.url+"/iceberg",this.headers,this.fetch)}};const Ite="2.90.1",mx=30*1e3,B3=3,rD=B3*mx,dSe="http://localhost:9999",hSe="supabase.auth.token",fSe={"X-Client-Info":`gotrue-js/${Ite}`},$3="X-Supabase-Api-Version",kte={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},pSe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,mSe=10*60*1e3;class RT extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function fn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class gSe extends RT{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function ySe(e){return fn(e)&&e.name==="AuthApiError"}class _y extends RT{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Gf extends RT{constructor(t,r,n,a){super(t,n,a),this.name=r,this.status=n}}class wc extends Gf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function vSe(e){return fn(e)&&e.name==="AuthSessionMissingError"}class ex extends Gf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class hC extends Gf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class fC extends Gf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function _Se(e){return fn(e)&&e.name==="AuthImplicitGrantRedirectError"}class EW extends Gf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xSe extends Gf{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class V3 extends Gf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function nD(e){return fn(e)&&e.name==="AuthRetryableFetchError"}class jW extends Gf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class U3 extends Gf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const BP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),AW=` 	
\r=`.split(""),bSe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<AW.length;t+=1)e[AW[t].charCodeAt(0)]=-2;for(let t=0;t<BP.length;t+=1)e[BP[t].charCodeAt(0)]=t;return e})();function CW(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(BP[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(BP[n]),t.queuedBits-=6}}function Ote(e,t,r){const n=bSe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function PW(e){const t=[],r=p=>{t.push(String.fromCodePoint(p))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},d=p=>{TSe(p,n,r)};for(let p=0;p<e.length;p+=1)Ote(e.charCodeAt(p),a,d);return t.join("")}function wSe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function SSe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|a)+65536,r+=1}wSe(n,t)}}function TSe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Zx(e){const t=[],r={queue:0,queuedBits:0},n=a=>{t.push(a)};for(let a=0;a<e.length;a+=1)Ote(e.charCodeAt(a),r,n);return new Uint8Array(t)}function ESe(e){const t=[];return SSe(e,r=>t.push(r)),new Uint8Array(t)}function jy(e){const t=[],r={queue:0,queuedBits:0},n=a=>{t.push(a)};return e.forEach(a=>CW(a,r,n)),CW(null,r,n),t.join("")}function jSe(e){return Math.round(Date.now()/1e3)+e}function ASe(){return Symbol("auth-callback")}const Ro=()=>typeof window<"u"&&typeof document<"u",iy={tested:!1,writable:!1},Rte=()=>{if(!Ro())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(iy.tested)return iy.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),iy.tested=!0,iy.writable=!0}catch{iy.tested=!0,iy.writable=!1}return iy.writable};function CSe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((a,d)=>{t[d]=a})}catch{}return r.searchParams.forEach((n,a)=>{t[a]=n}),t}const Mte=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),PSe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",gx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},sy=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Oo=async(e,t)=>{await e.removeItem(t)};class ZI{constructor(){this.promise=new ZI.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}ZI.promiseConstructor=Promise;function iD(e){const t=e.split(".");if(t.length!==3)throw new U3("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!pSe.test(t[n]))throw new U3("JWT not in base64url format");return{header:JSON.parse(PW(t[0])),payload:JSON.parse(PW(t[1])),signature:Zx(t[2]),raw:{header:t[0],payload:t[1]}}}async function NSe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function ISe(e,t){return new Promise((n,a)=>{(async()=>{for(let d=0;d<1/0;d++)try{const p=await e(d);if(!t(d,null,p)){n(p);return}}catch(p){if(!t(d,p)){a(p);return}}})()})}function kSe(e){return("0"+e.toString(16)).substr(-2)}function OSe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let a="";for(let d=0;d<56;d++)a+=r.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(t),Array.from(t,kSe).join("")}async function RSe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),a=new Uint8Array(n);return Array.from(a).map(d=>String.fromCharCode(d)).join("")}async function MSe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await RSe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tx(e,t,r=!1){const n=OSe();let a=n;r&&(a+="/PASSWORD_RECOVERY"),await gx(e,`${t}-code-verifier`,a);const d=await MSe(n);return[d,n===d?"plain":"s256"]}const DSe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function LSe(e){const t=e.headers.get($3);if(!t||!t.match(DSe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function FSe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function zSe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const BSe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rx(e){if(!BSe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function sD(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function $Se(e,t){return new Proxy(e,{get:(r,n,a)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const d=n.toString();if(d==="Symbol(Symbol.toPrimitive)"||d==="Symbol(Symbol.toStringTag)"||d==="Symbol(util.inspect.custom)"||d==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,a)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,a)}})}function NW(e){return JSON.parse(JSON.stringify(e))}const hy=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),VSe=[502,503,504];async function IW(e){var t;if(!PSe(e))throw new V3(hy(e),0);if(VSe.includes(e.status))throw new V3(hy(e),e.status);let r;try{r=await e.json()}catch(d){throw new _y(hy(d),d)}let n;const a=LSe(e);if(a&&a.getTime()>=kte["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new jW(hy(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new wc}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,p)=>d&&typeof p=="string",!0))throw new jW(hy(r),e.status,r.weak_password.reasons);throw new gSe(hy(r),e.status||500,n)}const USe=(e,t,r,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),r))};async function In(e,t,r,n){var a;const d=Object.assign({},n==null?void 0:n.headers);d[$3]||(d[$3]=kte["2024-01-01"].name),n!=null&&n.jwt&&(d.Authorization=`Bearer ${n.jwt}`);const p=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(p.redirect_to=n.redirectTo);const s=Object.keys(p).length?"?"+new URLSearchParams(p).toString():"",_=await qSe(e,t,r+s,{headers:d,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(_):{data:Object.assign({},_),error:null}}async function qSe(e,t,r,n,a,d){const p=USe(t,n,a,d);let s;try{s=await e(r,Object.assign({},p))}catch(_){throw console.error(_),new V3(hy(_),0)}if(s.ok||await IW(s),n!=null&&n.noResolveJson)return s;try{return await s.json()}catch(_){await IW(_)}}function Ju(e){var t;let r=null;HSe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=jSe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function kW(e){const t=Ju(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Qp(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function GSe(e){return{data:e,error:null}}function WSe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:a,verification_type:d}=e,p=vb(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:t,email_otp:r,hashed_token:n,redirect_to:a,verification_type:d},_=Object.assign({},p);return{data:{properties:s,user:_},error:null}}function OW(e){return e}function HSe(e){return e.access_token&&e.refresh_token&&e.expires_in}const aD=["global","local","others"];class ZSe{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=Mte(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=aD[0]){if(aD.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${aD.join(", ")}`);try{return await In(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(fn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await In(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Qp})}catch(n){if(fn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=vb(t,["options"]),a=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await In(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:WSe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(fn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await In(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Qp})}catch(r){if(fn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,a,d,p,s,_;try{const b={nextPage:null,lastPage:0,total:0},T=await In(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(d=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&d!==void 0?d:""},xform:OW});if(T.error)throw T.error;const C=await T.json(),P=(p=T.headers.get("x-total-count"))!==null&&p!==void 0?p:0,k=(_=(s=T.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&_!==void 0?_:[];return k.length>0&&(k.forEach(B=>{const R=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(B.split(";")[1].split("=")[1]);b[`${D}Page`]=R}),b.total=parseInt(P)),{data:Object.assign(Object.assign({},C),b),error:null}}catch(b){if(fn(b))return{data:{users:[]},error:b};throw b}}async getUserById(t){rx(t);try{return await In(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Qp})}catch(r){if(fn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){rx(t);try{return await In(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Qp})}catch(n){if(fn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){rx(t);try{return await In(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Qp})}catch(n){if(fn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){rx(t.userId);try{const{data:r,error:n}=await In(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:r,error:n}}catch(r){if(fn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){rx(t.userId),rx(t.id);try{return{data:await In(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(fn(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,a,d,p,s,_;try{const b={nextPage:null,lastPage:0,total:0},T=await In(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(d=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&d!==void 0?d:""},xform:OW});if(T.error)throw T.error;const C=await T.json(),P=(p=T.headers.get("x-total-count"))!==null&&p!==void 0?p:0,k=(_=(s=T.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&_!==void 0?_:[];return k.length>0&&(k.forEach(B=>{const R=parseInt(B.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(B.split(";")[1].split("=")[1]);b[`${D}Page`]=R}),b.total=parseInt(P)),{data:Object.assign(Object.assign({},C),b),error:null}}catch(b){if(fn(b))return{data:{clients:[]},error:b};throw b}}async _createOAuthClient(t){try{return await In(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(fn(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await In(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(fn(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await In(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(fn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await In(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(fn(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await In(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(fn(r))return{data:null,error:r};throw r}}}function RW(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const nx={debug:!!(globalThis&&Rte()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Dte extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class XSe extends Dte{}async function KSe(e,t,r){nx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),nx.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){nx.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await r()}finally{nx.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}else{if(t===0)throw nx.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new XSe(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(nx.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function YSe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Lte(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function JSe(e){return parseInt(e,16)}function QSe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function eTe(e){var t;const{chainId:r,domain:n,expirationTime:a,issuedAt:d=new Date,nonce:p,notBefore:s,requestId:_,resources:b,scheme:T,uri:C,version:P}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(p&&p.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${p}`);if(!C)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(P!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${P}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const k=Lte(e.address),B=T?`${T}://${n}`:n,R=e.statement?`${e.statement}
`:"",D=`${B} wants you to sign in with your Ethereum account:
${k}

${R}`;let G=`URI: ${C}
Version: ${P}
Chain ID: ${r}${p?`
Nonce: ${p}`:""}
Issued At: ${d.toISOString()}`;if(a&&(G+=`
Expiration Time: ${a.toISOString()}`),s&&(G+=`
Not Before: ${s.toISOString()}`),_&&(G+=`
Request ID: ${_}`),b){let V=`
Resources:`;for(const $ of b){if(!$||typeof $!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${$}`);V+=`
- ${$}`}G+=V}return`${D}
${G}`}class Ia extends Error{constructor({message:t,code:r,cause:n,name:a}){var d;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(d=a??(n instanceof Error?n.name:void 0))!==null&&d!==void 0?d:"Unknown Error",this.code=r}}class $P extends Ia{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function tTe({error:e,options:t}){var r,n,a;const{publicKey:d}=t;if(!d)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ia({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=d.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ia({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=d.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ia({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((a=d.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Ia({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Ia({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Ia({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return d.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new Ia({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Ia({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const p=window.location.hostname;if(Fte(p)){if(d.rp.id!==p)return new Ia({message:`The RP ID "${d.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ia({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(d.user.id.byteLength<1||d.user.id.byteLength>64)return new Ia({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Ia({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ia({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function rTe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Ia({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Ia({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(Fte(n)){if(r.rpId!==n)return new Ia({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Ia({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Ia({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Ia({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class nTe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const iTe=new nTe;function sTe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,a=vb(e,["challenge","user","excludeCredentials"]),d=Zx(t).buffer,p=Object.assign(Object.assign({},r),{id:Zx(r.id).buffer}),s=Object.assign(Object.assign({},a),{challenge:d,user:p});if(n&&n.length>0){s.excludeCredentials=new Array(n.length);for(let _=0;_<n.length;_++){const b=n[_];s.excludeCredentials[_]=Object.assign(Object.assign({},b),{id:Zx(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return s}function aTe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=vb(e,["challenge","allowCredentials"]),a=Zx(t).buffer,d=Object.assign(Object.assign({},n),{challenge:a});if(r&&r.length>0){d.allowCredentials=new Array(r.length);for(let p=0;p<r.length;p++){const s=r[p];d.allowCredentials[p]=Object.assign(Object.assign({},s),{id:Zx(s.id).buffer,type:s.type||"public-key",transports:s.transports})}}return d}function oTe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:jy(new Uint8Array(e.response.attestationObject)),clientDataJSON:jy(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function lTe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:jy(new Uint8Array(a.authenticatorData)),clientDataJSON:jy(new Uint8Array(a.clientDataJSON)),signature:jy(new Uint8Array(a.signature)),userHandle:a.userHandle?jy(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Fte(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function MW(){var e,t;return!!(Ro()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function cTe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new $P("Browser returned unexpected credential type",t)}:{data:null,error:new $P("Empty credential response",t)}}catch(t){return{data:null,error:tTe({error:t,options:e})}}}async function uTe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new $P("Browser returned unexpected credential type",t)}:{data:null,error:new $P("Empty credential response",t)}}catch(t){return{data:null,error:rTe({error:t,options:e})}}}const dTe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},hTe={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function VP(...e){const t=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),r=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),n={};for(const a of e)if(a)for(const d in a){const p=a[d];if(p!==void 0)if(Array.isArray(p))n[d]=p;else if(r(p))n[d]=p;else if(t(p)){const s=n[d];t(s)?n[d]=VP(s,p):n[d]=VP(p)}else n[d]=p}return n}function fTe(e,t){return VP(dTe,e,t||{})}function pTe(e,t){return VP(hTe,e,t||{})}class mTe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:a},d){try{const{data:p,error:s}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!p)return{data:null,error:s};const _=a??iTe.createNewAbortSignal();if(p.webauthn.type==="create"){const{user:b}=p.webauthn.credential_options.publicKey;b.name||(b.name=`${b.id}:${n}`),b.displayName||(b.displayName=b.name)}switch(p.webauthn.type){case"create":{const b=fTe(p.webauthn.credential_options.publicKey,d==null?void 0:d.create),{data:T,error:C}=await cTe({publicKey:b,signal:_});return T?{data:{factorId:t,challengeId:p.id,webauthn:{type:p.webauthn.type,credential_response:T}},error:null}:{data:null,error:C}}case"request":{const b=pTe(p.webauthn.credential_options.publicKey,d==null?void 0:d.request),{data:T,error:C}=await uTe(Object.assign(Object.assign({},p.webauthn.credential_options),{publicKey:b,signal:_}));return T?{data:{factorId:t,challengeId:p.id,webauthn:{type:p.webauthn.type,credential_response:T}},error:null}:{data:null,error:C}}}}catch(p){return fn(p)?{data:null,error:p}:{data:null,error:new _y("Unexpected error in challenge",p)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},d){if(!r)return{data:null,error:new RT("rpId is required for WebAuthn authentication")};try{if(!MW())return{data:null,error:new _y("Browser does not support WebAuthn",null)};const{data:p,error:s}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:a},{request:d});if(!p)return{data:null,error:s};const{webauthn:_}=p;return this._verify({factorId:t,challengeId:p.challengeId,webauthn:{type:_.type,rpId:r,rpOrigins:n,credential_response:_.credential_response}})}catch(p){return fn(p)?{data:null,error:p}:{data:null,error:new _y("Unexpected error in authenticate",p)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},d){if(!r)return{data:null,error:new RT("rpId is required for WebAuthn registration")};try{if(!MW())return{data:null,error:new _y("Browser does not support WebAuthn",null)};const{data:p,error:s}=await this._enroll({friendlyName:t});if(!p)return await this.client.mfa.listFactors().then(T=>{var C;return(C=T.data)===null||C===void 0?void 0:C.all.find(P=>P.factor_type==="webauthn"&&P.friendly_name===t&&P.status!=="unverified")}).then(T=>T?this.client.mfa.unenroll({factorId:T==null?void 0:T.id}):void 0),{data:null,error:s};const{data:_,error:b}=await this._challenge({factorId:p.id,friendlyName:p.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:a},{create:d});return _?this._verify({factorId:p.id,challengeId:_.challengeId,webauthn:{rpId:r,rpOrigins:n,type:_.webauthn.type,credential_response:_.webauthn.credential_response}}):{data:null,error:b}}catch(p){return fn(p)?{data:null,error:p}:{data:null,error:new _y("Unexpected error in register",p)}}}}YSe();const gTe={url:dSe,storageKey:hSe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fSe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function DW(e,t,r){return await r()}const ix={};class MT{get jwks(){var t,r;return(r=(t=ix[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){ix[this.storageKey]=Object.assign(Object.assign({},ix[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=ix[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ix[this.storageKey]=Object.assign(Object.assign({},ix[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const d=Object.assign(Object.assign({},gTe),t);if(this.storageKey=d.storageKey,this.instanceID=(r=MT.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,MT.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.instanceID>0&&Ro()){const p=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(p),this.logDebugMessages&&console.trace(p)}if(this.persistSession=d.persistSession,this.autoRefreshToken=d.autoRefreshToken,this.admin=new ZSe({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=Mte(d.fetch),this.lock=d.lock||DW,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,this.throwOnError=d.throwOnError,this.lockAcquireTimeout=d.lockAcquireTimeout,d.lock?this.lock=d.lock:this.persistSession&&Ro()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=KSe:this.lock=DW,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new mTe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(d.storage?this.storage=d.storage:Rte()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=RW(this.memoryStorage)),d.userStorage&&(this.userStorage=d.userStorage)):(this.memoryStorage={},this.storage=RW(this.memoryStorage)),Ro()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(p){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",p)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async p=>{this._debug("received broadcast notification from other tab or client",p),await this._notifyAllSubscribers(p.data.event,p.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ite}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(Ro()&&(r=CSe(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),Ro()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:d}=await this._getSessionFromURL(r,n);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),_Se(d)){const _=(t=d.details)===null||t===void 0?void 0:t.code;if(_==="identity_already_exists"||_==="identity_not_found"||_==="single_identity_not_deletable")return{error:d}}return{error:d}}const{session:p,redirectType:s}=a;return this._debug("#_initialize()","detected session in URL",p,"redirect type",s),await this._saveSession(p),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",p):await this._notifyAllSubscribers("SIGNED_IN",p)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return fn(r)?this._returnResult({error:r}):this._returnResult({error:new _y("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,a;try{const d=await In(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:Ju}),{data:p,error:s}=d;if(s||!p)return this._returnResult({data:{user:null,session:null},error:s});const _=p.session,b=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",_)),this._returnResult({data:{user:b,session:_},error:null})}catch(d){if(fn(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signUp(t){var r,n,a;try{let d;if("email"in t){const{email:T,password:C,options:P}=t;let k=null,B=null;this.flowType==="pkce"&&([k,B]=await tx(this.storage,this.storageKey)),d=await In(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:P==null?void 0:P.emailRedirectTo,body:{email:T,password:C,data:(r=P==null?void 0:P.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:P==null?void 0:P.captchaToken},code_challenge:k,code_challenge_method:B},xform:Ju})}else if("phone"in t){const{phone:T,password:C,options:P}=t;d=await In(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:C,data:(n=P==null?void 0:P.data)!==null&&n!==void 0?n:{},channel:(a=P==null?void 0:P.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:P==null?void 0:P.captchaToken}},xform:Ju})}else throw new hC("You must provide either an email or phone number and a password");const{data:p,error:s}=d;if(s||!p)return await Oo(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:s});const _=p.session,b=p.user;return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",_)),this._returnResult({data:{user:b,session:_},error:null})}catch(d){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithPassword(t){try{let r;if("email"in t){const{email:d,password:p,options:s}=t;r=await In(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:p,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:kW})}else if("phone"in t){const{phone:d,password:p,options:s}=t;r=await In(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:p,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:kW})}else throw new hC("You must provide either an email or phone number and a password");const{data:n,error:a}=r;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!n||!n.session||!n.user){const d=new ex;return this._returnResult({data:{user:null,session:null},error:d})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(r){if(fn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,a,d;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(d=t.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,a,d,p,s,_,b,T,C,P;let k,B;if("message"in t)k=t.message,B=t.signature;else{const{chain:R,wallet:D,statement:G,options:V}=t;let $;if(Ro())if(typeof D=="object")$=D;else{const ge=window;if("ethereum"in ge&&typeof ge.ethereum=="object"&&"request"in ge.ethereum&&typeof ge.ethereum.request=="function")$=ge.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof D!="object"||!(V!=null&&V.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=D}const K=new URL((r=V==null?void 0:V.url)!==null&&r!==void 0?r:window.location.href),Y=await $.request({method:"eth_requestAccounts"}).then(ge=>ge).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Y||Y.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const ee=Lte(Y[0]);let ae=(n=V==null?void 0:V.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!ae){const ge=await $.request({method:"eth_chainId"});ae=JSe(ge)}const ie={domain:K.host,address:ee,statement:G,uri:K.href,version:"1",chainId:ae,nonce:(a=V==null?void 0:V.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(p=(d=V==null?void 0:V.signInWithEthereum)===null||d===void 0?void 0:d.issuedAt)!==null&&p!==void 0?p:new Date,expirationTime:(s=V==null?void 0:V.signInWithEthereum)===null||s===void 0?void 0:s.expirationTime,notBefore:(_=V==null?void 0:V.signInWithEthereum)===null||_===void 0?void 0:_.notBefore,requestId:(b=V==null?void 0:V.signInWithEthereum)===null||b===void 0?void 0:b.requestId,resources:(T=V==null?void 0:V.signInWithEthereum)===null||T===void 0?void 0:T.resources};k=eTe(ie),B=await $.request({method:"personal_sign",params:[QSe(k),ee]})}try{const{data:R,error:D}=await In(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:k,signature:B},!((C=t.options)===null||C===void 0)&&C.captchaToken?{gotrue_meta_security:{captcha_token:(P=t.options)===null||P===void 0?void 0:P.captchaToken}}:null),xform:Ju});if(D)throw D;if(!R||!R.session||!R.user){const G=new ex;return this._returnResult({data:{user:null,session:null},error:G})}return R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),this._returnResult({data:Object.assign({},R),error:D})}catch(R){if(fn(R))return this._returnResult({data:{user:null,session:null},error:R});throw R}}async signInWithSolana(t){var r,n,a,d,p,s,_,b,T,C,P,k;let B,R;if("message"in t)B=t.message,R=t.signature;else{const{chain:D,wallet:G,statement:V,options:$}=t;let K;if(Ro())if(typeof G=="object")K=G;else{const ee=window;if("solana"in ee&&typeof ee.solana=="object"&&("signIn"in ee.solana&&typeof ee.solana.signIn=="function"||"signMessage"in ee.solana&&typeof ee.solana.signMessage=="function"))K=ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof G!="object"||!($!=null&&$.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");K=G}const Y=new URL((r=$==null?void 0:$.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in K&&K.signIn){const ee=await K.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},$==null?void 0:$.signInWithSolana),{version:"1",domain:Y.host,uri:Y.href}),V?{statement:V}:null));let ae;if(Array.isArray(ee)&&ee[0]&&typeof ee[0]=="object")ae=ee[0];else if(ee&&typeof ee=="object"&&"signedMessage"in ee&&"signature"in ee)ae=ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in ae&&"signature"in ae&&(typeof ae.signedMessage=="string"||ae.signedMessage instanceof Uint8Array)&&ae.signature instanceof Uint8Array)B=typeof ae.signedMessage=="string"?ae.signedMessage:new TextDecoder().decode(ae.signedMessage),R=ae.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in K)||typeof K.signMessage!="function"||!("publicKey"in K)||typeof K!="object"||!K.publicKey||!("toBase58"in K.publicKey)||typeof K.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");B=[`${Y.host} wants you to sign in with your Solana account:`,K.publicKey.toBase58(),...V?["",V,""]:[""],"Version: 1",`URI: ${Y.href}`,`Issued At: ${(a=(n=$==null?void 0:$.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((d=$==null?void 0:$.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${$.signInWithSolana.notBefore}`]:[],...!((p=$==null?void 0:$.signInWithSolana)===null||p===void 0)&&p.expirationTime?[`Expiration Time: ${$.signInWithSolana.expirationTime}`]:[],...!((s=$==null?void 0:$.signInWithSolana)===null||s===void 0)&&s.chainId?[`Chain ID: ${$.signInWithSolana.chainId}`]:[],...!((_=$==null?void 0:$.signInWithSolana)===null||_===void 0)&&_.nonce?[`Nonce: ${$.signInWithSolana.nonce}`]:[],...!((b=$==null?void 0:$.signInWithSolana)===null||b===void 0)&&b.requestId?[`Request ID: ${$.signInWithSolana.requestId}`]:[],...!((C=(T=$==null?void 0:$.signInWithSolana)===null||T===void 0?void 0:T.resources)===null||C===void 0)&&C.length?["Resources",...$.signInWithSolana.resources.map(ae=>`- ${ae}`)]:[]].join(`
`);const ee=await K.signMessage(new TextEncoder().encode(B),"utf8");if(!ee||!(ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");R=ee}}try{const{data:D,error:G}=await In(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:B,signature:jy(R)},!((P=t.options)===null||P===void 0)&&P.captchaToken?{gotrue_meta_security:{captcha_token:(k=t.options)===null||k===void 0?void 0:k.captchaToken}}:null),xform:Ju});if(G)throw G;if(!D||!D.session||!D.user){const V=new ex;return this._returnResult({data:{user:null,session:null},error:V})}return D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),this._returnResult({data:Object.assign({},D),error:G})}catch(D){if(fn(D))return this._returnResult({data:{user:null,session:null},error:D});throw D}}async _exchangeCodeForSession(t){const r=await sy(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(r??"").split("/");try{if(!n&&this.flowType==="pkce")throw new xSe;const{data:d,error:p}=await In(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Ju});if(await Oo(this.storage,`${this.storageKey}-code-verifier`),p)throw p;if(!d||!d.session||!d.user){const s=new ex;return this._returnResult({data:{user:null,session:null,redirectType:null},error:s})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:Object.assign(Object.assign({},d),{redirectType:a??null}),error:p})}catch(d){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(d))return this._returnResult({data:{user:null,session:null,redirectType:null},error:d});throw d}}async signInWithIdToken(t){try{const{options:r,provider:n,token:a,access_token:d,nonce:p}=t,s=await In(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:d,nonce:p,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Ju}),{data:_,error:b}=s;if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!_||!_.session||!_.user){const T=new ex;return this._returnResult({data:{user:null,session:null},error:T})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:_,error:b})}catch(r){if(fn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,a,d,p;try{if("email"in t){const{email:s,options:_}=t;let b=null,T=null;this.flowType==="pkce"&&([b,T]=await tx(this.storage,this.storageKey));const{error:C}=await In(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(r=_==null?void 0:_.data)!==null&&r!==void 0?r:{},create_user:(n=_==null?void 0:_.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken},code_challenge:b,code_challenge_method:T},redirectTo:_==null?void 0:_.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:C})}if("phone"in t){const{phone:s,options:_}=t,{data:b,error:T}=await In(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(a=_==null?void 0:_.data)!==null&&a!==void 0?a:{},create_user:(d=_==null?void 0:_.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken},channel:(p=_==null?void 0:_.channel)!==null&&p!==void 0?p:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:b==null?void 0:b.message_id},error:T})}throw new hC("You must provide either an email or phone number.")}catch(s){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async verifyOtp(t){var r,n;try{let a,d;"options"in t&&(a=(r=t.options)===null||r===void 0?void 0:r.redirectTo,d=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:p,error:s}=await In(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:d}}),redirectTo:a,xform:Ju});if(s)throw s;if(!p)throw new Error("An error occurred on token verification.");const _=p.session,b=p.user;return _!=null&&_.access_token&&(await this._saveSession(_),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",_)),this._returnResult({data:{user:b,session:_},error:null})}catch(a){if(fn(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(t){var r,n,a,d,p;try{let s=null,_=null;this.flowType==="pkce"&&([s,_]=await tx(this.storage,this.storageKey));const b=await In(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:_}),headers:this.headers,xform:GSe});return!((d=b.data)===null||d===void 0)&&d.url&&Ro()&&!(!((p=t.options)===null||p===void 0)&&p.skipBrowserRedirect)&&window.location.assign(b.data.url),this._returnResult(b)}catch(s){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(s))return this._returnResult({data:null,error:s});throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new wc;const{error:a}=await In(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(t){if(fn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:a,options:d}=t,{error:p}=await In(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},redirectTo:d==null?void 0:d.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}else if("phone"in t){const{phone:n,type:a,options:d}=t,{data:p,error:s}=await In(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:p==null?void 0:p.message_id},error:s})}throw new hC("You must provide either an email or phone number and a type")}catch(r){if(fn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await sy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<rD:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const p=await sy(this.userStorage,this.storageKey+"-user");p!=null&&p.user?t.user=p.user:t.user=sD()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const p={value:this.suppressGetSessionWarning};t.user=$Se(t.user,p),p.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:a,error:d}=await this._callRefreshToken(t.refresh_token);return d?this._returnResult({data:{session:null},error:d}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(t){try{return t?await In(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Qp}):await this._useSession(async r=>{var n,a,d;const{data:p,error:s}=r;if(s)throw s;return!(!((n=p.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new wc}:await In(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(a=p.session)===null||a===void 0?void 0:a.access_token)!==null&&d!==void 0?d:void 0,xform:Qp})})}catch(r){if(fn(r))return vSe(r)&&(await this._removeSession(),await Oo(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:a,error:d}=n;if(d)throw d;if(!a.session)throw new wc;const p=a.session;let s=null,_=null;this.flowType==="pkce"&&t.email!=null&&([s,_]=await tx(this.storage,this.storageKey));const{data:b,error:T}=await In(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:s,code_challenge_method:_}),jwt:p.access_token,xform:Qp});if(T)throw T;return p.user=b.user,await this._saveSession(p),await this._notifyAllSubscribers("USER_UPDATED",p),this._returnResult({data:{user:p.user},error:null})})}catch(n){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new wc;const r=Date.now()/1e3;let n=r,a=!0,d=null;const{payload:p}=iD(t.access_token);if(p.exp&&(n=p.exp,a=n<=r),a){const{data:s,error:_}=await this._callRefreshToken(t.refresh_token);if(_)return this._returnResult({data:{user:null,session:null},error:_});if(!s)return{data:{user:null,session:null},error:null};d=s}else{const{data:s,error:_}=await this._getUser(t.access_token);if(_)throw _;d={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return this._returnResult({data:{user:d.user,session:d},error:null})}catch(r){if(fn(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:p,error:s}=r;if(s)throw s;t=(n=p.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new wc;const{data:a,error:d}=await this._callRefreshToken(t.refresh_token);return d?this._returnResult({data:{user:null,session:null},error:d}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(fn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!Ro())throw new fC("No browser detected.");if(t.error||t.error_description||t.error_code)throw new fC(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new EW("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new fC("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new EW("No code detected.");const{data:V,error:$}=await this._exchangeCodeForSession(t.code);if($)throw $;const K=new URL(window.location.href);return K.searchParams.delete("code"),window.history.replaceState(window.history.state,"",K.toString()),{data:{session:V.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:d,refresh_token:p,expires_in:s,expires_at:_,token_type:b}=t;if(!d||!s||!p||!b)throw new fC("No session defined in URL");const T=Math.round(Date.now()/1e3),C=parseInt(s);let P=T+C;_&&(P=parseInt(_));const k=P-T;k*1e3<=mx&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${k}s, should have been closer to ${C}s`);const B=P-C;T-B>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",B,P,T):T-B<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",B,P,T);const{data:R,error:D}=await this._getUser(d);if(D)throw D;const G={provider_token:n,provider_refresh_token:a,access_token:d,expires_in:C,expires_at:P,refresh_token:p,token_type:b,user:R.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:G,redirectType:t.type},error:null})}catch(n){if(fn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await sy(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:a,error:d}=r;if(d)return this._returnResult({error:d});const p=(n=a.session)===null||n===void 0?void 0:n.access_token;if(p){const{error:s}=await this.admin.signOut(p,t);if(s&&!(ySe(s)&&(s.status===404||s.status===401||s.status===403)))return this._returnResult({error:s})}return t!=="others"&&(await this._removeSession(),await Oo(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=ASe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,a;try{const{data:{session:d},error:p}=r;if(p)throw p;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",t,"session",d)}catch(d){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",d),console.error(d)}})}async resetPasswordForEmail(t,r={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await tx(this.storage,this.storageKey,!0));try{return await In(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(d))return this._returnResult({data:null,error:d});throw d}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:a}=await this._useSession(async d=>{var p,s,_,b,T;const{data:C,error:P}=d;if(P)throw P;const k=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(p=t.options)===null||p===void 0?void 0:p.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(_=t.options)===null||_===void 0?void 0:_.queryParams,skipBrowserRedirect:!0});return await In(this.fetch,"GET",k,{headers:this.headers,jwt:(T=(b=C.session)===null||b===void 0?void 0:b.access_token)!==null&&T!==void 0?T:void 0})});if(a)throw a;return Ro()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(fn(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:a,data:{session:d}}=r;if(a)throw a;const{options:p,provider:s,token:_,access_token:b,nonce:T}=t,C=await In(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=d==null?void 0:d.access_token)!==null&&n!==void 0?n:void 0,body:{provider:s,id_token:_,access_token:b,nonce:T,link_identity:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Ju}),{data:P,error:k}=C;return k?this._returnResult({data:{user:null,session:null},error:k}):!P||!P.session||!P.user?this._returnResult({data:{user:null,session:null},error:new ex}):(P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("USER_UPDATED",P.session)),this._returnResult({data:P,error:k}))}catch(a){if(await Oo(this.storage,`${this.storageKey}-code-verifier`),fn(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,a;const{data:d,error:p}=r;if(p)throw p;return await In(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(n=d.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await ISe(async a=>(a>0&&await NSe(200*Math.pow(2,a-1)),this._debug(r,"refreshing attempt",a),await In(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ju})),(a,d)=>{const p=200*Math.pow(2,a);return d&&nD(d)&&Date.now()+p-n<mx})}catch(n){if(this._debug(r,"error",n),fn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),Ro()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await sy(this.storage,this.storageKey);if(a&&this.userStorage){let p=await sy(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!p&&(p={user:a.user},await gx(this.userStorage,this.storageKey+"-user",p)),a.user=(t=p==null?void 0:p.user)!==null&&t!==void 0?t:sD()}else if(a&&!a.user&&!a.user){const p=await sy(this.storage,this.storageKey+"-user");p&&(p!=null&&p.user)?(a.user=p.user,await Oo(this.storage,this.storageKey+"-user"),await gx(this.storage,this.storageKey,a)):a.user=sD()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const d=((r=a.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<rD;if(this._debug(n,`session has${d?"":" not"} expired with margin of ${rD}s`),d){if(this.autoRefreshToken&&a.refresh_token){const{error:p}=await this._callRefreshToken(a.refresh_token);p&&(console.error(p),nD(p)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",p),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:p,error:s}=await this._getUser(a.access_token);!s&&(p!=null&&p.user)?(a.user=p.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(p){console.error("Error getting user data:",p),this._debug(n,"error getting user data, skipping SIGNED_IN notification",p)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new wc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new ZI;const{data:d,error:p}=await this._refreshAccessToken(t);if(p)throw p;if(!d.session)throw new wc;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const s={data:d.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(d){if(this._debug(a,"error",d),fn(d)){const p={data:null,error:d};return nD(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(p),p}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(d),d}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,r,n=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const d=[],p=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(t,r)}catch(_){d.push(_)}});if(await Promise.all(p),d.length>0){for(let s=0;s<d.length;s+=1)console.error(d[s]);throw d[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Oo(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await gx(this.userStorage,this.storageKey+"-user",{user:r.user});const a=Object.assign({},r);delete a.user;const d=NW(a);await gx(this.storage,this.storageKey,d)}else{const a=NW(r);await gx(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Oo(this.storage,this.storageKey),await Oo(this.storage,this.storageKey+"-code-verifier"),await Oo(this.storage,this.storageKey+"-user"),this.userStorage&&await Oo(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ro()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),mx);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-t)/mx);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${mx}ms, refresh threshold is ${B3} ticks`),a<=B3&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Dte)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ro()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const a=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[d,p]=await tx(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(p)}`});a.push(s.toString())}if(n!=null&&n.queryParams){const d=new URLSearchParams(n.queryParams);a.push(d.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:a,error:d}=r;return d?this._returnResult({data:null,error:d}):await In(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,a;const{data:d,error:p}=r;if(p)return this._returnResult({data:null,error:p});const s=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:_,error:b}=await In(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(n=d==null?void 0:d.session)===null||n===void 0?void 0:n.access_token});return b?this._returnResult({data:null,error:b}):(t.factorType==="totp"&&_.type==="totp"&&(!((a=_==null?void 0:_.totp)===null||a===void 0)&&a.qr_code)&&(_.totp.qr_code=`data:image/svg+xml;utf-8,${_.totp.qr_code}`),this._returnResult({data:_,error:null}))})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:a,error:d}=r;if(d)return this._returnResult({data:null,error:d});const p=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?oTe(t.webauthn.credential_response):lTe(t.webauthn.credential_response)})}:{code:t.code}),{data:s,error:_}=await In(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:p,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return _?this._returnResult({data:null,error:_}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),this._returnResult({data:s,error:_}))})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:a,error:d}=r;if(d)return this._returnResult({data:null,error:d});const p=await In(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});if(p.error)return p;const{data:s}=p;if(s.type!=="webauthn")return{data:s,error:null};switch(s.webauthn.type){case"create":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:sTe(s.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:aTe(s.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const a={all:[],phone:[],totp:[],webauthn:[]};for(const d of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])a.all.push(d),d.status==="verified"&&a[d.factor_type].push(d);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=iD(n.access_token);let p=null;d.aal&&(p=d.aal);let s=p;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(T=>T.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(s="aal2");const b=d.amr||[];return{data:{currentLevel:p,nextLevel:s,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:a}=r;return a?this._returnResult({data:null,error:a}):n?await In(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:d=>({data:d,error:null})}):this._returnResult({data:null,error:new wc})})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:a},error:d}=n;if(d)return this._returnResult({data:null,error:d});if(!a)return this._returnResult({data:null,error:new wc});const p=await In(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:s=>({data:s,error:null})});return p.data&&p.data.redirect_url&&Ro()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(p.data.redirect_url),p})}catch(n){if(fn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:a},error:d}=n;if(d)return this._returnResult({data:null,error:d});if(!a)return this._returnResult({data:null,error:new wc});const p=await In(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:s=>({data:s,error:null})});return p.data&&p.data.redirect_url&&Ro()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(p.data.redirect_url),p})}catch(n){if(fn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await In(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new wc})})}catch(t){if(fn(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:a}=r;return a?this._returnResult({data:null,error:a}):n?(await In(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new wc})})}catch(r){if(fn(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(s=>s.kid===t);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(s=>s.kid===t),n&&this.jwks_cached_at+mSe>a)return n;const{data:d,error:p}=await In(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(p)throw p;return!d.keys||d.keys.length===0||(this.jwks=d,this.jwks_cached_at=a,n=d.keys.find(s=>s.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:k,error:B}=await this.getSession();if(B||!k.session)return this._returnResult({data:null,error:B});n=k.session.access_token}const{header:a,payload:d,signature:p,raw:{header:s,payload:_}}=iD(n);r!=null&&r.allowExpired||FSe(d.exp);const b=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!b){const{error:k}=await this.getUser(n);if(k)throw k;return{data:{claims:d,header:a,signature:p},error:null}}const T=zSe(a.alg),C=await crypto.subtle.importKey("jwk",b,T,!0,["verify"]);if(!await crypto.subtle.verify(T,C,p,ESe(`${s}.${_}`)))throw new U3("Invalid JWT signature");return{data:{claims:d,header:a,signature:p},error:null}}catch(n){if(fn(n))return this._returnResult({data:null,error:n});throw n}}}MT.nextInstanceID={};const yTe=MT,vTe="2.90.1";let wS="";typeof Deno<"u"?wS="deno":typeof document<"u"?wS="web":typeof navigator<"u"&&navigator.product==="ReactNative"?wS="react-native":wS="node";const _Te={"X-Client-Info":`supabase-js-${wS}/${vTe}`},xTe={headers:_Te},bTe={schema:"public"},wTe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},STe={};function DT(e){"@babel/helpers - typeof";return DT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DT(e)}function TTe(e,t){if(DT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(DT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ETe(e){var t=TTe(e,"string");return DT(t)=="symbol"?t:t+""}function jTe(e,t,r){return(t=ETe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function LW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LW(Object(r),!0).forEach(function(n){jTe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const ATe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),CTe=()=>Headers,PTe=(e,t,r)=>{const n=ATe(r),a=CTe();return async(d,p)=>{var s;const _=(s=await t())!==null&&s!==void 0?s:e;let b=new a(p==null?void 0:p.headers);return b.has("apikey")||b.set("apikey",e),b.has("Authorization")||b.set("Authorization",`Bearer ${_}`),n(d,ha(ha({},p),{},{headers:b}))}};function NTe(e){return e.endsWith("/")?e:e+"/"}function ITe(e,t){var r,n;const{db:a,auth:d,realtime:p,global:s}=e,{db:_,auth:b,realtime:T,global:C}=t,P={db:ha(ha({},_),a),auth:ha(ha({},b),d),realtime:ha(ha({},T),p),storage:{},global:ha(ha(ha({},C),s),{},{headers:ha(ha({},(r=C==null?void 0:C.headers)!==null&&r!==void 0?r:{}),(n=s==null?void 0:s.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?P.accessToken=e.accessToken:delete P.accessToken,P}function kTe(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(NTe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var OTe=class extends yTe{constructor(e){super(e)}},RTe=class{constructor(e,t,r){var n,a;this.supabaseUrl=e,this.supabaseKey=t;const d=kTe(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",d),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",d),this.storageUrl=new URL("storage/v1",d),this.functionsUrl=new URL("functions/v1",d);const p=`sb-${d.hostname.split(".")[0]}-auth-token`,s={db:bTe,realtime:STe,auth:ha(ha({},wTe),{},{storageKey:p}),global:xTe},_=ITe(r??{},s);if(this.storageKey=(n=_.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=_.global.headers)!==null&&a!==void 0?a:{},_.accessToken)this.accessToken=_.accessToken,this.auth=new Proxy({},{get:(T,C)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(C)} is not possible`)}});else{var b;this.auth=this._initSupabaseAuthClient((b=_.auth)!==null&&b!==void 0?b:{},this.headers,_.global.fetch)}this.fetch=PTe(t,this._getAccessToken.bind(this),_.global.fetch),this.realtime=this._initRealtimeClient(ha({headers:this.headers,accessToken:this._getAccessToken.bind(this)},_.realtime)),this.accessToken&&this.accessToken().then(T=>this.realtime.setAuth(T)).catch(T=>console.warn("Failed to set initial Realtime auth token:",T)),this.rest=new f1e(new URL("rest/v1",d).href,{headers:this.headers,schema:_.db.schema,fetch:this.fetch}),this.storage=new uSe(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),_.accessToken||this._listenForAuthEvents()}get functions(){return new l1e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,r;if(e.accessToken)return await e.accessToken();const{data:n}=await e.auth.getSession();return(t=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:a,storageKey:d,flowType:p,lock:s,debug:_,throwOnError:b},T,C){const P={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new OTe({url:this.authUrl.href,headers:ha(ha({},P),T),storageKey:d,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:a,flowType:p,lock:s,debug:_,throwOnError:b,fetch:C,hasCustomAuthorizationHeader:Object.keys(this.headers).some(k=>k.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new N1e(this.realtimeUrl.href,ha(ha({},e),{},{params:ha(ha({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const MTe=(e,t,r)=>new RTe(e,t,r);function DTe(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const r=t.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}DTe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const LTe="https://iartslbielcqmuhygzku.supabase.co",FTe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhcnRzbGJpZWxjcW11aHlnemt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzcyMTksImV4cCI6MjA4NDUxMzIxOX0.x4GBrKFjkxbT8me-0d3pwYdOzlIcOJ9FFY5qs3cEaHI",dt=MTe(LTe,FTe,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),zte=F.createContext(void 0),zTe=({children:e})=>{const[t,r]=F.useState(()=>localStorage.getItem("selectedCityId")),[n,a]=F.useState([]),[d,p]=F.useState(!0);F.useEffect(()=>{(async()=>{const{data:T,error:C}=await dt.from("cities").select("id, name, state").eq("is_active",!0).order("name");!C&&T&&(a(T),!t&&T.length>0&&r(T[0].id)),p(!1)})()},[]),F.useEffect(()=>{t?localStorage.setItem("selectedCityId",t):localStorage.removeItem("selectedCityId")},[t]);const s=n.find(b=>b.id===t),_=s?`${s.name} - ${s.state}`:null;return c.jsx(zte.Provider,{value:{selectedCityId:t,selectedCityName:_,cities:n,setSelectedCityId:r,isLoading:d},children:e})},H2=()=>{const e=F.useContext(zte);if(e===void 0)throw new Error("useAddress must be used within an AddressProvider");return e},O4=F.createContext({});function R4(e){const t=F.useRef(null);return t.current===null&&(t.current=e()),t.current}const Bte=typeof window<"u",$te=Bte?F.useLayoutEffect:F.useEffect,XI=F.createContext(null);function M4(e,t){e.indexOf(t)===-1&&e.push(t)}function D4(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Ch=(e,t,r)=>r>t?t:r<e?e:r;let L4=()=>{};const Lf={},Vte=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function Ute(e){return typeof e=="object"&&e!==null}const qte=e=>/^0[^.\s]+$/u.test(e);function F4(e){let t;return()=>(t===void 0&&(t=e()),t)}const wu=e=>e,BTe=(e,t)=>r=>t(e(r)),Z2=(...e)=>e.reduce(BTe),LT=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class z4{constructor(){this.subscriptions=[]}add(t){return M4(this.subscriptions,t),()=>D4(this.subscriptions,t)}notify(t,r,n){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,r,n);else for(let d=0;d<a;d++){const p=this.subscriptions[d];p&&p(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ef=e=>e*1e3,_u=e=>e/1e3;function Gte(e,t){return t?e*(1e3/t):0}const Wte=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,$Te=1e-7,VTe=12;function UTe(e,t,r,n,a){let d,p,s=0;do p=t+(r-t)/2,d=Wte(p,n,a)-e,d>0?r=p:t=p;while(Math.abs(d)>$Te&&++s<VTe);return p}function X2(e,t,r,n){if(e===t&&r===n)return wu;const a=d=>UTe(d,0,1,e,r);return d=>d===0||d===1?d:Wte(a(d),t,n)}const Hte=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Zte=e=>t=>1-e(1-t),Xte=X2(.33,1.53,.69,.99),B4=Zte(Xte),Kte=Hte(B4),Yte=e=>(e*=2)<1?.5*B4(e):.5*(2-Math.pow(2,-10*(e-1))),$4=e=>1-Math.sin(Math.acos(e)),Jte=Zte($4),Qte=Hte($4),qTe=X2(.42,0,1,1),GTe=X2(0,0,.58,1),ere=X2(.42,0,.58,1),WTe=e=>Array.isArray(e)&&typeof e[0]!="number",tre=e=>Array.isArray(e)&&typeof e[0]=="number",HTe={linear:wu,easeIn:qTe,easeInOut:ere,easeOut:GTe,circIn:$4,circInOut:Qte,circOut:Jte,backIn:B4,backInOut:Kte,backOut:Xte,anticipate:Yte},ZTe=e=>typeof e=="string",FW=e=>{if(tre(e)){L4(e.length===4);const[t,r,n,a]=e;return X2(t,r,n,a)}else if(ZTe(e))return HTe[e];return e},pC=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function XTe(e,t){let r=new Set,n=new Set,a=!1,d=!1;const p=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function _(T){p.has(T)&&(b.schedule(T),e()),T(s)}const b={schedule:(T,C=!1,P=!1)=>{const B=P&&a?r:n;return C&&p.add(T),B.has(T)||B.add(T),T},cancel:T=>{n.delete(T),p.delete(T)},process:T=>{if(s=T,a){d=!0;return}a=!0,[r,n]=[n,r],r.forEach(_),r.clear(),a=!1,d&&(d=!1,b.process(T))}};return b}const KTe=40;function rre(e,t){let r=!1,n=!0;const a={delta:0,timestamp:0,isProcessing:!1},d=()=>r=!0,p=pC.reduce(($,K)=>($[K]=XTe(d),$),{}),{setup:s,read:_,resolveKeyframes:b,preUpdate:T,update:C,preRender:P,render:k,postRender:B}=p,R=()=>{const $=Lf.useManualTiming?a.timestamp:performance.now();r=!1,Lf.useManualTiming||(a.delta=n?1e3/60:Math.max(Math.min($-a.timestamp,KTe),1)),a.timestamp=$,a.isProcessing=!0,s.process(a),_.process(a),b.process(a),T.process(a),C.process(a),P.process(a),k.process(a),B.process(a),a.isProcessing=!1,r&&t&&(n=!1,e(R))},D=()=>{r=!0,n=!0,a.isProcessing||e(R)};return{schedule:pC.reduce(($,K)=>{const Y=p[K];return $[K]=(ee,ae=!1,ie=!1)=>(r||D(),Y.schedule(ee,ae,ie)),$},{}),cancel:$=>{for(let K=0;K<pC.length;K++)p[pC[K]].cancel($)},state:a,steps:p}}const{schedule:zs,cancel:Rm,state:Lo,steps:oD}=rre(typeof requestAnimationFrame<"u"?requestAnimationFrame:wu,!0);let QC;function YTe(){QC=void 0}const Rl={now:()=>(QC===void 0&&Rl.set(Lo.isProcessing||Lf.useManualTiming?Lo.timestamp:performance.now()),QC),set:e=>{QC=e,queueMicrotask(YTe)}},nre=e=>t=>typeof t=="string"&&t.startsWith(e),ire=nre("--"),JTe=nre("var(--"),V4=e=>JTe(e)?QTe.test(e.split("/*")[0].trim()):!1,QTe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function zW(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const _b={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},FT={..._b,transform:e=>Ch(0,1,e)},mC={..._b,default:1},HS=e=>Math.round(e*1e5)/1e5,U4=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function e2e(e){return e==null}const t2e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,q4=(e,t)=>r=>!!(typeof r=="string"&&t2e.test(r)&&r.startsWith(e)||t&&!e2e(r)&&Object.prototype.hasOwnProperty.call(r,t)),sre=(e,t,r)=>n=>{if(typeof n!="string")return n;const[a,d,p,s]=n.match(U4);return{[e]:parseFloat(a),[t]:parseFloat(d),[r]:parseFloat(p),alpha:s!==void 0?parseFloat(s):1}},r2e=e=>Ch(0,255,e),lD={..._b,transform:e=>Math.round(r2e(e))},Ay={test:q4("rgb","red"),parse:sre("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+lD.transform(e)+", "+lD.transform(t)+", "+lD.transform(r)+", "+HS(FT.transform(n))+")"};function n2e(e){let t="",r="",n="",a="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),a=e.substring(4,5),t+=t,r+=r,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}}const q3={test:q4("#"),parse:n2e,transform:Ay.transform},K2=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Up=K2("deg"),wh=K2("%"),Xr=K2("px"),i2e=K2("vh"),s2e=K2("vw"),BW={...wh,parse:e=>wh.parse(e)/100,transform:e=>wh.transform(e*100)},Ix={test:q4("hsl","hue"),parse:sre("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+wh.transform(HS(t))+", "+wh.transform(HS(r))+", "+HS(FT.transform(n))+")"},ka={test:e=>Ay.test(e)||q3.test(e)||Ix.test(e),parse:e=>Ay.test(e)?Ay.parse(e):Ix.test(e)?Ix.parse(e):q3.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Ay.transform(e):Ix.transform(e),getAnimatableNone:e=>{const t=ka.parse(e);return t.alpha=0,ka.transform(t)}},a2e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function o2e(e){var t,r;return isNaN(e)&&typeof e=="string"&&(((t=e.match(U4))==null?void 0:t.length)||0)+(((r=e.match(a2e))==null?void 0:r.length)||0)>0}const are="number",ore="color",l2e="var",c2e="var(",$W="${}",u2e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function zT(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},a=[];let d=0;const s=t.replace(u2e,_=>(ka.test(_)?(n.color.push(d),a.push(ore),r.push(ka.parse(_))):_.startsWith(c2e)?(n.var.push(d),a.push(l2e),r.push(_)):(n.number.push(d),a.push(are),r.push(parseFloat(_))),++d,$W)).split($W);return{values:r,split:s,indexes:n,types:a}}function lre(e){return zT(e).values}function cre(e){const{split:t,types:r}=zT(e),n=t.length;return a=>{let d="";for(let p=0;p<n;p++)if(d+=t[p],a[p]!==void 0){const s=r[p];s===are?d+=HS(a[p]):s===ore?d+=ka.transform(a[p]):d+=a[p]}return d}}const d2e=e=>typeof e=="number"?0:ka.test(e)?ka.getAnimatableNone(e):e;function h2e(e){const t=lre(e);return cre(e)(t.map(d2e))}const Mm={test:o2e,parse:lre,createTransformer:cre,getAnimatableNone:h2e};function cD(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function f2e({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let a=0,d=0,p=0;if(!t)a=d=p=r;else{const s=r<.5?r*(1+t):r+t-r*t,_=2*r-s;a=cD(_,s,e+1/3),d=cD(_,s,e),p=cD(_,s,e-1/3)}return{red:Math.round(a*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:n}}function UP(e,t){return r=>r>0?t:e}const ea=(e,t,r)=>e+(t-e)*r,uD=(e,t,r)=>{const n=e*e,a=r*(t*t-n)+n;return a<0?0:Math.sqrt(a)},p2e=[q3,Ay,Ix],m2e=e=>p2e.find(t=>t.test(e));function VW(e){const t=m2e(e);if(!t)return!1;let r=t.parse(e);return t===Ix&&(r=f2e(r)),r}const UW=(e,t)=>{const r=VW(e),n=VW(t);if(!r||!n)return UP(e,t);const a={...r};return d=>(a.red=uD(r.red,n.red,d),a.green=uD(r.green,n.green,d),a.blue=uD(r.blue,n.blue,d),a.alpha=ea(r.alpha,n.alpha,d),Ay.transform(a))},G3=new Set(["none","hidden"]);function g2e(e,t){return G3.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function y2e(e,t){return r=>ea(e,t,r)}function G4(e){return typeof e=="number"?y2e:typeof e=="string"?V4(e)?UP:ka.test(e)?UW:x2e:Array.isArray(e)?ure:typeof e=="object"?ka.test(e)?UW:v2e:UP}function ure(e,t){const r=[...e],n=r.length,a=e.map((d,p)=>G4(d)(d,t[p]));return d=>{for(let p=0;p<n;p++)r[p]=a[p](d);return r}}function v2e(e,t){const r={...e,...t},n={};for(const a in r)e[a]!==void 0&&t[a]!==void 0&&(n[a]=G4(e[a])(e[a],t[a]));return a=>{for(const d in n)r[d]=n[d](a);return r}}function _2e(e,t){const r=[],n={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const d=t.types[a],p=e.indexes[d][n[d]],s=e.values[p]??0;r[a]=s,n[d]++}return r}const x2e=(e,t)=>{const r=Mm.createTransformer(t),n=zT(e),a=zT(t);return n.indexes.var.length===a.indexes.var.length&&n.indexes.color.length===a.indexes.color.length&&n.indexes.number.length>=a.indexes.number.length?G3.has(e)&&!a.values.length||G3.has(t)&&!n.values.length?g2e(e,t):Z2(ure(_2e(n,a),a.values),r):UP(e,t)};function dre(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?ea(e,t,r):G4(e)(e,t)}const b2e=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>zs.update(t,r),stop:()=>Rm(t),now:()=>Lo.isProcessing?Lo.timestamp:Rl.now()}},hre=(e,t,r=10)=>{let n="";const a=Math.max(Math.round(t/r),2);for(let d=0;d<a;d++)n+=Math.round(e(d/(a-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},qP=2e4;function W4(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<qP;)t+=r,n=e.next(t);return t>=qP?1/0:t}function w2e(e,t=100,r){const n=r({...e,keyframes:[0,t]}),a=Math.min(W4(n),qP);return{type:"keyframes",ease:d=>n.next(a*d).value/t,duration:_u(a)}}const S2e=5;function fre(e,t,r){const n=Math.max(t-S2e,0);return Gte(r-e(n),t-n)}const fa={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dD=.001;function T2e({duration:e=fa.duration,bounce:t=fa.bounce,velocity:r=fa.velocity,mass:n=fa.mass}){let a,d,p=1-t;p=Ch(fa.minDamping,fa.maxDamping,p),e=Ch(fa.minDuration,fa.maxDuration,_u(e)),p<1?(a=b=>{const T=b*p,C=T*e,P=T-r,k=W3(b,p),B=Math.exp(-C);return dD-P/k*B},d=b=>{const C=b*p*e,P=C*r+r,k=Math.pow(p,2)*Math.pow(b,2)*e,B=Math.exp(-C),R=W3(Math.pow(b,2),p);return(-a(b)+dD>0?-1:1)*((P-k)*B)/R}):(a=b=>{const T=Math.exp(-b*e),C=(b-r)*e+1;return-dD+T*C},d=b=>{const T=Math.exp(-b*e),C=(r-b)*(e*e);return T*C});const s=5/e,_=j2e(a,d,s);if(e=Ef(e),isNaN(_))return{stiffness:fa.stiffness,damping:fa.damping,duration:e};{const b=Math.pow(_,2)*n;return{stiffness:b,damping:p*2*Math.sqrt(n*b),duration:e}}}const E2e=12;function j2e(e,t,r){let n=r;for(let a=1;a<E2e;a++)n=n-e(n)/t(n);return n}function W3(e,t){return e*Math.sqrt(1-t*t)}const A2e=["duration","bounce"],C2e=["stiffness","damping","mass"];function qW(e,t){return t.some(r=>e[r]!==void 0)}function P2e(e){let t={velocity:fa.velocity,stiffness:fa.stiffness,damping:fa.damping,mass:fa.mass,isResolvedFromDuration:!1,...e};if(!qW(e,C2e)&&qW(e,A2e))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),a=n*n,d=2*Ch(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:fa.mass,stiffness:a,damping:d}}else{const r=T2e(e);t={...t,...r,mass:fa.mass},t.isResolvedFromDuration=!0}return t}function GP(e=fa.visualDuration,t=fa.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:a}=r;const d=r.keyframes[0],p=r.keyframes[r.keyframes.length-1],s={done:!1,value:d},{stiffness:_,damping:b,mass:T,duration:C,velocity:P,isResolvedFromDuration:k}=P2e({...r,velocity:-_u(r.velocity||0)}),B=P||0,R=b/(2*Math.sqrt(_*T)),D=p-d,G=_u(Math.sqrt(_/T)),V=Math.abs(D)<5;n||(n=V?fa.restSpeed.granular:fa.restSpeed.default),a||(a=V?fa.restDelta.granular:fa.restDelta.default);let $;if(R<1){const Y=W3(G,R);$=ee=>{const ae=Math.exp(-R*G*ee);return p-ae*((B+R*G*D)/Y*Math.sin(Y*ee)+D*Math.cos(Y*ee))}}else if(R===1)$=Y=>p-Math.exp(-G*Y)*(D+(B+G*D)*Y);else{const Y=G*Math.sqrt(R*R-1);$=ee=>{const ae=Math.exp(-R*G*ee),ie=Math.min(Y*ee,300);return p-ae*((B+R*G*D)*Math.sinh(ie)+Y*D*Math.cosh(ie))/Y}}const K={calculatedDuration:k&&C||null,next:Y=>{const ee=$(Y);if(k)s.done=Y>=C;else{let ae=Y===0?B:0;R<1&&(ae=Y===0?Ef(B):fre($,Y,ee));const ie=Math.abs(ae)<=n,ge=Math.abs(p-ee)<=a;s.done=ie&&ge}return s.value=s.done?p:ee,s},toString:()=>{const Y=Math.min(W4(K),qP),ee=hre(ae=>K.next(Y*ae).value,Y,30);return Y+"ms "+ee},toTransition:()=>{}};return K}GP.applyToOptions=e=>{const t=w2e(e,100,GP);return e.ease=t.ease,e.duration=Ef(t.duration),e.type="keyframes",e};function H3({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:a=10,bounceStiffness:d=500,modifyTarget:p,min:s,max:_,restDelta:b=.5,restSpeed:T}){const C=e[0],P={done:!1,value:C},k=ie=>s!==void 0&&ie<s||_!==void 0&&ie>_,B=ie=>s===void 0?_:_===void 0||Math.abs(s-ie)<Math.abs(_-ie)?s:_;let R=r*t;const D=C+R,G=p===void 0?D:p(D);G!==D&&(R=G-C);const V=ie=>-R*Math.exp(-ie/n),$=ie=>G+V(ie),K=ie=>{const ge=V(ie),fe=$(ie);P.done=Math.abs(ge)<=b,P.value=P.done?G:fe};let Y,ee;const ae=ie=>{k(P.value)&&(Y=ie,ee=GP({keyframes:[P.value,B(P.value)],velocity:fre($,ie,P.value),damping:a,stiffness:d,restDelta:b,restSpeed:T}))};return ae(0),{calculatedDuration:null,next:ie=>{let ge=!1;return!ee&&Y===void 0&&(ge=!0,K(ie),ae(ie)),Y!==void 0&&ie>=Y?ee.next(ie-Y):(!ge&&K(ie),P)}}}function N2e(e,t,r){const n=[],a=r||Lf.mix||dre,d=e.length-1;for(let p=0;p<d;p++){let s=a(e[p],e[p+1]);if(t){const _=Array.isArray(t)?t[p]||wu:t;s=Z2(_,s)}n.push(s)}return n}function I2e(e,t,{clamp:r=!0,ease:n,mixer:a}={}){const d=e.length;if(L4(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const p=e[0]===e[1];e[0]>e[d-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=N2e(t,n,a),_=s.length,b=T=>{if(p&&T<e[0])return t[0];let C=0;if(_>1)for(;C<e.length-2&&!(T<e[C+1]);C++);const P=LT(e[C],e[C+1],T);return s[C](P)};return r?T=>b(Ch(e[0],e[d-1],T)):b}function k2e(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const a=LT(0,t,n);e.push(ea(r,1,a))}}function O2e(e){const t=[0];return k2e(t,e.length-1),t}function R2e(e,t){return e.map(r=>r*t)}function M2e(e,t){return e.map(()=>t||ere).splice(0,e.length-1)}function ZS({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const a=WTe(n)?n.map(FW):FW(n),d={done:!1,value:t[0]},p=R2e(r&&r.length===t.length?r:O2e(t),e),s=I2e(p,t,{ease:Array.isArray(a)?a:M2e(t,a)});return{calculatedDuration:e,next:_=>(d.value=s(_),d.done=_>=e,d)}}const D2e=e=>e!==null;function H4(e,{repeat:t,repeatType:r="loop"},n,a=1){const d=e.filter(D2e),s=a<0||t&&r!=="loop"&&t%2===1?0:d.length-1;return!s||n===void 0?d[s]:n}const L2e={decay:H3,inertia:H3,tween:ZS,keyframes:ZS,spring:GP};function pre(e){typeof e.type=="string"&&(e.type=L2e[e.type])}class Z4{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const F2e=e=>e/100;class X4 extends Z4{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,a;const{motionValue:r}=this.options;r&&r.updatedAt!==Rl.now()&&this.tick(Rl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(n=this.options).onStop)==null||a.call(n))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;pre(t);const{type:r=ZS,repeat:n=0,repeatDelay:a=0,repeatType:d,velocity:p=0}=t;let{keyframes:s}=t;const _=r||ZS;_!==ZS&&typeof s[0]!="number"&&(this.mixKeyframes=Z2(F2e,dre(s[0],s[1])),s=[0,100]);const b=_({...t,keyframes:s});d==="mirror"&&(this.mirroredGenerator=_({...t,keyframes:[...s].reverse(),velocity:-p})),b.calculatedDuration===null&&(b.calculatedDuration=W4(b));const{calculatedDuration:T}=b;this.calculatedDuration=T,this.resolvedDuration=T+a,this.totalDuration=this.resolvedDuration*(n+1)-a,this.generator=b}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:a,mixKeyframes:d,mirroredGenerator:p,resolvedDuration:s,calculatedDuration:_}=this;if(this.startTime===null)return n.next(0);const{delay:b=0,keyframes:T,repeat:C,repeatType:P,repeatDelay:k,type:B,onUpdate:R,finalKeyframe:D}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const G=this.currentTime-b*(this.playbackSpeed>=0?1:-1),V=this.playbackSpeed>=0?G<0:G>a;this.currentTime=Math.max(G,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let $=this.currentTime,K=n;if(C){const ie=Math.min(this.currentTime,a)/s;let ge=Math.floor(ie),fe=ie%1;!fe&&ie>=1&&(fe=1),fe===1&&ge--,ge=Math.min(ge,C+1),!!(ge%2)&&(P==="reverse"?(fe=1-fe,k&&(fe-=k/s)):P==="mirror"&&(K=p)),$=Ch(0,1,fe)*s}const Y=V?{done:!1,value:T[0]}:K.next($);d&&(Y.value=d(Y.value));let{done:ee}=Y;!V&&_!==null&&(ee=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const ae=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ee);return ae&&B!==H3&&(Y.value=H4(T,this.options,D,this.speed)),R&&R(Y.value),ae&&this.finish(),Y}then(t,r){return this.finished.then(t,r)}get duration(){return _u(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+_u(t)}get time(){return _u(this.currentTime)}set time(t){var r;t=Ef(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(Rl.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=_u(this.currentTime))}play(){var a,d;if(this.isStopped)return;const{driver:t=b2e,startTime:r}=this.options;this.driver||(this.driver=t(p=>this.tick(p))),(d=(a=this.options).onPlay)==null||d.call(a);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Rl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(t=this.options).onComplete)==null||r.call(t)}cancel(){var t,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(t=this.options).onCancel)==null||r.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),t.observe(this)}}function z2e(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Cy=e=>e*180/Math.PI,Z3=e=>{const t=Cy(Math.atan2(e[1],e[0]));return X3(t)},B2e={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Z3,rotateZ:Z3,skewX:e=>Cy(Math.atan(e[1])),skewY:e=>Cy(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},X3=e=>(e=e%360,e<0&&(e+=360),e),GW=Z3,WW=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),HW=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),$2e={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:WW,scaleY:HW,scale:e=>(WW(e)+HW(e))/2,rotateX:e=>X3(Cy(Math.atan2(e[6],e[5]))),rotateY:e=>X3(Cy(Math.atan2(-e[2],e[0]))),rotateZ:GW,rotate:GW,skewX:e=>Cy(Math.atan(e[4])),skewY:e=>Cy(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function K3(e){return e.includes("scale")?1:0}function Y3(e,t){if(!e||e==="none")return K3(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,a;if(r)n=$2e,a=r;else{const s=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=B2e,a=s}if(!a)return K3(t);const d=n[t],p=a[1].split(",").map(U2e);return typeof d=="function"?d(p):p[d]}const V2e=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return Y3(r,t)};function U2e(e){return parseFloat(e.trim())}const xb=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],bb=new Set(xb),ZW=e=>e===_b||e===Xr,q2e=new Set(["x","y","z"]),G2e=xb.filter(e=>!q2e.has(e));function W2e(e){const t=[];return G2e.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const hm={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Y3(t,"x"),y:(e,{transform:t})=>Y3(t,"y")};hm.translateX=hm.x;hm.translateY=hm.y;const Wy=new Set;let J3=!1,Q3=!1,eF=!1;function mre(){if(Q3){const e=Array.from(Wy).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const a=W2e(n);a.length&&(r.set(n,a),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const a=r.get(n);a&&a.forEach(([d,p])=>{var s;(s=n.getValue(d))==null||s.set(p)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Q3=!1,J3=!1,Wy.forEach(e=>e.complete(eF)),Wy.clear()}function gre(){Wy.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(Q3=!0)})}function H2e(){eF=!0,gre(),mre(),eF=!1}class K4{constructor(t,r,n,a,d,p=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=a,this.element=d,this.isAsync=p}scheduleResolve(){this.state="scheduled",this.isAsync?(Wy.add(this),J3||(J3=!0,zs.read(gre),zs.resolveKeyframes(mre))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:a}=this;if(t[0]===null){const d=a==null?void 0:a.get(),p=t[t.length-1];if(d!==void 0)t[0]=d;else if(n&&r){const s=n.readValue(r,p);s!=null&&(t[0]=s)}t[0]===void 0&&(t[0]=p),a&&d===void 0&&a.set(t[0])}z2e(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Wy.delete(this)}cancel(){this.state==="scheduled"&&(Wy.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Z2e=e=>e.startsWith("--");function X2e(e,t,r){Z2e(t)?e.style.setProperty(t,r):e.style[t]=r}const K2e=F4(()=>window.ScrollTimeline!==void 0),Y2e={};function J2e(e,t){const r=F4(e);return()=>Y2e[t]??r()}const yre=J2e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),SS=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,XW={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:SS([0,.65,.55,1]),circOut:SS([.55,0,1,.45]),backIn:SS([.31,.01,.66,-.59]),backOut:SS([.33,1.53,.69,.99])};function vre(e,t){if(e)return typeof e=="function"?yre()?hre(e,t):"ease-out":tre(e)?SS(e):Array.isArray(e)?e.map(r=>vre(r,t)||XW.easeOut):XW[e]}function Q2e(e,t,r,{delay:n=0,duration:a=300,repeat:d=0,repeatType:p="loop",ease:s="easeOut",times:_}={},b=void 0){const T={[t]:r};_&&(T.offset=_);const C=vre(s,a);Array.isArray(C)&&(T.easing=C);const P={delay:n,duration:a,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"};return b&&(P.pseudoElement=b),e.animate(T,P)}function _re(e){return typeof e=="function"&&"applyToOptions"in e}function eEe({type:e,...t}){return _re(e)&&yre()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class tEe extends Z4{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:r,name:n,keyframes:a,pseudoElement:d,allowFlatten:p=!1,finalKeyframe:s,onComplete:_}=t;this.isPseudoElement=!!d,this.allowFlatten=p,this.options=t,L4(typeof t.type!="string");const b=eEe(t);this.animation=Q2e(r,n,a,b,d),b.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!d){const T=H4(a,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(T):X2e(r,n,T),this.animation.cancel()}_==null||_(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,r;(r=(t=this.animation).finish)==null||r.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,r;this.isPseudoElement||(r=(t=this.animation).commitStyles)==null||r.call(t)}get duration(){var r,n;const t=((n=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:n.call(r).duration)||0;return _u(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+_u(t)}get time(){return _u(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Ef(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&K2e()?(this.animation.timeline=t,wu):r(this)}}const xre={anticipate:Yte,backInOut:Kte,circInOut:Qte};function rEe(e){return e in xre}function nEe(e){typeof e.ease=="string"&&rEe(e.ease)&&(e.ease=xre[e.ease])}const hD=10;class iEe extends tEe{constructor(t){nEe(t),pre(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:a,element:d,...p}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const s=new X4({...p,autoplay:!1}),_=Math.max(hD,Rl.now()-this.startTime),b=Ch(0,hD,_-hD);r.setWithVelocity(s.sample(Math.max(0,_-b)).value,s.sample(_).value,b),s.stop()}}const KW=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Mm.test(e)||e==="0")&&!e.startsWith("url("));function sEe(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function aEe(e,t,r,n){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const d=e[e.length-1],p=KW(a,t),s=KW(d,t);return!p||!s?!1:sEe(e)||(r==="spring"||_re(r))&&n}function tF(e){e.duration=0,e.type="keyframes"}const oEe=new Set(["opacity","clipPath","filter","transform"]),lEe=F4(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function cEe(e){var T;const{motionValue:t,name:r,repeatDelay:n,repeatType:a,damping:d,type:p}=e;if(!(((T=t==null?void 0:t.owner)==null?void 0:T.current)instanceof HTMLElement))return!1;const{onUpdate:_,transformTemplate:b}=t.owner.getProps();return lEe()&&r&&oEe.has(r)&&(r!=="transform"||!b)&&!_&&!n&&a!=="mirror"&&d!==0&&p!=="inertia"}const uEe=40;class dEe extends Z4{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:a=0,repeatDelay:d=0,repeatType:p="loop",keyframes:s,name:_,motionValue:b,element:T,...C}){var B;super(),this.stop=()=>{var R,D;this._animation&&(this._animation.stop(),(R=this.stopTimeline)==null||R.call(this)),(D=this.keyframeResolver)==null||D.cancel()},this.createdAt=Rl.now();const P={autoplay:t,delay:r,type:n,repeat:a,repeatDelay:d,repeatType:p,name:_,motionValue:b,element:T,...C},k=(T==null?void 0:T.KeyframeResolver)||K4;this.keyframeResolver=new k(s,(R,D,G)=>this.onKeyframesResolved(R,D,P,!G),_,b,T),(B=this.keyframeResolver)==null||B.scheduleResolve()}onKeyframesResolved(t,r,n,a){this.keyframeResolver=void 0;const{name:d,type:p,velocity:s,delay:_,isHandoff:b,onUpdate:T}=n;this.resolvedAt=Rl.now(),aEe(t,d,p,s)||((Lf.instantAnimations||!_)&&(T==null||T(H4(t,n,r))),t[0]=t[t.length-1],tF(n),n.repeat=0);const P={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>uEe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},k=!b&&cEe(P)?new iEe({...P,element:P.motionValue.owner.current}):new X4(P);k.finished.then(()=>this.notifyFinished()).catch(wu),this.pendingTimeline&&(this.stopTimeline=k.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=k}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),H2e()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}const hEe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fEe(e){const t=hEe.exec(e);if(!t)return[,];const[,r,n,a]=t;return[`--${r??n}`,a]}function bre(e,t,r=1){const[n,a]=fEe(e);if(!n)return;const d=window.getComputedStyle(t).getPropertyValue(n);if(d){const p=d.trim();return Vte(p)?parseFloat(p):p}return V4(a)?bre(a,t,r+1):a}function Y4(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}const pEe={type:"spring",stiffness:500,damping:25,restSpeed:10},mEe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),gEe={type:"keyframes",duration:.8},yEe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vEe=(e,{keyframes:t})=>t.length>2?gEe:bb.has(e)?e.startsWith("scale")?mEe(t[1]):pEe:yEe;function _Ee({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:a,repeat:d,repeatType:p,repeatDelay:s,from:_,elapsed:b,...T}){return!!Object.keys(T).length}const xEe=e=>e!==null;function bEe(e,{repeat:t,repeatType:r="loop"},n){const a=e.filter(xEe),d=t&&r!=="loop"&&t%2===1?0:a.length-1;return a[d]}function wre(e,t,r,n=0,a=1){const d=Array.from(e).sort((b,T)=>b.sortNodePosition(T)).indexOf(t),p=e.size,s=(p-1)*n;return typeof r=="function"?r(d,p):a===1?d*n:s-d*n}const J4=(e,t,r,n={},a,d)=>p=>{const s=Y4(n,e)||{},_=s.delay||n.delay||0;let{elapsed:b=0}=n;b=b-Ef(_);const T={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...s,delay:-b,onUpdate:P=>{t.set(P),s.onUpdate&&s.onUpdate(P)},onComplete:()=>{p(),s.onComplete&&s.onComplete()},name:e,motionValue:t,element:d?void 0:a};_Ee(s)||Object.assign(T,vEe(e,T)),T.duration&&(T.duration=Ef(T.duration)),T.repeatDelay&&(T.repeatDelay=Ef(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let C=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(tF(T),T.delay===0&&(C=!0)),(Lf.instantAnimations||Lf.skipAnimations)&&(C=!0,tF(T),T.delay=0),T.allowFlatten=!s.type&&!s.ease,C&&!d&&t.get()!==void 0){const P=bEe(T.keyframes,s);if(P!==void 0){zs.update(()=>{T.onUpdate(P),T.onComplete()});return}}return s.isSync?new X4(T):new dEe(T)},Sre=new Set(["width","height","top","left","right","bottom",...xb]),YW=30,wEe=e=>!isNaN(parseFloat(e));class SEe{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var d;const a=Rl.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((d=this.events.change)==null||d.notify(this.current),this.dependents))for(const p of this.dependents)p.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=Rl.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=wEe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new z4);const n=this.events[t].add(r);return t==="change"?()=>{n(),zs.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Rl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>YW)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,YW);return Gte(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,r;(t=this.dependents)==null||t.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function P0(e,t){return new SEe(e,t)}function JW(e){const t=[{},{}];return e==null||e.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function Q4(e,t,r,n){if(typeof t=="function"){const[a,d]=JW(n);t=t(r!==void 0?r:e.custom,a,d)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,d]=JW(n);t=t(r!==void 0?r:e.custom,a,d)}return t}function Xx(e,t,r){const n=e.getProps();return Q4(n,t,r!==void 0?r:n.custom,e)}const rF=e=>Array.isArray(e);function TEe(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,P0(r))}function EEe(e){return rF(e)?e[e.length-1]||0:e}function jEe(e,t){const r=Xx(e,t);let{transitionEnd:n={},transition:a={},...d}=r||{};d={...d,...n};for(const p in d){const s=EEe(d[p]);TEe(e,p,s)}}const ol=e=>!!(e&&e.getVelocity);function AEe(e){return!!(ol(e)&&e.add)}function nF(e,t){const r=e.getValue("willChange");if(AEe(r))return r.add(t);if(!r&&Lf.WillChange){const n=new Lf.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function e5(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const CEe="framerAppearId",Tre="data-"+e5(CEe);function Ere(e){return e.props[Tre]}function PEe({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function jre(e,t,{delay:r=0,transitionOverride:n,type:a}={}){let{transition:d=e.getDefaultTransition(),transitionEnd:p,...s}=t;n&&(d=n);const _=[],b=a&&e.animationState&&e.animationState.getState()[a];for(const T in s){const C=e.getValue(T,e.latestValues[T]??null),P=s[T];if(P===void 0||b&&PEe(b,T))continue;const k={delay:r,...Y4(d||{},T)},B=C.get();if(B!==void 0&&!C.isAnimating&&!Array.isArray(P)&&P===B&&!k.velocity)continue;let R=!1;if(window.MotionHandoffAnimation){const G=Ere(e);if(G){const V=window.MotionHandoffAnimation(G,T,zs);V!==null&&(k.startTime=V,R=!0)}}nF(e,T),C.start(J4(T,C,P,e.shouldReduceMotion&&Sre.has(T)?{type:!1}:k,e,R));const D=C.animation;D&&_.push(D)}return p&&Promise.all(_).then(()=>{zs.update(()=>{p&&jEe(e,p)})}),_}function iF(e,t,r={}){var _;const n=Xx(e,t,r.type==="exit"?(_=e.presenceContext)==null?void 0:_.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(a=r.transitionOverride);const d=n?()=>Promise.all(jre(e,n,r)):()=>Promise.resolve(),p=e.variantChildren&&e.variantChildren.size?(b=0)=>{const{delayChildren:T=0,staggerChildren:C,staggerDirection:P}=a;return NEe(e,t,b,T,C,P,r)}:()=>Promise.resolve(),{when:s}=a;if(s){const[b,T]=s==="beforeChildren"?[d,p]:[p,d];return b().then(()=>T())}else return Promise.all([d(),p(r.delay)])}function NEe(e,t,r=0,n=0,a=0,d=1,p){const s=[];for(const _ of e.variantChildren)_.notify("AnimationStart",t),s.push(iF(_,t,{...p,delay:r+(typeof n=="function"?0:n)+wre(e.variantChildren,_,n,a,d)}).then(()=>_.notify("AnimationComplete",t)));return Promise.all(s)}function IEe(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const a=t.map(d=>iF(e,d,r));n=Promise.all(a)}else if(typeof t=="string")n=iF(e,t,r);else{const a=typeof t=="function"?Xx(e,t,r.custom):t;n=Promise.all(jre(e,a,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}const kEe={test:e=>e==="auto",parse:e=>e},Are=e=>t=>t.test(e),Cre=[_b,Xr,wh,Up,s2e,i2e,kEe],QW=e=>Cre.find(Are(e));function OEe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||qte(e):!0}const REe=new Set(["brightness","contrast","saturate","opacity"]);function MEe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(U4)||[];if(!n)return e;const a=r.replace(n,"");let d=REe.has(t)?1:0;return n!==r&&(d*=100),t+"("+d+a+")"}const DEe=/\b([a-z-]*)\(.*?\)/gu,sF={...Mm,getAnimatableNone:e=>{const t=e.match(DEe);return t?t.map(MEe).join(" "):e}},e9={..._b,transform:Math.round},LEe={rotate:Up,rotateX:Up,rotateY:Up,rotateZ:Up,scale:mC,scaleX:mC,scaleY:mC,scaleZ:mC,skew:Up,skewX:Up,skewY:Up,distance:Xr,translateX:Xr,translateY:Xr,translateZ:Xr,x:Xr,y:Xr,z:Xr,perspective:Xr,transformPerspective:Xr,opacity:FT,originX:BW,originY:BW,originZ:Xr},t5={borderWidth:Xr,borderTopWidth:Xr,borderRightWidth:Xr,borderBottomWidth:Xr,borderLeftWidth:Xr,borderRadius:Xr,radius:Xr,borderTopLeftRadius:Xr,borderTopRightRadius:Xr,borderBottomRightRadius:Xr,borderBottomLeftRadius:Xr,width:Xr,maxWidth:Xr,height:Xr,maxHeight:Xr,top:Xr,right:Xr,bottom:Xr,left:Xr,inset:Xr,insetBlock:Xr,insetBlockStart:Xr,insetBlockEnd:Xr,insetInline:Xr,insetInlineStart:Xr,insetInlineEnd:Xr,padding:Xr,paddingTop:Xr,paddingRight:Xr,paddingBottom:Xr,paddingLeft:Xr,paddingBlock:Xr,paddingBlockStart:Xr,paddingBlockEnd:Xr,paddingInline:Xr,paddingInlineStart:Xr,paddingInlineEnd:Xr,margin:Xr,marginTop:Xr,marginRight:Xr,marginBottom:Xr,marginLeft:Xr,marginBlock:Xr,marginBlockStart:Xr,marginBlockEnd:Xr,marginInline:Xr,marginInlineStart:Xr,marginInlineEnd:Xr,backgroundPositionX:Xr,backgroundPositionY:Xr,...LEe,zIndex:e9,fillOpacity:FT,strokeOpacity:FT,numOctaves:e9},FEe={...t5,color:ka,backgroundColor:ka,outlineColor:ka,fill:ka,stroke:ka,borderColor:ka,borderTopColor:ka,borderRightColor:ka,borderBottomColor:ka,borderLeftColor:ka,filter:sF,WebkitFilter:sF},Pre=e=>FEe[e];function Nre(e,t){let r=Pre(e);return r!==sF&&(r=Mm),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const zEe=new Set(["auto","none","0"]);function BEe(e,t,r){let n=0,a;for(;n<e.length&&!a;){const d=e[n];typeof d=="string"&&!zEe.has(d)&&zT(d).values.length&&(a=e[n]),n++}if(a&&r)for(const d of t)e[d]=Nre(r,a)}class $Ee extends K4{constructor(t,r,n,a,d){super(t,r,n,a,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let T=0;T<t.length;T++){let C=t[T];if(typeof C=="string"&&(C=C.trim(),V4(C))){const P=bre(C,r.current);P!==void 0&&(t[T]=P),T===t.length-1&&(this.finalKeyframe=C)}}if(this.resolveNoneKeyframes(),!Sre.has(n)||t.length!==2)return;const[a,d]=t,p=QW(a),s=QW(d),_=zW(a),b=zW(d);if(_!==b&&hm[n]){this.needsMeasurement=!0;return}if(p!==s)if(ZW(p)&&ZW(s))for(let T=0;T<t.length;T++){const C=t[T];typeof C=="string"&&(t[T]=parseFloat(C))}else hm[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let a=0;a<t.length;a++)(t[a]===null||OEe(t[a]))&&n.push(a);n.length&&BEe(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=hm[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const a=r[r.length-1];a!==void 0&&t.getValue(n,a).jump(a,!1)}measureEndState(){var s;const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const a=t.getValue(r);a&&a.jump(this.measuredOrigin,!1);const d=n.length-1,p=n[d];n[d]=hm[r](t.measureViewportBox(),window.getComputedStyle(t.current)),p!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=p),(s=this.removedTransforms)!=null&&s.length&&this.removedTransforms.forEach(([_,b])=>{t.getValue(_).set(b)}),this.resolveNoneKeyframes()}}function VEe(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let n=document;const a=(r==null?void 0:r[e])??n.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}const Ire=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function kre(e){return Ute(e)&&"offsetHeight"in e}const{schedule:r5}=rre(queueMicrotask,!1),Qu={x:!1,y:!1};function Ore(){return Qu.x||Qu.y}function UEe(e){return e==="x"||e==="y"?Qu[e]?null:(Qu[e]=!0,()=>{Qu[e]=!1}):Qu.x||Qu.y?null:(Qu.x=Qu.y=!0,()=>{Qu.x=Qu.y=!1})}function Rre(e,t){const r=VEe(e),n=new AbortController,a={passive:!0,...t,signal:n.signal};return[r,a,()=>n.abort()]}function t9(e){return!(e.pointerType==="touch"||Ore())}function qEe(e,t,r={}){const[n,a,d]=Rre(e,r),p=s=>{if(!t9(s))return;const{target:_}=s,b=t(_,s);if(typeof b!="function"||!_)return;const T=C=>{t9(C)&&(b(C),_.removeEventListener("pointerleave",T))};_.addEventListener("pointerleave",T,a)};return n.forEach(s=>{s.addEventListener("pointerenter",p,a)}),d}const Mre=(e,t)=>t?e===t?!0:Mre(e,t.parentElement):!1,n5=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,GEe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Dre(e){return GEe.has(e.tagName)||e.isContentEditable===!0}const eP=new WeakSet;function r9(e){return t=>{t.key==="Enter"&&e(t)}}function fD(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const WEe=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=r9(()=>{if(eP.has(r))return;fD(r,"down");const a=r9(()=>{fD(r,"up")}),d=()=>fD(r,"cancel");r.addEventListener("keyup",a,t),r.addEventListener("blur",d,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function n9(e){return n5(e)&&!Ore()}function HEe(e,t,r={}){const[n,a,d]=Rre(e,r),p=s=>{const _=s.currentTarget;if(!n9(s))return;eP.add(_);const b=t(_,s),T=(k,B)=>{window.removeEventListener("pointerup",C),window.removeEventListener("pointercancel",P),eP.has(_)&&eP.delete(_),n9(k)&&typeof b=="function"&&b(k,{success:B})},C=k=>{T(k,_===window||_===document||r.useGlobalTarget||Mre(_,k.target))},P=k=>{T(k,!1)};window.addEventListener("pointerup",C,a),window.addEventListener("pointercancel",P,a)};return n.forEach(s=>{(r.useGlobalTarget?window:s).addEventListener("pointerdown",p,a),kre(s)&&(s.addEventListener("focus",b=>WEe(b,a)),!Dre(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),d}function Lre(e){return Ute(e)&&"ownerSVGElement"in e}function ZEe(e){return Lre(e)&&e.tagName==="svg"}const XEe=[...Cre,ka,Mm],KEe=e=>XEe.find(Are(e)),i9=()=>({translate:0,scale:1,origin:0,originPoint:0}),kx=()=>({x:i9(),y:i9()}),s9=()=>({min:0,max:0}),Ya=()=>({x:s9(),y:s9()}),aF={current:null},Fre={current:!1},YEe=typeof window<"u";function JEe(){if(Fre.current=!0,!!YEe)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>aF.current=e.matches;e.addEventListener("change",t),t()}else aF.current=!1}const QEe=new WeakMap;function KI(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function BT(e){return typeof e=="string"||Array.isArray(e)}const i5=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],s5=["initial",...i5];function YI(e){return KI(e.animate)||s5.some(t=>BT(e[t]))}function zre(e){return!!(YI(e)||e.variants)}function eje(e,t,r){for(const n in t){const a=t[n],d=r[n];if(ol(a))e.addValue(n,a);else if(ol(d))e.addValue(n,P0(a,{owner:e}));else if(d!==a)if(e.hasValue(n)){const p=e.getValue(n);p.liveStyle===!0?p.jump(a):p.hasAnimated||p.set(a)}else{const p=e.getStaticValue(n);e.addValue(n,P0(p!==void 0?p:a,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const a9=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let WP={};function Bre(e){WP=e}function tje(){return WP}class rje{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:a,blockInitialAnimation:d,visualState:p},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=K4,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const P=Rl.now();this.renderScheduledAt<P&&(this.renderScheduledAt=P,zs.render(this.render,!1,!0))};const{latestValues:_,renderState:b}=p;this.latestValues=_,this.baseTarget={..._},this.initialValues=r.initial?{..._}:{},this.renderState=b,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=s,this.blockInitialAnimation=!!d,this.isControllingVariants=YI(r),this.isVariantNode=zre(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:T,...C}=this.scrapeMotionValuesFromProps(r,{},this);for(const P in C){const k=C[P];_[P]!==void 0&&ol(k)&&k.set(_[P])}}mount(t){var r;this.current=t,QEe.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,a)=>this.bindToMotionValue(a,n)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(Fre.current||JEe(),this.shouldReduceMotion=aF.current),(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var t;this.projection&&this.projection.unmount(),Rm(this.notifyUpdate),Rm(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const n=this.features[r];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=bb.has(t);n&&this.onBindTransform&&this.onBindTransform();const a=r.on("change",p=>{this.latestValues[t]=p,this.props.onUpdate&&zs.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let d;typeof window<"u"&&window.MotionCheckAppearSync&&(d=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{a(),d&&d(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in WP){const r=WP[t];if(!r)continue;const{isEnabled:n,Feature:a}=r;if(!this.features[t]&&a&&n(this.props)&&(this.features[t]=new a(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ya()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<a9.length;n++){const a=a9[n];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const d="on"+a,p=t[d];p&&(this.propEventSubscriptions[a]=this.on(a,p))}this.prevMotionValues=eje(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=P0(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(Vte(n)||qte(n))?n=parseFloat(n):!KEe(n)&&Mm.test(r)&&(n=Nre(t,r)),this.setBaseTarget(t,ol(n)?n.get():n)),ol(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var d;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const p=Q4(this.props,r,(d=this.presenceContext)==null?void 0:d.custom);p&&(n=p[t])}if(r&&n!==void 0)return n;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!ol(a)?a:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new z4),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){r5.render(this.render)}}class Hm{constructor(t){this.isMounted=!1,this.node=t}update(){}}class $re extends rje{constructor(){super(...arguments),this.KeyframeResolver=$Ee}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){const n=t.style;return n?n[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ol(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function Vre({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function nje({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function ije(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function pD(e){return e===void 0||e===1}function oF({scale:e,scaleX:t,scaleY:r}){return!pD(e)||!pD(t)||!pD(r)}function fy(e){return oF(e)||Ure(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Ure(e){return o9(e.x)||o9(e.y)}function o9(e){return e&&e!=="0%"}function HP(e,t,r){const n=e-r,a=t*n;return r+a}function l9(e,t,r,n,a){return a!==void 0&&(e=HP(e,a,n)),HP(e,r,n)+t}function lF(e,t=0,r=1,n,a){e.min=l9(e.min,t,r,n,a),e.max=l9(e.max,t,r,n,a)}function qre(e,{x:t,y:r}){lF(e.x,t.translate,t.scale,t.originPoint),lF(e.y,r.translate,r.scale,r.originPoint)}const c9=.999999999999,u9=1.0000000000001;function sje(e,t,r,n=!1){const a=r.length;if(!a)return;t.x=t.y=1;let d,p;for(let s=0;s<a;s++){d=r[s],p=d.projectionDelta;const{visualElement:_}=d.options;_&&_.props.style&&_.props.style.display==="contents"||(n&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Rx(e,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,qre(e,p)),n&&fy(d.latestValues)&&Rx(e,d.latestValues))}t.x<u9&&t.x>c9&&(t.x=1),t.y<u9&&t.y>c9&&(t.y=1)}function Ox(e,t){e.min=e.min+t,e.max=e.max+t}function d9(e,t,r,n,a=.5){const d=ea(e.min,e.max,a);lF(e,t,r,d,n)}function Rx(e,t){d9(e.x,t.x,t.scaleX,t.scale,t.originX),d9(e.y,t.y,t.scaleY,t.scale,t.originY)}function Gre(e,t){return Vre(ije(e.getBoundingClientRect(),t))}function aje(e,t,r){const n=Gre(e,r),{scroll:a}=t;return a&&(Ox(n.x,a.offset.x),Ox(n.y,a.offset.y)),n}const oje={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},lje=xb.length;function cje(e,t,r){let n="",a=!0;for(let d=0;d<lje;d++){const p=xb[d],s=e[p];if(s===void 0)continue;let _=!0;if(typeof s=="number"?_=s===(p.startsWith("scale")?1:0):_=parseFloat(s)===0,!_||r){const b=Ire(s,t5[p]);if(!_){a=!1;const T=oje[p]||p;n+=`${T}(${b}) `}r&&(t[p]=b)}}return n=n.trim(),r?n=r(t,a?"":n):a&&(n="none"),n}function a5(e,t,r){const{style:n,vars:a,transformOrigin:d}=e;let p=!1,s=!1;for(const _ in t){const b=t[_];if(bb.has(_)){p=!0;continue}else if(ire(_)){a[_]=b;continue}else{const T=Ire(b,t5[_]);_.startsWith("origin")?(s=!0,d[_]=T):n[_]=T}}if(t.transform||(p||r?n.transform=cje(t,e.transform,r):n.transform&&(n.transform="none")),s){const{originX:_="50%",originY:b="50%",originZ:T=0}=d;n.transformOrigin=`${_} ${b} ${T}`}}function Wre(e,{style:t,vars:r},n,a){const d=e.style;let p;for(p in t)d[p]=t[p];a==null||a.applyProjectionStyles(d,n);for(p in r)d.setProperty(p,r[p])}function h9(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const nS={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Xr.test(e))e=parseFloat(e);else return e;const r=h9(e,t.target.x),n=h9(e,t.target.y);return`${r}% ${n}%`}},uje={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,a=Mm.parse(e);if(a.length>5)return n;const d=Mm.createTransformer(e),p=typeof a[0]!="number"?1:0,s=r.x.scale*t.x,_=r.y.scale*t.y;a[0+p]/=s,a[1+p]/=_;const b=ea(s,_,.5);return typeof a[2+p]=="number"&&(a[2+p]/=b),typeof a[3+p]=="number"&&(a[3+p]/=b),d(a)}},cF={borderRadius:{...nS,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:nS,borderTopRightRadius:nS,borderBottomLeftRadius:nS,borderBottomRightRadius:nS,boxShadow:uje};function Hre(e,{layout:t,layoutId:r}){return bb.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!cF[e]||e==="opacity")}function o5(e,t,r){var p;const n=e.style,a=t==null?void 0:t.style,d={};if(!n)return d;for(const s in n)(ol(n[s])||a&&ol(a[s])||Hre(s,e)||((p=r==null?void 0:r.getValue(s))==null?void 0:p.liveStyle)!==void 0)&&(d[s]=n[s]);return d}function dje(e){return window.getComputedStyle(e)}class hje extends $re{constructor(){super(...arguments),this.type="html",this.renderInstance=Wre}readValueFromInstance(t,r){var n;if(bb.has(r))return(n=this.projection)!=null&&n.isProjecting?K3(r):V2e(t,r);{const a=dje(t),d=(ire(r)?a.getPropertyValue(r):a[r])||0;return typeof d=="string"?d.trim():d}}measureInstanceViewportBox(t,{transformPagePoint:r}){return Gre(t,r)}build(t,r,n){a5(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return o5(t,r,n)}}const fje={offset:"stroke-dashoffset",array:"stroke-dasharray"},pje={offset:"strokeDashoffset",array:"strokeDasharray"};function mje(e,t,r=1,n=0,a=!0){e.pathLength=1;const d=a?fje:pje;e[d.offset]=Xr.transform(-n);const p=Xr.transform(t),s=Xr.transform(r);e[d.array]=`${p} ${s}`}const gje=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function Zre(e,{attrX:t,attrY:r,attrScale:n,pathLength:a,pathSpacing:d=1,pathOffset:p=0,...s},_,b,T){if(a5(e,s,b),_){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:C,style:P}=e;C.transform&&(P.transform=C.transform,delete C.transform),(P.transform||C.transformOrigin)&&(P.transformOrigin=C.transformOrigin??"50% 50%",delete C.transformOrigin),P.transform&&(P.transformBox=(T==null?void 0:T.transformBox)??"fill-box",delete C.transformBox);for(const k of gje)C[k]!==void 0&&(P[k]=C[k],delete C[k]);t!==void 0&&(C.x=t),r!==void 0&&(C.y=r),n!==void 0&&(C.scale=n),a!==void 0&&mje(C,a,d,p,!1)}const Xre=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),Kre=e=>typeof e=="string"&&e.toLowerCase()==="svg";function yje(e,t,r,n){Wre(e,t,void 0,n);for(const a in t.attrs)e.setAttribute(Xre.has(a)?a:e5(a),t.attrs[a])}function Yre(e,t,r){const n=o5(e,t,r);for(const a in e)if(ol(e[a])||ol(t[a])){const d=xb.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;n[d]=e[a]}return n}class vje extends $re{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ya}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(bb.has(r)){const n=Pre(r);return n&&n.default||0}return r=Xre.has(r)?r:e5(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return Yre(t,r,n)}build(t,r,n){Zre(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,a){yje(t,r,n,a)}mount(t){this.isSVGTag=Kre(t.tagName),super.mount(t)}}const _je=s5.length;function Jre(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?Jre(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<_je;r++){const n=s5[r],a=e.props[n];(BT(a)||a===!1)&&(t[n]=a)}return t}function Qre(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const xje=[...i5].reverse(),bje=i5.length;function wje(e){return t=>Promise.all(t.map(({animation:r,options:n})=>IEe(e,r,n)))}function Sje(e){let t=wje(e),r=f9(),n=!0;const a=_=>(b,T)=>{var P;const C=Xx(e,T,_==="exit"?(P=e.presenceContext)==null?void 0:P.custom:void 0);if(C){const{transition:k,transitionEnd:B,...R}=C;b={...b,...R,...B}}return b};function d(_){t=_(e)}function p(_){const{props:b}=e,T=Jre(e.parent)||{},C=[],P=new Set;let k={},B=1/0;for(let D=0;D<bje;D++){const G=xje[D],V=r[G],$=b[G]!==void 0?b[G]:T[G],K=BT($),Y=G===_?V.isActive:null;Y===!1&&(B=D);let ee=$===T[G]&&$!==b[G]&&K;if(ee&&n&&e.manuallyAnimateOnMount&&(ee=!1),V.protectedKeys={...k},!V.isActive&&Y===null||!$&&!V.prevProp||KI($)||typeof $=="boolean")continue;const ae=Tje(V.prevProp,$);let ie=ae||G===_&&V.isActive&&!ee&&K||D>B&&K,ge=!1;const fe=Array.isArray($)?$:[$];let be=fe.reduce(a(G),{});Y===!1&&(be={});const{prevResolvedValues:ue={}}=V,Ce={...ue,...be},ve=Be=>{ie=!0,P.has(Be)&&(ge=!0,P.delete(Be)),V.needsAnimating[Be]=!0;const Ve=e.getValue(Be);Ve&&(Ve.liveStyle=!1)};for(const Be in Ce){const Ve=be[Be],We=ue[Be];if(k.hasOwnProperty(Be))continue;let Ee=!1;rF(Ve)&&rF(We)?Ee=!Qre(Ve,We):Ee=Ve!==We,Ee?Ve!=null?ve(Be):P.add(Be):Ve!==void 0&&P.has(Be)?ve(Be):V.protectedKeys[Be]=!0}V.prevProp=$,V.prevResolvedValues=be,V.isActive&&(k={...k,...be}),n&&e.blockInitialAnimation&&(ie=!1);const ze=ee&&ae;ie&&(!ze||ge)&&C.push(...fe.map(Be=>{const Ve={type:G};if(typeof Be=="string"&&n&&!ze&&e.manuallyAnimateOnMount&&e.parent){const{parent:We}=e,Ee=Xx(We,Be);if(We.enteringChildren&&Ee){const{delayChildren:ot}=Ee.transition||{};Ve.delay=wre(We.enteringChildren,e,ot)}}return{animation:Be,options:Ve}}))}if(P.size){const D={};if(typeof b.initial!="boolean"){const G=Xx(e,Array.isArray(b.initial)?b.initial[0]:b.initial);G&&G.transition&&(D.transition=G.transition)}P.forEach(G=>{const V=e.getBaseTarget(G),$=e.getValue(G);$&&($.liveStyle=!0),D[G]=V??null}),C.push({animation:D})}let R=!!C.length;return n&&(b.initial===!1||b.initial===b.animate)&&!e.manuallyAnimateOnMount&&(R=!1),n=!1,R?t(C):Promise.resolve()}function s(_,b){var C;if(r[_].isActive===b)return Promise.resolve();(C=e.variantChildren)==null||C.forEach(P=>{var k;return(k=P.animationState)==null?void 0:k.setActive(_,b)}),r[_].isActive=b;const T=p(_);for(const P in r)r[P].protectedKeys={};return T}return{animateChanges:p,setActive:s,setAnimateFunction:d,getState:()=>r,reset:()=>{r=f9()}}}function Tje(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Qre(t,e):!1}function ay(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function f9(){return{animate:ay(!0),whileInView:ay(),whileHover:ay(),whileTap:ay(),whileDrag:ay(),whileFocus:ay(),exit:ay()}}const ene=1e-4,Eje=1-ene,jje=1+ene,tne=.01,Aje=0-tne,Cje=0+tne;function Ml(e){return e.max-e.min}function Pje(e,t,r){return Math.abs(e-t)<=r}function p9(e,t,r,n=.5){e.origin=n,e.originPoint=ea(t.min,t.max,e.origin),e.scale=Ml(r)/Ml(t),e.translate=ea(r.min,r.max,e.origin)-e.originPoint,(e.scale>=Eje&&e.scale<=jje||isNaN(e.scale))&&(e.scale=1),(e.translate>=Aje&&e.translate<=Cje||isNaN(e.translate))&&(e.translate=0)}function XS(e,t,r,n){p9(e.x,t.x,r.x,n?n.originX:void 0),p9(e.y,t.y,r.y,n?n.originY:void 0)}function m9(e,t,r){e.min=r.min+t.min,e.max=e.min+Ml(t)}function Nje(e,t,r){m9(e.x,t.x,r.x),m9(e.y,t.y,r.y)}function g9(e,t,r){e.min=t.min-r.min,e.max=e.min+Ml(t)}function ZP(e,t,r){g9(e.x,t.x,r.x),g9(e.y,t.y,r.y)}function y9(e,t,r,n,a){return e-=t,e=HP(e,1/r,n),a!==void 0&&(e=HP(e,1/a,n)),e}function Ije(e,t=0,r=1,n=.5,a,d=e,p=e){if(wh.test(t)&&(t=parseFloat(t),t=ea(p.min,p.max,t/100)-p.min),typeof t!="number")return;let s=ea(d.min,d.max,n);e===d&&(s-=t),e.min=y9(e.min,t,r,s,a),e.max=y9(e.max,t,r,s,a)}function v9(e,t,[r,n,a],d,p){Ije(e,t[r],t[n],t[a],t.scale,d,p)}const kje=["x","scaleX","originX"],Oje=["y","scaleY","originY"];function _9(e,t,r,n){v9(e.x,t,kje,r?r.x:void 0,n?n.x:void 0),v9(e.y,t,Oje,r?r.y:void 0,n?n.y:void 0)}function x9(e,t){e.min=t.min,e.max=t.max}function Ku(e,t){x9(e.x,t.x),x9(e.y,t.y)}function b9(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function w9(e){return e.translate===0&&e.scale===1}function rne(e){return w9(e.x)&&w9(e.y)}function S9(e,t){return e.min===t.min&&e.max===t.max}function Rje(e,t){return S9(e.x,t.x)&&S9(e.y,t.y)}function T9(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function nne(e,t){return T9(e.x,t.x)&&T9(e.y,t.y)}function E9(e){return Ml(e.x)/Ml(e.y)}function j9(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function hu(e){return[e("x"),e("y")]}function Mje(e,t,r){let n="";const a=e.x.translate/t.x,d=e.y.translate/t.y,p=(r==null?void 0:r.z)||0;if((a||d||p)&&(n=`translate3d(${a}px, ${d}px, ${p}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:b,rotate:T,rotateX:C,rotateY:P,skewX:k,skewY:B}=r;b&&(n=`perspective(${b}px) ${n}`),T&&(n+=`rotate(${T}deg) `),C&&(n+=`rotateX(${C}deg) `),P&&(n+=`rotateY(${P}deg) `),k&&(n+=`skewX(${k}deg) `),B&&(n+=`skewY(${B}deg) `)}const s=e.x.scale*t.x,_=e.y.scale*t.y;return(s!==1||_!==1)&&(n+=`scale(${s}, ${_})`),n||"none"}const ine=["TopLeft","TopRight","BottomLeft","BottomRight"],Dje=ine.length,A9=e=>typeof e=="string"?parseFloat(e):e,C9=e=>typeof e=="number"||Xr.test(e);function Lje(e,t,r,n,a,d){a?(e.opacity=ea(0,r.opacity??1,Fje(n)),e.opacityExit=ea(t.opacity??1,0,zje(n))):d&&(e.opacity=ea(t.opacity??1,r.opacity??1,n));for(let p=0;p<Dje;p++){const s=`border${ine[p]}Radius`;let _=P9(t,s),b=P9(r,s);if(_===void 0&&b===void 0)continue;_||(_=0),b||(b=0),_===0||b===0||C9(_)===C9(b)?(e[s]=Math.max(ea(A9(_),A9(b),n),0),(wh.test(b)||wh.test(_))&&(e[s]+="%")):e[s]=b}(t.rotate||r.rotate)&&(e.rotate=ea(t.rotate||0,r.rotate||0,n))}function P9(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Fje=sne(0,.5,Jte),zje=sne(.5,.95,wu);function sne(e,t,r){return n=>n<e?0:n>t?1:r(LT(e,t,n))}function Bje(e,t){const r=Rl.now(),n=({timestamp:a})=>{const d=a-r;d>=t&&(Rm(n),e(d-t))};return zs.setup(n,!0),()=>Rm(n)}function $T(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function tP(e){return ol(e)?e.get():e}function $je(e,t,r){const n=ol(e)?e:P0(e);return n.start(J4("",n,t,r)),n.animation}const Vje=(e,t)=>e.depth-t.depth;class Uje{constructor(){this.children=[],this.isDirty=!1}add(t){M4(this.children,t),this.isDirty=!0}remove(t){D4(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Vje),this.isDirty=!1,this.children.forEach(t)}}class qje{constructor(){this.members=[]}add(t){M4(this.members,t),t.scheduleRender()}remove(t){if(D4(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(a=>t===a);if(r===0)return!1;let n;for(let a=r;a>=0;a--){const d=this.members[a];if(d.isPresent!==!1){n=d;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:a}=t.options;a===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const rP={hasAnimatedSinceResize:!0,hasEverUpdated:!1},mD=["","X","Y","Z"],Gje=1e3;let Wje=0;function gD(e,t,r,n){const{latestValues:a}=t;a[e]&&(r[e]=a[e],t.setStaticValue(e,0),n&&(n[e]=0))}function ane(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=Ere(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:a,layoutId:d}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",zs,!(a||d))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&ane(n)}function one({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:a}){return class{constructor(p={},s=t==null?void 0:t()){this.id=Wje++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Xje),this.nodes.forEach(Qje),this.nodes.forEach(eAe),this.nodes.forEach(Kje)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let _=0;_<this.path.length;_++)this.path[_].shouldResetTransform=!0;this.root===this&&(this.nodes=new Uje)}addEventListener(p,s){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new z4),this.eventHandlers.get(p).add(s)}notifyListeners(p,...s){const _=this.eventHandlers.get(p);_&&_.notify(...s)}hasListeners(p){return this.eventHandlers.has(p)}mount(p){if(this.instance)return;this.isSVG=Lre(p)&&!ZEe(p),this.instance=p;const{layoutId:s,layout:_,visualElement:b}=this.options;if(b&&!b.current&&b.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(_||s)&&(this.isLayoutDirty=!0),e){let T,C=0;const P=()=>this.root.updateBlockedByResize=!1;zs.read(()=>{C=window.innerWidth}),e(p,()=>{const k=window.innerWidth;k!==C&&(C=k,this.root.updateBlockedByResize=!0,T&&T(),T=Bje(P,250),rP.hasAnimatedSinceResize&&(rP.hasAnimatedSinceResize=!1,this.nodes.forEach(k9)))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&b&&(s||_)&&this.addEventListener("didUpdate",({delta:T,hasLayoutChanged:C,hasRelativeLayoutChanged:P,layout:k})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||b.getDefaultTransition()||sAe,{onLayoutAnimationStart:R,onLayoutAnimationComplete:D}=b.getProps(),G=!this.targetLayout||!nne(this.targetLayout,k),V=!C&&P;if(this.options.layoutRoot||this.resumeFrom||V||C&&(G||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const $={...Y4(B,"layout"),onPlay:R,onComplete:D};(b.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($),this.setAnimationOrigin(T,V)}else C||k9(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=k})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Rm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(tAe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&ane(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const C=this.path[T];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:s,layout:_}=this.options;if(s===void 0&&!_)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(N9);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(I9);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Jje),this.nodes.forEach(Hje),this.nodes.forEach(Zje)):this.nodes.forEach(I9),this.clearAllSnapshots();const s=Rl.now();Lo.delta=Ch(0,1e3/60,s-Lo.timestamp),Lo.timestamp=s,Lo.isProcessing=!0,oD.update.process(Lo),oD.preRender.process(Lo),oD.render.process(Lo),Lo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,r5.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Yje),this.sharedNodes.forEach(rAe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,zs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){zs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ml(this.snapshot.measuredBox.x)&&!Ml(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let _=0;_<this.path.length;_++)this.path[_].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ya(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(s=!1),s&&this.instance){const _=n(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:_,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:_}}}resetTransform(){if(!a)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!rne(this.projectionDelta),_=this.getTransformTemplate(),b=_?_(this.latestValues,""):void 0,T=b!==this.prevTransformTemplateValue;p&&this.instance&&(s||fy(this.latestValues)||T)&&(a(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const s=this.measurePageBox();let _=this.removeElementScroll(s);return p&&(_=this.removeTransform(_)),aAe(_),{animationId:this.root.animationId,measuredBox:s,layoutBox:_,latestValues:{},source:this.id}}measurePageBox(){var b;const{visualElement:p}=this.options;if(!p)return Ya();const s=p.measureViewportBox();if(!(((b=this.scroll)==null?void 0:b.wasRoot)||this.path.some(oAe))){const{scroll:T}=this.root;T&&(Ox(s.x,T.offset.x),Ox(s.y,T.offset.y))}return s}removeElementScroll(p){var _;const s=Ya();if(Ku(s,p),(_=this.scroll)!=null&&_.wasRoot)return s;for(let b=0;b<this.path.length;b++){const T=this.path[b],{scroll:C,options:P}=T;T!==this.root&&C&&P.layoutScroll&&(C.wasRoot&&Ku(s,p),Ox(s.x,C.offset.x),Ox(s.y,C.offset.y))}return s}applyTransform(p,s=!1){const _=Ya();Ku(_,p);for(let b=0;b<this.path.length;b++){const T=this.path[b];!s&&T.options.layoutScroll&&T.scroll&&T!==T.root&&Rx(_,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),fy(T.latestValues)&&Rx(_,T.latestValues)}return fy(this.latestValues)&&Rx(_,this.latestValues),_}removeTransform(p){const s=Ya();Ku(s,p);for(let _=0;_<this.path.length;_++){const b=this.path[_];if(!b.instance||!fy(b.latestValues))continue;oF(b.latestValues)&&b.updateSnapshot();const T=Ya(),C=b.measurePageBox();Ku(T,C),_9(s,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,T)}return fy(this.latestValues)&&_9(s,this.latestValues),s}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Lo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var k;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const _=!!this.resumingFrom||this!==s;if(!(p||_&&this.isSharedProjectionDirty||this.isProjectionDirty||(k=this.parent)!=null&&k.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:T,layoutId:C}=this.options;if(!this.layout||!(T||C))return;this.resolvedRelativeTargetAt=Lo.timestamp;const P=this.getClosestProjectingParent();P&&this.linkedParentVersion!==P.layoutVersion&&!P.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(P&&P.layout?this.createRelativeTarget(P,this.layout.layoutBox,P.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ya(),this.targetWithTransforms=Ya()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Nje(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ku(this.target,this.layout.layoutBox),qre(this.target,this.targetDelta)):Ku(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,P&&!!P.resumingFrom==!!this.resumingFrom&&!P.options.layoutScroll&&P.target&&this.animationProgress!==1?this.createRelativeTarget(P,this.target,P.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||oF(this.parent.latestValues)||Ure(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(p,s,_){this.relativeParent=p,this.linkedParentVersion=p.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ya(),this.relativeTargetOrigin=Ya(),ZP(this.relativeTargetOrigin,s,_),Ku(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var B;const p=this.getLead(),s=!!this.resumingFrom||this!==p;let _=!0;if((this.isProjectionDirty||(B=this.parent)!=null&&B.isProjectionDirty)&&(_=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(_=!1),this.resolvedRelativeTargetAt===Lo.timestamp&&(_=!1),_)return;const{layout:b,layoutId:T}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(b||T))return;Ku(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,P=this.treeScale.y;sje(this.layoutCorrected,this.treeScale,this.path,s),p.layout&&!p.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(p.target=p.layout.layoutBox,p.targetWithTransforms=Ya());const{target:k}=p;if(!k){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(b9(this.prevProjectionDelta.x,this.projectionDelta.x),b9(this.prevProjectionDelta.y,this.projectionDelta.y)),XS(this.projectionDelta,this.layoutCorrected,k,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==P||!j9(this.projectionDelta.x,this.prevProjectionDelta.x)||!j9(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",k))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var s;if((s=this.options.visualElement)==null||s.scheduleRender(),p){const _=this.getStack();_&&_.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=kx(),this.projectionDelta=kx(),this.projectionDeltaWithTransform=kx()}setAnimationOrigin(p,s=!1){const _=this.snapshot,b=_?_.latestValues:{},T={...this.latestValues},C=kx();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const P=Ya(),k=_?_.source:void 0,B=this.layout?this.layout.source:void 0,R=k!==B,D=this.getStack(),G=!D||D.members.length<=1,V=!!(R&&!G&&this.options.crossfade===!0&&!this.path.some(iAe));this.animationProgress=0;let $;this.mixTargetDelta=K=>{const Y=K/1e3;O9(C.x,p.x,Y),O9(C.y,p.y,Y),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ZP(P,this.layout.layoutBox,this.relativeParent.layout.layoutBox),nAe(this.relativeTarget,this.relativeTargetOrigin,P,Y),$&&Rje(this.relativeTarget,$)&&(this.isProjectionDirty=!1),$||($=Ya()),Ku($,this.relativeTarget)),R&&(this.animationValues=T,Lje(T,b,this.latestValues,Y,V,G)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Y},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){var s,_,b;this.notifyListeners("animationStart"),(s=this.currentAnimation)==null||s.stop(),(b=(_=this.resumingFrom)==null?void 0:_.currentAnimation)==null||b.stop(),this.pendingAnimation&&(Rm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=zs.update(()=>{rP.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=P0(0)),this.currentAnimation=$je(this.motionValue,[0,1e3],{...p,velocity:0,isSync:!0,onUpdate:T=>{this.mixTargetDelta(T),p.onUpdate&&p.onUpdate(T)},onStop:()=>{},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Gje),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:s,target:_,layout:b,latestValues:T}=p;if(!(!s||!_||!b)){if(this!==p&&this.layout&&b&&lne(this.options.animationType,this.layout.layoutBox,b.layoutBox)){_=this.target||Ya();const C=Ml(this.layout.layoutBox.x);_.x.min=p.target.x.min,_.x.max=_.x.min+C;const P=Ml(this.layout.layoutBox.y);_.y.min=p.target.y.min,_.y.max=_.y.min+P}Ku(s,_),Rx(s,T),XS(this.projectionDeltaWithTransform,this.layoutCorrected,s,T)}}registerSharedNode(p,s){this.sharedNodes.has(p)||this.sharedNodes.set(p,new qje),this.sharedNodes.get(p).add(s);const b=s.options.initialPromotionConfig;s.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(s):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var s;const{layoutId:p}=this.options;return p?((s=this.getStack())==null?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:p}=this.options;return p?(s=this.getStack())==null?void 0:s.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:s,preserveFollowOpacity:_}={}){const b=this.getStack();b&&b.promote(this,_),p&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let s=!1;const{latestValues:_}=p;if((_.z||_.rotate||_.rotateX||_.rotateY||_.rotateZ||_.skewX||_.skewY)&&(s=!0),!s)return;const b={};_.z&&gD("z",p,b,this.animationValues);for(let T=0;T<mD.length;T++)gD(`rotate${mD[T]}`,p,b,this.animationValues),gD(`skew${mD[T]}`,p,b,this.animationValues);p.render();for(const T in b)p.setStaticValue(T,b[T]),this.animationValues&&(this.animationValues[T]=b[T]);p.scheduleRender()}applyProjectionStyles(p,s){if(!this.instance||this.isSVG)return;if(!this.isVisible){p.visibility="hidden";return}const _=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,p.visibility="",p.opacity="",p.pointerEvents=tP(s==null?void 0:s.pointerEvents)||"",p.transform=_?_(this.latestValues,""):"none";return}const b=this.getLead();if(!this.projectionDelta||!this.layout||!b.target){this.options.layoutId&&(p.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,p.pointerEvents=tP(s==null?void 0:s.pointerEvents)||""),this.hasProjected&&!fy(this.latestValues)&&(p.transform=_?_({},""):"none",this.hasProjected=!1);return}p.visibility="";const T=b.animationValues||b.latestValues;this.applyTransformsToTarget();let C=Mje(this.projectionDeltaWithTransform,this.treeScale,T);_&&(C=_(T,C)),p.transform=C;const{x:P,y:k}=this.projectionDelta;p.transformOrigin=`${P.origin*100}% ${k.origin*100}% 0`,b.animationValues?p.opacity=b===this?T.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:T.opacityExit:p.opacity=b===this?T.opacity!==void 0?T.opacity:"":T.opacityExit!==void 0?T.opacityExit:0;for(const B in cF){if(T[B]===void 0)continue;const{correct:R,applyTo:D,isCSSVariable:G}=cF[B],V=C==="none"?T[B]:R(T[B],b);if(D){const $=D.length;for(let K=0;K<$;K++)p[D[K]]=V}else G?this.options.visualElement.renderState.vars[B]=V:p[B]=V}this.options.layoutId&&(p.pointerEvents=b===this?tP(s==null?void 0:s.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var s;return(s=p.currentAnimation)==null?void 0:s.stop()}),this.root.nodes.forEach(N9),this.root.sharedNodes.clear()}}}function Hje(e){e.updateLayout()}function Zje(e){var r;const t=((r=e.resumeFrom)==null?void 0:r.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:a}=e.layout,{animationType:d}=e.options,p=t.source!==e.layout.source;d==="size"?hu(C=>{const P=p?t.measuredBox[C]:t.layoutBox[C],k=Ml(P);P.min=n[C].min,P.max=P.min+k}):lne(d,t.layoutBox,n)&&hu(C=>{const P=p?t.measuredBox[C]:t.layoutBox[C],k=Ml(n[C]);P.max=P.min+k,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[C].max=e.relativeTarget[C].min+k)});const s=kx();XS(s,n,t.layoutBox);const _=kx();p?XS(_,e.applyTransform(a,!0),t.measuredBox):XS(_,n,t.layoutBox);const b=!rne(s);let T=!1;if(!e.resumeFrom){const C=e.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:P,layout:k}=C;if(P&&k){const B=Ya();ZP(B,t.layoutBox,P.layoutBox);const R=Ya();ZP(R,n,k.layoutBox),nne(B,R)||(T=!0),C.options.layoutRoot&&(e.relativeTarget=R,e.relativeTargetOrigin=B,e.relativeParent=C)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:_,layoutDelta:s,hasLayoutChanged:b,hasRelativeLayoutChanged:T})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Xje(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Kje(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Yje(e){e.clearSnapshot()}function N9(e){e.clearMeasurements()}function I9(e){e.isLayoutDirty=!1}function Jje(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function k9(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Qje(e){e.resolveTargetDelta()}function eAe(e){e.calcProjection()}function tAe(e){e.resetSkewAndRotation()}function rAe(e){e.removeLeadSnapshot()}function O9(e,t,r){e.translate=ea(t.translate,0,r),e.scale=ea(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function R9(e,t,r,n){e.min=ea(t.min,r.min,n),e.max=ea(t.max,r.max,n)}function nAe(e,t,r,n){R9(e.x,t.x,r.x,n),R9(e.y,t.y,r.y,n)}function iAe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const sAe={duration:.45,ease:[.4,0,.1,1]},M9=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),D9=M9("applewebkit/")&&!M9("chrome/")?Math.round:wu;function L9(e){e.min=D9(e.min),e.max=D9(e.max)}function aAe(e){L9(e.x),L9(e.y)}function lne(e,t,r){return e==="position"||e==="preserve-aspect"&&!Pje(E9(t),E9(r),.2)}function oAe(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const lAe=one({attachResizeListener:(e,t)=>$T(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),yD={current:void 0},cne=one({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!yD.current){const e=new lAe({});e.mount(window),e.setOptions({layoutScroll:!0}),yD.current=e}return yD.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),l5=F.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function F9(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function cAe(...e){return t=>{let r=!1;const n=e.map(a=>{const d=F9(a,t);return!r&&typeof d=="function"&&(r=!0),d});if(r)return()=>{for(let a=0;a<n.length;a++){const d=n[a];typeof d=="function"?d():F9(e[a],null)}}}}function uAe(...e){return F.useCallback(cAe(...e),e)}class dAe extends F.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,a=kre(n)&&n.offsetWidth||0,d=this.props.sizeRef.current;d.height=r.offsetHeight||0,d.width=r.offsetWidth||0,d.top=r.offsetTop,d.left=r.offsetLeft,d.right=a-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function hAe({children:e,isPresent:t,anchorX:r,root:n}){var T;const a=F.useId(),d=F.useRef(null),p=F.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:s}=F.useContext(l5),_=((T=e.props)==null?void 0:T.ref)??(e==null?void 0:e.ref),b=uAe(d,_);return F.useInsertionEffect(()=>{const{width:C,height:P,top:k,left:B,right:R}=p.current;if(t||!d.current||!C||!P)return;const D=r==="left"?`left: ${B}`:`right: ${R}`;d.current.dataset.motionPopId=a;const G=document.createElement("style");s&&(G.nonce=s);const V=n??document.head;return V.appendChild(G),G.sheet&&G.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${P}px !important;
            ${D}px !important;
            top: ${k}px !important;
          }
        `),()=>{V.contains(G)&&V.removeChild(G)}},[t]),c.jsx(dAe,{isPresent:t,childRef:d,sizeRef:p,children:F.cloneElement(e,{ref:b})})}const fAe=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:a,presenceAffectsLayout:d,mode:p,anchorX:s,root:_})=>{const b=R4(pAe),T=F.useId();let C=!0,P=F.useMemo(()=>(C=!1,{id:T,initial:t,isPresent:r,custom:a,onExitComplete:k=>{b.set(k,!0);for(const B of b.values())if(!B)return;n&&n()},register:k=>(b.set(k,!1),()=>b.delete(k))}),[r,b,n]);return d&&C&&(P={...P}),F.useMemo(()=>{b.forEach((k,B)=>b.set(B,!1))},[r]),F.useEffect(()=>{!r&&!b.size&&n&&n()},[r]),p==="popLayout"&&(e=c.jsx(hAe,{isPresent:r,anchorX:s,root:_,children:e})),c.jsx(XI.Provider,{value:P,children:e})};function pAe(){return new Map}function une(e=!0){const t=F.useContext(XI);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:a}=t,d=F.useId();F.useEffect(()=>{if(e)return a(d)},[e]);const p=F.useCallback(()=>e&&n&&n(d),[d,n,e]);return!r&&n?[!1,p]:[!0]}const gC=e=>e.key||"";function z9(e){const t=[];return F.Children.forEach(e,r=>{F.isValidElement(r)&&t.push(r)}),t}const ju=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:a=!0,mode:d="sync",propagate:p=!1,anchorX:s="left",root:_})=>{const[b,T]=une(p),C=F.useMemo(()=>z9(e),[e]),P=p&&!b?[]:C.map(gC),k=F.useRef(!0),B=F.useRef(C),R=R4(()=>new Map),D=F.useRef(new Set),[G,V]=F.useState(C),[$,K]=F.useState(C);$te(()=>{k.current=!1,B.current=C;for(let ae=0;ae<$.length;ae++){const ie=gC($[ae]);P.includes(ie)?(R.delete(ie),D.current.delete(ie)):R.get(ie)!==!0&&R.set(ie,!1)}},[$,P.length,P.join("-")]);const Y=[];if(C!==G){let ae=[...C];for(let ie=0;ie<$.length;ie++){const ge=$[ie],fe=gC(ge);P.includes(fe)||(ae.splice(ie,0,ge),Y.push(ge))}return d==="wait"&&Y.length&&(ae=Y),K(z9(ae)),V(C),null}const{forceRender:ee}=F.useContext(O4);return c.jsx(c.Fragment,{children:$.map(ae=>{const ie=gC(ae),ge=p&&!b?!1:C===$||P.includes(ie),fe=()=>{if(D.current.has(ie))return;if(D.current.add(ie),R.has(ie))R.set(ie,!0);else return;let be=!0;R.forEach(ue=>{ue||(be=!1)}),be&&(ee==null||ee(),K(B.current),p&&(T==null||T()),n&&n())};return c.jsx(fAe,{isPresent:ge,initial:!k.current||r?void 0:!1,custom:t,presenceAffectsLayout:a,mode:d,root:_,onExitComplete:ge?void 0:fe,anchorX:s,children:ae},ie)})})},dne=F.createContext({strict:!1}),B9={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let $9=!1;function mAe(){if($9)return;const e={};for(const t in B9)e[t]={isEnabled:r=>B9[t].some(n=>!!r[n])};Bre(e),$9=!0}function hne(){return mAe(),tje()}function gAe(e){const t=hne();for(const r in e)t[r]={...t[r],...e[r]};Bre(t)}const yAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function XP(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||yAe.has(e)}let fne=e=>!XP(e);function vAe(e){typeof e=="function"&&(fne=t=>t.startsWith("on")?!XP(t):e(t))}try{vAe(require("@emotion/is-prop-valid").default)}catch{}function _Ae(e,t,r){const n={};for(const a in e)a==="values"&&typeof e.values=="object"||(fne(a)||r===!0&&XP(a)||!t&&!XP(a)||e.draggable&&a.startsWith("onDrag"))&&(n[a]=e[a]);return n}const JI=F.createContext({});function xAe(e,t){if(YI(e)){const{initial:r,animate:n}=e;return{initial:r===!1||BT(r)?r:void 0,animate:BT(n)?n:void 0}}return e.inherit!==!1?t:{}}function bAe(e){const{initial:t,animate:r}=xAe(e,F.useContext(JI));return F.useMemo(()=>({initial:t,animate:r}),[V9(t),V9(r)])}function V9(e){return Array.isArray(e)?e.join(" "):e}const c5=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function pne(e,t,r){for(const n in t)!ol(t[n])&&!Hre(n,r)&&(e[n]=t[n])}function wAe({transformTemplate:e},t){return F.useMemo(()=>{const r=c5();return a5(r,t,e),Object.assign({},r.vars,r.style)},[t])}function SAe(e,t){const r=e.style||{},n={};return pne(n,r,e),Object.assign(n,wAe(e,t)),n}function TAe(e,t){const r={},n=SAe(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const mne=()=>({...c5(),attrs:{}});function EAe(e,t,r,n){const a=F.useMemo(()=>{const d=mne();return Zre(d,t,Kre(n),e.transformTemplate,e.style),{...d.attrs,style:{...d.style}}},[t]);if(e.style){const d={};pne(d,e.style,e),a.style={...d,...a.style}}return a}const jAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function u5(e){return typeof e!="string"||e.includes("-")?!1:!!(jAe.indexOf(e)>-1||/[A-Z]/u.test(e))}function AAe(e,t,r,{latestValues:n},a,d=!1,p){const _=(p??u5(e)?EAe:TAe)(t,n,a,e),b=_Ae(t,typeof e=="string",d),T=e!==F.Fragment?{...b,..._,ref:r}:{},{children:C}=t,P=F.useMemo(()=>ol(C)?C.get():C,[C]);return F.createElement(e,{...T,children:P})}function CAe({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,a){return{latestValues:PAe(r,n,a,e),renderState:t()}}function PAe(e,t,r,n){const a={},d=n(e,{});for(const P in d)a[P]=tP(d[P]);let{initial:p,animate:s}=e;const _=YI(e),b=zre(e);t&&b&&!_&&e.inherit!==!1&&(p===void 0&&(p=t.initial),s===void 0&&(s=t.animate));let T=r?r.initial===!1:!1;T=T||p===!1;const C=T?s:p;if(C&&typeof C!="boolean"&&!KI(C)){const P=Array.isArray(C)?C:[C];for(let k=0;k<P.length;k++){const B=Q4(e,P[k]);if(B){const{transitionEnd:R,transition:D,...G}=B;for(const V in G){let $=G[V];if(Array.isArray($)){const K=T?$.length-1:0;$=$[K]}$!==null&&(a[V]=$)}for(const V in R)a[V]=R[V]}}}return a}const gne=e=>(t,r)=>{const n=F.useContext(JI),a=F.useContext(XI),d=()=>CAe(e,t,n,a);return r?d():R4(d)},NAe=gne({scrapeMotionValuesFromProps:o5,createRenderState:c5}),IAe=gne({scrapeMotionValuesFromProps:Yre,createRenderState:mne}),kAe=Symbol.for("motionComponentSymbol");function OAe(e,t,r){const n=F.useRef(r);F.useInsertionEffect(()=>{n.current=r});const a=F.useRef(null);return F.useCallback(d=>{var s;d&&((s=e.onMount)==null||s.call(e,d)),t&&(d?t.mount(d):t.unmount());const p=n.current;if(typeof p=="function")if(d){const _=p(d);typeof _=="function"&&(a.current=_)}else a.current?(a.current(),a.current=null):p(d);else p&&(p.current=d)},[t])}const yne=F.createContext({});function TS(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function RAe(e,t,r,n,a,d){var D,G;const{visualElement:p}=F.useContext(JI),s=F.useContext(dne),_=F.useContext(XI),b=F.useContext(l5).reducedMotion,T=F.useRef(null);n=n||s.renderer,!T.current&&n&&(T.current=n(e,{visualState:t,parent:p,props:r,presenceContext:_,blockInitialAnimation:_?_.initial===!1:!1,reducedMotionConfig:b,isSVG:d}));const C=T.current,P=F.useContext(yne);C&&!C.projection&&a&&(C.type==="html"||C.type==="svg")&&MAe(T.current,r,a,P);const k=F.useRef(!1);F.useInsertionEffect(()=>{C&&k.current&&C.update(r,_)});const B=r[Tre],R=F.useRef(!!B&&!((D=window.MotionHandoffIsComplete)!=null&&D.call(window,B))&&((G=window.MotionHasOptimisedAnimation)==null?void 0:G.call(window,B)));return $te(()=>{C&&(k.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),R.current&&C.animationState&&C.animationState.animateChanges())}),F.useEffect(()=>{C&&(!R.current&&C.animationState&&C.animationState.animateChanges(),R.current&&(queueMicrotask(()=>{var V;(V=window.MotionHandoffMarkAsComplete)==null||V.call(window,B)}),R.current=!1),C.enteringChildren=void 0)}),C}function MAe(e,t,r,n){const{layoutId:a,layout:d,drag:p,dragConstraints:s,layoutScroll:_,layoutRoot:b,layoutCrossfade:T}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:vne(e.parent)),e.projection.setOptions({layoutId:a,layout:d,alwaysMeasureLayout:!!p||s&&TS(s),visualElement:e,animationType:typeof d=="string"?d:"both",initialPromotionConfig:n,crossfade:T,layoutScroll:_,layoutRoot:b})}function vne(e){if(e)return e.options.allowProjection!==!1?e.projection:vne(e.parent)}function vD(e,{forwardMotionProps:t=!1,type:r}={},n,a){n&&gAe(n);const d=r?r==="svg":u5(e),p=d?IAe:NAe;function s(b,T){let C;const P={...F.useContext(l5),...b,layoutId:DAe(b)},{isStatic:k}=P,B=bAe(b),R=p(b,k);if(!k&&Bte){LAe();const D=FAe(P);C=D.MeasureLayout,B.visualElement=RAe(e,R,P,a,D.ProjectionNode,d)}return c.jsxs(JI.Provider,{value:B,children:[C&&B.visualElement?c.jsx(C,{visualElement:B.visualElement,...P}):null,AAe(e,b,OAe(R,B.visualElement,T),R,k,t,d)]})}s.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const _=F.forwardRef(s);return _[kAe]=e,_}function DAe({layoutId:e}){const t=F.useContext(O4).id;return t&&e!==void 0?t+"-"+e:e}function LAe(e,t){F.useContext(dne).strict}function FAe(e){const t=hne(),{drag:r,layout:n}=t;if(!r&&!n)return{};const a={...r,...n};return{MeasureLayout:r!=null&&r.isEnabled(e)||n!=null&&n.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function zAe(e,t){if(typeof Proxy>"u")return vD;const r=new Map,n=(d,p)=>vD(d,p,e,t),a=(d,p)=>n(d,p);return new Proxy(a,{get:(d,p)=>p==="create"?n:(r.has(p)||r.set(p,vD(p,void 0,e,t)),r.get(p))})}const BAe=(e,t)=>t.isSVG??u5(e)?new vje(t):new hje(t,{allowProjection:e!==F.Fragment});class $Ae extends Hm{constructor(t){super(t),t.animationState||(t.animationState=Sje(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();KI(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let VAe=0;class UAe extends Hm{constructor(){super(...arguments),this.id=VAe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const a=this.node.animationState.setActive("exit",!t);r&&!t&&a.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const qAe={animation:{Feature:$Ae},exit:{Feature:UAe}};function Y2(e){return{point:{x:e.pageX,y:e.pageY}}}const GAe=e=>t=>n5(t)&&e(t,Y2(t));function KS(e,t,r,n){return $T(e,t,GAe(r),n)}const _ne=({current:e})=>e?e.ownerDocument.defaultView:null,U9=(e,t)=>Math.abs(e-t);function WAe(e,t){const r=U9(e.x,t.x),n=U9(e.y,t.y);return Math.sqrt(r**2+n**2)}const q9=new Set(["auto","scroll"]);class xne{constructor(t,r,{transformPagePoint:n,contextWindow:a=window,dragSnapToOrigin:d=!1,distanceThreshold:p=3,element:s}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=k=>{this.handleScroll(k.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const k=xD(this.lastMoveEventInfo,this.history),B=this.startEvent!==null,R=WAe(k.offset,{x:0,y:0})>=this.distanceThreshold;if(!B&&!R)return;const{point:D}=k,{timestamp:G}=Lo;this.history.push({...D,timestamp:G});const{onStart:V,onMove:$}=this.handlers;B||(V&&V(this.lastMoveEvent,k),this.startEvent=this.lastMoveEvent),$&&$(this.lastMoveEvent,k)},this.handlePointerMove=(k,B)=>{this.lastMoveEvent=k,this.lastMoveEventInfo=_D(B,this.transformPagePoint),zs.update(this.updatePoint,!0)},this.handlePointerUp=(k,B)=>{this.end();const{onEnd:R,onSessionEnd:D,resumeAnimation:G}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const V=xD(k.type==="pointercancel"?this.lastMoveEventInfo:_D(B,this.transformPagePoint),this.history);this.startEvent&&R&&R(k,V),D&&D(k,V)},!n5(t))return;this.dragSnapToOrigin=d,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=p,this.contextWindow=a||window;const _=Y2(t),b=_D(_,this.transformPagePoint),{point:T}=b,{timestamp:C}=Lo;this.history=[{...T,timestamp:C}];const{onSessionStart:P}=r;P&&P(t,xD(b,this.history)),this.removeListeners=Z2(KS(this.contextWindow,"pointermove",this.handlePointerMove),KS(this.contextWindow,"pointerup",this.handlePointerUp),KS(this.contextWindow,"pointercancel",this.handlePointerUp)),s&&this.startScrollTracking(s)}startScrollTracking(t){let r=t.parentElement;for(;r;){const n=getComputedStyle(r);(q9.has(n.overflowX)||q9.has(n.overflowY))&&this.scrollPositions.set(r,{x:r.scrollLeft,y:r.scrollTop}),r=r.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const r=this.scrollPositions.get(t);if(!r)return;const n=t===window,a=n?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},d={x:a.x-r.x,y:a.y-r.y};d.x===0&&d.y===0||(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=d.x,this.lastMoveEventInfo.point.y+=d.y):this.history.length>0&&(this.history[0].x-=d.x,this.history[0].y-=d.y),this.scrollPositions.set(t,a),zs.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Rm(this.updatePoint)}}function _D(e,t){return t?{point:t(e.point)}:e}function G9(e,t){return{x:e.x-t.x,y:e.y-t.y}}function xD({point:e},t){return{point:e,delta:G9(e,bne(t)),offset:G9(e,HAe(t)),velocity:ZAe(t,.1)}}function HAe(e){return e[0]}function bne(e){return e[e.length-1]}function ZAe(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const a=bne(e);for(;r>=0&&(n=e[r],!(a.timestamp-n.timestamp>Ef(t)));)r--;if(!n)return{x:0,y:0};const d=_u(a.timestamp-n.timestamp);if(d===0)return{x:0,y:0};const p={x:(a.x-n.x)/d,y:(a.y-n.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function XAe(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?ea(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?ea(r,e,n.max):Math.min(e,r)),e}function W9(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function KAe(e,{top:t,left:r,bottom:n,right:a}){return{x:W9(e.x,r,a),y:W9(e.y,t,n)}}function H9(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function YAe(e,t){return{x:H9(e.x,t.x),y:H9(e.y,t.y)}}function JAe(e,t){let r=.5;const n=Ml(e),a=Ml(t);return a>n?r=LT(t.min,t.max-n,e.min):n>a&&(r=LT(e.min,e.max-a,t.min)),Ch(0,1,r)}function QAe(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const uF=.35;function eCe(e=uF){return e===!1?e=0:e===!0&&(e=uF),{x:Z9(e,"left","right"),y:Z9(e,"top","bottom")}}function Z9(e,t,r){return{min:X9(e,t),max:X9(e,r)}}function X9(e,t){return typeof e=="number"?e:e[t]||0}const tCe=new WeakMap;class rCe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ya(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const d=C=>{r?(this.stopAnimation(),this.snapToCursor(Y2(C).point)):this.pauseAnimation()},p=(C,P)=>{this.stopAnimation();const{drag:k,dragPropagation:B,onDragStart:R}=this.getProps();if(k&&!B&&(this.openDragLock&&this.openDragLock(),this.openDragLock=UEe(k),!this.openDragLock))return;this.latestPointerEvent=C,this.latestPanInfo=P,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),hu(G=>{let V=this.getAxisMotionValue(G).get()||0;if(wh.test(V)){const{projection:$}=this.visualElement;if($&&$.layout){const K=$.layout.layoutBox[G];K&&(V=Ml(K)*(parseFloat(V)/100))}}this.originPoint[G]=V}),R&&zs.postRender(()=>R(C,P)),nF(this.visualElement,"transform");const{animationState:D}=this.visualElement;D&&D.setActive("whileDrag",!0)},s=(C,P)=>{this.latestPointerEvent=C,this.latestPanInfo=P;const{dragPropagation:k,dragDirectionLock:B,onDirectionLock:R,onDrag:D}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:G}=P;if(B&&this.currentDirection===null){this.currentDirection=nCe(G),this.currentDirection!==null&&R&&R(this.currentDirection);return}this.updateAxis("x",P.point,G),this.updateAxis("y",P.point,G),this.visualElement.render(),D&&D(C,P)},_=(C,P)=>{this.latestPointerEvent=C,this.latestPanInfo=P,this.stop(C,P),this.latestPointerEvent=null,this.latestPanInfo=null},b=()=>hu(C=>{var P;return this.getAnimationState(C)==="paused"&&((P=this.getAxisMotionValue(C).animation)==null?void 0:P.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new xne(t,{onSessionStart:d,onStart:p,onMove:s,onSessionEnd:_,resumeAnimation:b},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:n,contextWindow:_ne(this.visualElement),element:this.visualElement.current})}stop(t,r){const n=t||this.latestPointerEvent,a=r||this.latestPanInfo,d=this.isDragging;if(this.cancel(),!d||!a||!n)return;const{velocity:p}=a;this.startAnimation(p);const{onDragEnd:s}=this.getProps();s&&zs.postRender(()=>s(n,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:a}=this.getProps();if(!n||!yC(t,a,this.currentDirection))return;const d=this.getAxisMotionValue(t);let p=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(p=XAe(p,this.constraints[t],this.elastic[t])),d.set(p)}resolveConstraints(){var d;const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(d=this.visualElement.projection)==null?void 0:d.layout,a=this.constraints;t&&TS(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=KAe(n.layoutBox,t):this.constraints=!1,this.elastic=eCe(r),a!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&hu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=QAe(n.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!TS(t))return!1;const n=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const d=aje(n,a.root,this.visualElement.getTransformPagePoint());let p=YAe(a.layout.layoutBox,d);if(r){const s=r(nje(p));this.hasMutatedConstraints=!!s,s&&(p=Vre(s))}return p}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:a,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:s}=this.getProps(),_=this.constraints||{},b=hu(T=>{if(!yC(T,r,this.currentDirection))return;let C=_&&_[T]||{};p&&(C={min:0,max:0});const P=a?200:1e6,k=a?40:1e7,B={type:"inertia",velocity:n?t[T]:0,bounceStiffness:P,bounceDamping:k,timeConstant:750,restDelta:1,restSpeed:10,...d,...C};return this.startAxisValueAnimation(T,B)});return Promise.all(b).then(s)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return nF(this.visualElement,t),n.start(J4(t,n,0,r,this.visualElement,!1))}stopAnimation(){hu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){hu(t=>{var r;return(r=this.getAxisMotionValue(t).animation)==null?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)==null?void 0:r.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),a=n[r];return a||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){hu(r=>{const{drag:n}=this.getProps();if(!yC(r,n,this.currentDirection))return;const{projection:a}=this.visualElement,d=this.getAxisMotionValue(r);if(a&&a.layout){const{min:p,max:s}=a.layout.layoutBox[r],_=d.get()||0;d.set(t[r]-ea(p,s,.5)+_)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!TS(r)||!n||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};hu(p=>{const s=this.getAxisMotionValue(p);if(s&&this.constraints!==!1){const _=s.get();a[p]=JAe({min:_,max:_},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),hu(p=>{if(!yC(p,t,null))return;const s=this.getAxisMotionValue(p),{min:_,max:b}=this.constraints[p];s.set(ea(_,b,a[p]))})}addListeners(){if(!this.visualElement.current)return;tCe.set(this.visualElement,this);const t=this.visualElement.current,r=KS(t,"pointerdown",_=>{const{drag:b,dragListener:T=!0}=this.getProps();b&&T&&!Dre(_.target)&&this.start(_)}),n=()=>{const{dragConstraints:_}=this.getProps();TS(_)&&_.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,d=a.addEventListener("measure",n);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),zs.read(n);const p=$T(window,"resize",()=>this.scalePositionWithinConstraints()),s=a.addEventListener("didUpdate",({delta:_,hasLayoutChanged:b})=>{this.isDragging&&b&&(hu(T=>{const C=this.getAxisMotionValue(T);C&&(this.originPoint[T]+=_[T].translate,C.set(C.get()+_[T].translate))}),this.visualElement.render())});return()=>{p(),r(),d(),s&&s()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:a=!1,dragConstraints:d=!1,dragElastic:p=uF,dragMomentum:s=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:a,dragConstraints:d,dragElastic:p,dragMomentum:s}}}function yC(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function nCe(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class iCe extends Hm{constructor(t){super(t),this.removeGroupControls=wu,this.removeListeners=wu,this.controls=new rCe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||wu}update(){const{dragControls:t}=this.node.getProps(),{dragControls:r}=this.node.prevProps||{};t!==r&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const K9=e=>(t,r)=>{e&&zs.postRender(()=>e(t,r))};class sCe extends Hm{constructor(){super(...arguments),this.removePointerDownListener=wu}onPointerDown(t){this.session=new xne(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:_ne(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:a}=this.node.getProps();return{onSessionStart:K9(t),onStart:K9(r),onMove:n,onEnd:(d,p)=>{delete this.session,a&&zs.postRender(()=>a(d,p))}}}mount(){this.removePointerDownListener=KS(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let bD=!1;class aCe extends F.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:a}=this.props,{projection:d}=t;d&&(r.group&&r.group.add(d),n&&n.register&&a&&n.register(d),bD&&d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),rP.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:a,isPresent:d}=this.props,{projection:p}=n;return p&&(p.isPresent=d,bD=!0,a||t.layoutDependency!==r||r===void 0||t.isPresent!==d?p.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?p.promote():p.relegate()||zs.postRender(()=>{const s=p.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),r5.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:a}=t;bD=!0,a&&(a.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(a),n&&n.deregister&&n.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function wne(e){const[t,r]=une(),n=F.useContext(O4);return c.jsx(aCe,{...e,layoutGroup:n,switchLayoutGroup:F.useContext(yne),isPresent:t,safeToRemove:r})}const oCe={pan:{Feature:sCe},drag:{Feature:iCe,ProjectionNode:cne,MeasureLayout:wne}};function Y9(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const a="onHover"+r,d=n[a];d&&zs.postRender(()=>d(t,Y2(t)))}class lCe extends Hm{mount(){const{current:t}=this.node;t&&(this.unmount=qEe(t,(r,n)=>(Y9(this.node,n,"Start"),a=>Y9(this.node,a,"End"))))}unmount(){}}class cCe extends Hm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Z2($T(this.node.current,"focus",()=>this.onFocus()),$T(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function J9(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const a="onTap"+(r==="End"?"":r),d=n[a];d&&zs.postRender(()=>d(t,Y2(t)))}class uCe extends Hm{mount(){const{current:t}=this.node;t&&(this.unmount=HEe(t,(r,n)=>(J9(this.node,n,"Start"),(a,{success:d})=>J9(this.node,a,d?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const dF=new WeakMap,wD=new WeakMap,dCe=e=>{const t=dF.get(e.target);t&&t(e)},hCe=e=>{e.forEach(dCe)};function fCe({root:e,...t}){const r=e||document;wD.has(r)||wD.set(r,{});const n=wD.get(r),a=JSON.stringify(t);return n[a]||(n[a]=new IntersectionObserver(hCe,{root:e,...t})),n[a]}function pCe(e,t,r){const n=fCe(t);return dF.set(e,r),n.observe(e),()=>{dF.delete(e),n.unobserve(e)}}const mCe={some:0,all:1};class gCe extends Hm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:a="some",once:d}=t,p={root:r?r.current:void 0,rootMargin:n,threshold:typeof a=="number"?a:mCe[a]},s=_=>{const{isIntersecting:b}=_;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:T,onViewportLeave:C}=this.node.getProps(),P=b?T:C;P&&P(_)};return pCe(this.node.current,p,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(yCe(t,r))&&this.startObserver()}unmount(){}}function yCe({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const vCe={inView:{Feature:gCe},tap:{Feature:uCe},focus:{Feature:cCe},hover:{Feature:lCe}},_Ce={layout:{ProjectionNode:cne,MeasureLayout:wne}},xCe={...qAe,...vCe,...oCe,..._Ce},gr=zAe(xCe,BAe),wv=""+new URL("logo-cjsra0SH.png",import.meta.url).href,bCe=({onComplete:e,duration:t=3e3})=>{const[r,n]=F.useState(!0);return F.useEffect(()=>{const a=setTimeout(()=>{n(!1),e==null||e()},t);return()=>clearTimeout(a)},[t,e]),c.jsx(ju,{children:r&&c.jsxs(gr.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.5,ease:"easeOut"},className:"fixed inset-0 z-[100] flex items-center justify-center bg-gradient-to-br from-background via-background to-accent/20",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary/5 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-primary/5 rounded-full blur-3xl"})]}),c.jsx(gr.div,{initial:{scale:.8,opacity:0},animate:{scale:[.8,1,1.05,1,1.05,1,1.05,1],opacity:[0,1,.9,1,.9,1,.9,1]},transition:{duration:2.5,ease:"easeInOut",times:[0,.15,.3,.4,.55,.65,.8,.9]},className:"relative z-10",children:c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-40 md:h-52 w-auto object-contain drop-shadow-lg"})}),c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.4},className:"absolute bottom-1/4 flex flex-col items-center gap-3",children:[c.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(a=>c.jsx(gr.div,{className:"w-2 h-2 rounded-full bg-primary",animate:{scale:[1,1.3,1],opacity:[.5,1,.5]},transition:{duration:.8,repeat:1/0,delay:a*.2,ease:"easeInOut"}},a))}),c.jsx(gr.p,{initial:{opacity:0},animate:{opacity:.7},transition:{delay:.8},className:"text-sm text-muted-foreground font-medium",children:"Carregando..."})]})]})})},d5=LI("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 active:scale-[0.98] shadow-soft",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 active:scale-[0.98]",outline:"border-2 border-input bg-background hover:bg-accent hover:text-accent-foreground active:scale-[0.98]",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 active:scale-[0.98]",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"gradient-primary text-primary-foreground shadow-glow hover:shadow-elevated active:scale-[0.98] font-bold",heroOutline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground active:scale-[0.98] font-bold",success:"bg-success text-success-foreground hover:bg-success/90 active:scale-[0.98]"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-md px-4",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ft=F.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...a},d)=>{const p=n?PQ:"button";return c.jsx(p,{className:Dr(d5({variant:t,size:r,className:e})),ref:d,...a})});Ft.displayName="Button";function Q9(e,[t,r]){return Math.min(r,Math.max(t,e))}var wCe=F.createContext(void 0);function QI(e){const t=F.useContext(wCe);return e||t||"ltr"}var SD=0;function h5(){F.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??eH()),document.body.insertAdjacentElement("beforeend",e[1]??eH()),SD++,()=>{SD===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),SD--}},[])}function eH(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var TD="focusScope.autoFocusOnMount",ED="focusScope.autoFocusOnUnmount",tH={bubbles:!1,cancelable:!0},SCe="FocusScope",ek=F.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:d,...p}=e,[s,_]=F.useState(null),b=Bl(a),T=Bl(d),C=F.useRef(null),P=Ti(t,R=>_(R)),k=F.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;F.useEffect(()=>{if(n){let R=function($){if(k.paused||!s)return;const K=$.target;s.contains(K)?C.current=K:qp(C.current,{select:!0})},D=function($){if(k.paused||!s)return;const K=$.relatedTarget;K!==null&&(s.contains(K)||qp(C.current,{select:!0}))},G=function($){if(document.activeElement===document.body)for(const Y of $)Y.removedNodes.length>0&&qp(s)};document.addEventListener("focusin",R),document.addEventListener("focusout",D);const V=new MutationObserver(G);return s&&V.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",R),document.removeEventListener("focusout",D),V.disconnect()}}},[n,s,k.paused]),F.useEffect(()=>{if(s){nH.add(k);const R=document.activeElement;if(!s.contains(R)){const G=new CustomEvent(TD,tH);s.addEventListener(TD,b),s.dispatchEvent(G),G.defaultPrevented||(TCe(PCe(Sne(s)),{select:!0}),document.activeElement===R&&qp(s))}return()=>{s.removeEventListener(TD,b),setTimeout(()=>{const G=new CustomEvent(ED,tH);s.addEventListener(ED,T),s.dispatchEvent(G),G.defaultPrevented||qp(R??document.body,{select:!0}),s.removeEventListener(ED,T),nH.remove(k)},0)}}},[s,b,T,k]);const B=F.useCallback(R=>{if(!r&&!n||k.paused)return;const D=R.key==="Tab"&&!R.altKey&&!R.ctrlKey&&!R.metaKey,G=document.activeElement;if(D&&G){const V=R.currentTarget,[$,K]=ECe(V);$&&K?!R.shiftKey&&G===K?(R.preventDefault(),r&&qp($,{select:!0})):R.shiftKey&&G===$&&(R.preventDefault(),r&&qp(K,{select:!0})):G===V&&R.preventDefault()}},[r,n,k.paused]);return c.jsx(vn.div,{tabIndex:-1,...p,ref:P,onKeyDown:B})});ek.displayName=SCe;function TCe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(qp(n,{select:t}),document.activeElement!==r)return}function ECe(e){const t=Sne(e),r=rH(t,e),n=rH(t.reverse(),e);return[r,n]}function Sne(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function rH(e,t){for(const r of e)if(!jCe(r,{upTo:t}))return r}function jCe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function ACe(e){return e instanceof HTMLInputElement&&"select"in e}function qp(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&ACe(e)&&t&&e.select()}}var nH=CCe();function CCe(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=iH(e,t),e.unshift(t)},remove(t){var r;e=iH(e,t),(r=e[0])==null||r.resume()}}}function iH(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function PCe(e){return e.filter(t=>t.tagName!=="A")}function Tne(e){const t=F.useRef({value:e,previous:e});return F.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var NCe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},sx=new WeakMap,vC=new WeakMap,_C={},jD=0,Ene=function(e){return e&&(e.host||Ene(e.parentNode))},ICe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=Ene(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},kCe=function(e,t,r,n){var a=ICe(t,Array.isArray(e)?e:[e]);_C[r]||(_C[r]=new WeakMap);var d=_C[r],p=[],s=new Set,_=new Set(a),b=function(C){!C||s.has(C)||(s.add(C),b(C.parentNode))};a.forEach(b);var T=function(C){!C||_.has(C)||Array.prototype.forEach.call(C.children,function(P){if(s.has(P))T(P);else try{var k=P.getAttribute(n),B=k!==null&&k!=="false",R=(sx.get(P)||0)+1,D=(d.get(P)||0)+1;sx.set(P,R),d.set(P,D),p.push(P),R===1&&B&&vC.set(P,!0),D===1&&P.setAttribute(r,"true"),B||P.setAttribute(n,"true")}catch(G){console.error("aria-hidden: cannot operate on ",P,G)}})};return T(t),s.clear(),jD++,function(){p.forEach(function(C){var P=sx.get(C)-1,k=d.get(C)-1;sx.set(C,P),d.set(C,k),P||(vC.has(C)||C.removeAttribute(n),vC.delete(C)),k||C.removeAttribute(r)}),jD--,jD||(sx=new WeakMap,sx=new WeakMap,vC=new WeakMap,_C={})}},f5=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),a=NCe(e);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),kCe(n,a,r,"aria-hidden")):function(){return null}},nP="right-scroll-bar-position",iP="width-before-scroll-bar",OCe="with-scroll-bars-hidden",RCe="--removed-body-scroll-bar-size";function AD(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function MCe(e,t){var r=F.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var a=r.value;a!==n&&(r.value=n,r.callback(n,a))}}}})[0];return r.callback=t,r.facade}var DCe=typeof window<"u"?F.useLayoutEffect:F.useEffect,sH=new WeakMap;function LCe(e,t){var r=MCe(null,function(n){return e.forEach(function(a){return AD(a,n)})});return DCe(function(){var n=sH.get(r);if(n){var a=new Set(n),d=new Set(e),p=r.current;a.forEach(function(s){d.has(s)||AD(s,null)}),d.forEach(function(s){a.has(s)||AD(s,p)})}sH.set(r,e)},[e]),r}function FCe(e){return e}function zCe(e,t){t===void 0&&(t=FCe);var r=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(d){var p=t(d,n);return r.push(p),function(){r=r.filter(function(s){return s!==p})}},assignSyncMedium:function(d){for(n=!0;r.length;){var p=r;r=[],p.forEach(d)}r={push:function(s){return d(s)},filter:function(){return r}}},assignMedium:function(d){n=!0;var p=[];if(r.length){var s=r;r=[],s.forEach(d),p=r}var _=function(){var T=p;p=[],T.forEach(d)},b=function(){return Promise.resolve().then(_)};b(),r={push:function(T){p.push(T),b()},filter:function(T){return p=p.filter(T),r}}}};return a}function BCe(e){e===void 0&&(e={});var t=zCe(null);return t.options=dh({async:!0,ssr:!1},e),t}var jne=function(e){var t=e.sideCar,r=vb(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return F.createElement(n,dh({},r))};jne.isSideCarExport=!0;function $Ce(e,t){return e.useMedium(t),jne}var Ane=BCe(),CD=function(){},tk=F.forwardRef(function(e,t){var r=F.useRef(null),n=F.useState({onScrollCapture:CD,onWheelCapture:CD,onTouchMoveCapture:CD}),a=n[0],d=n[1],p=e.forwardProps,s=e.children,_=e.className,b=e.removeScrollBar,T=e.enabled,C=e.shards,P=e.sideCar,k=e.noRelative,B=e.noIsolation,R=e.inert,D=e.allowPinchZoom,G=e.as,V=G===void 0?"div":G,$=e.gapMode,K=vb(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Y=P,ee=LCe([r,t]),ae=dh(dh({},K),a);return F.createElement(F.Fragment,null,T&&F.createElement(Y,{sideCar:Ane,removeScrollBar:b,shards:C,noRelative:k,noIsolation:B,inert:R,setCallbacks:d,allowPinchZoom:!!D,lockRef:r,gapMode:$}),p?F.cloneElement(F.Children.only(s),dh(dh({},ae),{ref:ee})):F.createElement(V,dh({},ae,{className:_,ref:ee}),s))});tk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};tk.classNames={fullWidth:iP,zeroRight:nP};var VCe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function UCe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=VCe();return t&&e.setAttribute("nonce",t),e}function qCe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function GCe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var WCe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=UCe())&&(qCe(t,r),GCe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},HCe=function(){var e=WCe();return function(t,r){F.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},Cne=function(){var e=HCe(),t=function(r){var n=r.styles,a=r.dynamic;return e(n,a),null};return t},ZCe={left:0,top:0,right:0,gap:0},PD=function(e){return parseInt(e||"",10)||0},XCe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[PD(r),PD(n),PD(a)]},KCe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return ZCe;var t=XCe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},YCe=Cne(),Kx="data-scroll-locked",JCe=function(e,t,r,n){var a=e.left,d=e.top,p=e.right,s=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(OCe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(Kx,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(nP,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(iP,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(nP," .").concat(nP,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(iP," .").concat(iP,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Kx,`] {
    `).concat(RCe,": ").concat(s,`px;
  }
`)},aH=function(){var e=parseInt(document.body.getAttribute(Kx)||"0",10);return isFinite(e)?e:0},QCe=function(){F.useEffect(function(){return document.body.setAttribute(Kx,(aH()+1).toString()),function(){var e=aH()-1;e<=0?document.body.removeAttribute(Kx):document.body.setAttribute(Kx,e.toString())}},[])},ePe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,a=n===void 0?"margin":n;QCe();var d=F.useMemo(function(){return KCe(a)},[a]);return F.createElement(YCe,{styles:JCe(d,!t,a,r?"":"!important")})},hF=!1;if(typeof window<"u")try{var xC=Object.defineProperty({},"passive",{get:function(){return hF=!0,!0}});window.addEventListener("test",xC,xC),window.removeEventListener("test",xC,xC)}catch{hF=!1}var ax=hF?{passive:!1}:!1,tPe=function(e){return e.tagName==="TEXTAREA"},Pne=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!tPe(e)&&r[t]==="visible")},rPe=function(e){return Pne(e,"overflowY")},nPe=function(e){return Pne(e,"overflowX")},oH=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=Nne(e,n);if(a){var d=Ine(e,n),p=d[1],s=d[2];if(p>s)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},iPe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},sPe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},Nne=function(e,t){return e==="v"?rPe(t):nPe(t)},Ine=function(e,t){return e==="v"?iPe(t):sPe(t)},aPe=function(e,t){return e==="h"&&t==="rtl"?-1:1},oPe=function(e,t,r,n,a){var d=aPe(e,window.getComputedStyle(t).direction),p=d*n,s=r.target,_=t.contains(s),b=!1,T=p>0,C=0,P=0;do{if(!s)break;var k=Ine(e,s),B=k[0],R=k[1],D=k[2],G=R-D-d*B;(B||G)&&Nne(e,s)&&(C+=G,P+=B);var V=s.parentNode;s=V&&V.nodeType===Node.DOCUMENT_FRAGMENT_NODE?V.host:V}while(!_&&s!==document.body||_&&(t.contains(s)||t===s));return(T&&Math.abs(C)<1||!T&&Math.abs(P)<1)&&(b=!0),b},bC=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},lH=function(e){return[e.deltaX,e.deltaY]},cH=function(e){return e&&"current"in e?e.current:e},lPe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},cPe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},uPe=0,ox=[];function dPe(e){var t=F.useRef([]),r=F.useRef([0,0]),n=F.useRef(),a=F.useState(uPe++)[0],d=F.useState(Cne)[0],p=F.useRef(e);F.useEffect(function(){p.current=e},[e]),F.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var R=s1e([e.lockRef.current],(e.shards||[]).map(cH),!0).filter(Boolean);return R.forEach(function(D){return D.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),R.forEach(function(D){return D.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var s=F.useCallback(function(R,D){if("touches"in R&&R.touches.length===2||R.type==="wheel"&&R.ctrlKey)return!p.current.allowPinchZoom;var G=bC(R),V=r.current,$="deltaX"in R?R.deltaX:V[0]-G[0],K="deltaY"in R?R.deltaY:V[1]-G[1],Y,ee=R.target,ae=Math.abs($)>Math.abs(K)?"h":"v";if("touches"in R&&ae==="h"&&ee.type==="range")return!1;var ie=oH(ae,ee);if(!ie)return!0;if(ie?Y=ae:(Y=ae==="v"?"h":"v",ie=oH(ae,ee)),!ie)return!1;if(!n.current&&"changedTouches"in R&&($||K)&&(n.current=Y),!Y)return!0;var ge=n.current||Y;return oPe(ge,D,R,ge==="h"?$:K)},[]),_=F.useCallback(function(R){var D=R;if(!(!ox.length||ox[ox.length-1]!==d)){var G="deltaY"in D?lH(D):bC(D),V=t.current.filter(function(Y){return Y.name===D.type&&(Y.target===D.target||D.target===Y.shadowParent)&&lPe(Y.delta,G)})[0];if(V&&V.should){D.cancelable&&D.preventDefault();return}if(!V){var $=(p.current.shards||[]).map(cH).filter(Boolean).filter(function(Y){return Y.contains(D.target)}),K=$.length>0?s(D,$[0]):!p.current.noIsolation;K&&D.cancelable&&D.preventDefault()}}},[]),b=F.useCallback(function(R,D,G,V){var $={name:R,delta:D,target:G,should:V,shadowParent:hPe(G)};t.current.push($),setTimeout(function(){t.current=t.current.filter(function(K){return K!==$})},1)},[]),T=F.useCallback(function(R){r.current=bC(R),n.current=void 0},[]),C=F.useCallback(function(R){b(R.type,lH(R),R.target,s(R,e.lockRef.current))},[]),P=F.useCallback(function(R){b(R.type,bC(R),R.target,s(R,e.lockRef.current))},[]);F.useEffect(function(){return ox.push(d),e.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:P}),document.addEventListener("wheel",_,ax),document.addEventListener("touchmove",_,ax),document.addEventListener("touchstart",T,ax),function(){ox=ox.filter(function(R){return R!==d}),document.removeEventListener("wheel",_,ax),document.removeEventListener("touchmove",_,ax),document.removeEventListener("touchstart",T,ax)}},[]);var k=e.removeScrollBar,B=e.inert;return F.createElement(F.Fragment,null,B?F.createElement(d,{styles:cPe(a)}):null,k?F.createElement(ePe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function hPe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const fPe=$Ce(Ane,dPe);var rk=F.forwardRef(function(e,t){return F.createElement(tk,dh({},e,{ref:t,sideCar:fPe}))});rk.classNames=tk.classNames;var pPe=[" ","Enter","ArrowUp","ArrowDown"],mPe=[" ","Enter"],sv="Select",[nk,ik,gPe]=RI(sv),[wb]=hc(sv,[gPe,yb]),sk=yb(),[yPe,Zm]=wb(sv),[vPe,_Pe]=wb(sv),kne=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:a,onOpenChange:d,value:p,defaultValue:s,onValueChange:_,dir:b,name:T,autoComplete:C,disabled:P,required:k,form:B}=e,R=sk(t),[D,G]=F.useState(null),[V,$]=F.useState(null),[K,Y]=F.useState(!1),ee=QI(b),[ae,ie]=kf({prop:n,defaultProp:a??!1,onChange:d,caller:sv}),[ge,fe]=kf({prop:p,defaultProp:s,onChange:_,caller:sv}),be=F.useRef(null),ue=D?B||!!D.closest("form"):!0,[Ce,ve]=F.useState(new Set),ze=Array.from(Ce).map(Me=>Me.props.value).join(";");return c.jsx($ee,{...R,children:c.jsxs(yPe,{required:k,scope:t,trigger:D,onTriggerChange:G,valueNode:V,onValueNodeChange:$,valueNodeHasChildren:K,onValueNodeHasChildrenChange:Y,contentId:gd(),value:ge,onValueChange:fe,open:ae,onOpenChange:ie,dir:ee,triggerPointerDownPosRef:be,disabled:P,children:[c.jsx(nk.Provider,{scope:t,children:c.jsx(vPe,{scope:e.__scopeSelect,onNativeOptionAdd:F.useCallback(Me=>{ve(Be=>new Set(Be).add(Me))},[]),onNativeOptionRemove:F.useCallback(Me=>{ve(Be=>{const Ve=new Set(Be);return Ve.delete(Me),Ve})},[]),children:r})}),ue?c.jsxs(rie,{"aria-hidden":!0,required:k,tabIndex:-1,name:T,autoComplete:C,value:ge,onChange:Me=>fe(Me.target.value),disabled:P,form:B,children:[ge===void 0?c.jsx("option",{value:""}):null,Array.from(Ce)]},ze):null]})})};kne.displayName=sv;var One="SelectTrigger",Rne=F.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...a}=e,d=sk(r),p=Zm(One,r),s=p.disabled||n,_=Ti(t,p.onTriggerChange),b=ik(r),T=F.useRef("touch"),[C,P,k]=iie(R=>{const D=b().filter($=>!$.disabled),G=D.find($=>$.value===p.value),V=sie(D,R,G);V!==void 0&&p.onValueChange(V.value)}),B=R=>{s||(p.onOpenChange(!0),k()),R&&(p.triggerPointerDownPosRef.current={x:Math.round(R.pageX),y:Math.round(R.pageY)})};return c.jsx(y4,{asChild:!0,...d,children:c.jsx(vn.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":nie(p.value)?"":void 0,...a,ref:_,onClick:Fr(a.onClick,R=>{R.currentTarget.focus(),T.current!=="mouse"&&B(R)}),onPointerDown:Fr(a.onPointerDown,R=>{T.current=R.pointerType;const D=R.target;D.hasPointerCapture(R.pointerId)&&D.releasePointerCapture(R.pointerId),R.button===0&&R.ctrlKey===!1&&R.pointerType==="mouse"&&(B(R),R.preventDefault())}),onKeyDown:Fr(a.onKeyDown,R=>{const D=C.current!=="";!(R.ctrlKey||R.altKey||R.metaKey)&&R.key.length===1&&P(R.key),!(D&&R.key===" ")&&pPe.includes(R.key)&&(B(),R.preventDefault())})})})});Rne.displayName=One;var Mne="SelectValue",Dne=F.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:a,children:d,placeholder:p="",...s}=e,_=Zm(Mne,r),{onValueNodeHasChildrenChange:b}=_,T=d!==void 0,C=Ti(t,_.onValueNodeChange);return Sa(()=>{b(T)},[b,T]),c.jsx(vn.span,{...s,ref:C,style:{pointerEvents:"none"},children:nie(_.value)?c.jsx(c.Fragment,{children:p}):d})});Dne.displayName=Mne;var xPe="SelectIcon",Lne=F.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...a}=e;return c.jsx(vn.span,{"aria-hidden":!0,...a,ref:t,children:n||""})});Lne.displayName=xPe;var bPe="SelectPortal",Fne=e=>c.jsx(L2,{asChild:!0,...e});Fne.displayName=bPe;var av="SelectContent",zne=F.forwardRef((e,t)=>{const r=Zm(av,e.__scopeSelect),[n,a]=F.useState();if(Sa(()=>{a(new DocumentFragment)},[]),!r.open){const d=n;return d?_v.createPortal(c.jsx(Bne,{scope:e.__scopeSelect,children:c.jsx(nk.Slot,{scope:e.__scopeSelect,children:c.jsx("div",{children:e.children})})}),d):null}return c.jsx($ne,{...e,ref:t})});zne.displayName=av;var ed=10,[Bne,Xm]=wb(av),wPe="SelectContentImpl",SPe=tv("SelectContent.RemoveScroll"),$ne=F.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:d,onPointerDownOutside:p,side:s,sideOffset:_,align:b,alignOffset:T,arrowPadding:C,collisionBoundary:P,collisionPadding:k,sticky:B,hideWhenDetached:R,avoidCollisions:D,...G}=e,V=Zm(av,r),[$,K]=F.useState(null),[Y,ee]=F.useState(null),ae=Ti(t,Gt=>K(Gt)),[ie,ge]=F.useState(null),[fe,be]=F.useState(null),ue=ik(r),[Ce,ve]=F.useState(!1),ze=F.useRef(!1);F.useEffect(()=>{if($)return f5($)},[$]),h5();const Me=F.useCallback(Gt=>{const[Pr,...Ot]=ue().map(Et=>Et.ref.current),[nr]=Ot.slice(-1),ur=document.activeElement;for(const Et of Gt)if(Et===ur||(Et==null||Et.scrollIntoView({block:"nearest"}),Et===Pr&&Y&&(Y.scrollTop=0),Et===nr&&Y&&(Y.scrollTop=Y.scrollHeight),Et==null||Et.focus(),document.activeElement!==ur))return},[ue,Y]),Be=F.useCallback(()=>Me([ie,$]),[Me,ie,$]);F.useEffect(()=>{Ce&&Be()},[Ce,Be]);const{onOpenChange:Ve,triggerPointerDownPosRef:We}=V;F.useEffect(()=>{if($){let Gt={x:0,y:0};const Pr=nr=>{var ur,Et;Gt={x:Math.abs(Math.round(nr.pageX)-(((ur=We.current)==null?void 0:ur.x)??0)),y:Math.abs(Math.round(nr.pageY)-(((Et=We.current)==null?void 0:Et.y)??0))}},Ot=nr=>{Gt.x<=10&&Gt.y<=10?nr.preventDefault():$.contains(nr.target)||Ve(!1),document.removeEventListener("pointermove",Pr),We.current=null};return We.current!==null&&(document.addEventListener("pointermove",Pr),document.addEventListener("pointerup",Ot,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Pr),document.removeEventListener("pointerup",Ot,{capture:!0})}}},[$,Ve,We]),F.useEffect(()=>{const Gt=()=>Ve(!1);return window.addEventListener("blur",Gt),window.addEventListener("resize",Gt),()=>{window.removeEventListener("blur",Gt),window.removeEventListener("resize",Gt)}},[Ve]);const[Ee,ot]=iie(Gt=>{const Pr=ue().filter(ur=>!ur.disabled),Ot=Pr.find(ur=>ur.ref.current===document.activeElement),nr=sie(Pr,Gt,Ot);nr&&setTimeout(()=>nr.ref.current.focus())}),yt=F.useCallback((Gt,Pr,Ot)=>{const nr=!ze.current&&!Ot;(V.value!==void 0&&V.value===Pr||nr)&&(ge(Gt),nr&&(ze.current=!0))},[V.value]),Je=F.useCallback(()=>$==null?void 0:$.focus(),[$]),Bt=F.useCallback((Gt,Pr,Ot)=>{const nr=!ze.current&&!Ot;(V.value!==void 0&&V.value===Pr||nr)&&be(Gt)},[V.value]),Pt=n==="popper"?fF:Vne,pt=Pt===fF?{side:s,sideOffset:_,align:b,alignOffset:T,arrowPadding:C,collisionBoundary:P,collisionPadding:k,sticky:B,hideWhenDetached:R,avoidCollisions:D}:{};return c.jsx(Bne,{scope:r,content:$,viewport:Y,onViewportChange:ee,itemRefCallback:yt,selectedItem:ie,onItemLeave:Je,itemTextRefCallback:Bt,focusSelectedItem:Be,selectedItemText:fe,position:n,isPositioned:Ce,searchRef:Ee,children:c.jsx(rk,{as:SPe,allowPinchZoom:!0,children:c.jsx(ek,{asChild:!0,trapped:V.open,onMountAutoFocus:Gt=>{Gt.preventDefault()},onUnmountAutoFocus:Fr(a,Gt=>{var Pr;(Pr=V.trigger)==null||Pr.focus({preventScroll:!0}),Gt.preventDefault()}),children:c.jsx(hb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:Gt=>Gt.preventDefault(),onDismiss:()=>V.onOpenChange(!1),children:c.jsx(Pt,{role:"listbox",id:V.contentId,"data-state":V.open?"open":"closed",dir:V.dir,onContextMenu:Gt=>Gt.preventDefault(),...G,...pt,onPlaced:()=>ve(!0),ref:ae,style:{display:"flex",flexDirection:"column",outline:"none",...G.style},onKeyDown:Fr(G.onKeyDown,Gt=>{const Pr=Gt.ctrlKey||Gt.altKey||Gt.metaKey;if(Gt.key==="Tab"&&Gt.preventDefault(),!Pr&&Gt.key.length===1&&ot(Gt.key),["ArrowUp","ArrowDown","Home","End"].includes(Gt.key)){let nr=ue().filter(ur=>!ur.disabled).map(ur=>ur.ref.current);if(["ArrowUp","End"].includes(Gt.key)&&(nr=nr.slice().reverse()),["ArrowUp","ArrowDown"].includes(Gt.key)){const ur=Gt.target,Et=nr.indexOf(ur);nr=nr.slice(Et+1)}setTimeout(()=>Me(nr)),Gt.preventDefault()}})})})})})})});$ne.displayName=wPe;var TPe="SelectItemAlignedPosition",Vne=F.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...a}=e,d=Zm(av,r),p=Xm(av,r),[s,_]=F.useState(null),[b,T]=F.useState(null),C=Ti(t,ae=>T(ae)),P=ik(r),k=F.useRef(!1),B=F.useRef(!0),{viewport:R,selectedItem:D,selectedItemText:G,focusSelectedItem:V}=p,$=F.useCallback(()=>{if(d.trigger&&d.valueNode&&s&&b&&R&&D&&G){const ae=d.trigger.getBoundingClientRect(),ie=b.getBoundingClientRect(),ge=d.valueNode.getBoundingClientRect(),fe=G.getBoundingClientRect();if(d.dir!=="rtl"){const ur=fe.left-ie.left,Et=ge.left-ur,pr=ae.left-Et,Kr=ae.width+pr,Xn=Math.max(Kr,ie.width),Jn=window.innerWidth-ed,ni=Q9(Et,[ed,Math.max(ed,Jn-Xn)]);s.style.minWidth=Kr+"px",s.style.left=ni+"px"}else{const ur=ie.right-fe.right,Et=window.innerWidth-ge.right-ur,pr=window.innerWidth-ae.right-Et,Kr=ae.width+pr,Xn=Math.max(Kr,ie.width),Jn=window.innerWidth-ed,ni=Q9(Et,[ed,Math.max(ed,Jn-Xn)]);s.style.minWidth=Kr+"px",s.style.right=ni+"px"}const be=P(),ue=window.innerHeight-ed*2,Ce=R.scrollHeight,ve=window.getComputedStyle(b),ze=parseInt(ve.borderTopWidth,10),Me=parseInt(ve.paddingTop,10),Be=parseInt(ve.borderBottomWidth,10),Ve=parseInt(ve.paddingBottom,10),We=ze+Me+Ce+Ve+Be,Ee=Math.min(D.offsetHeight*5,We),ot=window.getComputedStyle(R),yt=parseInt(ot.paddingTop,10),Je=parseInt(ot.paddingBottom,10),Bt=ae.top+ae.height/2-ed,Pt=ue-Bt,pt=D.offsetHeight/2,Gt=D.offsetTop+pt,Pr=ze+Me+Gt,Ot=We-Pr;if(Pr<=Bt){const ur=be.length>0&&D===be[be.length-1].ref.current;s.style.bottom="0px";const Et=b.clientHeight-R.offsetTop-R.offsetHeight,pr=Math.max(Pt,pt+(ur?Je:0)+Et+Be),Kr=Pr+pr;s.style.height=Kr+"px"}else{const ur=be.length>0&&D===be[0].ref.current;s.style.top="0px";const pr=Math.max(Bt,ze+R.offsetTop+(ur?yt:0)+pt)+Ot;s.style.height=pr+"px",R.scrollTop=Pr-Bt+R.offsetTop}s.style.margin=`${ed}px 0`,s.style.minHeight=Ee+"px",s.style.maxHeight=ue+"px",n==null||n(),requestAnimationFrame(()=>k.current=!0)}},[P,d.trigger,d.valueNode,s,b,R,D,G,d.dir,n]);Sa(()=>$(),[$]);const[K,Y]=F.useState();Sa(()=>{b&&Y(window.getComputedStyle(b).zIndex)},[b]);const ee=F.useCallback(ae=>{ae&&B.current===!0&&($(),V==null||V(),B.current=!1)},[$,V]);return c.jsx(jPe,{scope:r,contentWrapper:s,shouldExpandOnScrollRef:k,onScrollButtonChange:ee,children:c.jsx("div",{ref:_,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:K},children:c.jsx(vn.div,{...a,ref:C,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});Vne.displayName=TPe;var EPe="SelectPopperPosition",fF=F.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:a=ed,...d}=e,p=sk(r);return c.jsx(v4,{...p,...d,ref:t,align:n,collisionPadding:a,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});fF.displayName=EPe;var[jPe,p5]=wb(av,{}),pF="SelectViewport",Une=F.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...a}=e,d=Xm(pF,r),p=p5(pF,r),s=Ti(t,d.onViewportChange),_=F.useRef(0);return c.jsxs(c.Fragment,{children:[c.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),c.jsx(nk.Slot,{scope:r,children:c.jsx(vn.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:Fr(a.onScroll,b=>{const T=b.currentTarget,{contentWrapper:C,shouldExpandOnScrollRef:P}=p;if(P!=null&&P.current&&C){const k=Math.abs(_.current-T.scrollTop);if(k>0){const B=window.innerHeight-ed*2,R=parseFloat(C.style.minHeight),D=parseFloat(C.style.height),G=Math.max(R,D);if(G<B){const V=G+k,$=Math.min(B,V),K=V-$;C.style.height=$+"px",C.style.bottom==="0px"&&(T.scrollTop=K>0?K:0,C.style.justifyContent="flex-end")}}}_.current=T.scrollTop})})})]})});Une.displayName=pF;var qne="SelectGroup",[APe,CPe]=wb(qne),PPe=F.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,a=gd();return c.jsx(APe,{scope:r,id:a,children:c.jsx(vn.div,{role:"group","aria-labelledby":a,...n,ref:t})})});PPe.displayName=qne;var Gne="SelectLabel",Wne=F.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,a=CPe(Gne,r);return c.jsx(vn.div,{id:a.id,...n,ref:t})});Wne.displayName=Gne;var KP="SelectItem",[NPe,Hne]=wb(KP),Zne=F.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:a=!1,textValue:d,...p}=e,s=Zm(KP,r),_=Xm(KP,r),b=s.value===n,[T,C]=F.useState(d??""),[P,k]=F.useState(!1),B=Ti(t,V=>{var $;return($=_.itemRefCallback)==null?void 0:$.call(_,V,n,a)}),R=gd(),D=F.useRef("touch"),G=()=>{a||(s.onValueChange(n),s.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return c.jsx(NPe,{scope:r,value:n,disabled:a,textId:R,isSelected:b,onItemTextChange:F.useCallback(V=>{C($=>$||((V==null?void 0:V.textContent)??"").trim())},[]),children:c.jsx(nk.ItemSlot,{scope:r,value:n,disabled:a,textValue:T,children:c.jsx(vn.div,{role:"option","aria-labelledby":R,"data-highlighted":P?"":void 0,"aria-selected":b&&P,"data-state":b?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...p,ref:B,onFocus:Fr(p.onFocus,()=>k(!0)),onBlur:Fr(p.onBlur,()=>k(!1)),onClick:Fr(p.onClick,()=>{D.current!=="mouse"&&G()}),onPointerUp:Fr(p.onPointerUp,()=>{D.current==="mouse"&&G()}),onPointerDown:Fr(p.onPointerDown,V=>{D.current=V.pointerType}),onPointerMove:Fr(p.onPointerMove,V=>{var $;D.current=V.pointerType,a?($=_.onItemLeave)==null||$.call(_):D.current==="mouse"&&V.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Fr(p.onPointerLeave,V=>{var $;V.currentTarget===document.activeElement&&(($=_.onItemLeave)==null||$.call(_))}),onKeyDown:Fr(p.onKeyDown,V=>{var K;((K=_.searchRef)==null?void 0:K.current)!==""&&V.key===" "||(mPe.includes(V.key)&&G(),V.key===" "&&V.preventDefault())})})})})});Zne.displayName=KP;var ES="SelectItemText",Xne=F.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:a,...d}=e,p=Zm(ES,r),s=Xm(ES,r),_=Hne(ES,r),b=_Pe(ES,r),[T,C]=F.useState(null),P=Ti(t,G=>C(G),_.onItemTextChange,G=>{var V;return(V=s.itemTextRefCallback)==null?void 0:V.call(s,G,_.value,_.disabled)}),k=T==null?void 0:T.textContent,B=F.useMemo(()=>c.jsx("option",{value:_.value,disabled:_.disabled,children:k},_.value),[_.disabled,_.value,k]),{onNativeOptionAdd:R,onNativeOptionRemove:D}=b;return Sa(()=>(R(B),()=>D(B)),[R,D,B]),c.jsxs(c.Fragment,{children:[c.jsx(vn.span,{id:_.textId,...d,ref:P}),_.isSelected&&p.valueNode&&!p.valueNodeHasChildren?_v.createPortal(d.children,p.valueNode):null]})});Xne.displayName=ES;var Kne="SelectItemIndicator",Yne=F.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return Hne(Kne,r).isSelected?c.jsx(vn.span,{"aria-hidden":!0,...n,ref:t}):null});Yne.displayName=Kne;var mF="SelectScrollUpButton",Jne=F.forwardRef((e,t)=>{const r=Xm(mF,e.__scopeSelect),n=p5(mF,e.__scopeSelect),[a,d]=F.useState(!1),p=Ti(t,n.onScrollButtonChange);return Sa(()=>{if(r.viewport&&r.isPositioned){let s=function(){const b=_.scrollTop>0;d(b)};const _=r.viewport;return s(),_.addEventListener("scroll",s),()=>_.removeEventListener("scroll",s)}},[r.viewport,r.isPositioned]),a?c.jsx(eie,{...e,ref:p,onAutoScroll:()=>{const{viewport:s,selectedItem:_}=r;s&&_&&(s.scrollTop=s.scrollTop-_.offsetHeight)}}):null});Jne.displayName=mF;var gF="SelectScrollDownButton",Qne=F.forwardRef((e,t)=>{const r=Xm(gF,e.__scopeSelect),n=p5(gF,e.__scopeSelect),[a,d]=F.useState(!1),p=Ti(t,n.onScrollButtonChange);return Sa(()=>{if(r.viewport&&r.isPositioned){let s=function(){const b=_.scrollHeight-_.clientHeight,T=Math.ceil(_.scrollTop)<b;d(T)};const _=r.viewport;return s(),_.addEventListener("scroll",s),()=>_.removeEventListener("scroll",s)}},[r.viewport,r.isPositioned]),a?c.jsx(eie,{...e,ref:p,onAutoScroll:()=>{const{viewport:s,selectedItem:_}=r;s&&_&&(s.scrollTop=s.scrollTop+_.offsetHeight)}}):null});Qne.displayName=gF;var eie=F.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...a}=e,d=Xm("SelectScrollButton",r),p=F.useRef(null),s=ik(r),_=F.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return F.useEffect(()=>()=>_(),[_]),Sa(()=>{var T;const b=s().find(C=>C.ref.current===document.activeElement);(T=b==null?void 0:b.ref.current)==null||T.scrollIntoView({block:"nearest"})},[s]),c.jsx(vn.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:Fr(a.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(n,50))}),onPointerMove:Fr(a.onPointerMove,()=>{var b;(b=d.onItemLeave)==null||b.call(d),p.current===null&&(p.current=window.setInterval(n,50))}),onPointerLeave:Fr(a.onPointerLeave,()=>{_()})})}),IPe="SelectSeparator",tie=F.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return c.jsx(vn.div,{"aria-hidden":!0,...n,ref:t})});tie.displayName=IPe;var yF="SelectArrow",kPe=F.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,a=sk(r),d=Zm(yF,r),p=Xm(yF,r);return d.open&&p.position==="popper"?c.jsx(_4,{...a,...n,ref:t}):null});kPe.displayName=yF;var OPe="SelectBubbleInput",rie=F.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const a=F.useRef(null),d=Ti(n,a),p=Tne(t);return F.useEffect(()=>{const s=a.current;if(!s)return;const _=window.HTMLSelectElement.prototype,T=Object.getOwnPropertyDescriptor(_,"value").set;if(p!==t&&T){const C=new Event("change",{bubbles:!0});T.call(s,t),s.dispatchEvent(C)}},[p,t]),c.jsx(vn.select,{...r,style:{...MQ,...r.style},ref:d,defaultValue:t})});rie.displayName=OPe;function nie(e){return e===""||e===void 0}function iie(e){const t=Bl(e),r=F.useRef(""),n=F.useRef(0),a=F.useCallback(p=>{const s=r.current+p;t(s),function _(b){r.current=b,window.clearTimeout(n.current),b!==""&&(n.current=window.setTimeout(()=>_(""),1e3))}(s)},[t]),d=F.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return F.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,a,d]}function sie(e,t,r){const a=t.length>1&&Array.from(t).every(b=>b===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let p=RPe(e,Math.max(d,0));a.length===1&&(p=p.filter(b=>b!==r));const _=p.find(b=>b.textValue.toLowerCase().startsWith(a.toLowerCase()));return _!==r?_:void 0}function RPe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var MPe=kne,aie=Rne,DPe=Dne,LPe=Lne,FPe=Fne,oie=zne,zPe=Une,lie=Wne,cie=Zne,BPe=Xne,$Pe=Yne,uie=Jne,die=Qne,hie=tie;const ns=MPe,is=DPe,Ji=F.forwardRef(({className:e,children:t,...r},n)=>c.jsxs(aie,{ref:n,className:Dr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,c.jsx(LPe,{asChild:!0,children:c.jsx(i4,{className:"h-4 w-4 opacity-50"})})]}));Ji.displayName=aie.displayName;const fie=F.forwardRef(({className:e,...t},r)=>c.jsx(uie,{ref:r,className:Dr("flex cursor-default items-center justify-center py-1",e),...t,children:c.jsx(Dve,{className:"h-4 w-4"})}));fie.displayName=uie.displayName;const pie=F.forwardRef(({className:e,...t},r)=>c.jsx(die,{ref:r,className:Dr("flex cursor-default items-center justify-center py-1",e),...t,children:c.jsx(i4,{className:"h-4 w-4"})}));pie.displayName=die.displayName;const Qi=F.forwardRef(({className:e,children:t,position:r="popper",...n},a)=>c.jsx(FPe,{children:c.jsxs(oie,{ref:a,className:Dr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[c.jsx(fie,{}),c.jsx(zPe,{className:Dr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),c.jsx(pie,{})]})}));Qi.displayName=oie.displayName;const VPe=F.forwardRef(({className:e,...t},r)=>c.jsx(lie,{ref:r,className:Dr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));VPe.displayName=lie.displayName;const sn=F.forwardRef(({className:e,children:t,...r},n)=>c.jsxs(cie,{ref:n,className:Dr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx($Pe,{children:c.jsx(w0,{className:"h-4 w-4"})})}),c.jsx(BPe,{children:t})]}));sn.displayName=cie.displayName;const UPe=F.forwardRef(({className:e,...t},r)=>c.jsx(hie,{ref:r,className:Dr("-mx-1 my-1 h-px bg-muted",e),...t}));UPe.displayName=hie.displayName;const uH=()=>{const{cities:e,selectedCityId:t,setSelectedCityId:r,isLoading:n}=H2();return n?c.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-muted",children:[c.jsx(zi,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"text-sm text-muted-foreground",children:"Carregando..."})]}):e.length===0?c.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-muted",children:[c.jsx(zi,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"text-sm text-muted-foreground",children:"Nenhuma cidade disponvel"})]}):c.jsxs(ns,{value:t||void 0,onValueChange:r,children:[c.jsxs(Ji,{className:"w-auto min-w-[160px] max-w-[220px] gap-2 rounded-full bg-muted border-0 hover:bg-accent transition-colors",children:[c.jsx(zi,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx(is,{placeholder:"Selecione a cidade"})]}),c.jsx(Qi,{children:e.map(a=>c.jsxs(sn,{value:a.id,children:[a.name," - ",a.state]},a.id))})]})},$i=()=>{const[e,t]=F.useState({user:null,session:null,loading:!0,isEstablishment:!1,isAdmin:!1,isDriver:!1,isDriverApproved:!1,driverRejectionReason:null,driverRegistrationSubmittedAt:null,driverIdPhotoUrl:null});return F.useEffect(()=>{const n=async p=>{const{data:s}=await dt.from("user_roles").select("role").eq("user_id",p),{data:_}=await dt.from("profiles").select("is_driver_approved, driver_rejection_reason, driver_registration_submitted_at, driver_id_photo_url").eq("user_id",p).maybeSingle();return{isEstablishment:(s==null?void 0:s.some(b=>b.role==="establishment"))??!1,isAdmin:(s==null?void 0:s.some(b=>b.role==="admin"))??!1,isDriver:(s==null?void 0:s.some(b=>b.role==="driver"))??!1,isDriverApproved:(_==null?void 0:_.is_driver_approved)??!1,driverRejectionReason:(_==null?void 0:_.driver_rejection_reason)??null,driverRegistrationSubmittedAt:(_==null?void 0:_.driver_registration_submitted_at)??null,driverIdPhotoUrl:(_==null?void 0:_.driver_id_photo_url)??null}};(async()=>{const{data:{session:p}}=await dt.auth.getSession(),s=(p==null?void 0:p.user)??null;if(s){const _=await n(s.id);t({user:s,session:p,loading:!1,..._})}else t({user:null,session:null,loading:!1,isEstablishment:!1,isAdmin:!1,isDriver:!1,isDriverApproved:!1,driverRejectionReason:null,driverRegistrationSubmittedAt:null,driverIdPhotoUrl:null})})();const{data:{subscription:d}}=dt.auth.onAuthStateChange(async(p,s)=>{const _=(s==null?void 0:s.user)??null;_?setTimeout(async()=>{const b=await n(_.id);t({user:_,session:s,loading:!1,...b})},0):t({user:null,session:null,loading:!1,isEstablishment:!1,isAdmin:!1,isDriver:!1,isDriverApproved:!1,driverRejectionReason:null,driverRegistrationSubmittedAt:null,driverIdPhotoUrl:null})});return()=>{d.unsubscribe()}},[]),{...e,signOut:async()=>{await dt.auth.signOut()}}};var mie={exports:{}},gie={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0=F;function qPe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var GPe=typeof Object.is=="function"?Object.is:qPe,WPe=N0.useState,HPe=N0.useEffect,ZPe=N0.useLayoutEffect,XPe=N0.useDebugValue;function KPe(e,t){var r=t(),n=WPe({inst:{value:r,getSnapshot:t}}),a=n[0].inst,d=n[1];return ZPe(function(){a.value=r,a.getSnapshot=t,ND(a)&&d({inst:a})},[e,r,t]),HPe(function(){return ND(a)&&d({inst:a}),e(function(){ND(a)&&d({inst:a})})},[e]),XPe(r),r}function ND(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!GPe(e,r)}catch{return!0}}function YPe(e,t){return t()}var JPe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?YPe:KPe;gie.useSyncExternalStore=N0.useSyncExternalStore!==void 0?N0.useSyncExternalStore:JPe;mie.exports=gie;var QPe=mie.exports;function eNe(){return QPe.useSyncExternalStore(tNe,()=>!0,()=>!1)}function tNe(){return()=>{}}var m5="Avatar",[rNe]=hc(m5),[nNe,yie]=rNe(m5),vie=F.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[a,d]=F.useState("idle");return c.jsx(nNe,{scope:r,imageLoadingStatus:a,onImageLoadingStatusChange:d,children:c.jsx(vn.span,{...n,ref:t})})});vie.displayName=m5;var _ie="AvatarImage",xie=F.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:a=()=>{},...d}=e,p=yie(_ie,r),s=iNe(n,d),_=Bl(b=>{a(b),p.onImageLoadingStatusChange(b)});return Sa(()=>{s!=="idle"&&_(s)},[s,_]),s==="loaded"?c.jsx(vn.img,{...d,ref:t,src:n}):null});xie.displayName=_ie;var bie="AvatarFallback",wie=F.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...a}=e,d=yie(bie,r),[p,s]=F.useState(n===void 0);return F.useEffect(()=>{if(n!==void 0){const _=window.setTimeout(()=>s(!0),n);return()=>window.clearTimeout(_)}},[n]),p&&d.imageLoadingStatus!=="loaded"?c.jsx(vn.span,{...a,ref:t}):null});wie.displayName=bie;function dH(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function iNe(e,{referrerPolicy:t,crossOrigin:r}){const n=eNe(),a=F.useRef(null),d=n?(a.current||(a.current=new window.Image),a.current):null,[p,s]=F.useState(()=>dH(d,e));return Sa(()=>{s(dH(d,e))},[d,e]),Sa(()=>{const _=C=>()=>{s(C)};if(!d)return;const b=_("loaded"),T=_("error");return d.addEventListener("load",b),d.addEventListener("error",T),t&&(d.referrerPolicy=t),typeof r=="string"&&(d.crossOrigin=r),()=>{d.removeEventListener("load",b),d.removeEventListener("error",T)}},[d,r,t]),p}var Sie=vie,Tie=xie,Eie=wie;const YP=F.forwardRef(({className:e,...t},r)=>c.jsx(Sie,{ref:r,className:Dr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));YP.displayName=Sie.displayName;const vF=F.forwardRef(({className:e,...t},r)=>c.jsx(Tie,{ref:r,className:Dr("aspect-square h-full w-full",e),...t}));vF.displayName=Tie.displayName;const JP=F.forwardRef(({className:e,...t},r)=>c.jsx(Eie,{ref:r,className:Dr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));JP.displayName=Eie.displayName;var ID="rovingFocusGroup.onEntryFocus",sNe={bubbles:!1,cancelable:!0},J2="RovingFocusGroup",[_F,jie,aNe]=RI(J2),[oNe,ak]=hc(J2,[aNe]),[lNe,cNe]=oNe(J2),Aie=F.forwardRef((e,t)=>c.jsx(_F.Provider,{scope:e.__scopeRovingFocusGroup,children:c.jsx(_F.Slot,{scope:e.__scopeRovingFocusGroup,children:c.jsx(uNe,{...e,ref:t})})}));Aie.displayName=J2;var uNe=F.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:d,currentTabStopId:p,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:_,onEntryFocus:b,preventScrollOnEntryFocus:T=!1,...C}=e,P=F.useRef(null),k=Ti(t,P),B=QI(d),[R,D]=kf({prop:p,defaultProp:s??null,onChange:_,caller:J2}),[G,V]=F.useState(!1),$=Bl(b),K=jie(r),Y=F.useRef(!1),[ee,ae]=F.useState(0);return F.useEffect(()=>{const ie=P.current;if(ie)return ie.addEventListener(ID,$),()=>ie.removeEventListener(ID,$)},[$]),c.jsx(lNe,{scope:r,orientation:n,dir:B,loop:a,currentTabStopId:R,onItemFocus:F.useCallback(ie=>D(ie),[D]),onItemShiftTab:F.useCallback(()=>V(!0),[]),onFocusableItemAdd:F.useCallback(()=>ae(ie=>ie+1),[]),onFocusableItemRemove:F.useCallback(()=>ae(ie=>ie-1),[]),children:c.jsx(vn.div,{tabIndex:G||ee===0?-1:0,"data-orientation":n,...C,ref:k,style:{outline:"none",...e.style},onMouseDown:Fr(e.onMouseDown,()=>{Y.current=!0}),onFocus:Fr(e.onFocus,ie=>{const ge=!Y.current;if(ie.target===ie.currentTarget&&ge&&!G){const fe=new CustomEvent(ID,sNe);if(ie.currentTarget.dispatchEvent(fe),!fe.defaultPrevented){const be=K().filter(Me=>Me.focusable),ue=be.find(Me=>Me.active),Ce=be.find(Me=>Me.id===R),ze=[ue,Ce,...be].filter(Boolean).map(Me=>Me.ref.current);Nie(ze,T)}}Y.current=!1}),onBlur:Fr(e.onBlur,()=>V(!1))})})}),Cie="RovingFocusGroupItem",Pie=F.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:a=!1,tabStopId:d,children:p,...s}=e,_=gd(),b=d||_,T=cNe(Cie,r),C=T.currentTabStopId===b,P=jie(r),{onFocusableItemAdd:k,onFocusableItemRemove:B,currentTabStopId:R}=T;return F.useEffect(()=>{if(n)return k(),()=>B()},[n,k,B]),c.jsx(_F.ItemSlot,{scope:r,id:b,focusable:n,active:a,children:c.jsx(vn.span,{tabIndex:C?0:-1,"data-orientation":T.orientation,...s,ref:t,onMouseDown:Fr(e.onMouseDown,D=>{n?T.onItemFocus(b):D.preventDefault()}),onFocus:Fr(e.onFocus,()=>T.onItemFocus(b)),onKeyDown:Fr(e.onKeyDown,D=>{if(D.key==="Tab"&&D.shiftKey){T.onItemShiftTab();return}if(D.target!==D.currentTarget)return;const G=fNe(D,T.orientation,T.dir);if(G!==void 0){if(D.metaKey||D.ctrlKey||D.altKey||D.shiftKey)return;D.preventDefault();let $=P().filter(K=>K.focusable).map(K=>K.ref.current);if(G==="last")$.reverse();else if(G==="prev"||G==="next"){G==="prev"&&$.reverse();const K=$.indexOf(D.currentTarget);$=T.loop?pNe($,K+1):$.slice(K+1)}setTimeout(()=>Nie($))}}),children:typeof p=="function"?p({isCurrentTabStop:C,hasTabStop:R!=null}):p})})});Pie.displayName=Cie;var dNe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function hNe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function fNe(e,t,r){const n=hNe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return dNe[n]}function Nie(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function pNe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Iie=Aie,kie=Pie,xF=["Enter"," "],mNe=["ArrowDown","PageUp","Home"],Oie=["ArrowUp","PageDown","End"],gNe=[...mNe,...Oie],yNe={ltr:[...xF,"ArrowRight"],rtl:[...xF,"ArrowLeft"]},vNe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Q2="Menu",[VT,_Ne,xNe]=RI(Q2),[Sv,Rie]=hc(Q2,[xNe,yb,ak]),ok=yb(),Mie=ak(),[bNe,Tv]=Sv(Q2),[wNe,eE]=Sv(Q2),Die=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:a,onOpenChange:d,modal:p=!0}=e,s=ok(t),[_,b]=F.useState(null),T=F.useRef(!1),C=Bl(d),P=QI(a);return F.useEffect(()=>{const k=()=>{T.current=!0,document.addEventListener("pointerdown",B,{capture:!0,once:!0}),document.addEventListener("pointermove",B,{capture:!0,once:!0})},B=()=>T.current=!1;return document.addEventListener("keydown",k,{capture:!0}),()=>{document.removeEventListener("keydown",k,{capture:!0}),document.removeEventListener("pointerdown",B,{capture:!0}),document.removeEventListener("pointermove",B,{capture:!0})}},[]),c.jsx($ee,{...s,children:c.jsx(bNe,{scope:t,open:r,onOpenChange:C,content:_,onContentChange:b,children:c.jsx(wNe,{scope:t,onClose:F.useCallback(()=>C(!1),[C]),isUsingKeyboardRef:T,dir:P,modal:p,children:n})})})};Die.displayName=Q2;var SNe="MenuAnchor",g5=F.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,a=ok(r);return c.jsx(y4,{...a,...n,ref:t})});g5.displayName=SNe;var y5="MenuPortal",[TNe,Lie]=Sv(y5,{forceMount:void 0}),Fie=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:a}=e,d=Tv(y5,t);return c.jsx(TNe,{scope:t,forceMount:r,children:c.jsx(Cu,{present:r||d.open,children:c.jsx(L2,{asChild:!0,container:a,children:n})})})};Fie.displayName=y5;var Su="MenuContent",[ENe,v5]=Sv(Su),zie=F.forwardRef((e,t)=>{const r=Lie(Su,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,d=Tv(Su,e.__scopeMenu),p=eE(Su,e.__scopeMenu);return c.jsx(VT.Provider,{scope:e.__scopeMenu,children:c.jsx(Cu,{present:n||d.open,children:c.jsx(VT.Slot,{scope:e.__scopeMenu,children:p.modal?c.jsx(jNe,{...a,ref:t}):c.jsx(ANe,{...a,ref:t})})})})}),jNe=F.forwardRef((e,t)=>{const r=Tv(Su,e.__scopeMenu),n=F.useRef(null),a=Ti(t,n);return F.useEffect(()=>{const d=n.current;if(d)return f5(d)},[]),c.jsx(_5,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Fr(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),ANe=F.forwardRef((e,t)=>{const r=Tv(Su,e.__scopeMenu);return c.jsx(_5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),CNe=tv("MenuContent.ScrollLock"),_5=F.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:p,disableOutsidePointerEvents:s,onEntryFocus:_,onEscapeKeyDown:b,onPointerDownOutside:T,onFocusOutside:C,onInteractOutside:P,onDismiss:k,disableOutsideScroll:B,...R}=e,D=Tv(Su,r),G=eE(Su,r),V=ok(r),$=Mie(r),K=_Ne(r),[Y,ee]=F.useState(null),ae=F.useRef(null),ie=Ti(t,ae,D.onContentChange),ge=F.useRef(0),fe=F.useRef(""),be=F.useRef(0),ue=F.useRef(null),Ce=F.useRef("right"),ve=F.useRef(0),ze=B?rk:F.Fragment,Me=B?{as:CNe,allowPinchZoom:!0}:void 0,Be=We=>{var Gt,Pr;const Ee=fe.current+We,ot=K().filter(Ot=>!Ot.disabled),yt=document.activeElement,Je=(Gt=ot.find(Ot=>Ot.ref.current===yt))==null?void 0:Gt.textValue,Bt=ot.map(Ot=>Ot.textValue),Pt=BNe(Bt,Ee,Je),pt=(Pr=ot.find(Ot=>Ot.textValue===Pt))==null?void 0:Pr.ref.current;(function Ot(nr){fe.current=nr,window.clearTimeout(ge.current),nr!==""&&(ge.current=window.setTimeout(()=>Ot(""),1e3))})(Ee),pt&&setTimeout(()=>pt.focus())};F.useEffect(()=>()=>window.clearTimeout(ge.current),[]),h5();const Ve=F.useCallback(We=>{var ot,yt;return Ce.current===((ot=ue.current)==null?void 0:ot.side)&&VNe(We,(yt=ue.current)==null?void 0:yt.area)},[]);return c.jsx(ENe,{scope:r,searchRef:fe,onItemEnter:F.useCallback(We=>{Ve(We)&&We.preventDefault()},[Ve]),onItemLeave:F.useCallback(We=>{var Ee;Ve(We)||((Ee=ae.current)==null||Ee.focus(),ee(null))},[Ve]),onTriggerLeave:F.useCallback(We=>{Ve(We)&&We.preventDefault()},[Ve]),pointerGraceTimerRef:be,onPointerGraceIntentChange:F.useCallback(We=>{ue.current=We},[]),children:c.jsx(ze,{...Me,children:c.jsx(ek,{asChild:!0,trapped:a,onMountAutoFocus:Fr(d,We=>{var Ee;We.preventDefault(),(Ee=ae.current)==null||Ee.focus({preventScroll:!0})}),onUnmountAutoFocus:p,children:c.jsx(hb,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:b,onPointerDownOutside:T,onFocusOutside:C,onInteractOutside:P,onDismiss:k,children:c.jsx(Iie,{asChild:!0,...$,dir:G.dir,orientation:"vertical",loop:n,currentTabStopId:Y,onCurrentTabStopIdChange:ee,onEntryFocus:Fr(_,We=>{G.isUsingKeyboardRef.current||We.preventDefault()}),preventScrollOnEntryFocus:!0,children:c.jsx(v4,{role:"menu","aria-orientation":"vertical","data-state":tse(D.open),"data-radix-menu-content":"",dir:G.dir,...V,...R,ref:ie,style:{outline:"none",...R.style},onKeyDown:Fr(R.onKeyDown,We=>{const ot=We.target.closest("[data-radix-menu-content]")===We.currentTarget,yt=We.ctrlKey||We.altKey||We.metaKey,Je=We.key.length===1;ot&&(We.key==="Tab"&&We.preventDefault(),!yt&&Je&&Be(We.key));const Bt=ae.current;if(We.target!==Bt||!gNe.includes(We.key))return;We.preventDefault();const pt=K().filter(Gt=>!Gt.disabled).map(Gt=>Gt.ref.current);Oie.includes(We.key)&&pt.reverse(),FNe(pt)}),onBlur:Fr(e.onBlur,We=>{We.currentTarget.contains(We.target)||(window.clearTimeout(ge.current),fe.current="")}),onPointerMove:Fr(e.onPointerMove,UT(We=>{const Ee=We.target,ot=ve.current!==We.clientX;if(We.currentTarget.contains(Ee)&&ot){const yt=We.clientX>ve.current?"right":"left";Ce.current=yt,ve.current=We.clientX}}))})})})})})})});zie.displayName=Su;var PNe="MenuGroup",x5=F.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return c.jsx(vn.div,{role:"group",...n,ref:t})});x5.displayName=PNe;var NNe="MenuLabel",Bie=F.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return c.jsx(vn.div,{...n,ref:t})});Bie.displayName=NNe;var QP="MenuItem",hH="menu.itemSelect",lk=F.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...a}=e,d=F.useRef(null),p=eE(QP,e.__scopeMenu),s=v5(QP,e.__scopeMenu),_=Ti(t,d),b=F.useRef(!1),T=()=>{const C=d.current;if(!r&&C){const P=new CustomEvent(hH,{bubbles:!0,cancelable:!0});C.addEventListener(hH,k=>n==null?void 0:n(k),{once:!0}),QB(C,P),P.defaultPrevented?b.current=!1:p.onClose()}};return c.jsx($ie,{...a,ref:_,disabled:r,onClick:Fr(e.onClick,T),onPointerDown:C=>{var P;(P=e.onPointerDown)==null||P.call(e,C),b.current=!0},onPointerUp:Fr(e.onPointerUp,C=>{var P;b.current||(P=C.currentTarget)==null||P.click()}),onKeyDown:Fr(e.onKeyDown,C=>{const P=s.searchRef.current!=="";r||P&&C.key===" "||xF.includes(C.key)&&(C.currentTarget.click(),C.preventDefault())})})});lk.displayName=QP;var $ie=F.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:a,...d}=e,p=v5(QP,r),s=Mie(r),_=F.useRef(null),b=Ti(t,_),[T,C]=F.useState(!1),[P,k]=F.useState("");return F.useEffect(()=>{const B=_.current;B&&k((B.textContent??"").trim())},[d.children]),c.jsx(VT.ItemSlot,{scope:r,disabled:n,textValue:a??P,children:c.jsx(kie,{asChild:!0,...s,focusable:!n,children:c.jsx(vn.div,{role:"menuitem","data-highlighted":T?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...d,ref:b,onPointerMove:Fr(e.onPointerMove,UT(B=>{n?p.onItemLeave(B):(p.onItemEnter(B),B.defaultPrevented||B.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Fr(e.onPointerLeave,UT(B=>p.onItemLeave(B))),onFocus:Fr(e.onFocus,()=>C(!0)),onBlur:Fr(e.onBlur,()=>C(!1))})})})}),INe="MenuCheckboxItem",Vie=F.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...a}=e;return c.jsx(Hie,{scope:e.__scopeMenu,checked:r,children:c.jsx(lk,{role:"menuitemcheckbox","aria-checked":eN(r)?"mixed":r,...a,ref:t,"data-state":w5(r),onSelect:Fr(a.onSelect,()=>n==null?void 0:n(eN(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Vie.displayName=INe;var Uie="MenuRadioGroup",[kNe,ONe]=Sv(Uie,{value:void 0,onValueChange:()=>{}}),qie=F.forwardRef((e,t)=>{const{value:r,onValueChange:n,...a}=e,d=Bl(n);return c.jsx(kNe,{scope:e.__scopeMenu,value:r,onValueChange:d,children:c.jsx(x5,{...a,ref:t})})});qie.displayName=Uie;var Gie="MenuRadioItem",Wie=F.forwardRef((e,t)=>{const{value:r,...n}=e,a=ONe(Gie,e.__scopeMenu),d=r===a.value;return c.jsx(Hie,{scope:e.__scopeMenu,checked:d,children:c.jsx(lk,{role:"menuitemradio","aria-checked":d,...n,ref:t,"data-state":w5(d),onSelect:Fr(n.onSelect,()=>{var p;return(p=a.onValueChange)==null?void 0:p.call(a,r)},{checkForDefaultPrevented:!1})})})});Wie.displayName=Gie;var b5="MenuItemIndicator",[Hie,RNe]=Sv(b5,{checked:!1}),Zie=F.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...a}=e,d=RNe(b5,r);return c.jsx(Cu,{present:n||eN(d.checked)||d.checked===!0,children:c.jsx(vn.span,{...a,ref:t,"data-state":w5(d.checked)})})});Zie.displayName=b5;var MNe="MenuSeparator",Xie=F.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return c.jsx(vn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});Xie.displayName=MNe;var DNe="MenuArrow",Kie=F.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,a=ok(r);return c.jsx(_4,{...a,...n,ref:t})});Kie.displayName=DNe;var LNe="MenuSub",[Lit,Yie]=Sv(LNe),jS="MenuSubTrigger",Jie=F.forwardRef((e,t)=>{const r=Tv(jS,e.__scopeMenu),n=eE(jS,e.__scopeMenu),a=Yie(jS,e.__scopeMenu),d=v5(jS,e.__scopeMenu),p=F.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:_}=d,b={__scopeMenu:e.__scopeMenu},T=F.useCallback(()=>{p.current&&window.clearTimeout(p.current),p.current=null},[]);return F.useEffect(()=>T,[T]),F.useEffect(()=>{const C=s.current;return()=>{window.clearTimeout(C),_(null)}},[s,_]),c.jsx(g5,{asChild:!0,...b,children:c.jsx($ie,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":tse(r.open),...e,ref:OI(t,a.onTriggerChange),onClick:C=>{var P;(P=e.onClick)==null||P.call(e,C),!(e.disabled||C.defaultPrevented)&&(C.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Fr(e.onPointerMove,UT(C=>{d.onItemEnter(C),!C.defaultPrevented&&!e.disabled&&!r.open&&!p.current&&(d.onPointerGraceIntentChange(null),p.current=window.setTimeout(()=>{r.onOpenChange(!0),T()},100))})),onPointerLeave:Fr(e.onPointerLeave,UT(C=>{var k,B;T();const P=(k=r.content)==null?void 0:k.getBoundingClientRect();if(P){const R=(B=r.content)==null?void 0:B.dataset.side,D=R==="right",G=D?-5:5,V=P[D?"left":"right"],$=P[D?"right":"left"];d.onPointerGraceIntentChange({area:[{x:C.clientX+G,y:C.clientY},{x:V,y:P.top},{x:$,y:P.top},{x:$,y:P.bottom},{x:V,y:P.bottom}],side:R}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>d.onPointerGraceIntentChange(null),300)}else{if(d.onTriggerLeave(C),C.defaultPrevented)return;d.onPointerGraceIntentChange(null)}})),onKeyDown:Fr(e.onKeyDown,C=>{var k;const P=d.searchRef.current!=="";e.disabled||P&&C.key===" "||yNe[n.dir].includes(C.key)&&(r.onOpenChange(!0),(k=r.content)==null||k.focus(),C.preventDefault())})})})});Jie.displayName=jS;var Qie="MenuSubContent",ese=F.forwardRef((e,t)=>{const r=Lie(Su,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,d=Tv(Su,e.__scopeMenu),p=eE(Su,e.__scopeMenu),s=Yie(Qie,e.__scopeMenu),_=F.useRef(null),b=Ti(t,_);return c.jsx(VT.Provider,{scope:e.__scopeMenu,children:c.jsx(Cu,{present:n||d.open,children:c.jsx(VT.Slot,{scope:e.__scopeMenu,children:c.jsx(_5,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:b,align:"start",side:p.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:T=>{var C;p.isUsingKeyboardRef.current&&((C=_.current)==null||C.focus()),T.preventDefault()},onCloseAutoFocus:T=>T.preventDefault(),onFocusOutside:Fr(e.onFocusOutside,T=>{T.target!==s.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:Fr(e.onEscapeKeyDown,T=>{p.onClose(),T.preventDefault()}),onKeyDown:Fr(e.onKeyDown,T=>{var k;const C=T.currentTarget.contains(T.target),P=vNe[p.dir].includes(T.key);C&&P&&(d.onOpenChange(!1),(k=s.trigger)==null||k.focus(),T.preventDefault())})})})})})});ese.displayName=Qie;function tse(e){return e?"open":"closed"}function eN(e){return e==="indeterminate"}function w5(e){return eN(e)?"indeterminate":e?"checked":"unchecked"}function FNe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function zNe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function BNe(e,t,r){const a=t.length>1&&Array.from(t).every(b=>b===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let p=zNe(e,Math.max(d,0));a.length===1&&(p=p.filter(b=>b!==r));const _=p.find(b=>b.toLowerCase().startsWith(a.toLowerCase()));return _!==r?_:void 0}function $Ne(e,t){const{x:r,y:n}=e;let a=!1;for(let d=0,p=t.length-1;d<t.length;p=d++){const s=t[d],_=t[p],b=s.x,T=s.y,C=_.x,P=_.y;T>n!=P>n&&r<(C-b)*(n-T)/(P-T)+b&&(a=!a)}return a}function VNe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return $Ne(r,t)}function UT(e){return t=>t.pointerType==="mouse"?e(t):void 0}var UNe=Die,qNe=g5,GNe=Fie,WNe=zie,HNe=x5,ZNe=Bie,XNe=lk,KNe=Vie,YNe=qie,JNe=Wie,QNe=Zie,eIe=Xie,tIe=Kie,rIe=Jie,nIe=ese,ck="DropdownMenu",[iIe]=hc(ck,[Rie]),ql=Rie(),[sIe,rse]=iIe(ck),nse=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:a,defaultOpen:d,onOpenChange:p,modal:s=!0}=e,_=ql(t),b=F.useRef(null),[T,C]=kf({prop:a,defaultProp:d??!1,onChange:p,caller:ck});return c.jsx(sIe,{scope:t,triggerId:gd(),triggerRef:b,contentId:gd(),open:T,onOpenChange:C,onOpenToggle:F.useCallback(()=>C(P=>!P),[C]),modal:s,children:c.jsx(UNe,{..._,open:T,onOpenChange:C,dir:n,modal:s,children:r})})};nse.displayName=ck;var ise="DropdownMenuTrigger",sse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...a}=e,d=rse(ise,r),p=ql(r);return c.jsx(qNe,{asChild:!0,...p,children:c.jsx(vn.button,{type:"button",id:d.triggerId,"aria-haspopup":"menu","aria-expanded":d.open,"aria-controls":d.open?d.contentId:void 0,"data-state":d.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:OI(t,d.triggerRef),onPointerDown:Fr(e.onPointerDown,s=>{!n&&s.button===0&&s.ctrlKey===!1&&(d.onOpenToggle(),d.open||s.preventDefault())}),onKeyDown:Fr(e.onKeyDown,s=>{n||(["Enter"," "].includes(s.key)&&d.onOpenToggle(),s.key==="ArrowDown"&&d.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});sse.displayName=ise;var aIe="DropdownMenuPortal",ase=e=>{const{__scopeDropdownMenu:t,...r}=e,n=ql(t);return c.jsx(GNe,{...n,...r})};ase.displayName=aIe;var ose="DropdownMenuContent",lse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=rse(ose,r),d=ql(r),p=F.useRef(!1);return c.jsx(WNe,{id:a.contentId,"aria-labelledby":a.triggerId,...d,...n,ref:t,onCloseAutoFocus:Fr(e.onCloseAutoFocus,s=>{var _;p.current||(_=a.triggerRef.current)==null||_.focus(),p.current=!1,s.preventDefault()}),onInteractOutside:Fr(e.onInteractOutside,s=>{const _=s.detail.originalEvent,b=_.button===0&&_.ctrlKey===!0,T=_.button===2||b;(!a.modal||T)&&(p.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});lse.displayName=ose;var oIe="DropdownMenuGroup",lIe=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(HNe,{...a,...n,ref:t})});lIe.displayName=oIe;var cIe="DropdownMenuLabel",cse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(ZNe,{...a,...n,ref:t})});cse.displayName=cIe;var uIe="DropdownMenuItem",use=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(XNe,{...a,...n,ref:t})});use.displayName=uIe;var dIe="DropdownMenuCheckboxItem",dse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(KNe,{...a,...n,ref:t})});dse.displayName=dIe;var hIe="DropdownMenuRadioGroup",fIe=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(YNe,{...a,...n,ref:t})});fIe.displayName=hIe;var pIe="DropdownMenuRadioItem",hse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(JNe,{...a,...n,ref:t})});hse.displayName=pIe;var mIe="DropdownMenuItemIndicator",fse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(QNe,{...a,...n,ref:t})});fse.displayName=mIe;var gIe="DropdownMenuSeparator",pse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(eIe,{...a,...n,ref:t})});pse.displayName=gIe;var yIe="DropdownMenuArrow",vIe=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(tIe,{...a,...n,ref:t})});vIe.displayName=yIe;var _Ie="DropdownMenuSubTrigger",mse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(rIe,{...a,...n,ref:t})});mse.displayName=_Ie;var xIe="DropdownMenuSubContent",gse=F.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,a=ql(r);return c.jsx(nIe,{...a,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gse.displayName=xIe;var bIe=nse,wIe=sse,SIe=ase,yse=lse,vse=cse,_se=use,xse=dse,bse=hse,wse=fse,Sse=pse,Tse=mse,Ese=gse;const TIe=bIe,EIe=wIe,jIe=F.forwardRef(({className:e,inset:t,children:r,...n},a)=>c.jsxs(Tse,{ref:a,className:Dr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,c.jsx(ST,{className:"ml-auto h-4 w-4"})]}));jIe.displayName=Tse.displayName;const AIe=F.forwardRef(({className:e,...t},r)=>c.jsx(Ese,{ref:r,className:Dr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));AIe.displayName=Ese.displayName;const jse=F.forwardRef(({className:e,sideOffset:t=4,...r},n)=>c.jsx(SIe,{children:c.jsx(yse,{ref:n,sideOffset:t,className:Dr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));jse.displayName=yse.displayName;const sP=F.forwardRef(({className:e,inset:t,...r},n)=>c.jsx(_se,{ref:n,className:Dr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));sP.displayName=_se.displayName;const CIe=F.forwardRef(({className:e,children:t,checked:r,...n},a)=>c.jsxs(xse,{ref:a,className:Dr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(wse,{children:c.jsx(w0,{className:"h-4 w-4"})})}),t]}));CIe.displayName=xse.displayName;const PIe=F.forwardRef(({className:e,children:t,...r},n)=>c.jsxs(bse,{ref:n,className:Dr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(wse,{children:c.jsx(zve,{className:"h-2 w-2 fill-current"})})}),t]}));PIe.displayName=bse.displayName;const NIe=F.forwardRef(({className:e,inset:t,...r},n)=>c.jsx(vse,{ref:n,className:Dr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));NIe.displayName=vse.displayName;const Ase=F.forwardRef(({className:e,...t},r)=>c.jsx(Sse,{ref:r,className:Dr("-mx-1 my-1 h-px bg-muted",e),...t}));Ase.displayName=Sse.displayName;const Ph=()=>{const[e,t]=F.useState(!1),[r,n]=F.useState(""),[a,d]=F.useState(null),{items:p}=WI(),s=p.reduce((B,R)=>B+R.quantity,0),_=di(),{user:b,signOut:T}=$i();F.useEffect(()=>{(async()=>{if(!b){d(null);return}const{data:R}=await dt.from("profiles").select("full_name, avatar_url").eq("user_id",b.id).single();R&&d(R)})()},[b]);const C=async()=>{await T(),_("/")},P=B=>B.split(" ").map(R=>R[0]).join("").toUpperCase().slice(0,2),k=B=>{B.preventDefault(),r.trim()&&(_(`/buscar?q=${encodeURIComponent(r.trim())}`),n(""),t(!1))};return c.jsx("header",{className:"sticky top-0 z-50 bg-card/95 backdrop-blur-lg border-b border-border",children:c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsx(Oi,{to:"/",className:"flex items-center",children:c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-16 w-auto object-contain animate-logo-pulse"})}),c.jsx("div",{className:"hidden md:block",children:c.jsx(uH,{})}),c.jsx("form",{onSubmit:k,className:"hidden lg:flex flex-1 max-w-md mx-6",children:c.jsxs("div",{className:"relative w-full",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx("input",{type:"text",value:r,onChange:B=>n(B.target.value),placeholder:"Buscar restaurantes, pratos...",className:"w-full h-10 pl-10 pr-4 rounded-full bg-muted border-0 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20"})]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Oi,{to:"/cart",className:"relative",children:c.jsxs(Ft,{variant:"ghost",size:"icon",className:"relative",children:[c.jsx(xh,{className:"w-5 h-5"}),s>0&&c.jsx(gr.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-5 h-5 gradient-primary rounded-full text-[10px] font-bold text-primary-foreground flex items-center justify-center",children:s})]})}),c.jsx(Oi,{to:"/perfil",children:c.jsx(Ft,{variant:"ghost",size:"icon",className:"hidden sm:flex",children:c.jsx(to,{className:"w-5 h-5"})})}),c.jsx(Ft,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>t(!e),children:e?c.jsx(wd,{className:"w-5 h-5"}):c.jsx(Ri,{className:"w-5 h-5"})}),b&&a?c.jsxs(TIe,{children:[c.jsx(EIe,{asChild:!0,children:c.jsxs(Ft,{variant:"ghost",className:"hidden sm:flex items-center gap-2 px-2",children:[c.jsxs(YP,{className:"w-8 h-8",children:[c.jsx(vF,{src:a.avatar_url||void 0}),c.jsx(JP,{className:"bg-primary text-primary-foreground text-xs",children:P(a.full_name)})]}),c.jsx("span",{className:"text-sm font-medium max-w-[100px] truncate",children:a.full_name.split(" ")[0]})]})}),c.jsxs(jse,{align:"end",className:"w-48",children:[c.jsx(sP,{asChild:!0,children:c.jsxs(Oi,{to:"/perfil",className:"cursor-pointer",children:[c.jsx(to,{className:"w-4 h-4 mr-2"}),"Meu Perfil"]})}),c.jsx(sP,{asChild:!0,children:c.jsxs(Oi,{to:"/carteira",className:"cursor-pointer",children:[c.jsx(bd,{className:"w-4 h-4 mr-2"}),"Minha Carteira"]})}),c.jsx(Ase,{}),c.jsxs(sP,{onClick:C,className:"cursor-pointer text-destructive",children:[c.jsx(TT,{className:"w-4 h-4 mr-2"}),"Sair"]})]})]}):c.jsx(Oi,{to:"/auth",children:c.jsx(Ft,{variant:"hero",size:"sm",className:"hidden sm:flex",children:"Entrar"})})]})]}),c.jsx(ju,{children:e&&c.jsx(gr.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden overflow-hidden",children:c.jsxs("div",{className:"py-4 space-y-3",children:[c.jsxs("form",{onSubmit:k,className:"relative",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx("input",{type:"text",value:r,onChange:B=>n(B.target.value),placeholder:"Buscar restaurantes, pratos...",className:"w-full h-11 pl-10 pr-4 rounded-xl bg-muted border-0 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),c.jsx("div",{className:"w-full",children:c.jsx(uH,{})}),b&&a?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-xl mb-2",children:[c.jsxs(YP,{className:"w-10 h-10",children:[c.jsx(vF,{src:a.avatar_url||void 0}),c.jsx(JP,{className:"bg-primary text-primary-foreground",children:P(a.full_name)})]}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:a.full_name}),c.jsx("p",{className:"text-xs text-muted-foreground",children:b.email})]})]}),c.jsx(Oi,{to:"/perfil",onClick:()=>t(!1),children:c.jsxs(Ft,{variant:"outline",className:"w-full mb-2",children:[c.jsx(to,{className:"w-4 h-4 mr-2"}),"Meu Perfil"]})}),c.jsxs(Ft,{variant:"destructive",className:"w-full",onClick:()=>{C(),t(!1)},children:[c.jsx(TT,{className:"w-4 h-4 mr-2"}),"Sair"]})]}):c.jsxs(c.Fragment,{children:[c.jsx(Oi,{to:"/perfil",onClick:()=>t(!1),children:c.jsxs(Ft,{variant:"outline",className:"w-full mb-2",children:[c.jsx(to,{className:"w-4 h-4 mr-2"}),"Meu Perfil"]})}),c.jsx(Oi,{to:"/auth",onClick:()=>t(!1),children:c.jsx(Ft,{variant:"hero",className:"w-full",children:"Entrar ou Cadastrar"})})]})]})})})]})})},IIe=()=>{const[e,t]=F.useState(""),r=di(),n=a=>{a.preventDefault(),e.trim()&&r(`/buscar?q=${encodeURIComponent(e.trim())}`)};return c.jsxs("section",{className:"relative overflow-hidden gradient-hero",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[c.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-primary/5 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-primary/5 rounded-full blur-3xl"})]}),c.jsx("div",{className:"container relative py-12 md:py-20",children:c.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:c.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-accent text-accent-foreground text-sm font-medium mb-6",children:[c.jsx(j0,{className:"w-4 h-4"}),"Entrega em minutos"]})}),c.jsxs(gr.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"font-display text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-4",children:["Pediu, chegou."," ",c.jsx("span",{className:"text-gradient",children:"Vai J!"})]}),c.jsx(gr.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"text-lg text-muted-foreground mb-8 max-w-lg mx-auto",children:"Os melhores restaurantes, mercados e farmcias da sua cidade com entrega rpida e taxas justas."}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"max-w-xl mx-auto mb-10",children:c.jsxs("form",{onSubmit:n,className:"relative",children:[c.jsx(_d,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),c.jsx("input",{type:"text",value:e,onChange:a=>t(a.target.value),placeholder:"O que voc quer comer hoje?",className:"w-full h-14 pl-12 pr-32 rounded-2xl bg-card shadow-card border border-border text-base focus:outline-none focus:ring-2 focus:ring-primary/30 transition-shadow"}),c.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 h-10 px-6 gradient-primary text-primary-foreground font-semibold rounded-xl shadow-soft hover:shadow-glow transition-all active:scale-[0.98]",children:"Buscar"})]})}),c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"flex flex-wrap justify-center gap-6 text-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-success/10 flex items-center justify-center",children:c.jsx(ki,{className:"w-4 h-4 text-success"})}),c.jsx("span",{children:"Entrega rpida"})]}),c.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:c.jsx(j0,{className:"w-4 h-4 text-primary"})}),c.jsx("span",{children:"Taxas baixas"})]}),c.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-info/10 flex items-center justify-center",children:c.jsx(rv,{className:"w-4 h-4 text-info"})}),c.jsx("span",{children:"Pagamento seguro"})]})]})]})})]})},Cse=[{id:"restaurant",name:"Restaurantes",icon:v_e,color:"bg-primary/10 text-primary"},{id:"market",name:"Mercados",icon:d_e,color:"bg-success/10 text-success"},{id:"pharmacy",name:"Farmcias",icon:i_e,color:"bg-info/10 text-info"},{id:"fast-food",name:"Lanches",icon:l_e,color:"bg-yellow-100 text-yellow-600"},{id:"pizza",name:"Pizzarias",icon:s_e,color:"bg-orange-100 text-orange-600"},{id:"drinks",name:"Bebidas",icon:__e,color:"bg-purple-100 text-purple-600"},{id:"bakery",name:"Padarias",icon:Vve,color:"bg-amber-100 text-amber-600"},{id:"coffee",name:"Cafeteria",icon:Bve,color:"bg-brown-100 text-amber-700"},{id:"ice-cream",name:"Sorvetes",icon:Yve,color:"bg-pink-100 text-pink-600"},{id:"butcher",name:"Aougue",icon:Ove,color:"bg-red-100 text-red-600"},{id:"florist",name:"Floricultura",icon:Hve,color:"bg-rose-100 text-rose-600"},{id:"gifts",name:"Presentes",icon:$2,color:"bg-warning/10 text-warning"},{id:"pet-shop",name:"Pet Shop",icon:Uve,color:"bg-cyan-100 text-cyan-600"},{id:"convenience",name:"Convenincia",icon:Bi,color:"bg-slate-100 text-slate-600"},{id:"electronics",name:"Eletrnicos",icon:j0,color:"bg-blue-100 text-blue-600"},{id:"laundry",name:"Lavanderia",icon:u_e,color:"bg-sky-100 text-sky-600"},{id:"documents",name:"Documentos",icon:Rc,color:"bg-gray-100 text-gray-600"}],S5=[{value:"restaurant",label:"Restaurante"},{value:"market",label:"Mercado"},{value:"pharmacy",label:"Farmcia"},{value:"fast-food",label:"Lanches/Fast Food"},{value:"pizza",label:"Pizzaria"},{value:"drinks",label:"Bebidas/Adega"},{value:"bakery",label:"Padaria"},{value:"coffee",label:"Cafeteria"},{value:"ice-cream",label:"Sorveteria"},{value:"butcher",label:"Aougue"},{value:"florist",label:"Floricultura"},{value:"gifts",label:"Presentes"},{value:"pet-shop",label:"Pet Shop"},{value:"convenience",label:"Convenincia"},{value:"electronics",label:"Eletrnicos"},{value:"laundry",label:"Lavanderia"},{value:"documents",label:"Documentos/Entregas"},{value:"hamburgueria",label:"Hamburgueria"},{value:"japonesa",label:"Comida Japonesa"},{value:"brasileira",label:"Comida Brasileira"},{value:"italiana",label:"Comida Italiana"},{value:"chinesa",label:"Comida Chinesa"},{value:"mexicana",label:"Comida Mexicana"},{value:"arabe",label:"Comida rabe"},{value:"acai",label:"Aa"},{value:"doceria",label:"Doceria"},{value:"saudavel",label:"Saudvel/Fit"},{value:"vegano",label:"Vegano/Vegetariano"},{value:"marmita",label:"Marmitex"},{value:"outros",label:"Outros"}],kIe=Cse.slice(0,8),OIe=()=>c.jsx("section",{className:"py-8",children:c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h2",{className:"font-display text-xl font-bold",children:"Categorias"}),c.jsx(Oi,{to:"/categorias",className:"text-sm font-medium text-primary hover:underline",children:"Ver todas"})]}),c.jsx("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-3 md:gap-4",children:kIe.map((e,t)=>c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:t*.05},children:c.jsx(Oi,{to:`/categorias/${e.id}`,children:c.jsxs(gr.button,{whileHover:{y:-4},whileTap:{scale:.95},className:"w-full flex flex-col items-center gap-2 p-3 md:p-4 rounded-2xl bg-card shadow-soft hover:shadow-card transition-all",children:[c.jsx("div",{className:`w-12 h-12 md:w-14 md:h-14 rounded-xl ${e.color} flex items-center justify-center`,children:c.jsx(e.icon,{className:"w-6 h-6 md:w-7 md:h-7"})}),c.jsx("span",{className:"text-xs md:text-sm font-medium text-center",children:e.name})]})})},e.id))})]})}),RIe=[{id:1,title:"Primeira entrega grtis",description:"Em pedidos acima de R$ 30",icon:Tf,gradient:"from-primary to-orange-500"},{id:2,title:"20% OFF",description:"Em restaurantes selecionados",icon:FI,gradient:"from-success to-emerald-500"},{id:3,title:"Happy Hour",description:"Das 14h s 17h",icon:ki,gradient:"from-info to-blue-500"}],MIe=()=>c.jsx("section",{className:"py-8 overflow-hidden",children:c.jsxs("div",{className:"container",children:[c.jsx("h2",{className:"font-display text-xl font-bold mb-6",children:"Promoes"}),c.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 -mx-4 px-4 md:mx-0 md:px-0 md:grid md:grid-cols-3 scrollbar-hide",children:RIe.map((e,t)=>c.jsxs(gr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:t*.1},whileHover:{scale:1.02},className:`min-w-[280px] md:min-w-0 p-5 rounded-2xl bg-gradient-to-br ${e.gradient} text-white cursor-pointer shadow-elevated`,children:[c.jsx(e.icon,{className:"w-10 h-10 mb-4 opacity-90"}),c.jsx("h3",{className:"font-display font-bold text-lg mb-1",children:e.title}),c.jsx("p",{className:"text-sm opacity-90",children:e.description})]},e.id))})]})}),uk=({restaurant:e,index:t})=>c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:t*.05},children:c.jsx(Oi,{to:`/restaurant/${e.id}`,children:c.jsxs(gr.div,{whileHover:{y:-6},whileTap:{scale:.98},className:"group relative bg-card rounded-2xl overflow-hidden shadow-soft hover:shadow-card transition-all duration-300",children:[c.jsxs("div",{className:"relative aspect-[16/10] overflow-hidden",children:[c.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.discount&&c.jsx("div",{className:"absolute top-3 left-3 px-3 py-1 gradient-primary rounded-full text-xs font-bold text-primary-foreground shadow-glow",children:e.discount}),!e.isOpen&&c.jsx("div",{className:"absolute inset-0 bg-foreground/60 flex items-center justify-center",children:c.jsx("span",{className:"px-4 py-2 bg-card rounded-full text-sm font-semibold",children:"Fechado"})})]}),c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[c.jsx("h3",{className:"font-display font-semibold text-lg leading-tight line-clamp-1",children:e.name}),c.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[c.jsx(Mc,{className:"w-4 h-4 fill-warning text-warning"}),c.jsx("span",{className:"text-sm font-semibold",children:e.rating})]})]}),c.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.category}),c.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(ki,{className:"w-4 h-4"}),c.jsx("span",{children:e.deliveryTime})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Bc,{className:"w-4 h-4"}),c.jsx("span",{className:"text-success font-medium",children:e.deliveryFee})]})]})]})]})})});function fd({className:e,...t}){return c.jsx("div",{className:Dr("animate-pulse rounded-md bg-muted",e),...t})}const DIe=()=>{const{selectedCityId:e,isLoading:t}=H2(),[r,n]=F.useState([]),[a,d]=F.useState(!0);F.useEffect(()=>{t||(async()=>{d(!0);let T=dt.from("establishments").select("id, name, cover_url, category, rating, min_delivery_time, max_delivery_time, delivery_fee, is_open").eq("is_approved",!0).order("rating",{ascending:!1}).limit(6);e&&(T=T.eq("city_id",e));const{data:C,error:P}=await T;!P&&C&&n(C),d(!1)})()},[e,t]);const p=(b,T)=>!b&&!T?"30-45 min":T?`${b}-${T} min`:`${b} min`,s=b=>!b||b===0?"Grtis":`R$ ${b.toFixed(2).replace(".",",")}`,_=r.map(b=>({id:b.id,name:b.name,image:b.cover_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=500&h=300&fit=crop",category:b.category,rating:b.rating||0,deliveryTime:p(b.min_delivery_time,b.max_delivery_time),deliveryFee:s(b.delivery_fee),isOpen:b.is_open??!1}));return a||t?c.jsx("section",{className:"py-8",children:c.jsxs("div",{className:"container",children:[c.jsx("div",{className:"flex items-center justify-between mb-6",children:c.jsxs("div",{children:[c.jsx("h2",{className:"font-display text-xl font-bold",children:"Restaurantes"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Os melhores da regio"})]})}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[1,2,3,4,5,6].map(b=>c.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden",children:[c.jsx(fd,{className:"aspect-[16/10] w-full"}),c.jsxs("div",{className:"p-4 space-y-3",children:[c.jsx(fd,{className:"h-5 w-3/4"}),c.jsx(fd,{className:"h-4 w-1/2"}),c.jsx(fd,{className:"h-4 w-2/3"})]})]},b))})]})}):_.length===0?c.jsx("section",{className:"py-8",children:c.jsxs("div",{className:"container",children:[c.jsx("div",{className:"flex items-center justify-between mb-6",children:c.jsxs("div",{children:[c.jsx("h2",{className:"font-display text-xl font-bold",children:"Restaurantes"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Os melhores da regio"})]})}),c.jsxs("div",{className:"text-center py-12",children:[c.jsx("p",{className:"text-muted-foreground",children:"Nenhum restaurante encontrado na sua cidade."}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Selecione outra cidade para ver mais opes."})]})]})}):c.jsx("section",{className:"py-8",children:c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"font-display text-xl font-bold",children:"Restaurantes"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Os melhores da regio"})]}),c.jsx(Oi,{to:"/restaurantes",className:"text-sm font-medium text-primary hover:underline",children:"Ver todos"})]}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:_.map((b,T)=>c.jsx(uk,{restaurant:b,index:T},b.id))})]})})},Nh=()=>c.jsx("footer",{className:"bg-secondary text-secondary-foreground mt-12",children:c.jsxs("div",{className:"container py-12",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[c.jsxs("div",{className:"md:col-span-1",children:[c.jsx(Oi,{to:"/",className:"inline-block mb-4",children:c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-20 w-auto object-contain"})}),c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Pediu, chegou. Vai J! Os melhores estabelecimentos da sua cidade com entrega rpida."}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("a",{href:"#",className:"w-9 h-9 rounded-full bg-muted/20 flex items-center justify-center hover:bg-primary transition-colors",children:c.jsx(Qve,{className:"w-4 h-4"})}),c.jsx("a",{href:"#",className:"w-9 h-9 rounded-full bg-muted/20 flex items-center justify-center hover:bg-primary transition-colors",children:c.jsx(Wve,{className:"w-4 h-4"})})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-display font-semibold mb-4",children:"Parceiros"}),c.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[c.jsx("li",{children:c.jsx(Oi,{to:"/estabelecimento/auth",className:"hover:text-primary transition-colors",children:"Cadastre seu estabelecimento"})}),c.jsx("li",{children:c.jsx(Oi,{to:"/entregador/auth",className:"hover:text-primary transition-colors",children:"Seja entregador"})})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-display font-semibold mb-4",children:"Institucional"}),c.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[c.jsx("li",{children:c.jsx(Oi,{to:"/sobre-nos",className:"hover:text-primary transition-colors",children:"Sobre ns"})}),c.jsx("li",{children:c.jsx(Oi,{to:"/termos-de-uso",className:"hover:text-primary transition-colors",children:"Termos de uso"})}),c.jsx("li",{children:c.jsx(Oi,{to:"/politica-de-privacidade",className:"hover:text-primary transition-colors",children:"Poltica de privacidade"})})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-display font-semibold mb-4",children:"Contato"}),c.jsxs("ul",{className:"space-y-3 text-sm text-muted-foreground",children:[c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),c.jsx("a",{href:"https://wa.me/5579988320546",target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary transition-colors",children:"(79) 98832-0546"})]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(fb,{className:"w-4 h-4 text-primary"}),c.jsx("a",{href:"mailto:vaijadeliveryoficial@gmail.com",className:"hover:text-primary transition-colors",children:"vaijadeliveryoficial@gmail.com"})]})]})]})]}),c.jsxs("div",{className:"border-t border-muted/20 mt-8 pt-8 flex flex-col md:flex-row items-center justify-between gap-4",children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:" 2025 VAIJ DELIVERY. Todos os direitos reservados."}),c.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[c.jsx(j0,{className:"w-3 h-3 text-primary"}),c.jsx("span",{children:"Feito com velocidade no Brasil"})]})]})]})}),LIe=()=>c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Ph,{}),c.jsxs("main",{children:[c.jsx(IIe,{}),c.jsx(OIe,{}),c.jsx(MIe,{}),c.jsx(DIe,{})]}),c.jsx(Nh,{})]}),ar=F.forwardRef(({className:e,type:t,...r},n)=>c.jsx("input",{type:t,className:Dr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));ar.displayName="Input";var FIe="Label",Pse=F.forwardRef((e,t)=>c.jsx(vn.label,{...e,ref:t,onMouseDown:r=>{var a;r.target.closest("button, input, select, textarea")||((a=e.onMouseDown)==null||a.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Pse.displayName=FIe;var Nse=Pse;const zIe=LI("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),zt=F.forwardRef(({className:e,...t},r)=>c.jsx(Nse,{ref:r,className:Dr(zIe(),e),...t}));zt.displayName=Nse.displayName;const BIe=()=>{const e=di(),[t]=_te(),r=t.get("mode")||"login",[n,a]=F.useState(r),[d,p]=F.useState(!1),[s,_]=F.useState({email:"",password:"",fullName:"",phone:"",establishmentName:""}),b=P=>{_({...s,[P.target.name]:P.target.value})},T=async P=>{P.preventDefault(),p(!0);try{const{data:k,error:B}=await dt.auth.signInWithPassword({email:s.email,password:s.password});if(B)throw B;const{data:R}=await dt.from("user_roles").select("role").eq("user_id",k.user.id);gt.success("Login realizado com sucesso!"),R!=null&&R.some(D=>D.role==="establishment")?e("/estabelecimento"):R!=null&&R.some(D=>D.role==="admin")?e("/admin"):R!=null&&R.some(D=>D.role==="driver")?e("/entregador"):e("/")}catch(k){gt.error(k.message||"Erro ao fazer login")}finally{p(!1)}},C=async P=>{P.preventDefault(),p(!0);try{const{data:k,error:B}=await dt.auth.signUp({email:s.email,password:s.password,options:{emailRedirectTo:window.location.origin,data:{full_name:s.fullName}}});if(B)throw B;n==="register-establishment"&&k.user?(await dt.from("user_roles").insert({user_id:k.user.id,role:"establishment"}),await dt.from("establishments").insert({owner_id:k.user.id,name:s.establishmentName,phone:s.phone}),gt.success("Cadastro realizado! Aguarde aprovao do seu estabelecimento."),e("/estabelecimento")):(gt.success("Cadastro realizado com sucesso!"),e("/"))}catch(k){gt.error(k.message||"Erro ao fazer cadastro")}finally{p(!1)}};return c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background flex items-center justify-center p-4",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-24 w-auto object-contain mx-auto mb-4 animate-logo-pulse"}),c.jsxs("p",{className:"text-muted-foreground",children:[n==="login"&&"Entre na sua conta",n==="register"&&"Crie sua conta",n==="register-establishment"&&"Cadastre seu estabelecimento"]})]}),c.jsxs("div",{className:"bg-card rounded-2xl shadow-xl p-6 border border-border",children:[c.jsx("form",{onSubmit:n==="login"?T:C,children:c.jsxs("div",{className:"space-y-4",children:[n!=="login"&&c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"fullName",className:"flex items-center gap-2 mb-2",children:[c.jsx(to,{className:"w-4 h-4 text-primary"}),"Nome Completo"]}),c.jsx(ar,{id:"fullName",name:"fullName",type:"text",placeholder:"Seu nome",value:s.fullName,onChange:b,required:!0,className:"h-12"})]}),n==="register-establishment"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"establishmentName",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-primary"}),"Nome do Estabelecimento"]}),c.jsx(ar,{id:"establishmentName",name:"establishmentName",type:"text",placeholder:"Nome do seu negcio",value:s.establishmentName,onChange:b,required:!0,className:"h-12"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"phone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),"Telefone/WhatsApp"]}),c.jsx(ar,{id:"phone",name:"phone",type:"tel",placeholder:"(00) 00000-0000",value:s.phone,onChange:b,required:!0,className:"h-12"})]})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"email",className:"flex items-center gap-2 mb-2",children:[c.jsx(fb,{className:"w-4 h-4 text-primary"}),"E-mail"]}),c.jsx(ar,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:s.email,onChange:b,required:!0,className:"h-12"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"password",className:"flex items-center gap-2 mb-2",children:[c.jsx(S0,{className:"w-4 h-4 text-primary"}),"Senha"]}),c.jsx(ar,{id:"password",name:"password",type:"password",placeholder:"",value:s.password,onChange:b,required:!0,minLength:6,className:"h-12"})]}),c.jsx(Ft,{type:"submit",variant:"hero",size:"lg",className:"w-full h-12",disabled:d,children:d?"Carregando...":n==="login"?"Entrar":"Cadastrar"})]})}),c.jsx("div",{className:"mt-6 space-y-3",children:n==="login"?c.jsx("div",{className:"text-center",children:c.jsx("button",{type:"button",onClick:()=>a("register"),className:"text-primary hover:underline text-sm",children:"No tem conta? Cadastre-se"})}):c.jsx("div",{className:"text-center",children:c.jsxs("button",{type:"button",onClick:()=>a("login"),className:"text-primary hover:underline text-sm inline-flex items-center gap-1",children:[c.jsx(uc,{className:"w-4 h-4"}),"Voltar para login"]})})})]}),c.jsx("div",{className:"text-center mt-6",children:c.jsx("button",{type:"button",onClick:()=>e("/"),className:"text-muted-foreground hover:text-foreground text-sm",children:"Voltar para o incio"})})]})})},$Ie=()=>{const e=di(),[t,r]=F.useState("login"),[n,a]=F.useState(!1),[d,p]=F.useState({email:"",password:"",fullName:"",phone:"",establishmentName:"",cpfCnpj:"",category:"restaurant"}),s=T=>{p({...d,[T.target.name]:T.target.value})},_=async T=>{T.preventDefault(),a(!0);try{const{data:C,error:P}=await dt.auth.signInWithPassword({email:d.email,password:d.password});if(P)throw P;const{data:k}=await dt.from("user_roles").select("role").eq("user_id",C.user.id);if(!(k!=null&&k.some(B=>B.role==="establishment"))){await dt.auth.signOut(),gt.error("Esta conta no est vinculada a um estabelecimento."),a(!1);return}gt.success("Login realizado com sucesso!"),e("/estabelecimento")}catch(C){gt.error(C.message||"Erro ao fazer login")}finally{a(!1)}},b=async T=>{T.preventDefault(),a(!0);try{const{data:C,error:P}=await dt.auth.signUp({email:d.email,password:d.password,options:{emailRedirectTo:window.location.origin,data:{full_name:d.fullName}}});if(P)throw P;C.user&&(await dt.from("user_roles").insert({user_id:C.user.id,role:"establishment"}),await dt.from("establishments").insert({owner_id:C.user.id,name:d.establishmentName,phone:d.phone,cpf_cnpj:d.cpfCnpj,category:d.category}),gt.success("Cadastro realizado! Aguarde aprovao do seu estabelecimento."),e("/estabelecimento"))}catch(C){gt.error(C.message||"Erro ao fazer cadastro")}finally{a(!1)}};return c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-background to-orange-100/30 dark:from-orange-950/20 dark:via-background dark:to-orange-900/20 flex items-center justify-center p-4",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("div",{className:"inline-flex items-center gap-2 mb-4",children:c.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-xl shadow-lg",children:c.jsx(Bi,{className:"w-8 h-8 text-white"})})}),c.jsx("h1",{className:"text-2xl font-black text-foreground tracking-tight mb-1",children:"Portal do Estabelecimento"}),c.jsx("p",{className:"text-muted-foreground",children:t==="login"?"Acesse sua conta":"Cadastre seu estabelecimento"})]}),c.jsxs("div",{className:"bg-card rounded-2xl shadow-xl p-6 border border-orange-200/50 dark:border-orange-800/30",children:[c.jsx("form",{onSubmit:t==="login"?_:b,children:c.jsxs("div",{className:"space-y-4",children:[t==="register"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"fullName",className:"flex items-center gap-2 mb-2",children:[c.jsx(to,{className:"w-4 h-4 text-orange-500"}),"Nome do Responsvel"]}),c.jsx(ar,{id:"fullName",name:"fullName",type:"text",placeholder:"Seu nome",value:d.fullName,onChange:s,required:!0,className:"h-12 focus-visible:ring-orange-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"establishmentName",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-orange-500"}),"Nome do Estabelecimento"]}),c.jsx(ar,{id:"establishmentName",name:"establishmentName",type:"text",placeholder:"Nome do seu negcio",value:d.establishmentName,onChange:s,required:!0,className:"h-12 focus-visible:ring-orange-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"category",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-orange-500"}),"Categoria"]}),c.jsxs(ns,{value:d.category,onValueChange:T=>p({...d,category:T}),children:[c.jsx(Ji,{className:"h-12 focus:ring-orange-500",children:c.jsx(is,{placeholder:"Selecione a categoria"})}),c.jsx(Qi,{children:S5.map(T=>c.jsx(sn,{value:T.value,children:T.label},T.value))})]})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"phone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-orange-500"}),"Telefone/WhatsApp"]}),c.jsx(ar,{id:"phone",name:"phone",type:"tel",placeholder:"(00) 00000-0000",value:d.phone,onChange:s,required:!0,className:"h-12 focus-visible:ring-orange-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"cpfCnpj",className:"flex items-center gap-2 mb-2",children:[c.jsx(Rc,{className:"w-4 h-4 text-orange-500"}),"CPF ou CNPJ"]}),c.jsx(ar,{id:"cpfCnpj",name:"cpfCnpj",type:"text",placeholder:"000.000.000-00 ou 00.000.000/0000-00",value:d.cpfCnpj,onChange:s,required:!0,className:"h-12 focus-visible:ring-orange-500"})]})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"email",className:"flex items-center gap-2 mb-2",children:[c.jsx(fb,{className:"w-4 h-4 text-orange-500"}),"E-mail"]}),c.jsx(ar,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:d.email,onChange:s,required:!0,className:"h-12 focus-visible:ring-orange-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"password",className:"flex items-center gap-2 mb-2",children:[c.jsx(S0,{className:"w-4 h-4 text-orange-500"}),"Senha"]}),c.jsx(ar,{id:"password",name:"password",type:"password",placeholder:"",value:d.password,onChange:s,required:!0,minLength:6,className:"h-12 focus-visible:ring-orange-500"})]}),c.jsx(Ft,{type:"submit",size:"lg",className:"w-full h-12 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white",disabled:n,children:n?"Carregando...":t==="login"?"Entrar":"Cadastrar"})]})}),c.jsx("div",{className:"mt-6 space-y-3",children:t==="login"?c.jsx("div",{className:"text-center",children:c.jsx("button",{type:"button",onClick:()=>r("register"),className:"text-orange-600 hover:underline text-sm",children:"No tem conta? Cadastre seu estabelecimento"})}):c.jsx("div",{className:"text-center",children:c.jsxs("button",{type:"button",onClick:()=>r("login"),className:"text-orange-600 hover:underline text-sm inline-flex items-center gap-1",children:[c.jsx(uc,{className:"w-4 h-4"}),"Voltar para login"]})})})]}),c.jsx("div",{className:"text-center mt-6",children:c.jsx("button",{type:"button",onClick:()=>e("/"),className:"text-muted-foreground hover:text-foreground text-sm",children:"Voltar para o incio"})})]})})},VIe=()=>{const e=di(),[t,r]=F.useState("login"),[n,a]=F.useState(!1),[d,p]=F.useState({email:"",password:"",fullName:"",phone:"",cpf:"",vehicleType:"moto",vehiclePlate:"",birthDate:"",address:""}),[s,_]=F.useState(null),[b,T]=F.useState(null),[C,P]=F.useState(null),[k,B]=F.useState(null),R=($,K)=>{if($.target.files&&$.target.files[0]){const Y=$.target.files[0];K==="face"?(_(Y),T(URL.createObjectURL(Y))):(P(Y),B(URL.createObjectURL(Y)))}},D=$=>{p({...d,[$.target.name]:$.target.value})},G=async $=>{$.preventDefault(),a(!0);try{const{data:K,error:Y}=await dt.auth.signInWithPassword({email:d.email,password:d.password});if(Y)throw Y;const{data:ee}=await dt.from("user_roles").select("role").eq("user_id",K.user.id);if(!(ee!=null&&ee.some(ae=>ae.role==="driver"))){await dt.auth.signOut(),gt.error("Esta conta no est cadastrada como entregador."),a(!1);return}gt.success("Login realizado com sucesso!"),e("/entregador")}catch(K){gt.error(K.message||"Erro ao fazer login")}finally{a(!1)}},V=async $=>{$.preventDefault(),a(!0);try{const{data:K,error:Y}=await dt.auth.signUp({email:d.email,password:d.password,options:{emailRedirectTo:window.location.origin,data:{full_name:d.fullName}}});if(Y)throw Y;if(K.user){await dt.from("user_roles").insert({user_id:K.user.id,role:"driver"});let ee="";if(s){const ge=s.name.split(".").pop(),fe=`${K.user.id}/face_${Math.random()}.${ge}`,{error:be}=await dt.storage.from("driver-documents").upload(fe,s);if(be)console.error("Face photo upload error:",be),gt.error("Erro ao enviar foto do rosto: "+be.message);else{const{data:ue}=dt.storage.from("driver-documents").getPublicUrl(fe);ee=ue.publicUrl}}let ae="";if(C){const ge=C.name.split(".").pop(),fe=`${K.user.id}/id_${Math.random()}.${ge}`,{error:be}=await dt.storage.from("driver-documents").upload(fe,C);if(be)console.error("ID photo upload error:",be),gt.error("Erro ao enviar foto do RG: "+be.message);else{const{data:ue}=dt.storage.from("driver-documents").getPublicUrl(fe);ae=ue.publicUrl}}const{error:ie}=await dt.from("profiles").update({phone:d.phone,cpf_cnpj:d.cpf,driver_vehicle_plate:d.vehiclePlate,driver_birth_date:d.birthDate,driver_address:d.address,face_photo_url:ee,driver_id_photo_url:ae,is_driver_approved:!1,driver_registration_submitted_at:new Date().toISOString()}).eq("user_id",K.user.id);if(ie)throw console.error("Profile update error:",ie),new Error("Erro ao salvar dados do perfil: "+ie.message);gt.success("Cadastro realizado! Sua conta est em anlise para aprovao."),e("/entregador")}}catch(K){console.error("Registration error:",K),gt.error(K.message||"Erro ao fazer cadastro")}finally{a(!1)}};return c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 via-background to-emerald-100/30 dark:from-emerald-950/20 dark:via-background dark:to-emerald-900/20 flex items-center justify-center p-4",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("div",{className:"inline-flex items-center gap-2 mb-4",children:c.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 p-3 rounded-xl shadow-lg",children:c.jsx(Bc,{className:"w-8 h-8 text-white"})})}),c.jsx("h1",{className:"text-2xl font-black text-foreground tracking-tight mb-1",children:"Portal do Entregador"}),c.jsx("p",{className:"text-muted-foreground",children:t==="login"?"Acesse sua conta":"Cadastre-se como entregador"})]}),c.jsxs("div",{className:"bg-card rounded-2xl shadow-xl p-6 border border-emerald-200/50 dark:border-emerald-800/30",children:[c.jsx("form",{onSubmit:t==="login"?G:V,children:c.jsxs("div",{className:"space-y-4",children:[t==="register"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"fullName",className:"flex items-center gap-2 mb-2",children:[c.jsx(to,{className:"w-4 h-4 text-emerald-500"}),"Nome Completo"]}),c.jsx(ar,{id:"fullName",name:"fullName",type:"text",placeholder:"Seu nome completo",value:d.fullName,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"phone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-emerald-500"}),"Telefone/WhatsApp"]}),c.jsx(ar,{id:"phone",name:"phone",type:"tel",placeholder:"(00) 00000-0000",value:d.phone,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"cpf",className:"flex items-center gap-2 mb-2",children:[c.jsx(Rc,{className:"w-4 h-4 text-emerald-500"}),"CPF"]}),c.jsx(ar,{id:"cpf",name:"cpf",type:"text",placeholder:"000.000.000-00",value:d.cpf,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"vehiclePlate",className:"flex items-center gap-2 mb-2",children:[c.jsx(Rc,{className:"w-4 h-4 text-emerald-500"}),"Placa do Veculo"]}),c.jsx(ar,{id:"vehiclePlate",name:"vehiclePlate",type:"text",placeholder:"ABC-1234",value:d.vehiclePlate,onChange:D,required:d.vehicleType!=="bicicleta"&&d.vehicleType!=="a_pe",className:"h-12 focus-visible:ring-emerald-500 uppercase"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"birthDate",className:"flex items-center gap-2 mb-2",children:[c.jsx(B2,{className:"w-4 h-4 text-emerald-500"}),"Data de Nascimento"]}),c.jsx(ar,{id:"birthDate",name:"birthDate",type:"date",value:d.birthDate,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"address",className:"flex items-center gap-2 mb-2",children:[c.jsx(zi,{className:"w-4 h-4 text-emerald-500"}),"Endereo Completo"]}),c.jsx(ar,{id:"address",name:"address",type:"text",placeholder:"Rua, nmero, bairro, cidade",value:d.address,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs(zt,{className:"flex items-center gap-2 mb-2",children:[c.jsx(kP,{className:"w-4 h-4 text-emerald-500"}),"Foto do Rosto (Selfie)"]}),c.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 border-2 border-dashed border-emerald-200 rounded-xl bg-emerald-50/30",children:[b?c.jsxs("div",{className:"relative w-32 h-32",children:[c.jsx("img",{src:b,alt:"Preview",className:"w-full h-full object-cover rounded-full border-2 border-emerald-500"}),c.jsx("button",{type:"button",onClick:()=>{_(null),T(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg",children:c.jsx(uc,{className:"w-4 h-4 rotate-45"})})]}):c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Tire uma foto ntida do seu rosto"}),c.jsx(Ft,{type:"button",variant:"outline",onClick:()=>{var $;return($=document.getElementById("photo-upload"))==null?void 0:$.click()},className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50",children:"Selecionar Foto"})]}),c.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",capture:"user",onChange:$=>R($,"face"),className:"hidden",required:!0})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs(zt,{className:"flex items-center gap-2 mb-2",children:[c.jsx(kP,{className:"w-4 h-4 text-emerald-500"}),"Foto do RG (Frente)"]}),c.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 border-2 border-dashed border-emerald-200 rounded-xl bg-emerald-50/30",children:[k?c.jsxs("div",{className:"relative w-full aspect-video",children:[c.jsx("img",{src:k,alt:"RG Preview",className:"w-full h-full object-cover rounded-lg border-2 border-emerald-500"}),c.jsx("button",{type:"button",onClick:()=>{P(null),B(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg",children:c.jsx(uc,{className:"w-4 h-4 rotate-45"})})]}):c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Tire uma foto ntida da frente do seu RG"}),c.jsx(Ft,{type:"button",variant:"outline",onClick:()=>{var $;return($=document.getElementById("id-photo-upload"))==null?void 0:$.click()},className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50",children:"Selecionar RG"})]}),c.jsx("input",{id:"id-photo-upload",type:"file",accept:"image/*",onChange:$=>R($,"id"),className:"hidden",required:!0})]})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"vehicleType",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bc,{className:"w-4 h-4 text-emerald-500"}),"Veculo"]}),c.jsxs("select",{id:"vehicleType",name:"vehicleType",value:d.vehicleType,onChange:D,required:!0,className:"flex h-12 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500",children:[c.jsx("option",{value:"moto",children:"Moto"}),c.jsx("option",{value:"bicicleta",children:"Bicicleta"}),c.jsx("option",{value:"carro",children:"Carro"}),c.jsx("option",{value:"a_pe",children:"A p"})]})]})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"email",className:"flex items-center gap-2 mb-2",children:[c.jsx(fb,{className:"w-4 h-4 text-emerald-500"}),"E-mail"]}),c.jsx(ar,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:d.email,onChange:D,required:!0,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"password",className:"flex items-center gap-2 mb-2",children:[c.jsx(S0,{className:"w-4 h-4 text-emerald-500"}),"Senha"]}),c.jsx(ar,{id:"password",name:"password",type:"password",placeholder:"",value:d.password,onChange:D,required:!0,minLength:6,className:"h-12 focus-visible:ring-emerald-500"})]}),c.jsx(Ft,{type:"submit",size:"lg",className:"w-full h-12 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white",disabled:n,children:n?"Carregando...":t==="login"?"Entrar":"Cadastrar"})]})}),c.jsx("div",{className:"mt-6 space-y-3",children:t==="login"?c.jsx("div",{className:"text-center",children:c.jsx("button",{type:"button",onClick:()=>r("register"),className:"text-emerald-600 hover:underline text-sm",children:"No tem conta? Cadastre-se como entregador"})}):c.jsx("div",{className:"text-center",children:c.jsxs("button",{type:"button",onClick:()=>r("login"),className:"text-emerald-600 hover:underline text-sm inline-flex items-center gap-1",children:[c.jsx(uc,{className:"w-4 h-4"}),"Voltar para login"]})})})]}),c.jsx("div",{className:"text-center mt-6",children:c.jsx("button",{type:"button",onClick:()=>e("/"),className:"text-muted-foreground hover:text-foreground text-sm",children:"Voltar para o incio"})})]})})},Vt=F.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:Dr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Vt.displayName="Card";const Wr=F.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:Dr("flex flex-col space-y-1.5 p-6",e),...t}));Wr.displayName="CardHeader";const Hr=F.forwardRef(({className:e,...t},r)=>c.jsx("h3",{ref:r,className:Dr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Hr.displayName="CardTitle";const zo=F.forwardRef(({className:e,...t},r)=>c.jsx("p",{ref:r,className:Dr("text-sm text-muted-foreground",e),...t}));zo.displayName="CardDescription";const Ut=F.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:Dr("p-6 pt-0",e),...t}));Ut.displayName="CardContent";const UIe=F.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:Dr("flex items-center p-6 pt-0",e),...t}));UIe.displayName="CardFooter";const qIe=LI("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function dn({className:e,variant:t,...r}){return c.jsx("div",{className:Dr(qIe({variant:t}),e),...r})}const fH={pending:{label:"Aguardando",color:"bg-yellow-500"},confirmed:{label:"Confirmado",color:"bg-blue-500"},preparing:{label:"Preparando",color:"bg-orange-500"},ready:{label:"Pronto",color:"bg-purple-500"},out_for_delivery:{label:"Em entrega",color:"bg-green-500"},delivered:{label:"Entregue",color:"bg-green-700"},cancelled:{label:"Cancelado",color:"bg-red-500"}},GIe=()=>{var ge;const{user:e,loading:t}=$i(),r=di(),[n,a]=F.useState(!0),[d,p]=F.useState(!1),[s,_]=F.useState(!1),[b,T]=F.useState(!1),[C,P]=F.useState([]),[k,B]=F.useState(!0),R=F.useRef(null),[D,G]=F.useState({full_name:"",phone:"",avatar_url:"",wallet_balance:0}),[V,$]=F.useState({currentPassword:"",newPassword:"",confirmPassword:""});F.useEffect(()=>{if(!t&&!e){r("/auth");return}e&&(K(),Y())},[e,t,r]);const K=async()=>{try{const{data:fe,error:be}=await dt.from("profiles").select("*").eq("user_id",e.id).single();if(be)throw be;fe&&G({full_name:fe.full_name||"",phone:fe.phone||"",avatar_url:fe.avatar_url||"",wallet_balance:Number(fe.wallet_balance)||0})}catch(fe){console.error("Error fetching profile:",fe),gt.error("Erro ao carregar perfil")}finally{a(!1)}},Y=async()=>{try{const{data:fe,error:be}=await dt.from("orders").select("*").eq("customer_id",e.id).order("created_at",{ascending:!1}).limit(10);if(be)throw be;P(fe||[])}catch(fe){console.error("Error fetching orders:",fe)}finally{B(!1)}},ee=async()=>{p(!0);try{const{error:fe}=await dt.from("profiles").update({full_name:D.full_name,phone:D.phone,avatar_url:D.avatar_url}).eq("user_id",e.id);if(fe)throw fe;gt.success("Perfil atualizado com sucesso!")}catch(fe){console.error("Error updating profile:",fe),gt.error("Erro ao atualizar perfil")}finally{p(!1)}},ae=async fe=>{var ue;const be=(ue=fe.target.files)==null?void 0:ue[0];if(be){if(!be.type.startsWith("image/")){gt.error("Por favor, selecione uma imagem");return}if(be.size>2*1024*1024){gt.error("A imagem deve ter no mximo 2MB");return}T(!0);try{const Ce=be.name.split(".").pop(),ve=`${e.id}/avatar.${Ce}`;await dt.storage.from("avatars").remove([ve]);const{error:ze}=await dt.storage.from("avatars").upload(ve,be,{upsert:!0});if(ze)throw ze;const{data:{publicUrl:Me}}=dt.storage.from("avatars").getPublicUrl(ve),{error:Be}=await dt.from("profiles").update({avatar_url:Me}).eq("user_id",e.id);if(Be)throw Be;G({...D,avatar_url:Me}),gt.success("Avatar atualizado com sucesso!")}catch(Ce){console.error("Error uploading avatar:",Ce),gt.error("Erro ao fazer upload do avatar")}finally{T(!1)}}},ie=async()=>{if(V.newPassword!==V.confirmPassword){gt.error("As senhas no coincidem");return}if(V.newPassword.length<6){gt.error("A nova senha deve ter pelo menos 6 caracteres");return}_(!0);try{const{error:fe}=await dt.auth.updateUser({password:V.newPassword});if(fe)throw fe;gt.success("Senha alterada com sucesso!"),$({currentPassword:"",newPassword:"",confirmPassword:""})}catch(fe){console.error("Error changing password:",fe),gt.error(fe.message||"Erro ao alterar senha")}finally{_(!1)}};return t||n?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[c.jsx(Ph,{}),c.jsx("main",{className:"flex-1 container mx-auto px-4 py-8",children:c.jsxs("div",{className:"max-w-2xl mx-auto",children:[c.jsxs(Ft,{variant:"ghost",onClick:()=>r(-1),className:"mb-6",children:[c.jsx(uc,{className:"h-4 w-4 mr-2"}),"Voltar"]}),c.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Meu Perfil"}),c.jsxs(Vt,{className:"mb-6",children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(cs,{className:"h-5 w-5"}),"Meus Pedidos"]}),c.jsx(zo,{children:"Acompanhe seus pedidos recentes"})]}),c.jsx(Ut,{children:k?c.jsx("div",{className:"flex items-center justify-center py-8",children:c.jsx(Ma,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):C.length===0?c.jsxs("div",{className:"text-center py-8",children:[c.jsx(cs,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),c.jsx("p",{className:"text-muted-foreground",children:"Voc ainda no fez nenhum pedido"}),c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"outline",className:"mt-4",children:"Explorar restaurantes"})})]}):c.jsxs("div",{className:"space-y-3",children:[C.slice(0,5).map(fe=>{const be=!["delivered","cancelled"].includes(fe.status);return c.jsxs(Oi,{to:`/pedido/${fe.id}`,className:"flex items-center gap-4 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",children:[c.jsx("div",{className:`p-2 rounded-full ${be?"bg-primary/10":"bg-muted"}`,children:be?c.jsx(ki,{className:"h-5 w-5 text-primary"}):c.jsx(cs,{className:"h-5 w-5 text-muted-foreground"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",fe.order_number]}),c.jsx(dn,{className:`${fH[fe.status].color} text-xs`,children:fH[fe.status].label})]}),c.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[new Date(fe.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"  R$ ",Number(fe.total).toFixed(2).replace(".",",")]})]}),c.jsx(ST,{className:"h-5 w-5 text-muted-foreground"})]},fe.id)}),C.length>5&&c.jsxs("p",{className:"text-center text-sm text-muted-foreground pt-2",children:["Mostrando 5 de ",C.length," pedidos"]})]})})]}),c.jsxs(Vt,{className:"mb-6 border-primary/20 bg-primary/5",children:[c.jsxs(Wr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsxs(Hr,{className:"text-lg flex items-center gap-2",children:[c.jsx(bd,{className:"h-5 w-5 text-primary"}),"Saldo Digital"]}),c.jsx(zo,{children:"Use seu saldo para pagar pedidos"})]}),c.jsx(Oi,{to:"/carteira",children:c.jsx(Ft,{size:"sm",children:"Ver Carteira"})})]}),c.jsx(Ut,{children:c.jsxs("div",{className:"text-2xl font-bold text-primary",children:["R$ ",n?"...":((ge=D.wallet_balance)==null?void 0:ge.toFixed(2).replace(".",","))||"0,00"]})})]}),c.jsxs(Vt,{className:"mb-6",children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(to,{className:"h-5 w-5"}),"Dados Pessoais"]}),c.jsx(zo,{children:"Atualize suas informaes pessoais"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"email",children:"E-mail"}),c.jsx(ar,{id:"email",type:"email",value:(e==null?void 0:e.email)||"",disabled:!0,className:"bg-muted"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"O e-mail no pode ser alterado"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"full_name",children:"Nome completo"}),c.jsx(ar,{id:"full_name",value:D.full_name,onChange:fe=>G({...D,full_name:fe.target.value}),placeholder:"Seu nome completo"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"phone",children:"Telefone"}),c.jsx(ar,{id:"phone",value:D.phone,onChange:fe=>G({...D,phone:fe.target.value}),placeholder:"(00) 00000-0000"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Foto de Perfil"}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"relative",children:[D.avatar_url?c.jsx("img",{src:D.avatar_url,alt:"Avatar",className:"w-20 h-20 rounded-full object-cover border-2 border-border",onError:fe=>{fe.target.src="/placeholder.svg"}}):c.jsx("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center border-2 border-border",children:c.jsx(to,{className:"h-8 w-8 text-muted-foreground"})}),c.jsx("button",{type:"button",onClick:()=>{var fe;return(fe=R.current)==null?void 0:fe.click()},disabled:b,className:"absolute bottom-0 right-0 bg-primary text-primary-foreground p-1.5 rounded-full hover:bg-primary/90 transition-colors disabled:opacity-50",children:b?c.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary-foreground border-t-transparent"}):c.jsx(kP,{className:"h-4 w-4"})})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("input",{ref:R,type:"file",accept:"image/*",onChange:ae,className:"hidden"}),c.jsxs(Ft,{type:"button",variant:"outline",size:"sm",onClick:()=>{var fe;return(fe=R.current)==null?void 0:fe.click()},disabled:b,children:[c.jsx(y_e,{className:"h-4 w-4 mr-2"}),b?"Enviando...":"Escolher foto"]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG ou GIF. Mximo 2MB."})]})]})]}),c.jsxs(Ft,{onClick:ee,disabled:d,className:"w-full",children:[c.jsx(E0,{className:"h-4 w-4 mr-2"}),d?"Salvando...":"Salvar Alteraes"]})]})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(S0,{className:"h-5 w-5"}),"Alterar Senha"]}),c.jsx(zo,{children:"Atualize sua senha de acesso"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"newPassword",children:"Nova senha"}),c.jsx(ar,{id:"newPassword",type:"password",value:V.newPassword,onChange:fe=>$({...V,newPassword:fe.target.value}),placeholder:""})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"confirmPassword",children:"Confirmar nova senha"}),c.jsx(ar,{id:"confirmPassword",type:"password",value:V.confirmPassword,onChange:fe=>$({...V,confirmPassword:fe.target.value}),placeholder:""})]}),c.jsxs(Ft,{onClick:ie,disabled:s||!V.newPassword||!V.confirmPassword,variant:"outline",className:"w-full",children:[c.jsx(S0,{className:"h-4 w-4 mr-2"}),s?"Alterando...":"Alterar Senha"]})]})]})]})}),c.jsx(Nh,{})]})},pH=[{id:1,name:"Burger House Premium",image:"https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=500&h=300&fit=crop",category:"Hambrgueres  Lanches",rating:4.8,deliveryTime:"25-35 min",deliveryFee:"R$ 5,99",isOpen:!0,discount:"20% OFF"},{id:2,name:"Pizzaria Bella Napoli",image:"https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=500&h=300&fit=crop",category:"Pizzas  Italiana",rating:4.6,deliveryTime:"40-50 min",deliveryFee:"Grtis",isOpen:!0},{id:3,name:"Sushi Master",image:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=500&h=300&fit=crop",category:"Japonesa  Sushi",rating:4.9,deliveryTime:"35-45 min",deliveryFee:"R$ 7,99",isOpen:!0,discount:"Frete Grtis"},{id:4,name:"Cantina do Italiano",image:"https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=500&h=300&fit=crop",category:"Massas  Italiana",rating:4.5,deliveryTime:"30-40 min",deliveryFee:"R$ 4,99",isOpen:!0},{id:5,name:"Aa da Terra",image:"https://images.unsplash.com/photo-1590301157890-4810ed352733?w=500&h=300&fit=crop",category:"Aa  Saudvel",rating:4.7,deliveryTime:"20-30 min",deliveryFee:"R$ 3,99",isOpen:!0},{id:6,name:"Churrascaria Fogo de Cho",image:"https://images.unsplash.com/photo-1558030006-450675393462?w=500&h=300&fit=crop",category:"Carnes  Churrasco",rating:4.4,deliveryTime:"45-55 min",deliveryFee:"R$ 8,99",isOpen:!1},{id:7,name:"Caf Colonial",image:"https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=500&h=300&fit=crop",category:"Cafeteria  Doces",rating:4.6,deliveryTime:"15-25 min",deliveryFee:"R$ 4,99",isOpen:!0},{id:8,name:"Sorveteria Gelatto",image:"https://images.unsplash.com/photo-1501443762994-82bd5dace89a?w=500&h=300&fit=crop",category:"Sorvetes  Sobremesas",rating:4.8,deliveryTime:"20-30 min",deliveryFee:"R$ 5,99",isOpen:!0}],WIe=()=>{const[e,t]=_te(),r=e.get("q")||"",[n,a]=F.useState(r),[d,p]=F.useState(r),s=F.useMemo(()=>{if(!n)return pH;const T=n.toLowerCase();return pH.filter(C=>C.name.toLowerCase().includes(T)||C.category.toLowerCase().includes(T))},[n]),_=T=>{T.preventDefault(),a(d),t(d?{q:d}:{})},b=()=>{p(""),a(""),t({})};return c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Ph,{}),c.jsxs("main",{className:"container py-8",children:[c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[c.jsx("h1",{className:"font-display text-2xl font-bold mb-4",children:n?`Resultados para "${n}"`:"Buscar"}),c.jsxs("form",{onSubmit:_,className:"flex gap-3",children:[c.jsxs("div",{className:"relative flex-1",children:[c.jsx(_d,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),c.jsx("input",{type:"text",value:d,onChange:T=>p(T.target.value),placeholder:"Buscar restaurantes, pratos...",className:"w-full h-12 pl-12 pr-10 rounded-xl bg-card border border-border text-base focus:outline-none focus:ring-2 focus:ring-primary/30"}),d&&c.jsx("button",{type:"button",onClick:b,className:"absolute right-3 top-1/2 -translate-y-1/2",children:c.jsx(wd,{className:"w-5 h-5 text-muted-foreground hover:text-foreground"})})]}),c.jsx(Ft,{type:"submit",variant:"default",size:"lg",children:"Buscar"}),c.jsx(Ft,{type:"button",variant:"outline",size:"lg",children:c.jsx(h_e,{className:"w-5 h-5"})})]})]}),s.length>0?c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:s.map((T,C)=>c.jsx(uk,{restaurant:T,index:C},T.id))}):c.jsxs(gr.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16",children:[c.jsx(_d,{className:"w-16 h-16 mx-auto text-muted-foreground/50 mb-4"}),c.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Nenhum resultado encontrado"}),c.jsx("p",{className:"text-muted-foreground",children:"Tente buscar por outro termo ou explore nossas categorias"})]})]}),c.jsx(Nh,{})]})},mH=Cse,gH=()=>{const{slug:e}=GI(),{selectedCityId:t,selectedCityName:r}=H2(),n=mH.find(s=>s.id===e),{data:a=[],isLoading:d}=ote({queryKey:["establishments-by-category",e,t],queryFn:async()=>{let s=dt.from("establishments").select("*").eq("is_approved",!0);e&&(s=s.eq("category",e)),t&&(s=s.eq("city_id",t));const{data:_,error:b}=await s.order("rating",{ascending:!1});if(b)throw b;return _||[]},enabled:!0}),p=s=>{var _;return{id:s.id,name:s.name,image:s.cover_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=500&h=300&fit=crop",category:s.category,rating:s.rating||0,deliveryTime:`${s.min_delivery_time||30}-${s.max_delivery_time||60} min`,deliveryFee:s.delivery_fee===0?"Grtis":`R$ ${(_=s.delivery_fee)==null?void 0:_.toFixed(2).replace(".",",")}`,isOpen:s.is_open||!1}};return e?c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Ph,{}),c.jsx("main",{className:"container py-8",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[n&&c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("div",{className:`w-14 h-14 rounded-xl ${n.color} flex items-center justify-center`,children:c.jsx(n.icon,{className:"w-7 h-7"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-display text-2xl font-bold",children:n.name}),c.jsxs("p",{className:"text-muted-foreground",children:[d?"Carregando...":`${a.length} estabelecimentos`,r&&` em ${r}`]})]})]}),d?c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:[1,2,3,4,5,6].map(s=>c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-card",children:[c.jsx(fd,{className:"h-40 w-full"}),c.jsxs("div",{className:"p-4 space-y-2",children:[c.jsx(fd,{className:"h-5 w-3/4"}),c.jsx(fd,{className:"h-4 w-1/2"})]})]},s))}):a.length>0?c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:a.map((s,_)=>c.jsx(uk,{restaurant:p(s),index:_},s.id))}):c.jsx("div",{className:"text-center py-16",children:c.jsxs("p",{className:"text-muted-foreground",children:["Nenhum estabelecimento encontrado nesta categoria",r&&` em ${r}`]})})]})}),c.jsx(Nh,{})]}):c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Ph,{}),c.jsx("main",{className:"container py-8",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[c.jsx("h1",{className:"font-display text-2xl font-bold mb-2",children:"Todas as Categorias"}),r&&c.jsxs("p",{className:"text-muted-foreground mb-6",children:["em ",r]}),c.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:mH.map((s,_)=>c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:_*.05},children:c.jsxs(Oi,{to:`/categorias/${s.id}`,className:"flex flex-col items-center gap-3 p-6 rounded-2xl bg-card shadow-soft hover:shadow-card transition-all hover:-translate-y-1",children:[c.jsx("div",{className:`w-16 h-16 rounded-xl ${s.color} flex items-center justify-center`,children:c.jsx(s.icon,{className:"w-8 h-8"})}),c.jsx("span",{className:"font-medium text-center",children:s.name})]})},s.id))})]})}),c.jsx(Nh,{})]})},HIe=()=>{const{selectedCityId:e,selectedCityName:t,isLoading:r}=H2(),[n,a]=F.useState([]),[d,p]=F.useState(!0);F.useEffect(()=>{r||(async()=>{p(!0);let C=dt.from("establishments").select("id, name, cover_url, category, rating, min_delivery_time, max_delivery_time, delivery_fee, is_open").eq("is_approved",!0).order("rating",{ascending:!1});e&&(C=C.eq("city_id",e));const{data:P,error:k}=await C;!k&&P&&a(P),p(!1)})()},[e,r]);const s=(T,C)=>!T&&!C?"30-45 min":C?`${T}-${C} min`:`${T} min`,_=T=>!T||T===0?"Grtis":`R$ ${T.toFixed(2).replace(".",",")}`,b=n.map(T=>({id:T.id,name:T.name,image:T.cover_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=500&h=300&fit=crop",category:T.category,rating:T.rating||0,deliveryTime:s(T.min_delivery_time,T.max_delivery_time),deliveryFee:_(T.delivery_fee),isOpen:T.is_open??!1}));return c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Ph,{}),c.jsx("main",{className:"container py-8",children:c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("h1",{className:"font-display text-2xl font-bold",children:"Todos os Restaurantes"}),c.jsx("p",{className:"text-muted-foreground",children:d||r?"Carregando...":`${b.length} estabelecimentos disponveis${t?` em ${t}`:""}`})]}),d||r?c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:[1,2,3,4,5,6,7,8].map(T=>c.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden",children:[c.jsx(fd,{className:"aspect-[16/10] w-full"}),c.jsxs("div",{className:"p-4 space-y-3",children:[c.jsx(fd,{className:"h-5 w-3/4"}),c.jsx(fd,{className:"h-4 w-1/2"}),c.jsx(fd,{className:"h-4 w-2/3"})]})]},T))}):b.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx("p",{className:"text-muted-foreground",children:"Nenhum restaurante encontrado na sua cidade."}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Selecione outra cidade para ver mais opes."})]}):c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6",children:b.map((T,C)=>c.jsx(uk,{restaurant:T,index:C},T.id))})]})}),c.jsx(Nh,{})]})},Ise=({establishmentId:e,onNewOrder:t,onOrderUpdate:r,soundEnabled:n=!0})=>{const[a,d]=F.useState(new Set),p=F.useRef(null),s=F.useRef(null),_=F.useRef(!1);F.useEffect(()=>(p.current=new(window.AudioContext||window.webkitAudioContext),()=>{p.current&&(p.current.close(),p.current=null),s.current&&(clearInterval(s.current),s.current=null)}),[]);const b=F.useCallback(()=>{if(!(!p.current||_.current)){_.current=!0;try{const R=p.current;R.state==="suspended"&&R.resume();const D=R.createOscillator(),G=R.createGain();D.connect(G),G.connect(R.destination),D.frequency.value=880,D.type="sine",G.gain.setValueAtTime(.6,R.currentTime),G.gain.exponentialRampToValueAtTime(.01,R.currentTime+.3),D.start(R.currentTime),D.stop(R.currentTime+.3);const V=R.createOscillator(),$=R.createGain();V.connect($),$.connect(R.destination),V.frequency.value=1100,V.type="sine",$.gain.setValueAtTime(.6,R.currentTime+.15),$.gain.exponentialRampToValueAtTime(.01,R.currentTime+.45),V.start(R.currentTime+.15),V.stop(R.currentTime+.45);const K=R.createOscillator(),Y=R.createGain();K.connect(Y),Y.connect(R.destination),K.frequency.value=1320,K.type="sine",Y.gain.setValueAtTime(.6,R.currentTime+.3),Y.gain.exponentialRampToValueAtTime(.01,R.currentTime+.6),K.start(R.currentTime+.3),K.stop(R.currentTime+.6),setTimeout(()=>{_.current=!1},700)}catch{console.log("Audio notification not supported"),_.current=!1}}},[]);F.useEffect(()=>(a.size>0&&n?(b(),s.current||(s.current=setInterval(()=>{a.size>0&&n&&b()},3e3))):s.current&&(clearInterval(s.current),s.current=null),()=>{s.current&&a.size===0&&(clearInterval(s.current),s.current=null)}),[a.size,n,b]);const T=F.useCallback(R=>{d(D=>{const G=new Set(D);return G.delete(R),G})},[]),C=F.useCallback(()=>{d(new Set),s.current&&(clearInterval(s.current),s.current=null)},[]),P=F.useCallback(R=>{d(D=>{const G=new Set(D);return G.add(R),G})},[]),k=F.useCallback(R=>{R.status==="pending"&&P(R.id),gt.success(c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary rounded-full flex items-center justify-center animate-pulse",children:c.jsx("span",{className:"text-white text-lg",children:""})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold text-base",children:"Novo Pedido!"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",R.order_number," - R$ ",Number(R.total).toFixed(2)]})]})]}),{duration:1/0,position:"top-center",className:"border-2 border-primary bg-card shadow-lg",action:{label:"Ver",onClick:()=>{}}}),"Notification"in window&&Notification.permission==="granted"&&new Notification(" Novo Pedido!",{body:`Pedido #${R.order_number} - R$ ${Number(R.total).toFixed(2)}`,icon:"/pwa-192x192.png",requireInteraction:!0,tag:`order-${R.id}`})},[P]),B=F.useCallback(async()=>{"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()},[]);return F.useEffect(()=>{if(!e)return;(async()=>{const{data:D}=await dt.from("orders").select("id").eq("establishment_id",e).eq("status","pending");D&&D.length>0&&d(new Set(D.map(G=>G.id)))})()},[e]),F.useEffect(()=>{if(!e)return;B();const R=dt.channel(`orders-notification-${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`establishment_id=eq.${e}`},D=>{const G=D.new;k(G),t==null||t(G)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`establishment_id=eq.${e}`},D=>{const G=D.new;G.status!=="pending"&&T(G.id),r==null||r(G)}).subscribe();return()=>{dt.removeChannel(R)}},[e,k,t,r,B,T]),{playNotificationSound:b,requestNotificationPermission:B,stopSoundForOrder:T,stopAllSounds:C,pendingOrdersWithSound:Array.from(a),hasPendingSounds:a.size>0}};var dk="Switch",[ZIe]=hc(dk),[XIe,KIe]=ZIe(dk),kse=F.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:a,defaultChecked:d,required:p,disabled:s,value:_="on",onCheckedChange:b,form:T,...C}=e,[P,k]=F.useState(null),B=Ti(t,$=>k($)),R=F.useRef(!1),D=P?T||!!P.closest("form"):!0,[G,V]=kf({prop:a,defaultProp:d??!1,onChange:b,caller:dk});return c.jsxs(XIe,{scope:r,checked:G,disabled:s,children:[c.jsx(vn.button,{type:"button",role:"switch","aria-checked":G,"aria-required":p,"data-state":Dse(G),"data-disabled":s?"":void 0,disabled:s,value:_,...C,ref:B,onClick:Fr(e.onClick,$=>{V(K=>!K),D&&(R.current=$.isPropagationStopped(),R.current||$.stopPropagation())})}),D&&c.jsx(Mse,{control:P,bubbles:!R.current,name:n,value:_,checked:G,required:p,disabled:s,form:T,style:{transform:"translateX(-100%)"}})]})});kse.displayName=dk;var Ose="SwitchThumb",Rse=F.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,a=KIe(Ose,r);return c.jsx(vn.span,{"data-state":Dse(a.checked),"data-disabled":a.disabled?"":void 0,...n,ref:t})});Rse.displayName=Ose;var YIe="SwitchBubbleInput",Mse=F.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...a},d)=>{const p=F.useRef(null),s=Ti(p,d),_=Tne(r),b=Iee(t);return F.useEffect(()=>{const T=p.current;if(!T)return;const C=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(C,"checked").set;if(_!==r&&k){const B=new Event("click",{bubbles:n});k.call(T,r),T.dispatchEvent(B)}},[_,r,n]),c.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:s,style:{...a.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Mse.displayName=YIe;function Dse(e){return e?"checked":"unchecked"}var Lse=kse,JIe=Rse;const Bs=F.forwardRef(({className:e,...t},r)=>c.jsx(Lse,{className:Dr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:c.jsx(JIe,{className:Dr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Bs.displayName=Lse.displayName;const QIe=[{icon:s4,label:"Dashboard",path:"/estabelecimento"},{icon:xh,label:"Pedidos",path:"/estabelecimento/pedidos"},{icon:cs,label:"Cardpio",path:"/estabelecimento/cardapio"},{icon:Mc,label:"Avaliaes",path:"/estabelecimento/avaliacoes"},{icon:Nm,label:"Formas de Pagamento",path:"/estabelecimento/pagamentos"},{icon:FI,label:"Cashback",path:"/estabelecimento/cashback"},{icon:$2,label:"Carto Fidelidade",path:"/estabelecimento/fidelidade"},{icon:Rc,label:"Faturas",path:"/estabelecimento/faturas"},{icon:bd,label:"Saques",path:"/estabelecimento/saques"},{icon:c3,label:"Extratos",path:"/estabelecimento/extratos"},{icon:n4,label:"Conta Bancria",path:"/estabelecimento/conta-bancaria"},{icon:Tf,label:"Extrato de Entregas",path:"/estabelecimento/extrato-entregas"},{icon:Rf,label:"Entregadores",path:"/estabelecimento/entregadores"},{icon:zi,label:"Entregas",path:"/estabelecimento/entregas"},{icon:V2,label:"Configuraes",path:"/estabelecimento/configuracoes"}],Gl=({open:e=!0,onClose:t,pendingOrdersCount:r=0})=>{const n=di(),a=qf(),{signOut:d}=$i(),p=async()=>{await d(),n("/auth")},s=_=>{n(_),t==null||t()};return c.jsxs(c.Fragment,{children:[e&&c.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:t}),c.jsxs("aside",{className:Dr("fixed lg:static inset-y-0 left-0 z-50 w-64 bg-card border-r transform transition-transform duration-300 flex flex-col",e?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:[c.jsx("div",{className:"p-4 border-b",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-14 w-auto object-contain animate-logo-pulse"}),c.jsxs("div",{children:[c.jsx("span",{className:"font-bold text-lg",children:"Estabelecimento"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Painel de Gesto"})]})]}),c.jsx("button",{className:"lg:hidden",onClick:t,children:c.jsx(wd,{className:"w-5 h-5"})})]})}),c.jsx("nav",{className:"flex-1 p-4 space-y-1",children:QIe.map(_=>{const b=a.pathname===_.path,T=_.path==="/estabelecimento/pedidos"&&r>0;return c.jsxs("button",{onClick:()=>s(_.path),className:Dr("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",b?"bg-orange-500 text-white":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[c.jsx(_.icon,{className:"w-5 h-5"}),_.label,T&&c.jsx(dn,{variant:"destructive",className:"ml-auto",children:r})]},_.path)})}),c.jsx("div",{className:"p-4 border-t",children:c.jsxs("button",{onClick:p,className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-destructive/10 text-destructive",children:[c.jsx(TT,{className:"w-5 h-5"}),"Sair"]})})]})]})},eke=()=>{const e=di(),{user:t,loading:r,isEstablishment:n}=$i(),[a,d]=F.useState(null),[p,s]=F.useState([]),[_,b]=F.useState(!0),[T,C]=F.useState(!1),[P,k]=F.useState(!0),{playNotificationSound:B,stopAllSounds:R,hasPendingSounds:D}=Ise({establishmentId:(a==null?void 0:a.id)||null,soundEnabled:P,onNewOrder:ie=>{s(ge=>[ie,...ge])},onOrderUpdate:ie=>{s(ge=>ge.map(fe=>fe.id===ie.id?ie:fe))}});F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Voc no tem acesso a esta rea"),e("/");return}t&&G()},[t,r,n,e]);const G=async()=>{try{const{data:ie,error:ge}=await dt.from("establishments").select("*").eq("owner_id",t.id).maybeSingle();if(ge)throw ge;ie&&(d(ie),V(ie.id))}catch{gt.error("Erro ao carregar estabelecimento")}finally{b(!1)}},V=async ie=>{const{data:ge,error:fe}=await dt.from("orders").select("*").eq("establishment_id",ie).order("created_at",{ascending:!1}).limit(50);ge&&s(ge)},$=async()=>{if(!a)return;const{error:ie}=await dt.from("establishments").update({is_open:!a.is_open}).eq("id",a.id);ie?gt.error("Erro ao atualizar status"):(d({...a,is_open:!a.is_open}),gt.success(a.is_open?"Loja fechada":"Loja aberta!"))},K=p.filter(ie=>ie.status==="pending"),Y=p.filter(ie=>ie.status==="preparing"),ee=p.filter(ie=>new Date(ie.created_at).toDateString()===new Date().toDateString()),ae=ee.reduce((ie,ge)=>ie+Number(ge.total),0);return r||_?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):a?c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:T,onClose:()=>C(!1),pendingOrdersCount:K.length}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>C(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:a.name}),c.jsx("div",{className:"flex items-center gap-2",children:a.is_approved?c.jsx(dn,{variant:"outline",className:"text-green-600 border-green-600",children:"Aprovado"}):c.jsx(dn,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"Aguardando Aprovao"})})]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:a.is_open?"Aberto":"Fechado"}),c.jsx(Bs,{checked:a.is_open,onCheckedChange:$,className:"data-[state=checked]:bg-green-500"})]}),c.jsxs("button",{onClick:()=>{D?R():(k(!P),P||B())},className:`relative p-2 rounded-lg transition-colors ${D?"bg-destructive/10 hover:bg-destructive/20":P?"hover:bg-muted":"bg-muted/50 text-muted-foreground"}`,title:D?"Clique para silenciar alarme":P?"Som ativado":"Som desativado",children:[c.jsx(lee,{className:`w-5 h-5 ${D?"text-destructive animate-pulse":P?"":"opacity-50"}`}),D&&c.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-destructive text-white text-xs rounded-full flex items-center justify-center",children:"!"})]}),c.jsxs("button",{className:"relative p-2 hover:bg-muted rounded-lg",children:[c.jsx(z2,{className:"w-5 h-5"}),K.length>0&&c.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-destructive text-destructive-foreground text-xs rounded-full flex items-center justify-center animate-pulse",children:K.length})]})]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:c.jsx(xh,{className:"w-6 h-6 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:ee.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Pedidos Hoje"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx($o,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",ae.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Faturamento"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl",children:c.jsx(ki,{className:"w-6 h-6 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:K.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Pendentes"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(cs,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:Y.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Preparando"})]})]})})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Pedidos Recentes"}),c.jsx(Ft,{variant:"outline",size:"sm",onClick:()=>e("/estabelecimento/pedidos"),children:"Ver todos"})]})}),c.jsx(Ut,{children:p.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(xh,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum pedido ainda"}),c.jsx("p",{className:"text-sm",children:"Os pedidos aparecero aqui em tempo real"})]}):c.jsx("div",{className:"space-y-3",children:p.slice(0,5).map(ie=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",ie.order_number]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:ie.customer_name})]}),c.jsxs("div",{className:"text-right",children:[c.jsxs("p",{className:"font-bold text-primary",children:["R$ ",Number(ie.total).toFixed(2)]}),c.jsxs(dn,{variant:ie.status==="pending"?"destructive":ie.status==="preparing"?"default":"outline",children:[ie.status==="pending"&&"Pendente",ie.status==="confirmed"&&"Confirmado",ie.status==="preparing"&&"Preparando",ie.status==="ready"&&"Pronto",ie.status==="out_for_delivery"&&"Em entrega",ie.status==="delivered"&&"Entregue",ie.status==="cancelled"&&"Cancelado"]})]})]},ie.id))})})]})]})]})]}):c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx(Vt,{className:"max-w-md mx-4",children:c.jsxs(Ut,{className:"pt-6 text-center",children:[c.jsx(Bi,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),c.jsx("h2",{className:"text-xl font-bold mb-2",children:"Nenhum estabelecimento encontrado"}),c.jsx("p",{className:"text-muted-foreground mb-4",children:"Voc ainda no cadastrou seu estabelecimento."}),c.jsx(Ft,{onClick:()=>e("/auth?mode=register-establishment"),children:"Cadastrar Estabelecimento"})]})})})},nh={pending:{label:"Pendente",color:"bg-yellow-500",icon:ki},confirmed:{label:"Confirmado",color:"bg-blue-500",icon:Da},preparing:{label:"Preparando",color:"bg-orange-500",icon:nee},ready:{label:"Pronto",color:"bg-green-500",icon:cs},out_for_delivery:{label:"Em Entrega",color:"bg-purple-500",icon:Tf},delivered:{label:"Entregue",color:"bg-green-700",icon:Da},cancelled:{label:"Cancelado",color:"bg-red-500",icon:Of}},tke=()=>{const e=di(),{user:t,loading:r,isEstablishment:n}=$i(),[a,d]=F.useState([]),[p,s]=F.useState({}),[_,b]=F.useState(!0),[T,C]=F.useState(null),[P,k]=F.useState(null),[B,R]=F.useState("all"),[D,G]=F.useState(!0),[V,$]=F.useState(!1),{playNotificationSound:K}=Ise({establishmentId:P,soundEnabled:D,onNewOrder:ue=>{d(Ce=>[ue,...Ce]),ae(ue.id)},onOrderUpdate:ue=>{d(Ce=>Ce.map(ve=>ve.id===ue.id?ue:ve))}});F.useEffect(()=>{if(!r&&(!t||!n)){e("/auth");return}t&&Y()},[t,r,n,e]);const Y=async()=>{try{const{data:ue}=await dt.from("establishments").select("id").eq("owner_id",t.id).maybeSingle();ue&&(k(ue.id),await ee(ue.id))}catch{gt.error("Erro ao carregar pedidos")}finally{b(!1)}},ee=async ue=>{const{data:Ce,error:ve}=await dt.from("orders").select("*").eq("establishment_id",ue).order("created_at",{ascending:!1});Ce&&(d(Ce),Ce.forEach(ze=>ae(ze.id)))},ae=async ue=>{const{data:Ce}=await dt.from("order_items").select("*").eq("order_id",ue);Ce&&s(ve=>({...ve,[ue]:Ce}))},ie=async(ue,Ce)=>{const ve={confirmed:"confirmed_at",preparing:"preparing_at",ready:"ready_at",out_for_delivery:"out_for_delivery_at",delivered:"delivered_at",cancelled:"cancelled_at"}[Ce],ze={status:Ce};ve&&(ze[ve]=new Date().toISOString());const{error:Me}=await dt.from("orders").update(ze).eq("id",ue);Me?gt.error("Erro ao atualizar pedido"):gt.success(`Pedido atualizado para: ${nh[Ce].label}`)},ge=a.filter(ue=>B==="all"?!0:ue.status===B),fe=ue=>({pending:"confirmed",confirmed:"preparing",preparing:"ready",ready:"out_for_delivery",out_for_delivery:"delivered",delivered:null,cancelled:null})[ue];if(r||_)return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})});const be=a.filter(ue=>ue.status==="pending").length;return c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:V,onClose:()=>$(!1),pendingOrdersCount:be}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>$(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Pedidos"})]}),c.jsx("button",{onClick:()=>{G(!D),D||K()},className:`p-2 rounded-lg transition-colors ${D?"hover:bg-muted":"bg-muted/50 text-muted-foreground"}`,title:D?"Som ativado":"Som desativado",children:c.jsx(lee,{className:`w-5 h-5 ${D?"":"opacity-50"}`})})]})}),c.jsxs("div",{className:"p-4 lg:p-6",children:[c.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide",children:[c.jsxs(Ft,{variant:B==="all"?"default":"outline",size:"sm",onClick:()=>R("all"),children:["Todos (",a.length,")"]}),Object.keys(nh).map(ue=>{const Ce=a.filter(ve=>ve.status===ue).length;return c.jsxs(Ft,{variant:B===ue?"default":"outline",size:"sm",onClick:()=>R(ue),className:"whitespace-nowrap",children:[nh[ue].label," (",Ce,")"]},ue)})]}),c.jsx("div",{className:"grid gap-4 lg:grid-cols-2 xl:grid-cols-3",children:c.jsx(ju,{children:ge.map(ue=>{const Ce=nh[ue.status].icon,ve=p[ue.id]||[],ze=fe(ue.status);return c.jsx(gr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},layout:!0,children:c.jsxs(Vt,{className:`cursor-pointer transition-shadow hover:shadow-lg ${ue.status==="pending"?"border-yellow-500 border-2":""}`,onClick:()=>C(ue),children:[c.jsx(Wr,{className:"pb-2",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Hr,{className:"text-lg",children:["Pedido #",ue.order_number]}),c.jsxs(dn,{className:`${nh[ue.status].color} text-white`,children:[c.jsx(Ce,{className:"w-3 h-3 mr-1"}),nh[ue.status].label]})]})}),c.jsxs(Ut,{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(to,{className:"w-4 h-4"}),ue.customer_name]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(ki,{className:"w-4 h-4"}),new Date(ue.created_at).toLocaleString("pt-BR")]}),c.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[ve.slice(0,2).map(Me=>c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsxs("span",{children:[Me.quantity,"x ",Me.product_name]}),c.jsxs("span",{className:"text-muted-foreground",children:["R$ ",Number(Me.subtotal).toFixed(2)]})]},Me.id)),ve.length>2&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["+",ve.length-2," itens"]})]}),c.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[c.jsxs("span",{className:"font-bold text-lg text-primary",children:["R$ ",Number(ue.total).toFixed(2)]}),ze&&c.jsx(Ft,{size:"sm",onClick:Me=>{Me.stopPropagation(),ie(ue.id,ze)},children:nh[ze].label})]})]})]})},ue.id)})})}),ge.length===0&&c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(cs,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),c.jsx("p",{className:"text-lg",children:"Nenhum pedido encontrado"})]})]})]}),c.jsx(ju,{children:T&&c.jsx(gr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>C(null),children:c.jsx(gr.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:ue=>ue.stopPropagation(),className:"bg-card rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:c.jsxs("div",{className:"p-6 space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("h2",{className:"text-xl font-bold",children:["Pedido #",T.order_number]}),c.jsx(dn,{className:`${nh[T.status].color} text-white`,children:nh[T.status].label})]}),c.jsxs("div",{className:"bg-muted/50 rounded-xl p-4 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(to,{className:"w-4 h-4 text-primary"}),c.jsx("span",{className:"font-medium",children:T.customer_name})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),c.jsx("span",{children:T.customer_phone})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(zi,{className:"w-4 h-4 text-primary mt-0.5"}),c.jsx("span",{children:T.delivery_address})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),c.jsx("div",{className:"space-y-2",children:(p[T.id]||[]).map(ue=>c.jsxs("div",{className:"flex justify-between items-center bg-muted/30 rounded-lg p-3",children:[c.jsxs("div",{children:[c.jsxs("span",{className:"font-medium",children:[ue.quantity,"x ",ue.product_name]}),ue.notes&&c.jsx("p",{className:"text-xs text-muted-foreground",children:ue.notes})]}),c.jsxs("span",{className:"font-medium",children:["R$ ",Number(ue.subtotal).toFixed(2)]})]},ue.id))})]}),T.notes&&c.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4",children:[c.jsx("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Observaes:"}),c.jsx("p",{className:"text-sm",children:T.notes})]}),c.jsxs("div",{className:"border-t pt-4 space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:"Subtotal"}),c.jsxs("span",{children:["R$ ",Number(T.subtotal).toFixed(2)]})]}),c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:"Taxa de entrega"}),c.jsxs("span",{children:["R$ ",Number(T.delivery_fee).toFixed(2)]})]}),Number(T.discount)>0&&c.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[c.jsx("span",{children:"Desconto"}),c.jsxs("span",{children:["-R$ ",Number(T.discount).toFixed(2)]})]}),c.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[c.jsx("span",{children:"Total"}),c.jsxs("span",{className:"text-primary",children:["R$ ",Number(T.total).toFixed(2)]})]})]}),c.jsxs("div",{className:"flex gap-2 pt-4",children:[T.status==="pending"&&c.jsxs(Ft,{variant:"destructive",className:"flex-1",onClick:()=>{ie(T.id,"cancelled"),C(null)},children:[c.jsx(Of,{className:"w-4 h-4 mr-2"}),"Recusar"]}),fe(T.status)&&c.jsxs(Ft,{className:"flex-1",onClick:()=>{ie(T.id,fe(T.status)),C(null)},children:[c.jsx(Da,{className:"w-4 h-4 mr-2"}),nh[fe(T.status)].label]})]})]})})})})]})},Ih=F.forwardRef(({className:e,...t},r)=>c.jsx("textarea",{className:Dr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));Ih.displayName="Textarea";const rke=()=>{const e=di(),{user:t,loading:r,isEstablishment:n}=$i(),[a,d]=F.useState(null),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(!1),[B,R]=F.useState(!1),[D,G]=F.useState(!1),[V,$]=F.useState(null),[K,Y]=F.useState(null),[ee,ae]=F.useState({name:"",description:""}),[ie,ge]=F.useState({name:"",description:"",price:"",original_price:"",image_url:"",category_id:"",is_available:!0,is_featured:!1});F.useEffect(()=>{if(!r&&(!t||!n)){e("/auth");return}t&&fe()},[t,r,n,e]);const fe=async()=>{try{const{data:Ee}=await dt.from("establishments").select("id").eq("owner_id",t.id).maybeSingle();Ee&&(d(Ee.id),await Promise.all([be(Ee.id),ue(Ee.id)]))}catch{gt.error("Erro ao carregar dados")}finally{C(!1)}},be=async Ee=>{const{data:ot}=await dt.from("product_categories").select("*").eq("establishment_id",Ee).order("sort_order");ot&&s(ot)},ue=async Ee=>{const{data:ot}=await dt.from("products").select("*").eq("establishment_id",Ee).order("sort_order");ot&&b(ot)},Ce=async()=>{if(a)try{V?(await dt.from("product_categories").update({name:ee.name,description:ee.description}).eq("id",V.id),gt.success("Categoria atualizada!")):(await dt.from("product_categories").insert({establishment_id:a,name:ee.name,description:ee.description}),gt.success("Categoria criada!")),R(!1),$(null),ae({name:"",description:""}),be(a)}catch{gt.error("Erro ao salvar categoria")}},ve=async Ee=>{confirm("Excluir esta categoria?")&&(await dt.from("product_categories").delete().eq("id",Ee),gt.success("Categoria excluda"),a&&be(a))},ze=async()=>{if(a)try{const Ee={establishment_id:a,name:ie.name,description:ie.description,price:parseFloat(ie.price),original_price:ie.original_price?parseFloat(ie.original_price):null,image_url:ie.image_url||null,category_id:ie.category_id||null,is_available:ie.is_available,is_featured:ie.is_featured};K?(await dt.from("products").update(Ee).eq("id",K.id),gt.success("Produto atualizado!")):(await dt.from("products").insert(Ee),gt.success("Produto criado!")),G(!1),Y(null),ge({name:"",description:"",price:"",original_price:"",image_url:"",category_id:"",is_available:!0,is_featured:!1}),ue(a)}catch{gt.error("Erro ao salvar produto")}},Me=async Ee=>{confirm("Excluir este produto?")&&(await dt.from("products").delete().eq("id",Ee),gt.success("Produto excludo"),a&&ue(a))},Be=async Ee=>{await dt.from("products").update({is_available:!Ee.is_available}).eq("id",Ee.id),a&&ue(a)},Ve=Ee=>{$(Ee),ae({name:Ee.name,description:Ee.description||""}),R(!0)},We=Ee=>{Y(Ee),ge({name:Ee.name,description:Ee.description||"",price:String(Ee.price),original_price:Ee.original_price?String(Ee.original_price):"",image_url:Ee.image_url||"",category_id:Ee.category_id||"",is_available:Ee.is_available,is_featured:Ee.is_featured}),G(!0)};return r||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:P,onClose:()=>k(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>k(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Cardpio"})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Zve,{className:"w-5 h-5"}),"Categorias"]}),c.jsxs(Ft,{size:"sm",onClick:()=>{$(null),ae({name:"",description:""}),R(!0)},children:[c.jsx(dc,{className:"w-4 h-4 mr-1"}),"Nova Categoria"]})]})}),c.jsx(Ut,{children:p.length===0?c.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhuma categoria criada"}):c.jsx("div",{className:"grid gap-2",children:p.map(Ee=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:Ee.name}),Ee.description&&c.jsx("p",{className:"text-sm text-muted-foreground",children:Ee.description})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>Ve(Ee),children:c.jsx(Im,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>ve(Ee.id),children:c.jsx(xd,{className:"w-4 h-4 text-destructive"})})]})]},Ee.id))})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(cs,{className:"w-5 h-5"}),"Produtos (",_.length,")"]}),c.jsxs(Ft,{size:"sm",onClick:()=>{Y(null),ge({name:"",description:"",price:"",original_price:"",image_url:"",category_id:"",is_available:!0,is_featured:!1}),G(!0)},children:[c.jsx(dc,{className:"w-4 h-4 mr-1"}),"Novo Produto"]})]})}),c.jsx(Ut,{children:_.length===0?c.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhum produto criado"}):c.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:_.map(Ee=>{const ot=p.find(yt=>yt.id===Ee.category_id);return c.jsxs(gr.div,{initial:{opacity:0},animate:{opacity:1},className:`bg-muted/50 rounded-xl overflow-hidden ${Ee.is_available?"":"opacity-60"}`,children:[Ee.image_url?c.jsx("img",{src:Ee.image_url,alt:Ee.name,className:"w-full h-32 object-cover"}):c.jsx("div",{className:"w-full h-32 bg-muted flex items-center justify-center",children:c.jsx(OP,{className:"w-8 h-8 text-muted-foreground"})}),c.jsxs("div",{className:"p-4",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:Ee.name}),ot&&c.jsx(dn,{variant:"outline",className:"text-xs",children:ot.name})]}),c.jsx("div",{className:"flex items-center gap-1",children:Ee.is_featured&&c.jsx(dn,{variant:"default",className:"text-xs",children:"Destaque"})})]}),Ee.description&&c.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:Ee.description}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsxs("span",{className:"font-bold text-primary",children:["R$ ",Number(Ee.price).toFixed(2)]}),Ee.original_price&&c.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["R$ ",Number(Ee.original_price).toFixed(2)]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:Ee.is_available,onCheckedChange:()=>Be(Ee)}),c.jsx("span",{className:"text-sm text-muted-foreground",children:Ee.is_available?"Disponvel":"Indisponvel"})]}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>We(Ee),children:c.jsx(Im,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>Me(Ee.id),children:c.jsx(xd,{className:"w-4 h-4 text-destructive"})})]})]})]})]},Ee.id)})})})]})]})]}),c.jsx(ju,{children:B&&c.jsx(gr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>R(!1),children:c.jsxs(gr.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:Ee=>Ee.stopPropagation(),className:"bg-card rounded-2xl p-6 w-full max-w-md",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-xl font-bold",children:V?"Editar Categoria":"Nova Categoria"}),c.jsx("button",{onClick:()=>R(!1),className:"p-1 hover:bg-muted rounded",children:c.jsx(wd,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"categoryName",children:"Nome da Categoria"}),c.jsx(ar,{id:"categoryName",value:ee.name,onChange:Ee=>ae({...ee,name:Ee.target.value}),placeholder:"Ex: Lanches, Bebidas..."})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"categoryDesc",children:"Descrio (opcional)"}),c.jsx(Ih,{id:"categoryDesc",value:ee.description,onChange:Ee=>ae({...ee,description:Ee.target.value}),placeholder:"Descrio da categoria"})]}),c.jsx(Ft,{onClick:Ce,className:"w-full",children:"Salvar Categoria"})]})]})})}),c.jsx(ju,{children:D&&c.jsx(gr.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4 overflow-y-auto",onClick:()=>G(!1),children:c.jsxs(gr.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:Ee=>Ee.stopPropagation(),className:"bg-card rounded-2xl p-6 w-full max-w-lg my-8",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h2",{className:"text-xl font-bold",children:K?"Editar Produto":"Novo Produto"}),c.jsx("button",{onClick:()=>G(!1),className:"p-1 hover:bg-muted rounded",children:c.jsx(wd,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productName",children:"Nome do Produto *"}),c.jsx(ar,{id:"productName",value:ie.name,onChange:Ee=>ge({...ie,name:Ee.target.value}),placeholder:"Ex: X-Burger"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productDesc",children:"Descrio"}),c.jsx(Ih,{id:"productDesc",value:ie.description,onChange:Ee=>ge({...ie,description:Ee.target.value}),placeholder:"Descrio do produto"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productPrice",children:"Preo *"}),c.jsxs("div",{className:"relative",children:[c.jsx($o,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"productPrice",type:"number",step:"0.01",value:ie.price,onChange:Ee=>ge({...ie,price:Ee.target.value}),placeholder:"0.00",className:"pl-9"})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productOriginalPrice",children:"Preo Original"}),c.jsx(ar,{id:"productOriginalPrice",type:"number",step:"0.01",value:ie.original_price,onChange:Ee=>ge({...ie,original_price:Ee.target.value}),placeholder:"Para promoes"})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productImage",children:"URL da Imagem"}),c.jsx(ar,{id:"productImage",value:ie.image_url,onChange:Ee=>ge({...ie,image_url:Ee.target.value}),placeholder:"https://..."})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"productCategory",children:"Categoria"}),c.jsxs("select",{id:"productCategory",value:ie.category_id,onChange:Ee=>ge({...ie,category_id:Ee.target.value}),className:"w-full h-10 px-3 rounded-md border bg-background",children:[c.jsx("option",{value:"",children:"Sem categoria"}),p.map(Ee=>c.jsx("option",{value:Ee.id,children:Ee.name},Ee.id))]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:ie.is_available,onCheckedChange:Ee=>ge({...ie,is_available:Ee})}),c.jsx(zt,{children:"Disponvel"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:ie.is_featured,onCheckedChange:Ee=>ge({...ie,is_featured:Ee})}),c.jsx(zt,{children:"Destaque"})]})]}),c.jsx(Ft,{onClick:ze,className:"w-full",disabled:!ie.name||!ie.price,children:"Salvar Produto"})]})]})})})]})},nke=[{key:"monday",label:"Segunda-feira"},{key:"tuesday",label:"Tera-feira"},{key:"wednesday",label:"Quarta-feira"},{key:"thursday",label:"Quinta-feira"},{key:"friday",label:"Sexta-feira"},{key:"saturday",label:"Sbado"},{key:"sunday",label:"Domingo"}],sh={monday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},tuesday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},wednesday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},thursday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},friday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},saturday:{isOpen:!0,openTime:"08:00",closeTime:"22:00"},sunday:{isOpen:!1,openTime:"08:00",closeTime:"22:00"}},T5=({value:e,onChange:t})=>{const r={monday:(e==null?void 0:e.monday)??sh.monday,tuesday:(e==null?void 0:e.tuesday)??sh.tuesday,wednesday:(e==null?void 0:e.wednesday)??sh.wednesday,thursday:(e==null?void 0:e.thursday)??sh.thursday,friday:(e==null?void 0:e.friday)??sh.friday,saturday:(e==null?void 0:e.saturday)??sh.saturday,sunday:(e==null?void 0:e.sunday)??sh.sunday},n=(a,d,p)=>{t({...r,[a]:{...r[a],[d]:p}})};return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(ki,{className:"w-5 h-5 text-primary"}),c.jsx(zt,{className:"text-base font-medium",children:"Horrio de Funcionamento"})]}),c.jsx("div",{className:"space-y-3",children:nke.map(({key:a,label:d})=>c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between sm:w-40",children:[c.jsx("span",{className:"font-medium text-sm",children:d}),c.jsx(Bs,{checked:r[a].isOpen,onCheckedChange:p=>n(a,"isOpen",p)})]}),r[a].isOpen?c.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(zt,{htmlFor:`${a}-open`,className:"text-sm text-muted-foreground whitespace-nowrap",children:"Abre:"}),c.jsx(ar,{id:`${a}-open`,type:"time",value:r[a].openTime,onChange:p=>n(a,"openTime",p.target.value),className:"w-28"})]}),c.jsx("span",{className:"text-muted-foreground",children:"-"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(zt,{htmlFor:`${a}-close`,className:"text-sm text-muted-foreground whitespace-nowrap",children:"Fecha:"}),c.jsx(ar,{id:`${a}-close`,type:"time",value:r[a].closeTime,onChange:p=>n(a,"closeTime",p.target.value),className:"w-28"})]})]}):c.jsx("span",{className:"text-sm text-muted-foreground italic",children:"Fechado"})]},a))})]})},I0=({value:e,onChange:t,folder:r,label:n,aspectRatio:a="square",className:d})=>{const[p,s]=F.useState(!1),_=F.useRef(null),b=async C=>{var k;const P=(k=C.target.files)==null?void 0:k[0];if(P){if(!P.type.startsWith("image/")){gt.error("Por favor, selecione uma imagem vlida");return}if(P.size>5*1024*1024){gt.error("A imagem deve ter no mximo 5MB");return}s(!0);try{const{data:B}=await dt.auth.getUser();if(!B.user)throw new Error("Usurio no autenticado");const R=P.name.split(".").pop(),D=`${B.user.id}/${r}/${Date.now()}.${R}`,{error:G}=await dt.storage.from("establishments").upload(D,P,{cacheControl:"3600",upsert:!1});if(G)throw G;const{data:V}=dt.storage.from("establishments").getPublicUrl(D);t(V.publicUrl),gt.success("Imagem enviada com sucesso!")}catch(B){console.error("Erro no upload:",B),gt.error(B.message||"Erro ao enviar imagem")}finally{s(!1),_.current&&(_.current.value="")}}},T=()=>{t(null)};return c.jsxs("div",{className:Dr("space-y-2",d),children:[c.jsx("p",{className:"text-sm font-medium",children:n}),c.jsx("div",{className:Dr("relative border-2 border-dashed border-muted-foreground/30 rounded-lg overflow-hidden transition-colors hover:border-primary/50",a==="banner"?"aspect-[3/1]":"aspect-square w-32"),children:e?c.jsxs(c.Fragment,{children:[c.jsx("img",{src:e,alt:n,className:"w-full h-full object-cover"}),c.jsx("button",{type:"button",onClick:T,className:"absolute top-2 right-2 p-1 bg-destructive text-destructive-foreground rounded-full hover:bg-destructive/90 transition-colors",children:c.jsx(wd,{className:"w-4 h-4"})})]}):c.jsxs("label",{className:Dr("flex flex-col items-center justify-center w-full h-full cursor-pointer",p&&"pointer-events-none"),children:[p?c.jsx(Ma,{className:"w-8 h-8 text-muted-foreground animate-spin"}):c.jsxs(c.Fragment,{children:[c.jsx(OP,{className:"w-8 h-8 text-muted-foreground mb-2"}),c.jsx("span",{className:"text-xs text-muted-foreground text-center px-2",children:"Clique para enviar"})]}),c.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:b,className:"hidden",disabled:p})]})})]})},ike=()=>{const e=di(),{user:t,loading:r,isEstablishment:n}=$i(),[a,d]=F.useState(null),[p,s]=F.useState(!0),[_,b]=F.useState(!1),[T,C]=F.useState(!1),[P,k]=F.useState(sh),[B,R]=F.useState(null),[D,G]=F.useState(null),[V,$]=F.useState([]),[K,Y]=F.useState(""),[ee,ae]=F.useState({name:"",description:"",category:"restaurant",phone:"",address:"",city:"",neighborhood:"",delivery_fee:"",min_delivery_time:"",max_delivery_time:"",min_order_value:"",is_open:!1});F.useEffect(()=>{if(!r&&(!t||!n)){e("/auth");return}t&&(ge(),ie())},[t,r,n,e]);const ie=async()=>{const{data:ue,error:Ce}=await dt.from("cities").select("id, name, state").eq("is_active",!0).order("name");!Ce&&ue&&$(ue)},ge=async()=>{try{const{data:ue,error:Ce}=await dt.from("establishments").select("*").eq("owner_id",t.id).maybeSingle();if(Ce)throw Ce;ue&&(d(ue),ae({name:ue.name||"",description:ue.description||"",category:ue.category||"restaurant",phone:ue.phone||"",address:ue.address||"",city:ue.city||"",neighborhood:ue.neighborhood||"",delivery_fee:ue.delivery_fee?String(ue.delivery_fee):"",min_delivery_time:ue.min_delivery_time?String(ue.min_delivery_time):"",max_delivery_time:ue.max_delivery_time?String(ue.max_delivery_time):"",min_order_value:ue.min_order_value?String(ue.min_order_value):"",is_open:ue.is_open||!1}),Y(ue.city_id||""),R(ue.logo_url||null),G(ue.cover_url||null),ue.opening_hours&&typeof ue.opening_hours=="object"&&k(ue.opening_hours))}catch{gt.error("Erro ao carregar dados")}finally{s(!1)}},fe=async()=>{if(a){b(!0);try{const ue=V.find(ve=>ve.id===K),{error:Ce}=await dt.from("establishments").update({name:ee.name,description:ee.description,category:ee.category,phone:ee.phone,address:ee.address,city:ue?`${ue.name} - ${ue.state}`:ee.city,city_id:K||null,neighborhood:ee.neighborhood,delivery_fee:ee.delivery_fee?parseFloat(ee.delivery_fee):0,min_delivery_time:ee.min_delivery_time?parseInt(ee.min_delivery_time):30,max_delivery_time:ee.max_delivery_time?parseInt(ee.max_delivery_time):60,min_order_value:ee.min_order_value?parseFloat(ee.min_order_value):0,logo_url:B,cover_url:D,is_open:ee.is_open,opening_hours:JSON.parse(JSON.stringify(P))}).eq("id",a.id);if(Ce)throw Ce;gt.success("Configuraes salvas!")}catch{gt.error("Erro ao salvar")}finally{b(!1)}}},be=ue=>{ae({...ee,[ue.target.name]:ue.target.value})};return r||p?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:T,onClose:()=>C(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>C(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Configuraes"})]}),c.jsxs(Ft,{onClick:fe,disabled:_,children:[c.jsx(E0,{className:"w-4 h-4 mr-2"}),_?"Salvando...":"Salvar"]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-3xl mx-auto",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(zt,{className:"text-base font-medium",children:"Estabelecimento Aberto"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes podem fazer pedidos quando aberto"})]}),c.jsx(Bs,{checked:ee.is_open,onCheckedChange:ue=>ae({...ee,is_open:ue})})]})})}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsx(Hr,{children:"Imagens"}),c.jsx(zo,{children:"Logo e capa do seu estabelecimento"})]}),c.jsx(Ut,{children:c.jsxs("div",{className:"flex flex-wrap gap-6",children:[c.jsx(I0,{value:B,onChange:R,folder:"logos",label:"Logo",aspectRatio:"square"}),c.jsx(I0,{value:D,onChange:G,folder:"covers",label:"Imagem de Capa",aspectRatio:"banner",className:"flex-1 min-w-[200px]"})]})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Bi,{className:"w-5 h-5"}),"Informaes Bsicas"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"name",children:"Nome do Estabelecimento"}),c.jsx(ar,{id:"name",name:"name",value:ee.name,onChange:be,placeholder:"Nome do seu negcio"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"category",children:"Categoria"}),c.jsxs(ns,{value:ee.category,onValueChange:ue=>ae({...ee,category:ue}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione a categoria"})}),c.jsx(Qi,{children:S5.map(ue=>c.jsx(sn,{value:ue.value,children:ue.label},ue.value))})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"description",children:"Descrio"}),c.jsx(Ih,{id:"description",name:"description",value:ee.description,onChange:be,placeholder:"Descreva seu estabelecimento",rows:3})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"phone",children:"Telefone/WhatsApp"}),c.jsxs("div",{className:"relative",children:[c.jsx($c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"phone",name:"phone",value:ee.phone,onChange:be,placeholder:"(00) 00000-0000",className:"pl-9"})]})]})]})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(ki,{className:"w-5 h-5"}),"Horrio de Funcionamento"]}),c.jsx(zo,{children:"Configure os horrios de abertura e fechamento para cada dia"})]}),c.jsx(Ut,{children:c.jsx(T5,{value:P,onChange:k})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(zi,{className:"w-5 h-5"}),"Endereo"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"address",children:"Endereo Completo"}),c.jsx(ar,{id:"address",name:"address",value:ee.address,onChange:be,placeholder:"Rua, nmero..."})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"neighborhood",children:"Bairro"}),c.jsx(ar,{id:"neighborhood",name:"neighborhood",value:ee.neighborhood,onChange:be,placeholder:"Bairro"})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Cidade"}),c.jsxs(ns,{value:K,onValueChange:Y,children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione a cidade"})}),c.jsx(Qi,{children:V.map(ue=>c.jsxs(sn,{value:ue.id,children:[ue.name," - ",ue.state]},ue.id))})]})]})]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx($o,{className:"w-5 h-5"}),"Configuraes de Entrega"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"min_delivery_time",children:"Tempo Mnimo (min)"}),c.jsx(ar,{id:"min_delivery_time",name:"min_delivery_time",type:"number",value:ee.min_delivery_time,onChange:be,placeholder:"30"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"max_delivery_time",children:"Tempo Mximo (min)"}),c.jsx(ar,{id:"max_delivery_time",name:"max_delivery_time",type:"number",value:ee.max_delivery_time,onChange:be,placeholder:"60"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"delivery_fee",children:"Taxa de Entrega (R$)"}),c.jsxs("div",{className:"relative",children:[c.jsx($o,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"delivery_fee",name:"delivery_fee",type:"number",step:"0.01",value:ee.delivery_fee,onChange:be,placeholder:"5.00",className:"pl-9"})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"min_order_value",children:"Pedido Mnimo (R$)"}),c.jsxs("div",{className:"relative",children:[c.jsx($o,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"min_order_value",name:"min_order_value",type:"number",step:"0.01",value:ee.min_order_value,onChange:be,placeholder:"0.00",className:"pl-9"})]})]})]})]})]}),c.jsx("div",{className:"pb-6",children:c.jsxs(Ft,{onClick:fe,disabled:_,className:"w-full",size:"lg",children:[c.jsx(E0,{className:"w-4 h-4 mr-2"}),_?"Salvando...":"Salvar Alteraes"]})})]})]})]})},jd=()=>{const e=di(),{user:t,loading:r,isEstablishment:n}=$i(),[a,d]=F.useState(null),[p,s]=F.useState(!0);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Voc no tem acesso a esta rea"),e("/");return}t&&_()},[t,r,n,e]);const _=async()=>{try{const{data:b,error:T}=await dt.from("establishments").select("*").eq("owner_id",t.id).maybeSingle();if(T)throw T;d(b)}catch{gt.error("Erro ao carregar estabelecimento")}finally{s(!1)}};return{establishment:a,loading:r||p,user:t}},ske=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:P}=await dt.from("reviews").select("*, orders(order_number, customer_name)").eq("establishment_id",r.id).order("created_at",{ascending:!1});d(P||[]),s(!1)},b=a.length>0?(a.reduce((P,k)=>P+(k.establishment_rating||0),0)/a.length).toFixed(1):"0.0",T=a.filter(P=>(P.establishment_rating||0)>=4).length,C=a.filter(P=>(P.establishment_rating||0)<3).length;return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Avaliaes"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl",children:c.jsx(Mc,{className:"w-6 h-6 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:b}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nota Mdia"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(m_e,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:T}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Avaliaes Positivas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-xl",children:c.jsx(p_e,{className:"w-6 h-6 text-red-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:C}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Avaliaes Negativas"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Avaliaes Recentes"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Mc,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma avaliao ainda"})]}):c.jsx("div",{className:"space-y-3",children:a.map(P=>{var k,B;return c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(R=>c.jsx(Mc,{className:`w-4 h-4 ${R<=(P.establishment_rating||0)?"text-yellow-500 fill-yellow-500":"text-muted-foreground"}`},R))}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",((k=P.orders)==null?void 0:k.order_number)||""]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[((B=P.orders)==null?void 0:B.customer_name)||"Cliente","  ",new Date(P.created_at).toLocaleDateString("pt-BR")]}),P.establishment_comment&&c.jsxs("p",{className:"text-sm mt-1 italic",children:['"',P.establishment_comment,'"']})]})]}),c.jsxs(dn,{variant:P.establishment_rating>=4?"default":P.establishment_rating>=3?"secondary":"destructive",children:[P.establishment_rating,"/5"]})]},P.id)})})})]})]})]})]})},kD=[{key:"pix",icon:a4,name:"PIX",description:"Pagamento instantneo"},{key:"credit_card",icon:Nm,name:"Carto de Crdito",description:"Visa, Mastercard, Elo"},{key:"debit_card",icon:Nm,name:"Carto de Dbito",description:"Todas as bandeiras"},{key:"cash",icon:Ty,name:"Dinheiro",description:"Pagamento na entrega"},{key:"wallet",icon:bd,name:"Carteira Digital",description:"PicPay, Mercado Pago"}],ake=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState({}),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:T}=await dt.from("establishment_payment_methods").select("*").eq("establishment_id",r.id);if(T&&T.length>0){const C={};T.forEach(P=>{C[P.method_key]=P.is_enabled}),d(C)}else{const C={};kD.forEach(k=>{C[k.key]=k.key!=="wallet"}),d(C);const P=kD.map(k=>({establishment_id:r.id,method_key:k.key,method_name:k.name,description:k.description,is_enabled:k.key!=="wallet"}));await dt.from("establishment_payment_methods").insert(P)}s(!1)},b=async T=>{const C=!a[T];d(k=>({...k,[T]:C}));const{error:P}=await dt.from("establishment_payment_methods").update({is_enabled:C}).eq("establishment_id",r.id).eq("method_key",T);P&&(gt.error("Erro ao atualizar mtodo de pagamento"),d(k=>({...k,[T]:!C})))};return n||p?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Formas de Pagamento"})]})}),c.jsx("div",{className:"p-4 lg:p-6 space-y-6",children:c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Mtodos Aceitos"})}),c.jsx(Ut,{className:"space-y-4",children:kD.map(T=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:c.jsx(T.icon,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:T.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:T.description})]})]}),c.jsx(Bs,{checked:a[T.key]??!1,onCheckedChange:()=>b(T.key)})]},T.key))})]})})]})]})},oke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState(!1),[p,s]=F.useState("5"),[_,b]=F.useState(!1),[T,C]=F.useState(!0);F.useEffect(()=>{r&&P()},[r]);const P=async()=>{const{data:B}=await dt.from("establishment_settings").select("*").eq("establishment_id",r.id).maybeSingle();B&&(d(B.cashback_enabled),s(String(B.cashback_percent))),C(!1)},k=async()=>{b(!0);const{data:B}=await dt.from("establishment_settings").select("id").eq("establishment_id",r.id).maybeSingle(),R={establishment_id:r.id,cashback_enabled:a,cashback_percent:Number(p)||5};let D;B?{error:D}=await dt.from("establishment_settings").update(R).eq("id",B.id):{error:D}=await dt.from("establishment_settings").insert(R),D?gt.error("Erro ao salvar configuraes"):gt.success("Configuraes salvas!"),b(!1)};return n||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Cashback"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(FI,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:[p,"%"]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Taxa de Cashback"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(Rf,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:a?"Ativo":"Inativo"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl",children:c.jsx($o,{className:"w-6 h-6 text-orange-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:"R$ 0,00"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Distribudo"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Configuraes de Cashback"})}),c.jsxs(Ut,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Ativar Cashback"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes ganham cashback em cada compra"})]}),c.jsx(Bs,{checked:a,onCheckedChange:d})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Porcentagem de Cashback (%)"}),c.jsx(ar,{type:"number",value:p,onChange:B=>s(B.target.value),placeholder:"5",min:"1",max:"20"})]}),c.jsx(Ft,{className:"w-full",onClick:k,disabled:_,children:_?"Salvando...":"Salvar Configuraes"})]})]})]})]})]})},lke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState(!1),[p,s]=F.useState("10"),[_,b]=F.useState(""),[T,C]=F.useState(!1),[P,k]=F.useState(!0);F.useEffect(()=>{r&&B()},[r]);const B=async()=>{const{data:D}=await dt.from("establishment_settings").select("*").eq("establishment_id",r.id).maybeSingle();D&&(d(D.loyalty_enabled),s(String(D.loyalty_stamps_required)),b(D.loyalty_reward_description||"")),k(!1)},R=async()=>{C(!0);const{data:D}=await dt.from("establishment_settings").select("id").eq("establishment_id",r.id).maybeSingle(),G={establishment_id:r.id,loyalty_enabled:a,loyalty_stamps_required:Number(p)||10,loyalty_reward_description:_};let V;D?{error:V}=await dt.from("establishment_settings").update(G).eq("id",D.id):{error:V}=await dt.from("establishment_settings").insert(G),V?gt.error("Erro ao salvar configuraes"):gt.success("Configuraes salvas!"),C(!1)};return n||P?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Carto Fidelidade"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-xl",children:c.jsx($2,{className:"w-6 h-6 text-purple-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selos para Prmio"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(Rf,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:a?"Ativo":"Inativo"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(kve,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:"0"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Prmios Resgatados"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Configuraes do Carto Fidelidade"})}),c.jsxs(Ut,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Ativar Carto Fidelidade"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Clientes ganham selos a cada compra"})]}),c.jsx(Bs,{checked:a,onCheckedChange:d})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Selos para Prmio"}),c.jsx(ar,{type:"number",value:p,onChange:D=>s(D.target.value),placeholder:"10",min:"5",max:"20"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Descrio do Prmio"}),c.jsx(ar,{value:_,onChange:D=>b(D.target.value),placeholder:"Ex: 1 lanche grtis"})]}),c.jsx(Ft,{className:"w-full",onClick:R,disabled:T,children:T?"Salvando...":"Salvar Configuraes"})]})]})]})]})]})},cke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:T}=await dt.from("establishment_invoices").select("*").eq("establishment_id",r.id).order("due_date",{ascending:!1});d(T||[]),s(!1)},b=T=>{switch(T){case"paid":return c.jsx(dn,{className:"bg-green-500",children:"Pago"});case"pending":return c.jsx(dn,{className:"bg-yellow-500",children:"Pendente"});case"overdue":return c.jsx(dn,{variant:"destructive",children:"Atrasado"});default:return c.jsx(dn,{variant:"secondary",children:T})}};return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Faturas"})]})}),c.jsx("div",{className:"p-4 lg:p-6 space-y-6",children:c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Histrico de Faturas"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Rc,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma fatura encontrada"})]}):c.jsx("div",{className:"space-y-3",children:a.map(T=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:c.jsx(Rc,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:T.period}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vencimento: ",new Date(T.due_date).toLocaleDateString("pt-BR")]})]})]}),c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("div",{className:"text-right",children:[c.jsxs("p",{className:"font-bold",children:["R$ ",Number(T.amount).toFixed(2)]}),b(T.status)]})})]},T.id))})})]})})]})]})},uke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState(""),[p,s]=F.useState([]),[_,b]=F.useState(!0),[T,C]=F.useState(!1),[P,k]=F.useState(0);F.useEffect(()=>{r&&(R(),B())},[r]);const B=async()=>{const{data:$}=await dt.from("orders").select("total, delivery_fee").eq("establishment_id",r.id).eq("status","delivered"),{data:K}=await dt.from("establishment_withdrawals").select("amount, status").eq("establishment_id",r.id).in("status",["completed","pending"]),Y=($||[]).reduce((ae,ie)=>ae+Number(ie.total)-Number(ie.delivery_fee||0),0),ee=(K||[]).reduce((ae,ie)=>ae+Number(ie.amount),0);k(Y-ee)},R=async()=>{const{data:$}=await dt.from("establishment_withdrawals").select("*").eq("establishment_id",r.id).order("requested_at",{ascending:!1});s($||[]),b(!1)},D=async()=>{const $=Number(a);if(!$||$<=0){gt.error("Digite um valor vlido");return}if($>P){gt.error("Saldo insuficiente");return}C(!0);const{error:K}=await dt.from("establishment_withdrawals").insert({establishment_id:r.id,amount:$,status:"pending"});K?gt.error("Erro ao solicitar saque"):(gt.success("Saque solicitado com sucesso!"),d(""),R(),B()),C(!1)},G=p.filter($=>$.status==="pending").reduce(($,K)=>$+Number(K.amount),0),V=$=>{switch($){case"completed":return c.jsx(dn,{className:"bg-green-500",children:"Concludo"});case"pending":return c.jsx(dn,{className:"bg-yellow-500",children:"Pendente"});case"rejected":return c.jsx(dn,{variant:"destructive",children:"Rejeitado"});default:return c.jsx(dn,{variant:"secondary",children:$})}};return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Saques"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(bd,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",P.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Saldo Disponvel"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(ki,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",G.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Em Processamento"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Solicitar Saque"})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Valor do Saque"}),c.jsx(ar,{type:"number",value:a,onChange:$=>d($.target.value),placeholder:"0.00"})]}),c.jsxs(Ft,{className:"w-full",onClick:D,disabled:T,children:[c.jsx(o3,{className:"w-4 h-4 mr-2"}),T?"Solicitando...":"Solicitar Saque"]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Histrico de Saques"})}),c.jsx(Ut,{children:_?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):p.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(bd,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum saque realizado"})]}):c.jsx("div",{className:"space-y-3",children:p.map($=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(Da,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["R$ ",Number($.amount).toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:new Date($.requested_at).toLocaleDateString("pt-BR")})]})]}),V($.status)]},$.id))})})]})]})]})]})},dke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:P}=await dt.from("orders").select("id, created_at, order_number, total, delivery_fee, status").eq("establishment_id",r.id).in("status",["delivered","cancelled"]).order("created_at",{ascending:!1}).limit(50),{data:k}=await dt.from("establishment_withdrawals").select("*").eq("establishment_id",r.id).order("requested_at",{ascending:!1}),B=[];(P||[]).forEach(R=>{R.status==="delivered"&&B.push({id:R.id,date:new Date(R.created_at).toLocaleDateString("pt-BR"),description:`Pedido #${R.order_number}`,type:"credit",value:Number(R.total)-Number(R.delivery_fee||0)})}),(k||[]).forEach(R=>{B.push({id:R.id,date:new Date(R.requested_at).toLocaleDateString("pt-BR"),description:"Saque realizado",type:"debit",value:Number(R.amount)})}),B.sort((R,D)=>D.date.localeCompare(R.date)),d(B),s(!1)},b=a.filter(P=>P.type==="credit").reduce((P,k)=>P+k.value,0),T=a.filter(P=>P.type==="debit").reduce((P,k)=>P+k.value,0),C=b-T;return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Extratos"})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(IG,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",b.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Entradas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-xl",children:c.jsx(o3,{className:"w-6 h-6 text-red-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",T.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Sadas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(c3,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",C.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Saldo"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Movimentaes Recentes"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(c3,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma movimentao registrada"})]}):c.jsx("div",{className:"space-y-3",children:a.map(P=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:`p-3 rounded-xl ${P.type==="credit"?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:P.type==="credit"?c.jsx(IG,{className:"w-5 h-5 text-green-600"}):c.jsx(o3,{className:"w-5 h-5 text-red-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:P.description}),c.jsx("p",{className:"text-sm text-muted-foreground",children:P.date})]})]}),c.jsxs("p",{className:`font-bold ${P.type==="credit"?"text-green-600":"text-red-600"}`,children:[P.type==="credit"?"+":"-","R$ ",P.value.toFixed(2)]})]},P.id))})})]})]})]})]})},yH=[{code:"001",name:"Banco do Brasil"},{code:"237",name:"Bradesco"},{code:"341",name:"Ita"},{code:"104",name:"Caixa Econmica"},{code:"033",name:"Santander"},{code:"260",name:"Nubank"},{code:"077",name:"Inter"},{code:"336",name:"C6 Bank"}],hke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState(""),[p,s]=F.useState("checking"),[_,b]=F.useState(""),[T,C]=F.useState(""),[P,k]=F.useState(""),[B,R]=F.useState(""),[D,G]=F.useState(""),[V,$]=F.useState(""),[K,Y]=F.useState(!1),[ee,ae]=F.useState(!0);F.useEffect(()=>{r&&ie()},[r]);const ie=async()=>{const{data:be}=await dt.from("establishment_bank_accounts").select("*").eq("establishment_id",r.id).maybeSingle();be&&(d(be.bank_code||""),s(be.account_type||"checking"),b(be.agency||""),C(be.account_number||""),k(be.holder_name||""),R(be.holder_document||""),G(be.pix_key_type||""),$(be.pix_key||"")),ae(!1)},ge=async()=>{Y(!0);const be=yH.find(ze=>ze.code===a),ue={establishment_id:r.id,bank_code:a,bank_name:(be==null?void 0:be.name)||"",account_type:p,agency:_,account_number:T,holder_name:P,holder_document:B,pix_key_type:D,pix_key:V},{data:Ce}=await dt.from("establishment_bank_accounts").select("id").eq("establishment_id",r.id).maybeSingle();let ve;Ce?{error:ve}=await dt.from("establishment_bank_accounts").update(ue).eq("id",Ce.id):{error:ve}=await dt.from("establishment_bank_accounts").insert(ue),ve?gt.error("Erro ao salvar dados bancrios"):gt.success("Dados bancrios salvos!"),Y(!1)},fe=async()=>{Y(!0);const{data:be}=await dt.from("establishment_bank_accounts").select("id").eq("establishment_id",r.id).maybeSingle(),ue={establishment_id:r.id,pix_key_type:D,pix_key:V};let Ce;be?{error:Ce}=await dt.from("establishment_bank_accounts").update(ue).eq("id",be.id):{error:Ce}=await dt.from("establishment_bank_accounts").insert(ue),Ce?gt.error("Erro ao salvar chave PIX"):gt.success("Chave PIX salva!"),Y(!1)};return n||ee?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Conta Bancria"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(n4,{className:"w-5 h-5"}),"Dados Bancrios"]})}),c.jsx(Ut,{className:"space-y-4",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Banco"}),c.jsxs(ns,{value:a,onValueChange:d,children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione o banco"})}),c.jsx(Qi,{children:yH.map(be=>c.jsx(sn,{value:be.code,children:be.name},be.code))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Tipo de Conta"}),c.jsxs(ns,{value:p,onValueChange:s,children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione o tipo"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"checking",children:"Conta Corrente"}),c.jsx(sn,{value:"savings",children:"Conta Poupana"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Agncia"}),c.jsx(ar,{value:_,onChange:be=>b(be.target.value),placeholder:"0000"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Conta"}),c.jsx(ar,{value:T,onChange:be=>C(be.target.value),placeholder:"00000-0"})]})]})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(to,{className:"w-5 h-5"}),"Dados do Titular"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Nome Completo"}),c.jsx(ar,{value:P,onChange:be=>k(be.target.value),placeholder:"Nome do titular da conta"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"CPF/CNPJ"}),c.jsx(ar,{value:B,onChange:be=>R(be.target.value),placeholder:"000.000.000-00"})]})]}),c.jsx(Ft,{className:"w-full",onClick:ge,disabled:K,children:K?"Salvando...":"Salvar Dados Bancrios"})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Nm,{className:"w-5 h-5"}),"Chave PIX"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Tipo de Chave"}),c.jsxs(ns,{value:D,onValueChange:G,children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione o tipo"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"cpf",children:"CPF"}),c.jsx(sn,{value:"cnpj",children:"CNPJ"}),c.jsx(sn,{value:"email",children:"E-mail"}),c.jsx(sn,{value:"phone",children:"Telefone"}),c.jsx(sn,{value:"random",children:"Chave Aleatria"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"Chave PIX"}),c.jsx(ar,{value:V,onChange:be=>$(be.target.value),placeholder:"Digite sua chave PIX"})]})]}),c.jsx(Ft,{className:"w-full",onClick:fe,disabled:K,children:K?"Salvando...":"Salvar Chave PIX"})]})]})]})]})]})},fke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:P}=await dt.from("orders").select("*").eq("establishment_id",r.id).eq("status","delivered").order("delivered_at",{ascending:!1}).limit(50);d(P||[]),s(!1)},b=new Date,T=a.filter(P=>P.delivered_at&&new Date(P.delivered_at).getMonth()===b.getMonth()&&new Date(P.delivered_at).getFullYear()===b.getFullYear()),C=T.reduce((P,k)=>P+Number(k.delivery_fee||0),0);return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Extrato de Entregas"})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(cs,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:T.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Entregas (Ms)"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(Tf,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",C.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Taxas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl",children:c.jsx(ki,{className:"w-6 h-6 text-orange-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:[T.length>0?"":"0"," min"]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Tempo Mdio"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Entregas Recentes"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Tf,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma entrega registrada"})]}):c.jsx("div",{className:"space-y-3",children:a.map(P=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(Tf,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",P.order_number]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[P.customer_name,"  ",P.delivered_at?new Date(P.delivered_at).toLocaleDateString("pt-BR"):""]})]})]}),c.jsxs("div",{className:"text-right",children:[c.jsxs("p",{className:"font-bold",children:["R$ ",Number(P.delivery_fee||0).toFixed(2)]}),c.jsx(dn,{className:"bg-green-500",children:"Entregue"})]})]},P.id))})})]})]})]})]})},pke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:T}=await dt.from("orders").select("driver_id, customer_name, status").eq("establishment_id",r.id).not("driver_id","is",null);if(!T||T.length===0){d([]),s(!1);return}const C=new Map;T.forEach(R=>{if(!R.driver_id)return;const D=C.get(R.driver_id)||{count:0,hasActive:!1};D.count++,R.status==="out_for_delivery"&&(D.hasActive=!0),C.set(R.driver_id,D)});const P=Array.from(C.keys()),{data:k}=await dt.from("profiles").select("user_id, full_name").in("user_id",P),B=P.map(R=>{const D=k==null?void 0:k.find(V=>V.user_id===R),G=C.get(R);return{driver_id:R,name:(D==null?void 0:D.full_name)||"Entregador",deliveries:G.count,isActive:G.hasActive}});B.sort((R,D)=>D.deliveries-R.deliveries),d(B),s(!1)},b=a.filter(T=>T.isActive).length;return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Entregadores"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(Rf,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:a.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entregadores"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(zi,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:b}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Em Entrega"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl",children:c.jsx(Mc,{className:"w-6 h-6 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:a.reduce((T,C)=>T+C.deliveries,0)}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entregas"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Lista de Entregadores"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Rf,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum entregador registrado"})]}):c.jsx("div",{className:"space-y-3",children:a.map(T=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(YP,{children:c.jsx(JP,{children:T.name.split(" ").map(C=>C[0]).join("").slice(0,2)})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:T.name}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[T.deliveries," entregas"]})]})]}),c.jsx(dn,{className:T.isActive?"bg-blue-500":"bg-muted text-muted-foreground",children:T.isActive?"Em Entrega":"Disponvel"})]},T.driver_id))})})]})]})]})]})},mke=()=>{const[e,t]=F.useState(!1),{establishment:r,loading:n}=jd(),[a,d]=F.useState([]),[p,s]=F.useState(!0);F.useEffect(()=>{r&&_()},[r]);const _=async()=>{const{data:k}=await dt.from("orders").select("*").eq("establishment_id",r.id).in("status",["ready","out_for_delivery"]).order("created_at",{ascending:!1});d(k||[]),s(!1)},b=a.filter(k=>k.status==="delivered"&&new Date(k.delivered_at).toDateString()===new Date().toDateString()).length,T=a.filter(k=>k.status==="out_for_delivery").length,C=a.filter(k=>k.status==="ready").length,P=k=>{switch(k){case"out_for_delivery":return c.jsx(dn,{className:"bg-blue-500",children:"Em Trnsito"});case"ready":return c.jsx(dn,{variant:"secondary",children:"Aguardando Entregador"});default:return null}};return n?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Gl,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>t(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Entregas"})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(zi,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:T}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Em Trnsito"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl",children:c.jsx(ki,{className:"w-6 h-6 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:C}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguardando"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx(cs,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:b}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Entregues Hoje"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Entregas Ativas"})}),c.jsx(Ut,{children:p?c.jsx("div",{className:"flex justify-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-primary"})}):a.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(cs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma entrega ativa no momento"})]}):c.jsx("div",{className:"space-y-3",children:a.map(k=>c.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",k.order_number]}),P(k.status)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:k.customer_name}),c.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[c.jsx(zi,{className:"w-3 h-3"}),k.delivery_address]})]}),c.jsx("div",{className:"text-right",children:c.jsxs("p",{className:"font-bold",children:["R$ ",Number(k.total).toFixed(2)]})})]},k.id))})})]})]})]})]})},Vc=({open:e,onClose:t,pendingEstablishments:r=0})=>{const n=di(),a=qf(),{signOut:d}=$i(),p=[{icon:s4,label:"Dashboard",path:"/admin"},{icon:Bi,label:"Estabelecimentos",path:"/admin/estabelecimentos",badge:r>0?r:void 0},{icon:Bi,label:"Novo Estabelecimento",path:"/admin/estabelecimentos/novo"},{icon:zi,label:"Cidades e Regies",path:"/admin/regioes"},{icon:see,label:"Cupons",path:"/admin/cupons"},{icon:iee,label:"Promoes",path:"/admin/promocoes"},{icon:Rc,label:"Faturas",path:"/admin/faturas"},{icon:Ty,label:"Saques",path:"/admin/saques"},{icon:Rf,label:"Usurios",path:"/admin/usuarios"},{icon:Mve,label:"Relatrios",path:"/admin/relatorios"},{icon:V2,label:"Configuraes",path:"/admin/configuracoes"}],s=_=>a.pathname===_;return c.jsxs(c.Fragment,{children:[e&&c.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:t}),c.jsxs("aside",{className:`fixed lg:static inset-y-0 left-0 z-50 w-64 bg-card border-r transform transition-transform duration-300 ${e?"translate-x-0":"-translate-x-full lg:translate-x-0"}`,children:[c.jsx("div",{className:"p-4 border-b",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"bg-gradient-to-r from-primary to-destructive p-1.5 rounded-lg",children:c.jsx(rv,{className:"w-5 h-5 text-white"})}),c.jsx("span",{className:"font-bold text-lg",children:"Admin Panel"})]}),c.jsx("button",{className:"lg:hidden",onClick:t,children:c.jsx(wd,{className:"w-5 h-5"})})]})}),c.jsx("nav",{className:"p-4 space-y-1",children:p.map(_=>c.jsxs("button",{onClick:()=>{n(_.path),t()},className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${s(_.path)?"bg-primary/10 text-primary font-medium":"hover:bg-muted text-muted-foreground"}`,children:[c.jsx(_.icon,{className:"w-5 h-5"}),_.label,_.badge&&c.jsx(dn,{variant:"destructive",className:"ml-auto",children:_.badge})]},_.path))}),c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t space-y-1",children:[c.jsxs("button",{onClick:()=>n("/"),className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-muted text-muted-foreground",children:[c.jsx(j0,{className:"w-5 h-5"}),"Voltar ao Site"]}),c.jsxs("button",{onClick:d,className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-destructive/10 text-destructive",children:[c.jsx(TT,{className:"w-5 h-5"}),"Sair"]})]})]})]})},gke=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState({totalEstablishments:0,pendingEstablishments:0,approvedEstablishments:0,totalUsers:0,totalOrders:0,todayOrders:0,totalRevenue:0,todayRevenue:0}),[_,b]=F.useState([]),[T,C]=F.useState([]),[P,k]=F.useState(!0);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&B()},[t,r,n,e]);const B=async()=>{try{const{data:R}=await dt.from("establishments").select("*").order("created_at",{ascending:!1}),D=(R==null?void 0:R.filter(ie=>!ie.is_approved).length)||0,G=(R==null?void 0:R.filter(ie=>ie.is_approved).length)||0,{count:V}=await dt.from("profiles").select("*",{count:"exact",head:!0}),{data:$}=await dt.from("orders").select("*").order("created_at",{ascending:!1}),K=new Date().toDateString(),Y=($==null?void 0:$.filter(ie=>new Date(ie.created_at).toDateString()===K))||[],ee=($==null?void 0:$.reduce((ie,ge)=>ie+Number(ge.total),0))||0,ae=Y.reduce((ie,ge)=>ie+Number(ge.total),0);s({totalEstablishments:(R==null?void 0:R.length)||0,pendingEstablishments:D,approvedEstablishments:G,totalUsers:V||0,totalOrders:($==null?void 0:$.length)||0,todayOrders:Y.length,totalRevenue:ee,todayRevenue:ae}),b((R==null?void 0:R.slice(0,5))||[]),C(($==null?void 0:$.slice(0,5))||[])}catch{gt.error("Erro ao carregar dados")}finally{k(!1)}};return r||P?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1),pendingEstablishments:p.pendingEstablishments}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Painel Administrativo"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Viso geral do sistema"})]})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:c.jsx(Bi,{className:"w-6 h-6 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.totalEstablishments}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Estabelecimentos"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:c.jsx(Rf,{className:"w-6 h-6 text-blue-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.totalUsers}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Usurios"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl",children:c.jsx(xh,{className:"w-6 h-6 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.totalOrders}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Pedidos Total"})]})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:c.jsx($o,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",p.totalRevenue.toFixed(2)]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Receita Total"})]})]})})})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Pedidos Hoje"}),c.jsx("p",{className:"text-2xl font-bold",children:p.todayOrders})]}),c.jsx(Ey,{className:"w-8 h-8 text-primary opacity-50"})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Receita Hoje"}),c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",p.todayRevenue.toFixed(2)]})]}),c.jsx($o,{className:"w-8 h-8 text-green-600 opacity-50"})]})})}),c.jsx(Vt,{className:"border-yellow-500/50 bg-yellow-500/5",children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Pendentes Aprovao"}),c.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:p.pendingEstablishments})]}),c.jsx(ki,{className:"w-8 h-8 text-yellow-600 opacity-50"})]})})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Estabelecimentos Recentes"}),c.jsx(Ft,{variant:"outline",size:"sm",onClick:()=>e("/admin/estabelecimentos"),children:"Ver todos"})]})}),c.jsx(Ut,{children:_.length===0?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(Bi,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum estabelecimento cadastrado"})]}):c.jsx("div",{className:"space-y-3",children:_.map(R=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[R.is_approved?c.jsx(Da,{className:"w-5 h-5 text-green-600"}):c.jsx(Lve,{className:"w-5 h-5 text-yellow-600"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:R.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:R.category})]})]}),c.jsx(dn,{variant:R.is_approved?"default":"secondary",children:R.is_approved?"Aprovado":"Pendente"})]},R.id))})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center justify-between",children:[c.jsx("span",{children:"Pedidos Recentes"}),c.jsx(Ft,{variant:"outline",size:"sm",onClick:()=>e("/admin/relatorios"),children:"Ver relatrios"})]})}),c.jsx(Ut,{children:T.length===0?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(xh,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum pedido realizado"})]}):c.jsx("div",{className:"space-y-3",children:T.map(R=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium",children:["Pedido #",R.order_number]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:R.customer_name})]}),c.jsxs("div",{className:"text-right",children:[c.jsxs("p",{className:"font-bold text-primary",children:["R$ ",Number(R.total).toFixed(2)]}),c.jsxs(dn,{variant:R.status==="delivered"?"default":R.status==="cancelled"?"destructive":"secondary",children:[R.status==="pending"&&"Pendente",R.status==="confirmed"&&"Confirmado",R.status==="preparing"&&"Preparando",R.status==="ready"&&"Pronto",R.status==="out_for_delivery"&&"Em entrega",R.status==="delivered"&&"Entregue",R.status==="cancelled"&&"Cancelado"]})]})]},R.id))})})]})]})]})]})]})};var hk="Dialog",[Fse,zse]=hc(hk),[yke,Ad]=Fse(hk),Bse=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:a,onOpenChange:d,modal:p=!0}=e,s=F.useRef(null),_=F.useRef(null),[b,T]=kf({prop:n,defaultProp:a??!1,onChange:d,caller:hk});return c.jsx(yke,{scope:t,triggerRef:s,contentRef:_,contentId:gd(),titleId:gd(),descriptionId:gd(),open:b,onOpenChange:T,onOpenToggle:F.useCallback(()=>T(C=>!C),[T]),modal:p,children:r})};Bse.displayName=hk;var $se="DialogTrigger",Vse=F.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=Ad($se,r),d=Ti(t,a.triggerRef);return c.jsx(vn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":A5(a.open),...n,ref:d,onClick:Fr(e.onClick,a.onOpenToggle)})});Vse.displayName=$se;var E5="DialogPortal",[vke,Use]=Fse(E5,{forceMount:void 0}),qse=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:a}=e,d=Ad(E5,t);return c.jsx(vke,{scope:t,forceMount:r,children:F.Children.map(n,p=>c.jsx(Cu,{present:r||d.open,children:c.jsx(L2,{asChild:!0,container:a,children:p})}))})};qse.displayName=E5;var tN="DialogOverlay",Gse=F.forwardRef((e,t)=>{const r=Use(tN,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,d=Ad(tN,e.__scopeDialog);return d.modal?c.jsx(Cu,{present:n||d.open,children:c.jsx(xke,{...a,ref:t})}):null});Gse.displayName=tN;var _ke=tv("DialogOverlay.RemoveScroll"),xke=F.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=Ad(tN,r);return c.jsx(rk,{as:_ke,allowPinchZoom:!0,shards:[a.contentRef],children:c.jsx(vn.div,{"data-state":A5(a.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),ov="DialogContent",Wse=F.forwardRef((e,t)=>{const r=Use(ov,e.__scopeDialog),{forceMount:n=r.forceMount,...a}=e,d=Ad(ov,e.__scopeDialog);return c.jsx(Cu,{present:n||d.open,children:d.modal?c.jsx(bke,{...a,ref:t}):c.jsx(wke,{...a,ref:t})})});Wse.displayName=ov;var bke=F.forwardRef((e,t)=>{const r=Ad(ov,e.__scopeDialog),n=F.useRef(null),a=Ti(t,r.contentRef,n);return F.useEffect(()=>{const d=n.current;if(d)return f5(d)},[]),c.jsx(Hse,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fr(e.onCloseAutoFocus,d=>{var p;d.preventDefault(),(p=r.triggerRef.current)==null||p.focus()}),onPointerDownOutside:Fr(e.onPointerDownOutside,d=>{const p=d.detail.originalEvent,s=p.button===0&&p.ctrlKey===!0;(p.button===2||s)&&d.preventDefault()}),onFocusOutside:Fr(e.onFocusOutside,d=>d.preventDefault())})}),wke=F.forwardRef((e,t)=>{const r=Ad(ov,e.__scopeDialog),n=F.useRef(!1),a=F.useRef(!1);return c.jsx(Hse,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var p,s;(p=e.onCloseAutoFocus)==null||p.call(e,d),d.defaultPrevented||(n.current||(s=r.triggerRef.current)==null||s.focus(),d.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:d=>{var _,b;(_=e.onInteractOutside)==null||_.call(e,d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const p=d.target;((b=r.triggerRef.current)==null?void 0:b.contains(p))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&a.current&&d.preventDefault()}})}),Hse=F.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:d,...p}=e,s=Ad(ov,r),_=F.useRef(null),b=Ti(t,_);return h5(),c.jsxs(c.Fragment,{children:[c.jsx(ek,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:d,children:c.jsx(hb,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":A5(s.open),...p,ref:b,onDismiss:()=>s.onOpenChange(!1)})}),c.jsxs(c.Fragment,{children:[c.jsx(Tke,{titleId:s.titleId}),c.jsx(jke,{contentRef:_,descriptionId:s.descriptionId})]})]})}),j5="DialogTitle",Zse=F.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=Ad(j5,r);return c.jsx(vn.h2,{id:a.titleId,...n,ref:t})});Zse.displayName=j5;var Xse="DialogDescription",Kse=F.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=Ad(Xse,r);return c.jsx(vn.p,{id:a.descriptionId,...n,ref:t})});Kse.displayName=Xse;var Yse="DialogClose",Jse=F.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,a=Ad(Yse,r);return c.jsx(vn.button,{type:"button",...n,ref:t,onClick:Fr(e.onClick,()=>a.onOpenChange(!1))})});Jse.displayName=Yse;function A5(e){return e?"open":"closed"}var Qse="DialogTitleWarning",[Ske,eae]=Bye(Qse,{contentName:ov,titleName:j5,docsSlug:"dialog"}),Tke=({titleId:e})=>{const t=eae(Qse),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return F.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Eke="DialogDescriptionWarning",jke=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${eae(Eke).contentName}}.`;return F.useEffect(()=>{var d;const a=(d=e.current)==null?void 0:d.getAttribute("aria-describedby");t&&a&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},tae=Bse,rae=Vse,nae=qse,C5=Gse,P5=Wse,N5=Zse,I5=Kse,k5=Jse;const $l=tae,Ake=rae,Cke=nae,iae=F.forwardRef(({className:e,...t},r)=>c.jsx(C5,{ref:r,className:Dr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));iae.displayName=C5.displayName;const ul=F.forwardRef(({className:e,children:t,...r},n)=>c.jsxs(Cke,{children:[c.jsx(iae,{}),c.jsxs(P5,{ref:n,className:Dr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,c.jsxs(k5,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[c.jsx(wd,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ul.displayName=P5.displayName;const dl=({className:e,...t})=>c.jsx("div",{className:Dr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});dl.displayName="DialogHeader";const Ff=({className:e,...t})=>c.jsx("div",{className:Dr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Ff.displayName="DialogFooter";const hl=F.forwardRef(({className:e,...t},r)=>c.jsx(N5,{ref:r,className:Dr("text-lg font-semibold leading-none tracking-tight",e),...t}));hl.displayName=N5.displayName;const Dm=F.forwardRef(({className:e,...t},r)=>c.jsx(I5,{ref:r,className:Dr("text-sm text-muted-foreground",e),...t}));Dm.displayName=I5.displayName;var sae="AlertDialog",[Pke]=hc(sae,[zse]),Wf=zse(),aae=e=>{const{__scopeAlertDialog:t,...r}=e,n=Wf(t);return c.jsx(tae,{...n,...r,modal:!0})};aae.displayName=sae;var Nke="AlertDialogTrigger",Ike=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,a=Wf(r);return c.jsx(rae,{...a,...n,ref:t})});Ike.displayName=Nke;var kke="AlertDialogPortal",oae=e=>{const{__scopeAlertDialog:t,...r}=e,n=Wf(t);return c.jsx(nae,{...n,...r})};oae.displayName=kke;var Oke="AlertDialogOverlay",lae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,a=Wf(r);return c.jsx(C5,{...a,...n,ref:t})});lae.displayName=Oke;var Yx="AlertDialogContent",[Rke,Mke]=Pke(Yx),Dke=IQ("AlertDialogContent"),cae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...a}=e,d=Wf(r),p=F.useRef(null),s=Ti(t,p),_=F.useRef(null);return c.jsx(Ske,{contentName:Yx,titleName:uae,docsSlug:"alert-dialog",children:c.jsx(Rke,{scope:r,cancelRef:_,children:c.jsxs(P5,{role:"alertdialog",...d,...a,ref:s,onOpenAutoFocus:Fr(a.onOpenAutoFocus,b=>{var T;b.preventDefault(),(T=_.current)==null||T.focus({preventScroll:!0})}),onPointerDownOutside:b=>b.preventDefault(),onInteractOutside:b=>b.preventDefault(),children:[c.jsx(Dke,{children:n}),c.jsx(Fke,{contentRef:p})]})})})});cae.displayName=Yx;var uae="AlertDialogTitle",dae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,a=Wf(r);return c.jsx(N5,{...a,...n,ref:t})});dae.displayName=uae;var hae="AlertDialogDescription",fae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,a=Wf(r);return c.jsx(I5,{...a,...n,ref:t})});fae.displayName=hae;var Lke="AlertDialogAction",pae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,a=Wf(r);return c.jsx(k5,{...a,...n,ref:t})});pae.displayName=Lke;var mae="AlertDialogCancel",gae=F.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:a}=Mke(mae,r),d=Wf(r),p=Ti(t,a);return c.jsx(k5,{...d,...n,ref:p})});gae.displayName=mae;var Fke=({contentRef:e})=>{const t=`\`${Yx}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Yx}\` by passing a \`${hae}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Yx}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return F.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},zke=aae,Bke=oae,yae=lae,vae=cae,_ae=pae,xae=gae,bae=dae,wae=fae;const fk=zke,$ke=Bke,Sae=F.forwardRef(({className:e,...t},r)=>c.jsx(yae,{className:Dr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Sae.displayName=yae.displayName;const tE=F.forwardRef(({className:e,...t},r)=>c.jsxs($ke,{children:[c.jsx(Sae,{}),c.jsx(vae,{ref:r,className:Dr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));tE.displayName=vae.displayName;const rE=({className:e,...t})=>c.jsx("div",{className:Dr("flex flex-col space-y-2 text-center sm:text-left",e),...t});rE.displayName="AlertDialogHeader";const nE=({className:e,...t})=>c.jsx("div",{className:Dr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});nE.displayName="AlertDialogFooter";const iE=F.forwardRef(({className:e,...t},r)=>c.jsx(bae,{ref:r,className:Dr("text-lg font-semibold",e),...t}));iE.displayName=bae.displayName;const sE=F.forwardRef(({className:e,...t},r)=>c.jsx(wae,{ref:r,className:Dr("text-sm text-muted-foreground",e),...t}));sE.displayName=wae.displayName;const aE=F.forwardRef(({className:e,...t},r)=>c.jsx(_ae,{ref:r,className:Dr(d5(),e),...t}));aE.displayName=_ae.displayName;const oE=F.forwardRef(({className:e,...t},r)=>c.jsx(xae,{ref:r,className:Dr(d5({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));oE.displayName=xae.displayName;const Km=F.forwardRef(({className:e,...t},r)=>c.jsx("div",{className:"relative w-full overflow-auto",children:c.jsx("table",{ref:r,className:Dr("w-full caption-bottom text-sm",e),...t})}));Km.displayName="Table";const Ym=F.forwardRef(({className:e,...t},r)=>c.jsx("thead",{ref:r,className:Dr("[&_tr]:border-b",e),...t}));Ym.displayName="TableHeader";const Jm=F.forwardRef(({className:e,...t},r)=>c.jsx("tbody",{ref:r,className:Dr("[&_tr:last-child]:border-0",e),...t}));Jm.displayName="TableBody";const Vke=F.forwardRef(({className:e,...t},r)=>c.jsx("tfoot",{ref:r,className:Dr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));Vke.displayName="TableFooter";const Vo=F.forwardRef(({className:e,...t},r)=>c.jsx("tr",{ref:r,className:Dr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Vo.displayName="TableRow";const ai=F.forwardRef(({className:e,...t},r)=>c.jsx("th",{ref:r,className:Dr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));ai.displayName="TableHead";const ti=F.forwardRef(({className:e,...t},r)=>c.jsx("td",{ref:r,className:Dr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ti.displayName="TableCell";const Uke=F.forwardRef(({className:e,...t},r)=>c.jsx("caption",{ref:r,className:Dr("mt-4 text-sm text-muted-foreground",e),...t}));Uke.displayName="TableCaption";const qke=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(""),[B,R]=F.useState("all"),[D,G]=F.useState(null),[V,$]=F.useState(!1),[K,Y]=F.useState(!1),[ee,ae]=F.useState(null),[ie,ge]=F.useState(!1);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&fe()},[t,r,n,e]),F.useEffect(()=>{let Be=p;P&&(Be=Be.filter(Ve=>{var We,Ee;return Ve.name.toLowerCase().includes(P.toLowerCase())||((We=Ve.city)==null?void 0:We.toLowerCase().includes(P.toLowerCase()))||((Ee=Ve.neighborhood)==null?void 0:Ee.toLowerCase().includes(P.toLowerCase()))})),B!=="all"&&(Be=Be.filter(Ve=>B==="approved"?Ve.is_approved:!Ve.is_approved)),b(Be)},[p,P,B]);const fe=async()=>{try{const{data:Be,error:Ve}=await dt.from("establishments").select("*").order("created_at",{ascending:!1});if(Ve)throw Ve;s(Be||[])}catch{gt.error("Erro ao carregar estabelecimentos")}finally{C(!1)}},be=async Be=>{try{const{error:Ve}=await dt.from("establishments").update({is_approved:!0}).eq("id",Be);if(Ve)throw Ve;s(We=>We.map(Ee=>Ee.id===Be?{...Ee,is_approved:!0}:Ee)),gt.success("Estabelecimento aprovado com sucesso!")}catch{gt.error("Erro ao aprovar estabelecimento")}},ue=async Be=>{try{const{error:Ve}=await dt.from("establishments").update({is_approved:!1}).eq("id",Be);if(Ve)throw Ve;s(We=>We.map(Ee=>Ee.id===Be?{...Ee,is_approved:!1}:Ee)),gt.success("Estabelecimento rejeitado")}catch{gt.error("Erro ao rejeitar estabelecimento")}},Ce=Be=>{ae(Be),Y(!0)},ve=async()=>{if(ee){ge(!0);try{const{error:Be}=await dt.from("products").delete().eq("establishment_id",ee.id);if(Be)throw Be;const{error:Ve}=await dt.from("product_categories").delete().eq("establishment_id",ee.id);if(Ve)throw Ve;const{error:We}=await dt.from("establishments").delete().eq("id",ee.id);if(We)throw We;s(Ee=>Ee.filter(ot=>ot.id!==ee.id)),gt.success("Estabelecimento excludo com sucesso!"),Y(!1),$(!1),ae(null)}catch(Be){console.error("Erro ao excluir:",Be),gt.error("Erro ao excluir estabelecimento. Verifique se no h pedidos vinculados.")}finally{ge(!1)}}},ze=Be=>{G(Be),$(!0)},Me=p.filter(Be=>!Be.is_approved).length;return r||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1),pendingEstablishments:Me}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Estabelecimentos"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.length," cadastrados, ",Me," pendentes"]})]})]}),c.jsxs(Ft,{onClick:()=>e("/admin/estabelecimentos/novo"),children:[c.jsx(Bi,{className:"w-4 h-4 mr-2"}),"Novo Estabelecimento"]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por nome, cidade...",value:P,onChange:Be=>k(Be.target.value),className:"pl-10"})]}),c.jsxs(ns,{value:B,onValueChange:R,children:[c.jsx(Ji,{className:"w-full sm:w-48",children:c.jsx(is,{placeholder:"Filtrar por status"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos"}),c.jsx(sn,{value:"pending",children:"Pendentes"}),c.jsx(sn,{value:"approved",children:"Aprovados"})]})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"p-0",children:_.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Bi,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum estabelecimento encontrado"})]}):c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Estabelecimento"}),c.jsx(ai,{children:"Categoria"}),c.jsx(ai,{children:"Localizao"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{className:"text-right",children:"Aes"})]})}),c.jsx(Jm,{children:_.map(Be=>c.jsxs(Vo,{children:[c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center gap-3",children:[Be.logo_url?c.jsx("img",{src:Be.logo_url,alt:Be.name,className:"w-10 h-10 rounded-lg object-cover"}):c.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:c.jsx(Bi,{className:"w-5 h-5 text-muted-foreground"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:Be.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(Be.created_at).toLocaleDateString("pt-BR")})]})]})}),c.jsx(ti,{children:c.jsx(dn,{variant:"outline",children:Be.category})}),c.jsx(ti,{children:c.jsxs("div",{className:"text-sm",children:[c.jsx("p",{children:Be.neighborhood||"-"}),c.jsx("p",{className:"text-muted-foreground",children:Be.city||"-"})]})}),c.jsx(ti,{children:c.jsx(dn,{variant:Be.is_approved?"default":"secondary",className:Be.is_approved?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",children:Be.is_approved?"Aprovado":"Pendente"})}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center justify-end gap-2",children:[c.jsx(Ft,{variant:"ghost",size:"sm",onClick:()=>ze(Be),children:c.jsx(Gve,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"sm",onClick:()=>e(`/admin/estabelecimentos/${Be.id}/editar`),children:c.jsx(Im,{className:"w-4 h-4"})}),!Be.is_approved&&c.jsx(Ft,{variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-700 hover:bg-green-100",onClick:()=>be(Be.id),children:c.jsx(Da,{className:"w-4 h-4"})}),Be.is_approved&&c.jsx(Ft,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>ue(Be.id),children:c.jsx(Of,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>Ce(Be),children:c.jsx(xd,{className:"w-4 h-4"})})]})})]},Be.id))})]})})})})]})]}),c.jsx($l,{open:V,onOpenChange:$,children:c.jsxs(ul,{className:"max-w-2xl",children:[c.jsxs(dl,{children:[c.jsxs(hl,{className:"flex items-center gap-3",children:[D!=null&&D.logo_url?c.jsx("img",{src:D.logo_url,alt:D.name,className:"w-12 h-12 rounded-lg object-cover"}):c.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:c.jsx(Bi,{className:"w-6 h-6 text-muted-foreground"})}),D==null?void 0:D.name]}),c.jsx(Dm,{children:"Detalhes do estabelecimento"})]}),D&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(dn,{variant:"outline",children:D.category}),c.jsx(dn,{variant:D.is_approved?"default":"secondary",children:D.is_approved?"Aprovado":"Pendente"})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(B2,{className:"w-4 h-4"}),new Date(D.created_at).toLocaleDateString("pt-BR")]})]}),D.description&&c.jsx("p",{className:"text-sm text-muted-foreground",children:D.description}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(zi,{className:"w-4 h-4 mt-1 text-muted-foreground"}),c.jsxs("div",{className:"text-sm",children:[c.jsx("p",{children:D.address||"Endereo no informado"}),c.jsxs("p",{className:"text-muted-foreground",children:[D.neighborhood,", ",D.city]})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx($c,{className:"w-4 h-4 text-muted-foreground"}),c.jsx("span",{className:"text-sm",children:D.phone||"No informado"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Mc,{className:"w-4 h-4 text-yellow-500"}),c.jsxs("span",{className:"text-sm",children:[D.rating||0," (",D.total_reviews||0," avaliaes)"]})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-muted/50 rounded-lg",children:[c.jsxs("div",{className:"text-center",children:[c.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Number(D.delivery_fee||0).toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Taxa entrega"})]}),c.jsxs("div",{className:"text-center",children:[c.jsxs("p",{className:"text-lg font-bold",children:["R$ ",Number(D.min_order_value||0).toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Pedido mnimo"})]}),c.jsxs("div",{className:"text-center",children:[c.jsxs("p",{className:"text-lg font-bold",children:[D.min_delivery_time,"-",D.max_delivery_time,"min"]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Tempo entrega"})]})]})]}),c.jsxs(Ff,{className:"flex-col sm:flex-row gap-2",children:[D&&c.jsxs(Ft,{variant:"outline",onClick:()=>{$(!1),e(`/admin/estabelecimentos/${D.id}/editar`)},children:[c.jsx(Im,{className:"w-4 h-4 mr-2"}),"Editar"]}),D&&!D.is_approved&&c.jsxs(Ft,{onClick:()=>{be(D.id),$(!1)},className:"bg-green-600 hover:bg-green-700",children:[c.jsx(Da,{className:"w-4 h-4 mr-2"}),"Aprovar"]}),D&&D.is_approved&&c.jsxs(Ft,{variant:"outline",onClick:()=>{ue(D.id),$(!1)},children:[c.jsx(Of,{className:"w-4 h-4 mr-2"}),"Revogar Aprovao"]}),D&&c.jsxs(Ft,{variant:"destructive",onClick:()=>Ce(D),children:[c.jsx(xd,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})}),c.jsx(fk,{open:K,onOpenChange:Y,children:c.jsxs(tE,{children:[c.jsxs(rE,{children:[c.jsx(iE,{children:"Confirmar excluso"}),c.jsxs(sE,{children:["Tem certeza que deseja excluir o estabelecimento"," ",c.jsx("strong",{children:ee==null?void 0:ee.name}),"? Esta ao no pode ser desfeita e ir remover todos os produtos e categorias associados."]})]}),c.jsxs(nE,{children:[c.jsx(oE,{disabled:ie,children:"Cancelar"}),c.jsx(aE,{onClick:ve,disabled:ie,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:ie?"Excluindo...":"Excluir"})]})]})})]})},Gke=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState(!1),[_,b]=F.useState([]),[T,C]=F.useState({email:"",password:"",fullName:"",phone:""}),[P,k]=F.useState({name:"",description:"",category:"restaurant",phone:"",address:"",neighborhood:"",city:"",cityId:"",deliveryFee:"",minOrderValue:"",minDeliveryTime:"30",maxDeliveryTime:"60"}),[B,R]=F.useState(!0),[D,G]=F.useState(sh),[V,$]=F.useState(null),[K,Y]=F.useState(null);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}ee()},[t,r,n,e]);const ee=async()=>{const{data:fe}=await dt.from("cities").select("id, name, state").eq("is_active",!0).order("state").order("name");fe&&b(fe)},ae=fe=>{C({...T,[fe.target.name]:fe.target.value})},ie=fe=>{k({...P,[fe.target.name]:fe.target.value})},ge=async fe=>{if(fe.preventDefault(),s(!0),!P.cityId){gt.error("Por favor, selecione uma cidade cadastrada"),s(!1);return}try{const{data:be,error:ue}=await dt.functions.invoke("create-establishment",{body:{ownerData:T,establishmentData:{...P,is_approved:B,opening_hours:JSON.parse(JSON.stringify(D)),logo_url:V,cover_url:K}}});if(ue||be!=null&&be.error)throw new Error((ue==null?void 0:ue.message)||(be==null?void 0:be.error)||"Erro ao cadastrar estabelecimento");gt.success("Estabelecimento cadastrado com sucesso!"),e("/admin/estabelecimentos")}catch(be){console.error("Erro:",be),gt.error(be.message||"Erro ao cadastrar estabelecimento")}finally{s(!1)}};return r?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs(Ft,{variant:"ghost",size:"sm",onClick:()=>e("/admin/estabelecimentos"),children:[c.jsx(uc,{className:"w-4 h-4 mr-2"}),"Voltar"]})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 max-w-4xl mx-auto",children:[c.jsxs("div",{className:"mb-6",children:[c.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[c.jsx(Bi,{className:"w-7 h-7 text-primary"}),"Cadastrar Novo Estabelecimento"]}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Crie uma conta para o proprietrio e cadastre o estabelecimento"})]}),c.jsxs("form",{onSubmit:ge,className:"space-y-6",children:[c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(to,{className:"w-5 h-5"}),"Dados do Proprietrio"]}),c.jsx(zo,{children:"Informaes da conta do proprietrio do estabelecimento"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"fullName",className:"flex items-center gap-2 mb-2",children:[c.jsx(to,{className:"w-4 h-4 text-primary"}),"Nome Completo *"]}),c.jsx(ar,{id:"fullName",name:"fullName",value:T.fullName,onChange:ae,placeholder:"Nome do proprietrio",required:!0})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"ownerPhone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),"Telefone"]}),c.jsx(ar,{id:"ownerPhone",name:"phone",value:T.phone,onChange:ae,placeholder:"(00) 00000-0000"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"email",className:"flex items-center gap-2 mb-2",children:[c.jsx(fb,{className:"w-4 h-4 text-primary"}),"E-mail *"]}),c.jsx(ar,{id:"email",name:"email",type:"email",value:T.email,onChange:ae,placeholder:"email@exemplo.com",required:!0})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"password",className:"flex items-center gap-2 mb-2",children:[c.jsx(S0,{className:"w-4 h-4 text-primary"}),"Senha *"]}),c.jsx(ar,{id:"password",name:"password",type:"password",value:T.password,onChange:ae,placeholder:"Mnimo 6 caracteres",minLength:6,required:!0})]})]})]})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Bi,{className:"w-5 h-5"}),"Dados do Estabelecimento"]}),c.jsx(zo,{children:"Informaes bsicas sobre o estabelecimento"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-wrap gap-6 pb-4 border-b",children:[c.jsx(I0,{value:V,onChange:$,folder:"logos",label:"Logo",aspectRatio:"square"}),c.jsx(I0,{value:K,onChange:Y,folder:"covers",label:"Imagem de Capa",aspectRatio:"banner",className:"flex-1 min-w-[200px]"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"name",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-primary"}),"Nome do Estabelecimento *"]}),c.jsx(ar,{id:"name",name:"name",value:P.name,onChange:ie,placeholder:"Nome do negcio",required:!0})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"category",className:"flex items-center gap-2 mb-2",children:"Categoria *"}),c.jsxs(ns,{value:P.category,onValueChange:fe=>k({...P,category:fe}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione"})}),c.jsx(Qi,{children:S5.map(fe=>c.jsx(sn,{value:fe.value,children:fe.label},fe.value))})]})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"description",className:"mb-2 block",children:"Descrio"}),c.jsx(Ih,{id:"description",name:"description",value:P.description,onChange:ie,placeholder:"Breve descrio do estabelecimento",rows:3})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"establishmentPhone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),"Telefone do Estabelecimento"]}),c.jsx(ar,{id:"establishmentPhone",name:"phone",value:P.phone,onChange:ie,placeholder:"(00) 00000-0000"})]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(zi,{className:"w-5 h-5"}),"Endereo"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"address",className:"mb-2 block",children:"Endereo Completo"}),c.jsx(ar,{id:"address",name:"address",value:P.address,onChange:ie,placeholder:"Rua, nmero, complemento"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"neighborhood",className:"mb-2 block",children:"Bairro"}),c.jsx(ar,{id:"neighborhood",name:"neighborhood",value:P.neighborhood,onChange:ie,placeholder:"Bairro"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"cityId",className:"mb-2 block",children:"Cidade (Cadastrada) *"}),c.jsxs(ns,{value:P.cityId,onValueChange:fe=>{const be=_.find(ue=>ue.id===fe);k({...P,cityId:fe,city:be?`${be.name} - ${be.state}`:""})},children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione a cidade"})}),c.jsx(Qi,{children:_.map(fe=>c.jsxs(sn,{value:fe.id,children:[fe.name," - ",fe.state]},fe.id))})]}),_.length===0&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Nenhuma cidade cadastrada. ",c.jsx("a",{href:"/admin/regioes",className:"text-primary underline",children:"Cadastrar cidades"})]})]})]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx($o,{className:"w-5 h-5"}),"Configuraes de Entrega"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"deliveryFee",className:"mb-2 block",children:"Taxa de Entrega (R$)"}),c.jsx(ar,{id:"deliveryFee",name:"deliveryFee",type:"number",step:"0.01",min:"0",value:P.deliveryFee,onChange:ie,placeholder:"0.00"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"minOrderValue",className:"mb-2 block",children:"Pedido Mnimo (R$)"}),c.jsx(ar,{id:"minOrderValue",name:"minOrderValue",type:"number",step:"0.01",min:"0",value:P.minOrderValue,onChange:ie,placeholder:"0.00"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"minDeliveryTime",className:"flex items-center gap-2 mb-2",children:[c.jsx(ki,{className:"w-4 h-4 text-primary"}),"Tempo Mnimo (min)"]}),c.jsx(ar,{id:"minDeliveryTime",name:"minDeliveryTime",type:"number",min:"5",value:P.minDeliveryTime,onChange:ie,placeholder:"30"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"maxDeliveryTime",className:"flex items-center gap-2 mb-2",children:[c.jsx(ki,{className:"w-4 h-4 text-primary"}),"Tempo Mximo (min)"]}),c.jsx(ar,{id:"maxDeliveryTime",name:"maxDeliveryTime",type:"number",min:"5",value:P.maxDeliveryTime,onChange:ie,placeholder:"60"})]})]})]})]}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsx(T5,{value:D,onChange:G})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(zt,{className:"text-base font-medium",children:"Aprovar Automaticamente"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Marcar o estabelecimento como aprovado ao cadastrar"})]}),c.jsx(Bs,{checked:B,onCheckedChange:R})]})})}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx(Ft,{type:"button",variant:"outline",onClick:()=>e("/admin/estabelecimentos"),className:"flex-1",children:"Cancelar"}),c.jsx(Ft,{type:"submit",variant:"hero",className:"flex-1",disabled:p,children:p?"Cadastrando...":"Cadastrar Estabelecimento"})]})]})]})]})]})},Wke=[{value:"restaurant",label:"Restaurante"},{value:"pizzaria",label:"Pizzaria"},{value:"hamburgueria",label:"Hamburgueria"},{value:"japonesa",label:"Comida Japonesa"},{value:"brasileira",label:"Comida Brasileira"},{value:"italiana",label:"Comida Italiana"},{value:"chinesa",label:"Comida Chinesa"},{value:"mexicana",label:"Comida Mexicana"},{value:"acai",label:"Aa"},{value:"sorveteria",label:"Sorveteria"},{value:"padaria",label:"Padaria"},{value:"cafeteria",label:"Cafeteria"},{value:"doceria",label:"Doceria"},{value:"saudavel",label:"Saudvel"},{value:"vegano",label:"Vegano"},{value:"bebidas",label:"Bebidas"},{value:"mercado",label:"Mercado"},{value:"farmacia",label:"Farmcia"},{value:"petshop",label:"Pet Shop"},{value:"outros",label:"Outros"}],Hke=()=>{const{id:e}=GI(),t=di(),{user:r,loading:n,isAdmin:a}=$i(),[d,p]=F.useState(!1),[s,_]=F.useState(!0),[b,T]=F.useState(!1),[C,P]=F.useState(sh),[k,B]=F.useState(null),[R,D]=F.useState(null),[G,V]=F.useState([]),[$,K]=F.useState({name:"",description:"",category:"restaurant",phone:"",address:"",neighborhood:"",city:"",cityId:"",deliveryFee:"",minOrderValue:"",minDeliveryTime:"30",maxDeliveryTime:"60",isApproved:!1,isOpen:!1});F.useEffect(()=>{if(!n&&!r){t("/auth");return}if(!n&&r&&!a){gt.error("Acesso negado. rea restrita para administradores."),t("/");return}r&&a&&e&&(ee(),Y())},[r,n,a,t,e]);const Y=async()=>{const{data:ge}=await dt.from("cities").select("id, name, state").eq("is_active",!0).order("state").order("name");ge&&V(ge)},ee=async()=>{var ge,fe,be,ue;try{const{data:Ce,error:ve}=await dt.from("establishments").select("*").eq("id",e).single();if(ve)throw ve;Ce&&(K({name:Ce.name||"",description:Ce.description||"",category:Ce.category||"restaurant",phone:Ce.phone||"",address:Ce.address||"",neighborhood:Ce.neighborhood||"",city:Ce.city||"",cityId:Ce.city_id||"",deliveryFee:((ge=Ce.delivery_fee)==null?void 0:ge.toString())||"",minOrderValue:((fe=Ce.min_order_value)==null?void 0:fe.toString())||"",minDeliveryTime:((be=Ce.min_delivery_time)==null?void 0:be.toString())||"30",maxDeliveryTime:((ue=Ce.max_delivery_time)==null?void 0:ue.toString())||"60",isApproved:Ce.is_approved||!1,isOpen:Ce.is_open||!1}),Ce.opening_hours&&typeof Ce.opening_hours=="object"&&P(Ce.opening_hours),B(Ce.logo_url||null),D(Ce.cover_url||null))}catch{gt.error("Erro ao carregar estabelecimento"),t("/admin/estabelecimentos")}finally{_(!1)}},ae=ge=>{K({...$,[ge.target.name]:ge.target.value})},ie=async ge=>{ge.preventDefault(),T(!0);try{const{error:fe}=await dt.from("establishments").update({name:$.name,description:$.description||null,category:$.category,phone:$.phone||null,address:$.address||null,neighborhood:$.neighborhood||null,city:$.city||null,city_id:$.cityId||null,delivery_fee:$.deliveryFee?Number($.deliveryFee):0,min_order_value:$.minOrderValue?Number($.minOrderValue):0,min_delivery_time:Number($.minDeliveryTime)||30,max_delivery_time:Number($.maxDeliveryTime)||60,is_approved:$.isApproved,is_open:$.isOpen,opening_hours:JSON.parse(JSON.stringify(C)),logo_url:k,cover_url:R}).eq("id",e);if(fe)throw fe;gt.success("Estabelecimento atualizado com sucesso!"),t("/admin/estabelecimentos")}catch(fe){console.error("Erro:",fe),gt.error(fe.message||"Erro ao atualizar estabelecimento")}finally{T(!1)}};return n||s?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:d,onClose:()=>p(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>p(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs(Ft,{variant:"ghost",size:"sm",onClick:()=>t("/admin/estabelecimentos"),children:[c.jsx(uc,{className:"w-4 h-4 mr-2"}),"Voltar"]})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 max-w-4xl mx-auto",children:[c.jsxs("div",{className:"mb-6",children:[c.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[c.jsx(Bi,{className:"w-7 h-7 text-primary"}),"Editar Estabelecimento"]}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Atualize as informaes do estabelecimento"})]}),c.jsxs("form",{onSubmit:ie,className:"space-y-6",children:[c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Bi,{className:"w-5 h-5"}),"Dados do Estabelecimento"]}),c.jsx(zo,{children:"Informaes bsicas sobre o estabelecimento"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-wrap gap-6 pb-4 border-b",children:[c.jsx(I0,{value:k,onChange:B,folder:"logos",label:"Logo",aspectRatio:"square"}),c.jsx(I0,{value:R,onChange:D,folder:"covers",label:"Imagem de Capa",aspectRatio:"banner",className:"flex-1 min-w-[200px]"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"name",className:"flex items-center gap-2 mb-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-primary"}),"Nome do Estabelecimento *"]}),c.jsx(ar,{id:"name",name:"name",value:$.name,onChange:ae,placeholder:"Nome do negcio",required:!0})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"category",className:"flex items-center gap-2 mb-2",children:"Categoria *"}),c.jsxs(ns,{value:$.category,onValueChange:ge=>K({...$,category:ge}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione"})}),c.jsx(Qi,{children:Wke.map(ge=>c.jsx(sn,{value:ge.value,children:ge.label},ge.value))})]})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"description",className:"mb-2 block",children:"Descrio"}),c.jsx(Ih,{id:"description",name:"description",value:$.description,onChange:ae,placeholder:"Breve descrio do estabelecimento",rows:3})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"phone",className:"flex items-center gap-2 mb-2",children:[c.jsx($c,{className:"w-4 h-4 text-primary"}),"Telefone do Estabelecimento"]}),c.jsx(ar,{id:"phone",name:"phone",value:$.phone,onChange:ae,placeholder:"(00) 00000-0000"})]})]})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsx(Hr,{children:"Status"}),c.jsx(zo,{children:"Controle o status do estabelecimento"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Aprovado"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"O estabelecimento aparecer para os clientes"})]}),c.jsx(Bs,{checked:$.isApproved,onCheckedChange:ge=>K({...$,isApproved:ge})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Aberto"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Indica se o estabelecimento est aberto agora"})]}),c.jsx(Bs,{checked:$.isOpen,onCheckedChange:ge=>K({...$,isOpen:ge})})]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(zi,{className:"w-5 h-5"}),"Endereo"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"address",className:"mb-2 block",children:"Endereo Completo"}),c.jsx(ar,{id:"address",name:"address",value:$.address,onChange:ae,placeholder:"Rua, nmero, complemento"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"neighborhood",className:"mb-2 block",children:"Bairro"}),c.jsx(ar,{id:"neighborhood",name:"neighborhood",value:$.neighborhood,onChange:ae,placeholder:"Bairro"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"cityId",className:"mb-2 block",children:"Cidade (Cadastrada) *"}),c.jsxs(ns,{value:$.cityId,onValueChange:ge=>{const fe=G.find(be=>be.id===ge);K({...$,cityId:ge,city:fe?`${fe.name} - ${fe.state}`:""})},children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione a cidade"})}),c.jsx(Qi,{children:G.map(ge=>c.jsxs(sn,{value:ge.id,children:[ge.name," - ",ge.state]},ge.id))})]}),G.length===0&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Nenhuma cidade cadastrada. ",c.jsx("a",{href:"/admin/regioes",className:"text-primary underline",children:"Cadastrar cidades"})]})]})]})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx($o,{className:"w-5 h-5"}),"Configuraes de Entrega"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"deliveryFee",className:"mb-2 block",children:"Taxa de Entrega (R$)"}),c.jsx(ar,{id:"deliveryFee",name:"deliveryFee",type:"number",step:"0.01",min:"0",value:$.deliveryFee,onChange:ae,placeholder:"0.00"})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"minOrderValue",className:"mb-2 block",children:"Pedido Mnimo (R$)"}),c.jsx(ar,{id:"minOrderValue",name:"minOrderValue",type:"number",step:"0.01",min:"0",value:$.minOrderValue,onChange:ae,placeholder:"0.00"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"minDeliveryTime",className:"flex items-center gap-2 mb-2",children:[c.jsx(ki,{className:"w-4 h-4 text-primary"}),"Tempo Mnimo (min)"]}),c.jsx(ar,{id:"minDeliveryTime",name:"minDeliveryTime",type:"number",min:"5",value:$.minDeliveryTime,onChange:ae,placeholder:"30"})]}),c.jsxs("div",{children:[c.jsxs(zt,{htmlFor:"maxDeliveryTime",className:"flex items-center gap-2 mb-2",children:[c.jsx(ki,{className:"w-4 h-4 text-primary"}),"Tempo Mximo (min)"]}),c.jsx(ar,{id:"maxDeliveryTime",name:"maxDeliveryTime",type:"number",min:"5",value:$.maxDeliveryTime,onChange:ae,placeholder:"60"})]})]})]})]}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsx(T5,{value:C,onChange:P})})}),c.jsxs("div",{className:"flex justify-end gap-4",children:[c.jsx(Ft,{type:"button",variant:"outline",onClick:()=>t("/admin/estabelecimentos"),children:"Cancelar"}),c.jsxs(Ft,{type:"submit",disabled:b,children:[b?c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-white mr-2"}):c.jsx(E0,{className:"w-4 h-4 mr-2"}),"Salvar Alteraes"]})]})]})]})]})]})},Zke=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(""),[B,R]=F.useState("all"),[D,G]=F.useState(null),[V,$]=F.useState(!1),[K,Y]=F.useState(!1),[ee,ae]=F.useState(""),[ie,ge]=F.useState(!1),[fe,be]=F.useState(null),[ue,Ce]=F.useState(!1),[ve,ze]=F.useState(0);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&(Ve(),Me())},[t,r,n,e]),F.useEffect(()=>{let Pt=p;P&&(Pt=Pt.filter(pt=>{var Gt;return pt.full_name.toLowerCase().includes(P.toLowerCase())||((Gt=pt.phone)==null?void 0:Gt.toLowerCase().includes(P.toLowerCase()))})),B!=="all"&&(Pt=Pt.filter(pt=>pt.roles.includes(B))),b(Pt)},[p,P,B]);const Me=async()=>{const{count:Pt}=await dt.from("establishments").select("*",{count:"exact",head:!0}).eq("is_approved",!1);ze(Pt||0)},Be=async()=>{if(fe){Ce(!0);try{const{data:Pt,error:pt}=await dt.functions.invoke("delete-user",{body:{targetUserId:fe.user_id}});if(pt||Pt!=null&&Pt.error)throw new Error((pt==null?void 0:pt.message)||(Pt==null?void 0:Pt.error)||"Erro ao excluir usurio");s(Gt=>Gt.filter(Pr=>Pr.user_id!==fe.user_id)),gt.success("Usurio excludo com sucesso"),Y(!1),be(null)}catch(Pt){console.error("Delete user error:",Pt),gt.error(Pt.message||"Erro ao excluir usurio")}finally{Ce(!1)}}},Ve=async()=>{try{const{data:Pt,error:pt}=await dt.from("profiles").select("*").order("created_at",{ascending:!1});if(pt)throw pt;const{data:Gt,error:Pr}=await dt.from("user_roles").select("*");if(Pr)throw Pr;const Ot=(Pt||[]).map(nr=>({...nr,roles:(Gt||[]).filter(ur=>ur.user_id===nr.user_id).map(ur=>ur.role)}));s(Ot)}catch(Pt){console.error("Error fetching users:",Pt),gt.error("Erro ao carregar usurios")}finally{C(!1)}},We=async(Pt,pt)=>{try{const{error:Gt}=await dt.from("user_roles").insert({user_id:Pt,role:pt});if(Gt)throw Gt;s(Pr=>Pr.map(Ot=>Ot.user_id===Pt?{...Ot,roles:[...Ot.roles,pt]}:Ot)),(D==null?void 0:D.user_id)===Pt&&G({...D,roles:[...D.roles,pt]}),gt.success(`Role ${pt} adicionada com sucesso`)}catch(Gt){Gt.code==="23505"?gt.error("Usurio j possui esta role"):gt.error("Erro ao adicionar role")}},Ee=async(Pt,pt)=>{try{const{error:Gt}=await dt.from("user_roles").delete().eq("user_id",Pt).eq("role",pt);if(Gt)throw Gt;s(Pr=>Pr.map(Ot=>Ot.user_id===Pt?{...Ot,roles:Ot.roles.filter(nr=>nr!==pt)}:Ot)),(D==null?void 0:D.user_id)===Pt&&G({...D,roles:D.roles.filter(Pr=>Pr!==pt)}),gt.success(`Role ${pt} removida com sucesso`)}catch{gt.error("Erro ao remover role")}},ot=async(Pt,pt,Gt)=>{try{const Pr={is_driver_approved:!pt};pt===!0?Pr.driver_rejection_reason=Gt||null:Pr.driver_rejection_reason=null;const{error:Ot}=await dt.from("profiles").update(Pr).eq("user_id",Pt);if(Ot)throw Ot;s(nr=>nr.map(ur=>ur.user_id===Pt?{...ur,is_driver_approved:!pt,driver_rejection_reason:Pr.driver_rejection_reason}:ur)),(D==null?void 0:D.user_id)===Pt&&G({...D,is_driver_approved:!pt,driver_rejection_reason:Pr.driver_rejection_reason}),gt.success(`Motorista ${pt?"desaprovado":"aprovado"} com sucesso`),ge(!1),ae("")}catch{gt.error("Erro ao atualizar status de aprovao")}},yt=Pt=>{switch(Pt){case"admin":return c.jsx(rv,{className:"w-3 h-3"});case"establishment":return c.jsx(Bi,{className:"w-3 h-3"});case"driver":return c.jsx(Tf,{className:"w-3 h-3"});default:return c.jsx(to,{className:"w-3 h-3"})}},Je=Pt=>{switch(Pt){case"admin":return"destructive";case"establishment":return"default";case"driver":return"secondary";default:return"outline"}},Bt={admin:"Admin",establishment:"Estabelecimento",driver:"Entregador",customer:"Cliente"};return r||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1),pendingEstablishments:ve}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Usurios"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.length," usurios cadastrados"]})]})]})})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por nome, telefone...",value:P,onChange:Pt=>k(Pt.target.value),className:"pl-10"})]}),c.jsxs(ns,{value:B,onValueChange:R,children:[c.jsx(Ji,{className:"w-full sm:w-48",children:c.jsx(is,{placeholder:"Filtrar por role"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todas as roles"}),c.jsx(sn,{value:"admin",children:"Admin"}),c.jsx(sn,{value:"establishment",children:"Estabelecimento"}),c.jsx(sn,{value:"driver",children:"Entregador"}),c.jsx(sn,{value:"customer",children:"Cliente"})]})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"p-0",children:_.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Rf,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum usurio encontrado"})]}):c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Usurio"}),c.jsx(ai,{children:"Telefone"}),c.jsx(ai,{children:"Roles"}),c.jsx(ai,{children:"Data Cadastro"}),c.jsx(ai,{className:"text-right",children:"Aes"})]})}),c.jsx(Jm,{children:_.map(Pt=>c.jsxs(Vo,{children:[c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center gap-3",children:[Pt.avatar_url?c.jsx("img",{src:Pt.avatar_url,alt:Pt.full_name,className:"w-10 h-10 rounded-full object-cover"}):c.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:c.jsx(to,{className:"w-5 h-5 text-muted-foreground"})}),c.jsx("div",{children:c.jsx("p",{className:"font-medium",children:Pt.full_name})})]})}),c.jsx(ti,{children:Pt.phone||"-"}),c.jsx(ti,{children:c.jsxs("div",{className:"flex flex-wrap gap-1",children:[Pt.roles.map(pt=>c.jsxs(dn,{variant:Je(pt),className:"flex items-center gap-1",children:[yt(pt),Bt[pt]]},pt)),Pt.roles.length===0&&c.jsx("span",{className:"text-muted-foreground text-sm",children:"Sem roles"})]})}),c.jsx(ti,{children:new Date(Pt.created_at).toLocaleDateString("pt-BR")}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center justify-end gap-2",children:[c.jsx(Ft,{variant:"outline",size:"sm",onClick:()=>{G(Pt),$(!0)},children:"Gerenciar Roles"}),Pt.roles.includes("driver")&&c.jsx(Ft,{variant:Pt.is_driver_approved?"outline":"default",size:"sm",className:Pt.is_driver_approved?"":"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>ot(Pt.user_id,Pt.is_driver_approved||!1),children:Pt.is_driver_approved?c.jsxs(c.Fragment,{children:[c.jsx(Of,{className:"w-4 h-4 mr-1"}),"Desaprovar"]}):c.jsxs(c.Fragment,{children:[c.jsx(Da,{className:"w-4 h-4 mr-1"}),"Aprovar"]})}),c.jsx(Ft,{variant:"outline",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{be(Pt),Y(!0)},disabled:Pt.user_id===(t==null?void 0:t.id),children:c.jsx(xd,{className:"w-4 h-4"})})]})})]},Pt.id))})]})})})})]})]}),c.jsx($l,{open:V,onOpenChange:$,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Gerenciar Roles"}),c.jsx(Dm,{children:D==null?void 0:D.full_name})]}),D&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-2",children:"Roles atuais:"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:D.roles.length===0?c.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma role atribuda"}):D.roles.map(Pt=>c.jsxs(dn,{variant:Je(Pt),className:"flex items-center gap-2",children:[yt(Pt),Bt[Pt],c.jsx("button",{onClick:()=>Ee(D.user_id,Pt),className:"ml-1 hover:bg-white/20 rounded-full p-0.5",children:c.jsx(xd,{className:"w-3 h-3"})})]},Pt))})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium mb-2",children:"Adicionar role:"}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[["admin","establishment","driver","customer"].filter(Pt=>!D.roles.includes(Pt)).map(Pt=>c.jsxs(Ft,{variant:"outline",size:"sm",onClick:()=>We(D.user_id,Pt),className:"flex items-center gap-2",children:[c.jsx(dc,{className:"w-3 h-3"}),yt(Pt),Bt[Pt]]},Pt)),D.roles.length===4&&c.jsx("p",{className:"text-sm text-muted-foreground",children:"Todas as roles j esto atribudas"})]})]}),D.roles.includes("driver")&&c.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[c.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[c.jsx(Tf,{className:"w-4 h-4 text-emerald-500"}),"Dados do Entregador"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[D.face_photo_url&&c.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-2",children:[c.jsx(zt,{className:"text-xs text-muted-foreground uppercase self-start",children:"Foto do Rosto"}),c.jsx("img",{src:D.face_photo_url,alt:"Face",className:"w-32 h-32 rounded-lg object-cover border-2 border-emerald-100 shadow-sm"}),c.jsxs(Ft,{size:"sm",variant:"outline",className:"w-full",onClick:()=>window.open(D.face_photo_url,"_blank"),children:[c.jsx(kP,{className:"w-3 h-3 mr-1"}),"Baixar Foto"]})]}),D.driver_id_photo_url&&c.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-2",children:[c.jsx(zt,{className:"text-xs text-muted-foreground uppercase self-start",children:"Foto do RG"}),c.jsx("img",{src:D.driver_id_photo_url,alt:"ID Document",className:"w-32 h-32 rounded-lg object-cover border-2 border-blue-100 shadow-sm"}),c.jsxs(Ft,{size:"sm",variant:"outline",className:"w-full",onClick:()=>window.open(D.driver_id_photo_url,"_blank"),children:[c.jsx(Rc,{className:"w-3 h-3 mr-1"}),"Baixar RG"]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs(zt,{className:"text-xs text-muted-foreground uppercase flex items-center gap-1",children:[c.jsx(Rc,{className:"w-3 h-3"}),"CPF/CNPJ"]}),c.jsx("p",{className:"text-sm font-medium bg-muted/50 p-2 rounded truncate",children:D.cpf_cnpj||"NO INFORMADO"})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs(zt,{className:"text-xs text-muted-foreground uppercase flex items-center gap-1",children:[c.jsx(Rc,{className:"w-3 h-3"}),"Placa"]}),c.jsx("p",{className:"text-sm font-medium bg-muted/50 p-2 rounded truncate",children:D.driver_vehicle_plate||"NO INFORMADA"})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs(zt,{className:"text-xs text-muted-foreground uppercase flex items-center gap-1",children:[c.jsx(B2,{className:"w-3 h-3"}),"Nascimento"]}),c.jsx("p",{className:"text-sm font-medium bg-muted/50 p-2 rounded",children:D.driver_birth_date?new Date(D.driver_birth_date).toLocaleDateString("pt-BR"):"NO INFORMADA"})]}),c.jsxs("div",{className:"col-span-2 space-y-1",children:[c.jsxs(zt,{className:"text-xs text-muted-foreground uppercase flex items-center gap-1",children:[c.jsx(zi,{className:"w-3 h-3"}),"Endereo"]}),c.jsx("p",{className:"text-sm font-medium bg-muted/50 p-2 rounded",children:D.driver_address||"NO INFORMADO"})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-emerald-50 dark:bg-emerald-950/20 rounded-lg border border-emerald-100 dark:border-emerald-800/30",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(rv,{className:`w-5 h-5 ${D.is_driver_approved?"text-emerald-500":"text-amber-500"}`}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-bold",children:"Status de Aprovao"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:D.is_driver_approved?"Motorista aprovado para entregas":"Aguardando anlise de documentos"})]})]}),c.jsx(Bs,{checked:D.is_driver_approved||!1,onCheckedChange:Pt=>{Pt?ot(D.user_id,D.is_driver_approved||!1):ge(!0)},className:"data-[state=checked]:bg-emerald-500"})]}),ie&&c.jsxs("div",{className:"space-y-3 bg-red-50 dark:bg-red-900/10 p-4 rounded-lg border border-red-100 dark:border-red-800/20",children:[c.jsx(zt,{className:"text-xs font-bold text-red-600 uppercase",children:"Motivo da Recusa"}),c.jsx(Ih,{placeholder:"Informe o motivo para o entregador...",value:ee,onChange:Pt=>ae(Pt.target.value),className:"min-h-[80px] bg-background border-red-200 focus-visible:ring-red-500"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Ft,{size:"sm",variant:"destructive",className:"flex-1",onClick:()=>ot(D.user_id,D.is_driver_approved||!1,ee),disabled:!ee.trim(),children:"Confirmar Recusa"}),c.jsx(Ft,{size:"sm",variant:"ghost",className:"flex-1",onClick:()=>{ge(!1),ae("")},children:"Cancelar"})]})]}),D.driver_rejection_reason&&!ie&&!D.is_driver_approved&&c.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-100 dark:border-red-800/20",children:[c.jsx("p",{className:"text-xs font-bold text-red-600 uppercase mb-1",children:"Motivo Atual da Recusa"}),c.jsxs("p",{className:"text-sm italic text-muted-foreground",children:['"',D.driver_rejection_reason,'"']})]})]})]}),c.jsx(Ff,{children:c.jsx(Ft,{variant:"outline",onClick:()=>$(!1),children:"Fechar"})})]})}),c.jsx($l,{open:K,onOpenChange:Y,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Excluir Usurio"}),c.jsxs(Dm,{children:["Tem certeza que deseja excluir o usurio"," ",c.jsx("span",{className:"font-bold text-foreground",children:fe==null?void 0:fe.full_name}),"? Esta ao  irreversvel e remover todos os dados vinculados a este usurio."]})]}),c.jsxs(Ff,{className:"gap-2 sm:gap-0",children:[c.jsx(Ft,{variant:"outline",onClick:()=>Y(!1),disabled:ue,children:"Cancelar"}),c.jsx(Ft,{variant:"destructive",onClick:Be,disabled:ue,children:ue?"Excluindo...":"Confirmar Excluso"})]})]})})]})};var Xke=Array.isArray,fc=Xke,Kke=typeof gS=="object"&&gS&&gS.Object===Object&&gS,Tae=Kke,Yke=Tae,Jke=typeof self=="object"&&self&&self.Object===Object&&self,Qke=Yke||Jke||Function("return this")(),Mh=Qke,eOe=Mh,tOe=eOe.Symbol,lE=tOe,vH=lE,Eae=Object.prototype,rOe=Eae.hasOwnProperty,nOe=Eae.toString,iS=vH?vH.toStringTag:void 0;function iOe(e){var t=rOe.call(e,iS),r=e[iS];try{e[iS]=void 0;var n=!0}catch{}var a=nOe.call(e);return n&&(t?e[iS]=r:delete e[iS]),a}var sOe=iOe,aOe=Object.prototype,oOe=aOe.toString;function lOe(e){return oOe.call(e)}var cOe=lOe,_H=lE,uOe=sOe,dOe=cOe,hOe="[object Null]",fOe="[object Undefined]",xH=_H?_H.toStringTag:void 0;function pOe(e){return e==null?e===void 0?fOe:hOe:xH&&xH in Object(e)?uOe(e):dOe(e)}var Hf=pOe;function mOe(e){return e!=null&&typeof e=="object"}var Zf=mOe,gOe=Hf,yOe=Zf,vOe="[object Symbol]";function _Oe(e){return typeof e=="symbol"||yOe(e)&&gOe(e)==vOe}var Sb=_Oe,xOe=fc,bOe=Sb,wOe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,SOe=/^\w*$/;function TOe(e,t){if(xOe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||bOe(e)?!0:SOe.test(e)||!wOe.test(e)||t!=null&&e in Object(t)}var O5=TOe;function EOe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Qm=EOe;const Tb=es(Qm);var jOe=Hf,AOe=Qm,COe="[object AsyncFunction]",POe="[object Function]",NOe="[object GeneratorFunction]",IOe="[object Proxy]";function kOe(e){if(!AOe(e))return!1;var t=jOe(e);return t==POe||t==NOe||t==COe||t==IOe}var R5=kOe;const On=es(R5);var OOe=Mh,ROe=OOe["__core-js_shared__"],MOe=ROe,OD=MOe,bH=function(){var e=/[^.]+$/.exec(OD&&OD.keys&&OD.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function DOe(e){return!!bH&&bH in e}var LOe=DOe,FOe=Function.prototype,zOe=FOe.toString;function BOe(e){if(e!=null){try{return zOe.call(e)}catch{}try{return e+""}catch{}}return""}var jae=BOe,$Oe=R5,VOe=LOe,UOe=Qm,qOe=jae,GOe=/[\\^$.*+?()[\]{}|]/g,WOe=/^\[object .+?Constructor\]$/,HOe=Function.prototype,ZOe=Object.prototype,XOe=HOe.toString,KOe=ZOe.hasOwnProperty,YOe=RegExp("^"+XOe.call(KOe).replace(GOe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function JOe(e){if(!UOe(e)||VOe(e))return!1;var t=$Oe(e)?YOe:WOe;return t.test(qOe(e))}var QOe=JOe;function eRe(e,t){return e==null?void 0:e[t]}var tRe=eRe,rRe=QOe,nRe=tRe;function iRe(e,t){var r=nRe(e,t);return rRe(r)?r:void 0}var Ev=iRe,sRe=Ev,aRe=sRe(Object,"create"),pk=aRe,wH=pk;function oRe(){this.__data__=wH?wH(null):{},this.size=0}var lRe=oRe;function cRe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var uRe=cRe,dRe=pk,hRe="__lodash_hash_undefined__",fRe=Object.prototype,pRe=fRe.hasOwnProperty;function mRe(e){var t=this.__data__;if(dRe){var r=t[e];return r===hRe?void 0:r}return pRe.call(t,e)?t[e]:void 0}var gRe=mRe,yRe=pk,vRe=Object.prototype,_Re=vRe.hasOwnProperty;function xRe(e){var t=this.__data__;return yRe?t[e]!==void 0:_Re.call(t,e)}var bRe=xRe,wRe=pk,SRe="__lodash_hash_undefined__";function TRe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=wRe&&t===void 0?SRe:t,this}var ERe=TRe,jRe=lRe,ARe=uRe,CRe=gRe,PRe=bRe,NRe=ERe;function Eb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Eb.prototype.clear=jRe;Eb.prototype.delete=ARe;Eb.prototype.get=CRe;Eb.prototype.has=PRe;Eb.prototype.set=NRe;var IRe=Eb;function kRe(){this.__data__=[],this.size=0}var ORe=kRe;function RRe(e,t){return e===t||e!==e&&t!==t}var M5=RRe,MRe=M5;function DRe(e,t){for(var r=e.length;r--;)if(MRe(e[r][0],t))return r;return-1}var mk=DRe,LRe=mk,FRe=Array.prototype,zRe=FRe.splice;function BRe(e){var t=this.__data__,r=LRe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():zRe.call(t,r,1),--this.size,!0}var $Re=BRe,VRe=mk;function URe(e){var t=this.__data__,r=VRe(t,e);return r<0?void 0:t[r][1]}var qRe=URe,GRe=mk;function WRe(e){return GRe(this.__data__,e)>-1}var HRe=WRe,ZRe=mk;function XRe(e,t){var r=this.__data__,n=ZRe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var KRe=XRe,YRe=ORe,JRe=$Re,QRe=qRe,eMe=HRe,tMe=KRe;function jb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}jb.prototype.clear=YRe;jb.prototype.delete=JRe;jb.prototype.get=QRe;jb.prototype.has=eMe;jb.prototype.set=tMe;var gk=jb,rMe=Ev,nMe=Mh,iMe=rMe(nMe,"Map"),D5=iMe,SH=IRe,sMe=gk,aMe=D5;function oMe(){this.size=0,this.__data__={hash:new SH,map:new(aMe||sMe),string:new SH}}var lMe=oMe;function cMe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var uMe=cMe,dMe=uMe;function hMe(e,t){var r=e.__data__;return dMe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var yk=hMe,fMe=yk;function pMe(e){var t=fMe(this,e).delete(e);return this.size-=t?1:0,t}var mMe=pMe,gMe=yk;function yMe(e){return gMe(this,e).get(e)}var vMe=yMe,_Me=yk;function xMe(e){return _Me(this,e).has(e)}var bMe=xMe,wMe=yk;function SMe(e,t){var r=wMe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var TMe=SMe,EMe=lMe,jMe=mMe,AMe=vMe,CMe=bMe,PMe=TMe;function Ab(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ab.prototype.clear=EMe;Ab.prototype.delete=jMe;Ab.prototype.get=AMe;Ab.prototype.has=CMe;Ab.prototype.set=PMe;var L5=Ab,Aae=L5,NMe="Expected a function";function F5(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(NMe);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],d=r.cache;if(d.has(a))return d.get(a);var p=e.apply(this,n);return r.cache=d.set(a,p)||d,p};return r.cache=new(F5.Cache||Aae),r}F5.Cache=Aae;var Cae=F5;const IMe=es(Cae);var kMe=Cae,OMe=500;function RMe(e){var t=kMe(e,function(n){return r.size===OMe&&r.clear(),n}),r=t.cache;return t}var MMe=RMe,DMe=MMe,LMe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,FMe=/\\(\\)?/g,zMe=DMe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(LMe,function(r,n,a,d){t.push(a?d.replace(FMe,"$1"):n||r)}),t}),BMe=zMe;function $Me(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var z5=$Me,TH=lE,VMe=z5,UMe=fc,qMe=Sb,EH=TH?TH.prototype:void 0,jH=EH?EH.toString:void 0;function Pae(e){if(typeof e=="string")return e;if(UMe(e))return VMe(e,Pae)+"";if(qMe(e))return jH?jH.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var GMe=Pae,WMe=GMe;function HMe(e){return e==null?"":WMe(e)}var Nae=HMe,ZMe=fc,XMe=O5,KMe=BMe,YMe=Nae;function JMe(e,t){return ZMe(e)?e:XMe(e,t)?[e]:KMe(YMe(e))}var Iae=JMe,QMe=Sb;function eDe(e){if(typeof e=="string"||QMe(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var vk=eDe,tDe=Iae,rDe=vk;function nDe(e,t){t=tDe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[rDe(t[r++])];return r&&r==n?e:void 0}var B5=nDe,iDe=B5;function sDe(e,t,r){var n=e==null?void 0:iDe(e,t);return n===void 0?r:n}var kae=sDe;const Lc=es(kae);function aDe(e){return e==null}var oDe=aDe;const qn=es(oDe);var lDe=Hf,cDe=fc,uDe=Zf,dDe="[object String]";function hDe(e){return typeof e=="string"||!cDe(e)&&uDe(e)&&lDe(e)==dDe}var fDe=hDe;const lv=es(fDe);var Oae={exports:{}},ds={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $5=Symbol.for("react.element"),V5=Symbol.for("react.portal"),_k=Symbol.for("react.fragment"),xk=Symbol.for("react.strict_mode"),bk=Symbol.for("react.profiler"),wk=Symbol.for("react.provider"),Sk=Symbol.for("react.context"),pDe=Symbol.for("react.server_context"),Tk=Symbol.for("react.forward_ref"),Ek=Symbol.for("react.suspense"),jk=Symbol.for("react.suspense_list"),Ak=Symbol.for("react.memo"),Ck=Symbol.for("react.lazy"),mDe=Symbol.for("react.offscreen"),Rae;Rae=Symbol.for("react.module.reference");function Pu(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case $5:switch(e=e.type,e){case _k:case bk:case xk:case Ek:case jk:return e;default:switch(e=e&&e.$$typeof,e){case pDe:case Sk:case Tk:case Ck:case Ak:case wk:return e;default:return t}}case V5:return t}}}ds.ContextConsumer=Sk;ds.ContextProvider=wk;ds.Element=$5;ds.ForwardRef=Tk;ds.Fragment=_k;ds.Lazy=Ck;ds.Memo=Ak;ds.Portal=V5;ds.Profiler=bk;ds.StrictMode=xk;ds.Suspense=Ek;ds.SuspenseList=jk;ds.isAsyncMode=function(){return!1};ds.isConcurrentMode=function(){return!1};ds.isContextConsumer=function(e){return Pu(e)===Sk};ds.isContextProvider=function(e){return Pu(e)===wk};ds.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===$5};ds.isForwardRef=function(e){return Pu(e)===Tk};ds.isFragment=function(e){return Pu(e)===_k};ds.isLazy=function(e){return Pu(e)===Ck};ds.isMemo=function(e){return Pu(e)===Ak};ds.isPortal=function(e){return Pu(e)===V5};ds.isProfiler=function(e){return Pu(e)===bk};ds.isStrictMode=function(e){return Pu(e)===xk};ds.isSuspense=function(e){return Pu(e)===Ek};ds.isSuspenseList=function(e){return Pu(e)===jk};ds.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===_k||e===bk||e===xk||e===Ek||e===jk||e===mDe||typeof e=="object"&&e!==null&&(e.$$typeof===Ck||e.$$typeof===Ak||e.$$typeof===wk||e.$$typeof===Sk||e.$$typeof===Tk||e.$$typeof===Rae||e.getModuleId!==void 0)};ds.typeOf=Pu;Oae.exports=ds;var gDe=Oae.exports,yDe=Hf,vDe=Zf,_De="[object Number]";function xDe(e){return typeof e=="number"||vDe(e)&&yDe(e)==_De}var Mae=xDe;const bDe=es(Mae);var wDe=Mae;function SDe(e){return wDe(e)&&e!=+e}var TDe=SDe;const Cb=es(TDe);var Dl=function(t){return t===0?0:t>0?1:-1},Py=function(t){return lv(t)&&t.indexOf("%")===t.length-1},br=function(t){return bDe(t)&&!Cb(t)},EDe=function(t){return qn(t)},ro=function(t){return br(t)||lv(t)},jDe=0,jv=function(t){var r=++jDe;return"".concat(t||"").concat(r)},Ll=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!br(t)&&!lv(t))return n;var d;if(Py(t)){var p=t.indexOf("%");d=r*parseFloat(t.slice(0,p))/100}else d=+t;return Cb(d)&&(d=n),a&&d>r&&(d=r),d},em=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},ADe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},Qa=function(t,r){return br(t)&&br(r)?function(n){return t+n*(r-t)}:function(){return r}};function rN(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Lc(n,t))===r})}var CDe=function(t,r){return br(t)&&br(r)?t-r:lv(t)&&lv(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Jx(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function bF(e){"@babel/helpers - typeof";return bF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bF(e)}var PDe=["viewBox","children"],NDe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],AH=["points","pathLength"],RD={svg:PDe,polygon:AH,polyline:AH},U5=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],nN=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(F.isValidElement(t)&&(n=t.props),!Tb(n))return null;var a={};return Object.keys(n).forEach(function(d){U5.includes(d)&&(a[d]=r||function(p){return n[d](n,p)})}),a},IDe=function(t,r,n){return function(a){return t(r,n,a),null}},cv=function(t,r,n){if(!Tb(t)||bF(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(d){var p=t[d];U5.includes(d)&&typeof p=="function"&&(a||(a={}),a[d]=IDe(p,r,n))}),a},kDe=["children"],ODe=["children"];function CH(e,t){if(e==null)return{};var r=RDe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function RDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function wF(e){"@babel/helpers - typeof";return wF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wF(e)}var PH={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},jf=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},NH=null,MD=null,q5=function e(t){if(t===NH&&Array.isArray(MD))return MD;var r=[];return F.Children.forEach(t,function(n){qn(n)||(gDe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),MD=r,NH=t,r};function Fc(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return jf(a)}):n=[jf(t)],q5(e).forEach(function(a){var d=Lc(a,"type.displayName")||Lc(a,"type.name");n.indexOf(d)!==-1&&r.push(a)}),r}function jc(e,t){var r=Fc(e,t);return r&&r[0]}var IH=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!br(n)||n<=0||!br(a)||a<=0)},MDe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],DDe=function(t){return t&&t.type&&lv(t.type)&&MDe.indexOf(t.type)>=0},Dae=function(t){return t&&wF(t)==="object"&&"clipDot"in t},LDe=function(t,r,n,a){var d,p=(d=RD==null?void 0:RD[a])!==null&&d!==void 0?d:[];return r.startsWith("data-")||!On(t)&&(a&&p.includes(r)||NDe.includes(r))||n&&U5.includes(r)},pn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(F.isValidElement(t)&&(a=t.props),!Tb(a))return null;var d={};return Object.keys(a).forEach(function(p){var s;LDe((s=a)===null||s===void 0?void 0:s[p],p,r,n)&&(d[p]=a[p])}),d},SF=function e(t,r){if(t===r)return!0;var n=F.Children.count(t);if(n!==F.Children.count(r))return!1;if(n===0)return!0;if(n===1)return kH(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var d=t[a],p=r[a];if(Array.isArray(d)||Array.isArray(p)){if(!e(d,p))return!1}else if(!kH(d,p))return!1}return!0},kH=function(t,r){if(qn(t)&&qn(r))return!0;if(!qn(t)&&!qn(r)){var n=t.props||{},a=n.children,d=CH(n,kDe),p=r.props||{},s=p.children,_=CH(p,ODe);return a&&s?Jx(d,_)&&SF(a,s):!a&&!s?Jx(d,_):!1}return!1},OH=function(t,r){var n=[],a={};return q5(t).forEach(function(d,p){if(DDe(d))n.push(d);else if(d){var s=jf(d.type),_=r[s]||{},b=_.handler,T=_.once;if(b&&(!T||!a[s])){var C=b(d,s,p);n.push(C),a[s]=!0}}}),n},FDe=function(t){var r=t&&t.type;return r&&PH[r]?PH[r]:null},zDe=function(t,r){return q5(r).indexOf(t)},BDe=["children","width","height","viewBox","className","style","title","desc"];function TF(){return TF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},TF.apply(this,arguments)}function $De(e,t){if(e==null)return{};var r=VDe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function EF(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,d=e.className,p=e.style,s=e.title,_=e.desc,b=$De(e,BDe),T=a||{width:r,height:n,x:0,y:0},C=Zn("recharts-surface",d);return De.createElement("svg",TF({},pn(b,!0,"svg"),{className:C,width:r,height:n,style:p,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),De.createElement("title",null,s),De.createElement("desc",null,_),t)}var UDe=["children","className"];function jF(){return jF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jF.apply(this,arguments)}function qDe(e,t){if(e==null)return{};var r=GDe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function GDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var vi=De.forwardRef(function(e,t){var r=e.children,n=e.className,a=qDe(e,UDe),d=Zn("recharts-layer",n);return De.createElement("g",jF({className:d},pn(a,!0),{ref:t}),r)}),yd=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),d=2;d<n;d++)a[d-2]=arguments[d]};function WDe(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),r=r>a?a:r,r<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var d=Array(a);++n<a;)d[n]=e[n+t];return d}var HDe=WDe,ZDe=HDe;function XDe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:ZDe(e,t,r)}var KDe=XDe,YDe="\\ud800-\\udfff",JDe="\\u0300-\\u036f",QDe="\\ufe20-\\ufe2f",eLe="\\u20d0-\\u20ff",tLe=JDe+QDe+eLe,rLe="\\ufe0e\\ufe0f",nLe="\\u200d",iLe=RegExp("["+nLe+YDe+tLe+rLe+"]");function sLe(e){return iLe.test(e)}var Lae=sLe;function aLe(e){return e.split("")}var oLe=aLe,Fae="\\ud800-\\udfff",lLe="\\u0300-\\u036f",cLe="\\ufe20-\\ufe2f",uLe="\\u20d0-\\u20ff",dLe=lLe+cLe+uLe,hLe="\\ufe0e\\ufe0f",fLe="["+Fae+"]",AF="["+dLe+"]",CF="\\ud83c[\\udffb-\\udfff]",pLe="(?:"+AF+"|"+CF+")",zae="[^"+Fae+"]",Bae="(?:\\ud83c[\\udde6-\\uddff]){2}",$ae="[\\ud800-\\udbff][\\udc00-\\udfff]",mLe="\\u200d",Vae=pLe+"?",Uae="["+hLe+"]?",gLe="(?:"+mLe+"(?:"+[zae,Bae,$ae].join("|")+")"+Uae+Vae+")*",yLe=Uae+Vae+gLe,vLe="(?:"+[zae+AF+"?",AF,Bae,$ae,fLe].join("|")+")",_Le=RegExp(CF+"(?="+CF+")|"+vLe+yLe,"g");function xLe(e){return e.match(_Le)||[]}var bLe=xLe,wLe=oLe,SLe=Lae,TLe=bLe;function ELe(e){return SLe(e)?TLe(e):wLe(e)}var jLe=ELe,ALe=KDe,CLe=Lae,PLe=jLe,NLe=Nae;function ILe(e){return function(t){t=NLe(t);var r=CLe(t)?PLe(t):void 0,n=r?r[0]:t.charAt(0),a=r?ALe(r,1).join(""):t.slice(1);return n[e]()+a}}var kLe=ILe,OLe=kLe,RLe=OLe("toUpperCase"),MLe=RLe;const Pk=es(MLe);function Ss(e){return function(){return e}}const qae=Math.cos,iN=Math.sin,Cd=Math.sqrt,sN=Math.PI,Nk=2*sN,PF=Math.PI,NF=2*PF,py=1e-6,DLe=NF-py;function Gae(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function LLe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Gae;const r=10**t;return function(n){this._+=n[0];for(let a=1,d=n.length;a<d;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class FLe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Gae:LLe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,d,p){this._append`C${+t},${+r},${+n},${+a},${this._x1=+d},${this._y1=+p}`}arcTo(t,r,n,a,d){if(t=+t,r=+r,n=+n,a=+a,d=+d,d<0)throw new Error(`negative radius: ${d}`);let p=this._x1,s=this._y1,_=n-t,b=a-r,T=p-t,C=s-r,P=T*T+C*C;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(P>py)if(!(Math.abs(C*_-b*T)>py)||!d)this._append`L${this._x1=t},${this._y1=r}`;else{let k=n-p,B=a-s,R=_*_+b*b,D=k*k+B*B,G=Math.sqrt(R),V=Math.sqrt(P),$=d*Math.tan((PF-Math.acos((R+P-D)/(2*G*V)))/2),K=$/V,Y=$/G;Math.abs(K-1)>py&&this._append`L${t+K*T},${r+K*C}`,this._append`A${d},${d},0,0,${+(C*k>T*B)},${this._x1=t+Y*_},${this._y1=r+Y*b}`}}arc(t,r,n,a,d,p){if(t=+t,r=+r,n=+n,p=!!p,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(a),_=n*Math.sin(a),b=t+s,T=r+_,C=1^p,P=p?a-d:d-a;this._x1===null?this._append`M${b},${T}`:(Math.abs(this._x1-b)>py||Math.abs(this._y1-T)>py)&&this._append`L${b},${T}`,n&&(P<0&&(P=P%NF+NF),P>DLe?this._append`A${n},${n},0,1,${C},${t-s},${r-_}A${n},${n},0,1,${C},${this._x1=b},${this._y1=T}`:P>py&&this._append`A${n},${n},0,${+(P>=PF)},${C},${this._x1=t+n*Math.cos(d)},${this._y1=r+n*Math.sin(d)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function G5(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new FLe(t)}function W5(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Wae(e){this._context=e}Wae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Ik(e){return new Wae(e)}function Hae(e){return e[0]}function Zae(e){return e[1]}function Xae(e,t){var r=Ss(!0),n=null,a=Ik,d=null,p=G5(s);e=typeof e=="function"?e:e===void 0?Hae:Ss(e),t=typeof t=="function"?t:t===void 0?Zae:Ss(t);function s(_){var b,T=(_=W5(_)).length,C,P=!1,k;for(n==null&&(d=a(k=p())),b=0;b<=T;++b)!(b<T&&r(C=_[b],b,_))===P&&((P=!P)?d.lineStart():d.lineEnd()),P&&d.point(+e(C,b,_),+t(C,b,_));if(k)return d=null,k+""||null}return s.x=function(_){return arguments.length?(e=typeof _=="function"?_:Ss(+_),s):e},s.y=function(_){return arguments.length?(t=typeof _=="function"?_:Ss(+_),s):t},s.defined=function(_){return arguments.length?(r=typeof _=="function"?_:Ss(!!_),s):r},s.curve=function(_){return arguments.length?(a=_,n!=null&&(d=a(n)),s):a},s.context=function(_){return arguments.length?(_==null?n=d=null:d=a(n=_),s):n},s}function wC(e,t,r){var n=null,a=Ss(!0),d=null,p=Ik,s=null,_=G5(b);e=typeof e=="function"?e:e===void 0?Hae:Ss(+e),t=typeof t=="function"?t:Ss(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?Zae:Ss(+r);function b(C){var P,k,B,R=(C=W5(C)).length,D,G=!1,V,$=new Array(R),K=new Array(R);for(d==null&&(s=p(V=_())),P=0;P<=R;++P){if(!(P<R&&a(D=C[P],P,C))===G)if(G=!G)k=P,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),B=P-1;B>=k;--B)s.point($[B],K[B]);s.lineEnd(),s.areaEnd()}G&&($[P]=+e(D,P,C),K[P]=+t(D,P,C),s.point(n?+n(D,P,C):$[P],r?+r(D,P,C):K[P]))}if(V)return s=null,V+""||null}function T(){return Xae().defined(a).curve(p).context(d)}return b.x=function(C){return arguments.length?(e=typeof C=="function"?C:Ss(+C),n=null,b):e},b.x0=function(C){return arguments.length?(e=typeof C=="function"?C:Ss(+C),b):e},b.x1=function(C){return arguments.length?(n=C==null?null:typeof C=="function"?C:Ss(+C),b):n},b.y=function(C){return arguments.length?(t=typeof C=="function"?C:Ss(+C),r=null,b):t},b.y0=function(C){return arguments.length?(t=typeof C=="function"?C:Ss(+C),b):t},b.y1=function(C){return arguments.length?(r=C==null?null:typeof C=="function"?C:Ss(+C),b):r},b.lineX0=b.lineY0=function(){return T().x(e).y(t)},b.lineY1=function(){return T().x(e).y(r)},b.lineX1=function(){return T().x(n).y(t)},b.defined=function(C){return arguments.length?(a=typeof C=="function"?C:Ss(!!C),b):a},b.curve=function(C){return arguments.length?(p=C,d!=null&&(s=p(d)),b):p},b.context=function(C){return arguments.length?(C==null?d=s=null:s=p(d=C),b):d},b}class Kae{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function zLe(e){return new Kae(e,!0)}function BLe(e){return new Kae(e,!1)}const H5={draw(e,t){const r=Cd(t/sN);e.moveTo(r,0),e.arc(0,0,r,0,Nk)}},$Le={draw(e,t){const r=Cd(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},Yae=Cd(1/3),VLe=Yae*2,ULe={draw(e,t){const r=Cd(t/VLe),n=r*Yae;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},qLe={draw(e,t){const r=Cd(t),n=-r/2;e.rect(n,n,r,r)}},GLe=.8908130915292852,Jae=iN(sN/10)/iN(7*sN/10),WLe=iN(Nk/10)*Jae,HLe=-qae(Nk/10)*Jae,ZLe={draw(e,t){const r=Cd(t*GLe),n=WLe*r,a=HLe*r;e.moveTo(0,-r),e.lineTo(n,a);for(let d=1;d<5;++d){const p=Nk*d/5,s=qae(p),_=iN(p);e.lineTo(_*r,-s*r),e.lineTo(s*n-_*a,_*n+s*a)}e.closePath()}},DD=Cd(3),XLe={draw(e,t){const r=-Cd(t/(DD*3));e.moveTo(0,r*2),e.lineTo(-DD*r,-r),e.lineTo(DD*r,-r),e.closePath()}},cu=-.5,uu=Cd(3)/2,IF=1/Cd(12),KLe=(IF/2+1)*3,YLe={draw(e,t){const r=Cd(t/KLe),n=r/2,a=r*IF,d=n,p=r*IF+r,s=-d,_=p;e.moveTo(n,a),e.lineTo(d,p),e.lineTo(s,_),e.lineTo(cu*n-uu*a,uu*n+cu*a),e.lineTo(cu*d-uu*p,uu*d+cu*p),e.lineTo(cu*s-uu*_,uu*s+cu*_),e.lineTo(cu*n+uu*a,cu*a-uu*n),e.lineTo(cu*d+uu*p,cu*p-uu*d),e.lineTo(cu*s+uu*_,cu*_-uu*s),e.closePath()}};function JLe(e,t){let r=null,n=G5(a);e=typeof e=="function"?e:Ss(e||H5),t=typeof t=="function"?t:Ss(t===void 0?64:+t);function a(){let d;if(r||(r=d=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),d)return r=null,d+""||null}return a.type=function(d){return arguments.length?(e=typeof d=="function"?d:Ss(d),a):e},a.size=function(d){return arguments.length?(t=typeof d=="function"?d:Ss(+d),a):t},a.context=function(d){return arguments.length?(r=d??null,a):r},a}function aN(){}function oN(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Qae(e){this._context=e}Qae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:oN(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:oN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function QLe(e){return new Qae(e)}function eoe(e){this._context=e}eoe.prototype={areaStart:aN,areaEnd:aN,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:oN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function e3e(e){return new eoe(e)}function toe(e){this._context=e}toe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:oN(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function t3e(e){return new toe(e)}function roe(e){this._context=e}roe.prototype={areaStart:aN,areaEnd:aN,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function r3e(e){return new roe(e)}function RH(e){return e<0?-1:1}function MH(e,t,r){var n=e._x1-e._x0,a=t-e._x1,d=(e._y1-e._y0)/(n||a<0&&-0),p=(r-e._y1)/(a||n<0&&-0),s=(d*a+p*n)/(n+a);return(RH(d)+RH(p))*Math.min(Math.abs(d),Math.abs(p),.5*Math.abs(s))||0}function DH(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function LD(e,t,r){var n=e._x0,a=e._y0,d=e._x1,p=e._y1,s=(d-n)/3;e._context.bezierCurveTo(n+s,a+s*t,d-s,p-s*r,d,p)}function lN(e){this._context=e}lN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:LD(this,this._t0,DH(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,LD(this,DH(this,r=MH(this,e,t)),r);break;default:LD(this,this._t0,r=MH(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function noe(e){this._context=new ioe(e)}(noe.prototype=Object.create(lN.prototype)).point=function(e,t){lN.prototype.point.call(this,t,e)};function ioe(e){this._context=e}ioe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,d){this._context.bezierCurveTo(t,e,n,r,d,a)}};function n3e(e){return new lN(e)}function i3e(e){return new noe(e)}function soe(e){this._context=e}soe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=LH(e),a=LH(t),d=0,p=1;p<r;++d,++p)this._context.bezierCurveTo(n[0][d],a[0][d],n[1][d],a[1][d],e[p],t[p]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function LH(e){var t,r=e.length-1,n,a=new Array(r),d=new Array(r),p=new Array(r);for(a[0]=0,d[0]=2,p[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,d[t]=4,p[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,d[r-1]=7,p[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/d[t-1],d[t]-=n,p[t]-=n*p[t-1];for(a[r-1]=p[r-1]/d[r-1],t=r-2;t>=0;--t)a[t]=(p[t]-a[t+1])/d[t];for(d[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)d[t]=2*e[t+1]-a[t+1];return[a,d]}function s3e(e){return new soe(e)}function kk(e,t){this._context=e,this._t=t}kk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function a3e(e){return new kk(e,.5)}function o3e(e){return new kk(e,0)}function l3e(e){return new kk(e,1)}function k0(e,t){if((p=e.length)>1)for(var r=1,n,a,d=e[t[0]],p,s=d.length;r<p;++r)for(a=d,d=e[t[r]],n=0;n<s;++n)d[n][1]+=d[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function kF(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function c3e(e,t){return e[t]}function u3e(e){const t=[];return t.key=e,t}function d3e(){var e=Ss([]),t=kF,r=k0,n=c3e;function a(d){var p=Array.from(e.apply(this,arguments),u3e),s,_=p.length,b=-1,T;for(const C of d)for(s=0,++b;s<_;++s)(p[s][b]=[0,+n(C,p[s].key,b,d)]).data=C;for(s=0,T=W5(t(p));s<_;++s)p[T[s]].index=s;return r(p,T),p}return a.keys=function(d){return arguments.length?(e=typeof d=="function"?d:Ss(Array.from(d)),a):e},a.value=function(d){return arguments.length?(n=typeof d=="function"?d:Ss(+d),a):n},a.order=function(d){return arguments.length?(t=d==null?kF:typeof d=="function"?d:Ss(Array.from(d)),a):t},a.offset=function(d){return arguments.length?(r=d??k0,a):r},a}function h3e(e,t){if((n=e.length)>0){for(var r,n,a=0,d=e[0].length,p;a<d;++a){for(p=r=0;r<n;++r)p+=e[r][a][1]||0;if(p)for(r=0;r<n;++r)e[r][a][1]/=p}k0(e,t)}}function f3e(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,d=n.length;r<d;++r){for(var p=0,s=0;p<a;++p)s+=e[p][r][1]||0;n[r][1]+=n[r][0]=-s/2}k0(e,t)}}function p3e(e,t){if(!(!((p=e.length)>0)||!((d=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,d,p;n<d;++n){for(var s=0,_=0,b=0;s<p;++s){for(var T=e[t[s]],C=T[n][1]||0,P=T[n-1][1]||0,k=(C-P)/2,B=0;B<s;++B){var R=e[t[B]],D=R[n][1]||0,G=R[n-1][1]||0;k+=D-G}_+=C,b+=k*C}a[n-1][1]+=a[n-1][0]=r,_&&(r-=b/_)}a[n-1][1]+=a[n-1][0]=r,k0(e,t)}}function qT(e){"@babel/helpers - typeof";return qT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qT(e)}var m3e=["type","size","sizeType"];function OF(){return OF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},OF.apply(this,arguments)}function FH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FH(Object(r),!0).forEach(function(n){g3e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function g3e(e,t,r){return t=y3e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y3e(e){var t=v3e(e,"string");return qT(t)=="symbol"?t:t+""}function v3e(e,t){if(qT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(qT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _3e(e,t){if(e==null)return{};var r=x3e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x3e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var aoe={symbolCircle:H5,symbolCross:$Le,symbolDiamond:ULe,symbolSquare:qLe,symbolStar:ZLe,symbolTriangle:XLe,symbolWye:YLe},b3e=Math.PI/180,w3e=function(t){var r="symbol".concat(Pk(t));return aoe[r]||H5},S3e=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*b3e;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},T3e=function(t,r){aoe["symbol".concat(Pk(t))]=r},Z5=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,d=a===void 0?64:a,p=t.sizeType,s=p===void 0?"area":p,_=_3e(t,m3e),b=zH(zH({},_),{},{type:n,size:d,sizeType:s}),T=function(){var D=w3e(n),G=JLe().type(D).size(S3e(d,s,n));return G()},C=b.className,P=b.cx,k=b.cy,B=pn(b,!0);return P===+P&&k===+k&&d===+d?De.createElement("path",OF({},B,{className:Zn("recharts-symbols",C),transform:"translate(".concat(P,", ").concat(k,")"),d:T()})):null};Z5.registerSymbol=T3e;function O0(e){"@babel/helpers - typeof";return O0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O0(e)}function RF(){return RF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},RF.apply(this,arguments)}function BH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function E3e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BH(Object(r),!0).forEach(function(n){GT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function j3e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A3e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,loe(n.key),n)}}function C3e(e,t,r){return t&&A3e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function P3e(e,t,r){return t=cN(t),N3e(e,ooe()?Reflect.construct(t,r||[],cN(e).constructor):t.apply(e,r))}function N3e(e,t){if(t&&(O0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return I3e(e)}function I3e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ooe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ooe=function(){return!!e})()}function cN(e){return cN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},cN(e)}function k3e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MF(e,t)}function MF(e,t){return MF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},MF(e,t)}function GT(e,t,r){return t=loe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function loe(e){var t=O3e(e,"string");return O0(t)=="symbol"?t:t+""}function O3e(e,t){if(O0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(O0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var du=32,X5=function(e){function t(){return j3e(this,t),P3e(this,t,arguments)}return k3e(t,e),C3e(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,d=du/2,p=du/6,s=du/3,_=n.inactive?a:n.color;if(n.type==="plainline")return De.createElement("line",{strokeWidth:4,fill:"none",stroke:_,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:d,x2:du,y2:d,className:"recharts-legend-icon"});if(n.type==="line")return De.createElement("path",{strokeWidth:4,fill:"none",stroke:_,d:"M0,".concat(d,"h").concat(s,`
            A`).concat(p,",").concat(p,",0,1,1,").concat(2*s,",").concat(d,`
            H`).concat(du,"M").concat(2*s,",").concat(d,`
            A`).concat(p,",").concat(p,",0,1,1,").concat(s,",").concat(d),className:"recharts-legend-icon"});if(n.type==="rect")return De.createElement("path",{stroke:"none",fill:_,d:"M0,".concat(du/8,"h").concat(du,"v").concat(du*3/4,"h").concat(-du,"z"),className:"recharts-legend-icon"});if(De.isValidElement(n.legendIcon)){var b=E3e({},n);return delete b.legendIcon,De.cloneElement(n.legendIcon,b)}return De.createElement(Z5,{fill:_,cx:d,cy:d,size:du,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,d=a.payload,p=a.iconSize,s=a.layout,_=a.formatter,b=a.inactiveColor,T={x:0,y:0,width:du,height:du},C={display:s==="horizontal"?"inline-block":"block",marginRight:10},P={display:"inline-block",verticalAlign:"middle",marginRight:4};return d.map(function(k,B){var R=k.formatter||_,D=Zn(GT(GT({"recharts-legend-item":!0},"legend-item-".concat(B),!0),"inactive",k.inactive));if(k.type==="none")return null;var G=On(k.value)?null:k.value;yd(!On(k.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var V=k.inactive?b:k.color;return De.createElement("li",RF({className:D,style:C,key:"legend-item-".concat(B)},cv(n.props,k,B)),De.createElement(EF,{width:p,height:p,viewBox:T,style:P},n.renderIcon(k)),De.createElement("span",{className:"recharts-legend-item-text",style:{color:V}},R?R(G,k,B):G))})}},{key:"render",value:function(){var n=this.props,a=n.payload,d=n.layout,p=n.align;if(!a||!a.length)return null;var s={padding:0,margin:0,textAlign:d==="horizontal"?p:"left"};return De.createElement("ul",{className:"recharts-default-legend",style:s},this.renderItems())}}])}(F.PureComponent);GT(X5,"displayName","Legend");GT(X5,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var R3e=gk;function M3e(){this.__data__=new R3e,this.size=0}var D3e=M3e;function L3e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var F3e=L3e;function z3e(e){return this.__data__.get(e)}var B3e=z3e;function $3e(e){return this.__data__.has(e)}var V3e=$3e,U3e=gk,q3e=D5,G3e=L5,W3e=200;function H3e(e,t){var r=this.__data__;if(r instanceof U3e){var n=r.__data__;if(!q3e||n.length<W3e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new G3e(n)}return r.set(e,t),this.size=r.size,this}var Z3e=H3e,X3e=gk,K3e=D3e,Y3e=F3e,J3e=B3e,Q3e=V3e,eFe=Z3e;function Pb(e){var t=this.__data__=new X3e(e);this.size=t.size}Pb.prototype.clear=K3e;Pb.prototype.delete=Y3e;Pb.prototype.get=J3e;Pb.prototype.has=Q3e;Pb.prototype.set=eFe;var coe=Pb,tFe="__lodash_hash_undefined__";function rFe(e){return this.__data__.set(e,tFe),this}var nFe=rFe;function iFe(e){return this.__data__.has(e)}var sFe=iFe,aFe=L5,oFe=nFe,lFe=sFe;function uN(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new aFe;++t<r;)this.add(e[t])}uN.prototype.add=uN.prototype.push=oFe;uN.prototype.has=lFe;var uoe=uN;function cFe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var doe=cFe;function uFe(e,t){return e.has(t)}var hoe=uFe,dFe=uoe,hFe=doe,fFe=hoe,pFe=1,mFe=2;function gFe(e,t,r,n,a,d){var p=r&pFe,s=e.length,_=t.length;if(s!=_&&!(p&&_>s))return!1;var b=d.get(e),T=d.get(t);if(b&&T)return b==t&&T==e;var C=-1,P=!0,k=r&mFe?new dFe:void 0;for(d.set(e,t),d.set(t,e);++C<s;){var B=e[C],R=t[C];if(n)var D=p?n(R,B,C,t,e,d):n(B,R,C,e,t,d);if(D!==void 0){if(D)continue;P=!1;break}if(k){if(!hFe(t,function(G,V){if(!fFe(k,V)&&(B===G||a(B,G,r,n,d)))return k.push(V)})){P=!1;break}}else if(!(B===R||a(B,R,r,n,d))){P=!1;break}}return d.delete(e),d.delete(t),P}var foe=gFe,yFe=Mh,vFe=yFe.Uint8Array,_Fe=vFe;function xFe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var bFe=xFe;function wFe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var K5=wFe,$H=lE,VH=_Fe,SFe=M5,TFe=foe,EFe=bFe,jFe=K5,AFe=1,CFe=2,PFe="[object Boolean]",NFe="[object Date]",IFe="[object Error]",kFe="[object Map]",OFe="[object Number]",RFe="[object RegExp]",MFe="[object Set]",DFe="[object String]",LFe="[object Symbol]",FFe="[object ArrayBuffer]",zFe="[object DataView]",UH=$H?$H.prototype:void 0,FD=UH?UH.valueOf:void 0;function BFe(e,t,r,n,a,d,p){switch(r){case zFe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case FFe:return!(e.byteLength!=t.byteLength||!d(new VH(e),new VH(t)));case PFe:case NFe:case OFe:return SFe(+e,+t);case IFe:return e.name==t.name&&e.message==t.message;case RFe:case DFe:return e==t+"";case kFe:var s=EFe;case MFe:var _=n&AFe;if(s||(s=jFe),e.size!=t.size&&!_)return!1;var b=p.get(e);if(b)return b==t;n|=CFe,p.set(e,t);var T=TFe(s(e),s(t),n,a,d,p);return p.delete(e),T;case LFe:if(FD)return FD.call(e)==FD.call(t)}return!1}var $Fe=BFe;function VFe(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var poe=VFe,UFe=poe,qFe=fc;function GFe(e,t,r){var n=t(e);return qFe(e)?n:UFe(n,r(e))}var WFe=GFe;function HFe(e,t){for(var r=-1,n=e==null?0:e.length,a=0,d=[];++r<n;){var p=e[r];t(p,r,e)&&(d[a++]=p)}return d}var ZFe=HFe;function XFe(){return[]}var KFe=XFe,YFe=ZFe,JFe=KFe,QFe=Object.prototype,eze=QFe.propertyIsEnumerable,qH=Object.getOwnPropertySymbols,tze=qH?function(e){return e==null?[]:(e=Object(e),YFe(qH(e),function(t){return eze.call(e,t)}))}:JFe,rze=tze;function nze(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var ize=nze,sze=Hf,aze=Zf,oze="[object Arguments]";function lze(e){return aze(e)&&sze(e)==oze}var cze=lze,GH=cze,uze=Zf,moe=Object.prototype,dze=moe.hasOwnProperty,hze=moe.propertyIsEnumerable,fze=GH(function(){return arguments}())?GH:function(e){return uze(e)&&dze.call(e,"callee")&&!hze.call(e,"callee")},Y5=fze,dN={exports:{}};function pze(){return!1}var mze=pze;dN.exports;(function(e,t){var r=Mh,n=mze,a=t&&!t.nodeType&&t,d=a&&!0&&e&&!e.nodeType&&e,p=d&&d.exports===a,s=p?r.Buffer:void 0,_=s?s.isBuffer:void 0,b=_||n;e.exports=b})(dN,dN.exports);var goe=dN.exports,gze=9007199254740991,yze=/^(?:0|[1-9]\d*)$/;function vze(e,t){var r=typeof e;return t=t??gze,!!t&&(r=="number"||r!="symbol"&&yze.test(e))&&e>-1&&e%1==0&&e<t}var J5=vze,_ze=9007199254740991;function xze(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=_ze}var Q5=xze,bze=Hf,wze=Q5,Sze=Zf,Tze="[object Arguments]",Eze="[object Array]",jze="[object Boolean]",Aze="[object Date]",Cze="[object Error]",Pze="[object Function]",Nze="[object Map]",Ize="[object Number]",kze="[object Object]",Oze="[object RegExp]",Rze="[object Set]",Mze="[object String]",Dze="[object WeakMap]",Lze="[object ArrayBuffer]",Fze="[object DataView]",zze="[object Float32Array]",Bze="[object Float64Array]",$ze="[object Int8Array]",Vze="[object Int16Array]",Uze="[object Int32Array]",qze="[object Uint8Array]",Gze="[object Uint8ClampedArray]",Wze="[object Uint16Array]",Hze="[object Uint32Array]",Ds={};Ds[zze]=Ds[Bze]=Ds[$ze]=Ds[Vze]=Ds[Uze]=Ds[qze]=Ds[Gze]=Ds[Wze]=Ds[Hze]=!0;Ds[Tze]=Ds[Eze]=Ds[Lze]=Ds[jze]=Ds[Fze]=Ds[Aze]=Ds[Cze]=Ds[Pze]=Ds[Nze]=Ds[Ize]=Ds[kze]=Ds[Oze]=Ds[Rze]=Ds[Mze]=Ds[Dze]=!1;function Zze(e){return Sze(e)&&wze(e.length)&&!!Ds[bze(e)]}var Xze=Zze;function Kze(e){return function(t){return e(t)}}var yoe=Kze,hN={exports:{}};hN.exports;(function(e,t){var r=Tae,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,d=a&&a.exports===n,p=d&&r.process,s=function(){try{var _=a&&a.require&&a.require("util").types;return _||p&&p.binding&&p.binding("util")}catch{}}();e.exports=s})(hN,hN.exports);var Yze=hN.exports,Jze=Xze,Qze=yoe,WH=Yze,HH=WH&&WH.isTypedArray,eBe=HH?Qze(HH):Jze,voe=eBe,tBe=ize,rBe=Y5,nBe=fc,iBe=goe,sBe=J5,aBe=voe,oBe=Object.prototype,lBe=oBe.hasOwnProperty;function cBe(e,t){var r=nBe(e),n=!r&&rBe(e),a=!r&&!n&&iBe(e),d=!r&&!n&&!a&&aBe(e),p=r||n||a||d,s=p?tBe(e.length,String):[],_=s.length;for(var b in e)(t||lBe.call(e,b))&&!(p&&(b=="length"||a&&(b=="offset"||b=="parent")||d&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||sBe(b,_)))&&s.push(b);return s}var uBe=cBe,dBe=Object.prototype;function hBe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||dBe;return e===r}var fBe=hBe;function pBe(e,t){return function(r){return e(t(r))}}var _oe=pBe,mBe=_oe,gBe=mBe(Object.keys,Object),yBe=gBe,vBe=fBe,_Be=yBe,xBe=Object.prototype,bBe=xBe.hasOwnProperty;function wBe(e){if(!vBe(e))return _Be(e);var t=[];for(var r in Object(e))bBe.call(e,r)&&r!="constructor"&&t.push(r);return t}var SBe=wBe,TBe=R5,EBe=Q5;function jBe(e){return e!=null&&EBe(e.length)&&!TBe(e)}var cE=jBe,ABe=uBe,CBe=SBe,PBe=cE;function NBe(e){return PBe(e)?ABe(e):CBe(e)}var Ok=NBe,IBe=WFe,kBe=rze,OBe=Ok;function RBe(e){return IBe(e,OBe,kBe)}var MBe=RBe,ZH=MBe,DBe=1,LBe=Object.prototype,FBe=LBe.hasOwnProperty;function zBe(e,t,r,n,a,d){var p=r&DBe,s=ZH(e),_=s.length,b=ZH(t),T=b.length;if(_!=T&&!p)return!1;for(var C=_;C--;){var P=s[C];if(!(p?P in t:FBe.call(t,P)))return!1}var k=d.get(e),B=d.get(t);if(k&&B)return k==t&&B==e;var R=!0;d.set(e,t),d.set(t,e);for(var D=p;++C<_;){P=s[C];var G=e[P],V=t[P];if(n)var $=p?n(V,G,P,t,e,d):n(G,V,P,e,t,d);if(!($===void 0?G===V||a(G,V,r,n,d):$)){R=!1;break}D||(D=P=="constructor")}if(R&&!D){var K=e.constructor,Y=t.constructor;K!=Y&&"constructor"in e&&"constructor"in t&&!(typeof K=="function"&&K instanceof K&&typeof Y=="function"&&Y instanceof Y)&&(R=!1)}return d.delete(e),d.delete(t),R}var BBe=zBe,$Be=Ev,VBe=Mh,UBe=$Be(VBe,"DataView"),qBe=UBe,GBe=Ev,WBe=Mh,HBe=GBe(WBe,"Promise"),ZBe=HBe,XBe=Ev,KBe=Mh,YBe=XBe(KBe,"Set"),xoe=YBe,JBe=Ev,QBe=Mh,e4e=JBe(QBe,"WeakMap"),t4e=e4e,DF=qBe,LF=D5,FF=ZBe,zF=xoe,BF=t4e,boe=Hf,Nb=jae,XH="[object Map]",r4e="[object Object]",KH="[object Promise]",YH="[object Set]",JH="[object WeakMap]",QH="[object DataView]",n4e=Nb(DF),i4e=Nb(LF),s4e=Nb(FF),a4e=Nb(zF),o4e=Nb(BF),my=boe;(DF&&my(new DF(new ArrayBuffer(1)))!=QH||LF&&my(new LF)!=XH||FF&&my(FF.resolve())!=KH||zF&&my(new zF)!=YH||BF&&my(new BF)!=JH)&&(my=function(e){var t=boe(e),r=t==r4e?e.constructor:void 0,n=r?Nb(r):"";if(n)switch(n){case n4e:return QH;case i4e:return XH;case s4e:return KH;case a4e:return YH;case o4e:return JH}return t});var l4e=my,zD=coe,c4e=foe,u4e=$Fe,d4e=BBe,e7=l4e,t7=fc,r7=goe,h4e=voe,f4e=1,n7="[object Arguments]",i7="[object Array]",SC="[object Object]",p4e=Object.prototype,s7=p4e.hasOwnProperty;function m4e(e,t,r,n,a,d){var p=t7(e),s=t7(t),_=p?i7:e7(e),b=s?i7:e7(t);_=_==n7?SC:_,b=b==n7?SC:b;var T=_==SC,C=b==SC,P=_==b;if(P&&r7(e)){if(!r7(t))return!1;p=!0,T=!1}if(P&&!T)return d||(d=new zD),p||h4e(e)?c4e(e,t,r,n,a,d):u4e(e,t,_,r,n,a,d);if(!(r&f4e)){var k=T&&s7.call(e,"__wrapped__"),B=C&&s7.call(t,"__wrapped__");if(k||B){var R=k?e.value():e,D=B?t.value():t;return d||(d=new zD),a(R,D,r,n,d)}}return P?(d||(d=new zD),d4e(e,t,r,n,a,d)):!1}var g4e=m4e,y4e=g4e,a7=Zf;function woe(e,t,r,n,a){return e===t?!0:e==null||t==null||!a7(e)&&!a7(t)?e!==e&&t!==t:y4e(e,t,r,n,woe,a)}var e$=woe,v4e=coe,_4e=e$,x4e=1,b4e=2;function w4e(e,t,r,n){var a=r.length,d=a,p=!n;if(e==null)return!d;for(e=Object(e);a--;){var s=r[a];if(p&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<d;){s=r[a];var _=s[0],b=e[_],T=s[1];if(p&&s[2]){if(b===void 0&&!(_ in e))return!1}else{var C=new v4e;if(n)var P=n(b,T,_,e,t,C);if(!(P===void 0?_4e(T,b,x4e|b4e,n,C):P))return!1}}return!0}var S4e=w4e,T4e=Qm;function E4e(e){return e===e&&!T4e(e)}var Soe=E4e,j4e=Soe,A4e=Ok;function C4e(e){for(var t=A4e(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,j4e(a)]}return t}var P4e=C4e;function N4e(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var Toe=N4e,I4e=S4e,k4e=P4e,O4e=Toe;function R4e(e){var t=k4e(e);return t.length==1&&t[0][2]?O4e(t[0][0],t[0][1]):function(r){return r===e||I4e(r,e,t)}}var M4e=R4e;function D4e(e,t){return e!=null&&t in Object(e)}var L4e=D4e,F4e=Iae,z4e=Y5,B4e=fc,$4e=J5,V4e=Q5,U4e=vk;function q4e(e,t,r){t=F4e(t,e);for(var n=-1,a=t.length,d=!1;++n<a;){var p=U4e(t[n]);if(!(d=e!=null&&r(e,p)))break;e=e[p]}return d||++n!=a?d:(a=e==null?0:e.length,!!a&&V4e(a)&&$4e(p,a)&&(B4e(e)||z4e(e)))}var G4e=q4e,W4e=L4e,H4e=G4e;function Z4e(e,t){return e!=null&&H4e(e,t,W4e)}var X4e=Z4e,K4e=e$,Y4e=kae,J4e=X4e,Q4e=O5,e5e=Soe,t5e=Toe,r5e=vk,n5e=1,i5e=2;function s5e(e,t){return Q4e(e)&&e5e(t)?t5e(r5e(e),t):function(r){var n=Y4e(r,e);return n===void 0&&n===t?J4e(r,e):K4e(t,n,n5e|i5e)}}var a5e=s5e;function o5e(e){return e}var Ib=o5e;function l5e(e){return function(t){return t==null?void 0:t[e]}}var c5e=l5e,u5e=B5;function d5e(e){return function(t){return u5e(t,e)}}var h5e=d5e,f5e=c5e,p5e=h5e,m5e=O5,g5e=vk;function y5e(e){return m5e(e)?f5e(g5e(e)):p5e(e)}var v5e=y5e,_5e=M4e,x5e=a5e,b5e=Ib,w5e=fc,S5e=v5e;function T5e(e){return typeof e=="function"?e:e==null?b5e:typeof e=="object"?w5e(e)?x5e(e[0],e[1]):_5e(e):S5e(e)}var Dh=T5e;function E5e(e,t,r,n){for(var a=e.length,d=r+(n?1:-1);n?d--:++d<a;)if(t(e[d],d,e))return d;return-1}var Eoe=E5e;function j5e(e){return e!==e}var A5e=j5e;function C5e(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}var P5e=C5e,N5e=Eoe,I5e=A5e,k5e=P5e;function O5e(e,t,r){return t===t?k5e(e,t,r):N5e(e,I5e,r)}var R5e=O5e,M5e=R5e;function D5e(e,t){var r=e==null?0:e.length;return!!r&&M5e(e,t,0)>-1}var L5e=D5e;function F5e(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var z5e=F5e;function B5e(){}var $5e=B5e,BD=xoe,V5e=$5e,U5e=K5,q5e=1/0,G5e=BD&&1/U5e(new BD([,-0]))[1]==q5e?function(e){return new BD(e)}:V5e,W5e=G5e,H5e=uoe,Z5e=L5e,X5e=z5e,K5e=hoe,Y5e=W5e,J5e=K5,Q5e=200;function e$e(e,t,r){var n=-1,a=Z5e,d=e.length,p=!0,s=[],_=s;if(r)p=!1,a=X5e;else if(d>=Q5e){var b=t?null:Y5e(e);if(b)return J5e(b);p=!1,a=K5e,_=new H5e}else _=t?[]:s;e:for(;++n<d;){var T=e[n],C=t?t(T):T;if(T=r||T!==0?T:0,p&&C===C){for(var P=_.length;P--;)if(_[P]===C)continue e;t&&_.push(C),s.push(T)}else a(_,C,r)||(_!==s&&_.push(C),s.push(T))}return s}var t$e=e$e,r$e=Dh,n$e=t$e;function i$e(e,t){return e&&e.length?n$e(e,r$e(t)):[]}var s$e=i$e;const o7=es(s$e);function joe(e,t,r){return t===!0?o7(e,r):On(t)?o7(e,t):e}function R0(e){"@babel/helpers - typeof";return R0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R0(e)}var a$e=["ref"];function l7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function lf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l7(Object(r),!0).forEach(function(n){Rk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Coe(n.key),n)}}function l$e(e,t,r){return t&&c7(e.prototype,t),r&&c7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c$e(e,t,r){return t=fN(t),u$e(e,Aoe()?Reflect.construct(t,r||[],fN(e).constructor):t.apply(e,r))}function u$e(e,t){if(t&&(R0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return d$e(e)}function d$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Aoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Aoe=function(){return!!e})()}function fN(e){return fN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fN(e)}function h$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$F(e,t)}function $F(e,t){return $F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},$F(e,t)}function Rk(e,t,r){return t=Coe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Coe(e){var t=f$e(e,"string");return R0(t)=="symbol"?t:t+""}function f$e(e,t){if(R0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(R0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function p$e(e,t){if(e==null)return{};var r=m$e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function m$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function g$e(e){return e.value}function y$e(e,t){if(De.isValidElement(e))return De.cloneElement(e,t);if(typeof e=="function")return De.createElement(e,t);t.ref;var r=p$e(t,a$e);return De.createElement(X5,r)}var u7=1,Qx=function(e){function t(){var r;o$e(this,t);for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];return r=c$e(this,t,[].concat(a)),Rk(r,"lastBoundingBox",{width:-1,height:-1}),r}return h$e(t,e),l$e(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>u7||Math.abs(a.height-this.lastBoundingBox.height)>u7)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?lf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,d=a.layout,p=a.align,s=a.verticalAlign,_=a.margin,b=a.chartWidth,T=a.chartHeight,C,P;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(p==="center"&&d==="vertical"){var k=this.getBBoxSnapshot();C={left:((b||0)-k.width)/2}}else C=p==="right"?{right:_&&_.right||0}:{left:_&&_.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(s==="middle"){var B=this.getBBoxSnapshot();P={top:((T||0)-B.height)/2}}else P=s==="bottom"?{bottom:_&&_.bottom||0}:{top:_&&_.top||0};return lf(lf({},C),P)}},{key:"render",value:function(){var n=this,a=this.props,d=a.content,p=a.width,s=a.height,_=a.wrapperStyle,b=a.payloadUniqBy,T=a.payload,C=lf(lf({position:"absolute",width:p||"auto",height:s||"auto"},this.getDefaultPosition(_)),_);return De.createElement("div",{className:"recharts-legend-wrapper",style:C,ref:function(k){n.wrapperNode=k}},y$e(d,lf(lf({},this.props),{},{payload:joe(T,b,g$e)})))}}],[{key:"getWithHeight",value:function(n,a){var d=lf(lf({},this.defaultProps),n.props),p=d.layout;return p==="vertical"&&br(n.props.height)?{height:n.props.height}:p==="horizontal"?{width:n.props.width||a}:null}}])}(F.PureComponent);Rk(Qx,"displayName","Legend");Rk(Qx,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var d7=lE,v$e=Y5,_$e=fc,h7=d7?d7.isConcatSpreadable:void 0;function x$e(e){return _$e(e)||v$e(e)||!!(h7&&e&&e[h7])}var b$e=x$e,w$e=poe,S$e=b$e;function Poe(e,t,r,n,a){var d=-1,p=e.length;for(r||(r=S$e),a||(a=[]);++d<p;){var s=e[d];t>0&&r(s)?t>1?Poe(s,t-1,r,n,a):w$e(a,s):n||(a[a.length]=s)}return a}var Noe=Poe;function T$e(e){return function(t,r,n){for(var a=-1,d=Object(t),p=n(t),s=p.length;s--;){var _=p[e?s:++a];if(r(d[_],_,d)===!1)break}return t}}var E$e=T$e,j$e=E$e,A$e=j$e(),C$e=A$e,P$e=C$e,N$e=Ok;function I$e(e,t){return e&&P$e(e,t,N$e)}var Ioe=I$e,k$e=cE;function O$e(e,t){return function(r,n){if(r==null)return r;if(!k$e(r))return e(r,n);for(var a=r.length,d=t?a:-1,p=Object(r);(t?d--:++d<a)&&n(p[d],d,p)!==!1;);return r}}var R$e=O$e,M$e=Ioe,D$e=R$e,L$e=D$e(M$e),t$=L$e,F$e=t$,z$e=cE;function B$e(e,t){var r=-1,n=z$e(e)?Array(e.length):[];return F$e(e,function(a,d,p){n[++r]=t(a,d,p)}),n}var koe=B$e;function $$e(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var V$e=$$e,f7=Sb;function U$e(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,d=f7(e),p=t!==void 0,s=t===null,_=t===t,b=f7(t);if(!s&&!b&&!d&&e>t||d&&p&&_&&!s&&!b||n&&p&&_||!r&&_||!a)return 1;if(!n&&!d&&!b&&e<t||b&&r&&a&&!n&&!d||s&&r&&a||!p&&a||!_)return-1}return 0}var q$e=U$e,G$e=q$e;function W$e(e,t,r){for(var n=-1,a=e.criteria,d=t.criteria,p=a.length,s=r.length;++n<p;){var _=G$e(a[n],d[n]);if(_){if(n>=s)return _;var b=r[n];return _*(b=="desc"?-1:1)}}return e.index-t.index}var H$e=W$e,$D=z5,Z$e=B5,X$e=Dh,K$e=koe,Y$e=V$e,J$e=yoe,Q$e=H$e,eVe=Ib,tVe=fc;function rVe(e,t,r){t.length?t=$D(t,function(d){return tVe(d)?function(p){return Z$e(p,d.length===1?d[0]:d)}:d}):t=[eVe];var n=-1;t=$D(t,J$e(X$e));var a=K$e(e,function(d,p,s){var _=$D(t,function(b){return b(d)});return{criteria:_,index:++n,value:d}});return Y$e(a,function(d,p){return Q$e(d,p,r)})}var nVe=rVe;function iVe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var sVe=iVe,aVe=sVe,p7=Math.max;function oVe(e,t,r){return t=p7(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,d=p7(n.length-t,0),p=Array(d);++a<d;)p[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(p),aVe(e,this,s)}}var lVe=oVe;function cVe(e){return function(){return e}}var uVe=cVe,dVe=Ev,hVe=function(){try{var e=dVe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ooe=hVe,fVe=uVe,m7=Ooe,pVe=Ib,mVe=m7?function(e,t){return m7(e,"toString",{configurable:!0,enumerable:!1,value:fVe(t),writable:!0})}:pVe,gVe=mVe,yVe=800,vVe=16,_Ve=Date.now;function xVe(e){var t=0,r=0;return function(){var n=_Ve(),a=vVe-(n-r);if(r=n,a>0){if(++t>=yVe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var bVe=xVe,wVe=gVe,SVe=bVe,TVe=SVe(wVe),EVe=TVe,jVe=Ib,AVe=lVe,CVe=EVe;function PVe(e,t){return CVe(AVe(e,t,jVe),e+"")}var NVe=PVe,IVe=M5,kVe=cE,OVe=J5,RVe=Qm;function MVe(e,t,r){if(!RVe(r))return!1;var n=typeof t;return(n=="number"?kVe(r)&&OVe(t,r.length):n=="string"&&t in r)?IVe(r[t],e):!1}var Mk=MVe,DVe=Noe,LVe=nVe,FVe=NVe,g7=Mk,zVe=FVe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&g7(e,t[0],t[1])?t=[]:r>2&&g7(t[0],t[1],t[2])&&(t=[t[0]]),LVe(e,DVe(t,1),[])}),BVe=zVe;const r$=es(BVe);function WT(e){"@babel/helpers - typeof";return WT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WT(e)}function VF(){return VF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VF.apply(this,arguments)}function $Ve(e,t){return GVe(e)||qVe(e,t)||UVe(e,t)||VVe()}function VVe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UVe(e,t){if(e){if(typeof e=="string")return y7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y7(e,t)}}function y7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qVe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function GVe(e){if(Array.isArray(e))return e}function v7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v7(Object(r),!0).forEach(function(n){WVe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WVe(e,t,r){return t=HVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HVe(e){var t=ZVe(e,"string");return WT(t)=="symbol"?t:t+""}function ZVe(e,t){if(WT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(WT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function XVe(e){return Array.isArray(e)&&ro(e[0])&&ro(e[1])?e.join(" ~ "):e}var KVe=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,d=a===void 0?{}:a,p=t.itemStyle,s=p===void 0?{}:p,_=t.labelStyle,b=_===void 0?{}:_,T=t.payload,C=t.formatter,P=t.itemSorter,k=t.wrapperClassName,B=t.labelClassName,R=t.label,D=t.labelFormatter,G=t.accessibilityLayer,V=G===void 0?!1:G,$=function(){if(T&&T.length){var ue={padding:0,margin:0},Ce=(P?r$(T,P):T).map(function(ve,ze){if(ve.type==="none")return null;var Me=VD({display:"block",paddingTop:4,paddingBottom:4,color:ve.color||"#000"},s),Be=ve.formatter||C||XVe,Ve=ve.value,We=ve.name,Ee=Ve,ot=We;if(Be&&Ee!=null&&ot!=null){var yt=Be(Ve,We,ve,ze,T);if(Array.isArray(yt)){var Je=$Ve(yt,2);Ee=Je[0],ot=Je[1]}else Ee=yt}return De.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ze),style:Me},ro(ot)?De.createElement("span",{className:"recharts-tooltip-item-name"},ot):null,ro(ot)?De.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,De.createElement("span",{className:"recharts-tooltip-item-value"},Ee),De.createElement("span",{className:"recharts-tooltip-item-unit"},ve.unit||""))});return De.createElement("ul",{className:"recharts-tooltip-item-list",style:ue},Ce)}return null},K=VD({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},d),Y=VD({margin:0},b),ee=!qn(R),ae=ee?R:"",ie=Zn("recharts-default-tooltip",k),ge=Zn("recharts-tooltip-label",B);ee&&D&&T!==void 0&&T!==null&&(ae=D(R,T));var fe=V?{role:"status","aria-live":"assertive"}:{};return De.createElement("div",VF({className:ie,style:K},fe),De.createElement("p",{className:ge,style:Y},De.isValidElement(ae)?ae:"".concat(ae)),$())};function HT(e){"@babel/helpers - typeof";return HT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HT(e)}function TC(e,t,r){return t=YVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YVe(e){var t=JVe(e,"string");return HT(t)=="symbol"?t:t+""}function JVe(e,t){if(HT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(HT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sS="recharts-tooltip-wrapper",QVe={visibility:"hidden"};function e6e(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Zn(sS,TC(TC(TC(TC({},"".concat(sS,"-right"),br(r)&&t&&br(t.x)&&r>=t.x),"".concat(sS,"-left"),br(r)&&t&&br(t.x)&&r<t.x),"".concat(sS,"-bottom"),br(n)&&t&&br(t.y)&&n>=t.y),"".concat(sS,"-top"),br(n)&&t&&br(t.y)&&n<t.y))}function _7(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,d=e.position,p=e.reverseDirection,s=e.tooltipDimension,_=e.viewBox,b=e.viewBoxDimension;if(d&&br(d[n]))return d[n];var T=r[n]-s-a,C=r[n]+a;if(t[n])return p[n]?T:C;if(p[n]){var P=T,k=_[n];return P<k?Math.max(C,_[n]):Math.max(T,_[n])}var B=C+s,R=_[n]+b;return B>R?Math.max(T,_[n]):Math.max(C,_[n])}function t6e(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function r6e(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,d=e.reverseDirection,p=e.tooltipBox,s=e.useTranslate3d,_=e.viewBox,b,T,C;return p.height>0&&p.width>0&&r?(T=_7({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:d,tooltipDimension:p.width,viewBox:_,viewBoxDimension:_.width}),C=_7({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:d,tooltipDimension:p.height,viewBox:_,viewBoxDimension:_.height}),b=t6e({translateX:T,translateY:C,useTranslate3d:s})):b=QVe,{cssProperties:b,cssClasses:e6e({translateX:T,translateY:C,coordinate:r})}}function M0(e){"@babel/helpers - typeof";return M0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M0(e)}function x7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function b7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x7(Object(r),!0).forEach(function(n){qF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Moe(n.key),n)}}function s6e(e,t,r){return t&&i6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function a6e(e,t,r){return t=pN(t),o6e(e,Roe()?Reflect.construct(t,r||[],pN(e).constructor):t.apply(e,r))}function o6e(e,t){if(t&&(M0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l6e(e)}function l6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Roe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Roe=function(){return!!e})()}function pN(e){return pN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pN(e)}function c6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UF(e,t)}function UF(e,t){return UF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},UF(e,t)}function qF(e,t,r){return t=Moe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Moe(e){var t=u6e(e,"string");return M0(t)=="symbol"?t:t+""}function u6e(e,t){if(M0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(M0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var w7=1,d6e=function(e){function t(){var r;n6e(this,t);for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];return r=a6e(this,t,[].concat(a)),qF(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),qF(r,"handleKeyDown",function(p){if(p.key==="Escape"){var s,_,b,T;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(_=r.props.coordinate)===null||_===void 0?void 0:_.x)!==null&&s!==void 0?s:0,y:(b=(T=r.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&b!==void 0?b:0}})}}),r}return c6e(t,e),s6e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>w7||Math.abs(n.height-this.state.lastBoundingBox.height)>w7)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,d=a.active,p=a.allowEscapeViewBox,s=a.animationDuration,_=a.animationEasing,b=a.children,T=a.coordinate,C=a.hasPayload,P=a.isAnimationActive,k=a.offset,B=a.position,R=a.reverseDirection,D=a.useTranslate3d,G=a.viewBox,V=a.wrapperStyle,$=r6e({allowEscapeViewBox:p,coordinate:T,offsetTopLeft:k,position:B,reverseDirection:R,tooltipBox:this.state.lastBoundingBox,useTranslate3d:D,viewBox:G}),K=$.cssClasses,Y=$.cssProperties,ee=b7(b7({transition:P&&d?"transform ".concat(s,"ms ").concat(_):void 0},Y),{},{pointerEvents:"none",visibility:!this.state.dismissed&&d&&C?"visible":"hidden",position:"absolute",top:0,left:0},V);return De.createElement("div",{tabIndex:-1,className:K,style:ee,ref:function(ie){n.wrapperNode=ie}},b)}}])}(F.PureComponent),h6e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},eg={isSsr:h6e()};function D0(e){"@babel/helpers - typeof";return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D0(e)}function S7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function T7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S7(Object(r),!0).forEach(function(n){n$(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function f6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Loe(n.key),n)}}function m6e(e,t,r){return t&&p6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function g6e(e,t,r){return t=mN(t),y6e(e,Doe()?Reflect.construct(t,r||[],mN(e).constructor):t.apply(e,r))}function y6e(e,t){if(t&&(D0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v6e(e)}function v6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Doe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Doe=function(){return!!e})()}function mN(e){return mN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},mN(e)}function _6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GF(e,t)}function GF(e,t){return GF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},GF(e,t)}function n$(e,t,r){return t=Loe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Loe(e){var t=x6e(e,"string");return D0(t)=="symbol"?t:t+""}function x6e(e,t){if(D0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(D0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function b6e(e){return e.dataKey}function w6e(e,t){return De.isValidElement(e)?De.cloneElement(e,t):typeof e=="function"?De.createElement(e,t):De.createElement(KVe,t)}var nc=function(e){function t(){return f6e(this,t),g6e(this,t,arguments)}return _6e(t,e),m6e(t,[{key:"render",value:function(){var n=this,a=this.props,d=a.active,p=a.allowEscapeViewBox,s=a.animationDuration,_=a.animationEasing,b=a.content,T=a.coordinate,C=a.filterNull,P=a.isAnimationActive,k=a.offset,B=a.payload,R=a.payloadUniqBy,D=a.position,G=a.reverseDirection,V=a.useTranslate3d,$=a.viewBox,K=a.wrapperStyle,Y=B??[];C&&Y.length&&(Y=joe(B.filter(function(ae){return ae.value!=null&&(ae.hide!==!0||n.props.includeHidden)}),R,b6e));var ee=Y.length>0;return De.createElement(d6e,{allowEscapeViewBox:p,animationDuration:s,animationEasing:_,isAnimationActive:P,active:d,coordinate:T,hasPayload:ee,offset:k,position:D,reverseDirection:G,useTranslate3d:V,viewBox:$,wrapperStyle:K},w6e(b,T7(T7({},this.props),{},{payload:Y})))}}])}(F.PureComponent);n$(nc,"displayName","Tooltip");n$(nc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!eg.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var S6e=Mh,T6e=function(){return S6e.Date.now()},E6e=T6e,j6e=/\s/;function A6e(e){for(var t=e.length;t--&&j6e.test(e.charAt(t)););return t}var C6e=A6e,P6e=C6e,N6e=/^\s+/;function I6e(e){return e&&e.slice(0,P6e(e)+1).replace(N6e,"")}var k6e=I6e,O6e=k6e,E7=Qm,R6e=Sb,j7=NaN,M6e=/^[-+]0x[0-9a-f]+$/i,D6e=/^0b[01]+$/i,L6e=/^0o[0-7]+$/i,F6e=parseInt;function z6e(e){if(typeof e=="number")return e;if(R6e(e))return j7;if(E7(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=E7(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=O6e(e);var r=D6e.test(e);return r||L6e.test(e)?F6e(e.slice(2),r?2:8):M6e.test(e)?j7:+e}var Foe=z6e,B6e=Qm,UD=E6e,A7=Foe,$6e="Expected a function",V6e=Math.max,U6e=Math.min;function q6e(e,t,r){var n,a,d,p,s,_,b=0,T=!1,C=!1,P=!0;if(typeof e!="function")throw new TypeError($6e);t=A7(t)||0,B6e(r)&&(T=!!r.leading,C="maxWait"in r,d=C?V6e(A7(r.maxWait)||0,t):d,P="trailing"in r?!!r.trailing:P);function k(ee){var ae=n,ie=a;return n=a=void 0,b=ee,p=e.apply(ie,ae),p}function B(ee){return b=ee,s=setTimeout(G,t),T?k(ee):p}function R(ee){var ae=ee-_,ie=ee-b,ge=t-ae;return C?U6e(ge,d-ie):ge}function D(ee){var ae=ee-_,ie=ee-b;return _===void 0||ae>=t||ae<0||C&&ie>=d}function G(){var ee=UD();if(D(ee))return V(ee);s=setTimeout(G,R(ee))}function V(ee){return s=void 0,P&&n?k(ee):(n=a=void 0,p)}function $(){s!==void 0&&clearTimeout(s),b=0,n=_=a=s=void 0}function K(){return s===void 0?p:V(UD())}function Y(){var ee=UD(),ae=D(ee);if(n=arguments,a=this,_=ee,ae){if(s===void 0)return B(_);if(C)return clearTimeout(s),s=setTimeout(G,t),k(_)}return s===void 0&&(s=setTimeout(G,t)),p}return Y.cancel=$,Y.flush=K,Y}var G6e=q6e,W6e=G6e,H6e=Qm,Z6e="Expected a function";function X6e(e,t,r){var n=!0,a=!0;if(typeof e!="function")throw new TypeError(Z6e);return H6e(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),W6e(e,t,{leading:n,maxWait:t,trailing:a})}var K6e=X6e;const zoe=es(K6e);function ZT(e){"@babel/helpers - typeof";return ZT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZT(e)}function C7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function EC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C7(Object(r),!0).forEach(function(n){Y6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y6e(e,t,r){return t=J6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J6e(e){var t=Q6e(e,"string");return ZT(t)=="symbol"?t:t+""}function Q6e(e,t){if(ZT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ZT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eUe(e,t){return iUe(e)||nUe(e,t)||rUe(e,t)||tUe()}function tUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rUe(e,t){if(e){if(typeof e=="string")return P7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P7(e,t)}}function P7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function iUe(e){if(Array.isArray(e))return e}var AS=F.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,d=e.width,p=d===void 0?"100%":d,s=e.height,_=s===void 0?"100%":s,b=e.minWidth,T=b===void 0?0:b,C=e.minHeight,P=e.maxHeight,k=e.children,B=e.debounce,R=B===void 0?0:B,D=e.id,G=e.className,V=e.onResize,$=e.style,K=$===void 0?{}:$,Y=F.useRef(null),ee=F.useRef();ee.current=V,F.useImperativeHandle(t,function(){return Object.defineProperty(Y.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),Y.current},configurable:!0})});var ae=F.useState({containerWidth:a.width,containerHeight:a.height}),ie=eUe(ae,2),ge=ie[0],fe=ie[1],be=F.useCallback(function(Ce,ve){fe(function(ze){var Me=Math.round(Ce),Be=Math.round(ve);return ze.containerWidth===Me&&ze.containerHeight===Be?ze:{containerWidth:Me,containerHeight:Be}})},[]);F.useEffect(function(){var Ce=function(We){var Ee,ot=We[0].contentRect,yt=ot.width,Je=ot.height;be(yt,Je),(Ee=ee.current)===null||Ee===void 0||Ee.call(ee,yt,Je)};R>0&&(Ce=zoe(Ce,R,{trailing:!0,leading:!1}));var ve=new ResizeObserver(Ce),ze=Y.current.getBoundingClientRect(),Me=ze.width,Be=ze.height;return be(Me,Be),ve.observe(Y.current),function(){ve.disconnect()}},[be,R]);var ue=F.useMemo(function(){var Ce=ge.containerWidth,ve=ge.containerHeight;if(Ce<0||ve<0)return null;yd(Py(p)||Py(_),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,p,_),yd(!r||r>0,"The aspect(%s) must be greater than zero.",r);var ze=Py(p)?Ce:p,Me=Py(_)?ve:_;r&&r>0&&(ze?Me=ze/r:Me&&(ze=Me*r),P&&Me>P&&(Me=P)),yd(ze>0||Me>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ze,Me,p,_,T,C,r);var Be=!Array.isArray(k)&&jf(k.type).endsWith("Chart");return De.Children.map(k,function(Ve){return De.isValidElement(Ve)?F.cloneElement(Ve,EC({width:ze,height:Me},Be?{style:EC({height:"100%",width:"100%",maxHeight:Me,maxWidth:ze},Ve.props.style)}:{})):Ve})},[r,k,_,P,C,T,ge,p]);return De.createElement("div",{id:D?"".concat(D):void 0,className:Zn("recharts-responsive-container",G),style:EC(EC({},K),{},{width:p,height:_,minWidth:T,minHeight:C,maxHeight:P}),ref:Y},ue)}),XT=function(t){return null};XT.displayName="Cell";function KT(e){"@babel/helpers - typeof";return KT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KT(e)}function N7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function WF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N7(Object(r),!0).forEach(function(n){sUe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sUe(e,t,r){return t=aUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aUe(e){var t=oUe(e,"string");return KT(t)=="symbol"?t:t+""}function oUe(e,t){if(KT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(KT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var lx={widthCache:{},cacheCount:0},lUe=2e3,cUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},I7="recharts_measurement_span";function uUe(e){var t=WF({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var YS=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||eg.isSsr)return{width:0,height:0};var n=uUe(r),a=JSON.stringify({text:t,copyStyle:n});if(lx.widthCache[a])return lx.widthCache[a];try{var d=document.getElementById(I7);d||(d=document.createElement("span"),d.setAttribute("id",I7),d.setAttribute("aria-hidden","true"),document.body.appendChild(d));var p=WF(WF({},cUe),n);Object.assign(d.style,p),d.textContent="".concat(t);var s=d.getBoundingClientRect(),_={width:s.width,height:s.height};return lx.widthCache[a]=_,++lx.cacheCount>lUe&&(lx.cacheCount=0,lx.widthCache={}),_}catch{return{width:0,height:0}}},dUe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function YT(e){"@babel/helpers - typeof";return YT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YT(e)}function gN(e,t){return mUe(e)||pUe(e,t)||fUe(e,t)||hUe()}function hUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fUe(e,t){if(e){if(typeof e=="string")return k7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k7(e,t)}}function k7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function mUe(e){if(Array.isArray(e))return e}function gUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vUe(n.key),n)}}function yUe(e,t,r){return t&&O7(e.prototype,t),r&&O7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vUe(e){var t=_Ue(e,"string");return YT(t)=="symbol"?t:t+""}function _Ue(e,t){if(YT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(YT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var R7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,M7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,xUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,bUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Boe={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},wUe=Object.keys(Boe),Mx="NaN";function SUe(e,t){return e*Boe[t]}var jC=function(){function e(t,r){gUe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!xUe.test(r)&&(this.num=NaN,this.unit=""),wUe.includes(r)&&(this.num=SUe(t,r),this.unit="px")}return yUe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=bUe.exec(r))!==null&&n!==void 0?n:[],d=gN(a,3),p=d[1],s=d[2];return new e(parseFloat(p),s??"")}}])}();function $oe(e){if(e.includes(Mx))return Mx;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=R7.exec(t))!==null&&r!==void 0?r:[],a=gN(n,4),d=a[1],p=a[2],s=a[3],_=jC.parse(d??""),b=jC.parse(s??""),T=p==="*"?_.multiply(b):_.divide(b);if(T.isNaN())return Mx;t=t.replace(R7,T.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var C,P=(C=M7.exec(t))!==null&&C!==void 0?C:[],k=gN(P,4),B=k[1],R=k[2],D=k[3],G=jC.parse(B??""),V=jC.parse(D??""),$=R==="+"?G.add(V):G.subtract(V);if($.isNaN())return Mx;t=t.replace(M7,$.toString())}return t}var D7=/\(([^()]*)\)/;function TUe(e){for(var t=e;t.includes("(");){var r=D7.exec(t),n=gN(r,2),a=n[1];t=t.replace(D7,$oe(a))}return t}function EUe(e){var t=e.replace(/\s+/g,"");return t=TUe(t),t=$oe(t),t}function jUe(e){try{return EUe(e)}catch{return Mx}}function qD(e){var t=jUe(e.slice(5,-1));return t===Mx?"":t}var AUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],CUe=["dx","dy","angle","className","breakAll"];function HF(){return HF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HF.apply(this,arguments)}function L7(e,t){if(e==null)return{};var r=PUe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function F7(e,t){return OUe(e)||kUe(e,t)||IUe(e,t)||NUe()}function NUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IUe(e,t){if(e){if(typeof e=="string")return z7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z7(e,t)}}function z7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function OUe(e){if(Array.isArray(e))return e}var Voe=/[ \f\n\r\t\v\u2028\u2029]+/,Uoe=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var d=[];qn(r)||(n?d=r.toString().split(""):d=r.toString().split(Voe));var p=d.map(function(_){return{word:_,width:YS(_,a).width}}),s=n?0:YS("",a).width;return{wordsWithComputedWidth:p,spaceWidth:s}}catch{return null}},RUe=function(t,r,n,a,d){var p=t.maxLines,s=t.children,_=t.style,b=t.breakAll,T=br(p),C=s,P=function(){var ze=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ze.reduce(function(Me,Be){var Ve=Be.word,We=Be.width,Ee=Me[Me.length-1];if(Ee&&(a==null||d||Ee.width+We+n<Number(a)))Ee.words.push(Ve),Ee.width+=We+n;else{var ot={words:[Ve],width:We};Me.push(ot)}return Me},[])},k=P(r),B=function(ze){return ze.reduce(function(Me,Be){return Me.width>Be.width?Me:Be})};if(!T)return k;for(var R="",D=function(ze){var Me=C.slice(0,ze),Be=Uoe({breakAll:b,style:_,children:Me+R}).wordsWithComputedWidth,Ve=P(Be),We=Ve.length>p||B(Ve).width>Number(a);return[We,Ve]},G=0,V=C.length-1,$=0,K;G<=V&&$<=C.length-1;){var Y=Math.floor((G+V)/2),ee=Y-1,ae=D(ee),ie=F7(ae,2),ge=ie[0],fe=ie[1],be=D(Y),ue=F7(be,1),Ce=ue[0];if(!ge&&!Ce&&(G=Y+1),ge&&Ce&&(V=Y-1),!ge&&Ce){K=fe;break}$++}return K||k},B7=function(t){var r=qn(t)?[]:t.toString().split(Voe);return[{words:r}]},MUe=function(t){var r=t.width,n=t.scaleToFit,a=t.children,d=t.style,p=t.breakAll,s=t.maxLines;if((r||n)&&!eg.isSsr){var _,b,T=Uoe({breakAll:p,children:a,style:d});if(T){var C=T.wordsWithComputedWidth,P=T.spaceWidth;_=C,b=P}else return B7(a);return RUe({breakAll:p,children:a,maxLines:s,style:d},_,b,r,n)}return B7(a)},$7="#808080",uv=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,d=a===void 0?0:a,p=t.lineHeight,s=p===void 0?"1em":p,_=t.capHeight,b=_===void 0?"0.71em":_,T=t.scaleToFit,C=T===void 0?!1:T,P=t.textAnchor,k=P===void 0?"start":P,B=t.verticalAnchor,R=B===void 0?"end":B,D=t.fill,G=D===void 0?$7:D,V=L7(t,AUe),$=F.useMemo(function(){return MUe({breakAll:V.breakAll,children:V.children,maxLines:V.maxLines,scaleToFit:C,style:V.style,width:V.width})},[V.breakAll,V.children,V.maxLines,C,V.style,V.width]),K=V.dx,Y=V.dy,ee=V.angle,ae=V.className,ie=V.breakAll,ge=L7(V,CUe);if(!ro(n)||!ro(d))return null;var fe=n+(br(K)?K:0),be=d+(br(Y)?Y:0),ue;switch(R){case"start":ue=qD("calc(".concat(b,")"));break;case"middle":ue=qD("calc(".concat(($.length-1)/2," * -").concat(s," + (").concat(b," / 2))"));break;default:ue=qD("calc(".concat($.length-1," * -").concat(s,")"));break}var Ce=[];if(C){var ve=$[0].width,ze=V.width;Ce.push("scale(".concat((br(ze)?ze/ve:1)/ve,")"))}return ee&&Ce.push("rotate(".concat(ee,", ").concat(fe,", ").concat(be,")")),Ce.length&&(ge.transform=Ce.join(" ")),De.createElement("text",HF({},pn(ge,!0),{x:fe,y:be,className:Zn("recharts-text",ae),textAnchor:k,fill:G.includes("url")?$7:G}),$.map(function(Me,Be){var Ve=Me.words.join(ie?"":" ");return De.createElement("tspan",{x:fe,dy:Be===0?ue:s,key:"".concat(Ve,"-").concat(Be)},Ve)}))};function jm(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function DUe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function i$(e){let t,r,n;e.length!==2?(t=jm,r=(s,_)=>jm(e(s),_),n=(s,_)=>e(s)-_):(t=e===jm||e===DUe?e:LUe,r=e,n=e);function a(s,_,b=0,T=s.length){if(b<T){if(t(_,_)!==0)return T;do{const C=b+T>>>1;r(s[C],_)<0?b=C+1:T=C}while(b<T)}return b}function d(s,_,b=0,T=s.length){if(b<T){if(t(_,_)!==0)return T;do{const C=b+T>>>1;r(s[C],_)<=0?b=C+1:T=C}while(b<T)}return b}function p(s,_,b=0,T=s.length){const C=a(s,_,b,T-1);return C>b&&n(s[C-1],_)>-n(s[C],_)?C-1:C}return{left:a,center:p,right:d}}function LUe(){return 0}function qoe(e){return e===null?NaN:+e}function*FUe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const zUe=i$(jm),uE=zUe.right;i$(qoe).center;class V7 extends Map{constructor(t,r=VUe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(U7(this,t))}has(t){return super.has(U7(this,t))}set(t,r){return super.set(BUe(this,t),r)}delete(t){return super.delete($Ue(this,t))}}function U7({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function BUe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function $Ue({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function VUe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function UUe(e=jm){if(e===jm)return Goe;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Goe(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const qUe=Math.sqrt(50),GUe=Math.sqrt(10),WUe=Math.sqrt(2);function yN(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),d=n/Math.pow(10,a),p=d>=qUe?10:d>=GUe?5:d>=WUe?2:1;let s,_,b;return a<0?(b=Math.pow(10,-a)/p,s=Math.round(e*b),_=Math.round(t*b),s/b<e&&++s,_/b>t&&--_,b=-b):(b=Math.pow(10,a)*p,s=Math.round(e/b),_=Math.round(t/b),s*b<e&&++s,_*b>t&&--_),_<s&&.5<=r&&r<2?yN(e,t,r*2):[s,_,b]}function ZF(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,d,p]=n?yN(t,e,r):yN(e,t,r);if(!(d>=a))return[];const s=d-a+1,_=new Array(s);if(n)if(p<0)for(let b=0;b<s;++b)_[b]=(d-b)/-p;else for(let b=0;b<s;++b)_[b]=(d-b)*p;else if(p<0)for(let b=0;b<s;++b)_[b]=(a+b)/-p;else for(let b=0;b<s;++b)_[b]=(a+b)*p;return _}function XF(e,t,r){return t=+t,e=+e,r=+r,yN(e,t,r)[2]}function KF(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?XF(t,e,r):XF(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function q7(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function G7(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function Woe(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?Goe:UUe(a);n>r;){if(n-r>600){const _=n-r+1,b=t-r+1,T=Math.log(_),C=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*C*(_-C)/_)*(b-_/2<0?-1:1),k=Math.max(r,Math.floor(t-b*C/_+P)),B=Math.min(n,Math.floor(t+(_-b)*C/_+P));Woe(e,t,k,B,a)}const d=e[t];let p=r,s=n;for(aS(e,r,t),a(e[n],d)>0&&aS(e,r,n);p<s;){for(aS(e,p,s),++p,--s;a(e[p],d)<0;)++p;for(;a(e[s],d)>0;)--s}a(e[r],d)===0?aS(e,r,s):(++s,aS(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function aS(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function HUe(e,t,r){if(e=Float64Array.from(FUe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return G7(e);if(t>=1)return q7(e);var n,a=(n-1)*t,d=Math.floor(a),p=q7(Woe(e,d).subarray(0,d+1)),s=G7(e.subarray(d+1));return p+(s-p)*(a-d)}}function ZUe(e,t,r=qoe){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,d=Math.floor(a),p=+r(e[d],d,e),s=+r(e[d+1],d+1,e);return p+(s-p)*(a-d)}}function XUe(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,d=new Array(a);++n<a;)d[n]=e+n*r;return d}function Nu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Xf(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const YF=Symbol("implicit");function s$(){var e=new V7,t=[],r=[],n=YF;function a(d){let p=e.get(d);if(p===void 0){if(n!==YF)return n;e.set(d,p=t.push(d)-1)}return r[p%r.length]}return a.domain=function(d){if(!arguments.length)return t.slice();t=[],e=new V7;for(const p of d)e.has(p)||e.set(p,t.push(p)-1);return a},a.range=function(d){return arguments.length?(r=Array.from(d),a):r.slice()},a.unknown=function(d){return arguments.length?(n=d,a):n},a.copy=function(){return s$(t,r).unknown(n)},Nu.apply(a,arguments),a}function JT(){var e=s$().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,d,p,s=!1,_=0,b=0,T=.5;delete e.unknown;function C(){var P=t().length,k=a<n,B=k?a:n,R=k?n:a;d=(R-B)/Math.max(1,P-_+b*2),s&&(d=Math.floor(d)),B+=(R-B-d*(P-_))*T,p=d*(1-_),s&&(B=Math.round(B),p=Math.round(p));var D=XUe(P).map(function(G){return B+d*G});return r(k?D.reverse():D)}return e.domain=function(P){return arguments.length?(t(P),C()):t()},e.range=function(P){return arguments.length?([n,a]=P,n=+n,a=+a,C()):[n,a]},e.rangeRound=function(P){return[n,a]=P,n=+n,a=+a,s=!0,C()},e.bandwidth=function(){return p},e.step=function(){return d},e.round=function(P){return arguments.length?(s=!!P,C()):s},e.padding=function(P){return arguments.length?(_=Math.min(1,b=+P),C()):_},e.paddingInner=function(P){return arguments.length?(_=Math.min(1,P),C()):_},e.paddingOuter=function(P){return arguments.length?(b=+P,C()):b},e.align=function(P){return arguments.length?(T=Math.max(0,Math.min(1,P)),C()):T},e.copy=function(){return JT(t(),[n,a]).round(s).paddingInner(_).paddingOuter(b).align(T)},Nu.apply(C(),arguments)}function Hoe(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Hoe(t())},e}function JS(){return Hoe(JT.apply(null,arguments).paddingInner(1))}function a$(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Zoe(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function dE(){}var QT=.7,vN=1/QT,e0="\\s*([+-]?\\d+)\\s*",e2="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",KUe=/^#([0-9a-f]{3,8})$/,YUe=new RegExp(`^rgb\\(${e0},${e0},${e0}\\)$`),JUe=new RegExp(`^rgb\\(${Sh},${Sh},${Sh}\\)$`),QUe=new RegExp(`^rgba\\(${e0},${e0},${e0},${e2}\\)$`),e8e=new RegExp(`^rgba\\(${Sh},${Sh},${Sh},${e2}\\)$`),t8e=new RegExp(`^hsl\\(${e2},${Sh},${Sh}\\)$`),r8e=new RegExp(`^hsla\\(${e2},${Sh},${Sh},${e2}\\)$`),W7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};a$(dE,t2,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:H7,formatHex:H7,formatHex8:n8e,formatHsl:i8e,formatRgb:Z7,toString:Z7});function H7(){return this.rgb().formatHex()}function n8e(){return this.rgb().formatHex8()}function i8e(){return Xoe(this).formatHsl()}function Z7(){return this.rgb().formatRgb()}function t2(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=KUe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?X7(t):r===3?new ac(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?AC(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?AC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=YUe.exec(e))?new ac(t[1],t[2],t[3],1):(t=JUe.exec(e))?new ac(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=QUe.exec(e))?AC(t[1],t[2],t[3],t[4]):(t=e8e.exec(e))?AC(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=t8e.exec(e))?J7(t[1],t[2]/100,t[3]/100,1):(t=r8e.exec(e))?J7(t[1],t[2]/100,t[3]/100,t[4]):W7.hasOwnProperty(e)?X7(W7[e]):e==="transparent"?new ac(NaN,NaN,NaN,0):null}function X7(e){return new ac(e>>16&255,e>>8&255,e&255,1)}function AC(e,t,r,n){return n<=0&&(e=t=r=NaN),new ac(e,t,r,n)}function s8e(e){return e instanceof dE||(e=t2(e)),e?(e=e.rgb(),new ac(e.r,e.g,e.b,e.opacity)):new ac}function JF(e,t,r,n){return arguments.length===1?s8e(e):new ac(e,t,r,n??1)}function ac(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}a$(ac,JF,Zoe(dE,{brighter(e){return e=e==null?vN:Math.pow(vN,e),new ac(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?QT:Math.pow(QT,e),new ac(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ac(Hy(this.r),Hy(this.g),Hy(this.b),_N(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:K7,formatHex:K7,formatHex8:a8e,formatRgb:Y7,toString:Y7}));function K7(){return`#${Ny(this.r)}${Ny(this.g)}${Ny(this.b)}`}function a8e(){return`#${Ny(this.r)}${Ny(this.g)}${Ny(this.b)}${Ny((isNaN(this.opacity)?1:this.opacity)*255)}`}function Y7(){const e=_N(this.opacity);return`${e===1?"rgb(":"rgba("}${Hy(this.r)}, ${Hy(this.g)}, ${Hy(this.b)}${e===1?")":`, ${e})`}`}function _N(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Hy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ny(e){return e=Hy(e),(e<16?"0":"")+e.toString(16)}function J7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ud(e,t,r,n)}function Xoe(e){if(e instanceof ud)return new ud(e.h,e.s,e.l,e.opacity);if(e instanceof dE||(e=t2(e)),!e)return new ud;if(e instanceof ud)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),d=Math.max(t,r,n),p=NaN,s=d-a,_=(d+a)/2;return s?(t===d?p=(r-n)/s+(r<n)*6:r===d?p=(n-t)/s+2:p=(t-r)/s+4,s/=_<.5?d+a:2-d-a,p*=60):s=_>0&&_<1?0:p,new ud(p,s,_,e.opacity)}function o8e(e,t,r,n){return arguments.length===1?Xoe(e):new ud(e,t,r,n??1)}function ud(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}a$(ud,o8e,Zoe(dE,{brighter(e){return e=e==null?vN:Math.pow(vN,e),new ud(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?QT:Math.pow(QT,e),new ud(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new ac(GD(e>=240?e-240:e+120,a,n),GD(e,a,n),GD(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new ud(Q7(this.h),CC(this.s),CC(this.l),_N(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=_N(this.opacity);return`${e===1?"hsl(":"hsla("}${Q7(this.h)}, ${CC(this.s)*100}%, ${CC(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Q7(e){return e=(e||0)%360,e<0?e+360:e}function CC(e){return Math.max(0,Math.min(1,e||0))}function GD(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const o$=e=>()=>e;function l8e(e,t){return function(r){return e+r*t}}function c8e(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function u8e(e){return(e=+e)==1?Koe:function(t,r){return r-t?c8e(t,r,e):o$(isNaN(t)?r:t)}}function Koe(e,t){var r=t-e;return r?l8e(e,r):o$(isNaN(e)?t:e)}const eZ=function e(t){var r=u8e(t);function n(a,d){var p=r((a=JF(a)).r,(d=JF(d)).r),s=r(a.g,d.g),_=r(a.b,d.b),b=Koe(a.opacity,d.opacity);return function(T){return a.r=p(T),a.g=s(T),a.b=_(T),a.opacity=b(T),a+""}}return n.gamma=e,n}(1);function d8e(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(d){for(a=0;a<r;++a)n[a]=e[a]*(1-d)+t[a]*d;return n}}function h8e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function f8e(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),d=new Array(r),p;for(p=0;p<n;++p)a[p]=kb(e[p],t[p]);for(;p<r;++p)d[p]=t[p];return function(s){for(p=0;p<n;++p)d[p]=a[p](s);return d}}function p8e(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function xN(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function m8e(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=kb(e[a],t[a]):n[a]=t[a];return function(d){for(a in r)n[a]=r[a](d);return n}}var QF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,WD=new RegExp(QF.source,"g");function g8e(e){return function(){return e}}function y8e(e){return function(t){return e(t)+""}}function v8e(e,t){var r=QF.lastIndex=WD.lastIndex=0,n,a,d,p=-1,s=[],_=[];for(e=e+"",t=t+"";(n=QF.exec(e))&&(a=WD.exec(t));)(d=a.index)>r&&(d=t.slice(r,d),s[p]?s[p]+=d:s[++p]=d),(n=n[0])===(a=a[0])?s[p]?s[p]+=a:s[++p]=a:(s[++p]=null,_.push({i:p,x:xN(n,a)})),r=WD.lastIndex;return r<t.length&&(d=t.slice(r),s[p]?s[p]+=d:s[++p]=d),s.length<2?_[0]?y8e(_[0].x):g8e(t):(t=_.length,function(b){for(var T=0,C;T<t;++T)s[(C=_[T]).i]=C.x(b);return s.join("")})}function kb(e,t){var r=typeof t,n;return t==null||r==="boolean"?o$(t):(r==="number"?xN:r==="string"?(n=t2(t))?(t=n,eZ):v8e:t instanceof t2?eZ:t instanceof Date?p8e:h8e(t)?d8e:Array.isArray(t)?f8e:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?m8e:xN)(e,t)}function l$(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function _8e(e,t){t===void 0&&(t=e,e=kb);for(var r=0,n=t.length-1,a=t[0],d=new Array(n<0?0:n);r<n;)d[r]=e(a,a=t[++r]);return function(p){var s=Math.max(0,Math.min(n-1,Math.floor(p*=n)));return d[s](p-s)}}function x8e(e){return function(){return e}}function bN(e){return+e}var tZ=[0,1];function Fl(e){return e}function ez(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:x8e(isNaN(t)?NaN:.5)}function b8e(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function w8e(e,t,r){var n=e[0],a=e[1],d=t[0],p=t[1];return a<n?(n=ez(a,n),d=r(p,d)):(n=ez(n,a),d=r(d,p)),function(s){return d(n(s))}}function S8e(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),d=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++p<n;)a[p]=ez(e[p],e[p+1]),d[p]=r(t[p],t[p+1]);return function(s){var _=uE(e,s,1,n)-1;return d[_](a[_](s))}}function hE(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Dk(){var e=tZ,t=tZ,r=kb,n,a,d,p=Fl,s,_,b;function T(){var P=Math.min(e.length,t.length);return p!==Fl&&(p=b8e(e[0],e[P-1])),s=P>2?S8e:w8e,_=b=null,C}function C(P){return P==null||isNaN(P=+P)?d:(_||(_=s(e.map(n),t,r)))(n(p(P)))}return C.invert=function(P){return p(a((b||(b=s(t,e.map(n),xN)))(P)))},C.domain=function(P){return arguments.length?(e=Array.from(P,bN),T()):e.slice()},C.range=function(P){return arguments.length?(t=Array.from(P),T()):t.slice()},C.rangeRound=function(P){return t=Array.from(P),r=l$,T()},C.clamp=function(P){return arguments.length?(p=P?!0:Fl,T()):p!==Fl},C.interpolate=function(P){return arguments.length?(r=P,T()):r},C.unknown=function(P){return arguments.length?(d=P,C):d},function(P,k){return n=P,a=k,T()}}function c$(){return Dk()(Fl,Fl)}function T8e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function wN(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function L0(e){return e=wN(Math.abs(e)),e?e[1]:NaN}function E8e(e,t){return function(r,n){for(var a=r.length,d=[],p=0,s=e[0],_=0;a>0&&s>0&&(_+s+1>n&&(s=Math.max(1,n-_)),d.push(r.substring(a-=s,a+s)),!((_+=s+1)>n));)s=e[p=(p+1)%e.length];return d.reverse().join(t)}}function j8e(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var A8e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function r2(e){if(!(t=A8e.exec(e)))throw new Error("invalid format: "+e);var t;return new u$({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}r2.prototype=u$.prototype;function u$(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}u$.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function C8e(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var Yoe;function P8e(e,t){var r=wN(e,t);if(!r)return e+"";var n=r[0],a=r[1],d=a-(Yoe=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return d===p?n:d>p?n+new Array(d-p+1).join("0"):d>0?n.slice(0,d)+"."+n.slice(d):"0."+new Array(1-d).join("0")+wN(e,Math.max(0,t+d-1))[0]}function rZ(e,t){var r=wN(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const nZ={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:T8e,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>rZ(e*100,t),r:rZ,s:P8e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function iZ(e){return e}var sZ=Array.prototype.map,aZ=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function N8e(e){var t=e.grouping===void 0||e.thousands===void 0?iZ:E8e(sZ.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",d=e.numerals===void 0?iZ:j8e(sZ.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function b(C){C=r2(C);var P=C.fill,k=C.align,B=C.sign,R=C.symbol,D=C.zero,G=C.width,V=C.comma,$=C.precision,K=C.trim,Y=C.type;Y==="n"?(V=!0,Y="g"):nZ[Y]||($===void 0&&($=12),K=!0,Y="g"),(D||P==="0"&&k==="=")&&(D=!0,P="0",k="=");var ee=R==="$"?r:R==="#"&&/[boxX]/.test(Y)?"0"+Y.toLowerCase():"",ae=R==="$"?n:/[%p]/.test(Y)?p:"",ie=nZ[Y],ge=/[defgprs%]/.test(Y);$=$===void 0?6:/[gprs]/.test(Y)?Math.max(1,Math.min(21,$)):Math.max(0,Math.min(20,$));function fe(be){var ue=ee,Ce=ae,ve,ze,Me;if(Y==="c")Ce=ie(be)+Ce,be="";else{be=+be;var Be=be<0||1/be<0;if(be=isNaN(be)?_:ie(Math.abs(be),$),K&&(be=C8e(be)),Be&&+be==0&&B!=="+"&&(Be=!1),ue=(Be?B==="("?B:s:B==="-"||B==="("?"":B)+ue,Ce=(Y==="s"?aZ[8+Yoe/3]:"")+Ce+(Be&&B==="("?")":""),ge){for(ve=-1,ze=be.length;++ve<ze;)if(Me=be.charCodeAt(ve),48>Me||Me>57){Ce=(Me===46?a+be.slice(ve+1):be.slice(ve))+Ce,be=be.slice(0,ve);break}}}V&&!D&&(be=t(be,1/0));var Ve=ue.length+be.length+Ce.length,We=Ve<G?new Array(G-Ve+1).join(P):"";switch(V&&D&&(be=t(We+be,We.length?G-Ce.length:1/0),We=""),k){case"<":be=ue+be+Ce+We;break;case"=":be=ue+We+be+Ce;break;case"^":be=We.slice(0,Ve=We.length>>1)+ue+be+Ce+We.slice(Ve);break;default:be=We+ue+be+Ce;break}return d(be)}return fe.toString=function(){return C+""},fe}function T(C,P){var k=b((C=r2(C),C.type="f",C)),B=Math.max(-8,Math.min(8,Math.floor(L0(P)/3)))*3,R=Math.pow(10,-B),D=aZ[8+B/3];return function(G){return k(R*G)+D}}return{format:b,formatPrefix:T}}var PC,d$,Joe;I8e({thousands:",",grouping:[3],currency:["$",""]});function I8e(e){return PC=N8e(e),d$=PC.format,Joe=PC.formatPrefix,PC}function k8e(e){return Math.max(0,-L0(Math.abs(e)))}function O8e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(L0(t)/3)))*3-L0(Math.abs(e)))}function R8e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,L0(t)-L0(e))+1}function Qoe(e,t,r,n){var a=KF(e,t,r),d;switch(n=r2(n??",f"),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(d=O8e(a,p))&&(n.precision=d),Joe(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(d=R8e(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=d-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(d=k8e(a))&&(n.precision=d-(n.type==="%")*2);break}}return d$(n)}function tg(e){var t=e.domain;return e.ticks=function(r){var n=t();return ZF(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return Qoe(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,d=n.length-1,p=n[a],s=n[d],_,b,T=10;for(s<p&&(b=p,p=s,s=b,b=a,a=d,d=b);T-- >0;){if(b=XF(p,s,r),b===_)return n[a]=p,n[d]=s,t(n);if(b>0)p=Math.floor(p/b)*b,s=Math.ceil(s/b)*b;else if(b<0)p=Math.ceil(p*b)/b,s=Math.floor(s*b)/b;else break;_=b}return e},e}function SN(){var e=c$();return e.copy=function(){return hE(e,SN())},Nu.apply(e,arguments),tg(e)}function ele(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,bN),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return ele(e).unknown(t)},e=arguments.length?Array.from(e,bN):[0,1],tg(r)}function tle(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],d=e[n],p;return d<a&&(p=r,r=n,n=p,p=a,a=d,d=p),e[r]=t.floor(a),e[n]=t.ceil(d),e}function oZ(e){return Math.log(e)}function lZ(e){return Math.exp(e)}function M8e(e){return-Math.log(-e)}function D8e(e){return-Math.exp(-e)}function L8e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function F8e(e){return e===10?L8e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function z8e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function cZ(e){return(t,r)=>-e(-t,r)}function h$(e){const t=e(oZ,lZ),r=t.domain;let n=10,a,d;function p(){return a=z8e(n),d=F8e(n),r()[0]<0?(a=cZ(a),d=cZ(d),e(M8e,D8e)):e(oZ,lZ),t}return t.base=function(s){return arguments.length?(n=+s,p()):n},t.domain=function(s){return arguments.length?(r(s),p()):r()},t.ticks=s=>{const _=r();let b=_[0],T=_[_.length-1];const C=T<b;C&&([b,T]=[T,b]);let P=a(b),k=a(T),B,R;const D=s==null?10:+s;let G=[];if(!(n%1)&&k-P<D){if(P=Math.floor(P),k=Math.ceil(k),b>0){for(;P<=k;++P)for(B=1;B<n;++B)if(R=P<0?B/d(-P):B*d(P),!(R<b)){if(R>T)break;G.push(R)}}else for(;P<=k;++P)for(B=n-1;B>=1;--B)if(R=P>0?B/d(-P):B*d(P),!(R<b)){if(R>T)break;G.push(R)}G.length*2<D&&(G=ZF(b,T,D))}else G=ZF(P,k,Math.min(k-P,D)).map(d);return C?G.reverse():G},t.tickFormat=(s,_)=>{if(s==null&&(s=10),_==null&&(_=n===10?"s":","),typeof _!="function"&&(!(n%1)&&(_=r2(_)).precision==null&&(_.trim=!0),_=d$(_)),s===1/0)return _;const b=Math.max(1,n*s/t.ticks().length);return T=>{let C=T/d(Math.round(a(T)));return C*n<n-.5&&(C*=n),C<=b?_(T):""}},t.nice=()=>r(tle(r(),{floor:s=>d(Math.floor(a(s))),ceil:s=>d(Math.ceil(a(s)))})),t}function rle(){const e=h$(Dk()).domain([1,10]);return e.copy=()=>hE(e,rle()).base(e.base()),Nu.apply(e,arguments),e}function uZ(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function dZ(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function f$(e){var t=1,r=e(uZ(t),dZ(t));return r.constant=function(n){return arguments.length?e(uZ(t=+n),dZ(t)):t},tg(r)}function nle(){var e=f$(Dk());return e.copy=function(){return hE(e,nle()).constant(e.constant())},Nu.apply(e,arguments)}function hZ(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function B8e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function $8e(e){return e<0?-e*e:e*e}function p$(e){var t=e(Fl,Fl),r=1;function n(){return r===1?e(Fl,Fl):r===.5?e(B8e,$8e):e(hZ(r),hZ(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},tg(t)}function m$(){var e=p$(Dk());return e.copy=function(){return hE(e,m$()).exponent(e.exponent())},Nu.apply(e,arguments),e}function V8e(){return m$.apply(null,arguments).exponent(.5)}function fZ(e){return Math.sign(e)*e*e}function U8e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function ile(){var e=c$(),t=[0,1],r=!1,n;function a(d){var p=U8e(e(d));return isNaN(p)?n:r?Math.round(p):p}return a.invert=function(d){return e.invert(fZ(d))},a.domain=function(d){return arguments.length?(e.domain(d),a):e.domain()},a.range=function(d){return arguments.length?(e.range((t=Array.from(d,bN)).map(fZ)),a):t.slice()},a.rangeRound=function(d){return a.range(d).round(!0)},a.round=function(d){return arguments.length?(r=!!d,a):r},a.clamp=function(d){return arguments.length?(e.clamp(d),a):e.clamp()},a.unknown=function(d){return arguments.length?(n=d,a):n},a.copy=function(){return ile(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Nu.apply(a,arguments),tg(a)}function sle(){var e=[],t=[],r=[],n;function a(){var p=0,s=Math.max(1,t.length);for(r=new Array(s-1);++p<s;)r[p-1]=ZUe(e,p/s);return d}function d(p){return p==null||isNaN(p=+p)?n:t[uE(r,p)]}return d.invertExtent=function(p){var s=t.indexOf(p);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},d.domain=function(p){if(!arguments.length)return e.slice();e=[];for(let s of p)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(jm),a()},d.range=function(p){return arguments.length?(t=Array.from(p),a()):t.slice()},d.unknown=function(p){return arguments.length?(n=p,d):n},d.quantiles=function(){return r.slice()},d.copy=function(){return sle().domain(e).range(t).unknown(n)},Nu.apply(d,arguments)}function ale(){var e=0,t=1,r=1,n=[.5],a=[0,1],d;function p(_){return _!=null&&_<=_?a[uE(n,_,0,r)]:d}function s(){var _=-1;for(n=new Array(r);++_<r;)n[_]=((_+1)*t-(_-r)*e)/(r+1);return p}return p.domain=function(_){return arguments.length?([e,t]=_,e=+e,t=+t,s()):[e,t]},p.range=function(_){return arguments.length?(r=(a=Array.from(_)).length-1,s()):a.slice()},p.invertExtent=function(_){var b=a.indexOf(_);return b<0?[NaN,NaN]:b<1?[e,n[0]]:b>=r?[n[r-1],t]:[n[b-1],n[b]]},p.unknown=function(_){return arguments.length&&(d=_),p},p.thresholds=function(){return n.slice()},p.copy=function(){return ale().domain([e,t]).range(a).unknown(d)},Nu.apply(tg(p),arguments)}function ole(){var e=[.5],t=[0,1],r,n=1;function a(d){return d!=null&&d<=d?t[uE(e,d,0,n)]:r}return a.domain=function(d){return arguments.length?(e=Array.from(d),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(d){return arguments.length?(t=Array.from(d),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(d){var p=t.indexOf(d);return[e[p-1],e[p]]},a.unknown=function(d){return arguments.length?(r=d,a):r},a.copy=function(){return ole().domain(e).range(t).unknown(r)},Nu.apply(a,arguments)}const HD=new Date,ZD=new Date;function no(e,t,r,n){function a(d){return e(d=arguments.length===0?new Date:new Date(+d)),d}return a.floor=d=>(e(d=new Date(+d)),d),a.ceil=d=>(e(d=new Date(d-1)),t(d,1),e(d),d),a.round=d=>{const p=a(d),s=a.ceil(d);return d-p<s-d?p:s},a.offset=(d,p)=>(t(d=new Date(+d),p==null?1:Math.floor(p)),d),a.range=(d,p,s)=>{const _=[];if(d=a.ceil(d),s=s==null?1:Math.floor(s),!(d<p)||!(s>0))return _;let b;do _.push(b=new Date(+d)),t(d,s),e(d);while(b<d&&d<p);return _},a.filter=d=>no(p=>{if(p>=p)for(;e(p),!d(p);)p.setTime(p-1)},(p,s)=>{if(p>=p)if(s<0)for(;++s<=0;)for(;t(p,-1),!d(p););else for(;--s>=0;)for(;t(p,1),!d(p););}),r&&(a.count=(d,p)=>(HD.setTime(+d),ZD.setTime(+p),e(HD),e(ZD),Math.floor(r(HD,ZD))),a.every=d=>(d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?a.filter(n?p=>n(p)%d===0:p=>a.count(0,p)%d===0):a)),a}const TN=no(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);TN.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?no(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):TN);TN.range;const _f=1e3,xu=_f*60,xf=xu*60,zf=xf*24,g$=zf*7,pZ=zf*30,XD=zf*365,Iy=no(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*_f)},(e,t)=>(t-e)/_f,e=>e.getUTCSeconds());Iy.range;const y$=no(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_f)},(e,t)=>{e.setTime(+e+t*xu)},(e,t)=>(t-e)/xu,e=>e.getMinutes());y$.range;const v$=no(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*xu)},(e,t)=>(t-e)/xu,e=>e.getUTCMinutes());v$.range;const _$=no(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_f-e.getMinutes()*xu)},(e,t)=>{e.setTime(+e+t*xf)},(e,t)=>(t-e)/xf,e=>e.getHours());_$.range;const x$=no(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*xf)},(e,t)=>(t-e)/xf,e=>e.getUTCHours());x$.range;const fE=no(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*xu)/zf,e=>e.getDate()-1);fE.range;const Lk=no(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/zf,e=>e.getUTCDate()-1);Lk.range;const lle=no(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/zf,e=>Math.floor(e/zf));lle.range;function Av(e){return no(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*xu)/g$)}const Fk=Av(0),EN=Av(1),q8e=Av(2),G8e=Av(3),F0=Av(4),W8e=Av(5),H8e=Av(6);Fk.range;EN.range;q8e.range;G8e.range;F0.range;W8e.range;H8e.range;function Cv(e){return no(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/g$)}const zk=Cv(0),jN=Cv(1),Z8e=Cv(2),X8e=Cv(3),z0=Cv(4),K8e=Cv(5),Y8e=Cv(6);zk.range;jN.range;Z8e.range;X8e.range;z0.range;K8e.range;Y8e.range;const b$=no(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());b$.range;const w$=no(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());w$.range;const Bf=no(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Bf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:no(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Bf.range;const $f=no(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());$f.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:no(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});$f.range;function cle(e,t,r,n,a,d){const p=[[Iy,1,_f],[Iy,5,5*_f],[Iy,15,15*_f],[Iy,30,30*_f],[d,1,xu],[d,5,5*xu],[d,15,15*xu],[d,30,30*xu],[a,1,xf],[a,3,3*xf],[a,6,6*xf],[a,12,12*xf],[n,1,zf],[n,2,2*zf],[r,1,g$],[t,1,pZ],[t,3,3*pZ],[e,1,XD]];function s(b,T,C){const P=T<b;P&&([b,T]=[T,b]);const k=C&&typeof C.range=="function"?C:_(b,T,C),B=k?k.range(b,+T+1):[];return P?B.reverse():B}function _(b,T,C){const P=Math.abs(T-b)/C,k=i$(([,,D])=>D).right(p,P);if(k===p.length)return e.every(KF(b/XD,T/XD,C));if(k===0)return TN.every(Math.max(KF(b,T,C),1));const[B,R]=p[P/p[k-1][2]<p[k][2]/P?k-1:k];return B.every(R)}return[s,_]}const[J8e,Q8e]=cle($f,w$,zk,lle,x$,v$),[eqe,tqe]=cle(Bf,b$,Fk,fE,_$,y$);function KD(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function YD(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function oS(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function rqe(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,d=e.days,p=e.shortDays,s=e.months,_=e.shortMonths,b=lS(a),T=cS(a),C=lS(d),P=cS(d),k=lS(p),B=cS(p),R=lS(s),D=cS(s),G=lS(_),V=cS(_),$={a:Be,A:Ve,b:We,B:Ee,c:null,d:xZ,e:xZ,f:Eqe,g:Mqe,G:Lqe,H:wqe,I:Sqe,j:Tqe,L:ule,m:jqe,M:Aqe,p:ot,q:yt,Q:SZ,s:TZ,S:Cqe,u:Pqe,U:Nqe,V:Iqe,w:kqe,W:Oqe,x:null,X:null,y:Rqe,Y:Dqe,Z:Fqe,"%":wZ},K={a:Je,A:Bt,b:Pt,B:pt,c:null,d:bZ,e:bZ,f:Vqe,g:Jqe,G:eGe,H:zqe,I:Bqe,j:$qe,L:hle,m:Uqe,M:qqe,p:Gt,q:Pr,Q:SZ,s:TZ,S:Gqe,u:Wqe,U:Hqe,V:Zqe,w:Xqe,W:Kqe,x:null,X:null,y:Yqe,Y:Qqe,Z:tGe,"%":wZ},Y={a:fe,A:be,b:ue,B:Ce,c:ve,d:vZ,e:vZ,f:vqe,g:yZ,G:gZ,H:_Z,I:_Z,j:pqe,L:yqe,m:fqe,M:mqe,p:ge,q:hqe,Q:xqe,s:bqe,S:gqe,u:oqe,U:lqe,V:cqe,w:aqe,W:uqe,x:ze,X:Me,y:yZ,Y:gZ,Z:dqe,"%":_qe};$.x=ee(r,$),$.X=ee(n,$),$.c=ee(t,$),K.x=ee(r,K),K.X=ee(n,K),K.c=ee(t,K);function ee(Ot,nr){return function(ur){var Et=[],pr=-1,Kr=0,Xn=Ot.length,Jn,ni,zn;for(ur instanceof Date||(ur=new Date(+ur));++pr<Xn;)Ot.charCodeAt(pr)===37&&(Et.push(Ot.slice(Kr,pr)),(ni=mZ[Jn=Ot.charAt(++pr)])!=null?Jn=Ot.charAt(++pr):ni=Jn==="e"?" ":"0",(zn=nr[Jn])&&(Jn=zn(ur,ni)),Et.push(Jn),Kr=pr+1);return Et.push(Ot.slice(Kr,pr)),Et.join("")}}function ae(Ot,nr){return function(ur){var Et=oS(1900,void 0,1),pr=ie(Et,Ot,ur+="",0),Kr,Xn;if(pr!=ur.length)return null;if("Q"in Et)return new Date(Et.Q);if("s"in Et)return new Date(Et.s*1e3+("L"in Et?Et.L:0));if(nr&&!("Z"in Et)&&(Et.Z=0),"p"in Et&&(Et.H=Et.H%12+Et.p*12),Et.m===void 0&&(Et.m="q"in Et?Et.q:0),"V"in Et){if(Et.V<1||Et.V>53)return null;"w"in Et||(Et.w=1),"Z"in Et?(Kr=YD(oS(Et.y,0,1)),Xn=Kr.getUTCDay(),Kr=Xn>4||Xn===0?jN.ceil(Kr):jN(Kr),Kr=Lk.offset(Kr,(Et.V-1)*7),Et.y=Kr.getUTCFullYear(),Et.m=Kr.getUTCMonth(),Et.d=Kr.getUTCDate()+(Et.w+6)%7):(Kr=KD(oS(Et.y,0,1)),Xn=Kr.getDay(),Kr=Xn>4||Xn===0?EN.ceil(Kr):EN(Kr),Kr=fE.offset(Kr,(Et.V-1)*7),Et.y=Kr.getFullYear(),Et.m=Kr.getMonth(),Et.d=Kr.getDate()+(Et.w+6)%7)}else("W"in Et||"U"in Et)&&("w"in Et||(Et.w="u"in Et?Et.u%7:"W"in Et?1:0),Xn="Z"in Et?YD(oS(Et.y,0,1)).getUTCDay():KD(oS(Et.y,0,1)).getDay(),Et.m=0,Et.d="W"in Et?(Et.w+6)%7+Et.W*7-(Xn+5)%7:Et.w+Et.U*7-(Xn+6)%7);return"Z"in Et?(Et.H+=Et.Z/100|0,Et.M+=Et.Z%100,YD(Et)):KD(Et)}}function ie(Ot,nr,ur,Et){for(var pr=0,Kr=nr.length,Xn=ur.length,Jn,ni;pr<Kr;){if(Et>=Xn)return-1;if(Jn=nr.charCodeAt(pr++),Jn===37){if(Jn=nr.charAt(pr++),ni=Y[Jn in mZ?nr.charAt(pr++):Jn],!ni||(Et=ni(Ot,ur,Et))<0)return-1}else if(Jn!=ur.charCodeAt(Et++))return-1}return Et}function ge(Ot,nr,ur){var Et=b.exec(nr.slice(ur));return Et?(Ot.p=T.get(Et[0].toLowerCase()),ur+Et[0].length):-1}function fe(Ot,nr,ur){var Et=k.exec(nr.slice(ur));return Et?(Ot.w=B.get(Et[0].toLowerCase()),ur+Et[0].length):-1}function be(Ot,nr,ur){var Et=C.exec(nr.slice(ur));return Et?(Ot.w=P.get(Et[0].toLowerCase()),ur+Et[0].length):-1}function ue(Ot,nr,ur){var Et=G.exec(nr.slice(ur));return Et?(Ot.m=V.get(Et[0].toLowerCase()),ur+Et[0].length):-1}function Ce(Ot,nr,ur){var Et=R.exec(nr.slice(ur));return Et?(Ot.m=D.get(Et[0].toLowerCase()),ur+Et[0].length):-1}function ve(Ot,nr,ur){return ie(Ot,t,nr,ur)}function ze(Ot,nr,ur){return ie(Ot,r,nr,ur)}function Me(Ot,nr,ur){return ie(Ot,n,nr,ur)}function Be(Ot){return p[Ot.getDay()]}function Ve(Ot){return d[Ot.getDay()]}function We(Ot){return _[Ot.getMonth()]}function Ee(Ot){return s[Ot.getMonth()]}function ot(Ot){return a[+(Ot.getHours()>=12)]}function yt(Ot){return 1+~~(Ot.getMonth()/3)}function Je(Ot){return p[Ot.getUTCDay()]}function Bt(Ot){return d[Ot.getUTCDay()]}function Pt(Ot){return _[Ot.getUTCMonth()]}function pt(Ot){return s[Ot.getUTCMonth()]}function Gt(Ot){return a[+(Ot.getUTCHours()>=12)]}function Pr(Ot){return 1+~~(Ot.getUTCMonth()/3)}return{format:function(Ot){var nr=ee(Ot+="",$);return nr.toString=function(){return Ot},nr},parse:function(Ot){var nr=ae(Ot+="",!1);return nr.toString=function(){return Ot},nr},utcFormat:function(Ot){var nr=ee(Ot+="",K);return nr.toString=function(){return Ot},nr},utcParse:function(Ot){var nr=ae(Ot+="",!0);return nr.toString=function(){return Ot},nr}}}var mZ={"-":"",_:" ",0:"0"},xo=/^\s*\d+/,nqe=/^%/,iqe=/[\\^$*+?|[\]().{}]/g;function Gi(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",d=a.length;return n+(d<r?new Array(r-d+1).join(t)+a:a)}function sqe(e){return e.replace(iqe,"\\$&")}function lS(e){return new RegExp("^(?:"+e.map(sqe).join("|")+")","i")}function cS(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function aqe(e,t,r){var n=xo.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function oqe(e,t,r){var n=xo.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function lqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function cqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function uqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function gZ(e,t,r){var n=xo.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function yZ(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function dqe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function hqe(e,t,r){var n=xo.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function fqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function vZ(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function pqe(e,t,r){var n=xo.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function _Z(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function mqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function gqe(e,t,r){var n=xo.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function yqe(e,t,r){var n=xo.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function vqe(e,t,r){var n=xo.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function _qe(e,t,r){var n=nqe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function xqe(e,t,r){var n=xo.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function bqe(e,t,r){var n=xo.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function xZ(e,t){return Gi(e.getDate(),t,2)}function wqe(e,t){return Gi(e.getHours(),t,2)}function Sqe(e,t){return Gi(e.getHours()%12||12,t,2)}function Tqe(e,t){return Gi(1+fE.count(Bf(e),e),t,3)}function ule(e,t){return Gi(e.getMilliseconds(),t,3)}function Eqe(e,t){return ule(e,t)+"000"}function jqe(e,t){return Gi(e.getMonth()+1,t,2)}function Aqe(e,t){return Gi(e.getMinutes(),t,2)}function Cqe(e,t){return Gi(e.getSeconds(),t,2)}function Pqe(e){var t=e.getDay();return t===0?7:t}function Nqe(e,t){return Gi(Fk.count(Bf(e)-1,e),t,2)}function dle(e){var t=e.getDay();return t>=4||t===0?F0(e):F0.ceil(e)}function Iqe(e,t){return e=dle(e),Gi(F0.count(Bf(e),e)+(Bf(e).getDay()===4),t,2)}function kqe(e){return e.getDay()}function Oqe(e,t){return Gi(EN.count(Bf(e)-1,e),t,2)}function Rqe(e,t){return Gi(e.getFullYear()%100,t,2)}function Mqe(e,t){return e=dle(e),Gi(e.getFullYear()%100,t,2)}function Dqe(e,t){return Gi(e.getFullYear()%1e4,t,4)}function Lqe(e,t){var r=e.getDay();return e=r>=4||r===0?F0(e):F0.ceil(e),Gi(e.getFullYear()%1e4,t,4)}function Fqe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Gi(t/60|0,"0",2)+Gi(t%60,"0",2)}function bZ(e,t){return Gi(e.getUTCDate(),t,2)}function zqe(e,t){return Gi(e.getUTCHours(),t,2)}function Bqe(e,t){return Gi(e.getUTCHours()%12||12,t,2)}function $qe(e,t){return Gi(1+Lk.count($f(e),e),t,3)}function hle(e,t){return Gi(e.getUTCMilliseconds(),t,3)}function Vqe(e,t){return hle(e,t)+"000"}function Uqe(e,t){return Gi(e.getUTCMonth()+1,t,2)}function qqe(e,t){return Gi(e.getUTCMinutes(),t,2)}function Gqe(e,t){return Gi(e.getUTCSeconds(),t,2)}function Wqe(e){var t=e.getUTCDay();return t===0?7:t}function Hqe(e,t){return Gi(zk.count($f(e)-1,e),t,2)}function fle(e){var t=e.getUTCDay();return t>=4||t===0?z0(e):z0.ceil(e)}function Zqe(e,t){return e=fle(e),Gi(z0.count($f(e),e)+($f(e).getUTCDay()===4),t,2)}function Xqe(e){return e.getUTCDay()}function Kqe(e,t){return Gi(jN.count($f(e)-1,e),t,2)}function Yqe(e,t){return Gi(e.getUTCFullYear()%100,t,2)}function Jqe(e,t){return e=fle(e),Gi(e.getUTCFullYear()%100,t,2)}function Qqe(e,t){return Gi(e.getUTCFullYear()%1e4,t,4)}function eGe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?z0(e):z0.ceil(e),Gi(e.getUTCFullYear()%1e4,t,4)}function tGe(){return"+0000"}function wZ(){return"%"}function SZ(e){return+e}function TZ(e){return Math.floor(+e/1e3)}var cx,ple,mle;rGe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function rGe(e){return cx=rqe(e),ple=cx.format,cx.parse,mle=cx.utcFormat,cx.utcParse,cx}function nGe(e){return new Date(e)}function iGe(e){return e instanceof Date?+e:+new Date(+e)}function S$(e,t,r,n,a,d,p,s,_,b){var T=c$(),C=T.invert,P=T.domain,k=b(".%L"),B=b(":%S"),R=b("%I:%M"),D=b("%I %p"),G=b("%a %d"),V=b("%b %d"),$=b("%B"),K=b("%Y");function Y(ee){return(_(ee)<ee?k:s(ee)<ee?B:p(ee)<ee?R:d(ee)<ee?D:n(ee)<ee?a(ee)<ee?G:V:r(ee)<ee?$:K)(ee)}return T.invert=function(ee){return new Date(C(ee))},T.domain=function(ee){return arguments.length?P(Array.from(ee,iGe)):P().map(nGe)},T.ticks=function(ee){var ae=P();return e(ae[0],ae[ae.length-1],ee??10)},T.tickFormat=function(ee,ae){return ae==null?Y:b(ae)},T.nice=function(ee){var ae=P();return(!ee||typeof ee.range!="function")&&(ee=t(ae[0],ae[ae.length-1],ee??10)),ee?P(tle(ae,ee)):T},T.copy=function(){return hE(T,S$(e,t,r,n,a,d,p,s,_,b))},T}function sGe(){return Nu.apply(S$(eqe,tqe,Bf,b$,Fk,fE,_$,y$,Iy,ple).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function aGe(){return Nu.apply(S$(J8e,Q8e,$f,w$,zk,Lk,x$,v$,Iy,mle).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Bk(){var e=0,t=1,r,n,a,d,p=Fl,s=!1,_;function b(C){return C==null||isNaN(C=+C)?_:p(a===0?.5:(C=(d(C)-r)*a,s?Math.max(0,Math.min(1,C)):C))}b.domain=function(C){return arguments.length?([e,t]=C,r=d(e=+e),n=d(t=+t),a=r===n?0:1/(n-r),b):[e,t]},b.clamp=function(C){return arguments.length?(s=!!C,b):s},b.interpolator=function(C){return arguments.length?(p=C,b):p};function T(C){return function(P){var k,B;return arguments.length?([k,B]=P,p=C(k,B),b):[p(0),p(1)]}}return b.range=T(kb),b.rangeRound=T(l$),b.unknown=function(C){return arguments.length?(_=C,b):_},function(C){return d=C,r=C(e),n=C(t),a=r===n?0:1/(n-r),b}}function rg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function gle(){var e=tg(Bk()(Fl));return e.copy=function(){return rg(e,gle())},Xf.apply(e,arguments)}function yle(){var e=h$(Bk()).domain([1,10]);return e.copy=function(){return rg(e,yle()).base(e.base())},Xf.apply(e,arguments)}function vle(){var e=f$(Bk());return e.copy=function(){return rg(e,vle()).constant(e.constant())},Xf.apply(e,arguments)}function T$(){var e=p$(Bk());return e.copy=function(){return rg(e,T$()).exponent(e.exponent())},Xf.apply(e,arguments)}function oGe(){return T$.apply(null,arguments).exponent(.5)}function _le(){var e=[],t=Fl;function r(n){if(n!=null&&!isNaN(n=+n))return t((uE(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(jm),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,d)=>HUe(e,d/n))},r.copy=function(){return _le(t).domain(e)},Xf.apply(r,arguments)}function $k(){var e=0,t=.5,r=1,n=1,a,d,p,s,_,b=Fl,T,C=!1,P;function k(R){return isNaN(R=+R)?P:(R=.5+((R=+T(R))-d)*(n*R<n*d?s:_),b(C?Math.max(0,Math.min(1,R)):R))}k.domain=function(R){return arguments.length?([e,t,r]=R,a=T(e=+e),d=T(t=+t),p=T(r=+r),s=a===d?0:.5/(d-a),_=d===p?0:.5/(p-d),n=d<a?-1:1,k):[e,t,r]},k.clamp=function(R){return arguments.length?(C=!!R,k):C},k.interpolator=function(R){return arguments.length?(b=R,k):b};function B(R){return function(D){var G,V,$;return arguments.length?([G,V,$]=D,b=_8e(R,[G,V,$]),k):[b(0),b(.5),b(1)]}}return k.range=B(kb),k.rangeRound=B(l$),k.unknown=function(R){return arguments.length?(P=R,k):P},function(R){return T=R,a=R(e),d=R(t),p=R(r),s=a===d?0:.5/(d-a),_=d===p?0:.5/(p-d),n=d<a?-1:1,k}}function xle(){var e=tg($k()(Fl));return e.copy=function(){return rg(e,xle())},Xf.apply(e,arguments)}function ble(){var e=h$($k()).domain([.1,1,10]);return e.copy=function(){return rg(e,ble()).base(e.base())},Xf.apply(e,arguments)}function wle(){var e=f$($k());return e.copy=function(){return rg(e,wle()).constant(e.constant())},Xf.apply(e,arguments)}function E$(){var e=p$($k());return e.copy=function(){return rg(e,E$()).exponent(e.exponent())},Xf.apply(e,arguments)}function lGe(){return E$.apply(null,arguments).exponent(.5)}const EZ=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:JT,scaleDiverging:xle,scaleDivergingLog:ble,scaleDivergingPow:E$,scaleDivergingSqrt:lGe,scaleDivergingSymlog:wle,scaleIdentity:ele,scaleImplicit:YF,scaleLinear:SN,scaleLog:rle,scaleOrdinal:s$,scalePoint:JS,scalePow:m$,scaleQuantile:sle,scaleQuantize:ale,scaleRadial:ile,scaleSequential:gle,scaleSequentialLog:yle,scaleSequentialPow:T$,scaleSequentialQuantile:_le,scaleSequentialSqrt:oGe,scaleSequentialSymlog:vle,scaleSqrt:V8e,scaleSymlog:nle,scaleThreshold:ole,scaleTime:sGe,scaleUtc:aGe,tickFormat:Qoe},Symbol.toStringTag,{value:"Module"}));var cGe=Sb;function uGe(e,t,r){for(var n=-1,a=e.length;++n<a;){var d=e[n],p=t(d);if(p!=null&&(s===void 0?p===p&&!cGe(p):r(p,s)))var s=p,_=d}return _}var Vk=uGe;function dGe(e,t){return e>t}var Sle=dGe,hGe=Vk,fGe=Sle,pGe=Ib;function mGe(e){return e&&e.length?hGe(e,pGe,fGe):void 0}var gGe=mGe;const fm=es(gGe);function yGe(e,t){return e<t}var Tle=yGe,vGe=Vk,_Ge=Tle,xGe=Ib;function bGe(e){return e&&e.length?vGe(e,xGe,_Ge):void 0}var wGe=bGe;const Uk=es(wGe);var SGe=z5,TGe=Dh,EGe=koe,jGe=fc;function AGe(e,t){var r=jGe(e)?SGe:EGe;return r(e,TGe(t))}var CGe=AGe,PGe=Noe,NGe=CGe;function IGe(e,t){return PGe(NGe(e,t),1)}var kGe=IGe;const OGe=es(kGe);var RGe=e$;function MGe(e,t){return RGe(e,t)}var DGe=MGe;const dv=es(DGe);var Ob=1e9,LGe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},A$,Gs=!0,Au="[DecimalError] ",Zy=Au+"Invalid argument: ",j$=Au+"Exponent out of range: ",Rb=Math.floor,gy=Math.pow,FGe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ic,go=1e7,Ls=7,Ele=9007199254740991,AN=Rb(Ele/Ls),Jr={};Jr.absoluteValue=Jr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Jr.comparedTo=Jr.cmp=function(e){var t,r,n,a,d=this;if(e=new d.constructor(e),d.s!==e.s)return d.s||-e.s;if(d.e!==e.e)return d.e>e.e^d.s<0?1:-1;for(n=d.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(d.d[t]!==e.d[t])return d.d[t]>e.d[t]^d.s<0?1:-1;return n===a?0:n>a^d.s<0?1:-1};Jr.decimalPlaces=Jr.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*Ls;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Jr.dividedBy=Jr.div=function(e){return Af(this,new this.constructor(e))};Jr.dividedToIntegerBy=Jr.idiv=function(e){var t=this,r=t.constructor;return ys(Af(t,new r(e),0,1),r.precision)};Jr.equals=Jr.eq=function(e){return!this.cmp(e)};Jr.exponent=function(){return Fa(this)};Jr.greaterThan=Jr.gt=function(e){return this.cmp(e)>0};Jr.greaterThanOrEqualTo=Jr.gte=function(e){return this.cmp(e)>=0};Jr.isInteger=Jr.isint=function(){return this.e>this.d.length-2};Jr.isNegative=Jr.isneg=function(){return this.s<0};Jr.isPositive=Jr.ispos=function(){return this.s>0};Jr.isZero=function(){return this.s===0};Jr.lessThan=Jr.lt=function(e){return this.cmp(e)<0};Jr.lessThanOrEqualTo=Jr.lte=function(e){return this.cmp(e)<1};Jr.logarithm=Jr.log=function(e){var t,r=this,n=r.constructor,a=n.precision,d=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(Ic))throw Error(Au+"NaN");if(r.s<1)throw Error(Au+(r.s?"NaN":"-Infinity"));return r.eq(Ic)?new n(0):(Gs=!1,t=Af(n2(r,d),n2(e,d),d),Gs=!0,ys(t,a))};Jr.minus=Jr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Cle(t,e):jle(t,(e.s=-e.s,e))};Jr.modulo=Jr.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(Au+"NaN");return r.s?(Gs=!1,t=Af(r,e,0,1).times(e),Gs=!0,r.minus(t)):ys(new n(r),a)};Jr.naturalExponential=Jr.exp=function(){return Ale(this)};Jr.naturalLogarithm=Jr.ln=function(){return n2(this)};Jr.negated=Jr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Jr.plus=Jr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?jle(t,e):Cle(t,(e.s=-e.s,e))};Jr.precision=Jr.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Zy+e);if(t=Fa(a)+1,n=a.d.length-1,r=n*Ls+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Jr.squareRoot=Jr.sqrt=function(){var e,t,r,n,a,d,p,s=this,_=s.constructor;if(s.s<1){if(!s.s)return new _(0);throw Error(Au+"NaN")}for(e=Fa(s),Gs=!1,a=Math.sqrt(+s),a==0||a==1/0?(t=mh(s.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Rb((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new _(t)):n=new _(a.toString()),r=_.precision,a=p=r+3;;)if(d=n,n=d.plus(Af(s,d,p+2)).times(.5),mh(d.d).slice(0,p)===(t=mh(n.d)).slice(0,p)){if(t=t.slice(p-3,p+1),a==p&&t=="4999"){if(ys(d,r+1,0),d.times(d).eq(s)){n=d;break}}else if(t!="9999")break;p+=4}return Gs=!0,ys(n,r)};Jr.times=Jr.mul=function(e){var t,r,n,a,d,p,s,_,b,T=this,C=T.constructor,P=T.d,k=(e=new C(e)).d;if(!T.s||!e.s)return new C(0);for(e.s*=T.s,r=T.e+e.e,_=P.length,b=k.length,_<b&&(d=P,P=k,k=d,p=_,_=b,b=p),d=[],p=_+b,n=p;n--;)d.push(0);for(n=b;--n>=0;){for(t=0,a=_+n;a>n;)s=d[a]+k[n]*P[a-n-1]+t,d[a--]=s%go|0,t=s/go|0;d[a]=(d[a]+t)%go|0}for(;!d[--p];)d.pop();return t?++r:d.shift(),e.d=d,e.e=r,Gs?ys(e,C.precision):e};Jr.toDecimalPlaces=Jr.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(kh(e,0,Ob),t===void 0?t=n.rounding:kh(t,0,8),ys(r,e+Fa(r)+1,t))};Jr.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=hv(n,!0):(kh(e,0,Ob),t===void 0?t=a.rounding:kh(t,0,8),n=ys(new a(n),e+1,t),r=hv(n,!0,e+1)),r};Jr.toFixed=function(e,t){var r,n,a=this,d=a.constructor;return e===void 0?hv(a):(kh(e,0,Ob),t===void 0?t=d.rounding:kh(t,0,8),n=ys(new d(a),e+Fa(a)+1,t),r=hv(n.abs(),!1,e+Fa(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};Jr.toInteger=Jr.toint=function(){var e=this,t=e.constructor;return ys(new t(e),Fa(e)+1,t.rounding)};Jr.toNumber=function(){return+this};Jr.toPower=Jr.pow=function(e){var t,r,n,a,d,p,s=this,_=s.constructor,b=12,T=+(e=new _(e));if(!e.s)return new _(Ic);if(s=new _(s),!s.s){if(e.s<1)throw Error(Au+"Infinity");return s}if(s.eq(Ic))return s;if(n=_.precision,e.eq(Ic))return ys(s,n);if(t=e.e,r=e.d.length-1,p=t>=r,d=s.s,p){if((r=T<0?-T:T)<=Ele){for(a=new _(Ic),t=Math.ceil(n/Ls+4),Gs=!1;r%2&&(a=a.times(s),AZ(a.d,t)),r=Rb(r/2),r!==0;)s=s.times(s),AZ(s.d,t);return Gs=!0,e.s<0?new _(Ic).div(a):ys(a,n)}}else if(d<0)throw Error(Au+"NaN");return d=d<0&&e.d[Math.max(t,r)]&1?-1:1,s.s=1,Gs=!1,a=e.times(n2(s,n+b)),Gs=!0,a=Ale(a),a.s=d,a};Jr.toPrecision=function(e,t){var r,n,a=this,d=a.constructor;return e===void 0?(r=Fa(a),n=hv(a,r<=d.toExpNeg||r>=d.toExpPos)):(kh(e,1,Ob),t===void 0?t=d.rounding:kh(t,0,8),a=ys(new d(a),e,t),r=Fa(a),n=hv(a,e<=r||r<=d.toExpNeg,e)),n};Jr.toSignificantDigits=Jr.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(kh(e,1,Ob),t===void 0?t=n.rounding:kh(t,0,8)),ys(new n(r),e,t)};Jr.toString=Jr.valueOf=Jr.val=Jr.toJSON=Jr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Fa(e),r=e.constructor;return hv(e,t<=r.toExpNeg||t>=r.toExpPos)};function jle(e,t){var r,n,a,d,p,s,_,b,T=e.constructor,C=T.precision;if(!e.s||!t.s)return t.s||(t=new T(e)),Gs?ys(t,C):t;if(_=e.d,b=t.d,p=e.e,a=t.e,_=_.slice(),d=p-a,d){for(d<0?(n=_,d=-d,s=b.length):(n=b,a=p,s=_.length),p=Math.ceil(C/Ls),s=p>s?p+1:s+1,d>s&&(d=s,n.length=1),n.reverse();d--;)n.push(0);n.reverse()}for(s=_.length,d=b.length,s-d<0&&(d=s,n=b,b=_,_=n),r=0;d;)r=(_[--d]=_[d]+b[d]+r)/go|0,_[d]%=go;for(r&&(_.unshift(r),++a),s=_.length;_[--s]==0;)_.pop();return t.d=_,t.e=a,Gs?ys(t,C):t}function kh(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Zy+e)}function mh(e){var t,r,n,a=e.length-1,d="",p=e[0];if(a>0){for(d+=p,t=1;t<a;t++)n=e[t]+"",r=Ls-n.length,r&&(d+=Xp(r)),d+=n;p=e[t],n=p+"",r=Ls-n.length,r&&(d+=Xp(r))}else if(p===0)return"0";for(;p%10===0;)p/=10;return d+p}var Af=function(){function e(n,a){var d,p=0,s=n.length;for(n=n.slice();s--;)d=n[s]*a+p,n[s]=d%go|0,p=d/go|0;return p&&n.unshift(p),n}function t(n,a,d,p){var s,_;if(d!=p)_=d>p?1:-1;else for(s=_=0;s<d;s++)if(n[s]!=a[s]){_=n[s]>a[s]?1:-1;break}return _}function r(n,a,d){for(var p=0;d--;)n[d]-=p,p=n[d]<a[d]?1:0,n[d]=p*go+n[d]-a[d];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,d,p){var s,_,b,T,C,P,k,B,R,D,G,V,$,K,Y,ee,ae,ie,ge=n.constructor,fe=n.s==a.s?1:-1,be=n.d,ue=a.d;if(!n.s)return new ge(n);if(!a.s)throw Error(Au+"Division by zero");for(_=n.e-a.e,ae=ue.length,Y=be.length,k=new ge(fe),B=k.d=[],b=0;ue[b]==(be[b]||0);)++b;if(ue[b]>(be[b]||0)&&--_,d==null?V=d=ge.precision:p?V=d+(Fa(n)-Fa(a))+1:V=d,V<0)return new ge(0);if(V=V/Ls+2|0,b=0,ae==1)for(T=0,ue=ue[0],V++;(b<Y||T)&&V--;b++)$=T*go+(be[b]||0),B[b]=$/ue|0,T=$%ue|0;else{for(T=go/(ue[0]+1)|0,T>1&&(ue=e(ue,T),be=e(be,T),ae=ue.length,Y=be.length),K=ae,R=be.slice(0,ae),D=R.length;D<ae;)R[D++]=0;ie=ue.slice(),ie.unshift(0),ee=ue[0],ue[1]>=go/2&&++ee;do T=0,s=t(ue,R,ae,D),s<0?(G=R[0],ae!=D&&(G=G*go+(R[1]||0)),T=G/ee|0,T>1?(T>=go&&(T=go-1),C=e(ue,T),P=C.length,D=R.length,s=t(C,R,P,D),s==1&&(T--,r(C,ae<P?ie:ue,P))):(T==0&&(s=T=1),C=ue.slice()),P=C.length,P<D&&C.unshift(0),r(R,C,D),s==-1&&(D=R.length,s=t(ue,R,ae,D),s<1&&(T++,r(R,ae<D?ie:ue,D))),D=R.length):s===0&&(T++,R=[0]),B[b++]=T,s&&R[0]?R[D++]=be[K]||0:(R=[be[K]],D=1);while((K++<Y||R[0]!==void 0)&&V--)}return B[0]||B.shift(),k.e=_,ys(k,p?d+Fa(k)+1:d)}}();function Ale(e,t){var r,n,a,d,p,s,_=0,b=0,T=e.constructor,C=T.precision;if(Fa(e)>16)throw Error(j$+Fa(e));if(!e.s)return new T(Ic);for(Gs=!1,s=C,p=new T(.03125);e.abs().gte(.1);)e=e.times(p),b+=5;for(n=Math.log(gy(2,b))/Math.LN10*2+5|0,s+=n,r=a=d=new T(Ic),T.precision=s;;){if(a=ys(a.times(e),s),r=r.times(++_),p=d.plus(Af(a,r,s)),mh(p.d).slice(0,s)===mh(d.d).slice(0,s)){for(;b--;)d=ys(d.times(d),s);return T.precision=C,t==null?(Gs=!0,ys(d,C)):d}d=p}}function Fa(e){for(var t=e.e*Ls,r=e.d[0];r>=10;r/=10)t++;return t}function JD(e,t,r){if(t>e.LN10.sd())throw Gs=!0,r&&(e.precision=r),Error(Au+"LN10 precision limit exceeded");return ys(new e(e.LN10),t)}function Xp(e){for(var t="";e--;)t+="0";return t}function n2(e,t){var r,n,a,d,p,s,_,b,T,C=1,P=10,k=e,B=k.d,R=k.constructor,D=R.precision;if(k.s<1)throw Error(Au+(k.s?"NaN":"-Infinity"));if(k.eq(Ic))return new R(0);if(t==null?(Gs=!1,b=D):b=t,k.eq(10))return t==null&&(Gs=!0),JD(R,b);if(b+=P,R.precision=b,r=mh(B),n=r.charAt(0),d=Fa(k),Math.abs(d)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)k=k.times(e),r=mh(k.d),n=r.charAt(0),C++;d=Fa(k),n>1?(k=new R("0."+r),d++):k=new R(n+"."+r.slice(1))}else return _=JD(R,b+2,D).times(d+""),k=n2(new R(n+"."+r.slice(1)),b-P).plus(_),R.precision=D,t==null?(Gs=!0,ys(k,D)):k;for(s=p=k=Af(k.minus(Ic),k.plus(Ic),b),T=ys(k.times(k),b),a=3;;){if(p=ys(p.times(T),b),_=s.plus(Af(p,new R(a),b)),mh(_.d).slice(0,b)===mh(s.d).slice(0,b))return s=s.times(2),d!==0&&(s=s.plus(JD(R,b+2,D).times(d+""))),s=Af(s,new R(C),b),R.precision=D,t==null?(Gs=!0,ys(s,D)):s;s=_,a+=2}}function jZ(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Rb(r/Ls),e.d=[],n=(r+1)%Ls,r<0&&(n+=Ls),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=Ls;n<a;)e.d.push(+t.slice(n,n+=Ls));t=t.slice(n),n=Ls-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),Gs&&(e.e>AN||e.e<-AN))throw Error(j$+r)}else e.s=0,e.e=0,e.d=[0];return e}function ys(e,t,r){var n,a,d,p,s,_,b,T,C=e.d;for(p=1,d=C[0];d>=10;d/=10)p++;if(n=t-p,n<0)n+=Ls,a=t,b=C[T=0];else{if(T=Math.ceil((n+1)/Ls),d=C.length,T>=d)return e;for(b=d=C[T],p=1;d>=10;d/=10)p++;n%=Ls,a=n-Ls+p}if(r!==void 0&&(d=gy(10,p-a-1),s=b/d%10|0,_=t<0||C[T+1]!==void 0||b%d,_=r<4?(s||_)&&(r==0||r==(e.s<0?3:2)):s>5||s==5&&(r==4||_||r==6&&(n>0?a>0?b/gy(10,p-a):0:C[T-1])%10&1||r==(e.s<0?8:7))),t<1||!C[0])return _?(d=Fa(e),C.length=1,t=t-d-1,C[0]=gy(10,(Ls-t%Ls)%Ls),e.e=Rb(-t/Ls)||0):(C.length=1,C[0]=e.e=e.s=0),e;if(n==0?(C.length=T,d=1,T--):(C.length=T+1,d=gy(10,Ls-n),C[T]=a>0?(b/gy(10,p-a)%gy(10,a)|0)*d:0),_)for(;;)if(T==0){(C[0]+=d)==go&&(C[0]=1,++e.e);break}else{if(C[T]+=d,C[T]!=go)break;C[T--]=0,d=1}for(n=C.length;C[--n]===0;)C.pop();if(Gs&&(e.e>AN||e.e<-AN))throw Error(j$+Fa(e));return e}function Cle(e,t){var r,n,a,d,p,s,_,b,T,C,P=e.constructor,k=P.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new P(e),Gs?ys(t,k):t;if(_=e.d,C=t.d,n=t.e,b=e.e,_=_.slice(),p=b-n,p){for(T=p<0,T?(r=_,p=-p,s=C.length):(r=C,n=b,s=_.length),a=Math.max(Math.ceil(k/Ls),s)+2,p>a&&(p=a,r.length=1),r.reverse(),a=p;a--;)r.push(0);r.reverse()}else{for(a=_.length,s=C.length,T=a<s,T&&(s=a),a=0;a<s;a++)if(_[a]!=C[a]){T=_[a]<C[a];break}p=0}for(T&&(r=_,_=C,C=r,t.s=-t.s),s=_.length,a=C.length-s;a>0;--a)_[s++]=0;for(a=C.length;a>p;){if(_[--a]<C[a]){for(d=a;d&&_[--d]===0;)_[d]=go-1;--_[d],_[a]+=go}_[a]-=C[a]}for(;_[--s]===0;)_.pop();for(;_[0]===0;_.shift())--n;return _[0]?(t.d=_,t.e=n,Gs?ys(t,k):t):new P(0)}function hv(e,t,r){var n,a=Fa(e),d=mh(e.d),p=d.length;return t?(r&&(n=r-p)>0?d=d.charAt(0)+"."+d.slice(1)+Xp(n):p>1&&(d=d.charAt(0)+"."+d.slice(1)),d=d+(a<0?"e":"e+")+a):a<0?(d="0."+Xp(-a-1)+d,r&&(n=r-p)>0&&(d+=Xp(n))):a>=p?(d+=Xp(a+1-p),r&&(n=r-a-1)>0&&(d=d+"."+Xp(n))):((n=a+1)<p&&(d=d.slice(0,n)+"."+d.slice(n)),r&&(n=r-p)>0&&(a+1===p&&(d+="."),d+=Xp(n))),e.s<0?"-"+d:d}function AZ(e,t){if(e.length>t)return e.length=t,!0}function Ple(e){var t,r,n;function a(d){var p=this;if(!(p instanceof a))return new a(d);if(p.constructor=a,d instanceof a){p.s=d.s,p.e=d.e,p.d=(d=d.d)?d.slice():d;return}if(typeof d=="number"){if(d*0!==0)throw Error(Zy+d);if(d>0)p.s=1;else if(d<0)d=-d,p.s=-1;else{p.s=0,p.e=0,p.d=[0];return}if(d===~~d&&d<1e7){p.e=0,p.d=[d];return}return jZ(p,d.toString())}else if(typeof d!="string")throw Error(Zy+d);if(d.charCodeAt(0)===45?(d=d.slice(1),p.s=-1):p.s=1,FGe.test(d))jZ(p,d);else throw Error(Zy+d)}if(a.prototype=Jr,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=Ple,a.config=a.set=zGe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function zGe(e){if(!e||typeof e!="object")throw Error(Au+"Object expected");var t,r,n,a=["precision",1,Ob,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Rb(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(Zy+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Zy+r+": "+n);return this}var A$=Ple(LGe);Ic=new A$(1);const gs=A$;function BGe(e){return qGe(e)||UGe(e)||VGe(e)||$Ge()}function $Ge(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VGe(e,t){if(e){if(typeof e=="string")return tz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tz(e,t)}}function UGe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function qGe(e){if(Array.isArray(e))return tz(e)}function tz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var GGe=function(t){return t},Nle={},Ile=function(t){return t===Nle},CZ=function(t){return function r(){return arguments.length===0||arguments.length===1&&Ile(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},WGe=function e(t,r){return t===1?r:CZ(function(){for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];var p=a.filter(function(s){return s!==Nle}).length;return p>=t?r.apply(void 0,a):e(t-p,CZ(function(){for(var s=arguments.length,_=new Array(s),b=0;b<s;b++)_[b]=arguments[b];var T=a.map(function(C){return Ile(C)?_.shift():C});return r.apply(void 0,BGe(T).concat(_))}))})},qk=function(t){return WGe(t.length,t)},rz=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},HGe=qk(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),ZGe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return GGe;var a=r.reverse(),d=a[0],p=a.slice(1);return function(){return p.reduce(function(s,_){return _(s)},d.apply(void 0,arguments))}},nz=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},kle=function(t){var r=null,n=null;return function(){for(var a=arguments.length,d=new Array(a),p=0;p<a;p++)d[p]=arguments[p];return r&&d.every(function(s,_){return s===r[_]})||(r=d,n=t.apply(void 0,d)),n}};function XGe(e){var t;return e===0?t=1:t=Math.floor(new gs(e).abs().log(10).toNumber())+1,t}function KGe(e,t,r){for(var n=new gs(e),a=0,d=[];n.lt(t)&&a<1e5;)d.push(n.toNumber()),n=n.add(r),a++;return d}var YGe=qk(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),JGe=qk(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),QGe=qk(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const Gk={rangeStep:KGe,getDigitCount:XGe,interpolateNumber:YGe,uninterpolateNumber:JGe,uninterpolateTruncation:QGe};function iz(e){return rWe(e)||tWe(e)||Ole(e)||eWe()}function eWe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tWe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function rWe(e){if(Array.isArray(e))return sz(e)}function i2(e,t){return sWe(e)||iWe(e,t)||Ole(e,t)||nWe()}function nWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ole(e,t){if(e){if(typeof e=="string")return sz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sz(e,t)}}function sz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iWe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,d=void 0;try{for(var p=e[Symbol.iterator](),s;!(n=(s=p.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(_){a=!0,d=_}finally{try{!n&&p.return!=null&&p.return()}finally{if(a)throw d}}return r}}function sWe(e){if(Array.isArray(e))return e}function Rle(e){var t=i2(e,2),r=t[0],n=t[1],a=r,d=n;return r>n&&(a=n,d=r),[a,d]}function Mle(e,t,r){if(e.lte(0))return new gs(0);var n=Gk.getDigitCount(e.toNumber()),a=new gs(10).pow(n),d=e.div(a),p=n!==1?.05:.1,s=new gs(Math.ceil(d.div(p).toNumber())).add(r).mul(p),_=s.mul(a);return t?_:new gs(Math.ceil(_))}function aWe(e,t,r){var n=1,a=new gs(e);if(!a.isint()&&r){var d=Math.abs(e);d<1?(n=new gs(10).pow(Gk.getDigitCount(e)-1),a=new gs(Math.floor(a.div(n).toNumber())).mul(n)):d>1&&(a=new gs(Math.floor(e)))}else e===0?a=new gs(Math.floor((t-1)/2)):r||(a=new gs(Math.floor(e)));var p=Math.floor((t-1)/2),s=ZGe(HGe(function(_){return a.add(new gs(_-p).mul(n)).toNumber()}),rz);return s(0,t)}function Dle(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new gs(0),tickMin:new gs(0),tickMax:new gs(0)};var d=Mle(new gs(t).sub(e).div(r-1),n,a),p;e<=0&&t>=0?p=new gs(0):(p=new gs(e).add(t).div(2),p=p.sub(new gs(p).mod(d)));var s=Math.ceil(p.sub(e).div(d).toNumber()),_=Math.ceil(new gs(t).sub(p).div(d).toNumber()),b=s+_+1;return b>r?Dle(e,t,r,n,a+1):(b<r&&(_=t>0?_+(r-b):_,s=t>0?s:s+(r-b)),{step:d,tickMin:p.sub(new gs(s).mul(d)),tickMax:p.add(new gs(_).mul(d))})}function oWe(e){var t=i2(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Math.max(a,2),s=Rle([r,n]),_=i2(s,2),b=_[0],T=_[1];if(b===-1/0||T===1/0){var C=T===1/0?[b].concat(iz(rz(0,a-1).map(function(){return 1/0}))):[].concat(iz(rz(0,a-1).map(function(){return-1/0})),[T]);return r>n?nz(C):C}if(b===T)return aWe(b,a,d);var P=Dle(b,T,p,d),k=P.step,B=P.tickMin,R=P.tickMax,D=Gk.rangeStep(B,R.add(new gs(.1).mul(k)),k);return r>n?nz(D):D}function lWe(e,t){var r=i2(e,2),n=r[0],a=r[1],d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=Rle([n,a]),s=i2(p,2),_=s[0],b=s[1];if(_===-1/0||b===1/0)return[n,a];if(_===b)return[_];var T=Math.max(t,2),C=Mle(new gs(b).sub(_).div(T-1),d,0),P=[].concat(iz(Gk.rangeStep(new gs(_),new gs(b).sub(new gs(.99).mul(C)),C)),[b]);return n>a?nz(P):P}var cWe=kle(oWe),uWe=kle(lWe),dWe="Invariant failed";function fv(e,t){throw new Error(dWe)}var hWe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function B0(e){"@babel/helpers - typeof";return B0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B0(e)}function CN(){return CN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},CN.apply(this,arguments)}function fWe(e,t){return yWe(e)||gWe(e,t)||mWe(e,t)||pWe()}function pWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mWe(e,t){if(e){if(typeof e=="string")return PZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PZ(e,t)}}function PZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gWe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function yWe(e){if(Array.isArray(e))return e}function vWe(e,t){if(e==null)return{};var r=_We(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _We(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function xWe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bWe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zle(n.key),n)}}function wWe(e,t,r){return t&&bWe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function SWe(e,t,r){return t=PN(t),TWe(e,Lle()?Reflect.construct(t,r||[],PN(e).constructor):t.apply(e,r))}function TWe(e,t){if(t&&(B0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EWe(e)}function EWe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lle=function(){return!!e})()}function PN(e){return PN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},PN(e)}function jWe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&az(e,t)}function az(e,t){return az=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},az(e,t)}function Fle(e,t,r){return t=zle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zle(e){var t=AWe(e,"string");return B0(t)=="symbol"?t:t+""}function AWe(e,t){if(B0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(B0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pE=function(e){function t(){return xWe(this,t),SWe(this,t,arguments)}return jWe(t,e),wWe(t,[{key:"render",value:function(){var n=this.props,a=n.offset,d=n.layout,p=n.width,s=n.dataKey,_=n.data,b=n.dataPointFormatter,T=n.xAxis,C=n.yAxis,P=vWe(n,hWe),k=pn(P,!1);this.props.direction==="x"&&T.type!=="number"&&fv();var B=_.map(function(R){var D=b(R,s),G=D.x,V=D.y,$=D.value,K=D.errorVal;if(!K)return null;var Y=[],ee,ae;if(Array.isArray(K)){var ie=fWe(K,2);ee=ie[0],ae=ie[1]}else ee=ae=K;if(d==="vertical"){var ge=T.scale,fe=V+a,be=fe+p,ue=fe-p,Ce=ge($-ee),ve=ge($+ae);Y.push({x1:ve,y1:be,x2:ve,y2:ue}),Y.push({x1:Ce,y1:fe,x2:ve,y2:fe}),Y.push({x1:Ce,y1:be,x2:Ce,y2:ue})}else if(d==="horizontal"){var ze=C.scale,Me=G+a,Be=Me-p,Ve=Me+p,We=ze($-ee),Ee=ze($+ae);Y.push({x1:Be,y1:Ee,x2:Ve,y2:Ee}),Y.push({x1:Me,y1:We,x2:Me,y2:Ee}),Y.push({x1:Be,y1:We,x2:Ve,y2:We})}return De.createElement(vi,CN({className:"recharts-errorBar",key:"bar-".concat(Y.map(function(ot){return"".concat(ot.x1,"-").concat(ot.x2,"-").concat(ot.y1,"-").concat(ot.y2)}))},k),Y.map(function(ot){return De.createElement("line",CN({},ot,{key:"line-".concat(ot.x1,"-").concat(ot.x2,"-").concat(ot.y1,"-").concat(ot.y2)}))}))});return De.createElement(vi,{className:"recharts-errorBars"},B)}}])}(De.Component);Fle(pE,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Fle(pE,"displayName","ErrorBar");function s2(e){"@babel/helpers - typeof";return s2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s2(e)}function NZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function oy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NZ(Object(r),!0).forEach(function(n){CWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CWe(e,t,r){return t=PWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PWe(e){var t=NWe(e,"string");return s2(t)=="symbol"?t:t+""}function NWe(e,t){if(s2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(s2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ble=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,d=t.legendContent,p=jc(r,Qx);if(!p)return null;var s=Qx.defaultProps,_=s!==void 0?oy(oy({},s),p.props):{},b;return p.props&&p.props.payload?b=p.props&&p.props.payload:d==="children"?b=(n||[]).reduce(function(T,C){var P=C.item,k=C.props,B=k.sectors||k.data||[];return T.concat(B.map(function(R){return{type:p.props.iconType||P.props.legendType,value:R.name,color:R.fill,payload:R}}))},[]):b=(n||[]).map(function(T){var C=T.item,P=C.type.defaultProps,k=P!==void 0?oy(oy({},P),C.props):{},B=k.dataKey,R=k.name,D=k.legendType,G=k.hide;return{inactive:G,dataKey:B,type:_.iconType||D||"square",color:C$(C),value:R||B,payload:k}}),oy(oy(oy({},_),Qx.getWithHeight(p,a)),{},{payload:b,item:p})};function a2(e){"@babel/helpers - typeof";return a2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a2(e)}function IZ(e){return RWe(e)||OWe(e)||kWe(e)||IWe()}function IWe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kWe(e,t){if(e){if(typeof e=="string")return oz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oz(e,t)}}function OWe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function RWe(e){if(Array.isArray(e))return oz(e)}function oz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ma(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kZ(Object(r),!0).forEach(function(n){t0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function t0(e,t,r){return t=MWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function MWe(e){var t=DWe(e,"string");return a2(t)=="symbol"?t:t+""}function DWe(e,t){if(a2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(a2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ba(e,t,r){return qn(e)||qn(t)?r:ro(t)?Lc(e,t,r):On(t)?t(e):r}function QS(e,t,r,n){var a=OGe(e,function(s){return ba(s,t)});if(r==="number"){var d=a.filter(function(s){return br(s)||parseFloat(s)});return d.length?[Uk(d),fm(d)]:[1/0,-1/0]}var p=n?a.filter(function(s){return!qn(s)}):a;return p.map(function(s){return ro(s)||s instanceof Date?s:""})}var LWe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,p=-1,s=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(s<=1)return 0;if(d&&d.axisType==="angleAxis"&&Math.abs(Math.abs(d.range[1]-d.range[0])-360)<=1e-6)for(var _=d.range,b=0;b<s;b++){var T=b>0?a[b-1].coordinate:a[s-1].coordinate,C=a[b].coordinate,P=b>=s-1?a[0].coordinate:a[b+1].coordinate,k=void 0;if(Dl(C-T)!==Dl(P-C)){var B=[];if(Dl(P-C)===Dl(_[1]-_[0])){k=P;var R=C+_[1]-_[0];B[0]=Math.min(R,(R+T)/2),B[1]=Math.max(R,(R+T)/2)}else{k=T;var D=P+_[1]-_[0];B[0]=Math.min(C,(D+C)/2),B[1]=Math.max(C,(D+C)/2)}var G=[Math.min(C,(k+C)/2),Math.max(C,(k+C)/2)];if(t>G[0]&&t<=G[1]||t>=B[0]&&t<=B[1]){p=a[b].index;break}}else{var V=Math.min(T,P),$=Math.max(T,P);if(t>(V+C)/2&&t<=($+C)/2){p=a[b].index;break}}}else for(var K=0;K<s;K++)if(K===0&&t<=(n[K].coordinate+n[K+1].coordinate)/2||K>0&&K<s-1&&t>(n[K].coordinate+n[K-1].coordinate)/2&&t<=(n[K].coordinate+n[K+1].coordinate)/2||K===s-1&&t>(n[K].coordinate+n[K-1].coordinate)/2){p=n[K].index;break}return p},C$=function(t){var r,n=t,a=n.type.displayName,d=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,p=d.stroke,s=d.fill,_;switch(a){case"Line":_=p;break;case"Area":case"Radar":_=p&&p!=="none"?p:s;break;default:_=s;break}return _},FWe=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,d=a===void 0?{}:a;if(!d)return{};for(var p={},s=Object.keys(d),_=0,b=s.length;_<b;_++)for(var T=d[s[_]].stackGroups,C=Object.keys(T),P=0,k=C.length;P<k;P++){var B=T[C[P]],R=B.items,D=B.cateAxisId,G=R.filter(function(ae){return jf(ae.type).indexOf("Bar")>=0});if(G&&G.length){var V=G[0].type.defaultProps,$=V!==void 0?ma(ma({},V),G[0].props):G[0].props,K=$.barSize,Y=$[D];p[Y]||(p[Y]=[]);var ee=qn(K)?r:K;p[Y].push({item:G[0],stackList:G.slice(1),barSize:qn(ee)?void 0:Ll(ee,n,0)})}}return p},zWe=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,d=t.sizeList,p=d===void 0?[]:d,s=t.maxBarSize,_=p.length;if(_<1)return null;var b=Ll(r,a,0,!0),T,C=[];if(p[0].barSize===+p[0].barSize){var P=!1,k=a/_,B=p.reduce(function(K,Y){return K+Y.barSize||0},0);B+=(_-1)*b,B>=a&&(B-=(_-1)*b,b=0),B>=a&&k>0&&(P=!0,k*=.9,B=_*k);var R=(a-B)/2>>0,D={offset:R-b,size:0};T=p.reduce(function(K,Y){var ee={item:Y.item,position:{offset:D.offset+D.size+b,size:P?k:Y.barSize}},ae=[].concat(IZ(K),[ee]);return D=ae[ae.length-1].position,Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(ie){ae.push({item:ie,position:D})}),ae},C)}else{var G=Ll(n,a,0,!0);a-2*G-(_-1)*b<=0&&(b=0);var V=(a-2*G-(_-1)*b)/_;V>1&&(V>>=0);var $=s===+s?Math.min(V,s):V;T=p.reduce(function(K,Y,ee){var ae=[].concat(IZ(K),[{item:Y.item,position:{offset:G+(V+b)*ee+(V-$)/2,size:$}}]);return Y.stackList&&Y.stackList.length&&Y.stackList.forEach(function(ie){ae.push({item:ie,position:ae[ae.length-1].position})}),ae},C)}return T},BWe=function(t,r,n,a){var d=n.children,p=n.width,s=n.margin,_=p-(s.left||0)-(s.right||0),b=Ble({children:d,legendWidth:_});if(b){var T=a||{},C=T.width,P=T.height,k=b.align,B=b.verticalAlign,R=b.layout;if((R==="vertical"||R==="horizontal"&&B==="middle")&&k!=="center"&&br(t[k]))return ma(ma({},t),{},t0({},k,t[k]+(C||0)));if((R==="horizontal"||R==="vertical"&&k==="center")&&B!=="middle"&&br(t[B]))return ma(ma({},t),{},t0({},B,t[B]+(P||0)))}return t},$We=function(t,r,n){return qn(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},$le=function(t,r,n,a,d){var p=r.props.children,s=Fc(p,pE).filter(function(b){return $We(a,d,b.props.direction)});if(s&&s.length){var _=s.map(function(b){return b.props.dataKey});return t.reduce(function(b,T){var C=ba(T,n);if(qn(C))return b;var P=Array.isArray(C)?[Uk(C),fm(C)]:[C,C],k=_.reduce(function(B,R){var D=ba(T,R,0),G=P[0]-Math.abs(Array.isArray(D)?D[0]:D),V=P[1]+Math.abs(Array.isArray(D)?D[1]:D);return[Math.min(G,B[0]),Math.max(V,B[1])]},[1/0,-1/0]);return[Math.min(k[0],b[0]),Math.max(k[1],b[1])]},[1/0,-1/0])}return null},VWe=function(t,r,n,a,d){var p=r.map(function(s){return $le(t,s,n,d,a)}).filter(function(s){return!qn(s)});return p&&p.length?p.reduce(function(s,_){return[Math.min(s[0],_[0]),Math.max(s[1],_[1])]},[1/0,-1/0]):null},Vle=function(t,r,n,a,d){var p=r.map(function(_){var b=_.props.dataKey;return n==="number"&&b&&$le(t,_,b,a)||QS(t,b,n,d)});if(n==="number")return p.reduce(function(_,b){return[Math.min(_[0],b[0]),Math.max(_[1],b[1])]},[1/0,-1/0]);var s={};return p.reduce(function(_,b){for(var T=0,C=b.length;T<C;T++)s[b[T]]||(s[b[T]]=!0,_.push(b[T]));return _},[])},Ule=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},qle=function(t,r,n,a){if(a)return t.map(function(_){return _.coordinate});var d,p,s=t.map(function(_){return _.coordinate===r&&(d=!0),_.coordinate===n&&(p=!0),_.coordinate});return d||s.push(r),p||s.push(n),s},bf=function(t,r,n){if(!t)return null;var a=t.scale,d=t.duplicateDomain,p=t.type,s=t.range,_=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,b=(r||n)&&p==="category"&&a.bandwidth?a.bandwidth()/_:0;if(b=t.axisType==="angleAxis"&&(s==null?void 0:s.length)>=2?Dl(s[0]-s[1])*2*b:b,r&&(t.ticks||t.niceTicks)){var T=(t.ticks||t.niceTicks).map(function(C){var P=d?d.indexOf(C):C;return{coordinate:a(P)+b,value:C,offset:b}});return T.filter(function(C){return!Cb(C.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(C,P){return{coordinate:a(C)+b,value:C,index:P,offset:b}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(C){return{coordinate:a(C)+b,value:C,offset:b}}):a.domain().map(function(C,P){return{coordinate:a(C)+b,value:d?d[C]:C,index:P,offset:b}})},QD=new WeakMap,NC=function(t,r){if(typeof r!="function")return t;QD.has(t)||QD.set(t,new WeakMap);var n=QD.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},Gle=function(t,r,n){var a=t.scale,d=t.type,p=t.layout,s=t.axisType;if(a==="auto")return p==="radial"&&s==="radiusAxis"?{scale:JT(),realScaleType:"band"}:p==="radial"&&s==="angleAxis"?{scale:SN(),realScaleType:"linear"}:d==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:JS(),realScaleType:"point"}:d==="category"?{scale:JT(),realScaleType:"band"}:{scale:SN(),realScaleType:"linear"};if(lv(a)){var _="scale".concat(Pk(a));return{scale:(EZ[_]||JS)(),realScaleType:EZ[_]?_:"point"}}return On(a)?{scale:a}:{scale:JS(),realScaleType:"point"}},OZ=1e-4,Wle=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),d=Math.min(a[0],a[1])-OZ,p=Math.max(a[0],a[1])+OZ,s=t(r[0]),_=t(r[n-1]);(s<d||s>p||_<d||_>p)&&t.domain([r[0],r[n-1]])}},UWe=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},qWe=function(t,r){if(!r||r.length!==2||!br(r[0])||!br(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),d=[t[0],t[1]];return(!br(t[0])||t[0]<n)&&(d[0]=n),(!br(t[1])||t[1]>a)&&(d[1]=a),d[0]>a&&(d[0]=a),d[1]<n&&(d[1]=n),d},GWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var d=0,p=0,s=0;s<r;++s){var _=Cb(t[s][n][1])?t[s][n][0]:t[s][n][1];_>=0?(t[s][n][0]=d,t[s][n][1]=d+_,d=t[s][n][1]):(t[s][n][0]=p,t[s][n][1]=p+_,p=t[s][n][1])}},WWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var d=0,p=0;p<r;++p){var s=Cb(t[p][n][1])?t[p][n][0]:t[p][n][1];s>=0?(t[p][n][0]=d,t[p][n][1]=d+s,d=t[p][n][1]):(t[p][n][0]=0,t[p][n][1]=0)}},HWe={sign:GWe,expand:h3e,none:k0,silhouette:f3e,wiggle:p3e,positive:WWe},ZWe=function(t,r,n){var a=r.map(function(s){return s.props.dataKey}),d=HWe[n],p=d3e().keys(a).value(function(s,_){return+ba(s,_,0)}).order(kF).offset(d);return p(t)},XWe=function(t,r,n,a,d,p){if(!t)return null;var s=p?r.reverse():r,_={},b=s.reduce(function(C,P){var k,B=(k=P.type)!==null&&k!==void 0&&k.defaultProps?ma(ma({},P.type.defaultProps),P.props):P.props,R=B.stackId,D=B.hide;if(D)return C;var G=B[n],V=C[G]||{hasStack:!1,stackGroups:{}};if(ro(R)){var $=V.stackGroups[R]||{numericAxisId:n,cateAxisId:a,items:[]};$.items.push(P),V.hasStack=!0,V.stackGroups[R]=$}else V.stackGroups[jv("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[P]};return ma(ma({},C),{},t0({},G,V))},_),T={};return Object.keys(b).reduce(function(C,P){var k=b[P];if(k.hasStack){var B={};k.stackGroups=Object.keys(k.stackGroups).reduce(function(R,D){var G=k.stackGroups[D];return ma(ma({},R),{},t0({},D,{numericAxisId:n,cateAxisId:a,items:G.items,stackedData:ZWe(t,G.items,d)}))},B)}return ma(ma({},C),{},t0({},P,k))},T)},Hle=function(t,r){var n=r.realScaleType,a=r.type,d=r.tickCount,p=r.originalDomain,s=r.allowDecimals,_=n||r.scale;if(_!=="auto"&&_!=="linear")return null;if(d&&a==="number"&&p&&(p[0]==="auto"||p[1]==="auto")){var b=t.domain();if(!b.length)return null;var T=cWe(b,d,s);return t.domain([Uk(T),fm(T)]),{niceTicks:T}}if(d&&a==="number"){var C=t.domain(),P=uWe(C,d,s);return{niceTicks:P}}return null};function NN(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,d=e.index,p=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!qn(a[t.dataKey])){var s=rN(r,"value",a[t.dataKey]);if(s)return s.coordinate+n/2}return r[d]?r[d].coordinate+n/2:null}var _=ba(a,qn(p)?t.dataKey:p);return qn(_)?null:t.scale(_)}var RZ=function(t){var r=t.axis,n=t.ticks,a=t.offset,d=t.bandSize,p=t.entry,s=t.index;if(r.type==="category")return n[s]?n[s].coordinate+a:null;var _=ba(p,r.dataKey,r.domain[s]);return qn(_)?null:r.scale(_)-d/2+a},KWe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),d=Math.max(n[0],n[1]);return a<=0&&d>=0?0:d<0?d:a}return n[0]},YWe=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,d=a.stackId;if(ro(d)){var p=r[d];if(p){var s=p.items.indexOf(t);return s>=0?p.stackedData[s]:null}}return null},JWe=function(t){return t.reduce(function(r,n){return[Uk(n.concat([r[0]]).filter(br)),fm(n.concat([r[1]]).filter(br))]},[1/0,-1/0])},Zle=function(t,r,n){return Object.keys(t).reduce(function(a,d){var p=t[d],s=p.stackedData,_=s.reduce(function(b,T){var C=JWe(T.slice(r,n+1));return[Math.min(b[0],C[0]),Math.max(b[1],C[1])]},[1/0,-1/0]);return[Math.min(_[0],a[0]),Math.max(_[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},MZ=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,DZ=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,lz=function(t,r,n){if(On(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(br(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(MZ.test(t[0])){var d=+MZ.exec(t[0])[1];a[0]=r[0]-d}else On(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(br(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(DZ.test(t[1])){var p=+DZ.exec(t[1])[1];a[1]=r[1]+p}else On(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},IN=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var d=r$(r,function(C){return C.coordinate}),p=1/0,s=1,_=d.length;s<_;s++){var b=d[s],T=d[s-1];p=Math.min((b.coordinate||0)-(T.coordinate||0),p)}return p===1/0?0:p}return n?void 0:0},LZ=function(t,r,n){return!t||!t.length||dv(t,Lc(n,"type.defaultProps.domain"))?r:t},Xle=function(t,r){var n=t.type.defaultProps?ma(ma({},t.type.defaultProps),t.props):t.props,a=n.dataKey,d=n.name,p=n.unit,s=n.formatter,_=n.tooltipType,b=n.chartType,T=n.hide;return ma(ma({},pn(t,!1)),{},{dataKey:a,unit:p,formatter:s,name:d||a,color:C$(t),value:ba(r,a),type:_,payload:r,chartType:b,hide:T})};function o2(e){"@babel/helpers - typeof";return o2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o2(e)}function FZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ff(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FZ(Object(r),!0).forEach(function(n){Kle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kle(e,t,r){return t=QWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QWe(e){var t=e9e(e,"string");return o2(t)=="symbol"?t:t+""}function e9e(e,t){if(o2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(o2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function t9e(e,t){return s9e(e)||i9e(e,t)||n9e(e,t)||r9e()}function r9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n9e(e,t){if(e){if(typeof e=="string")return zZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zZ(e,t)}}function zZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function s9e(e){if(Array.isArray(e))return e}var kN=Math.PI/180,a9e=function(t){return t*180/Math.PI},Es=function(t,r,n,a){return{x:t+Math.cos(-kN*a)*n,y:r+Math.sin(-kN*a)*n}},Yle=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},o9e=function(t,r,n,a,d){var p=t.width,s=t.height,_=t.startAngle,b=t.endAngle,T=Ll(t.cx,p,p/2),C=Ll(t.cy,s,s/2),P=Yle(p,s,n),k=Ll(t.innerRadius,P,0),B=Ll(t.outerRadius,P,P*.8),R=Object.keys(r);return R.reduce(function(D,G){var V=r[G],$=V.domain,K=V.reversed,Y;if(qn(V.range))a==="angleAxis"?Y=[_,b]:a==="radiusAxis"&&(Y=[k,B]),K&&(Y=[Y[1],Y[0]]);else{Y=V.range;var ee=Y,ae=t9e(ee,2);_=ae[0],b=ae[1]}var ie=Gle(V,d),ge=ie.realScaleType,fe=ie.scale;fe.domain($).range(Y),Wle(fe);var be=Hle(fe,ff(ff({},V),{},{realScaleType:ge})),ue=ff(ff(ff({},V),be),{},{range:Y,radius:B,realScaleType:ge,scale:fe,cx:T,cy:C,innerRadius:k,outerRadius:B,startAngle:_,endAngle:b});return ff(ff({},D),{},Kle({},G,ue))},{})},l9e=function(t,r){var n=t.x,a=t.y,d=r.x,p=r.y;return Math.sqrt(Math.pow(n-d,2)+Math.pow(a-p,2))},c9e=function(t,r){var n=t.x,a=t.y,d=r.cx,p=r.cy,s=l9e({x:n,y:a},{x:d,y:p});if(s<=0)return{radius:s};var _=(n-d)/s,b=Math.acos(_);return a>p&&(b=2*Math.PI-b),{radius:s,angle:a9e(b),angleInRadian:b}},u9e=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),d=Math.floor(n/360),p=Math.min(a,d);return{startAngle:r-p*360,endAngle:n-p*360}},d9e=function(t,r){var n=r.startAngle,a=r.endAngle,d=Math.floor(n/360),p=Math.floor(a/360),s=Math.min(d,p);return t+s*360},BZ=function(t,r){var n=t.x,a=t.y,d=c9e({x:n,y:a},r),p=d.radius,s=d.angle,_=r.innerRadius,b=r.outerRadius;if(p<_||p>b)return!1;if(p===0)return!0;var T=u9e(r),C=T.startAngle,P=T.endAngle,k=s,B;if(C<=P){for(;k>P;)k-=360;for(;k<C;)k+=360;B=k>=C&&k<=P}else{for(;k>C;)k-=360;for(;k<P;)k+=360;B=k>=P&&k<=C}return B?ff(ff({},r),{},{radius:p,angle:d9e(k,r)}):null},Jle=function(t){return!F.isValidElement(t)&&!On(t)&&typeof t!="boolean"?t.className:""};function l2(e){"@babel/helpers - typeof";return l2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l2(e)}var h9e=["offset"];function f9e(e){return y9e(e)||g9e(e)||m9e(e)||p9e()}function p9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m9e(e,t){if(e){if(typeof e=="string")return cz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cz(e,t)}}function g9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function y9e(e){if(Array.isArray(e))return cz(e)}function cz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v9e(e,t){if(e==null)return{};var r=_9e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function $Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Za(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$Z(Object(r),!0).forEach(function(n){x9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$Z(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x9e(e,t,r){return t=b9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b9e(e){var t=w9e(e,"string");return l2(t)=="symbol"?t:t+""}function w9e(e,t){if(l2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(l2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c2(){return c2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c2.apply(this,arguments)}var S9e=function(t){var r=t.value,n=t.formatter,a=qn(t.children)?r:t.children;return On(n)?n(a):a},T9e=function(t,r){var n=Dl(r-t),a=Math.min(Math.abs(r-t),360);return n*a},E9e=function(t,r,n){var a=t.position,d=t.viewBox,p=t.offset,s=t.className,_=d,b=_.cx,T=_.cy,C=_.innerRadius,P=_.outerRadius,k=_.startAngle,B=_.endAngle,R=_.clockWise,D=(C+P)/2,G=T9e(k,B),V=G>=0?1:-1,$,K;a==="insideStart"?($=k+V*p,K=R):a==="insideEnd"?($=B-V*p,K=!R):a==="end"&&($=B+V*p,K=R),K=G<=0?K:!K;var Y=Es(b,T,D,$),ee=Es(b,T,D,$+(K?1:-1)*359),ae="M".concat(Y.x,",").concat(Y.y,`
    A`).concat(D,",").concat(D,",0,1,").concat(K?0:1,`,
    `).concat(ee.x,",").concat(ee.y),ie=qn(t.id)?jv("recharts-radial-line-"):t.id;return De.createElement("text",c2({},n,{dominantBaseline:"central",className:Zn("recharts-radial-bar-label",s)}),De.createElement("defs",null,De.createElement("path",{id:ie,d:ae})),De.createElement("textPath",{xlinkHref:"#".concat(ie)},r))},j9e=function(t){var r=t.viewBox,n=t.offset,a=t.position,d=r,p=d.cx,s=d.cy,_=d.innerRadius,b=d.outerRadius,T=d.startAngle,C=d.endAngle,P=(T+C)/2;if(a==="outside"){var k=Es(p,s,b+n,P),B=k.x,R=k.y;return{x:B,y:R,textAnchor:B>=p?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:p,y:s,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:p,y:s,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:p,y:s,textAnchor:"middle",verticalAnchor:"end"};var D=(_+b)/2,G=Es(p,s,D,P),V=G.x,$=G.y;return{x:V,y:$,textAnchor:"middle",verticalAnchor:"middle"}},A9e=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,d=t.position,p=r,s=p.x,_=p.y,b=p.width,T=p.height,C=T>=0?1:-1,P=C*a,k=C>0?"end":"start",B=C>0?"start":"end",R=b>=0?1:-1,D=R*a,G=R>0?"end":"start",V=R>0?"start":"end";if(d==="top"){var $={x:s+b/2,y:_-C*a,textAnchor:"middle",verticalAnchor:k};return Za(Za({},$),n?{height:Math.max(_-n.y,0),width:b}:{})}if(d==="bottom"){var K={x:s+b/2,y:_+T+P,textAnchor:"middle",verticalAnchor:B};return Za(Za({},K),n?{height:Math.max(n.y+n.height-(_+T),0),width:b}:{})}if(d==="left"){var Y={x:s-D,y:_+T/2,textAnchor:G,verticalAnchor:"middle"};return Za(Za({},Y),n?{width:Math.max(Y.x-n.x,0),height:T}:{})}if(d==="right"){var ee={x:s+b+D,y:_+T/2,textAnchor:V,verticalAnchor:"middle"};return Za(Za({},ee),n?{width:Math.max(n.x+n.width-ee.x,0),height:T}:{})}var ae=n?{width:b,height:T}:{};return d==="insideLeft"?Za({x:s+D,y:_+T/2,textAnchor:V,verticalAnchor:"middle"},ae):d==="insideRight"?Za({x:s+b-D,y:_+T/2,textAnchor:G,verticalAnchor:"middle"},ae):d==="insideTop"?Za({x:s+b/2,y:_+P,textAnchor:"middle",verticalAnchor:B},ae):d==="insideBottom"?Za({x:s+b/2,y:_+T-P,textAnchor:"middle",verticalAnchor:k},ae):d==="insideTopLeft"?Za({x:s+D,y:_+P,textAnchor:V,verticalAnchor:B},ae):d==="insideTopRight"?Za({x:s+b-D,y:_+P,textAnchor:G,verticalAnchor:B},ae):d==="insideBottomLeft"?Za({x:s+D,y:_+T-P,textAnchor:V,verticalAnchor:k},ae):d==="insideBottomRight"?Za({x:s+b-D,y:_+T-P,textAnchor:G,verticalAnchor:k},ae):Tb(d)&&(br(d.x)||Py(d.x))&&(br(d.y)||Py(d.y))?Za({x:s+Ll(d.x,b),y:_+Ll(d.y,T),textAnchor:"end",verticalAnchor:"end"},ae):Za({x:s+b/2,y:_+T/2,textAnchor:"middle",verticalAnchor:"middle"},ae)},C9e=function(t){return"cx"in t&&br(t.cx)};function vo(e){var t=e.offset,r=t===void 0?5:t,n=v9e(e,h9e),a=Za({offset:r},n),d=a.viewBox,p=a.position,s=a.value,_=a.children,b=a.content,T=a.className,C=T===void 0?"":T,P=a.textBreakAll;if(!d||qn(s)&&qn(_)&&!F.isValidElement(b)&&!On(b))return null;if(F.isValidElement(b))return F.cloneElement(b,a);var k;if(On(b)){if(k=F.createElement(b,a),F.isValidElement(k))return k}else k=S9e(a);var B=C9e(d),R=pn(a,!0);if(B&&(p==="insideStart"||p==="insideEnd"||p==="end"))return E9e(a,k,R);var D=B?j9e(a):A9e(a);return De.createElement(uv,c2({className:Zn("recharts-label",C)},R,D,{breakAll:P}),k)}vo.displayName="Label";var Qle=function(t){var r=t.cx,n=t.cy,a=t.angle,d=t.startAngle,p=t.endAngle,s=t.r,_=t.radius,b=t.innerRadius,T=t.outerRadius,C=t.x,P=t.y,k=t.top,B=t.left,R=t.width,D=t.height,G=t.clockWise,V=t.labelViewBox;if(V)return V;if(br(R)&&br(D)){if(br(C)&&br(P))return{x:C,y:P,width:R,height:D};if(br(k)&&br(B))return{x:k,y:B,width:R,height:D}}return br(C)&&br(P)?{x:C,y:P,width:0,height:0}:br(r)&&br(n)?{cx:r,cy:n,startAngle:d||a||0,endAngle:p||a||0,innerRadius:b||0,outerRadius:T||_||s||0,clockWise:G}:t.viewBox?t.viewBox:{}},P9e=function(t,r){return t?t===!0?De.createElement(vo,{key:"label-implicit",viewBox:r}):ro(t)?De.createElement(vo,{key:"label-implicit",viewBox:r,value:t}):F.isValidElement(t)?t.type===vo?F.cloneElement(t,{key:"label-implicit",viewBox:r}):De.createElement(vo,{key:"label-implicit",content:t,viewBox:r}):On(t)?De.createElement(vo,{key:"label-implicit",content:t,viewBox:r}):Tb(t)?De.createElement(vo,c2({viewBox:r},t,{key:"label-implicit"})):null:null},N9e=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,d=Qle(t),p=Fc(a,vo).map(function(_,b){return F.cloneElement(_,{viewBox:r||d,key:"label-".concat(b)})});if(!n)return p;var s=P9e(t.label,r||d);return[s].concat(f9e(p))};vo.parseViewBox=Qle;vo.renderCallByParent=N9e;function I9e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var k9e=I9e;const O9e=es(k9e);function u2(e){"@babel/helpers - typeof";return u2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u2(e)}var R9e=["valueAccessor"],M9e=["data","dataKey","clockWise","id","textBreakAll"];function D9e(e){return B9e(e)||z9e(e)||F9e(e)||L9e()}function L9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F9e(e,t){if(e){if(typeof e=="string")return uz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uz(e,t)}}function z9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function B9e(e){if(Array.isArray(e))return uz(e)}function uz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ON(){return ON=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ON.apply(this,arguments)}function VZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function UZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VZ(Object(r),!0).forEach(function(n){$9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $9e(e,t,r){return t=V9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function V9e(e){var t=U9e(e,"string");return u2(t)=="symbol"?t:t+""}function U9e(e,t){if(u2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(u2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qZ(e,t){if(e==null)return{};var r=q9e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function q9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var G9e=function(t){return Array.isArray(t.value)?O9e(t.value):t.value};function Th(e){var t=e.valueAccessor,r=t===void 0?G9e:t,n=qZ(e,R9e),a=n.data,d=n.dataKey,p=n.clockWise,s=n.id,_=n.textBreakAll,b=qZ(n,M9e);return!a||!a.length?null:De.createElement(vi,{className:"recharts-label-list"},a.map(function(T,C){var P=qn(d)?r(T,C):ba(T&&T.payload,d),k=qn(s)?{}:{id:"".concat(s,"-").concat(C)};return De.createElement(vo,ON({},pn(T,!0),b,k,{parentViewBox:T.parentViewBox,value:P,textBreakAll:_,viewBox:vo.parseViewBox(qn(p)?T:UZ(UZ({},T),{},{clockWise:p})),key:"label-".concat(C),index:C}))}))}Th.displayName="LabelList";function W9e(e,t){return e?e===!0?De.createElement(Th,{key:"labelList-implicit",data:t}):De.isValidElement(e)||On(e)?De.createElement(Th,{key:"labelList-implicit",data:t,content:e}):Tb(e)?De.createElement(Th,ON({data:t},e,{key:"labelList-implicit"})):null:null}function H9e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Fc(n,Th).map(function(p,s){return F.cloneElement(p,{data:t,key:"labelList-".concat(s)})});if(!r)return a;var d=W9e(e.label,t);return[d].concat(D9e(a))}Th.renderCallByParent=H9e;function d2(e){"@babel/helpers - typeof";return d2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d2(e)}function dz(){return dz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dz.apply(this,arguments)}function GZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function WZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GZ(Object(r),!0).forEach(function(n){Z9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Z9e(e,t,r){return t=X9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X9e(e){var t=K9e(e,"string");return d2(t)=="symbol"?t:t+""}function K9e(e,t){if(d2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(d2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Y9e=function(t,r){var n=Dl(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},IC=function(t){var r=t.cx,n=t.cy,a=t.radius,d=t.angle,p=t.sign,s=t.isExternal,_=t.cornerRadius,b=t.cornerIsExternal,T=_*(s?1:-1)+a,C=Math.asin(_/T)/kN,P=b?d:d+p*C,k=Es(r,n,T,P),B=Es(r,n,a,P),R=b?d-p*C:d,D=Es(r,n,T*Math.cos(C*kN),R);return{center:k,circleTangency:B,lineTangency:D,theta:C}},ece=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,d=t.outerRadius,p=t.startAngle,s=t.endAngle,_=Y9e(p,s),b=p+_,T=Es(r,n,d,p),C=Es(r,n,d,b),P="M ".concat(T.x,",").concat(T.y,`
    A `).concat(d,",").concat(d,`,0,
    `).concat(+(Math.abs(_)>180),",").concat(+(p>b),`,
    `).concat(C.x,",").concat(C.y,`
  `);if(a>0){var k=Es(r,n,a,p),B=Es(r,n,a,b);P+="L ".concat(B.x,",").concat(B.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(_)>180),",").concat(+(p<=b),`,
            `).concat(k.x,",").concat(k.y," Z")}else P+="L ".concat(r,",").concat(n," Z");return P},J9e=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,d=t.outerRadius,p=t.cornerRadius,s=t.forceCornerRadius,_=t.cornerIsExternal,b=t.startAngle,T=t.endAngle,C=Dl(T-b),P=IC({cx:r,cy:n,radius:d,angle:b,sign:C,cornerRadius:p,cornerIsExternal:_}),k=P.circleTangency,B=P.lineTangency,R=P.theta,D=IC({cx:r,cy:n,radius:d,angle:T,sign:-C,cornerRadius:p,cornerIsExternal:_}),G=D.circleTangency,V=D.lineTangency,$=D.theta,K=_?Math.abs(b-T):Math.abs(b-T)-R-$;if(K<0)return s?"M ".concat(B.x,",").concat(B.y,`
        a`).concat(p,",").concat(p,",0,0,1,").concat(p*2,`,0
        a`).concat(p,",").concat(p,",0,0,1,").concat(-p*2,`,0
      `):ece({cx:r,cy:n,innerRadius:a,outerRadius:d,startAngle:b,endAngle:T});var Y="M ".concat(B.x,",").concat(B.y,`
    A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(k.x,",").concat(k.y,`
    A`).concat(d,",").concat(d,",0,").concat(+(K>180),",").concat(+(C<0),",").concat(G.x,",").concat(G.y,`
    A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(V.x,",").concat(V.y,`
  `);if(a>0){var ee=IC({cx:r,cy:n,radius:a,angle:b,sign:C,isExternal:!0,cornerRadius:p,cornerIsExternal:_}),ae=ee.circleTangency,ie=ee.lineTangency,ge=ee.theta,fe=IC({cx:r,cy:n,radius:a,angle:T,sign:-C,isExternal:!0,cornerRadius:p,cornerIsExternal:_}),be=fe.circleTangency,ue=fe.lineTangency,Ce=fe.theta,ve=_?Math.abs(b-T):Math.abs(b-T)-ge-Ce;if(ve<0&&p===0)return"".concat(Y,"L").concat(r,",").concat(n,"Z");Y+="L".concat(ue.x,",").concat(ue.y,`
      A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(be.x,",").concat(be.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(ve>180),",").concat(+(C>0),",").concat(ae.x,",").concat(ae.y,`
      A`).concat(p,",").concat(p,",0,0,").concat(+(C<0),",").concat(ie.x,",").concat(ie.y,"Z")}else Y+="L".concat(r,",").concat(n,"Z");return Y},Q9e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},tce=function(t){var r=WZ(WZ({},Q9e),t),n=r.cx,a=r.cy,d=r.innerRadius,p=r.outerRadius,s=r.cornerRadius,_=r.forceCornerRadius,b=r.cornerIsExternal,T=r.startAngle,C=r.endAngle,P=r.className;if(p<d||T===C)return null;var k=Zn("recharts-sector",P),B=p-d,R=Ll(s,B,0,!0),D;return R>0&&Math.abs(T-C)<360?D=J9e({cx:n,cy:a,innerRadius:d,outerRadius:p,cornerRadius:Math.min(R,B/2),forceCornerRadius:_,cornerIsExternal:b,startAngle:T,endAngle:C}):D=ece({cx:n,cy:a,innerRadius:d,outerRadius:p,startAngle:T,endAngle:C}),De.createElement("path",dz({},pn(r,!0),{className:k,d:D,role:"img"}))};function h2(e){"@babel/helpers - typeof";return h2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h2(e)}function hz(){return hz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hz.apply(this,arguments)}function HZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ZZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HZ(Object(r),!0).forEach(function(n){eHe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eHe(e,t,r){return t=tHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tHe(e){var t=rHe(e,"string");return h2(t)=="symbol"?t:t+""}function rHe(e,t){if(h2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(h2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XZ={curveBasisClosed:e3e,curveBasisOpen:t3e,curveBasis:QLe,curveBumpX:zLe,curveBumpY:BLe,curveLinearClosed:r3e,curveLinear:Ik,curveMonotoneX:n3e,curveMonotoneY:i3e,curveNatural:s3e,curveStep:a3e,curveStepAfter:l3e,curveStepBefore:o3e},kC=function(t){return t.x===+t.x&&t.y===+t.y},uS=function(t){return t.x},dS=function(t){return t.y},nHe=function(t,r){if(On(t))return t;var n="curve".concat(Pk(t));return(n==="curveMonotone"||n==="curveBump")&&r?XZ["".concat(n).concat(r==="vertical"?"Y":"X")]:XZ[n]||Ik},iHe=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,d=a===void 0?[]:a,p=t.baseLine,s=t.layout,_=t.connectNulls,b=_===void 0?!1:_,T=nHe(n,s),C=b?d.filter(function(R){return kC(R)}):d,P;if(Array.isArray(p)){var k=b?p.filter(function(R){return kC(R)}):p,B=C.map(function(R,D){return ZZ(ZZ({},R),{},{base:k[D]})});return s==="vertical"?P=wC().y(dS).x1(uS).x0(function(R){return R.base.x}):P=wC().x(uS).y1(dS).y0(function(R){return R.base.y}),P.defined(kC).curve(T),P(B)}return s==="vertical"&&br(p)?P=wC().y(dS).x1(uS).x0(p):br(p)?P=wC().x(uS).y1(dS).y0(p):P=Xae().x(uS).y(dS),P.defined(kC).curve(T),P(C)},Xy=function(t){var r=t.className,n=t.points,a=t.path,d=t.pathRef;if((!n||!n.length)&&!a)return null;var p=n&&n.length?iHe(t):a;return F.createElement("path",hz({},pn(t,!1),nN(t),{className:Zn("recharts-curve",r),d:p,ref:d}))},rce={exports:{}},sHe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",aHe=sHe,oHe=aHe;function nce(){}function ice(){}ice.resetWarningCache=nce;var lHe=function(){function e(n,a,d,p,s,_){if(_!==oHe){var b=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw b.name="Invariant Violation",b}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:ice,resetWarningCache:nce};return r.PropTypes=r,r};rce.exports=lHe();var cHe=rce.exports;const rs=es(cHe);var uHe=Object.getOwnPropertyNames,dHe=Object.getOwnPropertySymbols,hHe=Object.prototype.hasOwnProperty;function KZ(e,t){return function(n,a,d){return e(n,a,d)&&t(n,a,d)}}function OC(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);var d=a.cache,p=d.get(r),s=d.get(n);if(p&&s)return p===n&&s===r;d.set(r,n),d.set(n,r);var _=e(r,n,a);return d.delete(r),d.delete(n),_}}function YZ(e){return uHe(e).concat(dHe(e))}var fHe=Object.hasOwn||function(e,t){return hHe.call(e,t)};function Pv(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var pHe="__v",mHe="__o",gHe="_owner",JZ=Object.getOwnPropertyDescriptor,QZ=Object.keys;function yHe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function vHe(e,t){return Pv(e.getTime(),t.getTime())}function _He(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function xHe(e,t){return e===t}function eX(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),d=e.entries(),p,s,_=0;(p=d.next())&&!p.done;){for(var b=t.entries(),T=!1,C=0;(s=b.next())&&!s.done;){if(a[C]){C++;continue}var P=p.value,k=s.value;if(r.equals(P[0],k[0],_,C,e,t,r)&&r.equals(P[1],k[1],P[0],k[0],e,t,r)){T=a[C]=!0;break}C++}if(!T)return!1;_++}return!0}var bHe=Pv;function wHe(e,t,r){var n=QZ(e),a=n.length;if(QZ(t).length!==a)return!1;for(;a-- >0;)if(!sce(e,t,r,n[a]))return!1;return!0}function hS(e,t,r){var n=YZ(e),a=n.length;if(YZ(t).length!==a)return!1;for(var d,p,s;a-- >0;)if(d=n[a],!sce(e,t,r,d)||(p=JZ(e,d),s=JZ(t,d),(p||s)&&(!p||!s||p.configurable!==s.configurable||p.enumerable!==s.enumerable||p.writable!==s.writable)))return!1;return!0}function SHe(e,t){return Pv(e.valueOf(),t.valueOf())}function THe(e,t){return e.source===t.source&&e.flags===t.flags}function tX(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var a=new Array(n),d=e.values(),p,s;(p=d.next())&&!p.done;){for(var _=t.values(),b=!1,T=0;(s=_.next())&&!s.done;){if(!a[T]&&r.equals(p.value,s.value,p.value,s.value,e,t,r)){b=a[T]=!0;break}T++}if(!b)return!1}return!0}function EHe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function jHe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function sce(e,t,r,n){return(n===gHe||n===mHe||n===pHe)&&(e.$$typeof||t.$$typeof)?!0:fHe(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var AHe="[object Arguments]",CHe="[object Boolean]",PHe="[object Date]",NHe="[object Error]",IHe="[object Map]",kHe="[object Number]",OHe="[object Object]",RHe="[object RegExp]",MHe="[object Set]",DHe="[object String]",LHe="[object URL]",FHe=Array.isArray,rX=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,nX=Object.assign,zHe=Object.prototype.toString.call.bind(Object.prototype.toString);function BHe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,a=e.areFunctionsEqual,d=e.areMapsEqual,p=e.areNumbersEqual,s=e.areObjectsEqual,_=e.arePrimitiveWrappersEqual,b=e.areRegExpsEqual,T=e.areSetsEqual,C=e.areTypedArraysEqual,P=e.areUrlsEqual;return function(B,R,D){if(B===R)return!0;if(B==null||R==null)return!1;var G=typeof B;if(G!==typeof R)return!1;if(G!=="object")return G==="number"?p(B,R,D):G==="function"?a(B,R,D):!1;var V=B.constructor;if(V!==R.constructor)return!1;if(V===Object)return s(B,R,D);if(FHe(B))return t(B,R,D);if(rX!=null&&rX(B))return C(B,R,D);if(V===Date)return r(B,R,D);if(V===RegExp)return b(B,R,D);if(V===Map)return d(B,R,D);if(V===Set)return T(B,R,D);var $=zHe(B);return $===PHe?r(B,R,D):$===RHe?b(B,R,D):$===IHe?d(B,R,D):$===MHe?T(B,R,D):$===OHe?typeof B.then!="function"&&typeof R.then!="function"&&s(B,R,D):$===LHe?P(B,R,D):$===NHe?n(B,R,D):$===AHe?s(B,R,D):$===CHe||$===kHe||$===DHe?_(B,R,D):!1}}function $He(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,a={areArraysEqual:n?hS:yHe,areDatesEqual:vHe,areErrorsEqual:_He,areFunctionsEqual:xHe,areMapsEqual:n?KZ(eX,hS):eX,areNumbersEqual:bHe,areObjectsEqual:n?hS:wHe,arePrimitiveWrappersEqual:SHe,areRegExpsEqual:THe,areSetsEqual:n?KZ(tX,hS):tX,areTypedArraysEqual:n?hS:EHe,areUrlsEqual:jHe};if(r&&(a=nX({},a,r(a))),t){var d=OC(a.areArraysEqual),p=OC(a.areMapsEqual),s=OC(a.areObjectsEqual),_=OC(a.areSetsEqual);a=nX({},a,{areArraysEqual:d,areMapsEqual:p,areObjectsEqual:s,areSetsEqual:_})}return a}function VHe(e){return function(t,r,n,a,d,p,s){return e(t,r,s)}}function UHe(e){var t=e.circular,r=e.comparator,n=e.createState,a=e.equals,d=e.strict;if(n)return function(_,b){var T=n(),C=T.cache,P=C===void 0?t?new WeakMap:void 0:C,k=T.meta;return r(_,b,{cache:P,equals:a,meta:k,strict:d})};if(t)return function(_,b){return r(_,b,{cache:new WeakMap,equals:a,meta:void 0,strict:d})};var p={cache:void 0,equals:a,meta:void 0,strict:d};return function(_,b){return r(_,b,p)}}var qHe=ng();ng({strict:!0});ng({circular:!0});ng({circular:!0,strict:!0});ng({createInternalComparator:function(){return Pv}});ng({strict:!0,createInternalComparator:function(){return Pv}});ng({circular:!0,createInternalComparator:function(){return Pv}});ng({circular:!0,createInternalComparator:function(){return Pv},strict:!0});function ng(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,a=e.createState,d=e.strict,p=d===void 0?!1:d,s=$He(e),_=BHe(s),b=n?n(_):VHe(_);return UHe({circular:r,comparator:_,createState:a,equals:b,strict:p})}function GHe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function iX(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(d){r<0&&(r=d),d-r>t?(e(d),r=-1):GHe(a)};requestAnimationFrame(n)}function fz(e){"@babel/helpers - typeof";return fz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fz(e)}function WHe(e){return KHe(e)||XHe(e)||ZHe(e)||HHe()}function HHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZHe(e,t){if(e){if(typeof e=="string")return sX(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sX(e,t)}}function sX(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function XHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function KHe(e){if(Array.isArray(e))return e}function YHe(){var e={},t=function(){return null},r=!1,n=function a(d){if(!r){if(Array.isArray(d)){if(!d.length)return;var p=d,s=WHe(p),_=s[0],b=s.slice(1);if(typeof _=="number"){iX(a.bind(null,b),_);return}a(_),iX(a.bind(null,b));return}fz(d)==="object"&&(e=d,t(e)),typeof d=="function"&&d()}};return{stop:function(){r=!0},start:function(d){r=!1,n(d)},subscribe:function(d){return t=d,function(){t=function(){return null}}}}}function f2(e){"@babel/helpers - typeof";return f2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f2(e)}function aX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function oX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aX(Object(r),!0).forEach(function(n){ace(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ace(e,t,r){return t=JHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JHe(e){var t=QHe(e,"string");return f2(t)==="symbol"?t:String(t)}function QHe(e,t){if(f2(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(f2(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var e7e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(d){return a.includes(d)})})},t7e=function(t){return t},r7e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},eT=function(t,r){return Object.keys(r).reduce(function(n,a){return oX(oX({},n),{},ace({},a,t(a,r[a])))},{})},lX=function(t,r,n){return t.map(function(a){return"".concat(r7e(a)," ").concat(r,"ms ").concat(n)}).join(",")};function n7e(e,t){return a7e(e)||s7e(e,t)||oce(e,t)||i7e()}function i7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function a7e(e){if(Array.isArray(e))return e}function o7e(e){return u7e(e)||c7e(e)||oce(e)||l7e()}function l7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oce(e,t){if(e){if(typeof e=="string")return pz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pz(e,t)}}function c7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function u7e(e){if(Array.isArray(e))return pz(e)}function pz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var RN=1e-4,lce=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},cce=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},cX=function(t,r){return function(n){var a=lce(t,r);return cce(a,n)}},d7e=function(t,r){return function(n){var a=lce(t,r),d=[].concat(o7e(a.map(function(p,s){return p*s}).slice(1)),[0]);return cce(d,n)}},uX=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],d=r[1],p=r[2],s=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,d=0,p=1,s=1;break;case"ease":a=.25,d=.1,p=.25,s=1;break;case"ease-in":a=.42,d=0,p=1,s=1;break;case"ease-out":a=.42,d=0,p=.58,s=1;break;case"ease-in-out":a=0,d=0,p=.58,s=1;break;default:{var _=r[0].split("(");if(_[0]==="cubic-bezier"&&_[1].split(")")[0].split(",").length===4){var b=_[1].split(")")[0].split(",").map(function(D){return parseFloat(D)}),T=n7e(b,4);a=T[0],d=T[1],p=T[2],s=T[3]}}}var C=cX(a,p),P=cX(d,s),k=d7e(a,p),B=function(G){return G>1?1:G<0?0:G},R=function(G){for(var V=G>1?1:G,$=V,K=0;K<8;++K){var Y=C($)-V,ee=k($);if(Math.abs(Y-V)<RN||ee<RN)return P($);$=B($-Y/ee)}return P($)};return R.isStepper=!1,R},h7e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,d=a===void 0?8:a,p=t.dt,s=p===void 0?17:p,_=function(T,C,P){var k=-(T-C)*n,B=P*d,R=P+(k-B)*s/1e3,D=P*s/1e3+T;return Math.abs(D-C)<RN&&Math.abs(R)<RN?[C,0]:[D,R]};return _.isStepper=!0,_.dt=s,_},f7e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return uX(a);case"spring":return h7e();default:if(a.split("(")[0]==="cubic-bezier")return uX(a)}return typeof a=="function"?a:null};function p2(e){"@babel/helpers - typeof";return p2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p2(e)}function dX(e){return g7e(e)||m7e(e)||uce(e)||p7e()}function p7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function g7e(e){if(Array.isArray(e))return gz(e)}function hX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hX(Object(r),!0).forEach(function(n){mz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mz(e,t,r){return t=y7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y7e(e){var t=v7e(e,"string");return p2(t)==="symbol"?t:String(t)}function v7e(e,t){if(p2(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(p2(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _7e(e,t){return w7e(e)||b7e(e,t)||uce(e,t)||x7e()}function x7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uce(e,t){if(e){if(typeof e=="string")return gz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gz(e,t)}}function gz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function w7e(e){if(Array.isArray(e))return e}var MN=function(t,r,n){return t+(r-t)*n},yz=function(t){var r=t.from,n=t.to;return r!==n},S7e=function e(t,r,n){var a=eT(function(d,p){if(yz(p)){var s=t(p.from,p.to,p.velocity),_=_7e(s,2),b=_[0],T=_[1];return Mo(Mo({},p),{},{from:b,velocity:T})}return p},r);return n<1?eT(function(d,p){return yz(p)?Mo(Mo({},p),{},{velocity:MN(p.velocity,a[d].velocity,n),from:MN(p.from,a[d].from,n)}):p},r):e(t,a,n-1)};const T7e=function(e,t,r,n,a){var d=e7e(e,t),p=d.reduce(function(D,G){return Mo(Mo({},D),{},mz({},G,[e[G],t[G]]))},{}),s=d.reduce(function(D,G){return Mo(Mo({},D),{},mz({},G,{from:e[G],velocity:0,to:t[G]}))},{}),_=-1,b,T,C=function(){return null},P=function(){return eT(function(G,V){return V.from},s)},k=function(){return!Object.values(s).filter(yz).length},B=function(G){b||(b=G);var V=G-b,$=V/r.dt;s=S7e(r,s,$),a(Mo(Mo(Mo({},e),t),P())),b=G,k()||(_=requestAnimationFrame(C))},R=function(G){T||(T=G);var V=(G-T)/n,$=eT(function(Y,ee){return MN.apply(void 0,dX(ee).concat([r(V)]))},p);if(a(Mo(Mo(Mo({},e),t),$)),V<1)_=requestAnimationFrame(C);else{var K=eT(function(Y,ee){return MN.apply(void 0,dX(ee).concat([r(1)]))},p);a(Mo(Mo(Mo({},e),t),K))}};return C=r.isStepper?B:R,function(){return requestAnimationFrame(C),function(){cancelAnimationFrame(_)}}};function $0(e){"@babel/helpers - typeof";return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$0(e)}var E7e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function j7e(e,t){if(e==null)return{};var r=A7e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function A7e(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,d;for(d=0;d<n.length;d++)a=n[d],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function eL(e){return I7e(e)||N7e(e)||P7e(e)||C7e()}function C7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P7e(e,t){if(e){if(typeof e=="string")return vz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vz(e,t)}}function N7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function I7e(e){if(Array.isArray(e))return vz(e)}function vz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fX(Object(r),!0).forEach(function(n){CS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CS(e,t,r){return t=dce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O7e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dce(n.key),n)}}function R7e(e,t,r){return t&&O7e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function dce(e){var t=M7e(e,"string");return $0(t)==="symbol"?t:String(t)}function M7e(e,t){if($0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if($0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function D7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_z(e,t)}function _z(e,t){return _z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},_z(e,t)}function L7e(e){var t=F7e();return function(){var n=DN(e),a;if(t){var d=DN(this).constructor;a=Reflect.construct(n,arguments,d)}else a=n.apply(this,arguments);return xz(this,a)}}function xz(e,t){if(t&&($0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bz(e)}function bz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F7e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function DN(e){return DN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DN(e)}var Ed=function(e){D7e(r,e);var t=L7e(r);function r(n,a){var d;k7e(this,r),d=t.call(this,n,a);var p=d.props,s=p.isActive,_=p.attributeName,b=p.from,T=p.to,C=p.steps,P=p.children,k=p.duration;if(d.handleStyleChange=d.handleStyleChange.bind(bz(d)),d.changeStyle=d.changeStyle.bind(bz(d)),!s||k<=0)return d.state={style:{}},typeof P=="function"&&(d.state={style:T}),xz(d);if(C&&C.length)d.state={style:C[0].style};else if(b){if(typeof P=="function")return d.state={style:b},xz(d);d.state={style:_?CS({},_,b):b}}else d.state={style:{}};return d}return R7e(r,[{key:"componentDidMount",value:function(){var a=this.props,d=a.isActive,p=a.canBegin;this.mounted=!0,!(!d||!p)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var d=this.props,p=d.isActive,s=d.canBegin,_=d.attributeName,b=d.shouldReAnimate,T=d.to,C=d.from,P=this.state.style;if(s){if(!p){var k={style:_?CS({},_,T):T};this.state&&P&&(_&&P[_]!==T||!_&&P!==T)&&this.setState(k);return}if(!(qHe(a.to,T)&&a.canBegin&&a.isActive)){var B=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var R=B||b?C:a.to;if(this.state&&P){var D={style:_?CS({},_,R):R};(_&&P[_]!==R||!_&&P!==R)&&this.setState(D)}this.runAnimation(Yu(Yu({},this.props),{},{from:R,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var d=this,p=a.from,s=a.to,_=a.duration,b=a.easing,T=a.begin,C=a.onAnimationEnd,P=a.onAnimationStart,k=T7e(p,s,f7e(b),_,this.changeStyle),B=function(){d.stopJSAnimation=k()};this.manager.start([P,T,B,_,C])}},{key:"runStepAnimation",value:function(a){var d=this,p=a.steps,s=a.begin,_=a.onAnimationStart,b=p[0],T=b.style,C=b.duration,P=C===void 0?0:C,k=function(R,D,G){if(G===0)return R;var V=D.duration,$=D.easing,K=$===void 0?"ease":$,Y=D.style,ee=D.properties,ae=D.onAnimationEnd,ie=G>0?p[G-1]:D,ge=ee||Object.keys(Y);if(typeof K=="function"||K==="spring")return[].concat(eL(R),[d.runJSAnimation.bind(d,{from:ie.style,to:Y,duration:V,easing:K}),V]);var fe=lX(ge,V,K),be=Yu(Yu(Yu({},ie.style),Y),{},{transition:fe});return[].concat(eL(R),[be,V,ae]).filter(t7e)};return this.manager.start([_].concat(eL(p.reduce(k,[T,Math.max(P,s)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=YHe());var d=a.begin,p=a.duration,s=a.attributeName,_=a.to,b=a.easing,T=a.onAnimationStart,C=a.onAnimationEnd,P=a.steps,k=a.children,B=this.manager;if(this.unSubscribe=B.subscribe(this.handleStyleChange),typeof b=="function"||typeof k=="function"||b==="spring"){this.runJSAnimation(a);return}if(P.length>1){this.runStepAnimation(a);return}var R=s?CS({},s,_):_,D=lX(Object.keys(R),p,b);B.start([T,d,Yu(Yu({},R),{},{transition:D}),p,C])}},{key:"render",value:function(){var a=this.props,d=a.children;a.begin;var p=a.duration;a.attributeName,a.easing;var s=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var _=j7e(a,E7e),b=F.Children.count(d),T=this.state.style;if(typeof d=="function")return d(T);if(!s||b===0||p<=0)return d;var C=function(k){var B=k.props,R=B.style,D=R===void 0?{}:R,G=B.className,V=F.cloneElement(k,Yu(Yu({},_),{},{style:Yu(Yu({},D),T),className:G}));return V};return b===1?C(F.Children.only(d)):De.createElement("div",null,F.Children.map(d,function(P){return C(P)}))}}]),r}(F.PureComponent);Ed.displayName="Animate";Ed.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Ed.propTypes={from:rs.oneOfType([rs.object,rs.string]),to:rs.oneOfType([rs.object,rs.string]),attributeName:rs.string,duration:rs.number,begin:rs.number,easing:rs.oneOfType([rs.string,rs.func]),steps:rs.arrayOf(rs.shape({duration:rs.number.isRequired,style:rs.object.isRequired,easing:rs.oneOfType([rs.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),rs.func]),properties:rs.arrayOf("string"),onAnimationEnd:rs.func})),children:rs.oneOfType([rs.node,rs.func]),isActive:rs.bool,canBegin:rs.bool,onAnimationEnd:rs.func,shouldReAnimate:rs.bool,onAnimationStart:rs.func,onAnimationReStart:rs.func};function m2(e){"@babel/helpers - typeof";return m2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m2(e)}function LN(){return LN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LN.apply(this,arguments)}function z7e(e,t){return U7e(e)||V7e(e,t)||$7e(e,t)||B7e()}function B7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $7e(e,t){if(e){if(typeof e=="string")return pX(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pX(e,t)}}function pX(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function U7e(e){if(Array.isArray(e))return e}function mX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mX(Object(r),!0).forEach(function(n){q7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function q7e(e,t,r){return t=G7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G7e(e){var t=W7e(e,"string");return m2(t)=="symbol"?t:t+""}function W7e(e,t){if(m2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(m2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yX=function(t,r,n,a,d){var p=Math.min(Math.abs(n)/2,Math.abs(a)/2),s=a>=0?1:-1,_=n>=0?1:-1,b=a>=0&&n>=0||a<0&&n<0?1:0,T;if(p>0&&d instanceof Array){for(var C=[0,0,0,0],P=0,k=4;P<k;P++)C[P]=d[P]>p?p:d[P];T="M".concat(t,",").concat(r+s*C[0]),C[0]>0&&(T+="A ".concat(C[0],",").concat(C[0],",0,0,").concat(b,",").concat(t+_*C[0],",").concat(r)),T+="L ".concat(t+n-_*C[1],",").concat(r),C[1]>0&&(T+="A ".concat(C[1],",").concat(C[1],",0,0,").concat(b,`,
        `).concat(t+n,",").concat(r+s*C[1])),T+="L ".concat(t+n,",").concat(r+a-s*C[2]),C[2]>0&&(T+="A ".concat(C[2],",").concat(C[2],",0,0,").concat(b,`,
        `).concat(t+n-_*C[2],",").concat(r+a)),T+="L ".concat(t+_*C[3],",").concat(r+a),C[3]>0&&(T+="A ".concat(C[3],",").concat(C[3],",0,0,").concat(b,`,
        `).concat(t,",").concat(r+a-s*C[3])),T+="Z"}else if(p>0&&d===+d&&d>0){var B=Math.min(p,d);T="M ".concat(t,",").concat(r+s*B,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+_*B,",").concat(r,`
            L `).concat(t+n-_*B,",").concat(r,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+n,",").concat(r+s*B,`
            L `).concat(t+n,",").concat(r+a-s*B,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t+n-_*B,",").concat(r+a,`
            L `).concat(t+_*B,",").concat(r+a,`
            A `).concat(B,",").concat(B,",0,0,").concat(b,",").concat(t,",").concat(r+a-s*B," Z")}else T="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return T},H7e=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,d=r.x,p=r.y,s=r.width,_=r.height;if(Math.abs(s)>0&&Math.abs(_)>0){var b=Math.min(d,d+s),T=Math.max(d,d+s),C=Math.min(p,p+_),P=Math.max(p,p+_);return n>=b&&n<=T&&a>=C&&a<=P}return!1},Z7e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},P$=function(t){var r=gX(gX({},Z7e),t),n=F.useRef(),a=F.useState(-1),d=z7e(a,2),p=d[0],s=d[1];F.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var K=n.current.getTotalLength();K&&s(K)}catch{}},[]);var _=r.x,b=r.y,T=r.width,C=r.height,P=r.radius,k=r.className,B=r.animationEasing,R=r.animationDuration,D=r.animationBegin,G=r.isAnimationActive,V=r.isUpdateAnimationActive;if(_!==+_||b!==+b||T!==+T||C!==+C||T===0||C===0)return null;var $=Zn("recharts-rectangle",k);return V?De.createElement(Ed,{canBegin:p>0,from:{width:T,height:C,x:_,y:b},to:{width:T,height:C,x:_,y:b},duration:R,animationEasing:B,isActive:V},function(K){var Y=K.width,ee=K.height,ae=K.x,ie=K.y;return De.createElement(Ed,{canBegin:p>0,from:"0px ".concat(p===-1?1:p,"px"),to:"".concat(p,"px 0px"),attributeName:"strokeDasharray",begin:D,duration:R,isActive:G,easing:B},De.createElement("path",LN({},pn(r,!0),{className:$,d:yX(ae,ie,Y,ee,P),ref:n})))}):De.createElement("path",LN({},pn(r,!0),{className:$,d:yX(_,b,T,C,P)}))},X7e=["points","className","baseLinePoints","connectNulls"];function Dx(){return Dx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dx.apply(this,arguments)}function K7e(e,t){if(e==null)return{};var r=Y7e(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Y7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function vX(e){return tZe(e)||eZe(e)||Q7e(e)||J7e()}function J7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q7e(e,t){if(e){if(typeof e=="string")return wz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wz(e,t)}}function eZe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function tZe(e){if(Array.isArray(e))return wz(e)}function wz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _X=function(t){return t&&t.x===+t.x&&t.y===+t.y},rZe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){_X(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),_X(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},tT=function(t,r){var n=rZe(t);r&&(n=[n.reduce(function(d,p){return[].concat(vX(d),vX(p))},[])]);var a=n.map(function(d){return d.reduce(function(p,s,_){return"".concat(p).concat(_===0?"M":"L").concat(s.x,",").concat(s.y)},"")}).join("");return n.length===1?"".concat(a,"Z"):a},nZe=function(t,r,n){var a=tT(t,n);return"".concat(a.slice(-1)==="Z"?a.slice(0,-1):a,"L").concat(tT(r.reverse(),n).slice(1))},iZe=function(t){var r=t.points,n=t.className,a=t.baseLinePoints,d=t.connectNulls,p=K7e(t,X7e);if(!r||!r.length)return null;var s=Zn("recharts-polygon",n);if(a&&a.length){var _=p.stroke&&p.stroke!=="none",b=nZe(r,a,d);return De.createElement("g",{className:s},De.createElement("path",Dx({},pn(p,!0),{fill:b.slice(-1)==="Z"?p.fill:"none",stroke:"none",d:b})),_?De.createElement("path",Dx({},pn(p,!0),{fill:"none",d:tT(r,d)})):null,_?De.createElement("path",Dx({},pn(p,!0),{fill:"none",d:tT(a,d)})):null)}var T=tT(r,d);return De.createElement("path",Dx({},pn(p,!0),{fill:T.slice(-1)==="Z"?p.fill:"none",className:s,d:T}))};function Sz(){return Sz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sz.apply(this,arguments)}var mE=function(t){var r=t.cx,n=t.cy,a=t.r,d=t.className,p=Zn("recharts-dot",d);return r===+r&&n===+n&&a===+a?F.createElement("circle",Sz({},pn(t,!1),nN(t),{className:p,cx:r,cy:n,r:a})):null};function g2(e){"@babel/helpers - typeof";return g2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g2(e)}var sZe=["x","y","top","left","width","height","className"];function Tz(){return Tz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tz.apply(this,arguments)}function xX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function aZe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xX(Object(r),!0).forEach(function(n){oZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oZe(e,t,r){return t=lZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lZe(e){var t=cZe(e,"string");return g2(t)=="symbol"?t:t+""}function cZe(e,t){if(g2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(g2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uZe(e,t){if(e==null)return{};var r=dZe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function dZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var hZe=function(t,r,n,a,d,p){return"M".concat(t,",").concat(d,"v").concat(a,"M").concat(p,",").concat(r,"h").concat(n)},fZe=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,d=a===void 0?0:a,p=t.top,s=p===void 0?0:p,_=t.left,b=_===void 0?0:_,T=t.width,C=T===void 0?0:T,P=t.height,k=P===void 0?0:P,B=t.className,R=uZe(t,sZe),D=aZe({x:n,y:d,top:s,left:b,width:C,height:k},R);return!br(n)||!br(d)||!br(C)||!br(k)||!br(s)||!br(b)?null:De.createElement("path",Tz({},pn(D,!0),{className:Zn("recharts-cross",B),d:hZe(n,d,C,k,s,b)}))},pZe=Vk,mZe=Sle,gZe=Dh;function yZe(e,t){return e&&e.length?pZe(e,gZe(t),mZe):void 0}var vZe=yZe;const _Ze=es(vZe);var xZe=Vk,bZe=Dh,wZe=Tle;function SZe(e,t){return e&&e.length?xZe(e,bZe(t),wZe):void 0}var TZe=SZe;const EZe=es(TZe);var jZe=["cx","cy","angle","ticks","axisLine"],AZe=["ticks","tick","angle","tickFormatter","stroke"];function V0(e){"@babel/helpers - typeof";return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V0(e)}function rT(){return rT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rT.apply(this,arguments)}function bX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ly(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bX(Object(r),!0).forEach(function(n){Wk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wX(e,t){if(e==null)return{};var r=CZe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function CZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function PZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fce(n.key),n)}}function NZe(e,t,r){return t&&SX(e.prototype,t),r&&SX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function IZe(e,t,r){return t=FN(t),kZe(e,hce()?Reflect.construct(t,r||[],FN(e).constructor):t.apply(e,r))}function kZe(e,t){if(t&&(V0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return OZe(e)}function OZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hce=function(){return!!e})()}function FN(e){return FN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FN(e)}function RZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ez(e,t)}function Ez(e,t){return Ez=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Ez(e,t)}function Wk(e,t,r){return t=fce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fce(e){var t=MZe(e,"string");return V0(t)=="symbol"?t:t+""}function MZe(e,t){if(V0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(V0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Hk=function(e){function t(){return PZe(this,t),IZe(this,t,arguments)}return RZe(t,e),NZe(t,[{key:"getTickValueCoord",value:function(n){var a=n.coordinate,d=this.props,p=d.angle,s=d.cx,_=d.cy;return Es(s,_,a,p)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,a;switch(n){case"left":a="end";break;case"right":a="start";break;default:a="middle";break}return a}},{key:"getViewBox",value:function(){var n=this.props,a=n.cx,d=n.cy,p=n.angle,s=n.ticks,_=_Ze(s,function(T){return T.coordinate||0}),b=EZe(s,function(T){return T.coordinate||0});return{cx:a,cy:d,startAngle:p,endAngle:p,innerRadius:b.coordinate||0,outerRadius:_.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,d=n.cy,p=n.angle,s=n.ticks,_=n.axisLine,b=wX(n,jZe),T=s.reduce(function(B,R){return[Math.min(B[0],R.coordinate),Math.max(B[1],R.coordinate)]},[1/0,-1/0]),C=Es(a,d,T[0],p),P=Es(a,d,T[1],p),k=ly(ly(ly({},pn(b,!1)),{},{fill:"none"},pn(_,!1)),{},{x1:C.x,y1:C.y,x2:P.x,y2:P.y});return De.createElement("line",rT({className:"recharts-polar-radius-axis-line"},k))}},{key:"renderTicks",value:function(){var n=this,a=this.props,d=a.ticks,p=a.tick,s=a.angle,_=a.tickFormatter,b=a.stroke,T=wX(a,AZe),C=this.getTickTextAnchor(),P=pn(T,!1),k=pn(p,!1),B=d.map(function(R,D){var G=n.getTickValueCoord(R),V=ly(ly(ly(ly({textAnchor:C,transform:"rotate(".concat(90-s,", ").concat(G.x,", ").concat(G.y,")")},P),{},{stroke:"none",fill:b},k),{},{index:D},G),{},{payload:R});return De.createElement(vi,rT({className:Zn("recharts-polar-radius-axis-tick",Jle(p)),key:"tick-".concat(R.coordinate)},cv(n.props,R,D)),t.renderTickItem(p,V,_?_(R.value,D):R.value))});return De.createElement(vi,{className:"recharts-polar-radius-axis-ticks"},B)}},{key:"render",value:function(){var n=this.props,a=n.ticks,d=n.axisLine,p=n.tick;return!a||!a.length?null:De.createElement(vi,{className:Zn("recharts-polar-radius-axis",this.props.className)},d&&this.renderAxisLine(),p&&this.renderTicks(),vo.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,a,d){var p;return De.isValidElement(n)?p=De.cloneElement(n,a):On(n)?p=n(a):p=De.createElement(uv,rT({},a,{className:"recharts-polar-radius-axis-tick-value"}),d),p}}])}(F.PureComponent);Wk(Hk,"displayName","PolarRadiusAxis");Wk(Hk,"axisType","radiusAxis");Wk(Hk,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function U0(e){"@babel/helpers - typeof";return U0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U0(e)}function xy(){return xy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xy.apply(this,arguments)}function TX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function cy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TX(Object(r),!0).forEach(function(n){Zk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function EX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mce(n.key),n)}}function LZe(e,t,r){return t&&EX(e.prototype,t),r&&EX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function FZe(e,t,r){return t=zN(t),zZe(e,pce()?Reflect.construct(t,r||[],zN(e).constructor):t.apply(e,r))}function zZe(e,t){if(t&&(U0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BZe(e)}function BZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pce=function(){return!!e})()}function zN(e){return zN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zN(e)}function $Ze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jz(e,t)}function jz(e,t){return jz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},jz(e,t)}function Zk(e,t,r){return t=mce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mce(e){var t=VZe(e,"string");return U0(t)=="symbol"?t:t+""}function VZe(e,t){if(U0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(U0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var UZe=Math.PI/180,jX=1e-5,Xk=function(e){function t(){return DZe(this,t),FZe(this,t,arguments)}return $Ze(t,e),LZe(t,[{key:"getTickLineCoord",value:function(n){var a=this.props,d=a.cx,p=a.cy,s=a.radius,_=a.orientation,b=a.tickSize,T=b||8,C=Es(d,p,s,n.coordinate),P=Es(d,p,s+(_==="inner"?-1:1)*T,n.coordinate);return{x1:C.x,y1:C.y,x2:P.x,y2:P.y}}},{key:"getTickTextAnchor",value:function(n){var a=this.props.orientation,d=Math.cos(-n.coordinate*UZe),p;return d>jX?p=a==="outer"?"start":"end":d<-jX?p=a==="outer"?"end":"start":p="middle",p}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.cx,d=n.cy,p=n.radius,s=n.axisLine,_=n.axisLineType,b=cy(cy({},pn(this.props,!1)),{},{fill:"none"},pn(s,!1));if(_==="circle")return De.createElement(mE,xy({className:"recharts-polar-angle-axis-line"},b,{cx:a,cy:d,r:p}));var T=this.props.ticks,C=T.map(function(P){return Es(a,d,p,P.coordinate)});return De.createElement(iZe,xy({className:"recharts-polar-angle-axis-line"},b,{points:C}))}},{key:"renderTicks",value:function(){var n=this,a=this.props,d=a.ticks,p=a.tick,s=a.tickLine,_=a.tickFormatter,b=a.stroke,T=pn(this.props,!1),C=pn(p,!1),P=cy(cy({},T),{},{fill:"none"},pn(s,!1)),k=d.map(function(B,R){var D=n.getTickLineCoord(B),G=n.getTickTextAnchor(B),V=cy(cy(cy({textAnchor:G},T),{},{stroke:"none",fill:b},C),{},{index:R,payload:B,x:D.x2,y:D.y2});return De.createElement(vi,xy({className:Zn("recharts-polar-angle-axis-tick",Jle(p)),key:"tick-".concat(B.coordinate)},cv(n.props,B,R)),s&&De.createElement("line",xy({className:"recharts-polar-angle-axis-tick-line"},P,D)),p&&t.renderTickItem(p,V,_?_(B.value,R):B.value))});return De.createElement(vi,{className:"recharts-polar-angle-axis-ticks"},k)}},{key:"render",value:function(){var n=this.props,a=n.ticks,d=n.radius,p=n.axisLine;return d<=0||!a||!a.length?null:De.createElement(vi,{className:Zn("recharts-polar-angle-axis",this.props.className)},p&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,a,d){var p;return De.isValidElement(n)?p=De.cloneElement(n,a):On(n)?p=n(a):p=De.createElement(uv,xy({},a,{className:"recharts-polar-angle-axis-tick-value"}),d),p}}])}(F.PureComponent);Zk(Xk,"displayName","PolarAngleAxis");Zk(Xk,"axisType","angleAxis");Zk(Xk,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var qZe=_oe,GZe=qZe(Object.getPrototypeOf,Object),WZe=GZe,HZe=Hf,ZZe=WZe,XZe=Zf,KZe="[object Object]",YZe=Function.prototype,JZe=Object.prototype,gce=YZe.toString,QZe=JZe.hasOwnProperty,eXe=gce.call(Object);function tXe(e){if(!XZe(e)||HZe(e)!=KZe)return!1;var t=ZZe(e);if(t===null)return!0;var r=QZe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&gce.call(r)==eXe}var rXe=tXe;const nXe=es(rXe);var iXe=Hf,sXe=Zf,aXe="[object Boolean]";function oXe(e){return e===!0||e===!1||sXe(e)&&iXe(e)==aXe}var lXe=oXe;const cXe=es(lXe);function y2(e){"@babel/helpers - typeof";return y2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y2(e)}function BN(){return BN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BN.apply(this,arguments)}function uXe(e,t){return pXe(e)||fXe(e,t)||hXe(e,t)||dXe()}function dXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hXe(e,t){if(e){if(typeof e=="string")return AX(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AX(e,t)}}function AX(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function pXe(e){if(Array.isArray(e))return e}function CX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function PX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CX(Object(r),!0).forEach(function(n){mXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mXe(e,t,r){return t=gXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gXe(e){var t=yXe(e,"string");return y2(t)=="symbol"?t:t+""}function yXe(e,t){if(y2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(y2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var NX=function(t,r,n,a,d){var p=n-a,s;return s="M ".concat(t,",").concat(r),s+="L ".concat(t+n,",").concat(r),s+="L ".concat(t+n-p/2,",").concat(r+d),s+="L ".concat(t+n-p/2-a,",").concat(r+d),s+="L ".concat(t,",").concat(r," Z"),s},vXe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},_Xe=function(t){var r=PX(PX({},vXe),t),n=F.useRef(),a=F.useState(-1),d=uXe(a,2),p=d[0],s=d[1];F.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var $=n.current.getTotalLength();$&&s($)}catch{}},[]);var _=r.x,b=r.y,T=r.upperWidth,C=r.lowerWidth,P=r.height,k=r.className,B=r.animationEasing,R=r.animationDuration,D=r.animationBegin,G=r.isUpdateAnimationActive;if(_!==+_||b!==+b||T!==+T||C!==+C||P!==+P||T===0&&C===0||P===0)return null;var V=Zn("recharts-trapezoid",k);return G?De.createElement(Ed,{canBegin:p>0,from:{upperWidth:0,lowerWidth:0,height:P,x:_,y:b},to:{upperWidth:T,lowerWidth:C,height:P,x:_,y:b},duration:R,animationEasing:B,isActive:G},function($){var K=$.upperWidth,Y=$.lowerWidth,ee=$.height,ae=$.x,ie=$.y;return De.createElement(Ed,{canBegin:p>0,from:"0px ".concat(p===-1?1:p,"px"),to:"".concat(p,"px 0px"),attributeName:"strokeDasharray",begin:D,duration:R,easing:B},De.createElement("path",BN({},pn(r,!0),{className:V,d:NX(ae,ie,K,Y,ee),ref:n})))}):De.createElement("g",null,De.createElement("path",BN({},pn(r,!0),{className:V,d:NX(_,b,T,C,P)})))},xXe=["option","shapeType","propTransformer","activeClassName","isActive"];function v2(e){"@babel/helpers - typeof";return v2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v2(e)}function bXe(e,t){if(e==null)return{};var r=wXe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function wXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function IX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $N(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IX(Object(r),!0).forEach(function(n){SXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SXe(e,t,r){return t=TXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TXe(e){var t=EXe(e,"string");return v2(t)=="symbol"?t:t+""}function EXe(e,t){if(v2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(v2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function jXe(e,t){return $N($N({},t),e)}function AXe(e,t){return e==="symbols"}function kX(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return De.createElement(P$,r);case"trapezoid":return De.createElement(_Xe,r);case"sector":return De.createElement(tce,r);case"symbols":if(AXe(t))return De.createElement(Z5,r);break;default:return null}}function CXe(e){return F.isValidElement(e)?e.props:e}function yce(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?jXe:n,d=e.activeClassName,p=d===void 0?"recharts-active-shape":d,s=e.isActive,_=bXe(e,xXe),b;if(F.isValidElement(t))b=F.cloneElement(t,$N($N({},_),CXe(t)));else if(On(t))b=t(_);else if(nXe(t)&&!cXe(t)){var T=a(t,_);b=De.createElement(kX,{shapeType:r,elementProps:T})}else{var C=_;b=De.createElement(kX,{shapeType:r,elementProps:C})}return s?De.createElement(vi,{className:p},b):b}function Kk(e,t){return t!=null&&"trapezoids"in e.props}function Yk(e,t){return t!=null&&"sectors"in e.props}function _2(e,t){return t!=null&&"points"in e.props}function PXe(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,d=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&d}function NXe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function IXe(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function kXe(e,t){var r;return Kk(e,t)?r=PXe:Yk(e,t)?r=NXe:_2(e,t)&&(r=IXe),r}function OXe(e,t){var r;return Kk(e,t)?r="trapezoids":Yk(e,t)?r="sectors":_2(e,t)&&(r="points"),r}function RXe(e,t){if(Kk(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(Yk(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return _2(e,t)?t.payload:{}}function MXe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=OXe(r,t),d=RXe(r,t),p=n.filter(function(_,b){var T=dv(d,_),C=r.props[a].filter(function(B){var R=kXe(r,t);return R(B,t)}),P=r.props[a].indexOf(C[C.length-1]),k=b===P;return T&&k}),s=n.indexOf(p[p.length-1]);return s}var aP;function q0(e){"@babel/helpers - typeof";return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q0(e)}function Lx(){return Lx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lx.apply(this,arguments)}function OX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ws(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OX(Object(r),!0).forEach(function(n){yu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_ce(n.key),n)}}function LXe(e,t,r){return t&&RX(e.prototype,t),r&&RX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function FXe(e,t,r){return t=VN(t),zXe(e,vce()?Reflect.construct(t,r||[],VN(e).constructor):t.apply(e,r))}function zXe(e,t){if(t&&(q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return BXe(e)}function BXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vce=function(){return!!e})()}function VN(e){return VN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VN(e)}function $Xe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Az(e,t)}function Az(e,t){return Az=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Az(e,t)}function yu(e,t,r){return t=_ce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ce(e){var t=VXe(e,"string");return q0(t)=="symbol"?t:t+""}function VXe(e,t){if(q0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(q0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Oh=function(e){function t(r){var n;return DXe(this,t),n=FXe(this,t,[r]),yu(n,"pieRef",null),yu(n,"sectorRefs",[]),yu(n,"id",jv("recharts-pie-")),yu(n,"handleAnimationEnd",function(){var a=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),On(a)&&a()}),yu(n,"handleAnimationStart",function(){var a=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),On(a)&&a()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return $Xe(t,e),LXe(t,[{key:"isActiveIndex",value:function(n){var a=this.props.activeIndex;return Array.isArray(a)?a.indexOf(n)!==-1:n===a}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var d=this.props,p=d.label,s=d.labelLine,_=d.dataKey,b=d.valueKey,T=pn(this.props,!1),C=pn(p,!1),P=pn(s,!1),k=p&&p.offsetRadius||20,B=n.map(function(R,D){var G=(R.startAngle+R.endAngle)/2,V=Es(R.cx,R.cy,R.outerRadius+k,G),$=ws(ws(ws(ws({},T),R),{},{stroke:"none"},C),{},{index:D,textAnchor:t.getTextAnchor(V.x,R.cx)},V),K=ws(ws(ws(ws({},T),R),{},{fill:"none",stroke:R.fill},P),{},{index:D,points:[Es(R.cx,R.cy,R.outerRadius,G),V]}),Y=_;return qn(_)&&qn(b)?Y="value":qn(_)&&(Y=b),De.createElement(vi,{key:"label-".concat(R.startAngle,"-").concat(R.endAngle,"-").concat(R.midAngle,"-").concat(D)},s&&t.renderLabelLineItem(s,K,"line"),t.renderLabelItem(p,$,ba(R,Y)))});return De.createElement(vi,{className:"recharts-pie-labels"},B)}},{key:"renderSectorsStatically",value:function(n){var a=this,d=this.props,p=d.activeShape,s=d.blendStroke,_=d.inactiveShape;return n.map(function(b,T){if((b==null?void 0:b.startAngle)===0&&(b==null?void 0:b.endAngle)===0&&n.length!==1)return null;var C=a.isActiveIndex(T),P=_&&a.hasActiveIndex()?_:null,k=C?p:P,B=ws(ws({},b),{},{stroke:s?b.fill:b.stroke,tabIndex:-1});return De.createElement(vi,Lx({ref:function(D){D&&!a.sectorRefs.includes(D)&&a.sectorRefs.push(D)},tabIndex:-1,className:"recharts-pie-sector"},cv(a.props,b,T),{key:"sector-".concat(b==null?void 0:b.startAngle,"-").concat(b==null?void 0:b.endAngle,"-").concat(b.midAngle,"-").concat(T)}),De.createElement(yce,Lx({option:k,isActive:C,shapeType:"sector"},B)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,a=this.props,d=a.sectors,p=a.isAnimationActive,s=a.animationBegin,_=a.animationDuration,b=a.animationEasing,T=a.animationId,C=this.state,P=C.prevSectors,k=C.prevIsAnimationActive;return De.createElement(Ed,{begin:s,duration:_,isActive:p,easing:b,from:{t:0},to:{t:1},key:"pie-".concat(T,"-").concat(k),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(B){var R=B.t,D=[],G=d&&d[0],V=G.startAngle;return d.forEach(function($,K){var Y=P&&P[K],ee=K>0?Lc($,"paddingAngle",0):0;if(Y){var ae=Qa(Y.endAngle-Y.startAngle,$.endAngle-$.startAngle),ie=ws(ws({},$),{},{startAngle:V+ee,endAngle:V+ae(R)+ee});D.push(ie),V=ie.endAngle}else{var ge=$.endAngle,fe=$.startAngle,be=Qa(0,ge-fe),ue=be(R),Ce=ws(ws({},$),{},{startAngle:V+ee,endAngle:V+ue+ee});D.push(Ce),V=Ce.endAngle}}),De.createElement(vi,null,n.renderSectorsStatically(D))})}},{key:"attachKeyboardHandlers",value:function(n){var a=this;n.onkeydown=function(d){if(!d.altKey)switch(d.key){case"ArrowLeft":{var p=++a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[p].focus(),a.setState({sectorToFocus:p});break}case"ArrowRight":{var s=--a.state.sectorToFocus<0?a.sectorRefs.length-1:a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[s].focus(),a.setState({sectorToFocus:s});break}case"Escape":{a.sectorRefs[a.state.sectorToFocus].blur(),a.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,a=n.sectors,d=n.isAnimationActive,p=this.state.prevSectors;return d&&a&&a.length&&(!p||!dv(p,a))?this.renderSectorsWithAnimation():this.renderSectorsStatically(a)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,a=this.props,d=a.hide,p=a.sectors,s=a.className,_=a.label,b=a.cx,T=a.cy,C=a.innerRadius,P=a.outerRadius,k=a.isAnimationActive,B=this.state.isAnimationFinished;if(d||!p||!p.length||!br(b)||!br(T)||!br(C)||!br(P))return null;var R=Zn("recharts-pie",s);return De.createElement(vi,{tabIndex:this.props.rootTabIndex,className:R,ref:function(G){n.pieRef=G}},this.renderSectors(),_&&this.renderLabels(p),vo.renderCallByParent(this.props,null,!1),(!k||B)&&Th.renderCallByParent(this.props,p,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return a.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:a.curSectors,isAnimationFinished:!0}:n.sectors!==a.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,a){return n>a?"start":n<a?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,a,d){if(De.isValidElement(n))return De.cloneElement(n,a);if(On(n))return n(a);var p=Zn("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return De.createElement(Xy,Lx({},a,{key:d,type:"linear",className:p}))}},{key:"renderLabelItem",value:function(n,a,d){if(De.isValidElement(n))return De.cloneElement(n,a);var p=d;if(On(n)&&(p=n(a),De.isValidElement(p)))return p;var s=Zn("recharts-pie-label-text",typeof n!="boolean"&&!On(n)?n.className:"");return De.createElement(uv,Lx({},a,{alignmentBaseline:"middle",className:s}),p)}}])}(F.PureComponent);aP=Oh;yu(Oh,"displayName","Pie");yu(Oh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!eg.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});yu(Oh,"parseDeltaAngle",function(e,t){var r=Dl(t-e),n=Math.min(Math.abs(t-e),360);return r*n});yu(Oh,"getRealPieData",function(e){var t=e.data,r=e.children,n=pn(e,!1),a=Fc(r,XT);return t&&t.length?t.map(function(d,p){return ws(ws(ws({payload:d},n),d),a&&a[p]&&a[p].props)}):a&&a.length?a.map(function(d){return ws(ws({},n),d.props)}):[]});yu(Oh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,a=t.width,d=t.height,p=Yle(a,d),s=n+Ll(e.cx,a,a/2),_=r+Ll(e.cy,d,d/2),b=Ll(e.innerRadius,p,0),T=Ll(e.outerRadius,p,p*.8),C=e.maxRadius||Math.sqrt(a*a+d*d)/2;return{cx:s,cy:_,innerRadius:b,outerRadius:T,maxRadius:C}});yu(Oh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?ws(ws({},t.type.defaultProps),t.props):t.props,a=aP.getRealPieData(n);if(!a||!a.length)return null;var d=n.cornerRadius,p=n.startAngle,s=n.endAngle,_=n.paddingAngle,b=n.dataKey,T=n.nameKey,C=n.valueKey,P=n.tooltipType,k=Math.abs(n.minAngle),B=aP.parseCoordinateOfPie(n,r),R=aP.parseDeltaAngle(p,s),D=Math.abs(R),G=b;qn(b)&&qn(C)?(yd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),G="value"):qn(b)&&(yd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),G=C);var V=a.filter(function(ie){return ba(ie,G,0)!==0}).length,$=(D>=360?V:V-1)*_,K=D-V*k-$,Y=a.reduce(function(ie,ge){var fe=ba(ge,G,0);return ie+(br(fe)?fe:0)},0),ee;if(Y>0){var ae;ee=a.map(function(ie,ge){var fe=ba(ie,G,0),be=ba(ie,T,ge),ue=(br(fe)?fe:0)/Y,Ce;ge?Ce=ae.endAngle+Dl(R)*_*(fe!==0?1:0):Ce=p;var ve=Ce+Dl(R)*((fe!==0?k:0)+ue*K),ze=(Ce+ve)/2,Me=(B.innerRadius+B.outerRadius)/2,Be=[{name:be,value:fe,payload:ie,dataKey:G,type:P}],Ve=Es(B.cx,B.cy,Me,ze);return ae=ws(ws(ws({percent:ue,cornerRadius:d,name:be,tooltipPayload:Be,midAngle:ze,middleRadius:Me,tooltipPosition:Ve},ie),B),{},{value:ba(ie,G),startAngle:Ce,endAngle:ve,payload:ie,paddingAngle:Dl(R)*_}),ae})}return ws(ws({},B),{},{sectors:ee,data:a})});var UXe=Math.ceil,qXe=Math.max;function GXe(e,t,r,n){for(var a=-1,d=qXe(UXe((t-e)/(r||1)),0),p=Array(d);d--;)p[n?d:++a]=e,e+=r;return p}var WXe=GXe,HXe=Foe,MX=1/0,ZXe=17976931348623157e292;function XXe(e){if(!e)return e===0?e:0;if(e=HXe(e),e===MX||e===-MX){var t=e<0?-1:1;return t*ZXe}return e===e?e:0}var xce=XXe,KXe=WXe,YXe=Mk,tL=xce;function JXe(e){return function(t,r,n){return n&&typeof n!="number"&&YXe(t,r,n)&&(r=n=void 0),t=tL(t),r===void 0?(r=t,t=0):r=tL(r),n=n===void 0?t<r?1:-1:tL(n),KXe(t,r,n,e)}}var QXe=JXe,eKe=QXe,tKe=eKe(),rKe=tKe;const UN=es(rKe);function x2(e){"@babel/helpers - typeof";return x2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x2(e)}function DX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function LX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DX(Object(r),!0).forEach(function(n){bce(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bce(e,t,r){return t=nKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nKe(e){var t=iKe(e,"string");return x2(t)=="symbol"?t:t+""}function iKe(e,t){if(x2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(x2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sKe=["Webkit","Moz","O","ms"],aKe=function(t,r){var n=t.replace(/(\w)/,function(d){return d.toUpperCase()}),a=sKe.reduce(function(d,p){return LX(LX({},d),{},bce({},p+n,r))},{});return a[t]=r,a};function G0(e){"@babel/helpers - typeof";return G0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G0(e)}function qN(){return qN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qN.apply(this,arguments)}function FX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FX(Object(r),!0).forEach(function(n){Tc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sce(n.key),n)}}function lKe(e,t,r){return t&&zX(e.prototype,t),r&&zX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function cKe(e,t,r){return t=GN(t),uKe(e,wce()?Reflect.construct(t,r||[],GN(e).constructor):t.apply(e,r))}function uKe(e,t){if(t&&(G0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dKe(e)}function dKe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wce=function(){return!!e})()}function GN(e){return GN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},GN(e)}function hKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cz(e,t)}function Cz(e,t){return Cz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Cz(e,t)}function Tc(e,t,r){return t=Sce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sce(e){var t=fKe(e,"string");return G0(t)=="symbol"?t:t+""}function fKe(e,t){if(G0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(G0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pKe=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,d=t.x,p=t.width,s=t.travellerWidth;if(!r||!r.length)return{};var _=r.length,b=JS().domain(UN(0,_)).range([d,d+p-s]),T=b.domain().map(function(C){return b(C)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:b(n),endX:b(a),scale:b,scaleValues:T}},BX=function(t){return t.changedTouches&&!!t.changedTouches.length},W0=function(e){function t(r){var n;return oKe(this,t),n=cKe(this,t,[r]),Tc(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),Tc(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),Tc(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,d=a.endIndex,p=a.onDragEnd,s=a.startIndex;p==null||p({endIndex:d,startIndex:s})}),n.detachDragEndListener()}),Tc(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Tc(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Tc(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Tc(n,"handleSlideDragStart",function(a){var d=BX(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:d.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return hKe(t,e),lKe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,d=n.endX,p=this.state.scaleValues,s=this.props,_=s.gap,b=s.data,T=b.length-1,C=Math.min(a,d),P=Math.max(a,d),k=t.getIndexInRange(p,C),B=t.getIndexInRange(p,P);return{startIndex:k-k%_,endIndex:B===T?T:B-B%_}}},{key:"getTextOfTick",value:function(n){var a=this.props,d=a.data,p=a.tickFormatter,s=a.dataKey,_=ba(d[n],s,n);return On(p)?p(_,n):_}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,d=a.slideMoveStartX,p=a.startX,s=a.endX,_=this.props,b=_.x,T=_.width,C=_.travellerWidth,P=_.startIndex,k=_.endIndex,B=_.onChange,R=n.pageX-d;R>0?R=Math.min(R,b+T-C-s,b+T-C-p):R<0&&(R=Math.max(R,b-p,b-s));var D=this.getIndex({startX:p+R,endX:s+R});(D.startIndex!==P||D.endIndex!==k)&&B&&B(D),this.setState({startX:p+R,endX:s+R,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var d=BX(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:d.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,d=a.brushMoveStartX,p=a.movingTravellerId,s=a.endX,_=a.startX,b=this.state[p],T=this.props,C=T.x,P=T.width,k=T.travellerWidth,B=T.onChange,R=T.gap,D=T.data,G={startX:this.state.startX,endX:this.state.endX},V=n.pageX-d;V>0?V=Math.min(V,C+P-k-b):V<0&&(V=Math.max(V,C-b)),G[p]=b+V;var $=this.getIndex(G),K=$.startIndex,Y=$.endIndex,ee=function(){var ie=D.length-1;return p==="startX"&&(s>_?K%R===0:Y%R===0)||s<_&&Y===ie||p==="endX"&&(s>_?Y%R===0:K%R===0)||s>_&&Y===ie};this.setState(Tc(Tc({},p,b+V),"brushMoveStartX",n.pageX),function(){B&&ee()&&B($)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var d=this,p=this.state,s=p.scaleValues,_=p.startX,b=p.endX,T=this.state[a],C=s.indexOf(T);if(C!==-1){var P=C+n;if(!(P===-1||P>=s.length)){var k=s[P];a==="startX"&&k>=b||a==="endX"&&k<=_||this.setState(Tc({},a,k),function(){d.props.onChange(d.getIndex({startX:d.state.startX,endX:d.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,d=n.y,p=n.width,s=n.height,_=n.fill,b=n.stroke;return De.createElement("rect",{stroke:b,fill:_,x:a,y:d,width:p,height:s})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,d=n.y,p=n.width,s=n.height,_=n.data,b=n.children,T=n.padding,C=F.Children.only(b);return C?De.cloneElement(C,{x:a,y:d,width:p,height:s,margin:T,compact:!0,data:_}):null}},{key:"renderTravellerLayer",value:function(n,a){var d,p,s=this,_=this.props,b=_.y,T=_.travellerWidth,C=_.height,P=_.traveller,k=_.ariaLabel,B=_.data,R=_.startIndex,D=_.endIndex,G=Math.max(n,this.props.x),V=rL(rL({},pn(this.props,!1)),{},{x:G,y:b,width:T,height:C}),$=k||"Min value: ".concat((d=B[R])===null||d===void 0?void 0:d.name,", Max value: ").concat((p=B[D])===null||p===void 0?void 0:p.name);return De.createElement(vi,{tabIndex:0,role:"slider","aria-label":$,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(Y){["ArrowLeft","ArrowRight"].includes(Y.key)&&(Y.preventDefault(),Y.stopPropagation(),s.handleTravellerMoveKeyboard(Y.key==="ArrowRight"?1:-1,a))},onFocus:function(){s.setState({isTravellerFocused:!0})},onBlur:function(){s.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(P,V))}},{key:"renderSlide",value:function(n,a){var d=this.props,p=d.y,s=d.height,_=d.stroke,b=d.travellerWidth,T=Math.min(n,a)+b,C=Math.max(Math.abs(a-n)-b,0);return De.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:_,fillOpacity:.2,x:T,y:p,width:C,height:s})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,d=n.endIndex,p=n.y,s=n.height,_=n.travellerWidth,b=n.stroke,T=this.state,C=T.startX,P=T.endX,k=5,B={pointerEvents:"none",fill:b};return De.createElement(vi,{className:"recharts-brush-texts"},De.createElement(uv,qN({textAnchor:"end",verticalAnchor:"middle",x:Math.min(C,P)-k,y:p+s/2},B),this.getTextOfTick(a)),De.createElement(uv,qN({textAnchor:"start",verticalAnchor:"middle",x:Math.max(C,P)+_+k,y:p+s/2},B),this.getTextOfTick(d)))}},{key:"render",value:function(){var n=this.props,a=n.data,d=n.className,p=n.children,s=n.x,_=n.y,b=n.width,T=n.height,C=n.alwaysShowText,P=this.state,k=P.startX,B=P.endX,R=P.isTextActive,D=P.isSlideMoving,G=P.isTravellerMoving,V=P.isTravellerFocused;if(!a||!a.length||!br(s)||!br(_)||!br(b)||!br(T)||b<=0||T<=0)return null;var $=Zn("recharts-brush",d),K=De.Children.count(p)===1,Y=aKe("userSelect","none");return De.createElement(vi,{className:$,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Y},this.renderBackground(),K&&this.renderPanorama(),this.renderSlide(k,B),this.renderTravellerLayer(k,"startX"),this.renderTravellerLayer(B,"endX"),(R||D||G||V||C)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,d=n.y,p=n.width,s=n.height,_=n.stroke,b=Math.floor(d+s/2)-1;return De.createElement(De.Fragment,null,De.createElement("rect",{x:a,y:d,width:p,height:s,fill:_,stroke:"none"}),De.createElement("line",{x1:a+1,y1:b,x2:a+p-1,y2:b,fill:"none",stroke:"#fff"}),De.createElement("line",{x1:a+1,y1:b+2,x2:a+p-1,y2:b+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var d;return De.isValidElement(n)?d=De.cloneElement(n,a):On(n)?d=n(a):d=t.renderDefaultTraveller(a),d}},{key:"getDerivedStateFromProps",value:function(n,a){var d=n.data,p=n.width,s=n.x,_=n.travellerWidth,b=n.updateId,T=n.startIndex,C=n.endIndex;if(d!==a.prevData||b!==a.prevUpdateId)return rL({prevData:d,prevTravellerWidth:_,prevUpdateId:b,prevX:s,prevWidth:p},d&&d.length?pKe({data:d,width:p,x:s,travellerWidth:_,startIndex:T,endIndex:C}):{scale:null,scaleValues:null});if(a.scale&&(p!==a.prevWidth||s!==a.prevX||_!==a.prevTravellerWidth)){a.scale.range([s,s+p-_]);var P=a.scale.domain().map(function(k){return a.scale(k)});return{prevData:d,prevTravellerWidth:_,prevUpdateId:b,prevX:s,prevWidth:p,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:P}}return null}},{key:"getIndexInRange",value:function(n,a){for(var d=n.length,p=0,s=d-1;s-p>1;){var _=Math.floor((p+s)/2);n[_]>a?s=_:p=_}return a>=n[s]?s:p}}])}(F.PureComponent);Tc(W0,"displayName","Brush");Tc(W0,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var mKe=t$;function gKe(e,t){var r;return mKe(e,function(n,a,d){return r=t(n,a,d),!r}),!!r}var yKe=gKe,vKe=doe,_Ke=Dh,xKe=yKe,bKe=fc,wKe=Mk;function SKe(e,t,r){var n=bKe(e)?vKe:xKe;return r&&wKe(e,t,r)&&(t=void 0),n(e,_Ke(t))}var TKe=SKe;const EKe=es(TKe);var Eh=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},$X=Ooe;function jKe(e,t,r){t=="__proto__"&&$X?$X(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var AKe=jKe,CKe=AKe,PKe=Ioe,NKe=Dh;function IKe(e,t){var r={};return t=NKe(t),PKe(e,function(n,a,d){CKe(r,a,t(n,a,d))}),r}var kKe=IKe;const OKe=es(kKe);function RKe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var MKe=RKe,DKe=t$;function LKe(e,t){var r=!0;return DKe(e,function(n,a,d){return r=!!t(n,a,d),r}),r}var FKe=LKe,zKe=MKe,BKe=FKe,$Ke=Dh,VKe=fc,UKe=Mk;function qKe(e,t,r){var n=VKe(e)?zKe:BKe;return r&&UKe(e,t,r)&&(t=void 0),n(e,$Ke(t))}var GKe=qKe;const Tce=es(GKe);var WKe=["x","y"];function b2(e){"@babel/helpers - typeof";return b2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b2(e)}function Pz(){return Pz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pz.apply(this,arguments)}function VX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VX(Object(r),!0).forEach(function(n){HKe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HKe(e,t,r){return t=ZKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZKe(e){var t=XKe(e,"string");return b2(t)=="symbol"?t:t+""}function XKe(e,t){if(b2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(b2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KKe(e,t){if(e==null)return{};var r=YKe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function JKe(e,t){var r=e.x,n=e.y,a=KKe(e,WKe),d="".concat(r),p=parseInt(d,10),s="".concat(n),_=parseInt(s,10),b="".concat(t.height||a.height),T=parseInt(b,10),C="".concat(t.width||a.width),P=parseInt(C,10);return fS(fS(fS(fS(fS({},t),a),p?{x:p}:{}),_?{y:_}:{}),{},{height:T,width:P,name:t.name,radius:t.radius})}function UX(e){return De.createElement(yce,Pz({shapeType:"rectangle",propTransformer:JKe,activeClassName:"recharts-active-bar"},e))}var QKe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var d=br(n)||EDe(n);return d?t(n,a):(d||fv(),r)}},eYe=["value","background"],Ece;function H0(e){"@babel/helpers - typeof";return H0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H0(e)}function tYe(e,t){if(e==null)return{};var r=rYe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function rYe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function WN(){return WN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WN.apply(this,arguments)}function qX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Na(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qX(Object(r),!0).forEach(function(n){pm(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ace(n.key),n)}}function iYe(e,t,r){return t&&GX(e.prototype,t),r&&GX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function sYe(e,t,r){return t=HN(t),aYe(e,jce()?Reflect.construct(t,r||[],HN(e).constructor):t.apply(e,r))}function aYe(e,t){if(t&&(H0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oYe(e)}function oYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jce=function(){return!!e})()}function HN(e){return HN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},HN(e)}function lYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Nz(e,t)}function Nz(e,t){return Nz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Nz(e,t)}function pm(e,t,r){return t=Ace(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ace(e){var t=cYe(e,"string");return H0(t)=="symbol"?t:t+""}function cYe(e,t){if(H0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(H0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Nv=function(e){function t(){var r;nYe(this,t);for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];return r=sYe(this,t,[].concat(a)),pm(r,"state",{isAnimationFinished:!1}),pm(r,"id",jv("recharts-bar-")),pm(r,"handleAnimationEnd",function(){var p=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),p&&p()}),pm(r,"handleAnimationStart",function(){var p=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),p&&p()}),r}return lYe(t,e),iYe(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,d=this.props,p=d.shape,s=d.dataKey,_=d.activeIndex,b=d.activeBar,T=pn(this.props,!1);return n&&n.map(function(C,P){var k=P===_,B=k?b:p,R=Na(Na(Na({},T),C),{},{isActive:k,option:B,index:P,dataKey:s,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return De.createElement(vi,WN({className:"recharts-bar-rectangle"},cv(a.props,C,P),{key:"rectangle-".concat(C==null?void 0:C.x,"-").concat(C==null?void 0:C.y,"-").concat(C==null?void 0:C.value,"-").concat(P)}),De.createElement(UX,R))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,d=a.data,p=a.layout,s=a.isAnimationActive,_=a.animationBegin,b=a.animationDuration,T=a.animationEasing,C=a.animationId,P=this.state.prevData;return De.createElement(Ed,{begin:_,duration:b,isActive:s,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(C),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(k){var B=k.t,R=d.map(function(D,G){var V=P&&P[G];if(V){var $=Qa(V.x,D.x),K=Qa(V.y,D.y),Y=Qa(V.width,D.width),ee=Qa(V.height,D.height);return Na(Na({},D),{},{x:$(B),y:K(B),width:Y(B),height:ee(B)})}if(p==="horizontal"){var ae=Qa(0,D.height),ie=ae(B);return Na(Na({},D),{},{y:D.y+D.height-ie,height:ie})}var ge=Qa(0,D.width),fe=ge(B);return Na(Na({},D),{},{width:fe})});return De.createElement(vi,null,n.renderRectanglesStatically(R))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,d=n.isAnimationActive,p=this.state.prevData;return d&&a&&a.length&&(!p||!dv(p,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,d=a.data,p=a.dataKey,s=a.activeIndex,_=pn(this.props.background,!1);return d.map(function(b,T){b.value;var C=b.background,P=tYe(b,eYe);if(!C)return null;var k=Na(Na(Na(Na(Na({},P),{},{fill:"#eee"},C),_),cv(n.props,b,T)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:p,index:T,className:"recharts-bar-background-rectangle"});return De.createElement(UX,WN({key:"background-bar-".concat(T),option:n.props.background,isActive:T===s},k))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var d=this.props,p=d.data,s=d.xAxis,_=d.yAxis,b=d.layout,T=d.children,C=Fc(T,pE);if(!C)return null;var P=b==="vertical"?p[0].height/2:p[0].width/2,k=function(D,G){var V=Array.isArray(D.value)?D.value[1]:D.value;return{x:D.x,y:D.y,value:V,errorVal:ba(D,G)}},B={clipPath:n?"url(#clipPath-".concat(a,")"):null};return De.createElement(vi,B,C.map(function(R){return De.cloneElement(R,{key:"error-bar-".concat(a,"-").concat(R.props.dataKey),data:p,xAxis:s,yAxis:_,layout:b,offset:P,dataPointFormatter:k})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,d=n.data,p=n.className,s=n.xAxis,_=n.yAxis,b=n.left,T=n.top,C=n.width,P=n.height,k=n.isAnimationActive,B=n.background,R=n.id;if(a||!d||!d.length)return null;var D=this.state.isAnimationFinished,G=Zn("recharts-bar",p),V=s&&s.allowDataOverflow,$=_&&_.allowDataOverflow,K=V||$,Y=qn(R)?this.id:R;return De.createElement(vi,{className:G},V||$?De.createElement("defs",null,De.createElement("clipPath",{id:"clipPath-".concat(Y)},De.createElement("rect",{x:V?b:b-C/2,y:$?T:T-P/2,width:V?C:C*2,height:$?P:P*2}))):null,De.createElement(vi,{className:"recharts-bar-rectangles",clipPath:K?"url(#clipPath-".concat(Y,")"):null},B?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(K,Y),(!k||D)&&Th.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(F.PureComponent);Ece=Nv;pm(Nv,"displayName","Bar");pm(Nv,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!eg.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});pm(Nv,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,d=e.xAxis,p=e.yAxis,s=e.xAxisTicks,_=e.yAxisTicks,b=e.stackedData,T=e.dataStartIndex,C=e.displayedData,P=e.offset,k=UWe(n,r);if(!k)return null;var B=t.layout,R=r.type.defaultProps,D=R!==void 0?Na(Na({},R),r.props):r.props,G=D.dataKey,V=D.children,$=D.minPointSize,K=B==="horizontal"?p:d,Y=b?K.scale.domain():null,ee=KWe({numericAxis:K}),ae=Fc(V,XT),ie=C.map(function(ge,fe){var be,ue,Ce,ve,ze,Me;b?be=qWe(b[T+fe],Y):(be=ba(ge,G),Array.isArray(be)||(be=[ee,be]));var Be=QKe($,Ece.defaultProps.minPointSize)(be[1],fe);if(B==="horizontal"){var Ve,We=[p.scale(be[0]),p.scale(be[1])],Ee=We[0],ot=We[1];ue=RZ({axis:d,ticks:s,bandSize:a,offset:k.offset,entry:ge,index:fe}),Ce=(Ve=ot??Ee)!==null&&Ve!==void 0?Ve:void 0,ve=k.size;var yt=Ee-ot;if(ze=Number.isNaN(yt)?0:yt,Me={x:ue,y:p.y,width:ve,height:p.height},Math.abs(Be)>0&&Math.abs(ze)<Math.abs(Be)){var Je=Dl(ze||Be)*(Math.abs(Be)-Math.abs(ze));Ce-=Je,ze+=Je}}else{var Bt=[d.scale(be[0]),d.scale(be[1])],Pt=Bt[0],pt=Bt[1];if(ue=Pt,Ce=RZ({axis:p,ticks:_,bandSize:a,offset:k.offset,entry:ge,index:fe}),ve=pt-Pt,ze=k.size,Me={x:d.x,y:Ce,width:d.width,height:ze},Math.abs(Be)>0&&Math.abs(ve)<Math.abs(Be)){var Gt=Dl(ve||Be)*(Math.abs(Be)-Math.abs(ve));ve+=Gt}}return Na(Na(Na({},ge),{},{x:ue,y:Ce,width:ve,height:ze,value:b?be:be[1],payload:ge,background:Me},ae&&ae[fe]&&ae[fe].props),{},{tooltipPayload:[Xle(r,ge)],tooltipPosition:{x:ue+ve/2,y:Ce+ze/2}})});return Na({data:ie,layout:B},P)});function w2(e){"@babel/helpers - typeof";return w2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w2(e)}function uYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function WX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Cce(n.key),n)}}function dYe(e,t,r){return t&&WX(e.prototype,t),r&&WX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function HX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function od(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HX(Object(r),!0).forEach(function(n){Jk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jk(e,t,r){return t=Cce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cce(e){var t=hYe(e,"string");return w2(t)=="symbol"?t:t+""}function hYe(e,t){if(w2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(w2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var N$=function(t,r,n,a,d){var p=t.width,s=t.height,_=t.layout,b=t.children,T=Object.keys(r),C={left:n.left,leftMirror:n.left,right:p-n.right,rightMirror:p-n.right,top:n.top,topMirror:n.top,bottom:s-n.bottom,bottomMirror:s-n.bottom},P=!!jc(b,Nv);return T.reduce(function(k,B){var R=r[B],D=R.orientation,G=R.domain,V=R.padding,$=V===void 0?{}:V,K=R.mirror,Y=R.reversed,ee="".concat(D).concat(K?"Mirror":""),ae,ie,ge,fe,be;if(R.type==="number"&&(R.padding==="gap"||R.padding==="no-gap")){var ue=G[1]-G[0],Ce=1/0,ve=R.categoricalDomain.sort(CDe);if(ve.forEach(function(Bt,Pt){Pt>0&&(Ce=Math.min((Bt||0)-(ve[Pt-1]||0),Ce))}),Number.isFinite(Ce)){var ze=Ce/ue,Me=R.layout==="vertical"?n.height:n.width;if(R.padding==="gap"&&(ae=ze*Me/2),R.padding==="no-gap"){var Be=Ll(t.barCategoryGap,ze*Me),Ve=ze*Me/2;ae=Ve-Be-(Ve-Be)/Me*Be}}}a==="xAxis"?ie=[n.left+($.left||0)+(ae||0),n.left+n.width-($.right||0)-(ae||0)]:a==="yAxis"?ie=_==="horizontal"?[n.top+n.height-($.bottom||0),n.top+($.top||0)]:[n.top+($.top||0)+(ae||0),n.top+n.height-($.bottom||0)-(ae||0)]:ie=R.range,Y&&(ie=[ie[1],ie[0]]);var We=Gle(R,d,P),Ee=We.scale,ot=We.realScaleType;Ee.domain(G).range(ie),Wle(Ee);var yt=Hle(Ee,od(od({},R),{},{realScaleType:ot}));a==="xAxis"?(be=D==="top"&&!K||D==="bottom"&&K,ge=n.left,fe=C[ee]-be*R.height):a==="yAxis"&&(be=D==="left"&&!K||D==="right"&&K,ge=C[ee]-be*R.width,fe=n.top);var Je=od(od(od({},R),yt),{},{realScaleType:ot,x:ge,y:fe,scale:Ee,width:a==="xAxis"?n.width:R.width,height:a==="yAxis"?n.height:R.height});return Je.bandSize=IN(Je,yt),!R.hide&&a==="xAxis"?C[ee]+=(be?-1:1)*Je.height:R.hide||(C[ee]+=(be?-1:1)*Je.width),od(od({},k),{},Jk({},B,Je))},{})},Pce=function(t,r){var n=t.x,a=t.y,d=r.x,p=r.y;return{x:Math.min(n,d),y:Math.min(a,p),width:Math.abs(d-n),height:Math.abs(p-a)}},fYe=function(t){var r=t.x1,n=t.y1,a=t.x2,d=t.y2;return Pce({x:r,y:n},{x:a,y:d})},Nce=function(){function e(t){uYe(this,e),this.scale=t}return dYe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,d=n.position;if(r!==void 0){if(d)switch(d){case"start":return this.scale(r);case"middle":{var p=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+p}case"end":{var s=this.bandwidth?this.bandwidth():0;return this.scale(r)+s}default:return this.scale(r)}if(a){var _=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+_}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],d=n[n.length-1];return a<=d?r>=a&&r<=d:r>=d&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();Jk(Nce,"EPS",1e-4);var I$=function(t){var r=Object.keys(t).reduce(function(n,a){return od(od({},n),{},Jk({},a,Nce.create(t[a])))},{});return od(od({},r),{},{apply:function(a){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=d.bandAware,s=d.position;return OKe(a,function(_,b){return r[b].apply(_,{bandAware:p,position:s})})},isInRange:function(a){return Tce(a,function(d,p){return r[p].isInRange(d)})}})};function pYe(e){return(e%180+180)%180}var mYe=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=pYe(a),p=d*Math.PI/180,s=Math.atan(n/r),_=p>s&&p<Math.PI-s?n/Math.sin(p):r/Math.cos(p);return Math.abs(_)},gYe=Dh,yYe=cE,vYe=Ok;function _Ye(e){return function(t,r,n){var a=Object(t);if(!yYe(t)){var d=gYe(r);t=vYe(t),r=function(s){return d(a[s],s,a)}}var p=e(t,r,n);return p>-1?a[d?t[p]:p]:void 0}}var xYe=_Ye,bYe=xce;function wYe(e){var t=bYe(e),r=t%1;return t===t?r?t-r:t:0}var SYe=wYe,TYe=Eoe,EYe=Dh,jYe=SYe,AYe=Math.max;function CYe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var a=r==null?0:jYe(r);return a<0&&(a=AYe(n+a,0)),TYe(e,EYe(t),a)}var PYe=CYe,NYe=xYe,IYe=PYe,kYe=NYe(IYe),OYe=kYe;const RYe=es(OYe);var MYe=IMe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),k$=F.createContext(void 0),O$=F.createContext(void 0),Ice=F.createContext(void 0),kce=F.createContext({}),Oce=F.createContext(void 0),Rce=F.createContext(0),Mce=F.createContext(0),ZX=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,d=r.offset,p=t.clipPathId,s=t.children,_=t.width,b=t.height,T=MYe(d);return De.createElement(k$.Provider,{value:n},De.createElement(O$.Provider,{value:a},De.createElement(kce.Provider,{value:d},De.createElement(Ice.Provider,{value:T},De.createElement(Oce.Provider,{value:p},De.createElement(Rce.Provider,{value:b},De.createElement(Mce.Provider,{value:_},s)))))))},DYe=function(){return F.useContext(Oce)},Dce=function(t){var r=F.useContext(k$);r==null&&fv();var n=r[t];return n==null&&fv(),n},LYe=function(){var t=F.useContext(k$);return em(t)},FYe=function(){var t=F.useContext(O$),r=RYe(t,function(n){return Tce(n.domain,Number.isFinite)});return r||em(t)},Lce=function(t){var r=F.useContext(O$);r==null&&fv();var n=r[t];return n==null&&fv(),n},zYe=function(){var t=F.useContext(Ice);return t},BYe=function(){return F.useContext(kce)},R$=function(){return F.useContext(Mce)},M$=function(){return F.useContext(Rce)};function Z0(e){"@babel/helpers - typeof";return Z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z0(e)}function $Ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zce(n.key),n)}}function UYe(e,t,r){return t&&VYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qYe(e,t,r){return t=ZN(t),GYe(e,Fce()?Reflect.construct(t,r||[],ZN(e).constructor):t.apply(e,r))}function GYe(e,t){if(t&&(Z0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WYe(e)}function WYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fce=function(){return!!e})()}function ZN(e){return ZN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ZN(e)}function HYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Iz(e,t)}function Iz(e,t){return Iz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Iz(e,t)}function XX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XX(Object(r),!0).forEach(function(n){D$(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D$(e,t,r){return t=zce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zce(e){var t=ZYe(e,"string");return Z0(t)=="symbol"?t:t+""}function ZYe(e,t){if(Z0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Z0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function XYe(e,t){return QYe(e)||JYe(e,t)||YYe(e,t)||KYe()}function KYe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YYe(e,t){if(e){if(typeof e=="string")return YX(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return YX(e,t)}}function YX(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function JYe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function QYe(e){if(Array.isArray(e))return e}function kz(){return kz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kz.apply(this,arguments)}var eJe=function(t,r){var n;return De.isValidElement(t)?n=De.cloneElement(t,r):On(t)?n=t(r):n=De.createElement("line",kz({},r,{className:"recharts-reference-line-line"})),n},tJe=function(t,r,n,a,d,p,s,_,b){var T=d.x,C=d.y,P=d.width,k=d.height;if(n){var B=b.y,R=t.y.apply(B,{position:p});if(Eh(b,"discard")&&!t.y.isInRange(R))return null;var D=[{x:T+P,y:R},{x:T,y:R}];return _==="left"?D.reverse():D}if(r){var G=b.x,V=t.x.apply(G,{position:p});if(Eh(b,"discard")&&!t.x.isInRange(V))return null;var $=[{x:V,y:C+k},{x:V,y:C}];return s==="top"?$.reverse():$}if(a){var K=b.segment,Y=K.map(function(ee){return t.apply(ee,{position:p})});return Eh(b,"discard")&&EKe(Y,function(ee){return!t.isInRange(ee)})?null:Y}return null};function rJe(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,d=e.yAxisId,p=e.shape,s=e.className,_=e.alwaysShow,b=DYe(),T=Dce(a),C=Lce(d),P=zYe();if(!b||!P)return null;yd(_===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var k=I$({x:T.scale,y:C.scale}),B=ro(t),R=ro(r),D=n&&n.length===2,G=tJe(k,B,R,D,P,e.position,T.orientation,C.orientation,e);if(!G)return null;var V=XYe(G,2),$=V[0],K=$.x,Y=$.y,ee=V[1],ae=ee.x,ie=ee.y,ge=Eh(e,"hidden")?"url(#".concat(b,")"):void 0,fe=KX(KX({clipPath:ge},pn(e,!0)),{},{x1:K,y1:Y,x2:ae,y2:ie});return De.createElement(vi,{className:Zn("recharts-reference-line",s)},eJe(p,fe),vo.renderCallByParent(e,fYe({x1:K,y1:Y,x2:ae,y2:ie})))}var L$=function(e){function t(){return $Ye(this,t),qYe(this,t,arguments)}return HYe(t,e),UYe(t,[{key:"render",value:function(){return De.createElement(rJe,this.props)}}])}(De.Component);D$(L$,"displayName","ReferenceLine");D$(L$,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function Oz(){return Oz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oz.apply(this,arguments)}function X0(e){"@babel/helpers - typeof";return X0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X0(e)}function JX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function QX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JX(Object(r),!0).forEach(function(n){Qk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$ce(n.key),n)}}function sJe(e,t,r){return t&&iJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aJe(e,t,r){return t=XN(t),oJe(e,Bce()?Reflect.construct(t,r||[],XN(e).constructor):t.apply(e,r))}function oJe(e,t){if(t&&(X0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lJe(e)}function lJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Bce=function(){return!!e})()}function XN(e){return XN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},XN(e)}function cJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rz(e,t)}function Rz(e,t){return Rz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Rz(e,t)}function Qk(e,t,r){return t=$ce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $ce(e){var t=uJe(e,"string");return X0(t)=="symbol"?t:t+""}function uJe(e,t){if(X0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(X0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dJe=function(t){var r=t.x,n=t.y,a=t.xAxis,d=t.yAxis,p=I$({x:a.scale,y:d.scale}),s=p.apply({x:r,y:n},{bandAware:!0});return Eh(t,"discard")&&!p.isInRange(s)?null:s},eO=function(e){function t(){return nJe(this,t),aJe(this,t,arguments)}return cJe(t,e),sJe(t,[{key:"render",value:function(){var n=this.props,a=n.x,d=n.y,p=n.r,s=n.alwaysShow,_=n.clipPathId,b=ro(a),T=ro(d);if(yd(s===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!b||!T)return null;var C=dJe(this.props);if(!C)return null;var P=C.x,k=C.y,B=this.props,R=B.shape,D=B.className,G=Eh(this.props,"hidden")?"url(#".concat(_,")"):void 0,V=QX(QX({clipPath:G},pn(this.props,!0)),{},{cx:P,cy:k});return De.createElement(vi,{className:Zn("recharts-reference-dot",D)},t.renderDot(R,V),vo.renderCallByParent(this.props,{x:P-p,y:k-p,width:2*p,height:2*p}))}}])}(De.Component);Qk(eO,"displayName","ReferenceDot");Qk(eO,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});Qk(eO,"renderDot",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):On(e)?r=e(t):r=De.createElement(mE,Oz({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function Mz(){return Mz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mz.apply(this,arguments)}function K0(e){"@babel/helpers - typeof";return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K0(e)}function eK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function tK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?eK(Object(r),!0).forEach(function(n){tO(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Uce(n.key),n)}}function pJe(e,t,r){return t&&fJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function mJe(e,t,r){return t=KN(t),gJe(e,Vce()?Reflect.construct(t,r||[],KN(e).constructor):t.apply(e,r))}function gJe(e,t){if(t&&(K0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yJe(e)}function yJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Vce=function(){return!!e})()}function KN(e){return KN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},KN(e)}function vJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dz(e,t)}function Dz(e,t){return Dz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Dz(e,t)}function tO(e,t,r){return t=Uce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Uce(e){var t=_Je(e,"string");return K0(t)=="symbol"?t:t+""}function _Je(e,t){if(K0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(K0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var xJe=function(t,r,n,a,d){var p=d.x1,s=d.x2,_=d.y1,b=d.y2,T=d.xAxis,C=d.yAxis;if(!T||!C)return null;var P=I$({x:T.scale,y:C.scale}),k={x:t?P.x.apply(p,{position:"start"}):P.x.rangeMin,y:n?P.y.apply(_,{position:"start"}):P.y.rangeMin},B={x:r?P.x.apply(s,{position:"end"}):P.x.rangeMax,y:a?P.y.apply(b,{position:"end"}):P.y.rangeMax};return Eh(d,"discard")&&(!P.isInRange(k)||!P.isInRange(B))?null:Pce(k,B)},rO=function(e){function t(){return hJe(this,t),mJe(this,t,arguments)}return vJe(t,e),pJe(t,[{key:"render",value:function(){var n=this.props,a=n.x1,d=n.x2,p=n.y1,s=n.y2,_=n.className,b=n.alwaysShow,T=n.clipPathId;yd(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var C=ro(a),P=ro(d),k=ro(p),B=ro(s),R=this.props.shape;if(!C&&!P&&!k&&!B&&!R)return null;var D=xJe(C,P,k,B,this.props);if(!D&&!R)return null;var G=Eh(this.props,"hidden")?"url(#".concat(T,")"):void 0;return De.createElement(vi,{className:Zn("recharts-reference-area",_)},t.renderRect(R,tK(tK({clipPath:G},pn(this.props,!0)),D)),vo.renderCallByParent(this.props,D))}}])}(De.Component);tO(rO,"displayName","ReferenceArea");tO(rO,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});tO(rO,"renderRect",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):On(e)?r=e(t):r=De.createElement(P$,Mz({},t,{className:"recharts-reference-area-rect"})),r});function qce(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function bJe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return mYe(n,r)}function wJe(e,t,r){var n=r==="width",a=e.x,d=e.y,p=e.width,s=e.height;return t===1?{start:n?a:d,end:n?a+p:d+s}:{start:n?a+p:d+s,end:n?a:d}}function YN(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var d=r();return e*(t-e*d/2-n)>=0&&e*(t+e*d/2-a)<=0}function SJe(e,t){return qce(e,t+1)}function TJe(e,t,r,n,a){for(var d=(n||[]).slice(),p=t.start,s=t.end,_=0,b=1,T=p,C=function(){var B=n==null?void 0:n[_];if(B===void 0)return{v:qce(n,b)};var R=_,D,G=function(){return D===void 0&&(D=r(B,R)),D},V=B.coordinate,$=_===0||YN(e,V,G,T,s);$||(_=0,T=p,b+=1),$&&(T=V+e*(G()/2+a),_+=b)},P;b<=d.length;)if(P=C(),P)return P.v;return[]}function S2(e){"@babel/helpers - typeof";return S2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S2(e)}function rK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rK(Object(r),!0).forEach(function(n){EJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EJe(e,t,r){return t=jJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jJe(e){var t=AJe(e,"string");return S2(t)=="symbol"?t:t+""}function AJe(e,t){if(S2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(S2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function CJe(e,t,r,n,a){for(var d=(n||[]).slice(),p=d.length,s=t.start,_=t.end,b=function(P){var k=d[P],B,R=function(){return B===void 0&&(B=r(k,P)),B};if(P===p-1){var D=e*(k.coordinate+e*R()/2-_);d[P]=k=nl(nl({},k),{},{tickCoord:D>0?k.coordinate-D*e:k.coordinate})}else d[P]=k=nl(nl({},k),{},{tickCoord:k.coordinate});var G=YN(e,k.tickCoord,R,s,_);G&&(_=k.tickCoord-e*(R()/2+a),d[P]=nl(nl({},k),{},{isShow:!0}))},T=p-1;T>=0;T--)b(T);return d}function PJe(e,t,r,n,a,d){var p=(n||[]).slice(),s=p.length,_=t.start,b=t.end;if(d){var T=n[s-1],C=r(T,s-1),P=e*(T.coordinate+e*C/2-b);p[s-1]=T=nl(nl({},T),{},{tickCoord:P>0?T.coordinate-P*e:T.coordinate});var k=YN(e,T.tickCoord,function(){return C},_,b);k&&(b=T.tickCoord-e*(C/2+a),p[s-1]=nl(nl({},T),{},{isShow:!0}))}for(var B=d?s-1:s,R=function(V){var $=p[V],K,Y=function(){return K===void 0&&(K=r($,V)),K};if(V===0){var ee=e*($.coordinate-e*Y()/2-_);p[V]=$=nl(nl({},$),{},{tickCoord:ee<0?$.coordinate-ee*e:$.coordinate})}else p[V]=$=nl(nl({},$),{},{tickCoord:$.coordinate});var ae=YN(e,$.tickCoord,Y,_,b);ae&&(_=$.tickCoord+e*(Y()/2+a),p[V]=nl(nl({},$),{},{isShow:!0}))},D=0;D<B;D++)R(D);return p}function F$(e,t,r){var n=e.tick,a=e.ticks,d=e.viewBox,p=e.minTickGap,s=e.orientation,_=e.interval,b=e.tickFormatter,T=e.unit,C=e.angle;if(!a||!a.length||!n)return[];if(br(_)||eg.isSsr)return SJe(a,typeof _=="number"&&br(_)?_:0);var P=[],k=s==="top"||s==="bottom"?"width":"height",B=T&&k==="width"?YS(T,{fontSize:t,letterSpacing:r}):{width:0,height:0},R=function($,K){var Y=On(b)?b($.value,K):$.value;return k==="width"?bJe(YS(Y,{fontSize:t,letterSpacing:r}),B,C):YS(Y,{fontSize:t,letterSpacing:r})[k]},D=a.length>=2?Dl(a[1].coordinate-a[0].coordinate):1,G=wJe(d,D,k);return _==="equidistantPreserveStart"?TJe(D,G,R,a,p):(_==="preserveStart"||_==="preserveStartEnd"?P=PJe(D,G,R,a,p,_==="preserveStartEnd"):P=CJe(D,G,R,a,p),P.filter(function(V){return V.isShow}))}var NJe=["viewBox"],IJe=["viewBox"],kJe=["ticks"];function Y0(e){"@babel/helpers - typeof";return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y0(e)}function Fx(){return Fx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fx.apply(this,arguments)}function nK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nK(Object(r),!0).forEach(function(n){z$(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nL(e,t){if(e==null)return{};var r=OJe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function OJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function RJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wce(n.key),n)}}function MJe(e,t,r){return t&&iK(e.prototype,t),r&&iK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function DJe(e,t,r){return t=JN(t),LJe(e,Gce()?Reflect.construct(t,r||[],JN(e).constructor):t.apply(e,r))}function LJe(e,t){if(t&&(Y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FJe(e)}function FJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gce=function(){return!!e})()}function JN(e){return JN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},JN(e)}function zJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Lz(e,t)}function Lz(e,t){return Lz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Lz(e,t)}function z$(e,t,r){return t=Wce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wce(e){var t=BJe(e,"string");return Y0(t)=="symbol"?t:t+""}function BJe(e,t){if(Y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Mb=function(e){function t(r){var n;return RJe(this,t),n=DJe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return zJe(t,e),MJe(t,[{key:"shouldComponentUpdate",value:function(n,a){var d=n.viewBox,p=nL(n,NJe),s=this.props,_=s.viewBox,b=nL(s,IJe);return!Jx(d,_)||!Jx(p,b)||!Jx(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,d=a.x,p=a.y,s=a.width,_=a.height,b=a.orientation,T=a.tickSize,C=a.mirror,P=a.tickMargin,k,B,R,D,G,V,$=C?-1:1,K=n.tickSize||T,Y=br(n.tickCoord)?n.tickCoord:n.coordinate;switch(b){case"top":k=B=n.coordinate,D=p+ +!C*_,R=D-$*K,V=R-$*P,G=Y;break;case"left":R=D=n.coordinate,B=d+ +!C*s,k=B-$*K,G=k-$*P,V=Y;break;case"right":R=D=n.coordinate,B=d+ +C*s,k=B+$*K,G=k+$*P,V=Y;break;default:k=B=n.coordinate,D=p+ +C*_,R=D+$*K,V=R+$*P,G=Y;break}return{line:{x1:k,y1:R,x2:B,y2:D},tick:{x:G,y:V}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,d=n.mirror,p;switch(a){case"left":p=d?"start":"end";break;case"right":p=d?"end":"start";break;default:p="middle";break}return p}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,d=n.mirror,p="end";switch(a){case"left":case"right":p="middle";break;case"top":p=d?"start":"end";break;default:p=d?"end":"start";break}return p}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,d=n.y,p=n.width,s=n.height,_=n.orientation,b=n.mirror,T=n.axisLine,C=Ha(Ha(Ha({},pn(this.props,!1)),pn(T,!1)),{},{fill:"none"});if(_==="top"||_==="bottom"){var P=+(_==="top"&&!b||_==="bottom"&&b);C=Ha(Ha({},C),{},{x1:a,y1:d+P*s,x2:a+p,y2:d+P*s})}else{var k=+(_==="left"&&!b||_==="right"&&b);C=Ha(Ha({},C),{},{x1:a+k*p,y1:d,x2:a+k*p,y2:d+s})}return De.createElement("line",Fx({},C,{className:Zn("recharts-cartesian-axis-line",Lc(T,"className"))}))}},{key:"renderTicks",value:function(n,a,d){var p=this,s=this.props,_=s.tickLine,b=s.stroke,T=s.tick,C=s.tickFormatter,P=s.unit,k=F$(Ha(Ha({},this.props),{},{ticks:n}),a,d),B=this.getTickTextAnchor(),R=this.getTickVerticalAnchor(),D=pn(this.props,!1),G=pn(T,!1),V=Ha(Ha({},D),{},{fill:"none"},pn(_,!1)),$=k.map(function(K,Y){var ee=p.getTickLineCoord(K),ae=ee.line,ie=ee.tick,ge=Ha(Ha(Ha(Ha({textAnchor:B,verticalAnchor:R},D),{},{stroke:"none",fill:b},G),ie),{},{index:Y,payload:K,visibleTicksCount:k.length,tickFormatter:C});return De.createElement(vi,Fx({className:"recharts-cartesian-axis-tick",key:"tick-".concat(K.value,"-").concat(K.coordinate,"-").concat(K.tickCoord)},cv(p.props,K,Y)),_&&De.createElement("line",Fx({},V,ae,{className:Zn("recharts-cartesian-axis-tick-line",Lc(_,"className"))})),T&&t.renderTickItem(T,ge,"".concat(On(C)?C(K.value,Y):K.value).concat(P||"")))});return De.createElement("g",{className:"recharts-cartesian-axis-ticks"},$)}},{key:"render",value:function(){var n=this,a=this.props,d=a.axisLine,p=a.width,s=a.height,_=a.ticksGenerator,b=a.className,T=a.hide;if(T)return null;var C=this.props,P=C.ticks,k=nL(C,kJe),B=P;return On(_)&&(B=P&&P.length>0?_(this.props):_(k)),p<=0||s<=0||!B||!B.length?null:De.createElement(vi,{className:Zn("recharts-cartesian-axis",b),ref:function(D){n.layerReference=D}},d&&this.renderAxisLine(),this.renderTicks(B,this.state.fontSize,this.state.letterSpacing),vo.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,d){var p,s=Zn(a.className,"recharts-cartesian-axis-tick-value");return De.isValidElement(n)?p=De.cloneElement(n,Ha(Ha({},a),{},{className:s})):On(n)?p=n(Ha(Ha({},a),{},{className:s})):p=De.createElement(uv,Fx({},a,{className:"recharts-cartesian-axis-tick-value"}),d),p}}])}(F.Component);z$(Mb,"displayName","CartesianAxis");z$(Mb,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var $Je=["x1","y1","x2","y2","key"],VJe=["offset"];function pv(e){"@babel/helpers - typeof";return pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pv(e)}function sK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function al(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sK(Object(r),!0).forEach(function(n){UJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UJe(e,t,r){return t=qJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qJe(e){var t=GJe(e,"string");return pv(t)=="symbol"?t:t+""}function GJe(e,t){if(pv(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ky(){return ky=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ky.apply(this,arguments)}function aK(e,t){if(e==null)return{};var r=WJe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function WJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var HJe=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,d=t.y,p=t.width,s=t.height,_=t.ry;return De.createElement("rect",{x:a,y:d,ry:_,width:p,height:s,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function Hce(e,t){var r;if(De.isValidElement(e))r=De.cloneElement(e,t);else if(On(e))r=e(t);else{var n=t.x1,a=t.y1,d=t.x2,p=t.y2,s=t.key,_=aK(t,$Je),b=pn(_,!1);b.offset;var T=aK(b,VJe);r=De.createElement("line",ky({},T,{x1:n,y1:a,x2:d,y2:p,fill:"none",key:s}))}return r}function ZJe(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,d=e.horizontalPoints;if(!a||!d||!d.length)return null;var p=d.map(function(s,_){var b=al(al({},e),{},{x1:t,y1:s,x2:t+r,y2:s,key:"line-".concat(_),index:_});return Hce(a,b)});return De.createElement("g",{className:"recharts-cartesian-grid-horizontal"},p)}function XJe(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,d=e.verticalPoints;if(!a||!d||!d.length)return null;var p=d.map(function(s,_){var b=al(al({},e),{},{x1:s,y1:t,x2:s,y2:t+r,key:"line-".concat(_),index:_});return Hce(a,b)});return De.createElement("g",{className:"recharts-cartesian-grid-vertical"},p)}function KJe(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,d=e.width,p=e.height,s=e.horizontalPoints,_=e.horizontal,b=_===void 0?!0:_;if(!b||!t||!t.length)return null;var T=s.map(function(P){return Math.round(P+a-a)}).sort(function(P,k){return P-k});a!==T[0]&&T.unshift(0);var C=T.map(function(P,k){var B=!T[k+1],R=B?a+p-P:T[k+1]-P;if(R<=0)return null;var D=k%t.length;return De.createElement("rect",{key:"react-".concat(k),y:P,x:n,height:R,width:d,stroke:"none",fill:t[D],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},C)}function YJe(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,d=e.x,p=e.y,s=e.width,_=e.height,b=e.verticalPoints;if(!r||!n||!n.length)return null;var T=b.map(function(P){return Math.round(P+d-d)}).sort(function(P,k){return P-k});d!==T[0]&&T.unshift(0);var C=T.map(function(P,k){var B=!T[k+1],R=B?d+s-P:T[k+1]-P;if(R<=0)return null;var D=k%n.length;return De.createElement("rect",{key:"react-".concat(k),x:P,y:p,width:R,height:_,stroke:"none",fill:n[D],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},C)}var JJe=function(t,r){var n=t.xAxis,a=t.width,d=t.height,p=t.offset;return qle(F$(al(al(al({},Mb.defaultProps),n),{},{ticks:bf(n,!0),viewBox:{x:0,y:0,width:a,height:d}})),p.left,p.left+p.width,r)},QJe=function(t,r){var n=t.yAxis,a=t.width,d=t.height,p=t.offset;return qle(F$(al(al(al({},Mb.defaultProps),n),{},{ticks:bf(n,!0),viewBox:{x:0,y:0,width:a,height:d}})),p.top,p.top+p.height,r)},ux={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function QN(e){var t,r,n,a,d,p,s=R$(),_=M$(),b=BYe(),T=al(al({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:ux.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:ux.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:ux.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:ux.horizontalFill,vertical:(d=e.vertical)!==null&&d!==void 0?d:ux.vertical,verticalFill:(p=e.verticalFill)!==null&&p!==void 0?p:ux.verticalFill,x:br(e.x)?e.x:b.left,y:br(e.y)?e.y:b.top,width:br(e.width)?e.width:b.width,height:br(e.height)?e.height:b.height}),C=T.x,P=T.y,k=T.width,B=T.height,R=T.syncWithTicks,D=T.horizontalValues,G=T.verticalValues,V=LYe(),$=FYe();if(!br(k)||k<=0||!br(B)||B<=0||!br(C)||C!==+C||!br(P)||P!==+P)return null;var K=T.verticalCoordinatesGenerator||JJe,Y=T.horizontalCoordinatesGenerator||QJe,ee=T.horizontalPoints,ae=T.verticalPoints;if((!ee||!ee.length)&&On(Y)){var ie=D&&D.length,ge=Y({yAxis:$?al(al({},$),{},{ticks:ie?D:$.ticks}):void 0,width:s,height:_,offset:b},ie?!0:R);yd(Array.isArray(ge),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(pv(ge),"]")),Array.isArray(ge)&&(ee=ge)}if((!ae||!ae.length)&&On(K)){var fe=G&&G.length,be=K({xAxis:V?al(al({},V),{},{ticks:fe?G:V.ticks}):void 0,width:s,height:_,offset:b},fe?!0:R);yd(Array.isArray(be),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(pv(be),"]")),Array.isArray(be)&&(ae=be)}return De.createElement("g",{className:"recharts-cartesian-grid"},De.createElement(HJe,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),De.createElement(ZJe,ky({},T,{offset:b,horizontalPoints:ee,xAxis:V,yAxis:$})),De.createElement(XJe,ky({},T,{offset:b,verticalPoints:ae,xAxis:V,yAxis:$})),De.createElement(KJe,ky({},T,{horizontalPoints:ee})),De.createElement(YJe,ky({},T,{verticalPoints:ae})))}QN.displayName="CartesianGrid";var eQe=["type","layout","connectNulls","ref"],tQe=["key"];function J0(e){"@babel/helpers - typeof";return J0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J0(e)}function oK(e,t){if(e==null)return{};var r=rQe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function rQe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function nT(){return nT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nT.apply(this,arguments)}function lK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lK(Object(r),!0).forEach(function(n){ld(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dx(e){return aQe(e)||sQe(e)||iQe(e)||nQe()}function nQe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iQe(e,t){if(e){if(typeof e=="string")return Fz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fz(e,t)}}function sQe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function aQe(e){if(Array.isArray(e))return Fz(e)}function Fz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function oQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xce(n.key),n)}}function lQe(e,t,r){return t&&cK(e.prototype,t),r&&cK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function cQe(e,t,r){return t=eI(t),uQe(e,Zce()?Reflect.construct(t,r||[],eI(e).constructor):t.apply(e,r))}function uQe(e,t){if(t&&(J0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dQe(e)}function dQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zce=function(){return!!e})()}function eI(e){return eI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},eI(e)}function hQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zz(e,t)}function zz(e,t){return zz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},zz(e,t)}function ld(e,t,r){return t=Xce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xce(e){var t=fQe(e,"string");return J0(t)=="symbol"?t:t+""}function fQe(e,t){if(J0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(J0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var gE=function(e){function t(){var r;oQe(this,t);for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];return r=cQe(this,t,[].concat(a)),ld(r,"state",{isAnimationFinished:!0,totalLength:0}),ld(r,"generateSimpleStrokeDasharray",function(p,s){return"".concat(s,"px ").concat(p-s,"px")}),ld(r,"getStrokeDasharray",function(p,s,_){var b=_.reduce(function(G,V){return G+V});if(!b)return r.generateSimpleStrokeDasharray(s,p);for(var T=Math.floor(p/b),C=p%b,P=s-p,k=[],B=0,R=0;B<_.length;R+=_[B],++B)if(R+_[B]>C){k=[].concat(dx(_.slice(0,B)),[C-R]);break}var D=k.length%2===0?[0,P]:[P];return[].concat(dx(t.repeat(_,T)),dx(k),D).map(function(G){return"".concat(G,"px")}).join(", ")}),ld(r,"id",jv("recharts-line-")),ld(r,"pathRef",function(p){r.mainCurve=p}),ld(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),ld(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return hQe(t,e),lQe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var d=this.props,p=d.points,s=d.xAxis,_=d.yAxis,b=d.layout,T=d.children,C=Fc(T,pE);if(!C)return null;var P=function(R,D){return{x:R.x,y:R.y,value:R.value,errorVal:ba(R.payload,D)}},k={clipPath:n?"url(#clipPath-".concat(a,")"):null};return De.createElement(vi,k,C.map(function(B){return De.cloneElement(B,{key:"bar-".concat(B.props.dataKey),data:p,xAxis:s,yAxis:_,layout:b,dataPointFormatter:P})}))}},{key:"renderDots",value:function(n,a,d){var p=this.props.isAnimationActive;if(p&&!this.state.isAnimationFinished)return null;var s=this.props,_=s.dot,b=s.points,T=s.dataKey,C=pn(this.props,!1),P=pn(_,!0),k=b.map(function(R,D){var G=Sc(Sc(Sc({key:"dot-".concat(D),r:3},C),P),{},{index:D,cx:R.x,cy:R.y,value:R.value,dataKey:T,payload:R.payload,points:b});return t.renderDotItem(_,G)}),B={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(d,")"):null};return De.createElement(vi,nT({className:"recharts-line-dots",key:"dots"},B),k)}},{key:"renderCurveStatically",value:function(n,a,d,p){var s=this.props,_=s.type,b=s.layout,T=s.connectNulls;s.ref;var C=oK(s,eQe),P=Sc(Sc(Sc({},pn(C,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(d,")"):null,points:n},p),{},{type:_,layout:b,connectNulls:T});return De.createElement(Xy,nT({},P,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var d=this,p=this.props,s=p.points,_=p.strokeDasharray,b=p.isAnimationActive,T=p.animationBegin,C=p.animationDuration,P=p.animationEasing,k=p.animationId,B=p.animateNewValues,R=p.width,D=p.height,G=this.state,V=G.prevPoints,$=G.totalLength;return De.createElement(Ed,{begin:T,duration:C,isActive:b,easing:P,from:{t:0},to:{t:1},key:"line-".concat(k),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(K){var Y=K.t;if(V){var ee=V.length/s.length,ae=s.map(function(ue,Ce){var ve=Math.floor(Ce*ee);if(V[ve]){var ze=V[ve],Me=Qa(ze.x,ue.x),Be=Qa(ze.y,ue.y);return Sc(Sc({},ue),{},{x:Me(Y),y:Be(Y)})}if(B){var Ve=Qa(R*2,ue.x),We=Qa(D/2,ue.y);return Sc(Sc({},ue),{},{x:Ve(Y),y:We(Y)})}return Sc(Sc({},ue),{},{x:ue.x,y:ue.y})});return d.renderCurveStatically(ae,n,a)}var ie=Qa(0,$),ge=ie(Y),fe;if(_){var be="".concat(_).split(/[,\s]+/gim).map(function(ue){return parseFloat(ue)});fe=d.getStrokeDasharray(ge,$,be)}else fe=d.generateSimpleStrokeDasharray($,ge);return d.renderCurveStatically(s,n,a,{strokeDasharray:fe})})}},{key:"renderCurve",value:function(n,a){var d=this.props,p=d.points,s=d.isAnimationActive,_=this.state,b=_.prevPoints,T=_.totalLength;return s&&p&&p.length&&(!b&&T>0||!dv(b,p))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(p,n,a)}},{key:"render",value:function(){var n,a=this.props,d=a.hide,p=a.dot,s=a.points,_=a.className,b=a.xAxis,T=a.yAxis,C=a.top,P=a.left,k=a.width,B=a.height,R=a.isAnimationActive,D=a.id;if(d||!s||!s.length)return null;var G=this.state.isAnimationFinished,V=s.length===1,$=Zn("recharts-line",_),K=b&&b.allowDataOverflow,Y=T&&T.allowDataOverflow,ee=K||Y,ae=qn(D)?this.id:D,ie=(n=pn(p,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ge=ie.r,fe=ge===void 0?3:ge,be=ie.strokeWidth,ue=be===void 0?2:be,Ce=Dae(p)?p:{},ve=Ce.clipDot,ze=ve===void 0?!0:ve,Me=fe*2+ue;return De.createElement(vi,{className:$},K||Y?De.createElement("defs",null,De.createElement("clipPath",{id:"clipPath-".concat(ae)},De.createElement("rect",{x:K?P:P-k/2,y:Y?C:C-B/2,width:K?k:k*2,height:Y?B:B*2})),!ze&&De.createElement("clipPath",{id:"clipPath-dots-".concat(ae)},De.createElement("rect",{x:P-Me/2,y:C-Me/2,width:k+Me,height:B+Me}))):null,!V&&this.renderCurve(ee,ae),this.renderErrorBar(ee,ae),(V||p)&&this.renderDots(ee,ze,ae),(!R||G)&&Th.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var d=n.length%2!==0?[].concat(dx(n),[0]):n,p=[],s=0;s<a;++s)p=[].concat(dx(p),dx(d));return p}},{key:"renderDotItem",value:function(n,a){var d;if(De.isValidElement(n))d=De.cloneElement(n,a);else if(On(n))d=n(a);else{var p=a.key,s=oK(a,tQe),_=Zn("recharts-line-dot",typeof n!="boolean"?n.className:"");d=De.createElement(mE,nT({key:p},s,{className:_}))}return d}}])}(F.PureComponent);ld(gE,"displayName","Line");ld(gE,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!eg.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ld(gE,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,d=e.yAxisTicks,p=e.dataKey,s=e.bandSize,_=e.displayedData,b=e.offset,T=t.layout,C=_.map(function(P,k){var B=ba(P,p);return T==="horizontal"?{x:NN({axis:r,ticks:a,bandSize:s,entry:P,index:k}),y:qn(B)?null:n.scale(B),value:B,payload:P}:{x:qn(B)?null:r.scale(B),y:NN({axis:n,ticks:d,bandSize:s,entry:P,index:k}),value:B,payload:P}});return Sc({points:C,layout:T},b)});var pQe=["layout","type","stroke","connectNulls","isRange","ref"],mQe=["key"],Kce;function Q0(e){"@babel/helpers - typeof";return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q0(e)}function Yce(e,t){if(e==null)return{};var r=gQe(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gQe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Oy(){return Oy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oy.apply(this,arguments)}function uK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uK(Object(r),!0).forEach(function(n){gh(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qce(n.key),n)}}function vQe(e,t,r){return t&&dK(e.prototype,t),r&&dK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _Qe(e,t,r){return t=tI(t),xQe(e,Jce()?Reflect.construct(t,r||[],tI(e).constructor):t.apply(e,r))}function xQe(e,t){if(t&&(Q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bQe(e)}function bQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Jce=function(){return!!e})()}function tI(e){return tI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tI(e)}function wQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Bz(e,t)}function Bz(e,t){return Bz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Bz(e,t)}function gh(e,t,r){return t=Qce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qce(e){var t=SQe(e,"string");return Q0(t)=="symbol"?t:t+""}function SQe(e,t){if(Q0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Q0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ig=function(e){function t(){var r;yQe(this,t);for(var n=arguments.length,a=new Array(n),d=0;d<n;d++)a[d]=arguments[d];return r=_Qe(this,t,[].concat(a)),gh(r,"state",{isAnimationFinished:!0}),gh(r,"id",jv("recharts-area-")),gh(r,"handleAnimationEnd",function(){var p=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),On(p)&&p()}),gh(r,"handleAnimationStart",function(){var p=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),On(p)&&p()}),r}return wQe(t,e),vQe(t,[{key:"renderDots",value:function(n,a,d){var p=this.props.isAnimationActive,s=this.state.isAnimationFinished;if(p&&!s)return null;var _=this.props,b=_.dot,T=_.points,C=_.dataKey,P=pn(this.props,!1),k=pn(b,!0),B=T.map(function(D,G){var V=Gp(Gp(Gp({key:"dot-".concat(G),r:3},P),k),{},{index:G,cx:D.x,cy:D.y,dataKey:C,value:D.value,payload:D.payload,points:T});return t.renderDotItem(b,V)}),R={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(d,")"):null};return De.createElement(vi,Oy({className:"recharts-area-dots"},R),B)}},{key:"renderHorizontalRect",value:function(n){var a=this.props,d=a.baseLine,p=a.points,s=a.strokeWidth,_=p[0].x,b=p[p.length-1].x,T=n*Math.abs(_-b),C=fm(p.map(function(P){return P.y||0}));return br(d)&&typeof d=="number"?C=Math.max(d,C):d&&Array.isArray(d)&&d.length&&(C=Math.max(fm(d.map(function(P){return P.y||0})),C)),br(C)?De.createElement("rect",{x:_<b?_:_-T,y:0,width:T,height:Math.floor(C+(s?parseInt("".concat(s),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var a=this.props,d=a.baseLine,p=a.points,s=a.strokeWidth,_=p[0].y,b=p[p.length-1].y,T=n*Math.abs(_-b),C=fm(p.map(function(P){return P.x||0}));return br(d)&&typeof d=="number"?C=Math.max(d,C):d&&Array.isArray(d)&&d.length&&(C=Math.max(fm(d.map(function(P){return P.x||0})),C)),br(C)?De.createElement("rect",{x:0,y:_<b?_:_-T,width:C+(s?parseInt("".concat(s),10):1),height:Math.floor(T)}):null}},{key:"renderClipRect",value:function(n){var a=this.props.layout;return a==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,a,d,p){var s=this.props,_=s.layout,b=s.type,T=s.stroke,C=s.connectNulls,P=s.isRange;s.ref;var k=Yce(s,pQe);return De.createElement(vi,{clipPath:d?"url(#clipPath-".concat(p,")"):null},De.createElement(Xy,Oy({},pn(k,!0),{points:n,connectNulls:C,type:b,baseLine:a,layout:_,stroke:"none",className:"recharts-area-area"})),T!=="none"&&De.createElement(Xy,Oy({},pn(this.props,!1),{className:"recharts-area-curve",layout:_,type:b,connectNulls:C,fill:"none",points:n})),T!=="none"&&P&&De.createElement(Xy,Oy({},pn(this.props,!1),{className:"recharts-area-curve",layout:_,type:b,connectNulls:C,fill:"none",points:a})))}},{key:"renderAreaWithAnimation",value:function(n,a){var d=this,p=this.props,s=p.points,_=p.baseLine,b=p.isAnimationActive,T=p.animationBegin,C=p.animationDuration,P=p.animationEasing,k=p.animationId,B=this.state,R=B.prevPoints,D=B.prevBaseLine;return De.createElement(Ed,{begin:T,duration:C,isActive:b,easing:P,from:{t:0},to:{t:1},key:"area-".concat(k),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(G){var V=G.t;if(R){var $=R.length/s.length,K=s.map(function(ie,ge){var fe=Math.floor(ge*$);if(R[fe]){var be=R[fe],ue=Qa(be.x,ie.x),Ce=Qa(be.y,ie.y);return Gp(Gp({},ie),{},{x:ue(V),y:Ce(V)})}return ie}),Y;if(br(_)&&typeof _=="number"){var ee=Qa(D,_);Y=ee(V)}else if(qn(_)||Cb(_)){var ae=Qa(D,0);Y=ae(V)}else Y=_.map(function(ie,ge){var fe=Math.floor(ge*$);if(D[fe]){var be=D[fe],ue=Qa(be.x,ie.x),Ce=Qa(be.y,ie.y);return Gp(Gp({},ie),{},{x:ue(V),y:Ce(V)})}return ie});return d.renderAreaStatically(K,Y,n,a)}return De.createElement(vi,null,De.createElement("defs",null,De.createElement("clipPath",{id:"animationClipPath-".concat(a)},d.renderClipRect(V))),De.createElement(vi,{clipPath:"url(#animationClipPath-".concat(a,")")},d.renderAreaStatically(s,_,n,a)))})}},{key:"renderArea",value:function(n,a){var d=this.props,p=d.points,s=d.baseLine,_=d.isAnimationActive,b=this.state,T=b.prevPoints,C=b.prevBaseLine,P=b.totalLength;return _&&p&&p.length&&(!T&&P>0||!dv(T,p)||!dv(C,s))?this.renderAreaWithAnimation(n,a):this.renderAreaStatically(p,s,n,a)}},{key:"render",value:function(){var n,a=this.props,d=a.hide,p=a.dot,s=a.points,_=a.className,b=a.top,T=a.left,C=a.xAxis,P=a.yAxis,k=a.width,B=a.height,R=a.isAnimationActive,D=a.id;if(d||!s||!s.length)return null;var G=this.state.isAnimationFinished,V=s.length===1,$=Zn("recharts-area",_),K=C&&C.allowDataOverflow,Y=P&&P.allowDataOverflow,ee=K||Y,ae=qn(D)?this.id:D,ie=(n=pn(p,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ge=ie.r,fe=ge===void 0?3:ge,be=ie.strokeWidth,ue=be===void 0?2:be,Ce=Dae(p)?p:{},ve=Ce.clipDot,ze=ve===void 0?!0:ve,Me=fe*2+ue;return De.createElement(vi,{className:$},K||Y?De.createElement("defs",null,De.createElement("clipPath",{id:"clipPath-".concat(ae)},De.createElement("rect",{x:K?T:T-k/2,y:Y?b:b-B/2,width:K?k:k*2,height:Y?B:B*2})),!ze&&De.createElement("clipPath",{id:"clipPath-dots-".concat(ae)},De.createElement("rect",{x:T-Me/2,y:b-Me/2,width:k+Me,height:B+Me}))):null,V?null:this.renderArea(ee,ae),(p||V)&&this.renderDots(ee,ze,ae),(!R||G)&&Th.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:a.curPoints,prevBaseLine:a.curBaseLine}:n.points!==a.curPoints||n.baseLine!==a.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(F.PureComponent);Kce=ig;gh(ig,"displayName","Area");gh(ig,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!eg.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});gh(ig,"getBaseValue",function(e,t,r,n){var a=e.layout,d=e.baseValue,p=t.props.baseValue,s=p??d;if(br(s)&&typeof s=="number")return s;var _=a==="horizontal"?n:r,b=_.scale.domain();if(_.type==="number"){var T=Math.max(b[0],b[1]),C=Math.min(b[0],b[1]);return s==="dataMin"?C:s==="dataMax"||T<0?T:Math.max(Math.min(b[0],b[1]),0)}return s==="dataMin"?b[0]:s==="dataMax"?b[1]:b[0]});gh(ig,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,a=e.yAxis,d=e.xAxisTicks,p=e.yAxisTicks,s=e.bandSize,_=e.dataKey,b=e.stackedData,T=e.dataStartIndex,C=e.displayedData,P=e.offset,k=t.layout,B=b&&b.length,R=Kce.getBaseValue(t,r,n,a),D=k==="horizontal",G=!1,V=C.map(function(K,Y){var ee;B?ee=b[T+Y]:(ee=ba(K,_),Array.isArray(ee)?G=!0:ee=[R,ee]);var ae=ee[1]==null||B&&ba(K,_)==null;return D?{x:NN({axis:n,ticks:d,bandSize:s,entry:K,index:Y}),y:ae?null:a.scale(ee[1]),value:ee,payload:K}:{x:ae?null:n.scale(ee[1]),y:NN({axis:a,ticks:p,bandSize:s,entry:K,index:Y}),value:ee,payload:K}}),$;return B||G?$=V.map(function(K){var Y=Array.isArray(K.value)?K.value[0]:null;return D?{x:K.x,y:Y!=null&&K.y!=null?a.scale(Y):null}:{x:Y!=null?n.scale(Y):null,y:K.y}}):$=D?a.scale(R):n.scale(R),Gp({points:V,baseLine:$,layout:k,isRange:G},P)});gh(ig,"renderDotItem",function(e,t){var r;if(De.isValidElement(e))r=De.cloneElement(e,t);else if(On(e))r=e(t);else{var n=Zn("recharts-area-dot",typeof e!="boolean"?e.className:""),a=t.key,d=Yce(t,mQe);r=De.createElement(mE,Oy({},d,{key:a,className:n}))}return r});function eb(e){"@babel/helpers - typeof";return eb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eb(e)}function TQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function EQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rue(n.key),n)}}function jQe(e,t,r){return t&&EQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function AQe(e,t,r){return t=rI(t),CQe(e,eue()?Reflect.construct(t,r||[],rI(e).constructor):t.apply(e,r))}function CQe(e,t){if(t&&(eb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PQe(e)}function PQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eue=function(){return!!e})()}function rI(e){return rI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rI(e)}function NQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$z(e,t)}function $z(e,t){return $z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},$z(e,t)}function tue(e,t,r){return t=rue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rue(e){var t=IQe(e,"string");return eb(t)=="symbol"?t:t+""}function IQe(e,t){if(eb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(eb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Vz(){return Vz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vz.apply(this,arguments)}function kQe(e){var t=e.xAxisId,r=R$(),n=M$(),a=Dce(t);return a==null?null:F.createElement(Mb,Vz({},a,{className:Zn("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(p){return bf(p,!0)}}))}var Lm=function(e){function t(){return TQe(this,t),AQe(this,t,arguments)}return NQe(t,e),jQe(t,[{key:"render",value:function(){return F.createElement(kQe,this.props)}}])}(F.Component);tue(Lm,"displayName","XAxis");tue(Lm,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function tb(e){"@babel/helpers - typeof";return tb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tb(e)}function OQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sue(n.key),n)}}function MQe(e,t,r){return t&&RQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function DQe(e,t,r){return t=nI(t),LQe(e,nue()?Reflect.construct(t,r||[],nI(e).constructor):t.apply(e,r))}function LQe(e,t){if(t&&(tb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FQe(e)}function FQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nue=function(){return!!e})()}function nI(e){return nI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},nI(e)}function zQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Uz(e,t)}function Uz(e,t){return Uz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Uz(e,t)}function iue(e,t,r){return t=sue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sue(e){var t=BQe(e,"string");return tb(t)=="symbol"?t:t+""}function BQe(e,t){if(tb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(tb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function qz(){return qz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qz.apply(this,arguments)}var $Qe=function(t){var r=t.yAxisId,n=R$(),a=M$(),d=Lce(r);return d==null?null:F.createElement(Mb,qz({},d,{className:Zn("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(s){return bf(s,!0)}}))},Fm=function(e){function t(){return OQe(this,t),DQe(this,t,arguments)}return zQe(t,e),MQe(t,[{key:"render",value:function(){return F.createElement($Qe,this.props)}}])}(F.Component);iue(Fm,"displayName","YAxis");iue(Fm,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function hK(e){return GQe(e)||qQe(e)||UQe(e)||VQe()}function VQe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UQe(e,t){if(e){if(typeof e=="string")return Gz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gz(e,t)}}function qQe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function GQe(e){if(Array.isArray(e))return Gz(e)}function Gz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Wz=function(t,r,n,a,d){var p=Fc(t,L$),s=Fc(t,eO),_=[].concat(hK(p),hK(s)),b=Fc(t,rO),T="".concat(a,"Id"),C=a[0],P=r;if(_.length&&(P=_.reduce(function(R,D){if(D.props[T]===n&&Eh(D.props,"extendDomain")&&br(D.props[C])){var G=D.props[C];return[Math.min(R[0],G),Math.max(R[1],G)]}return R},P)),b.length){var k="".concat(C,"1"),B="".concat(C,"2");P=b.reduce(function(R,D){if(D.props[T]===n&&Eh(D.props,"extendDomain")&&br(D.props[k])&&br(D.props[B])){var G=D.props[k],V=D.props[B];return[Math.min(R[0],G,V),Math.max(R[1],G,V)]}return R},P)}return d&&d.length&&(P=d.reduce(function(R,D){return br(D)?[Math.min(R[0],D),Math.max(R[1],D)]:R},P)),P},aue={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(_,b,T){this.fn=_,this.context=b,this.once=T||!1}function d(_,b,T,C,P){if(typeof T!="function")throw new TypeError("The listener must be a function");var k=new a(T,C||_,P),B=r?r+b:b;return _._events[B]?_._events[B].fn?_._events[B]=[_._events[B],k]:_._events[B].push(k):(_._events[B]=k,_._eventsCount++),_}function p(_,b){--_._eventsCount===0?_._events=new n:delete _._events[b]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var b=[],T,C;if(this._eventsCount===0)return b;for(C in T=this._events)t.call(T,C)&&b.push(r?C.slice(1):C);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(T)):b},s.prototype.listeners=function(b){var T=r?r+b:b,C=this._events[T];if(!C)return[];if(C.fn)return[C.fn];for(var P=0,k=C.length,B=new Array(k);P<k;P++)B[P]=C[P].fn;return B},s.prototype.listenerCount=function(b){var T=r?r+b:b,C=this._events[T];return C?C.fn?1:C.length:0},s.prototype.emit=function(b,T,C,P,k,B){var R=r?r+b:b;if(!this._events[R])return!1;var D=this._events[R],G=arguments.length,V,$;if(D.fn){switch(D.once&&this.removeListener(b,D.fn,void 0,!0),G){case 1:return D.fn.call(D.context),!0;case 2:return D.fn.call(D.context,T),!0;case 3:return D.fn.call(D.context,T,C),!0;case 4:return D.fn.call(D.context,T,C,P),!0;case 5:return D.fn.call(D.context,T,C,P,k),!0;case 6:return D.fn.call(D.context,T,C,P,k,B),!0}for($=1,V=new Array(G-1);$<G;$++)V[$-1]=arguments[$];D.fn.apply(D.context,V)}else{var K=D.length,Y;for($=0;$<K;$++)switch(D[$].once&&this.removeListener(b,D[$].fn,void 0,!0),G){case 1:D[$].fn.call(D[$].context);break;case 2:D[$].fn.call(D[$].context,T);break;case 3:D[$].fn.call(D[$].context,T,C);break;case 4:D[$].fn.call(D[$].context,T,C,P);break;default:if(!V)for(Y=1,V=new Array(G-1);Y<G;Y++)V[Y-1]=arguments[Y];D[$].fn.apply(D[$].context,V)}}return!0},s.prototype.on=function(b,T,C){return d(this,b,T,C,!1)},s.prototype.once=function(b,T,C){return d(this,b,T,C,!0)},s.prototype.removeListener=function(b,T,C,P){var k=r?r+b:b;if(!this._events[k])return this;if(!T)return p(this,k),this;var B=this._events[k];if(B.fn)B.fn===T&&(!P||B.once)&&(!C||B.context===C)&&p(this,k);else{for(var R=0,D=[],G=B.length;R<G;R++)(B[R].fn!==T||P&&!B[R].once||C&&B[R].context!==C)&&D.push(B[R]);D.length?this._events[k]=D.length===1?D[0]:D:p(this,k)}return this},s.prototype.removeAllListeners=function(b){var T;return b?(T=r?r+b:b,this._events[T]&&p(this,T)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(aue);var WQe=aue.exports;const HQe=es(WQe);var iL=new HQe,sL="recharts.syncMouseEvents";function T2(e){"@babel/helpers - typeof";return T2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T2(e)}function ZQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oue(n.key),n)}}function KQe(e,t,r){return t&&XQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aL(e,t,r){return t=oue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oue(e){var t=YQe(e,"string");return T2(t)=="symbol"?t:t+""}function YQe(e,t){if(T2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(T2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var JQe=function(){function e(){ZQe(this,e),aL(this,"activeIndex",0),aL(this,"coordinateList",[]),aL(this,"layout","horizontal")}return KQe(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,d=a===void 0?null:a,p=r.container,s=p===void 0?null:p,_=r.layout,b=_===void 0?null:_,T=r.offset,C=T===void 0?null:T,P=r.mouseHandlerCallback,k=P===void 0?null:P;this.coordinateList=(n=d??this.coordinateList)!==null&&n!==void 0?n:[],this.container=s??this.container,this.layout=b??this.layout,this.offset=C??this.offset,this.mouseHandlerCallback=k??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),d=a.x,p=a.y,s=a.height,_=this.coordinateList[this.activeIndex].coordinate,b=((r=window)===null||r===void 0?void 0:r.scrollX)||0,T=((n=window)===null||n===void 0?void 0:n.scrollY)||0,C=d+_+b,P=p+this.offset.top+s/2+T;this.mouseHandlerCallback({pageX:C,pageY:P})}}}])}();function QQe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],a=e==null?void 0:e[1];if(n&&a&&br(n)&&br(a))return!0}return!1}function eet(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function lue(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,d=e.endAngle,p=Es(t,r,n,a),s=Es(t,r,n,d);return{points:[p,s],cx:t,cy:r,radius:n,startAngle:a,endAngle:d}}function tet(e,t,r){var n,a,d,p;if(e==="horizontal")n=t.x,d=n,a=r.top,p=r.top+r.height;else if(e==="vertical")a=t.y,p=a,n=r.left,d=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var s=t.cx,_=t.cy,b=t.innerRadius,T=t.outerRadius,C=t.angle,P=Es(s,_,b,C),k=Es(s,_,T,C);n=P.x,a=P.y,d=k.x,p=k.y}else return lue(t);return[{x:n,y:a},{x:d,y:p}]}function E2(e){"@babel/helpers - typeof";return E2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E2(e)}function fK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function RC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fK(Object(r),!0).forEach(function(n){ret(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ret(e,t,r){return t=net(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function net(e){var t=iet(e,"string");return E2(t)=="symbol"?t:t+""}function iet(e,t){if(E2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(E2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function set(e){var t,r,n=e.element,a=e.tooltipEventType,d=e.isActive,p=e.activeCoordinate,s=e.activePayload,_=e.offset,b=e.activeTooltipIndex,T=e.tooltipAxisBandSize,C=e.layout,P=e.chartName,k=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!k||!d||!p||P!=="ScatterChart"&&a!=="axis")return null;var B,R=Xy;if(P==="ScatterChart")B=p,R=fZe;else if(P==="BarChart")B=eet(C,p,_,T),R=P$;else if(C==="radial"){var D=lue(p),G=D.cx,V=D.cy,$=D.radius,K=D.startAngle,Y=D.endAngle;B={cx:G,cy:V,startAngle:K,endAngle:Y,innerRadius:$,outerRadius:$},R=tce}else B={points:tet(C,p,_)},R=Xy;var ee=RC(RC(RC(RC({stroke:"#ccc",pointerEvents:"none"},_),B),pn(k,!1)),{},{payload:s,payloadIndex:b,className:Zn("recharts-tooltip-cursor",k.className)});return F.isValidElement(k)?F.cloneElement(k,ee):F.createElement(R,ee)}var aet=["item"],oet=["children","className","width","height","style","compact","title","desc"];function rb(e){"@babel/helpers - typeof";return rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rb(e)}function zx(){return zx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zx.apply(this,arguments)}function pK(e,t){return det(e)||uet(e,t)||uue(e,t)||cet()}function cet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uet(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,d,p,s=[],_=!0,b=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(_=(n=d.call(r)).done)&&(s.push(n.value),s.length!==t);_=!0);}catch(T){b=!0,a=T}finally{try{if(!_&&r.return!=null&&(p=r.return(),Object(p)!==p))return}finally{if(b)throw a}}return s}}function det(e){if(Array.isArray(e))return e}function mK(e,t){if(e==null)return{};var r=het(e,t),n,a;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(a=0;a<d.length;a++)n=d[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function het(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function fet(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pet(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,due(n.key),n)}}function met(e,t,r){return t&&pet(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function get(e,t,r){return t=iI(t),yet(e,cue()?Reflect.construct(t,r||[],iI(e).constructor):t.apply(e,r))}function yet(e,t){if(t&&(rb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vet(e)}function vet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cue=function(){return!!e})()}function iI(e){return iI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iI(e)}function _et(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Hz(e,t)}function Hz(e,t){return Hz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Hz(e,t)}function nb(e){return wet(e)||bet(e)||uue(e)||xet()}function xet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uue(e,t){if(e){if(typeof e=="string")return Zz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zz(e,t)}}function bet(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wet(e){if(Array.isArray(e))return Zz(e)}function Zz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gK(Object(r),!0).forEach(function(n){Nn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nn(e,t,r){return t=due(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function due(e){var t=Tet(e,"string");return rb(t)=="symbol"?t:t+""}function Tet(e,t){if(rb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(rb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Eet={xAxis:["bottom","top"],yAxis:["left","right"]},jet={width:"100%",height:"100%"},hue={x:0,y:0};function MC(e){return e}var Aet=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},Cet=function(t,r,n,a){var d=r.find(function(T){return T&&T.index===n});if(d){if(t==="horizontal")return{x:d.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:d.coordinate};if(t==="centric"){var p=d.coordinate,s=a.radius;return rr(rr(rr({},a),Es(a.cx,a.cy,s,p)),{},{angle:p,radius:s})}var _=d.coordinate,b=a.angle;return rr(rr(rr({},a),Es(a.cx,a.cy,_,b)),{},{angle:b,radius:_})}return hue},nO=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,d=r.dataEndIndex,p=(n??[]).reduce(function(s,_){var b=_.props.data;return b&&b.length?[].concat(nb(s),nb(b)):s},[]);return p.length>0?p:t&&t.length&&br(a)&&br(d)?t.slice(a,d+1):[]};function fue(e){return e==="number"?[0,"auto"]:void 0}var Xz=function(t,r,n,a){var d=t.graphicalItems,p=t.tooltipAxis,s=nO(r,t);return n<0||!d||!d.length||n>=s.length?null:d.reduce(function(_,b){var T,C=(T=b.props.data)!==null&&T!==void 0?T:r;C&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(C=C.slice(t.dataStartIndex,t.dataEndIndex+1));var P;if(p.dataKey&&!p.allowDuplicatedCategory){var k=C===void 0?s:C;P=rN(k,p.dataKey,a)}else P=C&&C[n]||s[n];return P?[].concat(nb(_),[Xle(b,P)]):_},[])},yK=function(t,r,n,a){var d=a||{x:t.chartX,y:t.chartY},p=Aet(d,n),s=t.orderedTooltipTicks,_=t.tooltipAxis,b=t.tooltipTicks,T=LWe(p,s,b,_);if(T>=0&&b){var C=b[T]&&b[T].value,P=Xz(t,r,T,C),k=Cet(n,s,T,d);return{activeTooltipIndex:T,activeLabel:C,activePayload:P,activeCoordinate:k}}return null},Pet=function(t,r){var n=r.axes,a=r.graphicalItems,d=r.axisType,p=r.axisIdKey,s=r.stackGroups,_=r.dataStartIndex,b=r.dataEndIndex,T=t.layout,C=t.children,P=t.stackOffset,k=Ule(T,d);return n.reduce(function(B,R){var D,G=R.type.defaultProps!==void 0?rr(rr({},R.type.defaultProps),R.props):R.props,V=G.type,$=G.dataKey,K=G.allowDataOverflow,Y=G.allowDuplicatedCategory,ee=G.scale,ae=G.ticks,ie=G.includeHidden,ge=G[p];if(B[ge])return B;var fe=nO(t.data,{graphicalItems:a.filter(function(yt){var Je,Bt=p in yt.props?yt.props[p]:(Je=yt.type.defaultProps)===null||Je===void 0?void 0:Je[p];return Bt===ge}),dataStartIndex:_,dataEndIndex:b}),be=fe.length,ue,Ce,ve;QQe(G.domain,K,V)&&(ue=lz(G.domain,null,K),k&&(V==="number"||ee!=="auto")&&(ve=QS(fe,$,"category")));var ze=fue(V);if(!ue||ue.length===0){var Me,Be=(Me=G.domain)!==null&&Me!==void 0?Me:ze;if($){if(ue=QS(fe,$,V),V==="category"&&k){var Ve=ADe(ue);Y&&Ve?(Ce=ue,ue=UN(0,be)):Y||(ue=LZ(Be,ue,R).reduce(function(yt,Je){return yt.indexOf(Je)>=0?yt:[].concat(nb(yt),[Je])},[]))}else if(V==="category")Y?ue=ue.filter(function(yt){return yt!==""&&!qn(yt)}):ue=LZ(Be,ue,R).reduce(function(yt,Je){return yt.indexOf(Je)>=0||Je===""||qn(Je)?yt:[].concat(nb(yt),[Je])},[]);else if(V==="number"){var We=VWe(fe,a.filter(function(yt){var Je,Bt,Pt=p in yt.props?yt.props[p]:(Je=yt.type.defaultProps)===null||Je===void 0?void 0:Je[p],pt="hide"in yt.props?yt.props.hide:(Bt=yt.type.defaultProps)===null||Bt===void 0?void 0:Bt.hide;return Pt===ge&&(ie||!pt)}),$,d,T);We&&(ue=We)}k&&(V==="number"||ee!=="auto")&&(ve=QS(fe,$,"category"))}else k?ue=UN(0,be):s&&s[ge]&&s[ge].hasStack&&V==="number"?ue=P==="expand"?[0,1]:Zle(s[ge].stackGroups,_,b):ue=Vle(fe,a.filter(function(yt){var Je=p in yt.props?yt.props[p]:yt.type.defaultProps[p],Bt="hide"in yt.props?yt.props.hide:yt.type.defaultProps.hide;return Je===ge&&(ie||!Bt)}),V,T,!0);if(V==="number")ue=Wz(C,ue,ge,d,ae),Be&&(ue=lz(Be,ue,K));else if(V==="category"&&Be){var Ee=Be,ot=ue.every(function(yt){return Ee.indexOf(yt)>=0});ot&&(ue=Ee)}}return rr(rr({},B),{},Nn({},ge,rr(rr({},G),{},{axisType:d,domain:ue,categoricalDomain:ve,duplicateDomain:Ce,originalDomain:(D=G.domain)!==null&&D!==void 0?D:ze,isCategorical:k,layout:T})))},{})},Net=function(t,r){var n=r.graphicalItems,a=r.Axis,d=r.axisType,p=r.axisIdKey,s=r.stackGroups,_=r.dataStartIndex,b=r.dataEndIndex,T=t.layout,C=t.children,P=nO(t.data,{graphicalItems:n,dataStartIndex:_,dataEndIndex:b}),k=P.length,B=Ule(T,d),R=-1;return n.reduce(function(D,G){var V=G.type.defaultProps!==void 0?rr(rr({},G.type.defaultProps),G.props):G.props,$=V[p],K=fue("number");if(!D[$]){R++;var Y;return B?Y=UN(0,k):s&&s[$]&&s[$].hasStack?(Y=Zle(s[$].stackGroups,_,b),Y=Wz(C,Y,$,d)):(Y=lz(K,Vle(P,n.filter(function(ee){var ae,ie,ge=p in ee.props?ee.props[p]:(ae=ee.type.defaultProps)===null||ae===void 0?void 0:ae[p],fe="hide"in ee.props?ee.props.hide:(ie=ee.type.defaultProps)===null||ie===void 0?void 0:ie.hide;return ge===$&&!fe}),"number",T),a.defaultProps.allowDataOverflow),Y=Wz(C,Y,$,d)),rr(rr({},D),{},Nn({},$,rr(rr({axisType:d},a.defaultProps),{},{hide:!0,orientation:Lc(Eet,"".concat(d,".").concat(R%2),null),domain:Y,originalDomain:K,isCategorical:B,layout:T})))}return D},{})},Iet=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,d=r.AxisComp,p=r.graphicalItems,s=r.stackGroups,_=r.dataStartIndex,b=r.dataEndIndex,T=t.children,C="".concat(a,"Id"),P=Fc(T,d),k={};return P&&P.length?k=Pet(t,{axes:P,graphicalItems:p,axisType:a,axisIdKey:C,stackGroups:s,dataStartIndex:_,dataEndIndex:b}):p&&p.length&&(k=Net(t,{Axis:d,graphicalItems:p,axisType:a,axisIdKey:C,stackGroups:s,dataStartIndex:_,dataEndIndex:b})),k},ket=function(t){var r=em(t),n=bf(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:r$(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:IN(r,n)}},vK=function(t){var r=t.children,n=t.defaultShowTooltip,a=jc(r,W0),d=0,p=0;return t.data&&t.data.length!==0&&(p=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(d=a.props.startIndex),a.props.endIndex>=0&&(p=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:d,dataEndIndex:p,activeTooltipIndex:-1,isTooltipActive:!!n}},Oet=function(t){return!t||!t.length?!1:t.some(function(r){var n=jf(r&&r.type);return n&&n.indexOf("Bar")>=0})},_K=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Ret=function(t,r){var n=t.props,a=t.graphicalItems,d=t.xAxisMap,p=d===void 0?{}:d,s=t.yAxisMap,_=s===void 0?{}:s,b=n.width,T=n.height,C=n.children,P=n.margin||{},k=jc(C,W0),B=jc(C,Qx),R=Object.keys(_).reduce(function(Y,ee){var ae=_[ee],ie=ae.orientation;return!ae.mirror&&!ae.hide?rr(rr({},Y),{},Nn({},ie,Y[ie]+ae.width)):Y},{left:P.left||0,right:P.right||0}),D=Object.keys(p).reduce(function(Y,ee){var ae=p[ee],ie=ae.orientation;return!ae.mirror&&!ae.hide?rr(rr({},Y),{},Nn({},ie,Lc(Y,"".concat(ie))+ae.height)):Y},{top:P.top||0,bottom:P.bottom||0}),G=rr(rr({},D),R),V=G.bottom;k&&(G.bottom+=k.props.height||W0.defaultProps.height),B&&r&&(G=BWe(G,a,n,r));var $=b-G.left-G.right,K=T-G.top-G.bottom;return rr(rr({brushBottom:V},G),{},{width:Math.max($,0),height:Math.max(K,0)})},Met=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},iO=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,d=a===void 0?"axis":a,p=t.validateTooltipEventTypes,s=p===void 0?["axis"]:p,_=t.axisComponents,b=t.legendContent,T=t.formatAxisMap,C=t.defaultProps,P=function(G,V){var $=V.graphicalItems,K=V.stackGroups,Y=V.offset,ee=V.updateId,ae=V.dataStartIndex,ie=V.dataEndIndex,ge=G.barSize,fe=G.layout,be=G.barGap,ue=G.barCategoryGap,Ce=G.maxBarSize,ve=_K(fe),ze=ve.numericAxisName,Me=ve.cateAxisName,Be=Oet($),Ve=[];return $.forEach(function(We,Ee){var ot=nO(G.data,{graphicalItems:[We],dataStartIndex:ae,dataEndIndex:ie}),yt=We.type.defaultProps!==void 0?rr(rr({},We.type.defaultProps),We.props):We.props,Je=yt.dataKey,Bt=yt.maxBarSize,Pt=yt["".concat(ze,"Id")],pt=yt["".concat(Me,"Id")],Gt={},Pr=_.reduce(function(Ct,Xt){var Sr=V["".concat(Xt.axisType,"Map")],yr=yt["".concat(Xt.axisType,"Id")];Sr&&Sr[yr]||Xt.axisType==="zAxis"||fv();var hr=Sr[yr];return rr(rr({},Ct),{},Nn(Nn({},Xt.axisType,hr),"".concat(Xt.axisType,"Ticks"),bf(hr)))},Gt),Ot=Pr[Me],nr=Pr["".concat(Me,"Ticks")],ur=K&&K[Pt]&&K[Pt].hasStack&&YWe(We,K[Pt].stackGroups),Et=jf(We.type).indexOf("Bar")>=0,pr=IN(Ot,nr),Kr=[],Xn=Be&&FWe({barSize:ge,stackGroups:K,totalSize:Met(Pr,Me)});if(Et){var Jn,ni,zn=qn(Bt)?Ce:Bt,hs=(Jn=(ni=IN(Ot,nr,!0))!==null&&ni!==void 0?ni:zn)!==null&&Jn!==void 0?Jn:0;Kr=zWe({barGap:be,barCategoryGap:ue,bandSize:hs!==pr?hs:pr,sizeList:Xn[pt],maxBarSize:zn}),hs!==pr&&(Kr=Kr.map(function(Ct){return rr(rr({},Ct),{},{position:rr(rr({},Ct.position),{},{offset:Ct.position.offset-hs/2})})}))}var lt=We&&We.type&&We.type.getComposedData;lt&&Ve.push({props:rr(rr({},lt(rr(rr({},Pr),{},{displayedData:ot,props:G,dataKey:Je,item:We,bandSize:pr,barPosition:Kr,offset:Y,stackedData:ur,layout:fe,dataStartIndex:ae,dataEndIndex:ie}))),{},Nn(Nn(Nn({key:We.key||"item-".concat(Ee)},ze,Pr[ze]),Me,Pr[Me]),"animationId",ee)),childIndex:zDe(We,G.children),item:We})}),Ve},k=function(G,V){var $=G.props,K=G.dataStartIndex,Y=G.dataEndIndex,ee=G.updateId;if(!IH({props:$}))return null;var ae=$.children,ie=$.layout,ge=$.stackOffset,fe=$.data,be=$.reverseStackOrder,ue=_K(ie),Ce=ue.numericAxisName,ve=ue.cateAxisName,ze=Fc(ae,n),Me=XWe(fe,ze,"".concat(Ce,"Id"),"".concat(ve,"Id"),ge,be),Be=_.reduce(function(yt,Je){var Bt="".concat(Je.axisType,"Map");return rr(rr({},yt),{},Nn({},Bt,Iet($,rr(rr({},Je),{},{graphicalItems:ze,stackGroups:Je.axisType===Ce&&Me,dataStartIndex:K,dataEndIndex:Y}))))},{}),Ve=Ret(rr(rr({},Be),{},{props:$,graphicalItems:ze}),V==null?void 0:V.legendBBox);Object.keys(Be).forEach(function(yt){Be[yt]=T($,Be[yt],Ve,yt.replace("Map",""),r)});var We=Be["".concat(ve,"Map")],Ee=ket(We),ot=P($,rr(rr({},Be),{},{dataStartIndex:K,dataEndIndex:Y,updateId:ee,graphicalItems:ze,stackGroups:Me,offset:Ve}));return rr(rr({formattedGraphicalItems:ot,graphicalItems:ze,offset:Ve,stackGroups:Me},Ee),Be)},B=function(D){function G(V){var $,K,Y;return fet(this,G),Y=get(this,G,[V]),Nn(Y,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Nn(Y,"accessibilityManager",new JQe),Nn(Y,"handleLegendBBoxUpdate",function(ee){if(ee){var ae=Y.state,ie=ae.dataStartIndex,ge=ae.dataEndIndex,fe=ae.updateId;Y.setState(rr({legendBBox:ee},k({props:Y.props,dataStartIndex:ie,dataEndIndex:ge,updateId:fe},rr(rr({},Y.state),{},{legendBBox:ee}))))}}),Nn(Y,"handleReceiveSyncEvent",function(ee,ae,ie){if(Y.props.syncId===ee){if(ie===Y.eventEmitterSymbol&&typeof Y.props.syncMethod!="function")return;Y.applySyncEvent(ae)}}),Nn(Y,"handleBrushChange",function(ee){var ae=ee.startIndex,ie=ee.endIndex;if(ae!==Y.state.dataStartIndex||ie!==Y.state.dataEndIndex){var ge=Y.state.updateId;Y.setState(function(){return rr({dataStartIndex:ae,dataEndIndex:ie},k({props:Y.props,dataStartIndex:ae,dataEndIndex:ie,updateId:ge},Y.state))}),Y.triggerSyncEvent({dataStartIndex:ae,dataEndIndex:ie})}}),Nn(Y,"handleMouseEnter",function(ee){var ae=Y.getMouseInfo(ee);if(ae){var ie=rr(rr({},ae),{},{isTooltipActive:!0});Y.setState(ie),Y.triggerSyncEvent(ie);var ge=Y.props.onMouseEnter;On(ge)&&ge(ie,ee)}}),Nn(Y,"triggeredAfterMouseMove",function(ee){var ae=Y.getMouseInfo(ee),ie=ae?rr(rr({},ae),{},{isTooltipActive:!0}):{isTooltipActive:!1};Y.setState(ie),Y.triggerSyncEvent(ie);var ge=Y.props.onMouseMove;On(ge)&&ge(ie,ee)}),Nn(Y,"handleItemMouseEnter",function(ee){Y.setState(function(){return{isTooltipActive:!0,activeItem:ee,activePayload:ee.tooltipPayload,activeCoordinate:ee.tooltipPosition||{x:ee.cx,y:ee.cy}}})}),Nn(Y,"handleItemMouseLeave",function(){Y.setState(function(){return{isTooltipActive:!1}})}),Nn(Y,"handleMouseMove",function(ee){ee.persist(),Y.throttleTriggeredAfterMouseMove(ee)}),Nn(Y,"handleMouseLeave",function(ee){Y.throttleTriggeredAfterMouseMove.cancel();var ae={isTooltipActive:!1};Y.setState(ae),Y.triggerSyncEvent(ae);var ie=Y.props.onMouseLeave;On(ie)&&ie(ae,ee)}),Nn(Y,"handleOuterEvent",function(ee){var ae=FDe(ee),ie=Lc(Y.props,"".concat(ae));if(ae&&On(ie)){var ge,fe;/.*touch.*/i.test(ae)?fe=Y.getMouseInfo(ee.changedTouches[0]):fe=Y.getMouseInfo(ee),ie((ge=fe)!==null&&ge!==void 0?ge:{},ee)}}),Nn(Y,"handleClick",function(ee){var ae=Y.getMouseInfo(ee);if(ae){var ie=rr(rr({},ae),{},{isTooltipActive:!0});Y.setState(ie),Y.triggerSyncEvent(ie);var ge=Y.props.onClick;On(ge)&&ge(ie,ee)}}),Nn(Y,"handleMouseDown",function(ee){var ae=Y.props.onMouseDown;if(On(ae)){var ie=Y.getMouseInfo(ee);ae(ie,ee)}}),Nn(Y,"handleMouseUp",function(ee){var ae=Y.props.onMouseUp;if(On(ae)){var ie=Y.getMouseInfo(ee);ae(ie,ee)}}),Nn(Y,"handleTouchMove",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.throttleTriggeredAfterMouseMove(ee.changedTouches[0])}),Nn(Y,"handleTouchStart",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.handleMouseDown(ee.changedTouches[0])}),Nn(Y,"handleTouchEnd",function(ee){ee.changedTouches!=null&&ee.changedTouches.length>0&&Y.handleMouseUp(ee.changedTouches[0])}),Nn(Y,"handleDoubleClick",function(ee){var ae=Y.props.onDoubleClick;if(On(ae)){var ie=Y.getMouseInfo(ee);ae(ie,ee)}}),Nn(Y,"handleContextMenu",function(ee){var ae=Y.props.onContextMenu;if(On(ae)){var ie=Y.getMouseInfo(ee);ae(ie,ee)}}),Nn(Y,"triggerSyncEvent",function(ee){Y.props.syncId!==void 0&&iL.emit(sL,Y.props.syncId,ee,Y.eventEmitterSymbol)}),Nn(Y,"applySyncEvent",function(ee){var ae=Y.props,ie=ae.layout,ge=ae.syncMethod,fe=Y.state.updateId,be=ee.dataStartIndex,ue=ee.dataEndIndex;if(ee.dataStartIndex!==void 0||ee.dataEndIndex!==void 0)Y.setState(rr({dataStartIndex:be,dataEndIndex:ue},k({props:Y.props,dataStartIndex:be,dataEndIndex:ue,updateId:fe},Y.state)));else if(ee.activeTooltipIndex!==void 0){var Ce=ee.chartX,ve=ee.chartY,ze=ee.activeTooltipIndex,Me=Y.state,Be=Me.offset,Ve=Me.tooltipTicks;if(!Be)return;if(typeof ge=="function")ze=ge(Ve,ee);else if(ge==="value"){ze=-1;for(var We=0;We<Ve.length;We++)if(Ve[We].value===ee.activeLabel){ze=We;break}}var Ee=rr(rr({},Be),{},{x:Be.left,y:Be.top}),ot=Math.min(Ce,Ee.x+Ee.width),yt=Math.min(ve,Ee.y+Ee.height),Je=Ve[ze]&&Ve[ze].value,Bt=Xz(Y.state,Y.props.data,ze),Pt=Ve[ze]?{x:ie==="horizontal"?Ve[ze].coordinate:ot,y:ie==="horizontal"?yt:Ve[ze].coordinate}:hue;Y.setState(rr(rr({},ee),{},{activeLabel:Je,activeCoordinate:Pt,activePayload:Bt,activeTooltipIndex:ze}))}else Y.setState(ee)}),Nn(Y,"renderCursor",function(ee){var ae,ie=Y.state,ge=ie.isTooltipActive,fe=ie.activeCoordinate,be=ie.activePayload,ue=ie.offset,Ce=ie.activeTooltipIndex,ve=ie.tooltipAxisBandSize,ze=Y.getTooltipEventType(),Me=(ae=ee.props.active)!==null&&ae!==void 0?ae:ge,Be=Y.props.layout,Ve=ee.key||"_recharts-cursor";return De.createElement(set,{key:Ve,activeCoordinate:fe,activePayload:be,activeTooltipIndex:Ce,chartName:r,element:ee,isActive:Me,layout:Be,offset:ue,tooltipAxisBandSize:ve,tooltipEventType:ze})}),Nn(Y,"renderPolarAxis",function(ee,ae,ie){var ge=Lc(ee,"type.axisType"),fe=Lc(Y.state,"".concat(ge,"Map")),be=ee.type.defaultProps,ue=be!==void 0?rr(rr({},be),ee.props):ee.props,Ce=fe&&fe[ue["".concat(ge,"Id")]];return F.cloneElement(ee,rr(rr({},Ce),{},{className:Zn(ge,Ce.className),key:ee.key||"".concat(ae,"-").concat(ie),ticks:bf(Ce,!0)}))}),Nn(Y,"renderPolarGrid",function(ee){var ae=ee.props,ie=ae.radialLines,ge=ae.polarAngles,fe=ae.polarRadius,be=Y.state,ue=be.radiusAxisMap,Ce=be.angleAxisMap,ve=em(ue),ze=em(Ce),Me=ze.cx,Be=ze.cy,Ve=ze.innerRadius,We=ze.outerRadius;return F.cloneElement(ee,{polarAngles:Array.isArray(ge)?ge:bf(ze,!0).map(function(Ee){return Ee.coordinate}),polarRadius:Array.isArray(fe)?fe:bf(ve,!0).map(function(Ee){return Ee.coordinate}),cx:Me,cy:Be,innerRadius:Ve,outerRadius:We,key:ee.key||"polar-grid",radialLines:ie})}),Nn(Y,"renderLegend",function(){var ee=Y.state.formattedGraphicalItems,ae=Y.props,ie=ae.children,ge=ae.width,fe=ae.height,be=Y.props.margin||{},ue=ge-(be.left||0)-(be.right||0),Ce=Ble({children:ie,formattedGraphicalItems:ee,legendWidth:ue,legendContent:b});if(!Ce)return null;var ve=Ce.item,ze=mK(Ce,aet);return F.cloneElement(ve,rr(rr({},ze),{},{chartWidth:ge,chartHeight:fe,margin:be,onBBoxUpdate:Y.handleLegendBBoxUpdate}))}),Nn(Y,"renderTooltip",function(){var ee,ae=Y.props,ie=ae.children,ge=ae.accessibilityLayer,fe=jc(ie,nc);if(!fe)return null;var be=Y.state,ue=be.isTooltipActive,Ce=be.activeCoordinate,ve=be.activePayload,ze=be.activeLabel,Me=be.offset,Be=(ee=fe.props.active)!==null&&ee!==void 0?ee:ue;return F.cloneElement(fe,{viewBox:rr(rr({},Me),{},{x:Me.left,y:Me.top}),active:Be,label:ze,payload:Be?ve:[],coordinate:Ce,accessibilityLayer:ge})}),Nn(Y,"renderBrush",function(ee){var ae=Y.props,ie=ae.margin,ge=ae.data,fe=Y.state,be=fe.offset,ue=fe.dataStartIndex,Ce=fe.dataEndIndex,ve=fe.updateId;return F.cloneElement(ee,{key:ee.key||"_recharts-brush",onChange:NC(Y.handleBrushChange,ee.props.onChange),data:ge,x:br(ee.props.x)?ee.props.x:be.left,y:br(ee.props.y)?ee.props.y:be.top+be.height+be.brushBottom-(ie.bottom||0),width:br(ee.props.width)?ee.props.width:be.width,startIndex:ue,endIndex:Ce,updateId:"brush-".concat(ve)})}),Nn(Y,"renderReferenceElement",function(ee,ae,ie){if(!ee)return null;var ge=Y,fe=ge.clipPathId,be=Y.state,ue=be.xAxisMap,Ce=be.yAxisMap,ve=be.offset,ze=ee.type.defaultProps||{},Me=ee.props,Be=Me.xAxisId,Ve=Be===void 0?ze.xAxisId:Be,We=Me.yAxisId,Ee=We===void 0?ze.yAxisId:We;return F.cloneElement(ee,{key:ee.key||"".concat(ae,"-").concat(ie),xAxis:ue[Ve],yAxis:Ce[Ee],viewBox:{x:ve.left,y:ve.top,width:ve.width,height:ve.height},clipPathId:fe})}),Nn(Y,"renderActivePoints",function(ee){var ae=ee.item,ie=ee.activePoint,ge=ee.basePoint,fe=ee.childIndex,be=ee.isRange,ue=[],Ce=ae.props.key,ve=ae.item.type.defaultProps!==void 0?rr(rr({},ae.item.type.defaultProps),ae.item.props):ae.item.props,ze=ve.activeDot,Me=ve.dataKey,Be=rr(rr({index:fe,dataKey:Me,cx:ie.x,cy:ie.y,r:4,fill:C$(ae.item),strokeWidth:2,stroke:"#fff",payload:ie.payload,value:ie.value},pn(ze,!1)),nN(ze));return ue.push(G.renderActiveDot(ze,Be,"".concat(Ce,"-activePoint-").concat(fe))),ge?ue.push(G.renderActiveDot(ze,rr(rr({},Be),{},{cx:ge.x,cy:ge.y}),"".concat(Ce,"-basePoint-").concat(fe))):be&&ue.push(null),ue}),Nn(Y,"renderGraphicChild",function(ee,ae,ie){var ge=Y.filterFormatItem(ee,ae,ie);if(!ge)return null;var fe=Y.getTooltipEventType(),be=Y.state,ue=be.isTooltipActive,Ce=be.tooltipAxis,ve=be.activeTooltipIndex,ze=be.activeLabel,Me=Y.props.children,Be=jc(Me,nc),Ve=ge.props,We=Ve.points,Ee=Ve.isRange,ot=Ve.baseLine,yt=ge.item.type.defaultProps!==void 0?rr(rr({},ge.item.type.defaultProps),ge.item.props):ge.item.props,Je=yt.activeDot,Bt=yt.hide,Pt=yt.activeBar,pt=yt.activeShape,Gt=!!(!Bt&&ue&&Be&&(Je||Pt||pt)),Pr={};fe!=="axis"&&Be&&Be.props.trigger==="click"?Pr={onClick:NC(Y.handleItemMouseEnter,ee.props.onClick)}:fe!=="axis"&&(Pr={onMouseLeave:NC(Y.handleItemMouseLeave,ee.props.onMouseLeave),onMouseEnter:NC(Y.handleItemMouseEnter,ee.props.onMouseEnter)});var Ot=F.cloneElement(ee,rr(rr({},ge.props),Pr));function nr(Xt){return typeof Ce.dataKey=="function"?Ce.dataKey(Xt.payload):null}if(Gt)if(ve>=0){var ur,Et;if(Ce.dataKey&&!Ce.allowDuplicatedCategory){var pr=typeof Ce.dataKey=="function"?nr:"payload.".concat(Ce.dataKey.toString());ur=rN(We,pr,ze),Et=Ee&&ot&&rN(ot,pr,ze)}else ur=We==null?void 0:We[ve],Et=Ee&&ot&&ot[ve];if(pt||Pt){var Kr=ee.props.activeIndex!==void 0?ee.props.activeIndex:ve;return[F.cloneElement(ee,rr(rr(rr({},ge.props),Pr),{},{activeIndex:Kr})),null,null]}if(!qn(ur))return[Ot].concat(nb(Y.renderActivePoints({item:ge,activePoint:ur,basePoint:Et,childIndex:ve,isRange:Ee})))}else{var Xn,Jn=(Xn=Y.getItemByXY(Y.state.activeCoordinate))!==null&&Xn!==void 0?Xn:{graphicalItem:Ot},ni=Jn.graphicalItem,zn=ni.item,hs=zn===void 0?ee:zn,lt=ni.childIndex,Ct=rr(rr(rr({},ge.props),Pr),{},{activeIndex:lt});return[F.cloneElement(hs,Ct),null,null]}return Ee?[Ot,null,null]:[Ot,null]}),Nn(Y,"renderCustomized",function(ee,ae,ie){return F.cloneElement(ee,rr(rr({key:"recharts-customized-".concat(ie)},Y.props),Y.state))}),Nn(Y,"renderMap",{CartesianGrid:{handler:MC,once:!0},ReferenceArea:{handler:Y.renderReferenceElement},ReferenceLine:{handler:MC},ReferenceDot:{handler:Y.renderReferenceElement},XAxis:{handler:MC},YAxis:{handler:MC},Brush:{handler:Y.renderBrush,once:!0},Bar:{handler:Y.renderGraphicChild},Line:{handler:Y.renderGraphicChild},Area:{handler:Y.renderGraphicChild},Radar:{handler:Y.renderGraphicChild},RadialBar:{handler:Y.renderGraphicChild},Scatter:{handler:Y.renderGraphicChild},Pie:{handler:Y.renderGraphicChild},Funnel:{handler:Y.renderGraphicChild},Tooltip:{handler:Y.renderCursor,once:!0},PolarGrid:{handler:Y.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Y.renderPolarAxis},PolarRadiusAxis:{handler:Y.renderPolarAxis},Customized:{handler:Y.renderCustomized}}),Y.clipPathId="".concat(($=V.id)!==null&&$!==void 0?$:jv("recharts"),"-clip"),Y.throttleTriggeredAfterMouseMove=zoe(Y.triggeredAfterMouseMove,(K=V.throttleDelay)!==null&&K!==void 0?K:1e3/60),Y.state={},Y}return _et(G,D),met(G,[{key:"componentDidMount",value:function(){var $,K;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:($=this.props.margin.left)!==null&&$!==void 0?$:0,top:(K=this.props.margin.top)!==null&&K!==void 0?K:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var $=this.props,K=$.children,Y=$.data,ee=$.height,ae=$.layout,ie=jc(K,nc);if(ie){var ge=ie.props.defaultIndex;if(!(typeof ge!="number"||ge<0||ge>this.state.tooltipTicks.length-1)){var fe=this.state.tooltipTicks[ge]&&this.state.tooltipTicks[ge].value,be=Xz(this.state,Y,ge,fe),ue=this.state.tooltipTicks[ge].coordinate,Ce=(this.state.offset.top+ee)/2,ve=ae==="horizontal",ze=ve?{x:ue,y:Ce}:{y:ue,x:Ce},Me=this.state.formattedGraphicalItems.find(function(Ve){var We=Ve.item;return We.type.name==="Scatter"});Me&&(ze=rr(rr({},ze),Me.props.points[ge].tooltipPosition),be=Me.props.points[ge].tooltipPayload);var Be={activeTooltipIndex:ge,isTooltipActive:!0,activeLabel:fe,activePayload:be,activeCoordinate:ze};this.setState(Be),this.renderCursor(ie),this.accessibilityManager.setIndex(ge)}}}},{key:"getSnapshotBeforeUpdate",value:function($,K){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==K.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==$.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==$.margin){var Y,ee;this.accessibilityManager.setDetails({offset:{left:(Y=this.props.margin.left)!==null&&Y!==void 0?Y:0,top:(ee=this.props.margin.top)!==null&&ee!==void 0?ee:0}})}return null}},{key:"componentDidUpdate",value:function($){SF([jc($.children,nc)],[jc(this.props.children,nc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var $=jc(this.props.children,nc);if($&&typeof $.props.shared=="boolean"){var K=$.props.shared?"axis":"item";return s.indexOf(K)>=0?K:d}return d}},{key:"getMouseInfo",value:function($){if(!this.container)return null;var K=this.container,Y=K.getBoundingClientRect(),ee=dUe(Y),ae={chartX:Math.round($.pageX-ee.left),chartY:Math.round($.pageY-ee.top)},ie=Y.width/K.offsetWidth||1,ge=this.inRange(ae.chartX,ae.chartY,ie);if(!ge)return null;var fe=this.state,be=fe.xAxisMap,ue=fe.yAxisMap,Ce=this.getTooltipEventType(),ve=yK(this.state,this.props.data,this.props.layout,ge);if(Ce!=="axis"&&be&&ue){var ze=em(be).scale,Me=em(ue).scale,Be=ze&&ze.invert?ze.invert(ae.chartX):null,Ve=Me&&Me.invert?Me.invert(ae.chartY):null;return rr(rr({},ae),{},{xValue:Be,yValue:Ve},ve)}return ve?rr(rr({},ae),ve):null}},{key:"inRange",value:function($,K){var Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ee=this.props.layout,ae=$/Y,ie=K/Y;if(ee==="horizontal"||ee==="vertical"){var ge=this.state.offset,fe=ae>=ge.left&&ae<=ge.left+ge.width&&ie>=ge.top&&ie<=ge.top+ge.height;return fe?{x:ae,y:ie}:null}var be=this.state,ue=be.angleAxisMap,Ce=be.radiusAxisMap;if(ue&&Ce){var ve=em(ue);return BZ({x:ae,y:ie},ve)}return null}},{key:"parseEventsOfWrapper",value:function(){var $=this.props.children,K=this.getTooltipEventType(),Y=jc($,nc),ee={};Y&&K==="axis"&&(Y.props.trigger==="click"?ee={onClick:this.handleClick}:ee={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ae=nN(this.props,this.handleOuterEvent);return rr(rr({},ae),ee)}},{key:"addListener",value:function(){iL.on(sL,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){iL.removeListener(sL,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function($,K,Y){for(var ee=this.state.formattedGraphicalItems,ae=0,ie=ee.length;ae<ie;ae++){var ge=ee[ae];if(ge.item===$||ge.props.key===$.key||K===jf(ge.item.type)&&Y===ge.childIndex)return ge}return null}},{key:"renderClipPath",value:function(){var $=this.clipPathId,K=this.state.offset,Y=K.left,ee=K.top,ae=K.height,ie=K.width;return De.createElement("defs",null,De.createElement("clipPath",{id:$},De.createElement("rect",{x:Y,y:ee,height:ae,width:ie})))}},{key:"getXScales",value:function(){var $=this.state.xAxisMap;return $?Object.entries($).reduce(function(K,Y){var ee=pK(Y,2),ae=ee[0],ie=ee[1];return rr(rr({},K),{},Nn({},ae,ie.scale))},{}):null}},{key:"getYScales",value:function(){var $=this.state.yAxisMap;return $?Object.entries($).reduce(function(K,Y){var ee=pK(Y,2),ae=ee[0],ie=ee[1];return rr(rr({},K),{},Nn({},ae,ie.scale))},{}):null}},{key:"getXScaleByAxisId",value:function($){var K;return(K=this.state.xAxisMap)===null||K===void 0||(K=K[$])===null||K===void 0?void 0:K.scale}},{key:"getYScaleByAxisId",value:function($){var K;return(K=this.state.yAxisMap)===null||K===void 0||(K=K[$])===null||K===void 0?void 0:K.scale}},{key:"getItemByXY",value:function($){var K=this.state,Y=K.formattedGraphicalItems,ee=K.activeItem;if(Y&&Y.length)for(var ae=0,ie=Y.length;ae<ie;ae++){var ge=Y[ae],fe=ge.props,be=ge.item,ue=be.type.defaultProps!==void 0?rr(rr({},be.type.defaultProps),be.props):be.props,Ce=jf(be.type);if(Ce==="Bar"){var ve=(fe.data||[]).find(function(Ve){return H7e($,Ve)});if(ve)return{graphicalItem:ge,payload:ve}}else if(Ce==="RadialBar"){var ze=(fe.data||[]).find(function(Ve){return BZ($,Ve)});if(ze)return{graphicalItem:ge,payload:ze}}else if(Kk(ge,ee)||Yk(ge,ee)||_2(ge,ee)){var Me=MXe({graphicalItem:ge,activeTooltipItem:ee,itemData:ue.data}),Be=ue.activeIndex===void 0?Me:ue.activeIndex;return{graphicalItem:rr(rr({},ge),{},{childIndex:Be}),payload:_2(ge,ee)?ue.data[Me]:ge.props.data[Me]}}}return null}},{key:"render",value:function(){var $=this;if(!IH(this))return null;var K=this.props,Y=K.children,ee=K.className,ae=K.width,ie=K.height,ge=K.style,fe=K.compact,be=K.title,ue=K.desc,Ce=mK(K,oet),ve=pn(Ce,!1);if(fe)return De.createElement(ZX,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement(EF,zx({},ve,{width:ae,height:ie,title:be,desc:ue}),this.renderClipPath(),OH(Y,this.renderMap)));if(this.props.accessibilityLayer){var ze,Me;ve.tabIndex=(ze=this.props.tabIndex)!==null&&ze!==void 0?ze:0,ve.role=(Me=this.props.role)!==null&&Me!==void 0?Me:"application",ve.onKeyDown=function(Ve){$.accessibilityManager.keyboardEvent(Ve)},ve.onFocus=function(){$.accessibilityManager.focus()}}var Be=this.parseEventsOfWrapper();return De.createElement(ZX,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement("div",zx({className:Zn("recharts-wrapper",ee),style:rr({position:"relative",cursor:"default",width:ae,height:ie},ge)},Be,{ref:function(We){$.container=We}}),De.createElement(EF,zx({},ve,{width:ae,height:ie,title:be,desc:ue,style:jet}),this.renderClipPath(),OH(Y,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(F.Component);Nn(B,"displayName",r),Nn(B,"defaultProps",rr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},C)),Nn(B,"getDerivedStateFromProps",function(D,G){var V=D.dataKey,$=D.data,K=D.children,Y=D.width,ee=D.height,ae=D.layout,ie=D.stackOffset,ge=D.margin,fe=G.dataStartIndex,be=G.dataEndIndex;if(G.updateId===void 0){var ue=vK(D);return rr(rr(rr({},ue),{},{updateId:0},k(rr(rr({props:D},ue),{},{updateId:0}),G)),{},{prevDataKey:V,prevData:$,prevWidth:Y,prevHeight:ee,prevLayout:ae,prevStackOffset:ie,prevMargin:ge,prevChildren:K})}if(V!==G.prevDataKey||$!==G.prevData||Y!==G.prevWidth||ee!==G.prevHeight||ae!==G.prevLayout||ie!==G.prevStackOffset||!Jx(ge,G.prevMargin)){var Ce=vK(D),ve={chartX:G.chartX,chartY:G.chartY,isTooltipActive:G.isTooltipActive},ze=rr(rr({},yK(G,$,ae)),{},{updateId:G.updateId+1}),Me=rr(rr(rr({},Ce),ve),ze);return rr(rr(rr({},Me),k(rr({props:D},Me),G)),{},{prevDataKey:V,prevData:$,prevWidth:Y,prevHeight:ee,prevLayout:ae,prevStackOffset:ie,prevMargin:ge,prevChildren:K})}if(!SF(K,G.prevChildren)){var Be,Ve,We,Ee,ot=jc(K,W0),yt=ot&&(Be=(Ve=ot.props)===null||Ve===void 0?void 0:Ve.startIndex)!==null&&Be!==void 0?Be:fe,Je=ot&&(We=(Ee=ot.props)===null||Ee===void 0?void 0:Ee.endIndex)!==null&&We!==void 0?We:be,Bt=yt!==fe||Je!==be,Pt=!qn($),pt=Pt&&!Bt?G.updateId:G.updateId+1;return rr(rr({updateId:pt},k(rr(rr({props:D},G),{},{updateId:pt,dataStartIndex:yt,dataEndIndex:Je}),G)),{},{prevChildren:K,dataStartIndex:yt,dataEndIndex:Je})}return null}),Nn(B,"renderActiveDot",function(D,G,V){var $;return F.isValidElement(D)?$=F.cloneElement(D,G):On(D)?$=D(G):$=De.createElement(mE,G),De.createElement(vi,{className:"recharts-active-dot",key:V},$)});var R=F.forwardRef(function(G,V){return De.createElement(B,zx({},G,{ref:V}))});return R.displayName=B.displayName,R},Det=iO({chartName:"LineChart",GraphicalChild:gE,axisComponents:[{axisType:"xAxis",AxisComp:Lm},{axisType:"yAxis",AxisComp:Fm}],formatAxisMap:N$}),Let=iO({chartName:"BarChart",GraphicalChild:Nv,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Lm},{axisType:"yAxis",AxisComp:Fm}],formatAxisMap:N$}),xK=iO({chartName:"PieChart",GraphicalChild:Oh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Xk},{axisType:"radiusAxis",AxisComp:Hk}],formatAxisMap:o9e,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),Fet=iO({chartName:"AreaChart",GraphicalChild:ig,axisComponents:[{axisType:"xAxis",AxisComp:Lm},{axisType:"yAxis",AxisComp:Fm}],formatAxisMap:N$});const Bp=["hsl(var(--primary))","hsl(var(--destructive))","#10b981","#f59e0b","#6366f1","#8b5cf6"],bK=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState(!0),[_,b]=F.useState("30"),[T,C]=F.useState(0),[P,k]=F.useState({totalRevenue:0,totalOrders:0,avgOrderValue:0,deliveredOrders:0,cancelledOrders:0}),[B,R]=F.useState([]),[D,G]=F.useState([]),[V,$]=F.useState([]),[K,Y]=F.useState([]);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&(ae(),ee())},[t,r,n,e,_]);const ee=async()=>{const{count:ie}=await dt.from("establishments").select("*",{count:"exact",head:!0}).eq("is_approved",!1);C(ie||0)},ae=async()=>{try{s(!0);const ie=new Date;ie.setDate(ie.getDate()-parseInt(_));const{data:ge}=await dt.from("orders").select("*").gte("created_at",ie.toISOString()).order("created_at",{ascending:!0}),{data:fe}=await dt.from("establishments").select("*");if(ge){const be=ge.reduce((ot,yt)=>ot+Number(yt.total),0),ue=ge.filter(ot=>ot.status==="delivered").length,Ce=ge.filter(ot=>ot.status==="cancelled").length;k({totalRevenue:be,totalOrders:ge.length,avgOrderValue:ge.length>0?be/ge.length:0,deliveredOrders:ue,cancelledOrders:Ce});const ve={};ge.forEach(ot=>{const yt=new Date(ot.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"});ve[yt]||(ve[yt]={orders:0,revenue:0}),ve[yt].orders++,ve[yt].revenue+=Number(ot.total)}),R(Object.entries(ve).map(([ot,yt])=>({date:ot,orders:yt.orders,revenue:yt.revenue})));const ze={};ge.forEach(ot=>{ze[ot.status]=(ze[ot.status]||0)+1});const Me={pending:"Pendente",confirmed:"Confirmado",preparing:"Preparando",ready:"Pronto",out_for_delivery:"Em entrega",delivered:"Entregue",cancelled:"Cancelado"};G(Object.entries(ze).map(([ot,yt])=>({name:Me[ot]||ot,value:yt})));const Be={};ge.forEach(ot=>{Be[ot.payment_method]=(Be[ot.payment_method]||0)+1});const Ve={pix:"PIX",credit_card:"Carto Crdito",debit_card:"Carto Dbito",cash:"Dinheiro"};$(Object.entries(Be).map(([ot,yt])=>({name:Ve[ot]||ot,value:yt})));const We={};ge.forEach(ot=>{We[ot.establishment_id]||(We[ot.establishment_id]={orders:0,revenue:0}),We[ot.establishment_id].orders++,We[ot.establishment_id].revenue+=Number(ot.total)});const Ee=Object.entries(We).map(([ot,yt])=>{const Je=fe==null?void 0:fe.find(Bt=>Bt.id===ot);return{name:(Je==null?void 0:Je.name)||"Desconhecido",orders:yt.orders,revenue:yt.revenue}}).sort((ot,yt)=>yt.revenue-ot.revenue).slice(0,5);Y(Ee)}}catch{gt.error("Erro ao carregar relatrios")}finally{s(!1)}};return r||p?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1),pendingEstablishments:T}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Relatrios"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Anlise de desempenho da plataforma"})]})]}),c.jsxs(ns,{value:_,onValueChange:b,children:[c.jsxs(Ji,{className:"w-40",children:[c.jsx(B2,{className:"w-4 h-4 mr-2"}),c.jsx(is,{})]}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"7",children:"ltimos 7 dias"}),c.jsx(sn,{value:"30",children:"ltimos 30 dias"}),c.jsx(sn,{value:"90",children:"ltimos 90 dias"}),c.jsx(sn,{value:"365",children:"ltimo ano"})]})]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:c.jsx($o,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-xl font-bold",children:["R$ ",P.totalRevenue.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita Total"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(xh,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xl font-bold",children:P.totalOrders}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pedidos"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:c.jsx(Ey,{className:"w-5 h-5 text-blue-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-xl font-bold",children:["R$ ",P.avgOrderValue.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Ticket Mdio"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:c.jsx(xh,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xl font-bold",children:P.deliveredOrders}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Entregues"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-destructive/10 rounded-lg",children:c.jsx(xh,{className:"w-5 h-5 text-destructive"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xl font-bold",children:P.cancelledOrders}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Cancelados"})]})]})})})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Pedidos por Dia"})}),c.jsx(Ut,{children:B.length===0?c.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Sem dados para o perodo"}):c.jsx(AS,{width:"100%",height:250,children:c.jsxs(Let,{data:B,children:[c.jsx(QN,{strokeDasharray:"3 3",className:"stroke-muted"}),c.jsx(Lm,{dataKey:"date",className:"text-xs"}),c.jsx(Fm,{className:"text-xs"}),c.jsx(nc,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),c.jsx(Nv,{dataKey:"orders",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Receita por Dia"})}),c.jsx(Ut,{children:B.length===0?c.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Sem dados para o perodo"}):c.jsx(AS,{width:"100%",height:250,children:c.jsxs(Det,{data:B,children:[c.jsx(QN,{strokeDasharray:"3 3",className:"stroke-muted"}),c.jsx(Lm,{dataKey:"date",className:"text-xs"}),c.jsx(Fm,{className:"text-xs"}),c.jsx(nc,{formatter:ie=>[`R$ ${ie.toFixed(2)}`,"Receita"],contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),c.jsx(gE,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Por Status"})}),c.jsxs(Ut,{children:[D.length===0?c.jsx("div",{className:"h-48 flex items-center justify-center text-muted-foreground",children:"Sem dados"}):c.jsx(AS,{width:"100%",height:200,children:c.jsxs(xK,{children:[c.jsx(Oh,{data:D,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",children:D.map((ie,ge)=>c.jsx(XT,{fill:Bp[ge%Bp.length]},`cell-${ge}`))}),c.jsx(nc,{})]})}),c.jsx("div",{className:"flex flex-wrap gap-2 justify-center mt-2",children:D.map((ie,ge)=>c.jsxs(dn,{variant:"outline",className:"text-xs",children:[c.jsx("span",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:Bp[ge%Bp.length]}}),ie.name,": ",ie.value]},ie.name))})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Por Pagamento"})}),c.jsxs(Ut,{children:[V.length===0?c.jsx("div",{className:"h-48 flex items-center justify-center text-muted-foreground",children:"Sem dados"}):c.jsx(AS,{width:"100%",height:200,children:c.jsxs(xK,{children:[c.jsx(Oh,{data:V,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",children:V.map((ie,ge)=>c.jsx(XT,{fill:Bp[ge%Bp.length]},`cell-${ge}`))}),c.jsx(nc,{})]})}),c.jsx("div",{className:"flex flex-wrap gap-2 justify-center mt-2",children:V.map((ie,ge)=>c.jsxs(dn,{variant:"outline",className:"text-xs",children:[c.jsx("span",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:Bp[ge%Bp.length]}}),ie.name,": ",ie.value]},ie.name))})]})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Top Estabelecimentos"})}),c.jsx(Ut,{children:K.length===0?c.jsx("div",{className:"h-48 flex items-center justify-center text-muted-foreground",children:"Sem dados"}):c.jsx("div",{className:"space-y-3",children:K.map((ie,ge)=>c.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-sm font-bold text-muted-foreground",children:["#",ge+1]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium truncate max-w-[120px]",children:ie.name}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[ie.orders," pedidos"]})]})]}),c.jsxs("p",{className:"text-sm font-bold text-primary",children:["R$ ",ie.revenue.toFixed(0)]})]},ie.name))})})]})]})]})]})]})};var zet="Separator",wK="horizontal",Bet=["horizontal","vertical"],pue=F.forwardRef((e,t)=>{const{decorative:r,orientation:n=wK,...a}=e,d=$et(n)?n:wK,s=r?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return c.jsx(vn.div,{"data-orientation":d,...s,...a,ref:t})});pue.displayName=zet;function $et(e){return Bet.includes(e)}var mue=pue;const gue=F.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},a)=>c.jsx(mue,{ref:a,decorative:r,orientation:t,className:Dr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));gue.displayName=mue.displayName;const Vet=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState(0),[_,b]=F.useState(!1),[T,C]=F.useState({platformName:"VAIJ",supportEmail:"suporte@vaija.com.br",supportPhone:"(11) 99999-9999",autoApproveEstablishments:!1,emailNotifications:!0,pushNotifications:!0,maintenanceMode:!1});F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&P()},[t,r,n,e]);const P=async()=>{const{count:B}=await dt.from("establishments").select("*",{count:"exact",head:!0}).eq("is_approved",!1);s(B||0)},k=async()=>{b(!0),await new Promise(B=>setTimeout(B,1e3)),gt.success("Configuraes salvas com sucesso!"),b(!1)};return r?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1),pendingEstablishments:p}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Configuraes"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Configuraes gerais da plataforma"})]})]}),c.jsxs(Ft,{onClick:k,disabled:_,children:[c.jsx(E0,{className:"w-4 h-4 mr-2"}),_?"Salvando...":"Salvar"]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6 max-w-4xl",children:[c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Xve,{className:"w-5 h-5"}),"Configuraes Gerais"]}),c.jsx(zo,{children:"Informaes bsicas da plataforma"})]}),c.jsx(Ut,{className:"space-y-4",children:c.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"platformName",children:"Nome da Plataforma"}),c.jsx(ar,{id:"platformName",value:T.platformName,onChange:B=>C({...T,platformName:B.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"supportEmail",children:"Email de Suporte"}),c.jsx(ar,{id:"supportEmail",type:"email",value:T.supportEmail,onChange:B=>C({...T,supportEmail:B.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"supportPhone",children:"Telefone de Suporte"}),c.jsx(ar,{id:"supportPhone",value:T.supportPhone,onChange:B=>C({...T,supportPhone:B.target.value})})]})]})})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(rv,{className:"w-5 h-5"}),"Aprovaes"]}),c.jsx(zo,{children:"Configure como os estabelecimentos so aprovados"})]}),c.jsx(Ut,{className:"space-y-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx(zt,{children:"Aprovao Automtica"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Aprovar automaticamente novos estabelecimentos"})]}),c.jsx(Bs,{checked:T.autoApproveEstablishments,onCheckedChange:B=>C({...T,autoApproveEstablishments:B})})]})})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(z2,{className:"w-5 h-5"}),"Notificaes"]}),c.jsx(zo,{children:"Configure as notificaes do sistema"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx(zt,{children:"Notificaes por Email"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Receber notificaes importantes por email"})]}),c.jsx(Bs,{checked:T.emailNotifications,onCheckedChange:B=>C({...T,emailNotifications:B})})]}),c.jsx(gue,{}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx(zt,{children:"Notificaes Push"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Receber notificaes push no navegador"})]}),c.jsx(Bs,{checked:T.pushNotifications,onCheckedChange:B=>C({...T,pushNotifications:B})})]})]})]}),c.jsxs(Vt,{className:"border-destructive/50",children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2 text-destructive",children:[c.jsx(V2,{className:"w-5 h-5"}),"Modo de Manuteno"]}),c.jsx(zo,{children:"Ativar o modo de manuteno ir desabilitar o acesso pblico  plataforma"})]}),c.jsx(Ut,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx(zt,{children:"Ativar Modo de Manuteno"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Apenas administradores tero acesso"})]}),c.jsx(Bs,{checked:T.maintenanceMode,onCheckedChange:B=>C({...T,maintenanceMode:B})})]})})]})]})]})]})};var sO="Collapsible",[Uet]=hc(sO),[qet,B$]=Uet(sO),yue=F.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:a,disabled:d,onOpenChange:p,...s}=e,[_,b]=kf({prop:n,defaultProp:a??!1,onChange:p,caller:sO});return c.jsx(qet,{scope:r,disabled:d,contentId:gd(),open:_,onOpenToggle:F.useCallback(()=>b(T=>!T),[b]),children:c.jsx(vn.div,{"data-state":V$(_),"data-disabled":d?"":void 0,...s,ref:t})})});yue.displayName=sO;var vue="CollapsibleTrigger",_ue=F.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,a=B$(vue,r);return c.jsx(vn.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":V$(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...n,ref:t,onClick:Fr(e.onClick,a.onOpenToggle)})});_ue.displayName=vue;var $$="CollapsibleContent",xue=F.forwardRef((e,t)=>{const{forceMount:r,...n}=e,a=B$($$,e.__scopeCollapsible);return c.jsx(Cu,{present:r||a.open,children:({present:d})=>c.jsx(Get,{...n,ref:t,present:d})})});xue.displayName=$$;var Get=F.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:a,...d}=e,p=B$($$,r),[s,_]=F.useState(n),b=F.useRef(null),T=Ti(t,b),C=F.useRef(0),P=C.current,k=F.useRef(0),B=k.current,R=p.open||s,D=F.useRef(R),G=F.useRef(void 0);return F.useEffect(()=>{const V=requestAnimationFrame(()=>D.current=!1);return()=>cancelAnimationFrame(V)},[]),Sa(()=>{const V=b.current;if(V){G.current=G.current||{transitionDuration:V.style.transitionDuration,animationName:V.style.animationName},V.style.transitionDuration="0s",V.style.animationName="none";const $=V.getBoundingClientRect();C.current=$.height,k.current=$.width,D.current||(V.style.transitionDuration=G.current.transitionDuration,V.style.animationName=G.current.animationName),_(n)}},[p.open,n]),c.jsx(vn.div,{"data-state":V$(p.open),"data-disabled":p.disabled?"":void 0,id:p.contentId,hidden:!R,...d,ref:T,style:{"--radix-collapsible-content-height":P?`${P}px`:void 0,"--radix-collapsible-content-width":B?`${B}px`:void 0,...e.style},children:R&&a})});function V$(e){return e?"open":"closed"}var Wet=yue;const Het=Wet,Zet=_ue,Xet=xue,Ket=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"],Yet=()=>{const[e,t]=F.useState(!1),{user:r,loading:n}=$i(),a=di(),{toast:d}=CQ(),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(new Set),[B,R]=F.useState(!1),[D,G]=F.useState(null),[V,$]=F.useState({name:"",state:"",is_active:!0}),[K,Y]=F.useState(!1),[ee,ae]=F.useState(null),[ie,ge]=F.useState({city_id:"",name:"",delivery_fee:0,is_active:!0}),[fe,be]=F.useState(!1),[ue,Ce]=F.useState(null);F.useEffect(()=>{if(!n&&!r){a("/auth");return}r&&ve()},[r,n,a]);const ve=async()=>{const{data:pt}=await dt.from("user_roles").select("role").eq("user_id",r.id).eq("role","admin").maybeSingle();if(!pt){a("/");return}ze()},ze=async()=>{C(!0);try{const[pt,Gt]=await Promise.all([dt.from("cities").select("*").order("state").order("name"),dt.from("neighborhoods").select("*").order("name")]);pt.data&&s(pt.data),Gt.data&&b(Gt.data)}catch(pt){console.error("Error fetching data:",pt)}finally{C(!1)}},Me=pt=>{const Gt=new Set(P);Gt.has(pt)?Gt.delete(pt):Gt.add(pt),k(Gt)},Be=async()=>{if(!V.name||!V.state){d({title:"Preencha todos os campos",variant:"destructive"});return}try{if(D){const{error:pt}=await dt.from("cities").update(V).eq("id",D.id);if(pt)throw pt;d({title:"Cidade atualizada com sucesso!"})}else{const{error:pt}=await dt.from("cities").insert(V);if(pt)throw pt;d({title:"Cidade cadastrada com sucesso!"})}R(!1),G(null),$({name:"",state:"",is_active:!0}),ze()}catch(pt){d({title:"Erro ao salvar cidade",description:pt.message,variant:"destructive"})}},Ve=pt=>{G(pt),$({name:pt.name,state:pt.state,is_active:pt.is_active}),R(!0)},We=async pt=>{try{const{error:Gt}=await dt.from("cities").update({is_active:!pt.is_active}).eq("id",pt.id);if(Gt)throw Gt;ze()}catch{d({title:"Erro ao atualizar status",variant:"destructive"})}},Ee=async()=>{if(!ie.name||!ie.city_id){d({title:"Preencha todos os campos",variant:"destructive"});return}try{if(ee){const{error:pt}=await dt.from("neighborhoods").update(ie).eq("id",ee.id);if(pt)throw pt;d({title:"Bairro atualizado com sucesso!"})}else{const{error:pt}=await dt.from("neighborhoods").insert(ie);if(pt)throw pt;d({title:"Bairro cadastrado com sucesso!"})}Y(!1),ae(null),ge({city_id:"",name:"",delivery_fee:0,is_active:!0}),ze()}catch(pt){d({title:"Erro ao salvar bairro",description:pt.message,variant:"destructive"})}},ot=pt=>{ae(pt),ge({city_id:pt.city_id,name:pt.name,delivery_fee:pt.delivery_fee,is_active:pt.is_active}),Y(!0)},yt=pt=>{ge({...ie,city_id:pt}),Y(!0)},Je=async pt=>{try{const{error:Gt}=await dt.from("neighborhoods").update({is_active:!pt.is_active}).eq("id",pt.id);if(Gt)throw Gt;ze()}catch{d({title:"Erro ao atualizar status",variant:"destructive"})}},Bt=async()=>{if(ue)try{const{error:pt}=await dt.from(ue.type==="city"?"cities":"neighborhoods").delete().eq("id",ue.id);if(pt)throw pt;d({title:`${ue.type==="city"?"Cidade":"Bairro"} excludo com sucesso!`}),ze()}catch(pt){d({title:"Erro ao excluir",description:pt.message,variant:"destructive"})}finally{be(!1),Ce(null)}},Pt=pt=>_.filter(Gt=>Gt.city_id===pt);return n||T?c.jsxs("div",{className:"flex min-h-screen",children:[c.jsx(Vc,{open:e,onClose:()=>t(!1)}),c.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]}):c.jsxs("div",{className:"flex min-h-screen bg-muted/30",children:[c.jsx(Vc,{open:e,onClose:()=>t(!1)}),c.jsxs("main",{className:"flex-1 p-6",children:[c.jsx(Ft,{variant:"ghost",size:"icon",className:"lg:hidden mb-4",onClick:()=>t(!0),children:c.jsx(Ri,{className:"h-5 w-5"})}),c.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Cidades e Regies"}),c.jsx("p",{className:"text-muted-foreground",children:"Gerencie as reas de atuao do delivery"})]}),c.jsxs($l,{open:B,onOpenChange:pt=>{R(pt),pt||(G(null),$({name:"",state:"",is_active:!0}))},children:[c.jsx(Ake,{asChild:!0,children:c.jsxs(Ft,{children:[c.jsx(dc,{className:"h-4 w-4 mr-2"}),"Nova Cidade"]})}),c.jsxs(ul,{children:[c.jsx(dl,{children:c.jsx(hl,{children:D?"Editar Cidade":"Nova Cidade"})}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Nome da Cidade"}),c.jsx(ar,{value:V.name,onChange:pt=>$({...V,name:pt.target.value}),placeholder:"Ex: So Paulo"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Estado"}),c.jsxs(ns,{value:V.state,onValueChange:pt=>$({...V,state:pt}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione o estado"})}),c.jsx(Qi,{children:Ket.map(pt=>c.jsx(sn,{value:pt,children:pt},pt))})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:V.is_active,onCheckedChange:pt=>$({...V,is_active:pt})}),c.jsx(zt,{children:"Cidade ativa"})]}),c.jsx(Ft,{onClick:Be,className:"w-full",children:D?"Salvar Alteraes":"Cadastrar Cidade"})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:c.jsx(zi,{className:"h-6 w-6 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Cidades cadastradas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-green-500/10 rounded-full",children:c.jsx(n4,{className:"h-6 w-6 text-green-500"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:_.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Bairros cadastrados"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"p-3 bg-blue-500/10 rounded-full",children:c.jsx(zi,{className:"h-6 w-6 text-blue-500"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.filter(pt=>pt.is_active).length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Cidades ativas"})]})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsx(Hr,{children:"Cidades e Bairros"})}),c.jsx(Ut,{children:p.length===0?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(zi,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma cidade cadastrada"}),c.jsx("p",{className:"text-sm",children:'Clique em "Nova Cidade" para comear'})]}):c.jsx("div",{className:"space-y-2",children:p.map(pt=>c.jsx(Het,{open:P.has(pt.id),onOpenChange:()=>Me(pt.id),children:c.jsxs("div",{className:"border rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-muted/50",children:[c.jsxs(Zet,{className:"flex items-center gap-3 flex-1",children:[P.has(pt.id)?c.jsx(i4,{className:"h-4 w-4"}):c.jsx(ST,{className:"h-4 w-4"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(zi,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"font-medium",children:pt.name}),c.jsxs("span",{className:"text-muted-foreground",children:["- ",pt.state]}),c.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${pt.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:pt.is_active?"Ativa":"Inativa"}),c.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Pt(pt.id).length," bairros)"]})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:pt.is_active,onCheckedChange:()=>We(pt)}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>Ve(pt),children:c.jsx(Im,{className:"h-4 w-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>{Ce({type:"city",id:pt.id,name:pt.name}),be(!0)},children:c.jsx(xd,{className:"h-4 w-4 text-destructive"})})]})]}),c.jsx(Xet,{children:c.jsxs("div",{className:"border-t px-4 py-3 bg-muted/30",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("span",{className:"text-sm font-medium",children:"Bairros"}),c.jsxs(Ft,{variant:"outline",size:"sm",onClick:()=>yt(pt.id),children:[c.jsx(dc,{className:"h-3 w-3 mr-1"}),"Adicionar Bairro"]})]}),Pt(pt.id).length===0?c.jsx("p",{className:"text-sm text-muted-foreground py-2",children:"Nenhum bairro cadastrado nesta cidade"}):c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Bairro"}),c.jsx(ai,{children:"Taxa de Entrega"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{className:"text-right",children:"Aes"})]})}),c.jsx(Jm,{children:Pt(pt.id).map(Gt=>c.jsxs(Vo,{children:[c.jsx(ti,{children:Gt.name}),c.jsx(ti,{children:Gt.delivery_fee>0?`R$ ${Gt.delivery_fee.toFixed(2)}`:"Grtis"}),c.jsx(ti,{children:c.jsx(Bs,{checked:Gt.is_active,onCheckedChange:()=>Je(Gt)})}),c.jsxs(ti,{className:"text-right",children:[c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>ot(Gt),children:c.jsx(Im,{className:"h-4 w-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>{Ce({type:"neighborhood",id:Gt.id,name:Gt.name}),be(!0)},children:c.jsx(xd,{className:"h-4 w-4 text-destructive"})})]})]},Gt.id))})]})]})})]})},pt.id))})})]})]})]}),c.jsx($l,{open:K,onOpenChange:pt=>{Y(pt),pt||(ae(null),ge({city_id:"",name:"",delivery_fee:0,is_active:!0}))},children:c.jsxs(ul,{children:[c.jsx(dl,{children:c.jsx(hl,{children:ee?"Editar Bairro":"Novo Bairro"})}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Cidade"}),c.jsxs(ns,{value:ie.city_id,onValueChange:pt=>ge({...ie,city_id:pt}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione a cidade"})}),c.jsx(Qi,{children:p.map(pt=>c.jsxs(sn,{value:pt.id,children:[pt.name," - ",pt.state]},pt.id))})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Nome do Bairro"}),c.jsx(ar,{value:ie.name,onChange:pt=>ge({...ie,name:pt.target.value}),placeholder:"Ex: Centro"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Taxa de Entrega (R$)"}),c.jsx(ar,{type:"number",step:"0.01",min:"0",value:ie.delivery_fee,onChange:pt=>ge({...ie,delivery_fee:parseFloat(pt.target.value)||0}),placeholder:"0.00"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bs,{checked:ie.is_active,onCheckedChange:pt=>ge({...ie,is_active:pt})}),c.jsx(zt,{children:"Bairro ativo"})]}),c.jsx(Ft,{onClick:Ee,className:"w-full",children:ee?"Salvar Alteraes":"Cadastrar Bairro"})]})]})}),c.jsx(fk,{open:fe,onOpenChange:be,children:c.jsxs(tE,{children:[c.jsxs(rE,{children:[c.jsx(iE,{children:"Confirmar Excluso"}),c.jsxs(sE,{children:["Tem certeza que deseja excluir ",(ue==null?void 0:ue.type)==="city"?"a cidade":"o bairro"," ",c.jsx("strong",{children:ue==null?void 0:ue.name}),"?",(ue==null?void 0:ue.type)==="city"&&c.jsx("span",{className:"block mt-2 text-destructive",children:"Isso tambm excluir todos os bairros desta cidade."})]})]}),c.jsxs(nE,{children:[c.jsx(oE,{children:"Cancelar"}),c.jsx(aE,{onClick:Bt,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})})]})};function ll(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function zm(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Jet(e,t){const r=ll(e);return isNaN(t)?zm(e,NaN):(t&&r.setDate(r.getDate()+t),r)}const bue=6048e5,Qet=864e5;let ett={};function aO(){return ett}function mv(e,t){var s,_,b,T;const r=aO(),n=(t==null?void 0:t.weekStartsOn)??((_=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:_.weekStartsOn)??r.weekStartsOn??((T=(b=r.locale)==null?void 0:b.options)==null?void 0:T.weekStartsOn)??0,a=ll(e),d=a.getDay(),p=(d<n?7:0)+d-n;return a.setDate(a.getDate()-p),a.setHours(0,0,0,0),a}function sI(e){return mv(e,{weekStartsOn:1})}function wue(e){const t=ll(e),r=t.getFullYear(),n=zm(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const a=sI(n),d=zm(e,0);d.setFullYear(r,0,4),d.setHours(0,0,0,0);const p=sI(d);return t.getTime()>=a.getTime()?r+1:t.getTime()>=p.getTime()?r:r-1}function aI(e){const t=ll(e);return t.setHours(0,0,0,0),t}function SK(e){const t=ll(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function ttt(e,t){const r=aI(e),n=aI(t),a=+r-SK(r),d=+n-SK(n);return Math.round((a-d)/Qet)}function rtt(e){const t=wue(e),r=zm(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),sI(r)}function ntt(e,t){const r=aI(e),n=aI(t);return+r==+n}function itt(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function stt(e){if(!itt(e)&&typeof e!="number")return!1;const t=ll(e);return!isNaN(Number(t))}function att(e,t){const r=ll(e.start),n=ll(e.end);let a=+r>+n;const d=a?+r:+n,p=a?n:r;p.setHours(0,0,0,0);let s=1;const _=[];for(;+p<=d;)_.push(ll(p)),p.setDate(p.getDate()+s),p.setHours(0,0,0,0);return a?_.reverse():_}function ott(e){const t=ll(e);return t.setDate(1),t.setHours(0,0,0,0),t}function ltt(e){const t=ll(e),r=zm(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}const ctt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},utt=(e,t,r)=>{let n;const a=ctt[e];return typeof a=="string"?n=a:t===1?n=a.one:n=a.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function r0(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const dtt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},htt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ftt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ptt={date:r0({formats:dtt,defaultWidth:"full"}),time:r0({formats:htt,defaultWidth:"full"}),dateTime:r0({formats:ftt,defaultWidth:"full"})},mtt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},gtt=(e,t,r,n)=>mtt[e];function hh(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let a;if(n==="formatting"&&e.formattingValues){const p=e.defaultFormattingWidth||e.defaultWidth,s=r!=null&&r.width?String(r.width):p;a=e.formattingValues[s]||e.formattingValues[p]}else{const p=e.defaultWidth,s=r!=null&&r.width?String(r.width):e.defaultWidth;a=e.values[s]||e.values[p]}const d=e.argumentCallback?e.argumentCallback(t):t;return a[d]}}const ytt={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},vtt={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_tt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},xtt={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},btt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wtt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Stt=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Ttt={ordinalNumber:Stt,era:hh({values:ytt,defaultWidth:"wide"}),quarter:hh({values:vtt,defaultWidth:"wide",argumentCallback:e=>e-1}),month:hh({values:_tt,defaultWidth:"wide"}),day:hh({values:xtt,defaultWidth:"wide"}),dayPeriod:hh({values:btt,defaultWidth:"wide",formattingValues:wtt,defaultFormattingWidth:"wide"})};function fh(e){return(t,r={})=>{const n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],d=t.match(a);if(!d)return null;const p=d[0],s=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],_=Array.isArray(s)?jtt(s,C=>C.test(p)):Ett(s,C=>C.test(p));let b;b=e.valueCallback?e.valueCallback(_):_,b=r.valueCallback?r.valueCallback(b):b;const T=t.slice(p.length);return{value:b,rest:T}}}function Ett(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function jtt(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function Sue(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const a=n[0],d=t.match(e.parsePattern);if(!d)return null;let p=e.valueCallback?e.valueCallback(d[0]):d[0];p=r.valueCallback?r.valueCallback(p):p;const s=t.slice(a.length);return{value:p,rest:s}}}const Att=/^(\d+)(th|st|nd|rd)?/i,Ctt=/\d+/i,Ptt={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ntt={any:[/^b/i,/^(a|c)/i]},Itt={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ktt={any:[/1/i,/2/i,/3/i,/4/i]},Ott={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Rtt={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Mtt={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Dtt={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ltt={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ftt={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ztt={ordinalNumber:Sue({matchPattern:Att,parsePattern:Ctt,valueCallback:e=>parseInt(e,10)}),era:fh({matchPatterns:Ptt,defaultMatchWidth:"wide",parsePatterns:Ntt,defaultParseWidth:"any"}),quarter:fh({matchPatterns:Itt,defaultMatchWidth:"wide",parsePatterns:ktt,defaultParseWidth:"any",valueCallback:e=>e+1}),month:fh({matchPatterns:Ott,defaultMatchWidth:"wide",parsePatterns:Rtt,defaultParseWidth:"any"}),day:fh({matchPatterns:Mtt,defaultMatchWidth:"wide",parsePatterns:Dtt,defaultParseWidth:"any"}),dayPeriod:fh({matchPatterns:Ltt,defaultMatchWidth:"any",parsePatterns:Ftt,defaultParseWidth:"any"})},Btt={code:"en-US",formatDistance:utt,formatLong:ptt,formatRelative:gtt,localize:Ttt,match:ztt,options:{weekStartsOn:0,firstWeekContainsDate:1}};function $tt(e){const t=ll(e);return ttt(t,ltt(t))+1}function Vtt(e){const t=ll(e),r=+sI(t)-+rtt(t);return Math.round(r/bue)+1}function Tue(e,t){var T,C,P,k;const r=ll(e),n=r.getFullYear(),a=aO(),d=(t==null?void 0:t.firstWeekContainsDate)??((C=(T=t==null?void 0:t.locale)==null?void 0:T.options)==null?void 0:C.firstWeekContainsDate)??a.firstWeekContainsDate??((k=(P=a.locale)==null?void 0:P.options)==null?void 0:k.firstWeekContainsDate)??1,p=zm(e,0);p.setFullYear(n+1,0,d),p.setHours(0,0,0,0);const s=mv(p,t),_=zm(e,0);_.setFullYear(n,0,d),_.setHours(0,0,0,0);const b=mv(_,t);return r.getTime()>=s.getTime()?n+1:r.getTime()>=b.getTime()?n:n-1}function Utt(e,t){var s,_,b,T;const r=aO(),n=(t==null?void 0:t.firstWeekContainsDate)??((_=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:_.firstWeekContainsDate)??r.firstWeekContainsDate??((T=(b=r.locale)==null?void 0:b.options)==null?void 0:T.firstWeekContainsDate)??1,a=Tue(e,t),d=zm(e,0);return d.setFullYear(a,0,n),d.setHours(0,0,0,0),mv(d,t)}function qtt(e,t){const r=ll(e),n=+mv(r,t)-+Utt(r,t);return Math.round(n/bue)+1}function ls(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const $p={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return ls(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):ls(r+1,2)},d(e,t){return ls(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return ls(e.getHours()%12||12,t.length)},H(e,t){return ls(e.getHours(),t.length)},m(e,t){return ls(e.getMinutes(),t.length)},s(e,t){return ls(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),a=Math.trunc(n*Math.pow(10,r-3));return ls(a,t.length)}},hx={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},TK={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return $p.y(e,t)},Y:function(e,t,r,n){const a=Tue(e,n),d=a>0?a:1-a;if(t==="YY"){const p=d%100;return ls(p,2)}return t==="Yo"?r.ordinalNumber(d,{unit:"year"}):ls(d,t.length)},R:function(e,t){const r=wue(e);return ls(r,t.length)},u:function(e,t){const r=e.getFullYear();return ls(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return ls(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return ls(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return $p.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return ls(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const a=qtt(e,n);return t==="wo"?r.ordinalNumber(a,{unit:"week"}):ls(a,t.length)},I:function(e,t,r){const n=Vtt(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):ls(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):$p.d(e,t)},D:function(e,t,r){const n=$tt(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):ls(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const a=e.getDay(),d=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return ls(d,2);case"eo":return r.ordinalNumber(d,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});case"eeee":default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const a=e.getDay(),d=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return ls(d,t.length);case"co":return r.ordinalNumber(d,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});case"cccc":default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),a=n===0?7:n;switch(t){case"i":return String(a);case"ii":return ls(a,t.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let a;switch(n===12?a=hx.noon:n===0?a=hx.midnight:a=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let a;switch(n>=17?a=hx.evening:n>=12?a=hx.afternoon:n>=4?a=hx.morning:a=hx.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return $p.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):$p.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):ls(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):ls(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):$p.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):$p.s(e,t)},S:function(e,t){return $p.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return jK(n);case"XXXX":case"XX":return yy(n);case"XXXXX":case"XXX":default:return yy(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return jK(n);case"xxxx":case"xx":return yy(n);case"xxxxx":case"xxx":default:return yy(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+EK(n,":");case"OOOO":default:return"GMT"+yy(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+EK(n,":");case"zzzz":default:return"GMT"+yy(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return ls(n,t.length)},T:function(e,t,r){const n=e.getTime();return ls(n,t.length)}};function EK(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),d=n%60;return d===0?r+String(a):r+String(a)+t+ls(d,2)}function jK(e,t){return e%60===0?(e>0?"-":"+")+ls(Math.abs(e)/60,2):yy(e,t)}function yy(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),a=ls(Math.trunc(n/60),2),d=ls(n%60,2);return r+a+t+d}const AK=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Eue=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Gtt=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return AK(e,t);let d;switch(n){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",AK(n,t)).replace("{{time}}",Eue(a,t))},Wtt={p:Eue,P:Gtt},Htt=/^D+$/,Ztt=/^Y+$/,Xtt=["D","DD","YY","YYYY"];function Ktt(e){return Htt.test(e)}function Ytt(e){return Ztt.test(e)}function Jtt(e,t,r){const n=Qtt(e,t,r);if(console.warn(n),Xtt.includes(e))throw new RangeError(n)}function Qtt(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const ert=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,trt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,rrt=/^'([^]*?)'?$/,nrt=/''/g,irt=/[a-zA-Z]/;function il(e,t,r){var T,C,P,k,B,R,D,G;const n=aO(),a=(r==null?void 0:r.locale)??n.locale??Btt,d=(r==null?void 0:r.firstWeekContainsDate)??((C=(T=r==null?void 0:r.locale)==null?void 0:T.options)==null?void 0:C.firstWeekContainsDate)??n.firstWeekContainsDate??((k=(P=n.locale)==null?void 0:P.options)==null?void 0:k.firstWeekContainsDate)??1,p=(r==null?void 0:r.weekStartsOn)??((R=(B=r==null?void 0:r.locale)==null?void 0:B.options)==null?void 0:R.weekStartsOn)??n.weekStartsOn??((G=(D=n.locale)==null?void 0:D.options)==null?void 0:G.weekStartsOn)??0,s=ll(e);if(!stt(s))throw new RangeError("Invalid time value");let _=t.match(trt).map(V=>{const $=V[0];if($==="p"||$==="P"){const K=Wtt[$];return K(V,a.formatLong)}return V}).join("").match(ert).map(V=>{if(V==="''")return{isToken:!1,value:"'"};const $=V[0];if($==="'")return{isToken:!1,value:srt(V)};if(TK[$])return{isToken:!0,value:V};if($.match(irt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+$+"`");return{isToken:!1,value:V}});a.localize.preprocessor&&(_=a.localize.preprocessor(s,_));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:a};return _.map(V=>{if(!V.isToken)return V.value;const $=V.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Ytt($)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&Ktt($))&&Jtt($,t,String(e));const K=TK[$[0]];return K(s,$,a.localize,b)}).join("")}function srt(e){const t=e.match(rrt);return t?t[1].replace(nrt,"'"):e}function oL(e,t){return Jet(e,-t)}const art={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},ort=(e,t,r)=>{let n;const a=art[e];return typeof a=="string"?n=a:t===1?n=a.one:n=a.other.replace("{{count}}",String(t)),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"em "+n:"h "+n:n},lrt={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},crt={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},urt={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},drt={date:r0({formats:lrt,defaultWidth:"full"}),time:r0({formats:crt,defaultWidth:"full"}),dateTime:r0({formats:urt,defaultWidth:"full"})},hrt={lastWeek:e=>{const t=e.getDay();return"'"+(t===0||t===6?"ltimo":"ltima")+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},frt=(e,t,r,n)=>{const a=hrt[e];return typeof a=="function"?a(t):a},prt={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},mrt={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},grt={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},yrt={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},vrt={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},_rt={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},xrt=(e,t)=>{const r=Number(e);return(t==null?void 0:t.unit)==="week"?r+"":r+""},brt={ordinalNumber:xrt,era:hh({values:prt,defaultWidth:"wide"}),quarter:hh({values:mrt,defaultWidth:"wide",argumentCallback:e=>e-1}),month:hh({values:grt,defaultWidth:"wide"}),day:hh({values:yrt,defaultWidth:"wide"}),dayPeriod:hh({values:vrt,defaultWidth:"wide",formattingValues:_rt,defaultFormattingWidth:"wide"})},wrt=/^(\d+)[o]?/i,Srt=/\d+/i,Trt={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},Ert={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},jrt={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},Art={any:[/1/i,/2/i,/3/i,/4/i]},Crt={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},Prt={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},Nrt={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},Irt={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},krt={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},Ort={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},Rrt={ordinalNumber:Sue({matchPattern:wrt,parsePattern:Srt,valueCallback:e=>parseInt(e,10)}),era:fh({matchPatterns:Trt,defaultMatchWidth:"wide",parsePatterns:Ert,defaultParseWidth:"any"}),quarter:fh({matchPatterns:jrt,defaultMatchWidth:"wide",parsePatterns:Art,defaultParseWidth:"any",valueCallback:e=>e+1}),month:fh({matchPatterns:Crt,defaultMatchWidth:"wide",parsePatterns:Prt,defaultParseWidth:"any"}),day:fh({matchPatterns:Nrt,defaultMatchWidth:"wide",parsePatterns:Irt,defaultParseWidth:"any"}),dayPeriod:fh({matchPatterns:krt,defaultMatchWidth:"any",parsePatterns:Ort,defaultParseWidth:"any"})},wf={code:"pt-BR",formatDistance:ort,formatLong:drt,formatRelative:frt,localize:brt,match:Rrt,options:{weekStartsOn:0,firstWeekContainsDate:1}},Mrt=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState([]),[P,k]=F.useState([]),[B,R]=F.useState(!0),[D,G]=F.useState(""),[V,$]=F.useState(!1),[K,Y]=F.useState(!1),[ee,ae]=F.useState(null),[ie,ge]=F.useState(!1),[fe,be]=F.useState({code:"",description:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_discount:"",usage_limit:"",valid_from:il(new Date,"yyyy-MM-dd"),valid_until:"",city_id:"",neighborhood_id:"",establishment_id:""});F.useEffect(()=>{!r&&!t?e("/auth"):!r&&t&&!n&&(e("/"),gt.error("Acesso restrito a administradores"))},[t,r,n,e]),F.useEffect(()=>{n&&ue()},[n]);const ue=async()=>{R(!0);try{const[Ee,ot,yt]=await Promise.all([dt.from("coupons").select("*").order("created_at",{ascending:!1}),dt.from("cities").select("*").eq("is_active",!0).order("name"),dt.from("establishments").select("id, name").eq("is_approved",!0).order("name")]);if(Ee.error)throw Ee.error;if(ot.error)throw ot.error;if(yt.error)throw yt.error;s(Ee.data||[]),b(ot.data||[]),k(yt.data||[])}catch(Ee){console.error("Error fetching data:",Ee),gt.error("Erro ao carregar dados")}finally{R(!1)}},Ce=async Ee=>{try{const{data:ot,error:yt}=await dt.from("neighborhoods").select("*").eq("city_id",Ee).eq("is_active",!0).order("name");if(yt)throw yt;C(ot||[])}catch(ot){console.error("Error fetching neighborhoods:",ot)}},ve=Ee=>{var ot,yt,Je;Ee?(ae(Ee),be({code:Ee.code,description:Ee.description||"",discount_type:Ee.discount_type,discount_value:Ee.discount_value.toString(),min_order_value:((ot=Ee.min_order_value)==null?void 0:ot.toString())||"",max_discount:((yt=Ee.max_discount)==null?void 0:yt.toString())||"",usage_limit:((Je=Ee.usage_limit)==null?void 0:Je.toString())||"",valid_from:Ee.valid_from.split("T")[0],valid_until:Ee.valid_until?Ee.valid_until.split("T")[0]:"",city_id:Ee.city_id||"",neighborhood_id:Ee.neighborhood_id||"",establishment_id:Ee.establishment_id||""}),Ee.city_id&&Ce(Ee.city_id)):(ae(null),be({code:"",description:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_discount:"",usage_limit:"",valid_from:il(new Date,"yyyy-MM-dd"),valid_until:"",city_id:"",neighborhood_id:"",establishment_id:""}),C([])),$(!0)},ze=async()=>{if(!fe.code||!fe.discount_value){gt.error("Preencha o cdigo e o valor do desconto");return}ge(!0);try{const Ee={code:fe.code.toUpperCase(),description:fe.description||null,discount_type:fe.discount_type,discount_value:parseFloat(fe.discount_value),min_order_value:fe.min_order_value?parseFloat(fe.min_order_value):null,max_discount:fe.max_discount?parseFloat(fe.max_discount):null,usage_limit:fe.usage_limit?parseInt(fe.usage_limit):null,valid_from:fe.valid_from,valid_until:fe.valid_until||null,city_id:fe.city_id||null,neighborhood_id:fe.neighborhood_id||null,establishment_id:fe.establishment_id||null};if(ee){const{error:ot}=await dt.from("coupons").update(Ee).eq("id",ee.id);if(ot)throw ot;gt.success("Cupom atualizado com sucesso!")}else{const{error:ot}=await dt.from("coupons").insert(Ee);if(ot)throw ot;gt.success("Cupom criado com sucesso!")}$(!1),ue()}catch(Ee){console.error("Error saving coupon:",Ee),gt.error(Ee.message||"Erro ao salvar cupom")}finally{ge(!1)}},Me=async Ee=>{try{const{error:ot}=await dt.from("coupons").update({is_active:!Ee.is_active}).eq("id",Ee.id);if(ot)throw ot;gt.success(Ee.is_active?"Cupom desativado":"Cupom ativado"),ue()}catch(ot){console.error("Error toggling coupon:",ot),gt.error("Erro ao alterar status do cupom")}},Be=async()=>{if(ee)try{const{error:Ee}=await dt.from("coupons").delete().eq("id",ee.id);if(Ee)throw Ee;gt.success("Cupom excludo com sucesso!"),Y(!1),ae(null),ue()}catch(Ee){console.error("Error deleting coupon:",Ee),gt.error("Erro ao excluir cupom")}},Ve=p.filter(Ee=>{var ot;return Ee.code.toLowerCase().includes(D.toLowerCase())||((ot=Ee.description)==null?void 0:ot.toLowerCase().includes(D.toLowerCase()))}),We=Ee=>Ee.discount_type==="percentage"?`${Ee.discount_value}%`:Ee.discount_type==="fixed"?`R$ ${Ee.discount_value.toFixed(2)}`:Ee.discount_type==="free_delivery"?"Frete Grtis":Ee.discount_value.toString();return r||B?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(Ma,{className:"w-8 h-8 animate-spin text-primary"})}):c.jsxs("div",{className:"min-h-screen flex bg-background",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsxs("header",{className:"sticky top-0 bg-background/95 backdrop-blur border-b p-4 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>d(!0),className:"lg:hidden p-2 hover:bg-muted rounded-lg",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(see,{className:"w-6 h-6 text-primary"}),c.jsx("h1",{className:"text-xl font-bold",children:"Cupons de Desconto"})]})]}),c.jsxs(Ft,{onClick:()=>ve(),children:[c.jsx(dc,{className:"w-4 h-4 mr-2"}),"Novo Cupom"]})]}),c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"relative max-w-md",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por cdigo ou descrio...",value:D,onChange:Ee=>G(Ee.target.value),className:"pl-10"})]}),c.jsx("div",{className:"border rounded-lg overflow-hidden",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Cdigo"}),c.jsx(ai,{children:"Desconto"}),c.jsx(ai,{children:"Validade"}),c.jsx(ai,{children:"Uso"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{className:"w-[120px]",children:"Aes"})]})}),c.jsx(Jm,{children:Ve.length===0?c.jsx(Vo,{children:c.jsx(ti,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Nenhum cupom encontrado"})}):Ve.map(Ee=>c.jsxs(Vo,{children:[c.jsx(ti,{children:c.jsxs("div",{children:[c.jsx("p",{className:"font-mono font-bold",children:Ee.code}),Ee.description&&c.jsx("p",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:Ee.description})]})}),c.jsxs(ti,{children:[c.jsx(dn,{variant:"secondary",children:We(Ee)}),Ee.min_order_value&&Ee.min_order_value>0&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Mn: R$ ",Ee.min_order_value.toFixed(2)]})]}),c.jsxs(ti,{children:[c.jsx("p",{className:"text-sm",children:il(new Date(Ee.valid_from),"dd/MM/yyyy",{locale:wf})}),Ee.valid_until&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:["at ",il(new Date(Ee.valid_until),"dd/MM/yyyy",{locale:wf})]})]}),c.jsx(ti,{children:c.jsxs("p",{className:"text-sm",children:[Ee.usage_count||0,Ee.usage_limit&&` / ${Ee.usage_limit}`]})}),c.jsx(ti,{children:c.jsx(dn,{variant:Ee.is_active?"default":"outline",children:Ee.is_active?"Ativo":"Inativo"})}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>Me(Ee),title:Ee.is_active?"Desativar":"Ativar",children:Ee.is_active?c.jsx(oee,{className:"w-4 h-4 text-primary"}):c.jsx(aee,{className:"w-4 h-4 text-muted-foreground"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>ve(Ee),children:c.jsx(Im,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>{ae(Ee),Y(!0)},children:c.jsx(xd,{className:"w-4 h-4 text-destructive"})})]})})]},Ee.id))})]})})]})]}),c.jsx($l,{open:V,onOpenChange:$,children:c.jsxs(ul,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[c.jsx(dl,{children:c.jsx(hl,{children:ee?"Editar Cupom":"Novo Cupom"})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"code",children:"Cdigo *"}),c.jsx(ar,{id:"code",value:fe.code,onChange:Ee=>be({...fe,code:Ee.target.value.toUpperCase()}),placeholder:"PROMO10"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"discount_type",children:"Tipo de Desconto"}),c.jsxs(ns,{value:fe.discount_type,onValueChange:Ee=>be({...fe,discount_type:Ee}),children:[c.jsx(Ji,{children:c.jsx(is,{})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"percentage",children:"Porcentagem (%)"}),c.jsx(sn,{value:"fixed",children:"Valor Fixo (R$)"}),c.jsx(sn,{value:"free_delivery",children:"Frete Grtis"})]})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"description",children:"Descrio"}),c.jsx(ar,{id:"description",value:fe.description,onChange:Ee=>be({...fe,description:Ee.target.value}),placeholder:"Descrio do cupom"})]}),fe.discount_type!=="free_delivery"&&c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs(zt,{htmlFor:"discount_value",children:["Valor do Desconto *"," ",fe.discount_type==="percentage"?"(%)":"(R$)"]}),c.jsx(ar,{id:"discount_value",type:"number",value:fe.discount_value,onChange:Ee=>be({...fe,discount_value:Ee.target.value}),placeholder:"10"})]}),fe.discount_type==="percentage"&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"max_discount",children:"Desconto Mximo (R$)"}),c.jsx(ar,{id:"max_discount",type:"number",value:fe.max_discount,onChange:Ee=>be({...fe,max_discount:Ee.target.value}),placeholder:"50"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"min_order_value",children:"Valor Mnimo do Pedido"}),c.jsx(ar,{id:"min_order_value",type:"number",value:fe.min_order_value,onChange:Ee=>be({...fe,min_order_value:Ee.target.value}),placeholder:"0"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"usage_limit",children:"Limite de Uso"}),c.jsx(ar,{id:"usage_limit",type:"number",value:fe.usage_limit,onChange:Ee=>be({...fe,usage_limit:Ee.target.value}),placeholder:"Ilimitado"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"valid_from",children:"Vlido a partir de"}),c.jsx(ar,{id:"valid_from",type:"date",value:fe.valid_from,onChange:Ee=>be({...fe,valid_from:Ee.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"valid_until",children:"Vlido at"}),c.jsx(ar,{id:"valid_until",type:"date",value:fe.valid_until,onChange:Ee=>be({...fe,valid_until:Ee.target.value})})]})]}),c.jsxs("div",{className:"border-t pt-4",children:[c.jsx("p",{className:"text-sm font-medium mb-3",children:"Restries (opcional)"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"city_id",children:"Cidade"}),c.jsxs(ns,{value:fe.city_id,onValueChange:Ee=>{be({...fe,city_id:Ee==="all"?"":Ee,neighborhood_id:""}),Ee&&Ee!=="all"?Ce(Ee):C([])},children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todas as cidades"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todas as cidades"}),_.map(Ee=>c.jsxs(sn,{value:Ee.id,children:[Ee.name," - ",Ee.state]},Ee.id))]})]})]}),fe.city_id&&T.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"neighborhood_id",children:"Bairro"}),c.jsxs(ns,{value:fe.neighborhood_id,onValueChange:Ee=>be({...fe,neighborhood_id:Ee==="all"?"":Ee}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todos os bairros"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos os bairros"}),T.map(Ee=>c.jsx(sn,{value:Ee.id,children:Ee.name},Ee.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"establishment_id",children:"Estabelecimento"}),c.jsxs(ns,{value:fe.establishment_id,onValueChange:Ee=>be({...fe,establishment_id:Ee==="all"?"":Ee}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todos os estabelecimentos"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos os estabelecimentos"}),P.map(Ee=>c.jsx(sn,{value:Ee.id,children:Ee.name},Ee.id))]})]})]})]})]})]}),c.jsxs(Ff,{children:[c.jsx(Ft,{variant:"outline",onClick:()=>$(!1),children:"Cancelar"}),c.jsxs(Ft,{onClick:ze,disabled:ie,children:[ie&&c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}),ee?"Salvar":"Criar"]})]})]})}),c.jsx(fk,{open:K,onOpenChange:Y,children:c.jsxs(tE,{children:[c.jsxs(rE,{children:[c.jsx(iE,{children:"Excluir cupom?"}),c.jsxs(sE,{children:["Esta ao no pode ser desfeita. O cupom"," ",c.jsx("strong",{children:ee==null?void 0:ee.code})," ser excludo permanentemente."]})]}),c.jsxs(nE,{children:[c.jsx(oE,{children:"Cancelar"}),c.jsx(aE,{onClick:Be,className:"bg-destructive",children:"Excluir"})]})]})})]})},Drt=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState([]),[P,k]=F.useState([]),[B,R]=F.useState(!0),[D,G]=F.useState(""),[V,$]=F.useState(!1),[K,Y]=F.useState(!1),[ee,ae]=F.useState(null),[ie,ge]=F.useState(!1),[fe,be]=F.useState(!1),[ue,Ce]=F.useState({title:"",description:"",discount_type:"percentage",discount_value:"",min_order_value:"",banner_url:"",valid_from:il(new Date,"yyyy-MM-dd"),valid_until:"",city_id:"",neighborhood_id:"",establishment_id:""});F.useEffect(()=>{!r&&!t?e("/auth"):!r&&t&&!n&&(e("/"),gt.error("Acesso restrito a administradores"))},[t,r,n,e]),F.useEffect(()=>{n&&ve()},[n]);const ve=async()=>{R(!0);try{const[Je,Bt,Pt]=await Promise.all([dt.from("promotions").select("*").order("created_at",{ascending:!1}),dt.from("cities").select("*").eq("is_active",!0).order("name"),dt.from("establishments").select("id, name").eq("is_approved",!0).order("name")]);if(Je.error)throw Je.error;if(Bt.error)throw Bt.error;if(Pt.error)throw Pt.error;s(Je.data||[]),b(Bt.data||[]),k(Pt.data||[])}catch(Je){console.error("Error fetching data:",Je),gt.error("Erro ao carregar dados")}finally{R(!1)}},ze=async Je=>{try{const{data:Bt,error:Pt}=await dt.from("neighborhoods").select("*").eq("city_id",Je).eq("is_active",!0).order("name");if(Pt)throw Pt;C(Bt||[])}catch(Bt){console.error("Error fetching neighborhoods:",Bt)}},Me=Je=>{var Bt,Pt;Je?(ae(Je),Ce({title:Je.title,description:Je.description||"",discount_type:Je.discount_type,discount_value:((Bt=Je.discount_value)==null?void 0:Bt.toString())||"",min_order_value:((Pt=Je.min_order_value)==null?void 0:Pt.toString())||"",banner_url:Je.banner_url||"",valid_from:Je.valid_from.split("T")[0],valid_until:Je.valid_until?Je.valid_until.split("T")[0]:"",city_id:Je.city_id||"",neighborhood_id:Je.neighborhood_id||"",establishment_id:Je.establishment_id||""}),Je.city_id&&ze(Je.city_id)):(ae(null),Ce({title:"",description:"",discount_type:"percentage",discount_value:"",min_order_value:"",banner_url:"",valid_from:il(new Date,"yyyy-MM-dd"),valid_until:"",city_id:"",neighborhood_id:"",establishment_id:""}),C([])),$(!0)},Be=async Je=>{var Pt;const Bt=(Pt=Je.target.files)==null?void 0:Pt[0];if(Bt){if(!Bt.type.startsWith("image/")){gt.error("Por favor, selecione uma imagem");return}be(!0);try{const pt=Bt.name.split(".").pop(),Pr=`promotions/${`${Date.now()}.${pt}`}`,{error:Ot}=await dt.storage.from("establishments").upload(Pr,Bt);if(Ot)throw Ot;const{data:nr}=dt.storage.from("establishments").getPublicUrl(Pr);Ce({...ue,banner_url:nr.publicUrl}),gt.success("Imagem enviada com sucesso!")}catch(pt){console.error("Error uploading image:",pt),gt.error("Erro ao enviar imagem")}finally{be(!1)}}},Ve=async()=>{if(!ue.title){gt.error("Preencha o ttulo da promoo");return}ge(!0);try{const Je={title:ue.title,description:ue.description||null,discount_type:ue.discount_type,discount_value:ue.discount_value?parseFloat(ue.discount_value):null,min_order_value:ue.min_order_value?parseFloat(ue.min_order_value):null,banner_url:ue.banner_url||null,valid_from:ue.valid_from,valid_until:ue.valid_until||null,city_id:ue.city_id||null,neighborhood_id:ue.neighborhood_id||null,establishment_id:ue.establishment_id||null};if(ee){const{error:Bt}=await dt.from("promotions").update(Je).eq("id",ee.id);if(Bt)throw Bt;gt.success("Promoo atualizada com sucesso!")}else{const{error:Bt}=await dt.from("promotions").insert(Je);if(Bt)throw Bt;gt.success("Promoo criada com sucesso!")}$(!1),ve()}catch(Je){console.error("Error saving promotion:",Je),gt.error(Je.message||"Erro ao salvar promoo")}finally{ge(!1)}},We=async Je=>{try{const{error:Bt}=await dt.from("promotions").update({is_active:!Je.is_active}).eq("id",Je.id);if(Bt)throw Bt;gt.success(Je.is_active?"Promoo desativada":"Promoo ativada"),ve()}catch(Bt){console.error("Error toggling promotion:",Bt),gt.error("Erro ao alterar status da promoo")}},Ee=async()=>{if(ee)try{const{error:Je}=await dt.from("promotions").delete().eq("id",ee.id);if(Je)throw Je;gt.success("Promoo excluda com sucesso!"),Y(!1),ae(null),ve()}catch(Je){console.error("Error deleting promotion:",Je),gt.error("Erro ao excluir promoo")}},ot=p.filter(Je=>{var Bt;return Je.title.toLowerCase().includes(D.toLowerCase())||((Bt=Je.description)==null?void 0:Bt.toLowerCase().includes(D.toLowerCase()))}),yt=Je=>Je.discount_value?Je.discount_type==="percentage"?`${Je.discount_value}%`:Je.discount_type==="fixed"?`R$ ${Je.discount_value.toFixed(2)}`:Je.discount_type==="free_delivery"?"Frete Grtis":Je.discount_value.toString():"";return r||B?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(Ma,{className:"w-8 h-8 animate-spin text-primary"})}):c.jsxs("div",{className:"min-h-screen flex bg-background",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsxs("header",{className:"sticky top-0 bg-background/95 backdrop-blur border-b p-4 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>d(!0),className:"lg:hidden p-2 hover:bg-muted rounded-lg",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(iee,{className:"w-6 h-6 text-primary"}),c.jsx("h1",{className:"text-xl font-bold",children:"Promoes"})]})]}),c.jsxs(Ft,{onClick:()=>Me(),children:[c.jsx(dc,{className:"w-4 h-4 mr-2"}),"Nova Promoo"]})]}),c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"relative max-w-md",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por ttulo ou descrio...",value:D,onChange:Je=>G(Je.target.value),className:"pl-10"})]}),c.jsx("div",{className:"border rounded-lg overflow-hidden",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Banner"}),c.jsx(ai,{children:"Ttulo"}),c.jsx(ai,{children:"Desconto"}),c.jsx(ai,{children:"Validade"}),c.jsx(ai,{children:"Regio"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{className:"w-[120px]",children:"Aes"})]})}),c.jsx(Jm,{children:ot.length===0?c.jsx(Vo,{children:c.jsx(ti,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Nenhuma promoo encontrada"})}):ot.map(Je=>c.jsxs(Vo,{children:[c.jsx(ti,{children:Je.banner_url?c.jsx("img",{src:Je.banner_url,alt:Je.title,className:"w-20 h-12 object-cover rounded"}):c.jsx("div",{className:"w-20 h-12 bg-muted rounded flex items-center justify-center",children:c.jsx(OP,{className:"w-5 h-5 text-muted-foreground"})})}),c.jsx(ti,{children:c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:Je.title}),Je.description&&c.jsx("p",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:Je.description})]})}),c.jsxs(ti,{children:[c.jsx(dn,{variant:"secondary",children:yt(Je)}),Je.min_order_value&&Je.min_order_value>0&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Mn: R$ ",Je.min_order_value.toFixed(2)]})]}),c.jsxs(ti,{children:[c.jsx("p",{className:"text-sm",children:il(new Date(Je.valid_from),"dd/MM/yyyy",{locale:wf})}),Je.valid_until&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:["at ",il(new Date(Je.valid_until),"dd/MM/yyyy",{locale:wf})]})]}),c.jsx(ti,{children:Je.city_id||Je.neighborhood_id?c.jsx(dn,{variant:"outline",children:"Regional"}):Je.establishment_id?c.jsx(dn,{variant:"outline",children:"Estabelecimento"}):c.jsx("span",{className:"text-sm text-muted-foreground",children:"Geral"})}),c.jsx(ti,{children:c.jsx(dn,{variant:Je.is_active?"default":"outline",children:Je.is_active?"Ativo":"Inativo"})}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>We(Je),title:Je.is_active?"Desativar":"Ativar",children:Je.is_active?c.jsx(oee,{className:"w-4 h-4 text-primary"}):c.jsx(aee,{className:"w-4 h-4 text-muted-foreground"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>Me(Je),children:c.jsx(Im,{className:"w-4 h-4"})}),c.jsx(Ft,{variant:"ghost",size:"icon",onClick:()=>{ae(Je),Y(!0)},children:c.jsx(xd,{className:"w-4 h-4 text-destructive"})})]})})]},Je.id))})]})})]})]}),c.jsx($l,{open:V,onOpenChange:$,children:c.jsxs(ul,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[c.jsx(dl,{children:c.jsx(hl,{children:ee?"Editar Promoo":"Nova Promoo"})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"title",children:"Ttulo *"}),c.jsx(ar,{id:"title",value:ue.title,onChange:Je=>Ce({...ue,title:Je.target.value}),placeholder:"Ex: 10% OFF em toda a loja"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"description",children:"Descrio"}),c.jsx(Ih,{id:"description",value:ue.description,onChange:Je=>Ce({...ue,description:Je.target.value}),placeholder:"Descrio detalhada da promoo",rows:3})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Banner"}),c.jsxs("div",{className:"flex items-center gap-4",children:[ue.banner_url?c.jsx("img",{src:ue.banner_url,alt:"Banner preview",className:"w-32 h-20 object-cover rounded border"}):c.jsx("div",{className:"w-32 h-20 bg-muted rounded border flex items-center justify-center",children:c.jsx(OP,{className:"w-6 h-6 text-muted-foreground"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx(ar,{type:"file",accept:"image/*",onChange:Be,disabled:fe}),fe&&c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enviando..."})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"discount_type",children:"Tipo de Desconto"}),c.jsxs(ns,{value:ue.discount_type,onValueChange:Je=>Ce({...ue,discount_type:Je}),children:[c.jsx(Ji,{children:c.jsx(is,{})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"percentage",children:"Porcentagem (%)"}),c.jsx(sn,{value:"fixed",children:"Valor Fixo (R$)"}),c.jsx(sn,{value:"free_delivery",children:"Frete Grtis"})]})]})]}),ue.discount_type!=="free_delivery"&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs(zt,{htmlFor:"discount_value",children:["Valor ",ue.discount_type==="percentage"?"(%)":"(R$)"]}),c.jsx(ar,{id:"discount_value",type:"number",value:ue.discount_value,onChange:Je=>Ce({...ue,discount_value:Je.target.value}),placeholder:"10"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"min_order_value",children:"Valor Mnimo do Pedido (R$)"}),c.jsx(ar,{id:"min_order_value",type:"number",value:ue.min_order_value,onChange:Je=>Ce({...ue,min_order_value:Je.target.value}),placeholder:"0"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"valid_from",children:"Vlido a partir de"}),c.jsx(ar,{id:"valid_from",type:"date",value:ue.valid_from,onChange:Je=>Ce({...ue,valid_from:Je.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"valid_until",children:"Vlido at"}),c.jsx(ar,{id:"valid_until",type:"date",value:ue.valid_until,onChange:Je=>Ce({...ue,valid_until:Je.target.value})})]})]}),c.jsxs("div",{className:"border-t pt-4",children:[c.jsx("p",{className:"text-sm font-medium mb-3",children:"Segmentao Regional (opcional)"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"city_id",children:"Cidade"}),c.jsxs(ns,{value:ue.city_id,onValueChange:Je=>{Ce({...ue,city_id:Je==="all"?"":Je,neighborhood_id:""}),Je&&Je!=="all"?ze(Je):C([])},children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todas as cidades"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todas as cidades"}),_.map(Je=>c.jsxs(sn,{value:Je.id,children:[Je.name," - ",Je.state]},Je.id))]})]})]}),ue.city_id&&T.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"neighborhood_id",children:"Bairro"}),c.jsxs(ns,{value:ue.neighborhood_id,onValueChange:Je=>Ce({...ue,neighborhood_id:Je==="all"?"":Je}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todos os bairros"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos os bairros"}),T.map(Je=>c.jsx(sn,{value:Je.id,children:Je.name},Je.id))]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"establishment_id",children:"Estabelecimento"}),c.jsxs(ns,{value:ue.establishment_id,onValueChange:Je=>Ce({...ue,establishment_id:Je==="all"?"":Je}),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Todos os estabelecimentos"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos os estabelecimentos"}),P.map(Je=>c.jsx(sn,{value:Je.id,children:Je.name},Je.id))]})]})]})]})]})]}),c.jsxs(Ff,{children:[c.jsx(Ft,{variant:"outline",onClick:()=>$(!1),children:"Cancelar"}),c.jsxs(Ft,{onClick:Ve,disabled:ie,children:[ie&&c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}),ee?"Salvar":"Criar"]})]})]})}),c.jsx(fk,{open:K,onOpenChange:Y,children:c.jsxs(tE,{children:[c.jsxs(rE,{children:[c.jsx(iE,{children:"Excluir promoo?"}),c.jsxs(sE,{children:["Esta ao no pode ser desfeita. A promoo"," ",c.jsx("strong",{children:ee==null?void 0:ee.title})," ser excluda permanentemente."]})]}),c.jsxs(nE,{children:[c.jsx(oE,{children:"Cancelar"}),c.jsx(aE,{onClick:Ee,className:"bg-destructive",children:"Excluir"})]})]})})]})},Lrt=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(""),[B,R]=F.useState("all"),[D,G]=F.useState(!1),[V,$]=F.useState(!1),[K,Y]=F.useState([]),[ee,ae]=F.useState({establishment_id:"",amount:"",due_date:"",period:""});F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&ie()},[t,r,n,e]),F.useEffect(()=>{let ve=p;P&&(ve=ve.filter(ze=>{var Me;return((Me=ze.establishments)==null?void 0:Me.name.toLowerCase().includes(P.toLowerCase()))||ze.period.toLowerCase().includes(P.toLowerCase())})),B!=="all"&&(ve=ve.filter(ze=>ze.status===B)),b(ve)},[p,P,B]);const ie=async()=>{try{const[ve,ze]=await Promise.all([dt.from("establishment_invoices").select("*, establishments(name)").order("due_date",{ascending:!1}),dt.from("establishments").select("id, name").eq("is_approved",!0).order("name")]);if(ve.error)throw ve.error;s(ve.data||[]),Y(ze.data||[])}catch{gt.error("Erro ao carregar faturas")}finally{C(!1)}},ge=async(ve,ze)=>{try{const Me={status:ze};ze==="paid"&&(Me.paid_at=new Date().toISOString());const{error:Be}=await dt.from("establishment_invoices").update(Me).eq("id",ve);if(Be)throw Be;s(Ve=>Ve.map(We=>We.id===ve?{...We,status:ze,...ze==="paid"?{paid_at:new Date().toISOString()}:{}}:We)),gt.success(`Fatura marcada como ${be(ze)}`)}catch{gt.error("Erro ao atualizar fatura")}},fe=async()=>{if(!ee.establishment_id||!ee.amount||!ee.due_date||!ee.period){gt.error("Preencha todos os campos");return}$(!0);try{const{error:ve}=await dt.from("establishment_invoices").insert({establishment_id:ee.establishment_id,amount:parseFloat(ee.amount),due_date:ee.due_date,period:ee.period,status:"pending"});if(ve)throw ve;gt.success("Fatura criada com sucesso!"),G(!1),ae({establishment_id:"",amount:"",due_date:"",period:""}),ie()}catch{gt.error("Erro ao criar fatura")}finally{$(!1)}},be=ve=>{switch(ve){case"paid":return"Pago";case"pending":return"Pendente";case"overdue":return"Atrasado";default:return ve}},ue=ve=>{switch(ve){case"paid":return c.jsxs(dn,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[c.jsx(Da,{className:"w-3 h-3 mr-1"}),"Pago"]});case"pending":return c.jsxs(dn,{className:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",children:[c.jsx(ki,{className:"w-3 h-3 mr-1"}),"Pendente"]});case"overdue":return c.jsxs(dn,{variant:"destructive",children:[c.jsx(qS,{className:"w-3 h-3 mr-1"}),"Atrasado"]});default:return c.jsx(dn,{variant:"secondary",children:ve})}},Ce={total:p.length,pending:p.filter(ve=>ve.status==="pending").length,overdue:p.filter(ve=>ve.status==="overdue").length,paid:p.filter(ve=>ve.status==="paid").length,totalAmount:p.reduce((ve,ze)=>ve+Number(ze.amount),0),pendingAmount:p.filter(ve=>ve.status==="pending"||ve.status==="overdue").reduce((ve,ze)=>ve+Number(ze.amount),0)};return r||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Faturas"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[Ce.total," faturas, ",Ce.pending," pendentes"]})]})]}),c.jsxs(Ft,{onClick:()=>G(!0),children:[c.jsx(dc,{className:"w-4 h-4 mr-2"}),"Nova Fatura"]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(Rc,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:Ce.total}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Faturas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:c.jsx(ki,{className:"w-5 h-5 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:Ce.pending}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Pendentes"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-destructive/10 rounded-lg",children:c.jsx(qS,{className:"w-5 h-5 text-destructive"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:Ce.overdue}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Atrasadas"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:c.jsx($o,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",Ce.pendingAmount.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"A Receber"})]})]})})})]}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por estabelecimento, perodo...",value:P,onChange:ve=>k(ve.target.value),className:"pl-10"})]}),c.jsxs(ns,{value:B,onValueChange:R,children:[c.jsx(Ji,{className:"w-full sm:w-48",children:c.jsx(is,{placeholder:"Filtrar por status"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos"}),c.jsx(sn,{value:"pending",children:"Pendentes"}),c.jsx(sn,{value:"overdue",children:"Atrasadas"}),c.jsx(sn,{value:"paid",children:"Pagas"})]})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"p-0",children:_.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Rc,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhuma fatura encontrada"})]}):c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Estabelecimento"}),c.jsx(ai,{children:"Perodo"}),c.jsx(ai,{children:"Vencimento"}),c.jsx(ai,{children:"Valor"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{className:"text-right",children:"Aes"})]})}),c.jsx(Jm,{children:_.map(ve=>{var ze;return c.jsxs(Vo,{children:[c.jsx(ti,{children:c.jsx("p",{className:"font-medium",children:((ze=ve.establishments)==null?void 0:ze.name)||""})}),c.jsx(ti,{children:ve.period}),c.jsx(ti,{children:new Date(ve.due_date).toLocaleDateString("pt-BR")}),c.jsx(ti,{children:c.jsxs("p",{className:"font-bold",children:["R$ ",Number(ve.amount).toFixed(2)]})}),c.jsx(ti,{children:ue(ve.status)}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center justify-end gap-2",children:[ve.status==="pending"&&c.jsxs(c.Fragment,{children:[c.jsxs(Ft,{variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-700 hover:bg-green-100",onClick:()=>ge(ve.id,"paid"),children:[c.jsx(Da,{className:"w-4 h-4 mr-1"}),"Pago"]}),c.jsxs(Ft,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>ge(ve.id,"overdue"),children:[c.jsx(qS,{className:"w-4 h-4 mr-1"}),"Atrasado"]})]}),ve.status==="overdue"&&c.jsxs(Ft,{variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-700 hover:bg-green-100",onClick:()=>ge(ve.id,"paid"),children:[c.jsx(Da,{className:"w-4 h-4 mr-1"}),"Marcar Pago"]}),ve.status==="paid"&&c.jsx("span",{className:"text-sm text-muted-foreground",children:ve.paid_at?`Pago em ${new Date(ve.paid_at).toLocaleDateString("pt-BR")}`:"Pago"})]})})]},ve.id)})})]})})})})]})]}),c.jsx($l,{open:D,onOpenChange:G,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Nova Fatura"}),c.jsx(Dm,{children:"Crie uma nova fatura para um estabelecimento"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Estabelecimento"}),c.jsxs(ns,{value:ee.establishment_id,onValueChange:ve=>ae(ze=>({...ze,establishment_id:ve})),children:[c.jsx(Ji,{children:c.jsx(is,{placeholder:"Selecione o estabelecimento"})}),c.jsx(Qi,{children:K.map(ve=>c.jsx(sn,{value:ve.id,children:ve.name},ve.id))})]})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Perodo"}),c.jsx(ar,{placeholder:"Ex: Janeiro 2026",value:ee.period,onChange:ve=>ae(ze=>({...ze,period:ve.target.value}))})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Valor (R$)"}),c.jsx(ar,{type:"number",step:"0.01",placeholder:"0.00",value:ee.amount,onChange:ve=>ae(ze=>({...ze,amount:ve.target.value}))})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Data de Vencimento"}),c.jsx(ar,{type:"date",value:ee.due_date,onChange:ve=>ae(ze=>({...ze,due_date:ve.target.value}))})]})]}),c.jsxs(Ff,{children:[c.jsx(Ft,{variant:"outline",onClick:()=>G(!1),children:"Cancelar"}),c.jsx(Ft,{onClick:fe,disabled:V,children:V?"Criando...":"Criar Fatura"})]})]})})]})},Frt=()=>{const e=di(),{user:t,loading:r,isAdmin:n}=$i(),[a,d]=F.useState(!1),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(!0),[P,k]=F.useState(""),[B,R]=F.useState("all"),[D,G]=F.useState(!1),[V,$]=F.useState(null),[K,Y]=F.useState(""),[ee,ae]=F.useState(!1),[ie,ge]=F.useState(null);F.useEffect(()=>{if(!r&&!t){e("/auth");return}if(!r&&t&&!n){gt.error("Acesso negado. rea restrita para administradores."),e("/");return}t&&n&&fe()},[t,r,n,e]),F.useEffect(()=>{let Me=p;P&&(Me=Me.filter(Be=>{var Ve;return(Ve=Be.establishments)==null?void 0:Ve.name.toLowerCase().includes(P.toLowerCase())})),B!=="all"&&(Me=Me.filter(Be=>Be.status===B)),b(Me)},[p,P,B]);const fe=async()=>{try{const{data:Me,error:Be}=await dt.from("establishment_withdrawals").select("*, establishments(name)").order("requested_at",{ascending:!1});if(Be)throw Be;s(Me||[])}catch{gt.error("Erro ao carregar saques")}finally{C(!1)}},be=async Me=>{try{const{error:Be}=await dt.from("establishment_withdrawals").update({status:"approved",processed_at:new Date().toISOString()}).eq("id",Me);if(Be)throw Be;s(Ve=>Ve.map(We=>We.id===Me?{...We,status:"approved",processed_at:new Date().toISOString()}:We)),gt.success("Saque aprovado com sucesso!")}catch{gt.error("Erro ao aprovar saque")}},ue=async()=>{if(ie)try{const{error:Me}=await dt.from("establishment_withdrawals").update({status:"rejected",processed_at:new Date().toISOString()}).eq("id",ie);if(Me)throw Me;s(Be=>Be.map(Ve=>Ve.id===ie?{...Ve,status:"rejected",processed_at:new Date().toISOString()}:Ve)),gt.success("Saque rejeitado"),ae(!1),ge(null)}catch{gt.error("Erro ao rejeitar saque")}},Ce=async(Me,Be)=>{try{const{data:Ve,error:We}=await dt.from("establishment_bank_accounts").select("*").eq("establishment_id",Me).maybeSingle();if(We)throw We;$(Ve),Y(Be),G(!0)}catch{gt.error("Erro ao carregar dados bancrios")}},ve=Me=>{switch(Me){case"pending":return c.jsxs(dn,{className:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",children:[c.jsx(ki,{className:"w-3 h-3 mr-1"}),"Pendente"]});case"approved":return c.jsxs(dn,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[c.jsx(Da,{className:"w-3 h-3 mr-1"}),"Aprovado"]});case"rejected":return c.jsxs(dn,{variant:"destructive",children:[c.jsx(Of,{className:"w-3 h-3 mr-1"}),"Rejeitado"]});default:return c.jsx(dn,{variant:"secondary",children:Me})}},ze={total:p.length,pending:p.filter(Me=>Me.status==="pending").length,approved:p.filter(Me=>Me.status==="approved").length,rejected:p.filter(Me=>Me.status==="rejected").length,pendingAmount:p.filter(Me=>Me.status==="pending").reduce((Me,Be)=>Me+Number(Be.amount),0),totalApproved:p.filter(Me=>Me.status==="approved").reduce((Me,Be)=>Me+Number(Be.amount),0)};return r||T?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Vc,{open:a,onClose:()=>d(!1)}),c.jsxs("main",{className:"flex-1 overflow-auto",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{className:"lg:hidden p-2 hover:bg-muted rounded-lg",onClick:()=>d(!0),children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"font-bold text-lg",children:"Saques"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[ze.pending," pendentes de aprovao"]})]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:c.jsx(Ty,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:ze.total}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Saques"})]})]})})}),c.jsx(Vt,{className:"border-yellow-500/30",children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:c.jsx(ki,{className:"w-5 h-5 text-yellow-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:ze.pending}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Pendentes"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:c.jsx(qS,{className:"w-5 h-5 text-yellow-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",ze.pendingAmount.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Valor Pendente"})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:c.jsx($o,{className:"w-5 h-5 text-green-600"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["R$ ",ze.totalApproved.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Aprovado"})]})]})})})]}),c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(_d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{placeholder:"Buscar por estabelecimento...",value:P,onChange:Me=>k(Me.target.value),className:"pl-10"})]}),c.jsxs(ns,{value:B,onValueChange:R,children:[c.jsx(Ji,{className:"w-full sm:w-48",children:c.jsx(is,{placeholder:"Filtrar por status"})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"all",children:"Todos"}),c.jsx(sn,{value:"pending",children:"Pendentes"}),c.jsx(sn,{value:"approved",children:"Aprovados"}),c.jsx(sn,{value:"rejected",children:"Rejeitados"})]})]})]})})}),c.jsx(Vt,{children:c.jsx(Ut,{className:"p-0",children:_.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Ty,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum saque encontrado"})]}):c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(Km,{children:[c.jsx(Ym,{children:c.jsxs(Vo,{children:[c.jsx(ai,{children:"Estabelecimento"}),c.jsx(ai,{children:"Valor"}),c.jsx(ai,{children:"Solicitado em"}),c.jsx(ai,{children:"Status"}),c.jsx(ai,{children:"Processado em"}),c.jsx(ai,{className:"text-right",children:"Aes"})]})}),c.jsx(Jm,{children:_.map(Me=>{var Be;return c.jsxs(Vo,{children:[c.jsx(ti,{children:c.jsx("p",{className:"font-medium",children:((Be=Me.establishments)==null?void 0:Be.name)||""})}),c.jsx(ti,{children:c.jsxs("p",{className:"font-bold",children:["R$ ",Number(Me.amount).toFixed(2)]})}),c.jsx(ti,{children:new Date(Me.requested_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),c.jsx(ti,{children:ve(Me.status)}),c.jsx(ti,{children:Me.processed_at?new Date(Me.processed_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""}),c.jsx(ti,{children:c.jsxs("div",{className:"flex items-center justify-end gap-2",children:[c.jsxs(Ft,{variant:"outline",size:"sm",onClick:()=>{var Ve;return Ce(Me.establishment_id,((Ve=Me.establishments)==null?void 0:Ve.name)||"")},children:[c.jsx(Ty,{className:"w-4 h-4 mr-1"}),"Dados"]}),Me.status==="pending"&&c.jsxs(c.Fragment,{children:[c.jsxs(Ft,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>be(Me.id),children:[c.jsx(Da,{className:"w-4 h-4 mr-1"}),"Aprovar"]}),c.jsxs(Ft,{variant:"destructive",size:"sm",onClick:()=>{ge(Me.id),ae(!0)},children:[c.jsx(Of,{className:"w-4 h-4 mr-1"}),"Rejeitar"]})]})]})})]},Me.id)})})]})})})})]})]}),c.jsx($l,{open:D,onOpenChange:G,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Dados Bancrios"}),c.jsx(Dm,{children:K})]}),V?c.jsxs("div",{className:"space-y-3",children:[V.pix_key&&c.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Chave PIX"}),c.jsxs("p",{className:"font-medium",children:[V.pix_key_type==="cpf"&&"CPF: ",V.pix_key_type==="cnpj"&&"CNPJ: ",V.pix_key_type==="email"&&"E-mail: ",V.pix_key_type==="phone"&&"Telefone: ",V.pix_key_type==="random"&&"Aleatria: ",V.pix_key]})]}),V.bank_name&&c.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Conta Bancria"}),c.jsxs("div",{className:"space-y-1 text-sm",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Banco:"})," ",V.bank_name]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Agncia:"})," ",V.agency||""]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Conta:"})," ",V.account_number||""]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Tipo:"})," ",V.account_type==="checking"?"Corrente":"Poupana"]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Titular:"})," ",V.holder_name||""]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-muted-foreground",children:"CPF/CNPJ:"})," ",V.holder_document||""]})]})]})]}):c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(Ty,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum dado bancrio cadastrado"})]})]})}),c.jsx($l,{open:ee,onOpenChange:ae,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Confirmar Rejeio"}),c.jsx(Dm,{children:"Tem certeza que deseja rejeitar este saque? Esta ao no pode ser desfeita."})]}),c.jsxs(Ff,{children:[c.jsx(Ft,{variant:"outline",onClick:()=>ae(!1),children:"Cancelar"}),c.jsx(Ft,{variant:"destructive",onClick:ue,children:"Rejeitar Saque"})]})]})})]})},zrt=()=>{const{user:e,isDriver:t}=$i(),r=di(),n=F.useRef(new Set),a=F.useRef(!1),d=F.useRef(null);F.useEffect(()=>(d.current=new(window.AudioContext||window.webkitAudioContext),()=>{d.current&&(d.current.close(),d.current=null)}),[]);const p=F.useCallback(()=>{try{const b=d.current;if(!b)return;b.state==="suspended"&&b.resume();const T=b.createOscillator(),C=b.createGain();T.connect(C),C.connect(b.destination),T.frequency.value=523.25,T.type="sine",C.gain.setValueAtTime(.4,b.currentTime),C.gain.exponentialRampToValueAtTime(.01,b.currentTime+.15),T.start(b.currentTime),T.stop(b.currentTime+.15);const P=b.createOscillator(),k=b.createGain();P.connect(k),k.connect(b.destination),P.frequency.value=659.25,P.type="sine",k.gain.setValueAtTime(.4,b.currentTime+.1),k.gain.exponentialRampToValueAtTime(.01,b.currentTime+.25),P.start(b.currentTime+.1),P.stop(b.currentTime+.25);const B=b.createOscillator(),R=b.createGain();B.connect(R),R.connect(b.destination),B.frequency.value=783.99,B.type="sine",R.gain.setValueAtTime(.4,b.currentTime+.2),R.gain.exponentialRampToValueAtTime(.01,b.currentTime+.4),B.start(b.currentTime+.2),B.stop(b.currentTime+.4);const D=b.createOscillator(),G=b.createGain();D.connect(G),G.connect(b.destination),D.frequency.value=1046.5,D.type="sine",G.gain.setValueAtTime(.5,b.currentTime+.3),G.gain.exponentialRampToValueAtTime(.01,b.currentTime+.6),D.start(b.currentTime+.3),D.stop(b.currentTime+.6)}catch{console.log("Audio notification not supported")}},[]),s=F.useCallback((b,T)=>{p();const C=(T==null?void 0:T.name)||"Estabelecimento",P=Number(b.delivery_fee).toFixed(2);if(gt.success(c.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>r("/entregador/disponiveis"),children:[c.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-green-500 rounded-full flex items-center justify-center animate-pulse",children:c.jsx("span",{className:"text-white text-xl",children:""})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold text-base text-green-700 dark:text-green-300",children:"Novo Pedido Disponvel!"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[C,"  R$ ",P]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Clique para ver detalhes"})]})]}),{duration:15e3,position:"top-center",className:"border-2 border-green-500 bg-card shadow-xl cursor-pointer"}),"Notification"in window&&Notification.permission==="granted"){const k=new Notification(" Novo Pedido Disponvel!",{body:`${C}
Taxa de entrega: R$ ${P}`,icon:"/pwa-192x192.png",tag:`driver-order-${b.id}`,requireInteraction:!0});k.onclick=()=>{window.focus(),r("/entregador/disponiveis"),k.close()}}},[p,r]),_=F.useCallback(async()=>"Notification"in window&&Notification.permission==="default"?await Notification.requestPermission()==="granted":Notification.permission==="granted",[]);return F.useEffect(()=>{if(!e||!t)return;(async()=>{const{data:C}=await dt.from("orders").select("id").eq("status","ready").is("driver_id",null);C&&C.forEach(P=>{n.current.add(P.id)}),a.current=!0})(),_();const T=dt.channel("driver-available-orders-notifications").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},async C=>{const P=C.new,k=C.old;if(a.current&&P.status==="ready"&&P.driver_id===null&&k.status!=="ready"&&!n.current.has(P.id)){const{data:B}=await dt.from("establishments").select("name, address").eq("id",P.establishment_id).maybeSingle();s(P,B||void 0),n.current.add(P.id)}(P.status!=="ready"||P.driver_id!==null)&&n.current.delete(P.id)}).subscribe();return()=>{dt.removeChannel(T)}},[e,t,s,_]),{requestNotificationPermission:_,playNotificationSound:p}},Brt=[{icon:s4,label:"Dashboard",path:"/entregador"},{icon:cs,label:"Disponveis",path:"/entregador/disponiveis"},{icon:zi,label:"Em Rota",path:"/entregador/em-rota"},{icon:bd,label:"Ganhos",path:"/entregador/ganhos"},{icon:l3,label:"Histrico",path:"/entregador/historico"},{icon:V2,label:"Configuraes",path:"/entregador/configuracoes"}],Bm=({open:e=!0,onClose:t})=>{const r=di(),n=qf(),{signOut:a,isDriverApproved:d}=$i(),p=async()=>{await a(),r("/auth")},s=_=>{r(_),t==null||t()};return c.jsxs(c.Fragment,{children:[e&&c.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:t}),c.jsxs("aside",{className:Dr("fixed lg:static inset-y-0 left-0 z-50 w-64 bg-card border-r transform transition-transform duration-300 flex flex-col",e?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:[c.jsx("div",{className:"p-4 border-b",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-14 w-auto object-contain animate-logo-pulse"}),c.jsxs("div",{children:[c.jsx("span",{className:"font-bold text-lg",children:"Entregador"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Painel de Entregas"})]})]}),c.jsx("button",{className:"lg:hidden",onClick:t,children:c.jsx(wd,{className:"w-5 h-5"})})]})}),c.jsx("nav",{className:"flex-1 p-4 space-y-1",children:Brt.map(_=>{const b=n.pathname===_.path,T=_.path==="/entregador",C=!d&&!T;return c.jsxs("button",{onClick:()=>!C&&s(_.path),disabled:C,className:Dr("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",b?"bg-green-500 text-white":"text-muted-foreground hover:bg-muted hover:text-foreground",C&&"opacity-50 cursor-not-allowed hover:bg-transparent hover:text-muted-foreground"),children:[c.jsx(_.icon,{className:"w-5 h-5"}),_.label]},_.path)})}),c.jsx("div",{className:"p-4 border-t",children:c.jsxs("button",{onClick:p,className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-destructive/10 text-destructive",children:[c.jsx(TT,{className:"w-5 h-5"}),"Sair"]})})]})]})},$rt=()=>{const e=di(),{user:t,isDriver:r,isDriverApproved:n,driverRejectionReason:a,driverRegistrationSubmittedAt:d,loading:p}=$i(),{requestNotificationPermission:s}=zrt(),[_,b]=F.useState(!0),[T,C]=F.useState(!0),[P,k]=F.useState(!1),[B,R]=F.useState("");F.useEffect(()=>{if(!d||n)return;const ue=()=>{const ve=new Date(d),ze=new Date(ve.getTime()+24*60*60*1e3),Me=new Date,Be=ze.getTime()-Me.getTime();if(Be<=0){R("Em breve");return}const Ve=Math.floor(Be/(1e3*60*60)),We=Math.floor(Be%(1e3*60*60)/(1e3*60)),Ee=Math.floor(Be%(1e3*60)/1e3);R(`${Ve}h ${We}m ${Ee}s`)};ue();const Ce=setInterval(ue,1e3);return()=>clearInterval(Ce)},[d,n]);const[D,G]=F.useState(!1),[V,$]=F.useState({todayDeliveries:0,todayEarnings:0,weekDeliveries:0,weekEarnings:0,avgDeliveryTime:0}),[K,Y]=F.useState(null),[ee,ae]=F.useState([]);F.useEffect(()=>{"Notification"in window&&G(Notification.permission==="granted")},[]);const ie=async()=>{const ue=await s();G(ue),ue?gt.success("Notificaes ativadas! Voc receber alertas de novos pedidos."):gt.error("Permisso negada. Ative nas configuraes do navegador.")};F.useEffect(()=>{if(!p&&(!t||!r)){e("/entregador/auth");return}if(t)return ge(),fe()},[t,p,r,e]);const ge=async()=>{try{const ue=new Date;ue.setHours(0,0,0,0);const Ce=new Date(ue);Ce.setDate(Ce.getDate()-7);const{data:ve}=await dt.from("orders").select("*").eq("driver_id",t.id).eq("status","delivered");if(ve){const Be=ve.filter(ot=>new Date(ot.delivered_at)>=ue),Ve=ve.filter(ot=>new Date(ot.delivered_at)>=Ce);let We=0,Ee=0;ve.forEach(ot=>{if(ot.out_for_delivery_at&&ot.delivered_at){const yt=new Date(ot.out_for_delivery_at).getTime(),Je=new Date(ot.delivered_at).getTime();We+=(Je-yt)/6e4,Ee++}}),$({todayDeliveries:Be.length,todayEarnings:Be.reduce((ot,yt)=>ot+Number(yt.delivery_fee),0),weekDeliveries:Ve.length,weekEarnings:Ve.reduce((ot,yt)=>ot+Number(yt.delivery_fee),0),avgDeliveryTime:Ee>0?Math.round(We/Ee):0})}const{data:ze}=await dt.from("orders").select("*").eq("driver_id",t.id).eq("status","out_for_delivery").maybeSingle();Y(ze);const{data:Me}=await dt.from("orders").select("*").eq("status","ready").is("driver_id",null).order("created_at",{ascending:!0}).limit(5);ae(Me||[])}catch{gt.error("Erro ao carregar dados")}finally{b(!1)}},fe=()=>{const ue=dt.channel("driver-orders").on("postgres_changes",{event:"*",schema:"public",table:"orders"},()=>{ge()}).subscribe();return()=>{dt.removeChannel(ue)}},be=async ue=>{if(K){gt.error("Voc j tem uma entrega em andamento");return}const{error:Ce}=await dt.from("orders").update({driver_id:t.id,status:"out_for_delivery",out_for_delivery_at:new Date().toISOString()}).eq("id",ue).eq("status","ready").is("driver_id",null);Ce?gt.error("Erro ao aceitar pedido. Talvez outro entregador j aceitou."):(gt.success("Pedido aceito! Boa entrega!"),e("/entregador/em-rota"))};return p||_?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-green-500"})}):n?c.jsxs("div",{className:"min-h-screen bg-background flex w-full",children:[c.jsx(Bm,{open:P,onClose:()=>k(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>k(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-1.5 rounded-lg",children:c.jsx(Bc,{className:"w-5 h-5 text-white"})}),c.jsx("h1",{className:"font-bold text-lg",children:"Dashboard"})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[!D&&c.jsxs(Ft,{variant:"outline",size:"sm",onClick:ie,className:"gap-1.5 text-xs",children:[c.jsx(z2,{className:"w-3.5 h-3.5"}),c.jsx("span",{className:"hidden sm:inline",children:"Ativar Notificaes"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:`text-sm font-medium ${T?"text-green-600":"text-muted-foreground"}`,children:T?"Online":"Offline"}),c.jsx(Bs,{checked:T,onCheckedChange:C,className:"data-[state=checked]:bg-green-500"})]})]})]})}),c.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:c.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[K&&c.jsx(gr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:c.jsx(Vt,{className:"border-green-500 bg-green-500/10",children:c.jsx(Ut,{className:"py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2 bg-green-500 rounded-full",children:c.jsx(T0,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-semibold",children:"Entrega em andamento"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",K.order_number]})]})]}),c.jsxs(Ft,{onClick:()=>e("/entregador/em-rota"),className:"bg-green-500 hover:bg-green-600",children:["Ver Rota",c.jsx(ST,{className:"w-4 h-4 ml-1"})]})]})})})}),c.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Hoje"}),c.jsx("p",{className:"text-2xl font-bold",children:V.todayDeliveries}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"entregas"})]}),c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-full",children:c.jsx(cs,{className:"w-6 h-6 text-green-600"})})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Ganhos Hoje"}),c.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",V.todayEarnings.toFixed(2)]})]}),c.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-full",children:c.jsx($o,{className:"w-6 h-6 text-green-600"})})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Semana"}),c.jsx("p",{className:"text-2xl font-bold",children:V.weekDeliveries}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"entregas"})]}),c.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:c.jsx(Ey,{className:"w-6 h-6 text-blue-600"})})]})})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Tempo Mdio"}),c.jsx("p",{className:"text-2xl font-bold",children:V.avgDeliveryTime}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"minutos"})]}),c.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-full",children:c.jsx(ki,{className:"w-6 h-6 text-orange-600"})})]})})})})]}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:c.jsxs(Vt,{children:[c.jsxs(Wr,{className:"flex flex-row items-center justify-between",children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(cs,{className:"w-5 h-5 text-green-600"}),"Pedidos Disponveis"]}),c.jsx(dn,{variant:"secondary",children:ee.length})]}),c.jsx(Ut,{children:T?K?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(T0,{className:"w-12 h-12 mx-auto mb-3 text-green-500"}),c.jsx("p",{children:"Finalize sua entrega atual para aceitar novos pedidos"})]}):ee.length===0?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(cs,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),c.jsx("p",{children:"Nenhum pedido disponvel no momento"}),c.jsx("p",{className:"text-sm mt-1",children:"Novos pedidos aparecero aqui automaticamente"})]}):c.jsxs("div",{className:"space-y-3",children:[ee.map((ue,Ce)=>c.jsxs(gr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Ce*.1},className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsxs("span",{className:"font-semibold",children:["#",ue.order_number]}),c.jsxs(dn,{variant:"outline",className:"text-green-600 border-green-600",children:["R$ ",Number(ue.delivery_fee).toFixed(2)]})]}),c.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[c.jsx(zi,{className:"w-3 h-3"}),c.jsx("span",{className:"truncate",children:ue.delivery_address})]})]}),c.jsx(Ft,{onClick:()=>be(ue.id),size:"sm",className:"bg-green-500 hover:bg-green-600 ml-3",children:"Aceitar"})]},ue.id)),c.jsxs(Ft,{variant:"outline",className:"w-full mt-2",onClick:()=>e("/entregador/disponiveis"),children:["Ver Todos os Pedidos",c.jsx(ST,{className:"w-4 h-4 ml-1"})]})]}):c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(Bc,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),c.jsx("p",{children:"Fique online para ver pedidos disponveis"})]})})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs(Ft,{variant:"outline",className:"h-20 flex-col gap-2",onClick:()=>e("/entregador/ganhos"),children:[c.jsx($o,{className:"w-6 h-6 text-green-600"}),c.jsx("span",{children:"Meus Ganhos"})]}),c.jsxs(Ft,{variant:"outline",className:"h-20 flex-col gap-2",onClick:()=>e("/entregador/historico"),children:[c.jsx(ki,{className:"w-6 h-6 text-blue-600"}),c.jsx("span",{children:"Histrico"})]})]})})]})})]})]}):c.jsxs("div",{className:"min-h-screen bg-background flex w-full",children:[c.jsx(Bm,{open:P,onClose:()=>k(!1)}),c.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:c.jsxs(gr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full text-center space-y-6",children:[c.jsx("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 p-6 rounded-full w-24 h-24 mx-auto flex items-center justify-center",children:c.jsx(ki,{className:"w-12 h-12 text-emerald-600"})}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("h1",{className:"text-2xl font-bold",children:a?"Cadastro Reprovado":"Cadastro em Anlise"}),c.jsx("p",{className:"text-muted-foreground",children:a?"Seu cadastro no foi aprovado pelos seguintes motivos:":"Seu cadastro foi recebido e est sendo analisado pela nossa equipe."}),a&&c.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-800/20 mt-4",children:[c.jsxs("p",{className:"text-sm font-bold text-red-600 uppercase mb-1 flex items-center justify-center gap-2",children:[c.jsx(Of,{className:"w-4 h-4"}),"Motivo da Recusa"]}),c.jsxs("p",{className:"text-foreground italic",children:['"',a,'"']}),c.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Por favor, entre em contato com o suporte ou refaa seu cadastro corrigindo as informaes acima."})]}),!a&&c.jsxs("p",{className:"text-sm text-emerald-600 font-medium",children:["Tempo estimado de anlise: ",B]})]}),c.jsx(Vt,{className:"bg-muted/50 border-none",children:c.jsxs(Ut,{className:"pt-6",children:[c.jsx("p",{className:"text-sm font-medium",children:"O que acontece agora?"}),c.jsxs("ul",{className:"text-sm text-muted-foreground mt-2 space-y-2",children:[c.jsx("li",{children:" Verificao dos seus documentos"}),c.jsx("li",{children:" Validao do seu veculo"}),c.jsx("li",{children:" Ativao da sua conta"}),c.jsx("li",{className:"text-xs italic text-emerald-500 font-medium font-brand mt-2",children:"* Prazo de aprovao em at 24 horas."})]})]})}),c.jsx(Ft,{variant:"outline",onClick:()=>window.location.reload(),className:"w-full h-12",children:"Verificar Novamente"})]})})]})},Vrt=()=>{const e=di(),{user:t,isDriver:r,isDriverApproved:n,loading:a}=$i(),[d,p]=F.useState(!0),[s,_]=F.useState(!1),[b,T]=F.useState([]),[C,P]=F.useState(!1);F.useEffect(()=>{if(!a&&(!t||!r)){e("/entregador/auth");return}if(!a&&t&&r&&!n){e("/entregador");return}if(t)return k(),B(),R()},[t,a,r,e]);const k=async()=>{const{data:V}=await dt.from("orders").select("id").eq("driver_id",t.id).eq("status","out_for_delivery").maybeSingle();P(!!V)},B=async()=>{p(!0);try{const{data:V,error:$}=await dt.from("orders").select("*, establishments(name, address)").eq("status","ready").is("driver_id",null).order("created_at",{ascending:!0});if($)throw $;T(V||[])}catch{gt.error("Erro ao carregar pedidos")}finally{p(!1)}},R=()=>{const V=dt.channel("available-orders").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:"status=eq.ready"},()=>{B(),k()}).subscribe();return()=>{dt.removeChannel(V)}},D=async V=>{if(C){gt.error("Voc j tem uma entrega em andamento");return}const{error:$}=await dt.from("orders").update({driver_id:t.id,status:"out_for_delivery",out_for_delivery_at:new Date().toISOString()}).eq("id",V).eq("status","ready").is("driver_id",null);$?gt.error("Erro ao aceitar pedido. Talvez outro entregador j aceitou."):(gt.success("Pedido aceito! Boa entrega!"),P(!0),e("/entregador/em-rota"))},G=V=>{const $=Date.now()-new Date(V).getTime(),K=Math.floor($/6e4);return K<60?`${K} min`:`${Math.floor(K/60)}h ${K%60}min`};return a||d?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-green-500"})}):c.jsxs("div",{className:"min-h-screen bg-background flex w-full",children:[c.jsx(Bm,{open:s,onClose:()=>_(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>_(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cs,{className:"w-5 h-5 text-green-600"}),c.jsx("h1",{className:"font-bold text-lg",children:"Pedidos Disponveis"}),c.jsx(dn,{variant:"secondary",children:b.length})]})]}),c.jsxs(Ft,{variant:"outline",size:"sm",onClick:B,children:[c.jsx(o_e,{className:"w-4 h-4 mr-2"}),"Atualizar"]})]})}),c.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:c.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[C&&c.jsx(gr.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:c.jsx(Vt,{className:"border-yellow-500 bg-yellow-500/10",children:c.jsx(Ut,{className:"py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(T0,{className:"w-5 h-5 text-yellow-600"}),c.jsx("p",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-300",children:"Voc tem uma entrega em andamento"})]}),c.jsx(Ft,{size:"sm",onClick:()=>e("/entregador/em-rota"),className:"bg-yellow-500 hover:bg-yellow-600",children:"Ver Entrega"})]})})})}),b.length===0?c.jsxs("div",{className:"text-center py-16",children:[c.jsx(cs,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),c.jsx("h3",{className:"text-lg font-medium mb-2",children:"Nenhum pedido disponvel"}),c.jsx("p",{className:"text-muted-foreground",children:"Novos pedidos aparecero aqui automaticamente"})]}):c.jsx("div",{className:"space-y-4",children:b.map((V,$)=>{var K,Y;return c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$*.1},children:c.jsx(Vt,{className:"overflow-hidden hover:border-green-500/50 transition-colors",children:c.jsxs(Ut,{className:"p-4",children:[c.jsx("div",{className:"flex items-start justify-between mb-3",children:c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsxs("span",{className:"font-bold text-lg",children:["#",V.order_number]}),c.jsxs(dn,{className:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",children:["R$ ",Number(V.delivery_fee).toFixed(2)]})]}),c.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[c.jsx(ki,{className:"w-3 h-3"}),c.jsxs("span",{children:["Aguardando h ",G(V.created_at)]})]})]})}),c.jsxs("div",{className:"space-y-2 mb-4",children:[c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(Bi,{className:"w-4 h-4 text-orange-500 mt-0.5"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-medium text-sm",children:((K=V.establishments)==null?void 0:K.name)||"Estabelecimento"}),c.jsx("p",{className:"text-xs text-muted-foreground truncate",children:((Y=V.establishments)==null?void 0:Y.address)||"Endereo no disponvel"})]})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(zi,{className:"w-4 h-4 text-green-500 mt-0.5"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-medium text-sm",children:V.customer_name}),c.jsx("p",{className:"text-xs text-muted-foreground truncate",children:V.delivery_address})]})]})]}),c.jsx(Ft,{onClick:()=>D(V.id),disabled:C,className:"w-full bg-green-500 hover:bg-green-600",children:C?"Finalize sua entrega atual":"Aceitar Pedido"})]})})},V.id)})})]})})]})]})},jue=()=>{const[e,t]=F.useState(null),[r,n]=F.useState(null),[a,d]=F.useState(!1),p=typeof navigator<"u"&&"geolocation"in navigator,s=F.useCallback(()=>new Promise((_,b)=>{if(!p){const T={code:0,message:"Geolocalizao no  suportada neste navegador"};n(T),b(T);return}d(!0),n(null),navigator.geolocation.getCurrentPosition(T=>{const C={latitude:T.coords.latitude,longitude:T.coords.longitude,accuracy:T.coords.accuracy};t(C),d(!1),_(C)},T=>{let C;switch(T.code){case T.PERMISSION_DENIED:C="Permisso de localizao negada. Por favor, habilite a localizao nas configuraes do navegador.";break;case T.POSITION_UNAVAILABLE:C="Localizao indisponvel. Verifique sua conexo GPS.";break;case T.TIMEOUT:C="Tempo esgotado ao buscar localizao. Tente novamente.";break;default:C="Erro desconhecido ao obter localizao."}const P={code:T.code,message:C};n(P),d(!1),b(P)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),[p]);return{position:e,error:r,isLoading:a,getCurrentPosition:s,isSupported:p}},Urt=({orderId:e,driverId:t,updateIntervalMs:r=5e3,onError:n})=>{const[a,d]=F.useState(!1),[p,s]=F.useState(null),{getCurrentPosition:_,isSupported:b}=jue(),T=F.useRef(null),C=F.useCallback(async()=>{try{const B=await _(),{error:R}=await dt.from("driver_locations").insert({driver_id:t,order_id:e,latitude:B.latitude,longitude:B.longitude,accuracy:B.accuracy});if(R)throw R;s(new Date)}catch(B){const R=B instanceof Error?B.message:"Erro ao enviar localizao";console.error("Location tracking error:",R),n==null||n(R)}},[_,t,e,n]),P=F.useCallback(async()=>{if(!b){gt.error("Geolocalizao no suportada neste navegador");return}d(!0),await C(),T.current=setInterval(C,r),gt.success("Rastreamento ativado")},[b,C,r]),k=F.useCallback(()=>{T.current&&(clearInterval(T.current),T.current=null),d(!1)},[]);return F.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]),{isTracking:a,lastUpdate:p,startTracking:P,stopTracking:k,isSupported:b}};var Aue={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(gS,function(){var r,n,a;function d(s,_){if(!r)r=_;else if(!n)n=_;else{var b="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",T={};r(T),a=_(T),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}d(["exports"],function(s){var _=1e-6,b=typeof Float32Array<"u"?Float32Array:Array;function T(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=l*v-m*h;return x?(u[0]=v*(x=1/x),u[1]=-h*x,u[2]=-m*x,u[3]=l*x,u):null}function C(){var u=new b(9);return b!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function P(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=i[4],S=i[5],A=i[6],N=i[7],M=i[8];return u[0]=x*M-S*N,u[1]=m*N-h*M,u[2]=h*S-m*x,u[3]=S*A-v*M,u[4]=l*M-m*A,u[5]=m*v-l*S,u[6]=v*N-x*A,u[7]=h*A-l*N,u[8]=l*x-h*v,u}function k(u,i,l){var h=i[0],m=i[1],v=i[2],x=i[3],S=i[4],A=i[5],N=i[6],M=i[7],L=i[8],z=l[0],W=l[1],H=l[2],Q=l[3],ne=l[4],te=l[5],le=l[6],de=l[7],pe=l[8];return u[0]=z*h+W*x+H*N,u[1]=z*m+W*S+H*M,u[2]=z*v+W*A+H*L,u[3]=Q*h+ne*x+te*N,u[4]=Q*m+ne*S+te*M,u[5]=Q*v+ne*A+te*L,u[6]=le*h+de*x+pe*N,u[7]=le*m+de*S+pe*M,u[8]=le*v+de*A+pe*L,u}function B(){var u=new b(16);return b!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function R(u){var i=new b(16);return i[0]=u[0],i[1]=u[1],i[2]=u[2],i[3]=u[3],i[4]=u[4],i[5]=u[5],i[6]=u[6],i[7]=u[7],i[8]=u[8],i[9]=u[9],i[10]=u[10],i[11]=u[11],i[12]=u[12],i[13]=u[13],i[14]=u[14],i[15]=u[15],i}function D(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function G(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=i[4],S=i[5],A=i[6],N=i[7],M=i[8],L=i[9],z=i[10],W=i[11],H=i[12],Q=i[13],ne=i[14],te=i[15],le=l*S-h*x,de=l*A-m*x,pe=l*N-v*x,Se=h*A-m*S,we=h*N-v*S,Ie=m*N-v*A,Oe=M*Q-L*H,Ne=M*ne-z*H,Fe=M*te-W*H,qe=L*ne-z*Q,ht=L*te-W*Q,at=z*te-W*ne,ut=le*at-de*ht+pe*qe+Se*Fe-we*Ne+Ie*Oe;return ut?(u[0]=(S*at-A*ht+N*qe)*(ut=1/ut),u[1]=(m*ht-h*at-v*qe)*ut,u[2]=(Q*Ie-ne*we+te*Se)*ut,u[3]=(z*we-L*Ie-W*Se)*ut,u[4]=(A*Fe-x*at-N*Ne)*ut,u[5]=(l*at-m*Fe+v*Ne)*ut,u[6]=(ne*pe-H*Ie-te*de)*ut,u[7]=(M*Ie-z*pe+W*de)*ut,u[8]=(x*ht-S*Fe+N*Oe)*ut,u[9]=(h*Fe-l*ht-v*Oe)*ut,u[10]=(H*we-Q*pe+te*le)*ut,u[11]=(L*pe-M*we-W*le)*ut,u[12]=(S*Ne-x*qe-A*Oe)*ut,u[13]=(l*qe-h*Ne+m*Oe)*ut,u[14]=(Q*de-H*Se-ne*le)*ut,u[15]=(M*Se-L*de+z*le)*ut,u):null}function V(u,i,l){var h=i[0],m=i[1],v=i[2],x=i[3],S=i[4],A=i[5],N=i[6],M=i[7],L=i[8],z=i[9],W=i[10],H=i[11],Q=i[12],ne=i[13],te=i[14],le=i[15],de=l[0],pe=l[1],Se=l[2],we=l[3];return u[0]=de*h+pe*S+Se*L+we*Q,u[1]=de*m+pe*A+Se*z+we*ne,u[2]=de*v+pe*N+Se*W+we*te,u[3]=de*x+pe*M+Se*H+we*le,u[4]=(de=l[4])*h+(pe=l[5])*S+(Se=l[6])*L+(we=l[7])*Q,u[5]=de*m+pe*A+Se*z+we*ne,u[6]=de*v+pe*N+Se*W+we*te,u[7]=de*x+pe*M+Se*H+we*le,u[8]=(de=l[8])*h+(pe=l[9])*S+(Se=l[10])*L+(we=l[11])*Q,u[9]=de*m+pe*A+Se*z+we*ne,u[10]=de*v+pe*N+Se*W+we*te,u[11]=de*x+pe*M+Se*H+we*le,u[12]=(de=l[12])*h+(pe=l[13])*S+(Se=l[14])*L+(we=l[15])*Q,u[13]=de*m+pe*A+Se*z+we*ne,u[14]=de*v+pe*N+Se*W+we*te,u[15]=de*x+pe*M+Se*H+we*le,u}function $(u,i,l){var h,m,v,x,S,A,N,M,L,z,W,H,Q=l[0],ne=l[1],te=l[2];return i===u?(u[12]=i[0]*Q+i[4]*ne+i[8]*te+i[12],u[13]=i[1]*Q+i[5]*ne+i[9]*te+i[13],u[14]=i[2]*Q+i[6]*ne+i[10]*te+i[14],u[15]=i[3]*Q+i[7]*ne+i[11]*te+i[15]):(m=i[1],v=i[2],x=i[3],S=i[4],A=i[5],N=i[6],M=i[7],L=i[8],z=i[9],W=i[10],H=i[11],u[0]=h=i[0],u[1]=m,u[2]=v,u[3]=x,u[4]=S,u[5]=A,u[6]=N,u[7]=M,u[8]=L,u[9]=z,u[10]=W,u[11]=H,u[12]=h*Q+S*ne+L*te+i[12],u[13]=m*Q+A*ne+z*te+i[13],u[14]=v*Q+N*ne+W*te+i[14],u[15]=x*Q+M*ne+H*te+i[15]),u}function K(u,i,l){var h=l[0],m=l[1],v=l[2];return u[0]=i[0]*h,u[1]=i[1]*h,u[2]=i[2]*h,u[3]=i[3]*h,u[4]=i[4]*m,u[5]=i[5]*m,u[6]=i[6]*m,u[7]=i[7]*m,u[8]=i[8]*v,u[9]=i[9]*v,u[10]=i[10]*v,u[11]=i[11]*v,u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15],u}function Y(u,i,l){var h=Math.sin(l),m=Math.cos(l),v=i[4],x=i[5],S=i[6],A=i[7],N=i[8],M=i[9],L=i[10],z=i[11];return i!==u&&(u[0]=i[0],u[1]=i[1],u[2]=i[2],u[3]=i[3],u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u[4]=v*m+N*h,u[5]=x*m+M*h,u[6]=S*m+L*h,u[7]=A*m+z*h,u[8]=N*m-v*h,u[9]=M*m-x*h,u[10]=L*m-S*h,u[11]=z*m-A*h,u}function ee(u,i,l){var h=Math.sin(l),m=Math.cos(l),v=i[0],x=i[1],S=i[2],A=i[3],N=i[8],M=i[9],L=i[10],z=i[11];return i!==u&&(u[4]=i[4],u[5]=i[5],u[6]=i[6],u[7]=i[7],u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u[0]=v*m-N*h,u[1]=x*m-M*h,u[2]=S*m-L*h,u[3]=A*m-z*h,u[8]=v*h+N*m,u[9]=x*h+M*m,u[10]=S*h+L*m,u[11]=A*h+z*m,u}function ae(u,i,l){var h=Math.sin(l),m=Math.cos(l),v=i[0],x=i[1],S=i[2],A=i[3],N=i[4],M=i[5],L=i[6],z=i[7];return i!==u&&(u[8]=i[8],u[9]=i[9],u[10]=i[10],u[11]=i[11],u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u[0]=v*m+N*h,u[1]=x*m+M*h,u[2]=S*m+L*h,u[3]=A*m+z*h,u[4]=N*m-v*h,u[5]=M*m-x*h,u[6]=L*m-S*h,u[7]=z*m-A*h,u}function ie(u,i){return u[0]=i[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=i[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=i[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ge(u,i,l){var h,m,v,x=l[0],S=l[1],A=l[2],N=Math.sqrt(x*x+S*S+A*A);return N<_?null:(x*=N=1/N,S*=N,A*=N,h=Math.sin(i),m=Math.cos(i),u[0]=x*x*(v=1-m)+m,u[1]=S*x*v+A*h,u[2]=A*x*v-S*h,u[3]=0,u[4]=x*S*v-A*h,u[5]=S*S*v+m,u[6]=A*S*v+x*h,u[7]=0,u[8]=x*A*v+S*h,u[9]=S*A*v-x*h,u[10]=A*A*v+m,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function fe(u,i){var l=i[0],h=i[1],m=i[2],v=i[4],x=i[5],S=i[6],A=i[8],N=i[9],M=i[10];return u[0]=Math.sqrt(l*l+h*h+m*m),u[1]=Math.sqrt(v*v+x*x+S*S),u[2]=Math.sqrt(A*A+N*N+M*M),u}function be(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=l+l,S=h+h,A=m+m,N=l*x,M=h*x,L=h*S,z=m*x,W=m*S,H=m*A,Q=v*x,ne=v*S,te=v*A;return u[0]=1-L-H,u[1]=M+te,u[2]=z-ne,u[3]=0,u[4]=M-te,u[5]=1-N-H,u[6]=W+Q,u[7]=0,u[8]=z+ne,u[9]=W-Q,u[10]=1-N-L,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var ue=V;function Ce(){var u=new b(3);return b!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ve(u){var i=new b(3);return i[0]=u[0],i[1]=u[1],i[2]=u[2],i}function ze(u){var i=u[0],l=u[1],h=u[2];return Math.sqrt(i*i+l*l+h*h)}function Me(u,i,l){var h=new b(3);return h[0]=u,h[1]=i,h[2]=l,h}function Be(u,i,l,h){return u[0]=i,u[1]=l,u[2]=h,u}function Ve(u,i,l){return u[0]=i[0]+l[0],u[1]=i[1]+l[1],u[2]=i[2]+l[2],u}function We(u,i,l){return u[0]=i[0]-l[0],u[1]=i[1]-l[1],u[2]=i[2]-l[2],u}function Ee(u,i,l){return u[0]=i[0]*l[0],u[1]=i[1]*l[1],u[2]=i[2]*l[2],u}function ot(u,i,l){return u[0]=Math.min(i[0],l[0]),u[1]=Math.min(i[1],l[1]),u[2]=Math.min(i[2],l[2]),u}function yt(u,i,l){return u[0]=Math.max(i[0],l[0]),u[1]=Math.max(i[1],l[1]),u[2]=Math.max(i[2],l[2]),u}function Je(u,i,l){return u[0]=i[0]*l,u[1]=i[1]*l,u[2]=i[2]*l,u}function Bt(u,i,l,h){return u[0]=i[0]+l[0]*h,u[1]=i[1]+l[1]*h,u[2]=i[2]+l[2]*h,u}function Pt(u,i){var l=i[0]-u[0],h=i[1]-u[1],m=i[2]-u[2];return Math.sqrt(l*l+h*h+m*m)}function pt(u,i){var l=i[0]-u[0],h=i[1]-u[1],m=i[2]-u[2];return l*l+h*h+m*m}function Gt(u){var i=u[0],l=u[1],h=u[2];return i*i+l*l+h*h}function Pr(u,i){return u[0]=-i[0],u[1]=-i[1],u[2]=-i[2],u}function Ot(u,i){var l=i[0],h=i[1],m=i[2],v=l*l+h*h+m*m;return v>0&&(v=1/Math.sqrt(v)),u[0]=i[0]*v,u[1]=i[1]*v,u[2]=i[2]*v,u}function nr(u,i){return u[0]*i[0]+u[1]*i[1]+u[2]*i[2]}function ur(u,i,l){var h=i[0],m=i[1],v=i[2],x=l[0],S=l[1],A=l[2];return u[0]=m*A-v*S,u[1]=v*x-h*A,u[2]=h*S-m*x,u}function Et(u,i,l,h){var m=i[0],v=i[1],x=i[2];return u[0]=m+h*(l[0]-m),u[1]=v+h*(l[1]-v),u[2]=x+h*(l[2]-x),u}function pr(u,i,l){var h=i[0],m=i[1],v=i[2],x=l[3]*h+l[7]*m+l[11]*v+l[15];return u[0]=(l[0]*h+l[4]*m+l[8]*v+l[12])/(x=x||1),u[1]=(l[1]*h+l[5]*m+l[9]*v+l[13])/x,u[2]=(l[2]*h+l[6]*m+l[10]*v+l[14])/x,u}function Kr(u,i,l){var h=i[0],m=i[1],v=i[2];return u[0]=h*l[0]+m*l[3]+v*l[6],u[1]=h*l[1]+m*l[4]+v*l[7],u[2]=h*l[2]+m*l[5]+v*l[8],u}function Xn(u,i,l){var h=l[0],m=l[1],v=l[2],x=l[3],S=i[0],A=i[1],N=i[2],M=m*N-v*A,L=v*S-h*N,z=h*A-m*S;return u[0]=S+x*(M+=M)+m*(z+=z)-v*(L+=L),u[1]=A+x*L+v*M-h*z,u[2]=N+x*z+h*L-m*M,u}function Jn(u){return u[0]=0,u[1]=0,u[2]=0,u}function ni(u,i){return u[0]===i[0]&&u[1]===i[1]&&u[2]===i[2]}var zn=We,hs=Ee,lt=ze;function Ct(){var u=new b(4);return b!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function Xt(u,i,l){return u[0]=i[0]*l,u[1]=i[1]*l,u[2]=i[2]*l,u[3]=i[3]*l,u}function Sr(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=l*l+h*h+m*m+v*v;return x>0&&(x=1/Math.sqrt(x)),u[0]=l*x,u[1]=h*x,u[2]=m*x,u[3]=v*x,u}function yr(u,i){return u[0]*i[0]+u[1]*i[1]+u[2]*i[2]+u[3]*i[3]}function hr(u,i,l){var h=i[0],m=i[1],v=i[2],x=i[3];return u[0]=l[0]*h+l[4]*m+l[8]*v+l[12]*x,u[1]=l[1]*h+l[5]*m+l[9]*v+l[13]*x,u[2]=l[2]*h+l[6]*m+l[10]*v+l[14]*x,u[3]=l[3]*h+l[7]*m+l[11]*v+l[15]*x,u}function Or(){var u=new b(4);return b!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Mn(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function oi(u,i,l){l*=.5;var h=i[0],m=i[1],v=i[2],x=i[3],S=Math.sin(l),A=Math.cos(l);return u[0]=h*A+x*S,u[1]=m*A+v*S,u[2]=v*A-m*S,u[3]=x*A-h*S,u}function $s(u,i,l){l*=.5;var h=i[0],m=i[1],v=i[2],x=i[3],S=Math.sin(l),A=Math.cos(l);return u[0]=h*A-v*S,u[1]=m*A+x*S,u[2]=v*A+h*S,u[3]=x*A-m*S,u}Ce(),Ct();var fs,za,Ta,fl=Sr,na=(fs=Ce(),za=Me(1,0,0),Ta=Me(0,1,0),function(u,i,l){var h=nr(i,l);return h<-.999999?(ur(fs,za,i),lt(fs)<1e-6&&ur(fs,Ta,i),Ot(fs,fs),function(m,v,x){x*=.5;var S=Math.sin(x);m[0]=S*v[0],m[1]=S*v[1],m[2]=S*v[2],m[3]=Math.cos(x)}(u,fs,Math.PI),u):h>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(ur(fs,i,l),u[0]=fs[0],u[1]=fs[1],u[2]=fs[2],u[3]=1+h,fl(u,u))});function js(){var u=new b(2);return b!=Float32Array&&(u[0]=0,u[1]=0),u}function ga(u,i){var l=new b(2);return l[0]=u,l[1]=i,l}function pl(u,i,l){return u[0]=i,u[1]=l,u}function ml(u,i,l){return u[0]=i[0]+l[0],u[1]=i[1]+l[1],u}function Wl(u,i,l){return u[0]=i[0]-l[0],u[1]=i[1]-l[1],u}function pc(u,i,l){return u[0]=i[0]*l,u[1]=i[1]*l,u}function Wc(u){var i=u[0],l=u[1];return Math.sqrt(i*i+l*l)}function Hc(u,i){var l=i[0],h=i[1],m=l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),u[0]=i[0]*m,u[1]=i[1]*m,u}function Gn(u,i){return u[0]*i[0]+u[1]*i[1]}Or(),Or(),C();var Ws,jn,mi=Wl;function ii(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}js();var bo=function(){if(jn)return Ws;function u(i,l,h,m){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=m}return jn=1,Ws=u,u.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,m=0;m<8;m++){var v=this.sampleCurveX(h)-i;if(Math.abs(v)<l)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=v/x}var S=0,A=1;for(h=i,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-i)<l));m++)i>v?S=h:A=h,h=.5*(A-S)+S;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},Ws}(),Ea=ii(bo);function kt(u,i){this.x=u,this.y=i}function Ba(u,i){if(Array.isArray(u)){if(!Array.isArray(i)||u.length!==i.length)return!1;for(let l=0;l<u.length;l++)if(!Ba(u[l],i[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&i!==null){if(typeof i!="object"||Object.keys(u).length!==Object.keys(i).length)return!1;for(const l in u)if(!Ba(u[l],i[l]))return!1;return!0}return u===i}kt.prototype={clone(){return new kt(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,i){return this.clone()._rotateAround(u,i)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const i=u.x-this.x,l=u.y-this.y;return i*i+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,i){return Math.atan2(this.x*i-this.y*u,this.x*u+this.y*i)},_matMult(u){const i=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=i,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const i=Math.cos(u),l=Math.sin(u),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround(u,i){const l=Math.cos(u),h=Math.sin(u),m=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:kt},kt.convert=function(u){if(u instanceof kt)return u;if(Array.isArray(u))return new kt(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new kt(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const wo=Math.PI/180,qo=180/Math.PI;function _n(u){return u*wo}function Ke(u){return u*qo}const ce=[[0,0],[1,0],[1,1],[0,1]];function me(u){if(u<=0)return 0;if(u>=1)return 1;const i=u*u,l=i*u;return 4*(u<.5?l:3*(u-i)+l-.75)}function je(u,i,l,h){const m=new Ea(u,i,l,h);return function(v){return m.solve(v)}}const Ge=je(.25,.1,.25,1);function Pe(u,i,l){return Math.min(l,Math.max(i,u))}function He(u,i,l){return(l=Pe((l-u)/(i-u),0,1))*l*(3-2*l)}function nt(u,i,l){const h=l-i,m=((u-i)%h+h)%h+i;return m===i?l:m}function Xe(u,i,l){if(!u.length)return l(null,[]);let h=u.length;const m=new Array(u.length);let v=null;u.forEach((x,S)=>{i(x,(A,N)=>{A&&(v=A),m[S]=N,--h===0&&l(v,m)})})}let ct=1;function Rt(){return ct++}function Nt(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function tr(u,i){u.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function _r(u,i,l){const h={};for(const m in u)h[m]=i.call(this,u[m],m,u);return h}function Er(u,i,l){const h={};for(const m in u)i.call(this,u[m],m,u)&&(h[m]=u[m]);return h}function $r(u){return Array.isArray(u)?u.map($r):typeof u=="object"&&u?_r(u,$r):u}function Qr(u,i){for(let l=0;l<u.length;l++)if(i.indexOf(u[l])>=0)return!0;return!1}const Rr={};function Nr(u){Rr[u]||(typeof console<"u"&&console.warn(u),Rr[u]=!0)}function li(u,i,l){return(l.y-u.y)*(i.x-u.x)>(i.y-u.y)*(l.x-u.x)}function vs(u){let i=0;for(let l,h,m=0,v=u.length,x=v-1;m<v;x=m++)l=u[m],h=u[x],i+=(h.x-l.x)*(l.y+h.y);return i}function Wi([u,i,l]){const h=_n(i+90),m=_n(l);return{x:u*Math.cos(h)*Math.sin(m),y:u*Math.sin(h)*Math.sin(m),z:u*Math.cos(m),azimuthal:i,polar:l}}function Hi(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function xi(u){const i={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,m,v)=>{const x=m||v;return i[h]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let gn=null;function Ei(u,i){return[u[4*i],u[4*i+1],u[4*i+2],u[4*i+3]]}function Qn(u,i,l,h){for(;i<l;){const m=i+l>>1;u[m]<h?i=m+1:l=m}return i}function ei(u,i,l,h){for(;i<l;){const m=i+l>>1;u[m]<=h?i=m+1:l=m}return i}function Ui(u){return u>0?1/(1.001-u):1+u}function ya(u){return u>0?1-1/(1.001-u):-u}function ia(u,i,l){return(u-i.min)*(l.max-l.min)/(i.max-i.min)+l.min}const As={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!As.API_URL)return null;try{const u=new URL(As.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Pd(u){return As.API_URL_REGEX.test(u)}function $a(u){return As.API_SPRITE_REGEX.test(u)}let Go,Hl,mc,Wo,io,ku;function Lh(){return Go==null&&(Go=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Go}const gl={now:()=>Wo!==void 0?Wo:performance.now(),setNow(u){Wo=u},restoreNow(){Wo=void 0},frame(u){const i=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(u,i=0){const{width:l,height:h}=u;io||(io=document.createElement("canvas"));const m=io.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>io.width||h>io.height)&&(io.width=l,io.height=h),m.clearRect(-i,-i,l+2*i,h+2*i),m.drawImage(u,0,0,l,h),m.getImageData(-i,-i,l+2*i,h+2*i)},resolveURL:u=>(Hl||(Hl=document.createElement("a")),Hl.href=u,Hl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(mc==null&&(mc=window.matchMedia("(prefers-reduced-motion: reduce)")),mc.matches)},hasCanvasFingerprintNoise(){if(ku!==void 0)return ku;if(!Lh())return ku=!1,!1;const u=new OffscreenCanvas(85,1),i=u.getContext("2d",{willReadFrequently:!0});let l=0;for(let m=0;m<u.width;++m)i.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,i.fillRect(m,0,1,1);const h=i.getImageData(0,0,u.width,u.height);l=0;for(let m=0;m<h.data.length;++m)if(m%4!=3&&l++!==h.data[m])return ku=!0,!0;return ku=!1,!1}};function sg(u,i){const l=u.indexOf("?");if(l<0)return`${u}?${new URLSearchParams(i).toString()}`;const h=new URLSearchParams(u.slice(l));for(const m in i)h.set(m,i[m]);return`${u.slice(0,l)}?${h.toString()}`}function ag(u,i={persistentParams:[]}){const l=u.indexOf("?");if(l<0)return u;const h=new URLSearchParams,m=new URLSearchParams(u.slice(l));for(const x of i.persistentParams){const S=m.get(x);S&&h.set(x,S)}const v=h.toString();return`${u.slice(0,l)}${v.length>0?`?${v}`:""}`}const vE="mapbox-tiles";let _E=500,Db=50;const Lb=["language","worldview","jobid"];let sa,yl;function Ou(){try{return caches}catch{}}function vl(){const u=Ou();u&&sa==null&&(sa=u.open(vE))}let Zc=1/0;const Kf={supported:!1,testSupport:function(u){!Nd&&Fh&&(Iv?bE(u):Yf=u)}};let Yf,Fh,Nd=!1,Iv=!1;const xE=typeof self<"u"?self:{};function bE(u){const i=u.createTexture();u.bindTexture(u.TEXTURE_2D,i);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Fh),u.isContextLost())return;Kf.supported=!0}catch{}u.deleteTexture(i),Nd=!0}xE.document&&(Fh=xE.document.createElement("img"),Fh.onload=function(){Yf&&bE(Yf),Yf=null,Iv=!0},Fh.onerror=function(){Nd=!0,Yf=null},Fh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const So={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(So);class og extends Error{constructor(i,l,h){l===401&&Pd(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const lg=Hi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ru=function(u,i){if(!(/^file:/.test(l=u.url)||/^file:/.test(lg())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,m){const v=new AbortController,x=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:lg(),referrerPolicy:h.referrerPolicy,signal:v.signal});let S=!1,A=!1;const N=(M=x.url).indexOf("sku=")>0&&Pd(M);var M;h.type==="json"&&x.headers.set("Accept","application/json");const L=(W,H,Q)=>{if(A)return;if(W&&W.message!=="SecurityError"&&Nr(W.toString()),H&&Q)return z(H);const ne=Date.now();fetch(x).then(te=>{if(te.ok){const le=N?te.clone():null;return z(te,le,ne)}return m(new og(te.statusText,te.status,h.url))}).catch(te=>{te.name!=="AbortError"&&m(new Error(`${te.message} ${h.url}`))})},z=(W,H,Q)=>{(h.type==="arrayBuffer"?W.arrayBuffer():h.type==="json"?W.json():W.text()).then(ne=>{A||(H&&Q&&function(te,le,de){if(vl(),sa==null)return;const pe=xi(le.headers.get("Cache-Control")||"");if(pe["no-store"])return;const Se={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Oe,Ne)=>Se.headers.set(Ne,Oe)),pe["max-age"]&&Se.headers.set("Expires",new Date(de+1e3*pe["max-age"]).toUTCString());const we=Se.headers.get("Expires");if(!we||new Date(we).getTime()-de<42e4)return;let Ie=ag(te.url,{persistentParams:Lb});if(le.status===206){const Oe=te.headers.get("Range");if(!Oe)return;Se.status=200,Ie=sg(Ie,{range:Oe})}(function(Oe,Ne){if(yl===void 0)try{new Response(new ReadableStream),yl=!0}catch{yl=!1}yl?Ne(Oe.body):Oe.blob().then(Ne).catch(Fe=>Nr(Fe.message))})(le,Oe=>{const Ne=new Response((Fe=le.status)!==200&&Fe!==404&&[101,103,204,205,304].includes(Fe)?null:Oe,Se);var Fe;vl(),sa!=null&&sa.then(qe=>qe.put(Ie,Ne)).catch(qe=>Nr(qe.message))})}(x,H,Q),S=!0,m(null,ne,W.headers))}).catch(ne=>{A||m(new Error(ne.message))})};return N?function(W,H){if(vl(),sa==null)return H(null);sa.then(Q=>{let ne=ag(W.url,{persistentParams:Lb});const te=W.headers.get("Range");te&&(ne=sg(ne,{range:te})),Q.match(ne).then(le=>{const de=function(pe){if(!pe)return!1;const Se=new Date(pe.headers.get("Expires")||0),we=xi(pe.headers.get("Cache-Control")||"");return Number(Se)>Date.now()&&!we["no-cache"]}(le);Q.delete(ne).catch(H),de&&Q.put(ne,le.clone()).catch(H),H(null,le,de)}).catch(H)}).catch(H)}(x,L):L(null,null),{cancel:()=>{A=!0,S||v.abort()}}}(u,i);if(Hi(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,i,void 0,!0)}var l;return function(h,m){const v=new XMLHttpRequest;v.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const x in h.headers)v.setRequestHeader(x,h.headers[x]);return h.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=h.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let x=v.response;if(h.type==="json")try{x=JSON.parse(v.response)}catch(A){return m(A)}const S=new Headers;v.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(A=>{const N=A.split(": "),M=N.shift(),L=N.join(": ");S.append(M,L)}),m(null,x,S)}else m(new og(v.statusText,v.status,h.url))},v.send(h.body),{cancel:()=>v.abort()}}(u,i)},cg=function(u,i){return Ru(Object.assign(u,{type:"arrayBuffer"}),i)};function dO(u){const i=document.createElement("a");return i.href=u,i.protocol===location.protocol&&i.host===location.host}const Fb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bn,Jf;bn=[],Jf=0;const kv=function(u,i){if(Kf.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Jf>=As.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:u,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return bn.push(v),v}Jf++;let l=!1;const h=()=>{if(!l)for(l=!0,Jf--;bn.length&&Jf<As.MAX_PARALLEL_IMAGE_REQUESTS;){const v=bn.shift(),{requestParameters:x,callback:S,cancelled:A}=v;A||(v.cancel=kv(x,S).cancel)}},m=cg(u,(v,x,S)=>{h(),v?i(v):x&&(self.createImageBitmap?function(A,N){const M=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(M).then(L=>{N(null,L)}).catch(L=>{N(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(A,N)=>i(A,N,S)):function(A,N){const M=new Image;M.onload=()=>{N(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Fb})},M.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(A)],{type:"image/png"});M.src=A.byteLength?URL.createObjectURL(L):Fb}(x,(A,N)=>i(A,N,S)))});return{cancel:()=>{m.cancel(),h()}}};var wE,SE,ug,Id={exports:{}},dg={exports:{}},Ov={exports:{}},hO=function(){if(ug)return Id.exports;ug=1;var u=(wE||(wE=1,dg.exports=function(l,h){var m,v,x,S,A,N,M,L;for(v=l.length-(m=3&l.length),x=h,A=3432918353,N=461845907,L=0;L<v;)M=255&l.charCodeAt(L)|(255&l.charCodeAt(++L))<<8|(255&l.charCodeAt(++L))<<16|(255&l.charCodeAt(++L))<<24,++L,x=27492+(65535&(S=5*(65535&(x=(x^=M=(65535&(M=(M=(65535&M)*A+(((M>>>16)*A&65535)<<16)&4294967295)<<15|M>>>17))*N+(((M>>>16)*N&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+(((S>>>16)+58964&65535)<<16);switch(M=0,m){case 3:M^=(255&l.charCodeAt(L+2))<<16;case 2:M^=(255&l.charCodeAt(L+1))<<8;case 1:x^=M=(65535&(M=(M=(65535&(M^=255&l.charCodeAt(L)))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<15|M>>>17))*N+(((M>>>16)*N&65535)<<16)&4294967295}return x^=l.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),dg.exports),i=(SE||(SE=1,Ov.exports=function(l,h){for(var m,v=l.length,x=h^v,S=0;v>=4;)m=1540483477*(65535&(m=255&l.charCodeAt(S)|(255&l.charCodeAt(++S))<<8|(255&l.charCodeAt(++S))<<16|(255&l.charCodeAt(++S))<<24))+((1540483477*(m>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),v-=4,++S;switch(v){case 3:x^=(255&l.charCodeAt(S+2))<<16;case 2:x^=(255&l.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&l.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Ov.exports);return Id.exports=u,Id.exports.murmur3=u,Id.exports.murmur2=i,Id.exports}(),Qf=ii(hO);class Mu{constructor(i,...l){Object.assign(this,l[0]||{}),this.type=i}}class hg extends Mu{constructor(i,l={}){super("error",Object.assign({error:i},l))}}function TE(u,i,l){l[u]&&l[u].indexOf(i)!==-1||(l[u]=l[u]||[],l[u].push(i))}function zh(u,i,l){if(l&&l[u]){const h=l[u].indexOf(i);h!==-1&&l[u].splice(h,1)}}class Du{on(i,l){return this._listeners=this._listeners||{},TE(i,l,this._listeners),this}off(i,l){return zh(i,l,this._listeners),zh(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},TE(i,l,this._oneTimeListeners),this):new Promise(h=>{this.once(i,h)})}fire(i,l){const h=typeof i=="string"?new Mu(i,l):i,m=h.type;if(this.listens(m)){h.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const A of v)A.call(this,h);const x=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const A of x)zh(m,A,this._oneTimeListeners),A.call(this,h);const S=this._eventedParent;if(S){const A=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,A),S.fire(h)}}else h instanceof hg&&console.error(h.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}class To{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new To(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[l,h]=i.split("");return new To({name:l,iconsetId:h})}static isEqual(i,l){return i.name===l.name&&i.iconsetId===l.iconsetId}toString(){return To.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Zl,Rv={},EE=function(){if(Zl)return Rv;Zl=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(v){return(v=Math.round(v))<0?0:v>255?255:v}function l(v){return i(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function h(v){return(x=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:x>1?1:x;var x}function m(v,x,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?v+(x-v)*S*6:2*S<1?x:3*S<2?v+(x-v)*(2/3-S)*6:v}try{Rv.parseCSSColor=function(v){var x,S=v.replace(/ /g,"").toLowerCase();if(S in u)return u[S].slice();if(S[0]==="#")return S.length===4?(x=parseInt(S.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:S.length===7&&(x=parseInt(S.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var A=S.indexOf("("),N=S.indexOf(")");if(A!==-1&&N+1===S.length){var M=S.substr(0,A),L=S.substr(A+1,N-(A+1)).split(","),z=1;switch(M){case"rgba":if(L.length!==4)return null;z=h(L.pop());case"rgb":return L.length!==3?null:[l(L[0]),l(L[1]),l(L[2]),z];case"hsla":if(L.length!==4)return null;z=h(L.pop());case"hsl":if(L.length!==3)return null;var W=(parseFloat(L[0])%360+360)%360/360,H=h(L[1]),Q=h(L[2]),ne=Q<=.5?Q*(H+1):Q+H-Q*H,te=2*Q-ne;return[i(255*m(te,ne,W+1/3)),i(255*m(te,ne,W)),i(255*m(te,ne,W-1/3)),z];default:return null}}return null}}catch{}return Rv}();class Dn{constructor(i,l,h,m=1){this.r=i,this.g=l,this.b=h,this.a=m}static parse(i){if(!i)return;if(i instanceof Dn)return i;if(typeof i!="string")return;const l=EE.parseCSSColor(i);return l?new Dn(l[0]/255,l[1]/255,l[2]/255,l[3]):void 0}toString(){const[i,l,h,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*l)},${Math.round(255*h)},${m})`}toNonPremultipliedRenderColor(i){const{r:l,g:h,b:m,a:v}=this;return new jE(i,l,h,m,v)}toPremultipliedRenderColor(i){const{r:l,g:h,b:m,a:v}=this;return new AE(i,l*v,h*v,m*v,v)}clone(){return new Dn(this.r,this.g,this.b,this.a)}}class zb{constructor(i,l,h,m,v,x=!1){if(this.premultiplied=!1,this.premultiplied=x,i){const S=i.image.height,A=S*S;this.premultiplied?(l=v===0?0:l/v*(S-1),h=v===0?0:h/v*(S-1),m=v===0?0:m/v*(S-1)):(l*=S-1,h*=S-1,m*=S-1);const N=Math.floor(l),M=Math.floor(h),L=Math.floor(m),z=Math.ceil(l),W=Math.ceil(h),H=Math.ceil(m),Q=l-N,ne=h-M,te=m-L,le=i.image.data,de=4*(N+M*A+L*S),pe=4*(N+M*A+H*S),Se=4*(N+W*A+L*S),we=4*(N+W*A+H*S),Ie=4*(z+M*A+L*S),Oe=4*(z+M*A+H*S),Ne=4*(z+W*A+L*S),Fe=4*(z+W*A+H*S);if(de<0||Fe>=le.length)throw new Error("out of range");this.r=jr(jr(jr(le[de],le[pe],te),jr(le[Se],le[we],te),ne),jr(jr(le[Ie],le[Oe],te),jr(le[Ne],le[Fe],te),ne),Q)/255*(this.premultiplied?v:1),this.g=jr(jr(jr(le[de+1],le[pe+1],te),jr(le[Se+1],le[we+1],te),ne),jr(jr(le[Ie+1],le[Oe+1],te),jr(le[Ne+1],le[Fe+1],te),ne),Q)/255*(this.premultiplied?v:1),this.b=jr(jr(jr(le[de+2],le[pe+2],te),jr(le[Se+2],le[we+2],te),ne),jr(jr(le[Ie+2],le[Oe+2],te),jr(le[Ne+2],le[Fe+2],te),ne),Q)/255*(this.premultiplied?v:1),this.a=v}else this.r=l,this.g=h,this.b=m,this.a=v}toArray(){const{r:i,g:l,b:h,a:m}=this;return[255*i,255*l,255*h,m]}toHslaArray(){let{r:i,g:l,b:h,a:m}=this;if(this.premultiplied){if(m===0)return[0,0,0,0];const H=1/m;i*=H,l*=H,h*=H}const v=Math.min(Math.max(i,0),1),x=Math.min(Math.max(l,0),1),S=Math.min(Math.max(h,0),1),A=Math.min(v,x,S),N=Math.max(v,x,S),M=N-A,L=.5*(A+N);if(M===0)return[0,0,100*L,m];const z=L>.5?M/(2-N-A):M/(N+A);let W;switch(N){case v:W=60*((x-S)/M+(x<S?6:0));break;case x:W=60*((S-v)/M+2);break;default:W=60*((v-x)/M+4)}return[W,100*z,100*L,m]}toArray01(){const{r:i,g:l,b:h,a:m}=this;return[i,l,h,m]}toArray01Scaled(i){const{r:l,g:h,b:m}=this;return[l*i,h*i,m*i]}toArray01Linear(){const{r:i,g:l,b:h,a:m}=this;return[Math.pow(i,2.2),Math.pow(l,2.2),Math.pow(h,2.2),m]}}class jE extends zb{constructor(i,l,h,m,v){super(i,l,h,m,v,!1)}}class AE extends zb{constructor(i,l,h,m,v){super(i,l,h,m,v,!0)}}function jr(u,i,l){return u*(1-l)+i*l}function Bb(u,i,l){return u.map((h,m)=>jr(h,i[m],l))}Dn.black=new Dn(0,0,0,1),Dn.white=new Dn(1,1,1,1),Dn.transparent=new Dn(0,0,0,0),Dn.red=new Dn(1,0,0,1),Dn.blue=new Dn(0,0,1,1);var Bh=Object.freeze({__proto__:null,array:Bb,color:function(u,i,l){return new Dn(jr(u.r,i.r,l),jr(u.g,i.g,l),jr(u.b,i.b,l),jr(u.a,i.a,l))},number:jr});class so extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Mv{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,m]of l)this.bindings[h]=m}concat(i){return new Mv(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Eo={kind:"null"},mr={kind:"number"},Rn={kind:"string"},Tn={kind:"boolean"},ao={kind:"color"},ep={kind:"object"},Bn={kind:"value"},Dv={kind:"collator"},tp={kind:"formatted"},$h={kind:"resolvedImage"};function Va(u,i){return{kind:"array",itemType:u,N:i}}function as(u){if(u.kind==="array"){const i=as(u.itemType);return typeof u.N=="number"?`array<${i}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${i}>`}return u.kind}const fO=[Eo,mr,Rn,Tn,ao,tp,ep,Va(Bn),$h];function fg(u,i){if(i.kind==="error")return null;if(u.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!fg(u.itemType,i.itemType))&&(typeof u.N!="number"||u.N===i.N))return null}else{if(u.kind===i.kind)return null;if(u.kind==="value"){for(const l of fO)if(!fg(l,i))return null}}return`Expected ${as(u)} but found ${as(i)} instead.`}function $b(u,i){return i.some(l=>l.kind===u.kind)}function pg(u,i){return i.some(l=>l==="null"?u===null:l==="array"?Array.isArray(u):l==="object"?u&&!Array.isArray(u)&&typeof u=="object":l===typeof u)}function Lv(u,i){return u.kind==="array"&&i.kind==="array"?u.N===i.N&&Lv(u.itemType,i.itemType):u.kind===i.kind}class Vb{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fv{constructor(i,l,h,m,v){this.text=i.normalize?i.normalize():i,this.image=l,this.scale=h,this.fontStack=m,this.textColor=v}}class Ua{constructor(i){this.sections=i}static fromString(i){return new Ua([new Fv(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof Ua?i:Ua.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){const m=l.image.getPrimary().id.toString();i.push(["image",m]);continue}i.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(h)}return i}}class jo{constructor(i,l={}){this.id=To.from(i),this.params=l.params,this.sx=l.sx||1,this.sy=l.sy||1}toString(){return JSON.stringify(this)}static parse(i){let l,h,m,v;try{({id:l,params:h,sx:m,sy:v}=JSON.parse(i)||{})}catch{return null}return l?new jo(l,{params:h,sx:m,sy:v}):null}scaleSelf(i,l=i){return this.sx*=i,this.sy*=l,this}}class Ao{constructor(i,l,h,m,v=!1){this.primaryId=To.from(i),this.primaryOptions=l,h&&(this.secondaryId=To.from(h)),this.secondaryOptions=m,this.available=v}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new jo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new jo(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?Ao.build({name:i}):i}static build(i,l,h,m){return!i||typeof i=="object"&&!("name"in i)?null:new Ao(i,h,l,m)}}function Ub(u,i,l,h){return typeof u=="number"&&u>=0&&u<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[u,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[u,i,l,h]:[u,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kd(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Dn||u instanceof Vb||u instanceof Ua||u instanceof Ao)return!0;if(Array.isArray(u)){for(const i of u)if(!kd(i))return!1;return!0}if(typeof u=="object"){for(const i in u)if(!kd(u[i]))return!1;return!0}return!1}function Vs(u){if(u===null)return Eo;if(typeof u=="string")return Rn;if(typeof u=="boolean")return Tn;if(typeof u=="number")return mr;if(u instanceof Dn)return ao;if(u instanceof Vb)return Dv;if(u instanceof Ua)return tp;if(u instanceof Ao)return $h;if(Array.isArray(u)){const i=u.length;let l;for(const h of u){const m=Vs(h);if(l){if(l===m)continue;l=Bn;break}l=m}return Va(l||Bn,i)}return ep}function Xc(u){const i=typeof u;return u===null?"":i==="string"||i==="number"||i==="boolean"?String(u):u instanceof Ua||u instanceof Ao||u instanceof Dn?u.toString():JSON.stringify(u)}class Lu{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!kd(i[1]))return l.error("invalid value");const h=i[1];let m=Vs(h);const v=l.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new Lu(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Dn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ua?this.value.serialize():this.value}}class Cs{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Od={string:Rn,number:mr,boolean:Tn,object:ep};class Lr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,m=1;const v=i[0];if(v==="array"){let S,A;if(i.length>2){const N=i[1];if(typeof N!="string"||!(N in Od)||N==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=Od[N],m++}else S=Bn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);A=i[2],m++}h=Va(S,A)}else h=Od[v];const x=[];for(;m<i.length;m++){const S=l.parse(i[m],m,Bn);if(!S)return null;x.push(S)}return new Lr(h,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!fg(this.type,Vs(h)))return h;if(l===this.args.length-1)throw new Cs(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${as(Vs(h))} but was expected to be of type ${as(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const m=i.N;(typeof m=="number"||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(h=>h.serialize()))}}class dr{constructor(i){this.type=tp,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=i.length-1;++x){const S=i[x];if(v&&typeof S=="object"&&!Array.isArray(S)){v=!1;let A=null;if(S["font-scale"]&&(A=l.parseObjectValue(S["font-scale"],x,"font-scale",mr),!A))return null;let N=null;if(S["text-font"]&&(N=l.parseObjectValue(S["text-font"],x,"text-font",Va(Rn)),!N))return null;let M=null;if(S["text-color"]&&(M=l.parseObjectValue(S["text-color"],x,"text-color",ao),!M))return null;const L=m[m.length-1];L.scale=A,L.font=N,L.textColor=M}else{const A=l.parse(i[x],x,Bn);if(!A)return null;const N=A.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:A,scale:null,font:null,textColor:null})}}return new dr(m)}evaluate(i){return new Ua(this.sections.map(l=>{const h=l.content.evaluate(i);return Lv(Vs(h),$h)?new Fv("",h,null,null,null):new Fv(Xc(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),i.push(h)}return i}}class rp{constructor(i,l,h,m){this._imageWarnHistory={},this.type=$h,this.namePrimary=i,this.nameSecondary=l,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(i,l){if(i.length<2)return l.error("Expected two or more arguments.");let h=1;const m=[];function v(){if(h<i.length){const S=l.parse(i[h],h++,Rn);return S?(m.push({image:S,options:{}}),!0):(l.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(h<i.length){const A=i[h];if((S=A)===null||typeof S!="object"||Array.isArray(S))return!0;const N=A.params,M=A.iconset,L=l.concat(h);if(!N&&!M)return h++,!0;if(N){if(typeof N!="object"||N.constructor!==Object)return L.error('Image options "params" should be an object'),!1;const z={},W=L.concat(void 0,"params");for(const H in N){if(!H)return W.error("Image parameter name should be non-empty"),!1;const Q=W.concat(void 0,H).parse(N[H],void 0,ao,void 0,{typeAnnotation:"coerce"});if(!Q)return!1;z[H]=Q}m[m.length-1].options.params=z}if(M){if(typeof M!="object"||M.constructor!==Object)return L.error('Image options "iconset" should be an object'),!1;if(!M.id)return L.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=M}return h++,!0}var S;return!0}for(let S=0;S<2;S++)if(!v()||!x())return;return new rp(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(i,l){const h={};if(l){for(const m in l)if(l[m])try{h[m]=l[m].evaluate(i)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(i){const l={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,m=Ao.build(l,h,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(m&&i.availableImages){const v=m.getPrimary().id;if(m.available=i.availableImages.some(x=>To.isEqual(x,v)),m.available){const x=m.getSecondary()?m.getSecondary().id:null;x&&(m.available=i.availableImages.some(S=>To.isEqual(S,x)))}}return m}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&i(this.paramsPrimary[l]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&i(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(i,l){const h={};if(l&&(h.iconset={id:l}),i){h.params={};for(const m in i)i[m]&&(h.params[m]=i[m].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&i.push(l)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&i.push(l)}return i}}function Ir(u){return mg(u)?"string":Ar(u)?"number":qb(u)?"boolean":Array.isArray(u)?"array":u===null?"null":zv(u)?"object":typeof u}function zv(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function mg(u){return typeof u=="string"||u instanceof String}function Ar(u){return typeof u=="number"||u instanceof Number}function qb(u){return typeof u=="boolean"||u instanceof Boolean}const Gb={"to-boolean":Tn,"to-color":ao,"to-number":mr,"to-string":Rn};class Kc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0],m=[];let v=Eo;if(h==="to-array"){if(!Array.isArray(i[1]))return null;const x=i[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);v=Va(l.expectedType.itemType,x)}else{if(!(x>0&&kd(i[1][0])))return null;v=Va(Vs(i[1][0]),x)}for(let S=0;S<x;S++){const A=i[1][S];let N;if(Array.isArray(A))N=l.parse(A,void 0,v.itemType);else{const M=Ir(A);if(M!==v.itemType.kind)return l.error(`Expected ${v.itemType.kind} but found ${M}.`);N=l.registry.literal.parse(["literal",A===void 0?null:A],l)}if(!N)return null;m.push(N)}}else{if((h==="to-boolean"||h==="to-string")&&i.length!==2)return l.error("Expected one argument.");v=Gb[h];for(let x=1;x<i.length;x++){const S=l.parse(i[x],x,Bn);if(!S)return null;m.push(S)}}return new Kc(v,m)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let l,h;for(const m of this.args){if(l=m.evaluate(i),h=null,l instanceof Dn)return l;if(typeof l=="string"){const v=i.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ub(l[0],l[1],l[2],l[3]),!h))return new Dn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Cs(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(i),l===null)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Cs(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?Ua.fromString(Xc(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Ao.build(Xc(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(l=>l.evaluate(i)):Xc(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rp(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const CE=["Unknown","Point","LineString","Polygon"];class np{constructor(i,l,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=l,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?CE[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:h,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*l-i[0])+this.featureDistanceData.bearing[1]*(m*l-i[1])}return 0}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Dn.parse(i)),l}getConfig(i){return this.options?this.options.get(i):null}}class Co{constructor(i,l,h,m,v){this.name=i,this.type=l,this._evaluate=h,this.args=m,this._overloadIndex=v}evaluate(i){if(!this._evaluate){const l=Co.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const h=i[0],m=Co.definitions[h];if(!m)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,S=[];let A=null,N=-1;for(const[M,L]of x){if(Array.isArray(M)&&M.length!==i.length-1)continue;S.push(M),N++,A=new Xv(l.registry,l.path,null,l.scope,void 0,l._scope,l.options,l.iconImageUseTheme);const z=[];let W=!1;for(let H=1;H<i.length;H++){const Q=i[H],ne=Array.isArray(M)?M[H-1]:M.type,te=A.parse(Q,1+z.length,ne);if(!te){W=!0;break}z.push(te)}if(!W)if(Array.isArray(M)&&M.length!==z.length)A.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const Q=Array.isArray(M)?M[H]:M.type,ne=z[H];A.concat(H+1).checkSubtype(Q,ne.type)}if(A.errors.length===0)return new Co(h,v,L,z,N)}}if(S.length===1)l.errors.push(...A.errors);else{const M=(S.length?S:x.map(([z])=>z)).map(Wb).join(" | "),L=[];for(let z=1;z<i.length;z++){const W=l.parse(i[z],1+L.length);if(!W)return null;L.push(as(W.type))}l.error(`Expected arguments of type ${M}, but found (${L.join(", ")}) instead.`)}return null}static register(i,l){Co.definitions=l;for(const h in l)i[h]=Co}}function Wb(u){return Array.isArray(u)?`(${u.map(as).join(", ")})`:`(${as(u.type)}...)`}class Yc{constructor(i,l,h){this.type=Dv,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const m=h["case-sensitive"]===void 0?l.parse(!1,1,Tn):l.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Tn);if(!m)return null;const v=h["diacritic-sensitive"]===void 0?l.parse(!1,1,Tn):l.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Tn);if(!v)return null;let x=null;return h.locale&&(x=l.parseObjectValue(h.locale,1,"locale",Rn),!x)?null:new Yc(m,v,x)}evaluate(i){return new Vb(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Bv(u,i,l=0,h=u.length-1,m=Rd){for(;h>l;){if(h-l>600){const A=h-l+1,N=i-l+1,M=Math.log(A),L=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*L*(A-L)/A)*(N-A/2<0?-1:1);Bv(u,i,Math.max(l,Math.floor(i-N*L/A+z)),Math.min(h,Math.floor(i+(A-N)*L/A+z)),m)}const v=u[i];let x=l,S=h;for(Xl(u,l,i),m(u[h],v)>0&&Xl(u,l,h);x<S;){for(Xl(u,x,S),x++,S--;m(u[x],v)<0;)x++;for(;m(u[S],v)>0;)S--}m(u[l],v)===0?Xl(u,l,S):(S++,Xl(u,S,h)),S<=i&&(l=S+1),i<=S&&(h=S-1)}}function Xl(u,i,l){const h=u[i];u[i]=u[l],u[l]=h}function Rd(u,i){return u<i?-1:u>i?1:0}function pO(u){let i=0;for(let l,h,m=0,v=u.length,x=v-1;m<v;x=m++)l=u[m],h=u[x],i+=(h.x-l.x)*(l.y+h.y);return i}function gg(u,i){u[0]=Math.min(u[0],i[0]),u[1]=Math.min(u[1],i[1]),u[2]=Math.max(u[2],i[0]),u[3]=Math.max(u[3],i[1])}function yg(u,i){return!(u[0]<=i[0]||u[2]>=i[2]||u[1]<=i[1]||u[3]>=i[3])}function $v(u,i,l){const h=u[0]-i[0],m=u[1]-i[1],v=u[0]-l[0],x=u[1]-l[1];return h*x-v*m===0&&h*v<=0&&m*x<=0}function PE(u,i,l){return i[1]>u[1]!=l[1]>u[1]&&u[0]<(l[0]-i[0])*(u[1]-i[1])/(l[1]-i[1])+i[0]}function Kl(u,i,l=!1){let h=!1;for(let m=0,v=i.length;m<v;m++){const x=i[m];for(let S=0,A=x.length,N=A-1;S<A;N=S++){const M=x[N],L=x[S];if($v(u,M,L))return l;PE(u,M,L)&&(h=!h)}}return h}function NE(u,i,l,h){const m=h[0]-l[0],v=h[1]-l[1],x=(u[0]-l[0])*v-m*(u[1]-l[1]),S=(i[0]-l[0])*v-m*(i[1]-l[1]);return x>0&&S<0||x<0&&S>0}function Vv(u,i,l,h){return(m=[h[0]-l[0],h[1]-l[1]])[0]*(v=[i[0]-u[0],i[1]-u[1]])[1]-m[1]*v[0]!==0&&!(!NE(u,i,l,h)||!NE(l,h,u,i));var m,v}function vg(u){const i=new kt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new kt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of u[0])i.x>h.x&&(i.x=h.x),i.y>h.y&&(i.y=h.y),l.x<h.x&&(l.x=h.x),l.y<h.y&&(l.y=h.y);return{min:i,max:l}}const Md=8192;function mO(u,i){const l=(180+u[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(l*m*Md),Math.round(h*m*Md)]}function IE(u,i){for(let l=0;l<i.length;l++)if(Kl(u,i[l]))return!0;return!1}function gO(u,i,l){for(const h of l)for(let m=0,v=h.length,x=v-1;m<v;x=m++)if(Vv(u,i,h[x],h[m]))return!0;return!1}function Hb(u,i){for(let l=0;l<u.length;++l)if(!Kl(u[l],i))return!1;for(let l=0;l<u.length-1;++l)if(gO(u[l],u[l+1],i))return!1;return!0}function yO(u,i){for(let l=0;l<i.length;l++)if(Hb(u,i[l]))return!0;return!1}function Fu(u,i,l){const h=[];for(let m=0;m<u.length;m++){const v=[];for(let x=0;x<u[m].length;x++){const S=mO(u[m][x],l);gg(i,S),v.push(S)}h.push(v)}return h}function kE(u,i,l){const h=[];for(let m=0;m<u.length;m++){const v=Fu(u[m],i,l);h.push(v)}return h}function OE(u,i,l,h){if(u[0]<l[0]||u[0]>l[2]){const m=.5*h;let v=u[0]-l[0]>m?-h:l[0]-u[0]>m?h:0;v===0&&(v=u[0]-l[2]>m?-h:l[2]-u[0]>m?h:0),u[0]+=v}gg(i,u)}function Uv(u,i,l,h){const m=Math.pow(2,h.z)*Md,v=[h.x*Md,h.y*Md],x=[];if(!u)return x;for(const S of u)for(const A of S){const N=[A.x+v[0],A.y+v[1]];OE(N,i,l,m),x.push(N)}return x}function Zb(u,i,l,h){const m=Math.pow(2,h.z)*Md,v=[h.x*Md,h.y*Md],x=[];if(!u)return x;for(const A of u){const N=[];for(const M of A){const L=[M.x+v[0],M.y+v[1]];gg(i,L),N.push(L)}x.push(N)}if(i[2]-i[0]<=m/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const A of x)for(const N of A)OE(N,i,l,m)}var S;return x}class Dd{constructor(i,l){this.type=Tn,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(kd(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let m=0;m<h.features.length;++m){const v=h.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Dd(h,h.features[m].geometry)}else if(h.type==="Feature"){const m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Dd(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Dd(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,h){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const S=Fu(h.coordinates,v,x),A=Uv(l.geometry(),m,v,x);if(!yg(m,v))return!1;for(const N of A)if(!Kl(N,S))return!1}if(h.type==="MultiPolygon"){const S=kE(h.coordinates,v,x),A=Uv(l.geometry(),m,v,x);if(!yg(m,v))return!1;for(const N of A)if(!IE(N,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,h){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const S=Fu(h.coordinates,v,x),A=Zb(l.geometry(),m,v,x);if(!yg(m,v))return!1;for(const N of A)if(!Hb(N,S))return!1}if(h.type==="MultiPolygon"){const S=kE(h.coordinates,v,x),A=Zb(l.geometry(),m,v,x);if(!yg(m,v))return!1;for(const N of A)if(!yO(N,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ho={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Xb=1/298.257223563,Kb=Xb*(2-Xb),ip=Math.PI/180;class sp{static fromTile(i,l,h){const m=Math.PI*(1-2*(i+.5)/Math.pow(2,l)),v=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/ip;return new sp(v,h)}static get units(){return Ho}constructor(i,l){if(i===void 0)throw new Error("No latitude given.");if(l&&!Ho[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Ho).join(", ")}`);const h=6378.137*ip*(l?Ho[l]:1),m=Math.cos(i*ip),v=1/(1-Kb*(1-m*m)),x=Math.sqrt(v);this.kx=h*x*m,this.ky=h*x*v*(1-Kb)}distance(i,l){const h=_l(i[0]-l[0])*this.kx,m=(i[1]-l[1])*this.ky;return Math.sqrt(h*h+m*m)}bearing(i,l){const h=_l(l[0]-i[0])*this.kx;return Math.atan2(h,(l[1]-i[1])*this.ky)/ip}destination(i,l,h){const m=h*ip;return this.offset(i,Math.sin(m)*l,Math.cos(m)*l)}offset(i,l,h){return[i[0]+l/this.kx,i[1]+h/this.ky]}lineDistance(i){let l=0;for(let h=0;h<i.length-1;h++)l+=this.distance(i[h],i[h+1]);return l}area(i){let l=0;for(let h=0;h<i.length;h++){const m=i[h];for(let v=0,x=m.length,S=x-1;v<x;S=v++)l+=_l(m[v][0]-m[S][0])*(m[v][1]+m[S][1])*(h?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(i,l){let h=0;if(l<=0)return i[0];for(let m=0;m<i.length-1;m++){const v=i[m],x=i[m+1],S=this.distance(v,x);if(h+=S,h>l)return qv(v,x,(l-(h-S))/S)}return i[i.length-1]}pointToSegmentDistance(i,l,h){let[m,v]=l,x=_l(h[0]-m)*this.kx,S=(h[1]-v)*this.ky;if(x!==0||S!==0){const A=(_l(i[0]-m)*this.kx*x+(i[1]-v)*this.ky*S)/(x*x+S*S);A>1?(m=h[0],v=h[1]):A>0&&(m+=x/this.kx*A,v+=S/this.ky*A)}return x=_l(i[0]-m)*this.kx,S=(i[1]-v)*this.ky,Math.sqrt(x*x+S*S)}pointOnLine(i,l){let h=1/0,m=i[0][0],v=i[0][1],x=0,S=0;for(let A=0;A<i.length-1;A++){let N=i[A][0],M=i[A][1],L=_l(i[A+1][0]-N)*this.kx,z=(i[A+1][1]-M)*this.ky,W=0;L===0&&z===0||(W=(_l(l[0]-N)*this.kx*L+(l[1]-M)*this.ky*z)/(L*L+z*z),W>1?(N=i[A+1][0],M=i[A+1][1]):W>0&&(N+=L/this.kx*W,M+=z/this.ky*W)),L=_l(l[0]-N)*this.kx,z=(l[1]-M)*this.ky;const H=L*L+z*z;H<h&&(h=H,m=N,v=M,x=A,S=W)}return{point:[m,v],index:x,t:Math.max(0,Math.min(1,S))}}lineSlice(i,l,h){let m=this.pointOnLine(h,i),v=this.pointOnLine(h,l);if(m.index>v.index||m.index===v.index&&m.t>v.t){const N=m;m=v,v=N}const x=[m.point],S=m.index+1,A=v.index;!Yb(h[S],x[0])&&S<=A&&x.push(h[S]);for(let N=S+1;N<=A;N++)x.push(h[N]);return Yb(h[A],v.point)||x.push(v.point),x}lineSliceAlong(i,l,h){let m=0;const v=[];for(let x=0;x<h.length-1;x++){const S=h[x],A=h[x+1],N=this.distance(S,A);if(m+=N,m>i&&v.length===0&&v.push(qv(S,A,(i-(m-N))/N)),m>=l)return v.push(qv(S,A,(l-(m-N))/N)),v;m>i&&v.push(A)}return v}bufferPoint(i,l){const h=l/this.ky,m=l/this.kx;return[i[0]-m,i[1]-h,i[0]+m,i[1]+h]}bufferBBox(i,l){const h=l/this.ky,m=l/this.kx;return[i[0]-m,i[1]-h,i[2]+m,i[3]+h]}insideBBox(i,l){return _l(i[0]-l[0])>=0&&_l(i[0]-l[2])<=0&&i[1]>=l[1]&&i[1]<=l[3]}}function Yb(u,i){return u[0]===i[0]&&u[1]===i[1]}function qv(u,i,l){const h=_l(i[0]-u[0]);return[u[0]+h*l,u[1]+(i[1]-u[1])*l]}function _l(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class _g{constructor(i=[],l=(h,m)=>h<m?-1:h>m?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,m=l[i];for(;i>0;){const v=i-1>>1,x=l[v];if(h(m,x)>=0)break;l[i]=x,i=v}l[i]=m}_down(i){const{data:l,compare:h}=this,m=this.length>>1,v=l[i];for(;i<m;){let x=1+(i<<1);const S=x+1;if(S<this.length&&h(l[S],l[x])<0&&(x=S),h(l[x],v)>=0)break;l[i]=l[x],i=x}l[i]=v}}var Wt=8192;function Jb(u,i){return i.dist-u.dist}function Qb(u){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==u.length)return!1;for(let l=0;l<i.length;l++)if(i[l]!==u[l])return!1;return!0}function xg(u){return u[1]-u[0]+1}function Jc(u,i){const l=u[1]>=u[0]&&u[1]<i;return l||console.warn("Distance Expression: Index is out of range"),l}function ew(u,i){if(u[0]>u[1])return[null,null];const l=xg(u);if(i){if(l===2)return[u,null];const h=Math.floor(l/2);return[[u[0],u[0]+h],[u[0]+h,u[1]]]}{if(l===1)return[u,null];const h=Math.floor(l/2)-1;return[[u[0],u[0]+h],[u[0]+h+1,u[1]]]}}function Vh(u,i){const l=[1/0,1/0,-1/0,-1/0];if(!Jc(i,u.length))return l;for(let h=i[0];h<=i[1];++h)gg(l,u[h]);return l}function Uh(u){const i=[1/0,1/0,-1/0,-1/0];for(let l=0;l<u.length;++l)for(let h=0;h<u[l].length;++h)gg(i,u[l][h]);return i}function Ld(u,i,l){if(Qb(u)||Qb(i))return NaN;let h=0,m=0;return u[2]<i[0]&&(h=i[0]-u[2]),u[0]>i[2]&&(h=u[0]-i[2]),u[1]>i[3]&&(m=u[1]-i[3]),u[3]<i[1]&&(m=i[1]-u[3]),l.distance([0,0],[h,m])}function Gv(u){return 360*u-180}function RE(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Wv(u,i){const l=Math.pow(2,i.z),h=(u.y/Wt+i.y)/l;return[Gv((u.x/Wt+i.x)/l),RE(h)]}function vO(u,i){const l=[];for(let h=0;h<u.length;++h)l.push(Wv(u[h],i));return l}function ME(u,i,l){const h=l.pointOnLine(i,u).point;return l.distance(u,h)}function tw(u,i,l,h,m){const v=l.slice(h[0],h[1]+1);let x=1/0;for(let S=i[0];S<=i[1];++S)if((x=Math.min(x,ME(u[S],v,m)))===0)return 0;return x}function Fd(u,i,l,h,m){const v=Math.min(m.pointToSegmentDistance(u,l,h),m.pointToSegmentDistance(i,l,h)),x=Math.min(m.pointToSegmentDistance(l,u,i),m.pointToSegmentDistance(h,u,i));return Math.min(v,x)}function mn(u,i,l,h,m){if(!Jc(i,u.length)||!Jc(h,l.length))return NaN;let v=1/0;for(let x=i[0];x<i[1];++x)for(let S=h[0];S<h[1];++S){if(Vv(u[x],u[x+1],l[S],l[S+1]))return 0;v=Math.min(v,Fd(u[x],u[x+1],l[S],l[S+1],m))}return v}function _O(u,i,l,h,m){if(!Jc(i,u.length)||!Jc(h,l.length))return NaN;let v=1/0;for(let x=i[0];x<=i[1];++x)for(let S=h[0];S<=h[1];++S)if((v=Math.min(v,m.distance(u[x],l[S])))===0)return v;return v}function xO(u,i,l){if(Kl(u,i,!0))return 0;let h=1/0;for(const m of i){const v=m.length;if(v<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[v-1]&&(h=Math.min(h,l.pointToSegmentDistance(u,m[v-1],m[0])))===0||(h=Math.min(h,ME(u,m,l)))===0)return h}return h}function bO(u,i,l,h){if(!Jc(i,u.length))return NaN;for(let v=i[0];v<=i[1];++v)if(Kl(u[v],l,!0))return 0;let m=1/0;for(let v=i[0];v<i[1];++v)for(const x of l)for(let S=0,A=x.length,N=A-1;S<A;N=S++){if(Vv(u[v],u[v+1],x[N],x[S]))return 0;m=Math.min(m,Fd(u[v],u[v+1],x[N],x[S],h))}return m}function rw(u,i){for(const l of u)for(let h=0;h<=l.length-1;++h)if(Kl(l[h],i,!0))return!0;return!1}function wO(u,i,l,h=1/0){const m=Uh(u),v=Uh(i);if(h!==1/0&&Ld(m,v,l)>=h)return h;if(yg(m,v)){if(rw(u,i))return 0}else if(rw(i,u))return 0;let x=h;for(const S of u)for(let A=0,N=S.length,M=N-1;A<N;M=A++)for(const L of i)for(let z=0,W=L.length,H=W-1;z<W;H=z++){if(Vv(S[M],S[A],L[H],L[z]))return 0;x=Math.min(x,Fd(S[M],S[A],L[H],L[z],l))}return x}function gi(u,i,l,h,m,v,x){if(v===null||x===null)return;const S=Ld(Vh(h,v),Vh(m,x),l);S<i&&u.push({dist:S,range1:v,range2:x})}function SO(u,i,l,h,m=1/0){let v=Math.min(h.distance(u[0],l[0][0]),m);if(v===0)return v;const x=new _g([{dist:0,range1:[0,u.length-1],range2:[0,0]}],Jb),S=i?50:100,A=Uh(l);for(;x.length;){const N=x.pop();if(N.dist>=v)continue;const M=N.range1;if(xg(M)<=S){if(!Jc(M,u.length))return NaN;if(i){const L=bO(u,M,l,h);if((v=Math.min(v,L))===0)return v}else for(let L=M[0];L<=M[1];++L){const z=xO(u[L],l,h);if((v=Math.min(v,z))===0)return v}}else{const L=ew(M,i);if(L[0]!==null){const z=Ld(Vh(u,L[0]),A,h);z<v&&x.push({dist:z,range1:L[0],range2:[0,0]})}if(L[1]!==null){const z=Ld(Vh(u,L[1]),A,h);z<v&&x.push({dist:z,range1:L[1],range2:[0,0]})}}}return v}function DE(u,i,l,h,m,v=1/0){let x=Math.min(v,m.distance(u[0],l[0]));if(x===0)return x;const S=new _g([{dist:0,range1:[0,u.length-1],range2:[0,l.length-1]}],Jb),A=i?50:100,N=h?50:100;for(;S.length;){const M=S.pop();if(M.dist>=x)continue;const L=M.range1,z=M.range2;if(xg(L)<=A&&xg(z)<=N){if(!Jc(L,u.length)||!Jc(z,l.length))return NaN;if(i&&h?x=Math.min(x,mn(u,L,l,z,m)):i||h?i&&!h?x=Math.min(x,tw(l,z,u,L,m)):!i&&h&&(x=Math.min(x,tw(u,L,l,z,m))):x=Math.min(x,_O(u,L,l,z,m)),x===0)return x}else{const W=ew(L,i),H=ew(z,h);gi(S,x,m,u,l,W[0],H[0]),gi(S,x,m,u,l,W[0],H[1]),gi(S,x,m,u,l,W[1],H[0]),gi(S,x,m,u,l,W[1],H[1])}}return x}function nw(u,i,l,h,m=1/0){let v=m;const x=Vh(u,[0,u.length-1]);for(const S of l)if(!(v!==1/0&&Ld(x,Vh(S,[0,S.length-1]),h)>=v)&&(v=Math.min(v,DE(u,i,S,!0,h,v)),v===0))return v;return v}function Hv(u,i,l,h,m=1/0){let v=m;const x=Vh(u,[0,u.length-1]);for(const S of l){if(v!==1/0&&Ld(x,Uh(S),h)>=v)continue;const A=SO(u,i,S,h,v);if(isNaN(A))return A;if((v=Math.min(v,A))===0)return v}return v}function iw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class qh{constructor(i,l){this.type=mr,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(kd(i[1])){const h=i[1];if(h.type==="FeatureCollection"){for(let m=0;m<h.features.length;++m)if(iw(h.features[m].geometry.type))return new qh(h,h.features[m].geometry)}else if(h.type==="Feature"){if(iw(h.geometry.type))return new qh(h,h.geometry)}else if(iw(h.type))return new qh(h,h)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const l=i.geometry(),h=i.canonicalID();if(l!=null&&h!=null){if(i.geometryType()==="Point")return function(m,v,x){const S=[];for(const N of m)for(const M of N)S.push(Wv(M,v));const A=new sp(S[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?DE(S,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",A):x.type==="MultiLineString"?nw(S,!1,x.coordinates,A):x.type==="Polygon"||x.type==="MultiPolygon"?Hv(S,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,A):null}(l,h,this.geometries);if(i.geometryType()==="LineString")return function(m,v,x){const S=[];for(const N of m){const M=[];for(const L of N)M.push(Wv(L,v));S.push(M)}const A=new sp(S[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return nw(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",S,A);if(x.type==="MultiLineString"){let N=1/0;for(let M=0;M<x.coordinates.length;M++){const L=nw(x.coordinates[M],!0,S,A,N);if(isNaN(L))return L;if((N=Math.min(N,L))===0)return N}return N}if(x.type==="Polygon"||x.type==="MultiPolygon"){let N=1/0;for(let M=0;M<S.length;M++){const L=Hv(S[M],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,A,N);if(isNaN(L))return L;if((N=Math.min(N,L))===0)return N}return N}return null}(l,h,this.geometries);if(i.geometryType()==="Polygon")return function(m,v,x){const S=[];for(const N of function(M){const L=M.length;if(L<=1)return[M];const z=[];let W,H;for(let Q=0;Q<L;Q++){const ne=pO(M[Q]);ne!==0&&(M[Q].area=Math.abs(ne),H===void 0&&(H=ne<0),H===ne<0?(W&&z.push(W),W=[M[Q]]):W.push(M[Q]))}return W&&z.push(W),z}(m)){const M=[];for(let L=0;L<N.length;++L)M.push(vO(N[L],v));S.push(M)}const A=new sp(S[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Hv(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",S,A);if(x.type==="MultiLineString"){let N=1/0;for(let M=0;M<x.coordinates.length;M++){const L=Hv(x.coordinates[M],!0,S,A,N);if(isNaN(L))return L;if((N=Math.min(N,L))===0)return N}return N}return x.type==="Polygon"||x.type==="MultiPolygon"?function(N,M,L){let z=1/0;for(const W of N)for(const H of M){const Q=wO(W,H,L,z);if(isNaN(Q))return Q;if((z=Math.min(z,Q))===0)return z}return z}(x.type==="Polygon"?[x.coordinates]:x.coordinates,S,A):null}(l,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ap(u){if(u instanceof Co&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Dd||u instanceof qh)return!1;if(u instanceof lp)return u.featureConstant;let i=!0;return u.eachChild(l=>{i&&!ap(l)&&(i=!1)}),i}function bg(u){if(u instanceof Co&&u.name==="feature-state")return!1;let i=!0;return u.eachChild(l=>{i&&!bg(l)&&(i=!1)}),i}function op(u,i){if(u instanceof Co&&i.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild(h=>{l&&!op(h,i)&&(l=!1)}),l}function LE(u,i,l){return[u,i,l].filter(Boolean).join("")}function sw(u,i){switch(u){case"string":return Xc(i);case"number":return+i;case"boolean":return!!i;case"color":return Dn.parse(i);case"formatted":return Ua.fromString(Xc(i));case"resolvedImage":return Ao.build(Xc(i))}return i}function FE(u,i,l,h){return h!==void 0&&(u=h*Math.round(u/h)),i!==void 0&&u<i&&(u=i),l!==void 0&&u>l&&(u=l),u}class lp{constructor(i,l,h,m=!1){this.type=i,this.key=l,this.scope=h,this.featureConstant=m}static parse(i,l){let h=l.expectedType;if(h==null&&(h=Bn),i.length<2||i.length>3)return l.error("Invalid number of arguments for 'config' expression.");const m=l.parse(i[1],1);if(!(m instanceof Lu))return l.error("Key name of 'config' expression must be a string literal.");let v,x=!0;const S=Xc(m.value);if(i.length>=3){const A=l.parse(i[2],2);if(!(A instanceof Lu))return l.error("Scope of 'config' expression must be a string literal.");v=Xc(A.value)}if(l.options){const A=LE(S,v,l._scope),N=l.options.get(A);N&&(x=ap(N.value||N.default))}return new lp(h,S,v,x)}evaluate(i){const l=LE(this.key,this.scope,i.scope),h=i.getConfig(l);if(!h)return null;const{type:m,value:v,values:x,minValue:S,maxValue:A,stepValue:N}=h,M=h.default.evaluate(i);let L=M;if(v){const z=i.scope;i.scope=(z||"").split("").slice(1).join(""),L=v.evaluate(i),i.scope=z}return m&&(L=sw(m,L)),L===void 0||S===void 0&&A===void 0&&N===void 0||(typeof L=="number"?L=FE(L,S,A,N):Array.isArray(L)&&(L=L.map(z=>typeof z=="number"?FE(z,S,A,N):z))),v!==void 0&&L!==void 0&&x&&!x.includes(L)&&(L=M,m&&(L=sw(m,L))),(m&&m!==this.type||L!==void 0&&!Lv(Vs(L),this.type))&&(L=sw(this.type.kind,L)),L}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class Zv{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new Zv(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Xv{constructor(i,l=[],h,m=new Mv,v=[],x,S,A){this.registry=i,this.path=l,this.key=l.map(N=>typeof N=="string"?`['${N}']`:`[${N}]`).join(""),this.scope=m,this.errors=v,this.expectedType=h,this._scope=x,this.options=S,this.iconImageUseTheme=A}parse(i,l,h,m,v={}){return l||h?this.concat(l,null,h,m)._parse(i,v):this._parse(i,v)}parseObjectValue(i,l,h,m,v,x={}){return this.concat(l,h,m,v)._parse(i,x)}_parse(i,l){function h(m,v,x){return x==="assert"?new Lr(v,[m]):x==="coerce"?new Kc(v,[m]):m}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(m){let v=m.parse(i,this);if(!v)return null;if(this.expectedType){const x=this.expectedType,S=v.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||S.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(x,S))return null}else v=h(v,x,l.typeAnnotation||"coerce");else v=h(v,x,l.typeAnnotation||"assert")}if(!(v instanceof Lu)&&v.type.kind!=="resolvedImage"&&aw(v)){const x=new np(this._scope,this.options,this.iconImageUseTheme);try{v=new Lu(v.type,v.evaluate(x))}catch(S){return this.error(S.message),null}}return v}return Kc.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h,m){let v=typeof i=="number"?this.path.concat(i):this.path;v=typeof l=="string"?v.concat(l):v;const x=m?this.scope.concat(m):this.scope;return new Xv(this.registry,v,h||null,x,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(i,...l){const h=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new so(h,i))}checkSubtype(i,l){const h=fg(i,l);return h&&this.error(h),h}}function aw(u){if(u instanceof Zv)return aw(u.boundExpression);if(u instanceof Co&&u.name==="error"||u instanceof Yc||u instanceof Dd||u instanceof qh||u instanceof lp)return!1;const i=u instanceof Kc||u instanceof Lr;let l=!0;return u.eachChild(h=>{l=i?l&&aw(h):l&&h instanceof Lu}),!!l&&ap(u)&&op(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Kv(u,i){const l=u.length-1;let h,m,v=0,x=l,S=0;for(;v<=x;)if(S=Math.floor((v+x)/2),h=u[S],m=u[S+1],h<=i){if(S===l||i<m)return S;v=S+1}else{if(!(h>i))throw new Cs("Input is not a number.");x=S-1}return 0}class wg{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[m,v]of h)this.labels.push(m),this.outputs.push(v)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,mr);if(!h)return null;const m=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let x=1;x<i.length;x+=2){const S=x===1?-1/0:i[x],A=i[x+1],N=x,M=x+1;if(typeof S!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(m.length&&m[m.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const L=l.parse(A,M,v);if(!L)return null;v=v||L.type,m.push([S,L])}return new wg(v,h,m)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);const v=l.length;return m>=l[v-1]?h[v-1].evaluate(i):h[Kv(l,m)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}const zE=.95047,BE=1.08883,$E=4/29,cp=6/29,VE=3*cp*cp,TO=cp*cp*cp,EO=Math.PI/180,jO=180/Math.PI;function ow(u){return u>TO?Math.pow(u,1/3):u/VE+$E}function lw(u){return u>cp?u*u*u:VE*(u-$E)}function cw(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function uw(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function UE(u){const i=uw(u.r),l=uw(u.g),h=uw(u.b),m=ow((.4124564*i+.3575761*l+.1804375*h)/zE),v=ow((.2126729*i+.7151522*l+.072175*h)/1);return{l:116*v-16,a:500*(m-v),b:200*(v-ow((.0193339*i+.119192*l+.9503041*h)/BE)),alpha:u.a}}function Yv(u){let i=(u.l+16)/116,l=isNaN(u.a)?i:i+u.a/500,h=isNaN(u.b)?i:i-u.b/200;return i=1*lw(i),l=zE*lw(l),h=BE*lw(h),new Dn(cw(3.2404542*l-1.5371385*i-.4985314*h),cw(-.969266*l+1.8760108*i+.041556*h),cw(.0556434*l-.2040259*i+1.0572252*h),u.alpha)}function Jv(u,i,l){const h=i-u;return u+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const up={forward:UE,reverse:Yv,interpolate:function(u,i,l){return{l:jr(u.l,i.l,l),a:jr(u.a,i.a,l),b:jr(u.b,i.b,l),alpha:jr(u.alpha,i.alpha,l)}}},Sg={forward:function(u){const{l:i,a:l,b:h}=UE(u),m=Math.atan2(h,l)*jO;return{h:m<0?m+360:m,c:Math.sqrt(l*l+h*h),l:i,alpha:u.a}},reverse:function(u){const i=u.h*EO,l=u.c;return Yv({l:u.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:u.alpha})},interpolate:function(u,i,l){return{h:Jv(u.h,i.h,l),c:jr(u.c,i.c,l),l:jr(u.l,i.l,l),alpha:jr(u.alpha,i.alpha,l)}}};var qE=Object.freeze({__proto__:null,hcl:Sg,lab:up});class xl{constructor(i,l,h,m,v){this.type=i,this.operator=l,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[x,S]of v)this.labels.push(x),this.outputs.push(S)}static interpolationFactor(i,l,h,m){let v=0;if(i.name==="exponential")v=Qv(l,i.base,h,m);else if(i.name==="linear")v=Qv(l,1,h,m);else if(i.name==="cubic-bezier"){const x=i.controlPoints;v=new Ea(x[0],x[1],x[2],x[3]).solve(Qv(l,1,h,m))}return v}static parse(i,l){let[h,m,v,...x]=i;if(!Array.isArray(m)||m.length===0)return l.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const N=m[1];if(typeof N!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:N}}else{if(m[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const N=m.slice(1);if(N.length!==4||N.some(M=>typeof M!="number"||M<0||M>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:N}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,mr),!v)return null;const S=[];let A=null;h==="interpolate-hcl"||h==="interpolate-lab"?A=ao:l.expectedType&&l.expectedType.kind!=="value"&&(A=l.expectedType);for(let N=0;N<x.length;N+=2){const M=x[N],L=x[N+1],z=N+3,W=N+4;if(typeof M!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(S.length&&S[S.length-1][0]>=M)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const H=l.parse(L,W,A);if(!H)return null;A=A||H.type,S.push([M,H])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new xl(A,h,m,v,S):l.error(`Type ${as(A)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const m=this.input.evaluate(i);if(m<=l[0])return h[0].evaluate(i);const v=l.length;if(m>=l[v-1])return h[v-1].evaluate(i);const x=Kv(l,m),S=xl.interpolationFactor(this.interpolation,m,l[x],l[x+1]),A=h[x].evaluate(i),N=h[x+1].evaluate(i);return this.operator==="interpolate"?Bh[this.type.kind.toLowerCase()](A,N,S):this.operator==="interpolate-hcl"?Sg.reverse(Sg.interpolate(Sg.forward(A),Sg.forward(N),S)):up.reverse(up.interpolate(up.forward(A),up.forward(N),S))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Qv(u,i,l,h){const m=h-l,v=u-l;return m===0?0:i===1?v/m:(Math.pow(i,v)-1)/(Math.pow(i,m)-1)}class Tg{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const m=l.expectedType;m&&m.kind!=="value"&&(h=m);const v=[];for(const S of i.slice(1)){const A=l.parse(S,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!A)return null;h=h||A.type,v.push(A)}const x=m&&v.some(S=>fg(m,S.type));return new Tg(x?Bn:h,v)}evaluate(i){let l,h=null,m=0;for(const v of this.args){if(m++,h=v.evaluate(i),h&&h instanceof Ao&&!h.available&&(l||(l=h),h=null,m===this.args.length))return l;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class zu{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let v=1;v<i.length-1;v+=2){const x=i[v];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const S=l.parse(i[v+1],v+1);if(!S)return null;h.push([x,S])}const m=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return m?new zu(h,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,h]of this.bindings)i.push(l,h.serialize());return i.push(this.result.serialize()),i}}class e_{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,mr),m=l.parse(i[2],2,Va(l.expectedType||Bn));return h&&m?new e_(m.type.itemType,h,m):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new Cs("Array index out of bounds: negative index");if(l>=h.length)throw new Cs("Array index out of bounds: index exceeds array size");if(l!==Math.floor(l))throw new Cs("Array index must be an integer. Use at-interpolated for fractional indices");return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class t_{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,mr),m=l.parse(i[2],2,Va(l.expectedType||Bn));return h&&m?new t_(m.type.itemType,h,m):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new Cs(`Array index out of bounds: ${l} < 0.`);if(l>h.length-1)throw new Cs(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l===Math.floor(l))return h[l];const m=Math.floor(l),v=Math.ceil(l),x=h[m],S=h[v];if(typeof x!="number"||typeof S!="number")throw new Cs(`Cannot interpolate between non-number values at index ${l}.`);const A=l-m;return x*(1-A)+S*A}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class dw{constructor(i,l){this.type=Tn,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Bn),m=l.parse(i[2],2,Bn);return h&&m?$b(h.type,[Tn,Rn,mr,Eo,Bn])?new dw(h,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${as(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(h==null)return!1;if(!pg(l,["boolean","string","number","null"]))throw new Cs(`Expected first argument to be of type boolean, string, number or null, but found ${as(Vs(l))} instead.`);if(!pg(h,["string","array"]))throw new Cs(`Expected second argument to be of type array or string, but found ${as(Vs(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class dp{constructor(i,l,h){this.type=mr,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Bn),m=l.parse(i[2],2,Bn);if(!h||!m)return null;if(!$b(h.type,[Tn,Rn,mr,Eo,Bn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${as(h.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,mr);return v?new dp(h,m,v):null}return new dp(h,m)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!pg(l,["boolean","string","number","null"]))throw new Cs(`Expected first argument to be of type boolean, string, number or null, but found ${as(Vs(l))} instead.`);if(!pg(h,["string","array"]))throw new Cs(`Expected second argument to be of type array or string, but found ${as(Vs(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return h.indexOf(l,m)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Eg{constructor(i,l,h,m,v,x){this.inputType=i,this.type=l,this.input=h,this.cases=m,this.outputs=v,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,m;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);const v={},x=[];for(let N=2;N<i.length-1;N+=2){let M=i[N];const L=i[N+1];Array.isArray(M)||(M=[M]);const z=l.concat(N);if(M.length===0)return z.error("Expected at least one branch label.");for(const H of M){if(typeof H!="number"&&typeof H!="string")return z.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return z.error("Numeric branch labels must be integer values.");if(h){if(z.checkSubtype(h,Vs(H)))return null}else h=Vs(H);if(v[String(H)]!==void 0)return z.error("Branch labels must be unique.");v[String(H)]=x.length}const W=l.parse(L,N,m);if(!W)return null;m=m||W.type,x.push(W)}const S=l.parse(i[1],1,Bn);if(!S)return null;const A=l.parse(i[i.length-1],i.length-1,m);return A?S.type.kind!=="value"&&l.concat(1).checkSubtype(h,S.type)?null:new Eg(h,m,S,v,x,A):null}evaluate(i){const l=this.input.evaluate(i);return(Lv(Vs(l),this.inputType)&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],m={};for(const x of l){const S=m[this.cases[x]];S===void 0?(m[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[S][1].push(x)}const v=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,S]of h)i.push(S.length===1?v(S[0]):S.map(v)),i.push(this.outputs[x].serialize());return i.push(this.otherwise.serialize()),i}}class jg{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const m=[];for(let x=1;x<i.length-1;x+=2){const S=l.parse(i[x],x,Tn);if(!S)return null;const A=l.parse(i[x+1],x+1,h);if(!A)return null;m.push([S,A]),h=h||A.type}const v=l.parse(i[i.length-1],i.length-1,h);return v?new jg(h,m,v):null}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class r_{constructor(i,l,h,m){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=m}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Bn),m=l.parse(i[2],2,mr);if(!h||!m)return null;if(!$b(h.type,[Va(Bn),Rn,Bn]))return l.error(`Expected first argument to be of type array or string, but found ${as(h.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,mr);return v?new r_(h.type,h,m,v):null}return new r_(h.type,h,m)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!pg(l,["string","array"]))throw new Cs(`Expected first argument to be of type array or string, but found ${as(Vs(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return l.slice(h,m)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class hw{constructor(i,l){this.type=Va(Rn),this.str=i,this.delimiter=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Rn),m=l.parse(i[2],2,Rn);return h&&m?new hw(h,m):void 0}evaluate(i){const l=this.str.evaluate(i),h=this.delimiter.evaluate(i);return l.split(h)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function fw(u,i){return u==="=="||u==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function pw(u,i,l,h){return h.compare(i,l)===0}function hp(u,i,l){const h=u!=="=="&&u!=="!=";return class Cue{constructor(v,x,S){this.type=Tn,this.lhs=v,this.rhs=x,this.collator=S,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const S=v[0];let A=x.parse(v[1],1,Bn);if(!A)return null;if(!fw(S,A.type))return x.concat(1).error(`"${S}" comparisons are not supported for type '${as(A.type)}'.`);let N=x.parse(v[2],2,Bn);if(!N)return null;if(!fw(S,N.type))return x.concat(2).error(`"${S}" comparisons are not supported for type '${as(N.type)}'.`);if(A.type.kind!==N.type.kind&&A.type.kind!=="value"&&N.type.kind!=="value")return x.error(`Cannot compare types '${as(A.type)}' and '${as(N.type)}'.`);h&&(A.type.kind==="value"&&N.type.kind!=="value"?A=new Lr(N.type,[A]):A.type.kind!=="value"&&N.type.kind==="value"&&(N=new Lr(A.type,[N])));let M=null;if(v.length===4){if(A.type.kind!=="string"&&N.type.kind!=="string"&&A.type.kind!=="value"&&N.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(M=x.parse(v[3],3,Dv),!M)return null}return new Cue(A,N,M)}evaluate(v){const x=this.lhs.evaluate(v),S=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const A=Vs(x),N=Vs(S);if(A.kind!==N.kind||A.kind!=="string"&&A.kind!=="number")throw new Cs(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${A.kind}, ${N.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const A=Vs(x),N=Vs(S);if(A.kind!=="string"||N.kind!=="string")return i(v,x,S)}return this.collator?l(v,x,S,this.collator.evaluate(v)):i(v,x,S)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[u];return this.eachChild(x=>{v.push(x.serialize())}),v}}}const AO=hp("==",function(u,i,l){return i===l},pw),CO=hp("!=",function(u,i,l){return i!==l},function(u,i,l,h){return!pw(0,i,l,h)}),GE=hp("<",function(u,i,l){return i<l},function(u,i,l,h){return h.compare(i,l)<0}),WE=hp(">",function(u,i,l){return i>l},function(u,i,l,h){return h.compare(i,l)>0}),n_=hp("<=",function(u,i,l){return i<=l},function(u,i,l,h){return h.compare(i,l)<=0}),PO=hp(">=",function(u,i,l){return i>=l},function(u,i,l,h){return h.compare(i,l)>=0});class i_{constructor(i,l,h,m,v,x){this.type=Rn,this.number=i,this.locale=l,this.currency=h,this.unit=m,this.minFractionDigits=v,this.maxFractionDigits=x}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const h=l.parse(i[1],1,mr);if(!h)return null;const m=i[2];if(typeof m!="object"||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=l.parseObjectValue(m.locale,2,"locale",Rn),!v))return null;let x=null;if(m.currency&&(x=l.parseObjectValue(m.currency,2,"currency",Rn),!x))return null;let S=null;if(m.unit&&(S=l.parseObjectValue(m.unit,2,"unit",Rn),!S))return null;let A=null;if(m["min-fraction-digits"]&&(A=l.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",mr),!A))return null;let N=null;return m["max-fraction-digits"]&&(N=l.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",mr),!N)?null:new i_(h,v,x,S,A,N)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class mw{constructor(i){this.type=mr,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${as(h.type)} instead.`):new mw(h):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Cs(`Expected value to be of type string or array, but found ${as(Vs(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}function HE(u){return function(){u=1831565813+(u|=0)|0;let i=Math.imul(u^u>>>15,1|u);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const Gh={"==":AO,"!=":CO,">":WE,"<":GE,">=":PO,"<=":n_,array:Lr,at:e_,"at-interpolated":t_,boolean:Lr,case:jg,coalesce:Tg,collator:Yc,format:dr,image:rp,in:dw,"index-of":dp,interpolate:xl,"interpolate-hcl":xl,"interpolate-lab":xl,length:mw,let:zu,literal:Lu,match:Eg,number:Lr,"number-format":i_,object:Lr,slice:r_,step:wg,string:Lr,"to-boolean":Kc,"to-color":Kc,"to-number":Kc,"to-string":Kc,var:Zv,within:Dd,distance:qh,config:lp,split:hw};function gw(u,[i,l,h,m]){i=i.evaluate(u),l=l.evaluate(u),h=h.evaluate(u);const v=m?m.evaluate(u):1,x=Ub(i,l,h,v);if(x)throw new Cs(x);return new Dn(i/255,l/255,h/255,v)}function ZE(u,[i,l,h,m]){i=i.evaluate(u),l=l.evaluate(u),h=h.evaluate(u);const v=m?m.evaluate(u):1,x=function(N,M,L,z){return typeof N=="number"&&N>=0&&N<=360?typeof M=="number"&&M>=0&&M<=100&&typeof L=="number"&&L>=0&&L<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[N,M,L,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[N,M,L,z]:[N,M,L]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[N,M,L,z]:[N,M,L]).join(", ")}]: 'h' must be between 0 and 360.`}(i,l,h,v);if(x)throw new Cs(x);const S=`hsla(${i}, ${l}%, ${h}%, ${v})`,A=Dn.parse(S);if(!A)throw new Cs(`Failed to parse HSLA color: ${S}`);return A}function XE(u,i){return u in i}function yw(u,i){const l=i[u];return l===void 0?null:l}function zd(u){return{type:u}}function Wh(u){if(u instanceof lp)return new Set([u.key]);let i=new Set;return u.eachChild(l=>{i=new Set([...i,...Wh(l)])}),i}function s_(u){if(u instanceof Co&&u.name==="is-active-floor")return!0;let i=!1;return u.eachChild(l=>{!i&&s_(l)&&(i=!0)}),i}function KE(u){return{result:"success",value:u}}function Bd(u){return{result:"error",value:u}}function vw(u,i){return!!u&&!!u.parameters&&u.parameters.indexOf(i)>-1}function a_(u){return u["property-type"]==="data-driven"}function _w(u){return vw(u.expression,"measure-light")}function YE(u){return vw(u.expression,"zoom")}function xw(u){return!!u.expression&&u.expression.interpolated}function o_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function JE(u){return u}function bw(u,i){const l=i.type==="color",h=u.stops&&typeof u.stops[0][0]=="object",m=h||!(h||u.property!==void 0),v=u.type||(xw(i)?"exponential":"interval");if(l&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(N=>[N[0],Dn.parse(N[1])])),u.default=Dn.parse(u.default?u.default:i.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!qE[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let x,S,A;if(v==="exponential")x=QE;else if(v==="interval")x=NO;else if(v==="categorical"){x=fp,S=Object.create(null);for(const N of u.stops)S[N[0]]=N[1];A=typeof u.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);x=IO}if(h){const N={},M=[];for(let W=0;W<u.stops.length;W++){const H=u.stops[W],Q=H[0].zoom;N[Q]===void 0&&(N[Q]={zoom:Q,type:u.type,property:u.property,default:u.default,stops:[]},M.push(Q)),N[Q].stops.push([H[0].value,H[1]])}const L=[];for(const W of M)L.push([N[W].zoom,bw(N[W],i)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:xl.interpolationFactor.bind(void 0,z),zoomStops:L.map(W=>W[0]),evaluate:({zoom:W},H)=>QE({stops:L,base:u.base},i,W).evaluate(W,H)}}if(m){const N=v==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:xl.interpolationFactor.bind(void 0,N),zoomStops:u.stops.map(M=>M[0]),evaluate:({zoom:M})=>x(u,i,M,S,A)}}return{kind:"source",evaluate(N,M){const L=M&&M.properties?M.properties[u.property]:void 0;return L===void 0?Ag(u.default,i.default):x(u,i,L,S,A)}}}function Ag(u,i,l){return u!==void 0?u:i!==void 0?i:l!==void 0?l:void 0}function fp(u,i,l,h,m){return Ag(typeof l===m?h[l]:void 0,u.default,i.default)}function NO(u,i,l){if(!Ar(l))return Ag(u.default,i.default);const h=u.stops.length;if(h===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[h-1][0])return u.stops[h-1][1];const m=Kv(u.stops.map(v=>v[0]),l);return u.stops[m][1]}function QE(u,i,l){const h=u.base!==void 0?u.base:1;if(!Ar(l))return Ag(u.default,i.default);const m=u.stops.length;if(m===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[m-1][0])return u.stops[m-1][1];const v=Kv(u.stops.map(M=>M[0]),l),x=function(M,L,z,W){const H=W-z,Q=M-z;return H===0?0:L===1?Q/H:(Math.pow(L,Q)-1)/(Math.pow(L,H)-1)}(l,h,u.stops[v][0],u.stops[v+1][0]),S=u.stops[v][1],A=u.stops[v+1][1];let N=Bh[i.type]||JE;if(u.colorSpace&&u.colorSpace!=="rgb"){const M=qE[u.colorSpace];N=(L,z)=>M.reverse(M.interpolate(M.forward(L),M.forward(z),x))}return typeof S.evaluate=="function"?{evaluate(...M){const L=S.evaluate.apply(void 0,M),z=A.evaluate.apply(void 0,M);if(L!==void 0&&z!==void 0)return N(L,z,x)}}:N(S,A,x)}function IO(u,i,l){return i.type==="color"?l=Dn.parse(l):i.type==="formatted"?l=Ua.fromString(l.toString()):i.type==="resolvedImage"?l=Ao.build(l.toString()):Ir(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0),Ag(l,u.default,i.default)}Co.register(Gh,{error:[{kind:"error"},[Rn],(u,[i])=>{throw new Cs(i.evaluate(u))}],typeof:[Rn,[Bn],(u,[i])=>as(Vs(i.evaluate(u)))],"to-rgba":[Va(mr,4),[ao],(u,[i])=>i.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Va(mr,4),[ao],(u,[i])=>i.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ao,[mr,mr,mr],gw],rgba:[ao,[mr,mr,mr,mr],gw],hsl:[ao,[mr,mr,mr],ZE],hsla:[ao,[mr,mr,mr,mr],ZE],has:{type:Tn,overloads:[[[Rn],(u,[i])=>XE(i.evaluate(u),u.properties())],[[Rn,ep],(u,[i,l])=>XE(i.evaluate(u),l.evaluate(u))]]},get:{type:Bn,overloads:[[[Rn],(u,[i])=>yw(i.evaluate(u),u.properties())],[[Rn,ep],(u,[i,l])=>yw(i.evaluate(u),l.evaluate(u))]]},"feature-state":[Bn,[Rn],(u,[i])=>yw(i.evaluate(u),u.featureState||{})],properties:[ep,[],u=>u.properties()],"geometry-type":[Rn,[],u=>u.geometryType()],worldview:[Rn,[],u=>u.globals.worldview||""],"is-active-floor":[Tn,zd(Rn),(u,i)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const l=u.globals.activeFloors;return i.some(h=>{const m=h.evaluate(u);return l.has(m)})}],id:[Bn,[],u=>u.id()],zoom:[mr,[],u=>u.globals.zoom],pitch:[mr,[],u=>u.globals.pitch||0],"distance-from-center":[mr,[],u=>u.distanceFromCenter()],"measure-light":[mr,[Rn],(u,[i])=>u.measureLight(i.evaluate(u))],"heatmap-density":[mr,[],u=>u.globals.heatmapDensity||0],"line-progress":[mr,[],u=>u.globals.lineProgress||0],"raster-value":[mr,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[mr,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[mr,[],u=>u.globals.skyRadialProgress||0],accumulated:[Bn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[mr,zd(mr),(u,i)=>{let l=0;for(const h of i)l+=h.evaluate(u);return l}],"*":[mr,zd(mr),(u,i)=>{let l=1;for(const h of i)l*=h.evaluate(u);return l}],"-":{type:mr,overloads:[[[mr,mr],(u,[i,l])=>i.evaluate(u)-l.evaluate(u)],[[mr],(u,[i])=>-i.evaluate(u)]]},"/":[mr,[mr,mr],(u,[i,l])=>i.evaluate(u)/l.evaluate(u)],"%":[mr,[mr,mr],(u,[i,l])=>i.evaluate(u)%l.evaluate(u)],ln2:[mr,[],()=>Math.LN2],pi:[mr,[],()=>Math.PI],e:[mr,[],()=>Math.E],"^":[mr,[mr,mr],(u,[i,l])=>Math.pow(i.evaluate(u),l.evaluate(u))],sqrt:[mr,[mr],(u,[i])=>Math.sqrt(i.evaluate(u))],log10:[mr,[mr],(u,[i])=>Math.log(i.evaluate(u))/Math.LN10],ln:[mr,[mr],(u,[i])=>Math.log(i.evaluate(u))],log2:[mr,[mr],(u,[i])=>Math.log2(i.evaluate(u))],sin:[mr,[mr],(u,[i])=>Math.sin(i.evaluate(u))],cos:[mr,[mr],(u,[i])=>Math.cos(i.evaluate(u))],tan:[mr,[mr],(u,[i])=>Math.tan(i.evaluate(u))],asin:[mr,[mr],(u,[i])=>Math.asin(i.evaluate(u))],acos:[mr,[mr],(u,[i])=>Math.acos(i.evaluate(u))],atan:[mr,[mr],(u,[i])=>Math.atan(i.evaluate(u))],min:[mr,zd(mr),(u,i)=>Math.min(...i.map(l=>l.evaluate(u)))],max:[mr,zd(mr),(u,i)=>Math.max(...i.map(l=>l.evaluate(u)))],abs:[mr,[mr],(u,[i])=>Math.abs(i.evaluate(u))],round:[mr,[mr],(u,[i])=>{const l=i.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[mr,[mr],(u,[i])=>Math.floor(i.evaluate(u))],ceil:[mr,[mr],(u,[i])=>Math.ceil(i.evaluate(u))],"filter-==":[Tn,[Rn,Bn],(u,[i,l])=>u.properties()[i.value]===l.value],"filter-id-==":[Tn,[Bn],(u,[i])=>u.id()===i.value],"filter-type-==":[Tn,[Rn],(u,[i])=>u.geometryType()===i.value],"filter-<":[Tn,[Rn,Bn],(u,[i,l])=>{const h=u.properties()[i.value],m=l.value;return typeof h==typeof m&&h<m}],"filter-id-<":[Tn,[Bn],(u,[i])=>{const l=u.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[Tn,[Rn,Bn],(u,[i,l])=>{const h=u.properties()[i.value],m=l.value;return typeof h==typeof m&&h>m}],"filter-id->":[Tn,[Bn],(u,[i])=>{const l=u.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[Tn,[Rn,Bn],(u,[i,l])=>{const h=u.properties()[i.value],m=l.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[Tn,[Bn],(u,[i])=>{const l=u.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[Tn,[Rn,Bn],(u,[i,l])=>{const h=u.properties()[i.value],m=l.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[Tn,[Bn],(u,[i])=>{const l=u.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[Tn,[Bn],(u,[i])=>i.value in u.properties()],"filter-has-id":[Tn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Tn,[Va(Rn)],(u,[i])=>i.value.indexOf(u.geometryType())>=0],"filter-id-in":[Tn,[Va(Bn)],(u,[i])=>i.value.indexOf(u.id())>=0],"filter-in-small":[Tn,[Rn,Va(Bn)],(u,[i,l])=>l.value.indexOf(u.properties()[i.value])>=0],"filter-in-large":[Tn,[Rn,Va(Bn)],(u,[i,l])=>function(h,m,v,x){for(;v<=x;){const S=v+x>>1;if(m[S]===h)return!0;m[S]>h?x=S-1:v=S+1}return!1}(u.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(u,[i,l])=>i.evaluate(u)&&l.evaluate(u)],[zd(Tn),(u,i)=>{for(const l of i)if(!l.evaluate(u))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(u,[i,l])=>i.evaluate(u)||l.evaluate(u)],[zd(Tn),(u,i)=>{for(const l of i)if(l.evaluate(u))return!0;return!1}]]},"!":[Tn,[Tn],(u,[i])=>!i.evaluate(u)],"is-supported-script":[Tn,[Rn],(u,[i])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(i.evaluate(u))}],upcase:[Rn,[Rn],(u,[i])=>i.evaluate(u).toUpperCase()],downcase:[Rn,[Rn],(u,[i])=>i.evaluate(u).toLowerCase()],concat:[Rn,zd(Bn),(u,i)=>i.map(l=>Xc(l.evaluate(u))).join("")],"resolved-locale":[Rn,[Dv],(u,[i])=>i.evaluate(u).resolvedLocale()],random:[mr,[mr,mr,Bn],(u,i)=>{const[l,h,m]=i.map(x=>x.evaluate(u));if(l>h||l===h)return l;let v;if(typeof m=="string")v=function(x){let S=0;if(x.length===0)return S;for(let A=0;A<x.length;A++)S=(S<<5)-S+x.charCodeAt(A),S&=S;return S}(m);else{if(typeof m!="number")throw new Cs(`Invalid seed input: ${m}`);v=m}return l+HE(v)()*(h-l)}]});class l_{constructor(i,l,h,m,v){this.expression=i,this._warningHistory={},this._scope=h,this._options=m,this._iconImageUseTheme=v,this._evaluator=new np(h,m,v),this._defaultValue=l?function(x){return x.type==="color"&&(o_(x.default)||Array.isArray(x.default))?new Dn(0,0,0,0):x.type==="color"?Dn.parse(x.default)||null:x.default===void 0?null:x.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=Wh(i),this.isIndoorDependent=s_(i)}evaluateWithoutErrorHandling(i,l,h,m,v,x,S,A){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,m,v,x,S,A,N){this._evaluator||(this._evaluator=new np(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this._evaluator.iconImageUseTheme=N||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Cs(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){const L=M;return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${L.message}`)),this._defaultValue}}}function Cg(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Gh}function $d(u,i,l,h,m){const v=new Xv(Gh,[],i?function(S){const A={color:ao,string:Rn,number:mr,enum:Rn,boolean:Tn,formatted:tp,resolvedImage:$h};return S.type==="array"?Va(A[S.value]||Bn,S.length):A[S.type]}(i):void 0,void 0,void 0,l,h,m),x=v.parse(u,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?KE(new l_(x,i,l,h,m)):Bd(v.errors)}class Pg{constructor(i,l,h,m){this.kind=i,this._styleExpression=l,this.isLightConstant=h,this.isLineProgressConstant=m,this.isStateDependent=i!=="constant"&&!bg(l.expression),this.configDependencies=Wh(l.expression),this.isIndoorDependent=s_(l.expression)}evaluateWithoutErrorHandling(i,l,h,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,v,x)}evaluate(i,l,h,m,v,x,S){return this._styleExpression.evaluate(i,l,h,m,v,x,void 0,void 0,S)}}class Hh{constructor(i,l,h,m,v,x){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!bg(l.expression),this.isIndoorDependent=s_(l.expression),this.isLightConstant=v,this.isLineProgressConstant=x,this.configDependencies=Wh(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,l,h,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,m,v,x)}evaluate(i,l,h,m,v,x){return this._styleExpression.evaluate(i,l,h,m,v,x)}interpolationFactor(i,l,h){return this.interpolationType?xl.interpolationFactor(this.interpolationType,i,l,h):0}}function c_(u,i,l,h,m){if((u=$d(u,i,l,h,m)).result==="error")return u;const v=u.value.expression,x=ap(v);if(!x&&!a_(i))return Bd([new so("","data expressions not supported")]);const S=op(v,["zoom","pitch","distance-from-center"]);if(!S&&!YE(i))return Bd([new so("","zoom expressions not supported")]);const A=op(v,["measure-light"]);if(!A&&!_w(i))return Bd([new so("","measure-light expression not supported")]);const N=op(v,["line-progress"]);if(!N&&!function(z){return vw(z.expression,"line-progress")}(i))return Bd([new so("","line-progress expression not supported")]);const M=i.expression&&i.expression.relaxZoomRestriction,L=u_(v);return L||S||M?L instanceof so?Bd([L]):L instanceof xl&&!xw(i)?Bd([new so("",'"interpolate" expressions cannot be used with this property')]):KE(L?new Hh(x&&N?"camera":"composite",u.value,L.labels,L instanceof xl?L.interpolation:void 0,A,N):new Pg(x&&N?"constant":"source",u.value,A,N)):Bd([new so("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ng{constructor(i,l){this._parameters=i,this._specification=l,Object.assign(this,bw(this._parameters,this._specification))}static deserialize(i){return new Ng(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function u_(u){let i=null;if(u instanceof zu)i=u_(u.result);else if(u instanceof Tg){for(const l of u.args)if(i=u_(l),i)break}else(u instanceof wg||u instanceof xl)&&u.input instanceof Co&&u.input.name==="zoom"&&(i=u);return i instanceof so||u.eachChild(l=>{const h=u_(l);h instanceof so?i=h:i&&h&&i!==h&&(i=new so("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Qc,ej,kO=function(){if(ej)return Qc;ej=1,Qc=i;var u=3;function i(l,h,m){var v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var x=new Int32Array(this.arrayBuffer);l=x[0],this.d=(h=x[1])+2*(m=x[2]);for(var S=0;S<this.d*this.d;S++){var A=x[u+S],N=x[u+S+1];v.push(A===N?null:x.subarray(A,N))}var M=x[u+v.length+1];this.keys=x.subarray(x[u+v.length],M),this.bboxes=x.subarray(M),this.insert=this._insertReadonly}else{this.d=h+2*m;for(var L=0;L<this.d*this.d;L++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=m,this.scale=h/l,this.uid=0;var z=m/h*l;this.min=-z,this.max=l+z}return i.prototype.insert=function(l,h,m,v,x){this._forEachCell(h,m,v,x,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(l,h,m,v,x,S){this.cells[x].push(S)},i.prototype.query=function(l,h,m,v,x){var S=this.min,A=this.max;if(l<=S&&h<=S&&A<=m&&A<=v&&!x)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(l,h,m,v,this._queryCell,N,{},x),N},i.prototype._queryCell=function(l,h,m,v,x,S,A,N){var M=this.cells[x];if(M!==null)for(var L=this.keys,z=this.bboxes,W=0;W<M.length;W++){var H=M[W];if(A[H]===void 0){var Q=4*H;(N?N(z[Q+0],z[Q+1],z[Q+2],z[Q+3]):l<=z[Q+2]&&h<=z[Q+3]&&m>=z[Q+0]&&v>=z[Q+1])?(A[H]=!0,S.push(L[H])):A[H]=!1}}},i.prototype._forEachCell=function(l,h,m,v,x,S,A,N){for(var M=this._convertToCellCoord(l),L=this._convertToCellCoord(h),z=this._convertToCellCoord(m),W=this._convertToCellCoord(v),H=M;H<=z;H++)for(var Q=L;Q<=W;Q++){var ne=this.d*Q+H;if((!N||N(this._convertFromCellCoord(H),this._convertFromCellCoord(Q),this._convertFromCellCoord(H+1),this._convertFromCellCoord(Q+1)))&&x.call(this,l,h,m,v,ne,S,A,N))return}},i.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},i.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,h=u+this.cells.length+1+1,m=0,v=0;v<this.cells.length;v++)m+=this.cells[v].length;var x=new Int32Array(h+m+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var S=h,A=0;A<l.length;A++){var N=l[A];x[u+A]=S,x.set(N,S),S+=N.length}return x[u+l.length]=S,x.set(this.keys,S),x[u+l.length+1]=S+=this.keys.length,x.set(this.bboxes,S),S+=this.bboxes.length,x.buffer},Qc}(),Zh=ii(kO);const d_={};function ir(u,i,l={}){Object.defineProperty(u,"_classRegistryKey",{value:i,writable:!1}),d_[i]={klass:u,omit:l.omit||[]}}ir(Object,"Object"),Zh.serialize=function(u,i){const l=u.toArrayBuffer();return i&&i.add(l),{buffer:l}},Zh.deserialize=function(u){return new Zh(u.buffer)},Object.defineProperty(Zh,"name",{value:"Grid"}),ir(Zh,"Grid"),delete kt.prototype.constructor,ir(Dn,"Color"),ir(Error,"Error"),ir(Ua,"Formatted"),ir(Fv,"FormattedSection"),ir(og,"AJAXError"),ir(Ao,"ResolvedImage"),ir(Ng,"StylePropertyFunction"),ir(l_,"StyleExpression",{omit:["_evaluator"]}),ir(To,"ImageId"),ir(jo,"ImageVariant"),ir(Hh,"ZoomDependentExpression"),ir(Pg,"ZoomConstantExpression"),ir(Co,"CompoundExpression",{omit:["_evaluate"]});for(const u in Gh)d_[Gh[u]._classRegistryKey]||ir(Gh[u],`Expression${u}`);function ww(u){return u&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function gc(u,i){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(ww(u)||u instanceof ImageBitmap)return i&&i.add(u),u;if(ArrayBuffer.isView(u))return i&&i.add(u.buffer),u;if(u instanceof ImageData)return i&&i.add(u.data.buffer),u;if(Array.isArray(u)){const l=[];for(const h of u)l.push(gc(h,i));return l}if(u instanceof Map){const l={$name:"Map",entries:[]};for(const[h,m]of u.entries())l.entries.push(gc(h),gc(m,i));return l}if(u instanceof Set){const l={$name:"Set"};let h=0;for(const m of u.values())l[++h]=gc(m);return l}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const l=u.constructor,h=l._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const m=l.serialize?l.serialize(u,i):{};if(!l.serialize){for(const v in u)u.hasOwnProperty(v)&&(d_[h].omit.indexOf(v)>=0||(m[v]=gc(u[v],i)));u instanceof Error&&(m.message=u.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof u)}function Bu(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||ww(u)||u instanceof ImageBitmap||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Bu);if(typeof u=="object"){const i=u.$name||"Object";if(i==="Map"){const m=u.entries||[],v=new Map;for(let x=0;x<m.length;x+=2)v.set(Bu(m[x]),Bu(m[x+1]));return v}if(i==="Set"){const m=new Set;for(const v of Object.keys(u))v!=="$name"&&m.add(Bu(u[v]));return m}if(i==="BigInt")return BigInt(u.value);const{klass:l}=d_[i];if(!l)throw new Error(`Can't deserialize unregistered class "${i}".`);if(l.deserialize)return l.deserialize(u);const h=Object.create(l.prototype);for(const m of Object.keys(u))m!=="$name"&&(h[m]=Bu(u[m]));return h}throw new Error("can't deserialize object of type "+typeof u)}const tj=u=>u>=1536&&u<=1791,rj=u=>u>=1872&&u<=1919,h_=u=>u>=2208&&u<=2303,f_=u=>u>=11904&&u<=12031,Sw=u=>u>=12032&&u<=12255,Tw=u=>u>=12272&&u<=12287,pp=u=>u>=12288&&u<=12351,mp=u=>u>=12352&&u<=12447,Ig=u=>u>=12448&&u<=12543,eu=u=>u>=12544&&u<=12591,nj=u=>u>=12704&&u<=12735,ij=u=>u>=12736&&u<=12783,sj=u=>u>=12784&&u<=12799,aj=u=>u>=12800&&u<=13055,Ew=u=>u>=13056&&u<=13311,gp=u=>u>=13312&&u<=19903,p_=u=>u>=19968&&u<=40959,jw=u=>u>=40960&&u<=42127,m_=u=>u>=42128&&u<=42191,oj=u=>u>=44032&&u<=55215,lj=u=>u>=63744&&u<=64255,Aw=u=>u>=64336&&u<=65023,cj=u=>u>=65040&&u<=65055,Cw=u=>u>=65072&&u<=65103,uj=u=>u>=65104&&u<=65135,Pw=u=>u>=65136&&u<=65279,Nw=u=>u>=65280&&u<=65519;function Iw(u){for(const i of u)if(Vd(i.charCodeAt(0)))return!0;return!1}function OO(u){for(const i of u)if(!RO(i.charCodeAt(0)))return!1;return!0}function RO(u){return!(tj(u)||rj(u)||h_(u)||Aw(u)||Pw(u))}function dj(u){return!(u<11904||!(nj(u)||eu(u)||Cw(u)||lj(u)||Ew(u)||f_(u)||ij(u)||pp(u)||gp(u)||p_(u)||aj(u)||Nw(u)||mp(u)||Tw(u)||Sw(u)||sj(u)||Ig(u)||cj(u)||m_(u)||jw(u)))}function Vd(u){return!(u!==746&&u!==747&&(u<4352||!(nj(u)||eu(u)||Cw(u)&&!(u>=65097&&u<=65103)||lj(u)||Ew(u)||f_(u)||ij(u)||!(!pp(u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||gp(u)||p_(u)||aj(u)||(i=>i>=12592&&i<=12687)(u)||(i=>i>=43360&&i<=43391)(u)||(i=>i>=55216&&i<=55295)(u)||(i=>i>=4352&&i<=4607)(u)||oj(u)||mp(u)||Tw(u)||(i=>i>=12688&&i<=12703)(u)||Sw(u)||sj(u)||Ig(u)&&u!==12540||!(!Nw(u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!uj(u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||(i=>i>=5120&&i<=5759)(u)||(i=>i>=6320&&i<=6399)(u)||cj(u)||(i=>i>=19904&&i<=19967)(u)||jw(u)||m_(u))))}function hj(u){return u===12312||u===12313||u===12316||u===12540||u===12448}function kw(u){return!(Vd(u)||function(i){return!!((l=>l>=128&&l<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(l=>l>=8192&&l<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&i!==9251||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||pp(i)||Ig(i)||(l=>l>=57344&&l<=63743)(i)||Cw(i)||uj(i)||Nw(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(u))}function g_(u){return tj(u)||rj(u)||h_(u)||Aw(u)||Pw(u)}function fj(u){return u>=1424&&u<=2303||Aw(u)||Pw(u)}function MO(u,i){return!(!i&&fj(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||(l=>l>=6016&&l<=6143)(u))}function Ud(u){for(const i of u)if(fj(i.charCodeAt(0)))return!0;return!1}const Po={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let qd=null,oo=Po.unavailable,Gd=null;const pj=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(oo=Po.error),qd&&qd(u)};function Ow(){Rw.fire(new Mu("pluginStateChange",{pluginStatus:oo,pluginURL:Gd}))}const Rw=new Du,Mw=function(){return oo},Dw=function(){if(oo!==Po.deferred||!Gd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");oo=Po.loading,Ow(),Gd&&cg({url:Gd},u=>{u?pj(u):(oo=Po.loaded,Ow())})},yc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>oo===Po.loaded||yc.applyArabicShaping!=null,isLoading:()=>oo===Po.loading,setState(u){oo=u.pluginStatus,Gd=u.pluginURL},isParsing:()=>oo===Po.parsing,isParsed:()=>oo===Po.parsed,getPluginURL:()=>Gd};class Wn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness,this.worldview=l.worldview,this.activeFloors=l.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(l,h){for(const m of l)if(!MO(m.charCodeAt(0),h))return!1;return!0}(i,yc.isLoaded())}}class kg{constructor(i,l,h,m,v){this.property=i,this.value=l,this.expression=function(x,S,A,N,M){if(o_(x))return new Ng(x,S);if(Cg(x)||Array.isArray(x)&&x.length>0){const L=c_(x,S,A,N,M);if(L.result==="error")throw new Error(L.value.map(z=>`${z.key}: ${z.message}`).join(", "));return L.value}{let L=x;return typeof x=="string"&&S.type==="color"&&(L=Dn.parse(x)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>L}}}(l===void 0?i.specification.default:l,i.specification,h,m,v)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,h,m){return this.property.possiblyEvaluate(this,i,l,h,m)}}class Og{constructor(i,l,h,m){this.property=i,this.value=new kg(i,void 0,l,h,m)}transitioned(i,l){return new mj(this.property,this.value,l,Object.assign({},i.transition,this.transition),i.now)}untransitioned(){return new mj(this.property,this.value,null,{},0)}}class yp{constructor(i,l,h,m){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=l,this._options=h,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return $r(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new Og(this._values[i].property,this._scope,this._options,this._iconImageUseTheme)),this._values[i].value=new kg(this._values[i].property,l===null?void 0:$r(l),this._scope,this._options,this._iconImageUseTheme),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].value.isIndoorDependent())}setTransitionOrValue(i,l){l&&(this._options=l);const h=this._properties.properties;if(i)for(const m in i){const v=i[m];if(m.endsWith("-transition")){const x=m.slice(0,-11);h[x]&&this.setTransition(x,v)}else h.hasOwnProperty(m)&&this.setValue(m,v)}}getTransition(i){return $r(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new Og(this._values[i].property)),this._values[i].transition=$r(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h);const m=this.getTransition(l);m!==void 0&&(i[`${l}-transition`]=m)}return i}transitioned(i,l){const h=new gj(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(i,l._values[m]);return h}untransitioned(){const i=new gj(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}isIndoorDependent(){return this._isIndoorDependent}}class mj{constructor(i,l,h,m,v){const x=m.delay||0,S=m.duration||0;v=v||0,this.property=i,this.value=l,this.begin=v+x,this.end=this.begin+S,i.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const m=i.now||0,v=this.value.possiblyEvaluate(i,l,h),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(i,l,h);{const S=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,h),v,me(S))}}return v}}class gj{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const m=new lo(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(i,l,h);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Lw{constructor(i,l,h,m){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=l,this._options=h,this._iconImageUseTheme=m,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return $r(this._values[i].value)}setValue(i,l){this._values[i]=new kg(this._values[i].property,l===null?void 0:$r(l),this._scope,this._options,this._iconImageUseTheme),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].isIndoorDependent())}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h)}return i}possiblyEvaluate(i,l,h,m){const v=new lo(this._properties);for(const x of Object.keys(this._values))v._values[x]=this._values[x].possiblyEvaluate(i,l,h,m);return v}isIndoorDependent(){return this._isIndoorDependent}}class Xh{constructor(i,l,h,m){this.property=i,this.value=l,this.parameters=h,this.iconImageUseTheme=m}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,h,m){return this.property.evaluate(this.value,this.parameters,i,l,h,m,this.iconImageUseTheme)}}class lo{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Lt{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,h){const m=Bh[this.specification.type];return m?m(i,l,h):i}}class Kt{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,m,v){return i.expression.kind==="constant"||i.expression.kind==="camera"?new Xh(this,{kind:"constant",value:i.expression.evaluate(l,null,{},h,m,void 0,v)},l):new Xh(this,i.expression,l,v)}interpolate(i,l,h){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Xh(this,{kind:"constant",value:void 0},i.parameters);const m=Bh[this.specification.type];return m?new Xh(this,{kind:"constant",value:m(i.value.value,l.value.value,h)},i.parameters):i}evaluate(i,l,h,m,v,x,S){return i.kind==="constant"?i.value:i.evaluate(l,h,m,v,x,void 0,S)}}class vp{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,m){return!!i.expression.evaluate(l,null,{},h,m)}interpolate(){return!1}}class Mi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Wn(0,{});for(const h in i){const m=i[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new kg(m,void 0),x=this.defaultTransitionablePropertyValues[h]=new Og(m);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate(l)}}}ir(Kt,"DataDrivenProperty"),ir(Lt,"DataConstantProperty"),ir(vp,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function yj(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function y_(u){if(Array.isArray(u))return u.map(y_);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const i={};for(const l in u)i[l]=y_(u[l]);return i}return yj(u)}function Fw(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const i of u.slice(1))if(!Fw(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function zw(u,i="",l=null,h="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fw(u)||(u=Rg(u));const m=u;let v=!0;try{v=function(M){if(!_p(M))return M;let L=y_(M);return Bw(L),L=vj(L),L}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let x=null,S=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){S=Qe[`filter_${h}`];const M=$d(v,S,i,l);if(M.result==="error")throw new Error(M.value.map(L=>`${L.key}: ${L.message}`).join(", "));x=(L,z,W)=>M.value.evaluate(L,z,{},W)}let A=null,N=null;if(v!==m){const M=$d(m,S,i,l);if(M.result==="error")throw new Error(M.value.map(L=>`${L.key}: ${L.message}`).join(", "));A=(L,z,W,H,Q)=>M.value.evaluate(L,z,{},W,void 0,void 0,H,Q),N=!ap(M.value.expression)}return{filter:x,dynamicFilter:A||void 0,needGeometry:$w(v),needFeature:!!N}}function vj(u){if(!Array.isArray(u))return u;const i=function(l){if(DO.has(l[0])){for(let h=1;h<l.length;h++)if(_p(l[h]))return!0}return l}(u);return i===!0?i:i.map(l=>vj(l))}function Bw(u){let i=!1;const l=[];if(u[0]==="case"){for(let h=1;h<u.length-1;h+=2)i=i||_p(u[h]),l.push(u[h+1]);l.push(u[u.length-1])}else if(u[0]==="match"){i=i||_p(u[1]);for(let h=2;h<u.length-1;h+=2)l.push(u[h+1]);l.push(u[u.length-1])}else if(u[0]==="step"){i=i||_p(u[1]);for(let h=1;h<u.length-1;h+=2)l.push(u[h+1])}i&&(u.length=0,u.push("any",...l));for(let h=1;h<u.length;h++)Bw(u[h])}function _p(u){if(!Array.isArray(u))return!1;if((i=u[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let l=1;l<u.length;l++)if(_p(u[l]))return!0;return!1}const DO=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function LO(u,i){return u<i?-1:u>i?1:0}function $w(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let i=1;i<u.length;i++)if($w(u[i]))return!0;return!1}function Rg(u){if(!u)return!0;const i=u[0];return u.length<=1?i!=="any":i==="=="?tu(u[1],u[2],"=="):i==="!="?v_(tu(u[1],u[2],"==")):i==="<"||i===">"||i==="<="||i===">="?tu(u[1],u[2],i):i==="any"?(l=u.slice(1),["any"].concat(l.map(Rg))):i==="all"?["all"].concat(u.slice(1).map(Rg)):i==="none"?["all"].concat(u.slice(1).map(Rg).map(v_)):i==="in"?Vw(u[1],u.slice(2)):i==="!in"?v_(Vw(u[1],u.slice(2))):i==="has"?_j(u[1]):i!=="!has"||v_(_j(u[1]));var l}function tu(u,i,l){switch(u){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,u,i]}}function Vw(u,i){if(i.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",u,["literal",i.sort(LO)]]:["filter-in-small",u,["literal",i]]}}function _j(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function v_(u){return["!",u]}const Mg="";function Kh(u,i){return i?`${u}${Mg}${i}`:u}let Uw;const qw=()=>Uw||(Uw=new Mi({"icon-size":new Kt(Qe.layout_symbol["icon-size"]),"icon-image":new Kt(Qe.layout_symbol["icon-image"]),"icon-rotate":new Kt(Qe.layout_symbol["icon-rotate"]),"icon-offset":new Kt(Qe.layout_symbol["icon-offset"]),"text-size":new Kt(Qe.layout_symbol["text-size"]),"text-rotate":new Kt(Qe.layout_symbol["text-rotate"]),"text-offset":new Kt(Qe.layout_symbol["text-offset"])}));class xj{constructor(i,l,h,m,v,x){const S=$d(i,Qe.appearance.condition);if(S.result==="success"&&(this.condition=S.value),this.name=l,h){this.properties=new lo(qw()),this.unevaluatedLayout=new Lw(qw(),m,v,x);for(const A in h)this.unevaluatedLayout.setValue(A,h[A])}}isActive(i){return!(this.condition||!i.isHidden||this.name!=="hidden")||this.condition.evaluate(i.globals,i.feature,i.featureState,i.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(i){return this.properties.get(i)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(i){return this.unevaluatedLayout._values[i]}recalculate(i,l,h){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(i,void 0,l,h))}serialize(){const i={};return i.condition=this.condition.expression.serialize(),this.name&&(i.name=this.name),this.unevaluatedLayout&&(i.properties=this.unevaluatedLayout.serialize()),i}hasIconProperties(){const i=this.hasProperty("icon-image"),l=this.hasProperty("icon-size"),h=this.hasProperty("icon-offset"),m=this.hasProperty("icon-rotate");return i||l||h||m}hasTextProperties(){const i=this.hasProperty("text-size"),l=this.hasProperty("text-offset"),h=this.hasProperty("text-rotate");return i||l||h}hasProperty(i){return this.getUnevaluatedProperty(i).value!==void 0}}const bj="-transition",wj=new Set(["fill","line","background","hillshade","raster"]);class co extends Du{constructor(i,l,h,m,v,x){if(super(),this.id=i.id,this.fqid=Kh(this.id,h),this.type=i.type,this.scope=h,this.lut=m,this.options=v,this.iconImageUseTheme=x,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const S=$d(this.filter,Qe[`filter_${i.type}`]);S.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...S.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||S.value.isIndoorDependent)}if(i.slot&&(this.slot=i.slot),i.appearances&&this.setAppearances(i.appearances),l.layout&&(this._unevaluatedLayout=new Lw(l.layout,this.scope,v,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),l.paint){this._transitionablePaint=new yp(l.paint,this.scope,v);for(const S in i.paint)this.setPaintProperty(S,i.paint[S]);for(const S in i.layout)this.setLayoutProperty(S,i.layout[S]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lo(l.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&wj.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l){if(this.type==="custom"&&i==="visibility")return void(this.visibility=l);const h=this._unevaluatedLayout;h._properties.properties[i]&&(h.setValue(i,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),i==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(i){this.appearances=[],i.forEach(l=>{this.appearances.push(new xj(l.condition,l.name,l.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(bj)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}isPaintProperty(i){return!!this._transitionablePaint._properties.properties[i]}setPaintProperty(i,l){const h=this._transitionablePaint,m=h._properties.properties;if(i.endsWith(bj)){const L=i.slice(0,-11);return m[L]&&h.setTransition(L,l||void 0),!1}if(!m[i])return!1;const v=h._values[i],x=v.value.isDataDriven(),S=v.value;h.setValue(i,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(i);const A=h._values[i].value,N=A.isDataDriven(),M=i.endsWith("pattern")||i==="line-dasharray";return N||x||M||this._handleOverridablePaintPropertyUpdate(i,S,A)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,l,h){return null}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(i.appearances=this.appearances.map(l=>l.serialize())),Er(i,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Xh&&a_(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}for(const i of this.appearances)if(!bg(i.condition.expression))return!0;return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=zw(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(i,l,h){return{}}queryRadius(i){}queryIntersectsFeature(i,l,h,m,v,x,S,A,N,M){}}const Sj={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wd{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const FO=new ArrayBuffer(0);class hi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(i,l){return i._trim(),l&&i.arrayBuffer&&l.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,i.arrayBuffer?l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement:(l.capacity=0,l.arrayBuffer=FO),l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this._reallocCount++,this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}reserveForAdditional(i){this.reserve(this.length+i)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ln(u,i=1){let l=0,h=0;return{members:u.map(m=>{const v=Sj[m.type].BYTES_PER_ELEMENT,x=l=Tj(l,Math.max(i,v)),S=m.components||1;return h=Math.max(h,v),l+=v*S,{name:m.name,type:m.type,components:S,offset:x}}),size:Tj(l,Math.max(h,i)),alignment:i}}function Tj(u,i){return Math.ceil(u/i)*i}class Hd extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.int16[m+0]=l,this.int16[m+1]=h,i}}Hd.prototype.bytesPerElement=4,ir(Hd,"StructArrayLayout2i4");class $u extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const v=3*i;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=m,i}}$u.prototype.bytesPerElement=6,ir($u,"StructArrayLayout3i6");class Vu extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,m)}emplace(i,l,h,m,v){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=m,this.int16[x+3]=v,i}}Vu.prototype.bytesPerElement=8,ir(Vu,"StructArrayLayout4i8");class aa extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}aa.prototype.bytesPerElement=4,ir(aa,"StructArrayLayout1f4");class xp extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const v=4*i,x=2*i;return this.int16[v+0]=l,this.int16[v+1]=h,this.float32[x+1]=m,i}}xp.prototype.bytesPerElement=8,ir(xp,"StructArrayLayout2i1f8");class Gw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const v=4*i;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=m,i}}Gw.prototype.bytesPerElement=8,ir(Gw,"StructArrayLayout3i8");class Ww extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,m,v)}emplace(i,l,h,m,v,x){const S=5*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=m,this.int16[S+3]=v,this.int16[S+4]=x,i}}Ww.prototype.bytesPerElement=10,ir(Ww,"StructArrayLayout5i10");class Hw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,m,v,x,S)}emplace(i,l,h,m,v,x,S,A){const N=6*i,M=12*i,L=3*i;return this.int16[N+0]=l,this.int16[N+1]=h,this.uint8[M+4]=m,this.uint8[M+5]=v,this.uint8[M+6]=x,this.uint8[M+7]=S,this.float32[L+2]=A,i}}Hw.prototype.bytesPerElement=12,ir(Hw,"StructArrayLayout2i4ub1f12");class Yl extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const v=3*i;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=m,i}}Yl.prototype.bytesPerElement=12,ir(Yl,"StructArrayLayout3f12");class ru extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,m,v)}emplace(i,l,h,m,v,x){const S=6*i,A=3*i;return this.uint16[S+0]=l,this.uint16[S+1]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,this.float32[A+2]=x,i}}ru.prototype.bytesPerElement=12,ir(ru,"StructArrayLayout4ui1f12");class bp extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,m)}emplace(i,l,h,m,v){const x=4*i;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=m,this.uint16[x+3]=v,i}}bp.prototype.bytesPerElement=8,ir(bp,"StructArrayLayout4ui8");class wp extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,m,v,x)}emplace(i,l,h,m,v,x,S){const A=6*i;return this.int16[A+0]=l,this.int16[A+1]=h,this.int16[A+2]=m,this.int16[A+3]=v,this.int16[A+4]=x,this.int16[A+5]=S,i}}wp.prototype.bytesPerElement=12,ir(wp,"StructArrayLayout6i12");class Zw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L,z){const W=this.length;return this.resize(W+1),this.emplace(W,i,l,h,m,v,x,S,A,N,M,L,z)}emplace(i,l,h,m,v,x,S,A,N,M,L,z,W){const H=12*i;return this.int16[H+0]=l,this.int16[H+1]=h,this.int16[H+2]=m,this.int16[H+3]=v,this.uint16[H+4]=x,this.uint16[H+5]=S,this.uint16[H+6]=A,this.uint16[H+7]=N,this.int16[H+8]=M,this.int16[H+9]=L,this.int16[H+10]=z,this.int16[H+11]=W,i}}Zw.prototype.bytesPerElement=24,ir(Zw,"StructArrayLayout4i4ui4i24");class Xw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,m,v,x)}emplace(i,l,h,m,v,x,S){const A=10*i,N=5*i;return this.int16[A+0]=l,this.int16[A+1]=h,this.int16[A+2]=m,this.float32[N+2]=v,this.float32[N+3]=x,this.float32[N+4]=S,i}}Xw.prototype.bytesPerElement=20,ir(Xw,"StructArrayLayout3i3f20");class Zd extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,m)}emplace(i,l,h,m,v){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=m,this.float32[x+3]=v,i}}Zd.prototype.bytesPerElement=16,ir(Zd,"StructArrayLayout4f16");class Kw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Kw.prototype.bytesPerElement=4,ir(Kw,"StructArrayLayout1ul4");class bl extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.uint16[m+0]=l,this.uint16[m+1]=h,i}}bl.prototype.bytesPerElement=4,ir(bl,"StructArrayLayout2ui4");class Dg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L,z,W){const H=this.length;return this.resize(H+1),this.emplace(H,i,l,h,m,v,x,S,A,N,M,L,z,W)}emplace(i,l,h,m,v,x,S,A,N,M,L,z,W,H){const Q=20*i,ne=10*i;return this.int16[Q+0]=l,this.int16[Q+1]=h,this.int16[Q+2]=m,this.int16[Q+3]=v,this.int16[Q+4]=x,this.float32[ne+3]=S,this.float32[ne+4]=A,this.float32[ne+5]=N,this.float32[ne+6]=M,this.int16[Q+14]=L,this.uint32[ne+8]=z,this.uint16[Q+18]=W,this.uint16[Q+19]=H,i}}Dg.prototype.bytesPerElement=40,ir(Dg,"StructArrayLayout5i4f1i1ul2ui40");class __ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,m,v,x,S)}emplace(i,l,h,m,v,x,S,A){const N=8*i;return this.int16[N+0]=l,this.int16[N+1]=h,this.int16[N+2]=m,this.int16[N+4]=v,this.int16[N+5]=x,this.int16[N+6]=S,this.int16[N+7]=A,i}}__.prototype.bytesPerElement=16,ir(__,"StructArrayLayout3i2i2i16");class x_ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,m,v)}emplace(i,l,h,m,v,x){const S=4*i,A=8*i;return this.float32[S+0]=l,this.float32[S+1]=h,this.float32[S+2]=m,this.int16[A+6]=v,this.int16[A+7]=x,i}}x_.prototype.bytesPerElement=16,ir(x_,"StructArrayLayout2f1f2i16");class b_ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,m,v,x)}emplace(i,l,h,m,v,x,S){const A=20*i,N=5*i;return this.uint8[A+0]=l,this.uint8[A+1]=h,this.float32[N+1]=m,this.float32[N+2]=v,this.float32[N+3]=x,this.float32[N+4]=S,i}}b_.prototype.bytesPerElement=20,ir(b_,"StructArrayLayout2ub4f20");class Ps extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,l,h)}emplace(i,l,h,m){const v=3*i;return this.uint16[v+0]=l,this.uint16[v+1]=h,this.uint16[v+2]=m,i}}Ps.prototype.bytesPerElement=6,ir(Ps,"StructArrayLayout3ui6");class Lg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se){const we=this.length;return this.resize(we+1),this.emplace(we,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se)}emplace(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se,we){const Ie=30*i,Oe=15*i,Ne=60*i;return this.int16[Ie+0]=l,this.int16[Ie+1]=h,this.int16[Ie+2]=m,this.float32[Oe+2]=v,this.float32[Oe+3]=x,this.uint16[Ie+8]=S,this.uint16[Ie+9]=A,this.uint32[Oe+5]=N,this.uint32[Oe+6]=M,this.uint32[Oe+7]=L,this.uint16[Ie+16]=z,this.uint16[Ie+17]=W,this.uint16[Ie+18]=H,this.float32[Oe+10]=Q,this.float32[Oe+11]=ne,this.uint8[Ne+48]=te,this.uint8[Ne+49]=le,this.uint8[Ne+50]=de,this.uint32[Oe+13]=pe,this.int16[Ie+28]=Se,this.uint8[Ne+58]=we,i}}Lg.prototype.bytesPerElement=60,ir(Lg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sp extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se,we,Ie,Oe,Ne,Fe,qe,ht,at,ut,bt,_t,xt){const rt=this.length;return this.resize(rt+1),this.emplace(rt,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se,we,Ie,Oe,Ne,Fe,qe,ht,at,ut,bt,_t,xt)}emplace(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se,we,Ie,Oe,Ne,Fe,qe,ht,at,ut,bt,_t,xt,rt){const Tt=20*i,mt=40*i,jt=80*i;return this.float32[Tt+0]=l,this.float32[Tt+1]=h,this.int16[mt+4]=m,this.int16[mt+5]=v,this.int16[mt+6]=x,this.int16[mt+7]=S,this.int16[mt+8]=A,this.int16[mt+9]=N,this.int16[mt+10]=M,this.int16[mt+11]=L,this.int16[mt+12]=z,this.uint16[mt+13]=W,this.uint16[mt+14]=H,this.uint16[mt+15]=Q,this.uint16[mt+16]=ne,this.uint16[mt+17]=te,this.uint16[mt+18]=le,this.uint16[mt+19]=de,this.uint16[mt+20]=pe,this.uint16[mt+21]=Se,this.uint16[mt+22]=we,this.uint16[mt+23]=Ie,this.uint16[mt+24]=Oe,this.uint16[mt+25]=Ne,this.uint16[mt+26]=Fe,this.uint16[mt+27]=qe,this.uint32[Tt+14]=ht,this.float32[Tt+15]=at,this.float32[Tt+16]=ut,this.float32[Tt+17]=bt,this.float32[Tt+18]=_t,this.uint8[jt+76]=xt,this.uint16[mt+39]=rt,i}}Sp.prototype.bytesPerElement=80,ir(Sp,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class w_ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,m,v,x)}emplace(i,l,h,m,v,x,S){const A=6*i;return this.float32[A+0]=l,this.float32[A+1]=h,this.float32[A+2]=m,this.float32[A+3]=v,this.float32[A+4]=x,this.float32[A+5]=S,i}}w_.prototype.bytesPerElement=24,ir(w_,"StructArrayLayout6f24");class Yh extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,m,v)}emplace(i,l,h,m,v,x){const S=5*i;return this.float32[S+0]=l,this.float32[S+1]=h,this.float32[S+2]=m,this.float32[S+3]=v,this.float32[S+4]=x,i}}Yh.prototype.bytesPerElement=20,ir(Yh,"StructArrayLayout5f20");class S_ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,m,v,x,S)}emplace(i,l,h,m,v,x,S,A){const N=7*i;return this.float32[N+0]=l,this.float32[N+1]=h,this.float32[N+2]=m,this.float32[N+3]=v,this.float32[N+4]=x,this.float32[N+5]=S,this.float32[N+6]=A,i}}S_.prototype.bytesPerElement=28,ir(S_,"StructArrayLayout7f28");class Yw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L){const z=this.length;return this.resize(z+1),this.emplace(z,i,l,h,m,v,x,S,A,N,M,L)}emplace(i,l,h,m,v,x,S,A,N,M,L,z){const W=11*i;return this.float32[W+0]=l,this.float32[W+1]=h,this.float32[W+2]=m,this.float32[W+3]=v,this.float32[W+4]=x,this.float32[W+5]=S,this.float32[W+6]=A,this.float32[W+7]=N,this.float32[W+8]=M,this.float32[W+9]=L,this.float32[W+10]=z,i}}Yw.prototype.bytesPerElement=44,ir(Yw,"StructArrayLayout11f44");class Fg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,h,m,v,x,S,A,N)}emplace(i,l,h,m,v,x,S,A,N,M){const L=9*i;return this.float32[L+0]=l,this.float32[L+1]=h,this.float32[L+2]=m,this.float32[L+3]=v,this.float32[L+4]=x,this.float32[L+5]=S,this.float32[L+6]=A,this.float32[L+7]=N,this.float32[L+8]=M,i}}Fg.prototype.bytesPerElement=36,ir(Fg,"StructArrayLayout9f36");class Jh extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const m=2*i;return this.float32[m+0]=l,this.float32[m+1]=h,i}}Jh.prototype.bytesPerElement=8,ir(Jh,"StructArrayLayout2f8");class Jw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,h,m)}emplace(i,l,h,m,v){const x=6*i;return this.uint32[3*i+0]=l,this.uint16[x+2]=h,this.uint16[x+3]=m,this.uint16[x+4]=v,i}}Jw.prototype.bytesPerElement=12,ir(Jw,"StructArrayLayout1ul3ui12");class zg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}zg.prototype.bytesPerElement=2,ir(zg,"StructArrayLayout1ui2");class Qw extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne){const te=this.length;return this.resize(te+1),this.emplace(te,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne)}emplace(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te){const le=16*i;return this.float32[le+0]=l,this.float32[le+1]=h,this.float32[le+2]=m,this.float32[le+3]=v,this.float32[le+4]=x,this.float32[le+5]=S,this.float32[le+6]=A,this.float32[le+7]=N,this.float32[le+8]=M,this.float32[le+9]=L,this.float32[le+10]=z,this.float32[le+11]=W,this.float32[le+12]=H,this.float32[le+13]=Q,this.float32[le+14]=ne,this.float32[le+15]=te,i}}Qw.prototype.bytesPerElement=64,ir(Qw,"StructArrayLayout16f64");class Bg extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,m,v,x,S){const A=this.length;return this.resize(A+1),this.emplace(A,i,l,h,m,v,x,S)}emplace(i,l,h,m,v,x,S,A){const N=10*i,M=5*i;return this.uint16[N+0]=l,this.uint16[N+1]=h,this.uint16[N+2]=m,this.uint16[N+3]=v,this.float32[M+2]=x,this.float32[M+3]=S,this.float32[M+4]=A,i}}Bg.prototype.bytesPerElement=20,ir(Bg,"StructArrayLayout4ui3f20");class e1 extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.int16[1*i+0]=l,i}}e1.prototype.bytesPerElement=2,ir(e1,"StructArrayLayout1i2");class T_ extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint8[1*i+0]=l,i}}T_.prototype.bytesPerElement=1,ir(T_,"StructArrayLayout1ub1");class Ej extends Wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ej.prototype.size=40;class jj extends Dg{get(i){return new Ej(this,i)}}ir(jj,"CollisionBoxArray");class Aj extends Wd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Aj.prototype.size=60;class Cj extends Lg{get(i){return new Aj(this,i)}}ir(Cj,"PlacedSymbolArray");class Pj extends Wd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Pj.prototype.size=80;class Nj extends Sp{get(i){return new Pj(this,i)}}ir(Nj,"SymbolInstanceArray");class $g extends aa{getoffsetX(i){return this.float32[1*i+0]}}ir($g,"GlyphOffsetArray");class Ij extends Hd{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}ir(Ij,"SymbolLineVertexArray");class kj extends Wd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kj.prototype.size=12;class Vg extends Jw{get(i){return new kj(this,i)}}ir(Vg,"FeatureIndexArray");class Oj extends bl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}ir(Oj,"FillExtrusionCentroidArray");class t1 extends Wd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}t1.prototype.size=6;class Rj extends $u{get(i){return new t1(this,i)}}ir(Rj,"FillExtrusionWallArray");const Mj=ln([{name:"a_pos",components:2,type:"Int16"}],4),Dj=ln([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Lj=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bi{constructor(i=[]){this.segments=i}_prepareSegment(i,l,h,m){let v=this.segments[this.segments.length-1];return i>bi.MAX_VERTEX_ARRAY_LENGTH&&Nr(`Max vertices per segment is ${bi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!v||v.vertexLength+i>bi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:l,primitiveOffset:h,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}prepareSegment(i,l,h,m){return this._prepareSegment(i,l.length,h.length,m)}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,m){return new bi([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function Fj(u,i){return 256*(u=Pe(Math.floor(u),0,255))+Pe(Math.floor(i),0,255)}bi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ir(bi,"SegmentVector");const zj=ln([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zO=ln([{name:"a_pattern_b",components:4,type:"Uint16"}]),BO=ln([{name:"a_dash",components:4,type:"Uint16"}]);class Ug{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,l,h,m){this.ids.push(Bj(i)),this.positions.push(l,h,m)}eachPosition(i,l){const h=Bj(i);let m=0,v=this.ids.length-1;for(;m<v;){const x=m+v>>1;this.ids[x]>=h?v=x:m=x+1}for(;this.ids[m]===h;)l(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(i,l){const h=new Float64Array(i.ids),m=new Uint32Array(i.positions);return r1(h,m,0,h.length-1),l&&(l.add(h.buffer),l.add(m.buffer)),{ids:h,positions:m}}static deserialize(i){const l=new Ug;let h;l.ids=i.ids,l.positions=i.positions;for(const m of l.ids)m!==h&&l.uniqueIds.push(m),h=m;return l.indexed=!0,l}}function Bj(u){const i=+u;return Number.isSafeInteger(i)?i:Qf(String(u))}function r1(u,i,l,h){for(;l<h;){const m=u[l+h>>1];let v=l-1,x=h+1;for(;;){do v++;while(u[v]<m);do x--;while(u[x]>m);if(v>=x)break;qg(u,v,x),qg(i,3*v,3*x),qg(i,3*v+1,3*x+1),qg(i,3*v+2,3*x+2)}x-l<h-x?(r1(u,i,l,x),l=x+1):(r1(u,i,x+1,h),h=x)}}function qg(u,i,l){const h=u[i];u[i]=u[l],u[l]=h}ir(Ug,"FeaturePositionMap");class vc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,l),this.initialized=!0),!!this.location}set(i,l,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wl extends vc{constructor(i){super(i),this.current=0}set(i,l,h){this.fetchUniformLocation(i,l)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ps extends vc{constructor(i){super(i),this.current=0}set(i,l,h){this.fetchUniformLocation(i,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Sl extends vc{constructor(i){super(i),this.current=[0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Gg extends vc{constructor(i){super(i),this.current=[0,0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class E_ extends vc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class $j extends vc{constructor(i){super(i),this.current=Dn.transparent.toPremultipliedRenderColor(null)}set(i,l,h){this.fetchUniformLocation(i,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const $O=new Float32Array(16);class Tp extends vc{constructor(i){super(i),this.current=$O}set(i,l,h){if(this.fetchUniformLocation(i,l)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let m=1;m<16;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const J$=new Float32Array(9),g=new Float32Array(4);class o extends vc{constructor(i){super(i),this.current=g}set(i,l,h){if(this.fetchUniformLocation(i,l)){for(let m=0;m<4;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function f(u){return[Fj(255*u.r,255*u.g),Fj(255*u.b,255*u.a)]}function y(u,i,l,h,m,v,x,S){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Wn(0,{brightness:v,worldview:S}),i,l,m,h,x)==="none":u.value==="none")}class w{constructor(i,l,h,m){this.value=i,this.uniformNames=l.map(v=>`u_${v}`),this.type=h,this.context=m}setUniform(i,l,h,m,v){const x=m.constantOr(this.value);l.set(i,v,x instanceof Dn?x.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(i,l){return this.type==="color"?new $j(i):new ps(i)}}class E{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,l){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(i,l,h,m,v){let x=null;v!=="u_pattern"&&v!=="u_dash"||(x=this.pattern),v==="u_pattern_b"&&(x=this.patternTransition),v==="u_pixel_ratio"&&(x=this.pixelRatio),x&&l.set(i,v,x)}getBinding(i,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new E_(i):new ps(i)}}class j{constructor(i,l,h,m){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,l,h,m,v,x,S,A){const N=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Wn(0,{brightness:x,worldview:A}),l,{},v,m,S):this.expression.kind==="constant"&&this.expression.value,L=y(this.lutExpression,l,{},m,v,x,S,A);this.paintVertexArray.resize(i),this._setPaintValue(N,i,M,L?null:this.context.lut)}updatePaintArray(i,l,h,m,v,x,S,A){const N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:A},h,m,void 0,v):this.expression.kind==="constant"&&this.expression.value,M=y(this.lutExpression,h,m,v,void 0,S,void 0,A);this._setPaintValue(i,l,N,M?null:this.context.lut)}_setPaintValue(i,l,h,m){if(this.type==="color"){const v=f(h.toPremultipliedRenderColor(m));for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,v[0],v[1])}else{for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class I{constructor(i,l,h,m,v,x){this.expression=i,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=m,this.context=v,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,h,m,v,x,S,A){const N=this.expression.evaluate(new Wn(this.context.zoom,{brightness:x,worldview:A}),l,{},v,m,S),M=this.expression.evaluate(new Wn(this.context.zoom+1,{brightness:x,worldview:A}),l,{},v,m,S),L=y(this.lutExpression,l,{},m,v,x,S,A),z=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(z,i,N,M,L?null:this.context.lut)}updatePaintArray(i,l,h,m,v,x,S,A){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:A},h,m,void 0,v),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:A},h,m,void 0,v),L=y(this.lutExpression,h,m,v,void 0,S,void 0,A);this._setPaintValue(i,l,N,M,L?null:this.context.lut)}_setPaintValue(i,l,h,m,v){if(this.type==="color"){const x=f(h.toPremultipliedRenderColor(v)),S=f(m.toPremultipliedRenderColor(v));for(let A=i;A<l;A++)this.paintVertexArray.emplace(A,x[0],x[1],S[0],S[1])}else{for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l,h,m,v){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,S=Pe(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);l.set(i,v,S)}getBinding(i,l){return new ps(i)}}class O{constructor(i,l,h,m,v){this.expression=i,this.layerId=v,this.paintVertexAttributes=(h==="array"?BO:zj).members;for(let x=0;x<l.length;++x);this.paintVertexArray=new m,this.paintTransitionVertexArray=new bp}populatePaintArray(i,l,h,m){const v=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(v,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,m,v,x,S){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(i,l,h,m){if(!m||!h)return;const v=m[h[0]],x=m[h[1]];if(v){if(v){const{tl:S,br:A,pixelRatio:N}=v;for(let M=i;M<l;M++)this.paintVertexArray.emplace(M,S[0],S[1],A[0],A[1],N)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:A}=x;for(let N=i;N<l;N++)this.paintTransitionVertexArray.emplace(N,S[0],S[1],A[0],A[1])}}}upload(i){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,zO.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class U{constructor(i,l,h=()=>!0){this.binders={},this._buffers=[],this.context=l;const m=[];for(const v in i.paint._values){const x=i.paint.get(v);if(v.endsWith("-use-theme")||!h(v)||!(x instanceof Xh&&a_(x.property.specification)))continue;const S=Z(v,i.type),A=x.value,N=x.property.specification.type,M=!!x.property.useIntegerZoom,L=v==="line-dasharray"||v.endsWith("pattern"),z=i.paint.get(`${v}-use-theme`),W=v==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(A.kind!=="constant"||W)if(A.kind==="source"||W||L){const H=re(v,N,"source");this.binders[v]=L?new O(A,S,N,H,i.id):new j(A,S,N,H),m.push(`/a_${v}`)}else{const H=re(v,N,"composite");this.binders[v]=new I(A,S,N,M,l,H),m.push(`/z_${v}`)}else this.binders[v]=L?new E(A.value,S):new w(A.value,S,N,l),m.push(`/u_${v}`);z&&(this.binders[v].lutExpression=z.value)}this.cacheKey=m.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof j||l instanceof I?l.maxValue:0}populatePaintArrays(i,l,h,m,v,x,S,A){for(const N in this.binders){const M=this.binders[N];M.context=this.context,(M instanceof j||M instanceof I||M instanceof O)&&M.populatePaintArray(i,l,h,m,v,x,S,A)}}setConstantPatternPositions(i,l){for(const h in this.binders){const m=this.binders[h];m instanceof E&&m.setConstantPatternPositions(i,l)}}getPatternTransitionVertexBuffer(i){const l=this.binders[i];return l instanceof O?l.paintTransitionVertexBuffer:null}updatePaintArrays(i,l,h,m,v,x,S,A,N,M){let L=!1;const z=Object.keys(i),W=z.length!==0&&!A,H=W?z:l.uniqueIds;this.context.lut=v.lut;for(const Q in this.binders){const ne=this.binders[Q];if(ne.context=this.context,(ne instanceof j||ne instanceof I||ne instanceof O)&&ne.expression&&ne.expression.kind&&ne.expression.kind!=="constant"&&(ne.expression.isStateDependent===!0||ne.expression.isLightConstant===!1)){const te=v.paint.get(Q);ne.expression=te.value;for(const le of H){const de=i[le.toString()];l.eachPosition(le,(pe,Se,we)=>{const Ie=m.feature(pe);ne.updatePaintArray(Se,we,Ie,de,x,S,N,M)})}if(!W)for(const le of h.uniqueIds){const de=i[le.toString()];h.eachPosition(le,(pe,Se,we)=>{const Ie=m.feature(pe);ne.updatePaintArray(Se,we,Ie,de,x,S,N,M)})}L=!0}}return L}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof w||h instanceof E)&&i.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof w||m instanceof E||m instanceof I)for(const v of m.uniformNames)l.push({name:v,property:h,binding:m.getBinding(i,v)})}return l}setUniforms(i,l,h,m,v){for(const{name:x,property:S,binding:A}of h)this.binders[S].setUniform(i,A,v,m.get(S),x)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const l=this.binders[i];(l instanceof j||l instanceof I||l instanceof O)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof O&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof j||h instanceof I||h instanceof O)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof j||l instanceof I||l instanceof O)&&l.destroy()}}}class q{constructor(i,l,h=()=>!0){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new U(m,l,h);this.needsUpload=!1,this._featureMap=new Ug,this._featureMapWithoutIds=new Ug,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,l,h,m,v,x,S,A,N){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,l,m,v,x,S,A,N);l.id!==void 0?this._featureMap.add(l.id,h,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,m,v,x,S,A){for(const N of h)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,l,N,m,v,x,S||0,A)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const X={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Z(u,i){return X[u]||[u.replace(`${i}-`,"").replace(/-/g,"_")]}const J={"line-pattern":{source:ru,composite:ru},"fill-pattern":{source:ru,composite:ru},"fill-extrusion-pattern":{source:ru,composite:ru},"line-dasharray":{source:bp,composite:bp}},se={color:{source:Jh,composite:Zd},number:{source:aa,composite:Jh}};function re(u,i,l){const h=J[u];return h&&h[l]||se[i][l]}ir(w,"ConstantBinder"),ir(E,"PatternConstantBinder"),ir(j,"SourceExpressionBinder"),ir(O,"PatternCompositeBinder"),ir(I,"CompositeExpressionBinder"),ir(U,"ProgramConfiguration",{omit:["_buffers"]}),ir(q,"ProgramConfigurationSet");const oe=Wt/Math.PI/2,he=64,xe=[he,32,16],_e=-oe,ye=oe;function Le(u,i,l,h=oe){return l=_n(l),[u*Math.sin(l)*h,-i*h,u*Math.cos(l)*h]}function ke(u,i,l){return Le(Math.cos(_n(u)),Math.sin(_n(u)),i,l)}const Re=63710088e-1,Ae=2*Math.PI*Re;class Te{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Te(nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,m=i.lat*l,v=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((i.lng-this.lng)*l);return Re*Math.acos(Math.min(v,1))}toBounds(i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new $e({lng:this.lng-h,lat:this.lat-l},{lng:this.lng+h,lat:this.lat+l})}toEcef(i){return ke(this.lat,this.lng,oe+i*oe/Re)}static convert(i){if(i instanceof Te)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Te(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Te(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class $e{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):Array.isArray(i)&&i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Te?new Te(i.lng,i.lat):Te.convert(i),this}setSouthWest(i){return this._sw=i instanceof Te?new Te(i.lng,i.lat):Te.convert(i),this}extend(i){const l=this._sw,h=this._ne;let m,v;if(i instanceof Te)m=i,v=i;else{if(!(i instanceof $e))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend($e.convert(i)):this.extend(Te.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(Te.convert(i)):this;if(m=i._sw,v=i._ne,!m||!v)return this}return l||h?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),h.lng=Math.max(v.lng,h.lng),h.lat=Math.max(v.lat,h.lat)):(this._sw=new Te(m.lng,m.lat),this._ne=new Te(v.lng,v.lat)),this}getCenter(){return new Te((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Te(this.getWest(),this.getNorth())}getSouthEast(){return new Te(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:h}=Te.convert(i);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(i){if(i)return i instanceof $e?i:new $e(i)}}function Ze(u){return Ae*Math.cos(u*Math.PI/180)}function Ye(u){return(180+u)/360}function it(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function tt(u,i){return u/Ze(i)}function vt(u){return 360*u-180}function At(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function et(u,i){return u*Ze(At(i))}const Ue=85.051129;function ft(u){return Math.cos(_n(Pe(u,-85.051129,Ue)))}function st(u,i){const l=Pe(i,0,25.5),h=Math.pow(2,l);return ft(u)*Ae/(512*h)}function It(u){return 1/Math.cos(u*Math.PI/180)}function Mt(u,i=0){const l=Math.exp(Math.PI*(1-(u.y+i/Wt)/(1<<u.z)*2));return 80150034*l/(l*l+1)/Wt/(1<<u.z)}class Zt{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=Te.convert(i);return new Zt(Ye(h.lng),it(h.lat),tt(l,h.lat))}toLngLat(){return new Te(vt(this.x),At(this.y))}toAltitude(){return et(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ae*It(At(this.y))}}function Dt(u,i,l,h,m,v,x,S,A){const N=(i+h)/2,M=(l+m)/2,L=new kt(N,M);S(L),function(z,W,H,Q,ne,te){const le=H-ne,de=Q-te;return Math.abs((Q-W)*le-(H-z)*de)/Math.hypot(le,de)}(L.x,L.y,v.x,v.y,x.x,x.y)>=A?(Dt(u,i,l,N,M,v,L,S,A),Dt(u,N,M,h,m,L,x,S,A)):u.push(x)}function $t(u,i,l){let h=u[0],m=h.x,v=h.y;i(h);const x=[h];for(let S=1;S<u.length;S++){const A=u[S],{x:N,y:M}=A;i(A),Dt(x,m,v,N,M,h,A,i,l),m=N,v=M,h=A}return x}function lr(u,i,l,h){if(h(i,l)){const m=i.add(l)._mult(.5);lr(u,i,m,h),lr(u,m,l,h)}else u.push(l)}function or(u,i){let l=u[0];const h=[l];for(let m=1;m<u.length;m++){const v=u[m];lr(h,l,v,i),l=v}return h}const Jt=Math.pow(2,14)-1,sr=-Jt-1;function vr(u,i){const l=Math.round(u.x*i),h=Math.round(u.y*i);return u.x=Pe(l,sr,Jt),u.y=Pe(h,sr,Jt),(l<u.x||l>u.x+1||h<u.y||h>u.y+1)&&Nr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Cr(u,i,l){const h=u.loadGeometry(),m=u.extent,v=Wt/m;if(i&&l&&l.projection.isReprojectedInTileSpace){const x=1<<i.z,{scale:S,x:A,y:N,projection:M}=l,L=z=>{const W=vt((i.x+z.x/m)/x),H=At((i.y+z.y/m)/x),Q=M.project(W,H);z.x=(Q.x*S-A)*m,z.y=(Q.y*S-N)*m};for(let z=0;z<h.length;z++)if(u.type!==1)h[z]=$t(h[z],L,1);else{const W=[];for(const H of h[z])H.x<0||H.x>=m||H.y<0||H.y>=m||(L(H),W.push(H));h[z]=W}}for(const x of h)for(const S of x)vr(S,v);return h}function Gr(u,i){return{type:u.type,id:u.id,properties:u.properties,geometry:i?Cr(u):[]}}class un{constructor(i,l,h,m,v){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=m,this._values=v,i.readFields(Mr,this,l)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const l=i.readVarint()+i.pos,h=[];let m,v=1,x=0,S=0,A=0;for(;i.pos<l;){if(x<=0){const N=i.readVarint();v=7&N,x=N>>3}if(x--,v===1||v===2)S+=i.readSVarint(),A+=i.readSVarint(),v===1&&(m&&h.push(m),m=[]),m&&m.push(new kt(S,A));else{if(v!==7)throw new Error(`unknown command ${v}`);m&&m.push(m[0].clone())}}return m&&h.push(m),h}bbox(){const i=this._pbf;i.pos=this._geometry;const l=i.readVarint()+i.pos;let h=1,m=0,v=0,x=0,S=1/0,A=-1/0,N=1/0,M=-1/0;for(;i.pos<l;){if(m<=0){const L=i.readVarint();h=7&L,m=L>>3}if(m--,h===1||h===2)v+=i.readSVarint(),x+=i.readSVarint(),v<S&&(S=v),v>A&&(A=v),x<N&&(N=x),x>M&&(M=x);else if(h!==7)throw new Error(`unknown command ${h}`)}return[S,N,A,M]}toGeoJSON(i,l,h){const m=this.extent*Math.pow(2,h),v=this.extent*i,x=this.extent*l,S=this.loadGeometry();function A(z){return[360*(z.x+v)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+x)/m)*Math.PI))-90]}function N(z){return z.map(A)}let M;if(this.type===1){const z=[];for(const H of S)z.push(H[0]);const W=N(z);M=z.length===1?{type:"Point",coordinates:W[0]}:{type:"MultiPoint",coordinates:W}}else if(this.type===2){const z=S.map(N);M=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=function(H){const Q=H.length;if(Q<=1)return[H];const ne=[];let te,le;for(let de=0;de<Q;de++){const pe=xn(H[de]);pe!==0&&(le===void 0&&(le=pe<0),le===pe<0?(te&&ne.push(te),te=[H[de]]):te&&te.push(H[de]))}return te&&ne.push(te),ne}(S),W=[];for(const H of z)W.push(H.map(N));M=W.length===1?{type:"Polygon",coordinates:W[0]}:{type:"MultiPolygon",coordinates:W}}}const L={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function Mr(u,i,l){u===1?i.id=l.readVarint():u===2?function(h,m){const v=h.readVarint()+h.pos;for(;h.pos<v;){const x=m._keys[h.readVarint()],S=m._values[h.readVarint()];m.properties[x]=S}}(l,i):u===3?i.type=l.readVarint():u===4&&(i._geometry=l.pos)}function xn(u){let i=0;for(let l,h,m=0,v=u.length,x=v-1;m<v;x=m++)l=u[m],h=u[x],i+=(h.x-l.x)*(l.y+h.y);return i}un.types=["Unknown","Point","LineString","Polygon"];class Br{constructor(i,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields($n,this,l),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const l=this._pbf.readVarint()+this._pbf.pos;return new un(this._pbf,l,this.extent,this._keys,this._values)}}function $n(u,i,l){u===15?i.version=l.readVarint():u===1?i.name=l.readString():u===5?i.extent=l.readVarint():u===2?i._features.push(l.pos):u===3?i._keys.push(l.readString()):u===4&&i._values.push(function(h){let m=null;const v=h.readVarint()+h.pos;for(;h.pos<v;){const x=h.readVarint()>>3;m=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}if(m==null)throw new Error("unknown feature value");return m}(l))}class Ln{constructor(i,l){this.layers=i.readFields(Un,{},l)}}function Un(u,i,l){if(u===3){const h=new Br(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}const hn="3d_elevation_id",Vr="level";class An{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,l){return this._valid&&i(l(this._geometry)),this}require(i,l,h){return this.get(i,!0,l,h)}optional(i,l,h){return this.get(i,!1,l,h)}success(){return this._valid}get(i,l,h,m){const v=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&v!==void 0&&!Number.isNaN(v)?h(m?m(v):v):l&&(this._valid=!1),this}}class wi{constructor(i,l){this.featureFunc=i,this.vertexFunc=l}parseFeature(i,l,h){return this.featureFunc(i,l,h)}parseVertex(i,l,h){return this.vertexFunc(i,l,h)}}const Si=new wi((u,i,l)=>u.reset(i).require(hn,h=>{l.id=h}).optional("fixed_height_relative",h=>{l.constantHeight=h},an.decodeRelativeHeight).geometry(h=>{l.bounds=h},vg).success(),(u,i,l)=>u.reset(i).require(hn,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height_relative",h=>{l.height=h},an.decodeRelativeHeight).geometry(h=>{l.position=h},an.getPoint).success()),Cn=new wi((u,i,l)=>u.reset(i).require(hn,h=>{l.id=h}).optional("fixed_height",h=>{l.constantHeight=h},an.decodeMetricHeight).geometry(h=>{l.bounds=h},vg).success(),(u,i,l)=>u.reset(i).require(hn,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height",h=>{l.height=h},an.decodeMetricHeight).geometry(h=>{l.position=h},an.getPoint).success());class an{static getPoint(i){return ga(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static getVersionSchema(i){return i?i==="1.0.1"?Cn:void 0:Si}static parse(i){const l=[],h=[],m=i.length,v=new An;for(let x=0;x<m;x++){const S=i.feature(x),A=S.properties.version,N=an.getVersionSchema(A);if(N===void 0){Nr(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const M=S.properties.type;if(!M)continue;const L=un.types[S.type];if(L==="Point"&&M==="curve_point"){const z={};N.parseVertex(v,S,z)&&l.push(z)}else if(L==="Polygon"&&M==="curve_meta"){const z={};N.parseFeature(v,S,z)&&h.push(z)}}return{vertices:l,features:h}}}class Ur{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,h){const m=Gn(l,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1])/m;return h[0]=this.pos[0]+this.dir[0]*v,h[1]=this.pos[1]+this.dir[1]*v,!0}}class si{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,h){const m=nr(l,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1]+(i[2]-this.pos[2])*l[2])/m;return h[0]=this.pos[0]+this.dir[0]*v,h[1]=this.pos[1]+this.dir[1]*v,h[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(i,l,h){if(function(W,H){var Q=W[0],ne=W[1],te=W[2],le=H[0],de=H[1],pe=H[2];return Math.abs(Q-le)<=_*Math.max(1,Math.abs(Q),Math.abs(le))&&Math.abs(ne-de)<=_*Math.max(1,Math.abs(ne),Math.abs(de))&&Math.abs(te-pe)<=_*Math.max(1,Math.abs(te),Math.abs(pe))}(this.pos,i)||l===0)return h[0]=h[1]=h[2]=0,!1;const[m,v,x]=this.dir,S=this.pos[0]-i[0],A=this.pos[1]-i[1],N=this.pos[2]-i[2],M=m*m+v*v+x*x,L=2*(S*m+A*v+N*x),z=L*L-4*M*(S*S+A*A+N*N-l*l);if(z<0){const W=Math.max(-L/2,0),H=S+m*W,Q=A+v*W,ne=N+x*W,te=Math.hypot(H,Q,ne);return h[0]=H*l/te,h[1]=Q*l/te,h[2]=ne*l/te,!1}{const W=(-L-Math.sqrt(z))/(2*M);if(W<0){const H=Math.hypot(S,A,N);return h[0]=S*l/H,h[1]=A*l/H,h[2]=N*l/H,!1}return h[0]=S+m*W,h[1]=A+v*W,h[2]=N+x*W,!0}}}class Di{constructor(i,l,h,m,v){this.TL=i,this.TR=l,this.BR=h,this.BL=m,this.horizon=v}static fromInvProjectionMatrix(i,l,h){const m=[-1,1,1],v=[1,1,1],x=[1,-1,1],S=[-1,-1,1],A=pr(m,m,i),N=pr(v,v,i),M=pr(x,x,i),L=pr(S,S,i);return new Di(A,N,M,L,l/h)}}function ci(u,i,l){let h=1/0,m=-1/0;const v=[];for(const x of u){zn(v,x,i);const S=nr(v,l);h=Math.min(h,S),m=Math.max(m,S)}return[h,m]}function fi(u,i){let l=!0;for(let h=0;h<u.planes.length;h++){const m=u.planes[h];let v=0;for(let x=0;x<i.length;x++)v+=+(nr(m,i[x])+m[3]>=0);if(v===0)return 0;v!==i.length&&(l=!1)}return l?2:1}function uo(u,i){for(const l of u.projections){const h=ci(i,u.points[0],l.axis);if(l.projection[1]<h[0]||l.projection[0]>h[1])return 0}return 1}function No(u,i){let l=0;const h=[0,0,0,0];for(let m=0;m<u.length;m++)h[0]=u[m][0],h[1]=u[m][1],h[2]=u[m][2],h[3]=1,yr(h,i)>=0&&l++;return l}class Hs{constructor(i,l){this.points=i||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=Pn.fromPoints(this.points),this.projections=[],this.frustumEdges=[zn([],this.points[2],this.points[3]),zn([],this.points[0],this.points[3]),zn([],this.points[4],this.points[0]),zn([],this.points[5],this.points[1]),zn([],this.points[6],this.points[2]),zn([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const m=[0,-h[2],h[1]],v=[h[2],0,-h[0]];this.projections.push({axis:m,projection:ci(this.points,this.points[0],m)}),this.projections.push({axis:v,projection:ci(this.points,this.points[0],v)})}}static fromInvProjectionMatrix(i,l,h,m){const v=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const M=hr([],N,i),L=1/M[3]/l*v;return(z=M)[0]=(W=M)[0]*(H=[L,L,m?1/M[3]:L,L])[0],z[1]=W[1]*H[1],z[2]=W[2]*H[2],z[3]=W[3]*H[3],z;var z,W,H}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const M=Ot([],ur([],zn([],x[N[0]],x[N[1]]),zn([],x[N[2]],x[N[1]]))),L=-nr(M,x[N[1]]);return M.concat(L)}),A=[];for(let N=0;N<x.length;N++)A.push([x[N][0],x[N][1],x[N][2]]);return new Hs(A,S)}intersectsPrecise(i,l,h){for(let m=0;m<l.length;m++)if(!No(i,l[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!No(i,this.planes[m]))return 0;for(const m of h)for(const v of this.frustumEdges){const x=ur([],m,v),S=ze(x);if(S===0)continue;Je(x,x,1/S);const A=ci(this.points,this.points[0],x),N=ci(i,this.points[0],x);if(A[0]>N[1]||N[0]>A[1])return 0}return 1}containsPoint(i){for(const l of this.planes){const h=l[3];if(nr([l[0],l[1],l[2]],i)+h<0)return!1}return!0}}class Pn{static fromPoints(i){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const m of i)ot(l,l,m),yt(h,h,m);return new Pn(l,h)}static fromTileIdAndHeight(i,l,h){const m=1<<i.canonical.z,v=i.canonical.x,x=i.canonical.y;return new Pn([v/m,x/m,l],[(v+1)/m,(x+1)/m,h])}static applyTransform(i,l){const h=i.getCorners();for(let m=0;m<h.length;++m)pr(h[m],h[m],l);return Pn.fromPoints(h)}static applyTransformFast(i,l){const h=[l[12],l[13],l[14]],m=[...h];for(let v=0;v<3;v++)for(let x=0;x<3;x++){const S=l[4*x+v],A=S*i.min[x],N=S*i.max[x];h[v]+=Math.min(A,N),m[v]+=Math.max(A,N)}return new Pn(h,m)}static projectAabbCorners(i,l){const h=i.getCorners();for(let m=0;m<h.length;++m)pr(h[m],h[m],l);return h}constructor(i,l){this.min=i,this.max=l,this.center=Je([],Ve([],this.min,this.max),.5)}quadrant(i){const l=[i%2==0,i<2],h=ve(this.min),m=ve(this.max);for(let v=0;v<l.length;v++)h[v]=l[v]?this.min[v]:this.center[v],m[v]=l[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Pn(h,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,l=this.max;return[[i[0],i[1],i[2]],[l[0],i[1],i[2]],[l[0],l[1],i[2]],[i[0],l[1],i[2]],[i[0],i[1],l[2]],[l[0],i[1],l[2]],[l[0],l[1],l[2]],[i[0],l[1],l[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?fi(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?fi(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,l){return l||this.intersects(i)?uo(i,this.getCorners()):0}intersectsPreciseFlat(i,l){return l||this.intersectsFlat(i)?uo(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let l=0;l<3;++l)if(this.min[l]>i.max[l]||i.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],i.min[l]),this.max[l]=Math.max(this.max[l],i.max[l])}encapsulatePoint(i){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],i[l]),this.max[l]=Math.max(this.max[l],i[l])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}ir(Pn,"Aabb");class Zo{constructor(i,l){this.feature=i,this.metersToTile=l,this.index=0}get(){const i=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,h=l[1],m=-l[0],v=(i.extent+1)*this.metersToTile;return[new kt(Math.trunc(i.position[0]+h*v),Math.trunc(i.position[1]+m*v)),new kt(Math.trunc(i.position[0]-h*v),Math.trunc(i.position[1]-m*v))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class va{constructor(i,l,h,m,v,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[js(),js(),js(),js(),js(),js(),js()],this.id=i,this.heightRange={min:h,max:h},this.safeArea=l,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=v,this.edges=this.edges.filter(S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((A=this.vertices[S.a].position)[0]===(N=this.vertices[S.b].position)[0]&&A[1]===N[1]);var A,N}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:ga(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const A=this.vertices[S.a].position,N=this.vertices[S.b].position,M=Wl(js(),N,A),L=Wc(M),z=pc(js(),M,1/L);this.edgeProps.push({vec:M,dir:z,len:L});const W=this.vertexProps[S.a].dir,H=this.vertexProps[S.b].dir;ml(W,W,z),ml(H,H,z)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||Hc(S.dir,S.dir);this.tessellate(x)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(i);if(l==null)return 0;const[h,m]=l;return jr(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,m)}computeSlopeNormal(i,l){const h=this.getClosestEdge(i);if(!h)return Me(0,0,1);const m=h[0],v=this.edges[m],x=this.edgeProps[m].vec,S=Me(x[0],x[1],(this.vertices[v.b].height-this.vertices[v.a].height)*l),A=Me(S[1],-S[0],0);ur(A,A,S);const N=ze(A);return N>0?Je(A,A,1/N):Be(A,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let l=0,h=Number.POSITIVE_INFINITY,m=0;const[v,x,S,A,N,M,L]=this._tmpVec2;pl(L,i.x,i.y);const z=new Ur(L,null);for(let W=0;W<this.edges.length;W++){const H=this.edges[W],Q=this.edgeProps[W].dir;z.dir=Q;const ne=this.vertices[H.a].position,te=this.vertices[H.b].position,le=z.intersectsPlane(ne,this.vertexProps[H.a].dir,v),de=z.intersectsPlane(te,this.vertexProps[H.b].dir,x);if(!le||!de)continue;Wl(S,x,v),Wl(A,L,v);const pe=Gn(S,S),Se=pe>0?Gn(A,S)/pe:0,we=Pe(Se,0,1),Ie=Math.abs((Se-we)*this.edgeProps[W].len);Wl(N,L,ne),pl(M,Q[1],-Q[0]);const Oe=Ie+Math.abs(Gn(N,M));Oe<h&&(l=W,h=Oe,m=we)}return[l,m]}tessellate(i){const l=Ce(),h=Ce(),m=Ce(),v=Ce();for(let x=this.edges.length-1;x>=0;--x){const S=this.edges[x].a,A=this.edges[x].b,{position:N,height:M,extent:L}=this.vertices[S],{position:z,height:W,extent:H}=this.vertices[A],Q=this.vertexProps[S].dir,ne=this.vertexProps[A].dir;if(Be(l,N[0]/i,N[1]/i,M),Be(h,z[0]/i,z[1]/i,W),Be(m,Q[1],-Q[0],0),Je(m,m,L),Be(v,ne[1],-ne[0],0),Je(v,v,H),this.distSqLines(Me(l[0]+.5*m[0],l[1]+.5*m[1],l[2]+.5*m[2]),Me(h[0]-.5*v[0],h[1]-.5*v[1],h[2]-.5*v[2]),Me(l[0]-.5*m[0],l[1]-.5*m[1],l[2]-.5*m[2]),Me(h[0]+.5*v[0],h[1]+.5*v[1],h[2]+.5*v[2]))<=.0025000000000000005)continue;const te=this.vertices.length,le=ml(js(),N,z);this.vertices.push({position:pc(le,le,.5),height:.5*(M+W),extent:.5*(L+H)});const de=ml(js(),Q,ne);this.vertexProps.push({dir:Hc(de,de)}),this.edges.splice(x,1),this.edgeProps.splice(x,1),this.edges.push({a:S,b:te}),this.edges.push({a:te,b:A});const pe=Wl(js(),this.vertices[te].position,N),Se=Wc(pe),we={vec:pe,dir:pc(js(),pe,1/Se),len:Se};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(i,l,h,m){const v=We(Ce(),l,i),x=We(Ce(),m,h),S=We(Ce(),i,h),A=nr(v,v),N=nr(v,x),M=nr(v,S),L=nr(x,x),z=nr(x,S),W=A*L-N*N;if(W===0)return pt(Et(v,h,m,nr(S,x)/nr(x,x)),i);const H=(A*z-N*M)/W;return pt(Et(v,i,l,(N*z-M*L)/W),Et(x,h,m,H))}}class Io{static parseFrom(i,l){const h=an.parse(i);if(!h)return[];let{vertices:m,features:v}=h;const x=1/Mt(l);v.sort((M,L)=>M.id-L.id),m.sort((M,L)=>M.id-L.id||M.idx-L.idx),m=m.filter((M,L,z)=>L===z.findIndex(W=>W.id===M.id&&W.idx===M.idx));const S=new Array;let A=0;const N=m.length;for(const M of v){if(M.constantHeight){S.push(new va(M.id,M.bounds,M.constantHeight));continue}for(;A!==N&&m[A].id<M.id;)A++;if(A===N||m[A].id!==M.id)continue;const L=new Array,z=new Array,W=A;for(;A!==N&&m[A].id===M.id;){const H=m[A];if(L.push({position:H.position,height:H.height,extent:H.extent}),A!==W&&m[A-1].idx===H.idx-1){const Q=A-W;z.push({a:Q-1,b:Q})}A++}S.push(new va(M.id,M.bounds,void 0,L,z,x))}return S}static getElevationFeature(i,l){if(!l)return;const h=+i.properties[hn];return Number.isNaN(h)?void 0:l.find(m=>m.id===h)}}class Jl{constructor(i,l){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(l)||(this.zScale=Math.pow(2,l.z-i.z),this.xOffset=(i.x*this.zScale-l.x)*Wt,this.yOffset=(i.y*this.zScale-l.y)*Wt)}constantElevation(i,l){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,l)}pointElevation(i,l,h){const m=this.constantElevation(l,h);return m??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(i),h))}computeBiasedHeight(i,l){return l<=0?i:i+l*He(0,l,i>=0?i:Math.abs(.5*i))}}ir(va,"ElevationFeature");class ho{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Hd,this.indexArray=new Ps,this.segments=new bi,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new aa),this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,m){}populate(i,l,h,m){const v=this.layers[0],x=[];let S=null;v.type==="circle"&&(S=v.layout.get("circle-sort-key"));for(const{feature:N,id:M,index:L,sourceLayerIndex:z}of i){const W=this.layers[0]._featureFilter.needGeometry,H=Gr(N,W);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),H,h))continue;const Q=S?S.evaluate(H,{},h):void 0,ne={id:M,properties:N.properties,type:N.type,sourceLayerIndex:z,index:L,geometry:W?H.geometry:Cr(N,h,m),patterns:{},sortKey:Q};x.push(ne)}S&&x.sort((N,M)=>N.sortKey-M.sortKey);let A=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new wp,A=m.projection);for(const N of x){const{geometry:M,index:L,sourceLayerIndex:z}=N,W=i[L].feature;this.addFeature(N,M,L,l.availableImages,h,A,l.brightness,l.elevationFeatures),l.featureIndex.insert(W,M,L,z,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,l,h,m,v,x,S){this.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Mj.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Lj.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Dj.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,l,h,m,v,x,S,A){let N;this.elevationMode!=="none"&&(N=Io.getElevationFeature(i,A));for(const M of l)for(const L of M){const z=L.x,W=L.y;if(z<0||z>=Wt||W<0||W>=Wt)continue;if(x){const ne=x.projectTilePoint(z,W,v),te=x.upVector(v,z,W);this.addGlobeExtVertex(ne,te),this.addGlobeExtVertex(ne,te),this.addGlobeExtVertex(ne,te),this.addGlobeExtVertex(ne,te)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),Q=H.vertexLength;if(this.addCircleVertex(z,W,-1,-1),this.addCircleVertex(z,W,1,-1),this.addCircleVertex(z,W,1,1),this.addCircleVertex(z,W,-1,1),this.elevationMode!=="none"){const ne=N?N.pointElevation(new kt(z,W)):0;this.hasElevation=this.hasElevation||ne!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(ne)}this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},m,v,S,void 0,this.worldview)}addCircleVertex(i,l,h,m){this.layoutVertexArray.emplaceBack(2*i+(h+1)/2,2*l+(m+1)/2)}addGlobeExtVertex(i,l){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}}function ji(u,i){for(let l=0;l<u.length;l++)if(Ko(i,u[l]))return!0;for(let l=0;l<i.length;l++)if(Ko(u,i[l]))return!0;return!!ja(u,i)}function ts(u,i,l){return!!Ko(u,i)||!!nu(i,u,l)}function ui(u,i){if(u.length===1)return jp(i,u[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let m=0;m<h.length;m++)if(Ko(u,h[m]))return!0}for(let l=0;l<u.length;l++)if(jp(i,u[l]))return!0;for(let l=0;l<i.length;l++)if(ja(u,i[l]))return!0;return!1}function ms(u,i,l){if(u.length>1){if(ja(u,i))return!0;for(let h=0;h<i.length;h++)if(nu(i[h],u,l))return!0}for(let h=0;h<u.length;h++)if(nu(u[h],i,l))return!0;return!1}function ja(u,i){if(u.length===0||i.length===0)return!1;for(let l=0;l<u.length-1;l++){const h=u[l],m=u[l+1];for(let v=0;v<i.length-1;v++)if(Zi(h,m,i[v],i[v+1]))return!0}return!1}function Zi(u,i,l,h){return li(u,l,h)!==li(i,l,h)&&li(u,i,l)!==li(u,i,h)}function Xo(u,i,l){return(u.x-l.x)*(i.y-l.y)-(u.y-l.y)*(i.x-l.x)}function Wg(u,i,l,h){const m=Xo(u,i,h),v=Xo(u,i,l);if(Math.sign(m)===Math.sign(v))return;const x=Xo(l,h,u),S=x+v-m;return Math.sign(x)!==Math.sign(S)?[x/(x-S),v/(v-m)]:void 0}function nu(u,i,l){const h=l*l;if(i.length===1)return u.distSqr(i[0])<h;for(let m=1;m<i.length;m++)if(Ep(u,i[m-1],i[m])<h)return!0;return!1}function Ep(u,i,l){const h=i.distSqr(l);if(h===0)return u.distSqr(i);const m=((u.x-i.x)*(l.x-i.x)+(u.y-i.y)*(l.y-i.y))/h;return u.distSqr(m<0?i:m>1?l:l.sub(i)._mult(m)._add(i))}function jp(u,i){let l,h,m,v=!1;for(let x=0;x<u.length;x++){l=u[x];for(let S=0,A=l.length-1;S<l.length;A=S++)h=l[S],m=l[A],h.y>i.y!=m.y>i.y&&i.x<(m.x-h.x)*(i.y-h.y)/(m.y-h.y)+h.x&&(v=!v)}return v}function Ko(u,i){let l=!1;for(let h=0,m=u.length-1;h<u.length;m=h++){const v=u[h],x=u[m];v.y>i.y!=x.y>i.y&&i.x<(x.x-v.x)*(i.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function iu(u,i,l,h,m){for(const x of u)if(i<=x.x&&l<=x.y&&h>=x.x&&m>=x.y)return!0;const v=[new kt(i,l),new kt(i,m),new kt(h,m),new kt(h,l)];if(u.length>2){for(const x of v)if(Ko(u,x))return!0}for(let x=0;x<u.length-1;x++)if(su(u[x],u[x+1],v))return!0;return!1}function su(u,i,l){const h=l[0],m=l[2];if(u.x<h.x&&i.x<h.x||u.x>m.x&&i.x>m.x||u.y<h.y&&i.y<h.y||u.y>m.y&&i.y>m.y)return!1;const v=li(u,i,l[0]);return v!==li(u,i,l[1])||v!==li(u,i,l[2])||v!==li(u,i,l[3])}function Tl(u,i,l,h,m,v){let x=i.y-u.y,S=u.x-i.x;if(v=v||0){const A=x*x+S*S;if(A===0)return!0;const N=Math.sqrt(A);x/=N,S/=N}return!((l.x-u.x)*x+(l.y-u.y)*S-v<0||(h.x-u.x)*x+(h.y-u.y)*S-v<0||(m.x-u.x)*x+(m.y-u.y)*S-v<0)}function Uu(u,i,l,h,m,v,x){return!(Tl(u,i,h,m,v,x)||Tl(i,l,h,m,v,x)||Tl(l,u,h,m,v,x)||Tl(h,m,u,i,l,x)||Tl(m,v,u,i,l,x)||Tl(v,h,u,i,l,x))}function Qh(u,i,l){const h=i.paint.get(u).value;return h.kind==="constant"?h.value:l.programConfigurations.get(i.id).getMaxValue(u)}function j_(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Q$(u,i,l,h,m){if(!i[0]&&!i[1])return u;const v=kt.convert(i)._mult(m);l==="viewport"&&v._rotate(-h);const x=[];for(let S=0;S<u.length;S++)x.push(u[S].sub(v));return x}function eV(u,i,l,h){const m=kt.convert(u)._mult(h);return i==="viewport"&&m._rotate(-l),m}let tV,rV;function nV(u,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[u*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}ir(ho,"CircleBucket",{omit:["layers"]});class Hg{constructor(i,l,h){this.z=i,this.x=l,this.y=h,this.key=A_(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const l=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>l&&i.y===this.y>>l}url(i,l){const h=function(v,x,S){var A=nV(256*v,256*(x=Math.pow(2,S)-x-1),S),N=nV(256*(v+1),256*(x+1),S);return A[0]+","+A[1]+","+N[0]+","+N[1]}(this.x,this.y,this.z),m=function(v,x,S){let A,N="";for(let M=v;M>0;M--)A=1<<M-1,N+=(x&A?1:0)+(S&A?2:0);return N}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iV{constructor(i,l){this.wrap=i,this.canonical=l,this.key=A_(i,l.z,l.z,l.x,l.y)}}class fo{constructor(i,l,h,m,v){this.overscaledZ=i,this.wrap=l,this.canonical=new Hg(h,+m,+v),this.key=l===0&&i===h?this.canonical.key:A_(l,i,h,m,v)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new fo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fo(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return A_(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return A_(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new fo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new fo(l,this.wrap,l,h,m),new fo(l,this.wrap,l,h+1,m),new fo(l,this.wrap,l,h,m+1),new fo(l,this.wrap,l,h+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new fo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new fo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iV(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function A_(u,i,l,h,m){const v=1<<Math.min(l,22);let x=v*(m%v)+h%v;return u&&l<22&&(x+=v*v*((u<0?-2*u-1:2*u)%(1<<2*(22-l)))),16*(32*x+l)+(i-l)}const ude=[u=>{let i=u.canonical.x-1,l=u.wrap;return i<0&&(i=(1<<u.canonical.z)-1,l--),new fo(u.overscaledZ,l,u.canonical.z,i,u.canonical.y)},u=>{let i=u.canonical.x+1,l=u.wrap;return i===1<<u.canonical.z&&(i=0,l++),new fo(u.overscaledZ,l,u.canonical.z,i,u.canonical.y)},u=>new fo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new fo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];ir(Hg,"CanonicalTileID"),ir(fo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const dde=ln([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vj}=dde,hde=ln([{name:"a_pos_3",components:3,type:"Int16"}]);var sV=ln([{name:"a_pos",type:"Int16",components:2}]);function Uj(u){return u*oe/Re}const fde=[new Pn([_e,_e,_e],[ye,ye,ye]),new Pn([_e,_e,_e],[0,0,ye]),new Pn([0,_e,_e],[ye,0,ye]),new Pn([_e,0,_e],[0,ye,ye]),new Pn([0,0,_e],[ye,ye,ye])];function aV(u,i,l,h=!0){const m=Je([],u._camera.position,u.worldSize),v=[i,l,1,1];hr(v,v,u.pixelMatrixInverse),Xt(v,v,1/v[3]);const x=Ot([],zn([],v,m)),S=u.globeMatrix,A=[S[12],S[13],S[14]],N=zn([],A,m),M=ze(N),L=Ot([],N),z=u.worldSize/(2*Math.PI),W=nr(L,x),H=Math.asin(z/M);if(H<Math.acos(W)){if(!h)return null;const Fe=[],qe=[];Je(Fe,x,M/W),Ot(qe,zn(qe,Fe,N)),Ot(x,Ve(x,N,Je(x,qe,Math.tan(H)*M)))}const Q=[];new si(m,x).closestPointOnSphere(A,z,Q);const ne=Ot([],Ei(S,0)),te=Ot([],Ei(S,1)),le=Ot([],Ei(S,2)),de=nr(ne,Q),pe=nr(te,Q),Se=nr(le,Q),we=Ke(Math.asin(-pe/z));let Ie=Ke(Math.atan2(de,Se));Ie=u.center.lng+function(Fe,qe){const ht=(qe-Fe+180)%360-180;return ht<-180?ht+360:ht}(u.center.lng,Ie);const Oe=Ye(Ie),Ne=Pe(it(we),0,1);return new Zt(Oe,Ne)}class pde{constructor(i,l,h){this.a=zn([],i,h),this.b=zn([],l,h),this.center=h;const m=Ot([],this.a),v=Ot([],this.b);this.angle=Math.acos(nr(m,v))}}function VO(u,i){if(u.angle===0)return null;let l;return l=u.a[i]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[i]/u.a[i]/Math.sin(u.angle)-1/Math.tan(u.angle)),l<0||l>1?null:function(h,m,v,x){const S=Math.sin(v);return h*(Math.sin((1-x)*v)/S)+m*(Math.sin(x*v)/S)}(u.a[i],u.b[i],u.angle,Pe(l,0,1))+u.center[i]}function Xd(u){if(u.z<=1)return fde[u.z+2*u.y+u.x];const i=UO(qj(u));return Pn.fromPoints(i)}function ef(u,i,l){return Je(u,u,1-l),Bt(u,u,i,l)}function oV(u,i,l){for(const h of u)pr(h,h,i),Je(h,h,l)}function lV(u,i,l,h){const m=i/u.worldSize,v=u.globeMatrix;if(l.z<=1){const Ne=Xd(l).getCorners();return oV(Ne,v,m),Pn.fromPoints(Ne)}const x=qj(l,h),S=UO(x,oe+Uj(u._tileCoverLift));oV(S,v,m);const A=Number.MAX_VALUE,N=[-A,-A,-A],M=[A,A,A];if(x.contains(u.center)){for(const qe of S)ot(M,M,qe),yt(N,N,qe);N[2]=0;const Ne=u.point,Fe=[Ne.x*m,Ne.y*m,0];return ot(M,M,Fe),yt(N,N,Fe),new Pn(M,N)}if(u._tileCoverLift>0){for(const Ne of S)ot(M,M,Ne),yt(N,N,Ne);return new Pn(M,N)}const L=[v[12]*m,v[13]*m,v[14]*m],z=x.getCenter(),W=Pe(u.center.lat,-85.051129,Ue),H=Pe(z.lat,-85.051129,Ue),Q=Ye(u.center.lng),ne=it(W);let te=Q-Ye(z.lng);const le=ne-it(H);te>.5?te-=1:te<-.5&&(te+=1);let de=0;Math.abs(te)>Math.abs(le)?de=te>=0?1:3:(de=le>=0?0:2,Bt(L,L,[v[4]*m,v[5]*m,v[6]*m],-Math.sin(_n(le>=0?x.getSouth():x.getNorth()))*oe));const pe=S[de],Se=S[(de+1)%4],we=new pde(pe,Se,L),Ie=[VO(we,0)||pe[0],VO(we,1)||pe[1],VO(we,2)||pe[2]],Oe=Ap(u.zoom);if(Oe>0){const Ne=function({x:qe,y:ht,z:at},ut,bt,_t,xt){const rt=1/(1<<at);let Tt=qe*rt,mt=Tt+rt,jt=ht*rt,wt=jt+rt,Qt=0;const er=(Tt+mt)/2-_t;return er>.5?Qt=-1:er<-.5&&(Qt=1),Tt=((Tt+Qt)*ut-(_t*=ut))*bt+_t,mt=((mt+Qt)*ut-_t)*bt+_t,jt=(jt*ut-(xt*=ut))*bt+xt,wt=(wt*ut-xt)*bt+xt,[[Tt,wt,0],[mt,wt,0],[mt,jt,0],[Tt,jt,0]]}(l,i,u._pixelsPerMercatorPixel,Q,ne);for(let qe=0;qe<S.length;qe++)ef(S[qe],Ne[qe],Oe);const Fe=Ve([],Ne[de],Ne[(de+1)%4]);Je(Fe,Fe,.5),ef(Ie,Fe,Oe)}for(const Ne of S)ot(M,M,Ne),yt(N,N,Ne);return M[2]=Math.min(pe[2],Se[2]),ot(M,M,Ie),yt(N,N,Ie),new Pn(M,N)}function qj({x:u,y:i,z:l},h=!1){const m=1/(1<<l),v=new Te(vt(u*m),i===(1<<l)-1&&h?-90:At((i+1)*m)),x=new Te(vt((u+1)*m),i===0&&h?90:At(i*m));return new $e(v,x)}function UO(u,i=oe){const l=_n(u.getNorth()),h=_n(u.getSouth()),m=Math.cos(l),v=Math.cos(h),x=Math.sin(l),S=Math.sin(h),A=u.getWest(),N=u.getEast();return[Le(v,S,A,i),Le(v,S,N,i),Le(m,x,N,i),Le(m,x,A,i)]}function n1(u,i,l,h){const m=1<<l.z,v=(u/Wt+l.x)/m;return ke(At((i/Wt+l.y)/m),vt(v),h)}function Gj({min:u,max:i}){return 16383/Math.max(i[0]-u[0],i[1]-u[1],i[2]-u[2])}const cV=new Float64Array(16);function Wj(u){const i=Gj(u),l=ie(cV,[i,i,i]);return $(l,l,Pr([],u.min))}function qO(u){const i=function(h,m){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=m[0],h[13]=m[1],h[14]=m[2],h[15]=1,h}(cV,u.min),l=1/Gj(u);return K(i,i,[l,l,l])}function GO(u){const i=Wt/(2*Math.PI);return u/(2*Math.PI)/i}function uV(u,i){return Wt/(512*Math.pow(2,u))*Gj(Xd(i))}function dV(u,i,l,h,m){const v=GO(l),x=[u,i,-l/(2*Math.PI)],S=D(new Float64Array(16));return $(S,S,x),K(S,S,[v,v,v]),Y(S,S,_n(-m)),ee(S,S,_n(-h)),S}function Ap(u){return He(5,6,u)}function hV(u,i){const l=ke(i.lat,i.lng),h=function(H){const Q=ke(H._center.lat,H._center.lng);let ne=ur([],Me(0,1,0),Q);const te=ge([],-H.angle,Q);ne=pr(ne,ne,te),ge(te,-H._pitch,ne);const le=Ot([],Q);return Je(le,le,Uj(H.cameraToCenterDistance/H.pixelsPerMeter)),pr(le,le,te),Ve([],Q,le)}(u);return x=(m=We([],h,l))[0],S=m[1],A=m[2],N=(v=l)[0],M=v[1],L=v[2],W=(z=Math.sqrt((x*x+S*S+A*A)*(N*N+M*M+L*L)))&&nr(m,v)/z,Math.acos(Math.min(Math.max(W,-1),1));var m,v,x,S,A,N,M,L,z,W}function WO(u,i){return hV(u,i)>Math.PI/2*1.01}const fV=_n(85),mde=Math.cos(fV),gde=Math.sin(fV),yde=B(),pV=u=>{const i=[];return u.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function mV(u,i,l,h,m,v,x,S,A){if(v&&u.queryGeometry.isAboveHorizon)return!1;v&&(A*=u.pixelToTileUnitsFactor);const N=u.tileID.canonical,M=l.projection.upVectorScale(N,l.center.lat,l.worldSize).metersToTile;for(const L of i)for(const z of L){const W=z.add(S),H=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(W.x,W.y,!0):0,Q=l.projection.projectTilePoint(W.x,W.y,N);if(H>0){const de=l.projection.upVector(N,W.x,W.y);Q.x+=de[0]*M*H,Q.y+=de[1]*M*H,Q.z+=de[2]*M*H}const ne=v?W:vde(Q.x,Q.y,Q.z,h),te=v?u.tilespaceRays.map(de=>xde(de,H)):u.queryGeometry.screenGeometry,le=hr([],[Q.x,Q.y,Q.z,1],h);if(!x&&v?A*=le[3]/l.cameraToCenterDistance:x&&!v&&(A*=l.cameraToCenterDistance/le[3]),v){const de=At((z.y/Wt+N.y)/(1<<N.z));A/=l.projection.pixelsPerMeter(de,1)/tt(1,de)}if(ts(te,ne,A))return!0}return!1}function vde(u,i,l,h){const m=hr([],[u,i,l,1],h);return new kt(m[0]/m[3],m[1]/m[3])}const gV=Me(0,0,0),_de=Me(0,0,1);function xde(u,i){const l=Ce();return gV[2]=i,u.intersectsPlane(gV,_de,l),new kt(l[0],l[1])}class yV extends ho{}let vV,_V,xV,bV;function wV(u,{width:i,height:l},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*l*h)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*l*h);return u.width=i,u.height=l,u.data=m,u}function SV(u,i,l){const{width:h,height:m}=i;h===u.width&&m===u.height||(HO(u,i,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,h),height:Math.min(u.height,m)},l,null),u.width=h,u.height=m,u.data=i.data)}function HO(u,i,l,h,m,v,x,S){if(m.width===0||m.height===0)return i;if(m.width>u.width||m.height>u.height||l.x>u.width-m.width||l.y>u.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||h.x>i.width-m.width||h.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const A=u.data,N=i.data,M=v===4&&S;for(let L=0;L<m.height;L++){const z=((l.y+L)*u.width+l.x)*v,W=((h.y+L)*i.width+h.x)*v;if(M)for(let H=0;H<m.width;H++){const Q=z+H*v+3,ne=W+H*v;N[ne+0]=255,N[ne+1]=255,N[ne+2]=255,N[ne+3]=A[Q]}else if(x)for(let H=0;H<m.width;H++){const Q=z+H*v,ne=W+H*v,te=new Dn(A[Q+0]/255,A[Q+1]/255,A[Q+2]/255,A[Q+3]).toNonPremultipliedRenderColor(x).toArray();N[ne+0]=te[0],N[ne+1]=te[1],N[ne+2]=te[2],N[ne+3]=te[3]}else for(let H=0;H<m.width*v;H++)N[W+H]=A[z+H]}return i}ir(yV,"HeatmapBucket",{omit:["layers"]});class Cp{constructor(i,l){wV(this,i,1,l)}resize(i){SV(this,new Cp(i),1)}clone(){return new Cp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,v){HO(i,l,h,m,v,1,null)}}class Aa{constructor(i,l){wV(this,i,4,l)}resize(i){SV(this,new Aa(i),4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,m,v,x,S){HO(i,l,h,m,v,4,x,S)}}class TV{constructor(i,l){this.width=i.width,this.height=i.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function i1(u){const i={},l=u.resolution||256,h=u.clips?u.clips.length:1,m=u.image||new Aa({width:l,height:h}),v=(x,S,A)=>{i[u.evaluationKey]=A;const N=u.expression.evaluate(i),M=N?N.toNonPremultipliedRenderColor(null):null;M&&(m.data[x+S+0]=Math.floor(255*M.r),m.data[x+S+1]=Math.floor(255*M.g),m.data[x+S+2]=Math.floor(255*M.b),m.data[x+S+3]=Math.floor(255*M.a))};if(u.clips)for(let x=0,S=0;x<h;++x,S+=4*l)for(let A=0,N=0;A<l;A++,N+=4){const M=A/(l-1),{start:L,end:z}=u.clips[x];v(S,N,L*(1-M)+z*M)}else for(let x=0,S=0;x<l;x++,S+=4)v(0,S,x/(l-1));return m}ir(Cp,"AlphaImage"),ir(Aa,"RGBAImage");const bde=ln([{name:"a_pos",components:2,type:"Int16"}],4),wde=ln([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Sde=ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Tde=ln([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function C_(u,i,l=2){const h=i&&i.length,m=h?i[0]*l:u.length;let v=EV(u,0,m,l,!0);const x=[];if(!v||v.next===v.prev)return x;let S,A,N;if(h&&(v=function(M,L,z,W){const H=[];for(let Q=0,ne=L.length;Q<ne;Q++){const te=EV(M,L[Q]*W,Q<ne-1?L[Q+1]*W:M.length,W,!1);te===te.next&&(te.steiner=!0),H.push(kde(te))}H.sort(Pde);for(let Q=0;Q<H.length;Q++)z=Nde(H[Q],z);return z}(u,i,v,l)),u.length>80*l){S=u[0],A=u[1];let M=S,L=A;for(let z=l;z<m;z+=l){const W=u[z],H=u[z+1];W<S&&(S=W),H<A&&(A=H),W>M&&(M=W),H>L&&(L=H)}N=Math.max(M-S,L-A),N=N!==0?32767/N:0}return s1(v,x,l,S,A,N,0),x}function EV(u,i,l,h,m){let v;if(m===function(x,S,A,N){let M=0;for(let L=S,z=A-N;L<A;L+=N)M+=(x[z]-x[L])*(x[L+1]+x[z+1]),z=L;return M}(u,i,l,h)>0)for(let x=i;x<l;x+=h)v=PV(x/h|0,u[x],u[x+1],v);else for(let x=l-h;x>=i;x-=h)v=PV(x/h|0,u[x],u[x+1],v);return v&&P_(v,v.next)&&(l1(v),v=v.next),v}function Zg(u,i){if(!u)return u;i||(i=u);let l,h=u;do if(l=!1,h.steiner||!P_(h,h.next)&&Zs(h.prev,h,h.next)!==0)h=h.next;else{if(l1(h),h=i=h.prev,h===h.next)break;l=!0}while(l||h!==i);return i}function s1(u,i,l,h,m,v,x){if(!u)return;!x&&v&&function(A,N,M,L){let z=A;do z.z===0&&(z.z=ZO(z.x,z.y,N,M,L)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==A);z.prevZ.nextZ=null,z.prevZ=null,function(W){let H,Q=1;do{let ne,te=W;W=null;let le=null;for(H=0;te;){H++;let de=te,pe=0;for(let we=0;we<Q&&(pe++,de=de.nextZ,de);we++);let Se=Q;for(;pe>0||Se>0&&de;)pe!==0&&(Se===0||!de||te.z<=de.z)?(ne=te,te=te.nextZ,pe--):(ne=de,de=de.nextZ,Se--),le?le.nextZ=ne:W=ne,ne.prevZ=le,le=ne;te=de}le.nextZ=null,Q*=2}while(H>1)}(z)}(u,h,m,v);let S=u;for(;u.prev!==u.next;){const A=u.prev,N=u.next;if(v?jde(u,h,m,v):Ede(u))i.push(A.i,u.i,N.i),l1(u),u=N.next,S=N.next;else if((u=N)===S){x?x===1?s1(u=Ade(Zg(u),i),i,l,h,m,v,2):x===2&&Cde(u,i,l,h,m,v):s1(Zg(u),i,l,h,m,v,1);break}}}function Ede(u){const i=u.prev,l=u,h=u.next;if(Zs(i,l,h)>=0)return!1;const m=i.x,v=l.x,x=h.x,S=i.y,A=l.y,N=h.y,M=Math.min(m,v,x),L=Math.min(S,A,N),z=Math.max(m,v,x),W=Math.max(S,A,N);let H=h.next;for(;H!==i;){if(H.x>=M&&H.x<=z&&H.y>=L&&H.y<=W&&a1(m,S,v,A,x,N,H.x,H.y)&&Zs(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function jde(u,i,l,h){const m=u.prev,v=u,x=u.next;if(Zs(m,v,x)>=0)return!1;const S=m.x,A=v.x,N=x.x,M=m.y,L=v.y,z=x.y,W=Math.min(S,A,N),H=Math.min(M,L,z),Q=Math.max(S,A,N),ne=Math.max(M,L,z),te=ZO(W,H,i,l,h),le=ZO(Q,ne,i,l,h);let de=u.prevZ,pe=u.nextZ;for(;de&&de.z>=te&&pe&&pe.z<=le;){if(de.x>=W&&de.x<=Q&&de.y>=H&&de.y<=ne&&de!==m&&de!==x&&a1(S,M,A,L,N,z,de.x,de.y)&&Zs(de.prev,de,de.next)>=0||(de=de.prevZ,pe.x>=W&&pe.x<=Q&&pe.y>=H&&pe.y<=ne&&pe!==m&&pe!==x&&a1(S,M,A,L,N,z,pe.x,pe.y)&&Zs(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;de&&de.z>=te;){if(de.x>=W&&de.x<=Q&&de.y>=H&&de.y<=ne&&de!==m&&de!==x&&a1(S,M,A,L,N,z,de.x,de.y)&&Zs(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;pe&&pe.z<=le;){if(pe.x>=W&&pe.x<=Q&&pe.y>=H&&pe.y<=ne&&pe!==m&&pe!==x&&a1(S,M,A,L,N,z,pe.x,pe.y)&&Zs(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function Ade(u,i){let l=u;do{const h=l.prev,m=l.next.next;!P_(h,m)&&AV(h,l,l.next,m)&&o1(h,m)&&o1(m,h)&&(i.push(h.i,l.i,m.i),l1(l),l1(l.next),l=u=m),l=l.next}while(l!==u);return Zg(l)}function Cde(u,i,l,h,m,v){let x=u;do{let S=x.next.next;for(;S!==x.prev;){if(x.i!==S.i&&Ode(x,S)){let A=CV(x,S);return x=Zg(x,x.next),A=Zg(A,A.next),s1(x,i,l,h,m,v,0),void s1(A,i,l,h,m,v,0)}S=S.next}x=x.next}while(x!==u)}function Pde(u,i){let l=u.x-i.x;return l===0&&(l=u.y-i.y,l===0)&&(l=(u.next.y-u.y)/(u.next.x-u.x)-(i.next.y-i.y)/(i.next.x-i.x)),l}function Nde(u,i){const l=function(m,v){let x=v;const S=m.x,A=m.y;let N,M=-1/0;if(P_(m,x))return x;do{if(P_(m,x.next))return x.next;if(A<=x.y&&A>=x.next.y&&x.next.y!==x.y){const Q=x.x+(A-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(Q<=S&&Q>M&&(M=Q,N=x.x<x.next.x?x:x.next,Q===S))return N}x=x.next}while(x!==v);if(!N)return null;const L=N,z=N.x,W=N.y;let H=1/0;x=N;do{if(S>=x.x&&x.x>=z&&S!==x.x&&jV(A<W?S:M,A,z,W,A<W?M:S,A,x.x,x.y)){const Q=Math.abs(A-x.y)/(S-x.x);o1(x,m)&&(Q<H||Q===H&&(x.x>N.x||x.x===N.x&&Ide(N,x)))&&(N=x,H=Q)}x=x.next}while(x!==L);return N}(u,i);if(!l)return i;const h=CV(l,u);return Zg(h,h.next),Zg(l,l.next)}function Ide(u,i){return Zs(u.prev,u,i.prev)<0&&Zs(i.next,u,u.next)<0}function ZO(u,i,l,h,m){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*m|0)|u<<8))|u<<4))|u<<2))|u<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function kde(u){let i=u,l=u;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==u);return l}function jV(u,i,l,h,m,v,x,S){return(m-x)*(i-S)>=(u-x)*(v-S)&&(u-x)*(h-S)>=(l-x)*(i-S)&&(l-x)*(v-S)>=(m-x)*(h-S)}function a1(u,i,l,h,m,v,x,S){return!(u===x&&i===S)&&jV(u,i,l,h,m,v,x,S)}function Ode(u,i){return u.next.i!==i.i&&u.prev.i!==i.i&&!function(l,h){let m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==h.i&&m.next.i!==h.i&&AV(m,m.next,l,h))return!0;m=m.next}while(m!==l);return!1}(u,i)&&(o1(u,i)&&o1(i,u)&&function(l,h){let m=l,v=!1;const x=(l.x+h.x)/2,S=(l.y+h.y)/2;do m.y>S!=m.next.y>S&&m.next.y!==m.y&&x<(m.next.x-m.x)*(S-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==l);return v}(u,i)&&(Zs(u.prev,u,i.prev)||Zs(u,i.prev,i))||P_(u,i)&&Zs(u.prev,u,u.next)>0&&Zs(i.prev,i,i.next)>0)}function Zs(u,i,l){return(i.y-u.y)*(l.x-i.x)-(i.x-u.x)*(l.y-i.y)}function P_(u,i){return u.x===i.x&&u.y===i.y}function AV(u,i,l,h){const m=Zj(Zs(u,i,l)),v=Zj(Zs(u,i,h)),x=Zj(Zs(l,h,u)),S=Zj(Zs(l,h,i));return m!==v&&x!==S||!(m!==0||!Hj(u,l,i))||!(v!==0||!Hj(u,h,i))||!(x!==0||!Hj(l,u,h))||!(S!==0||!Hj(l,i,h))}function Hj(u,i,l){return i.x<=Math.max(u.x,l.x)&&i.x>=Math.min(u.x,l.x)&&i.y<=Math.max(u.y,l.y)&&i.y>=Math.min(u.y,l.y)}function Zj(u){return u>0?1:u<0?-1:0}function o1(u,i){return Zs(u.prev,u,u.next)<0?Zs(u,i,u.next)>=0&&Zs(u,u.prev,i)>=0:Zs(u,i,u.prev)<0||Zs(u,u.next,i)<0}function CV(u,i){const l=XO(u.i,u.x,u.y),h=XO(i.i,i.x,i.y),m=u.next,v=i.prev;return u.next=i,i.prev=u,l.next=m,m.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function PV(u,i,l,h){const m=XO(u,i,l);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function l1(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function XO(u,i,l){return{i:u,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function c1(u,i){const l=u.length;if(l<=1)return[u];const h=[];let m,v;for(let x=0;x<l;x++){const S=vs(u[x]);S!==0&&(u[x].area=Math.abs(S),v===void 0&&(v=S<0),v===S<0?(m&&h.push(m),m=[u[x]]):m.push(u[x]))}if(m&&h.push(m),i>1)for(let x=0;x<h.length;x++)h[x].length<=i||(Bv(h[x],i,1,h[x].length-1,Rde),h[x]=h[x].slice(0,i));return h}function Rde(u,i){return i.area-u.area}function NV(u,i,l=1){if(!u)return null;const h=typeof u=="string"?Ao.from(u).getPrimary():u.getPrimary(),m=typeof u=="string"?null:u.getSecondary();for(const v of[h,m]){if(!v)continue;const x=v.id.toString();i.has(x)||i.set(x,[]),v.scaleSelf(l),i.get(x).push(v)}return{primary:h.toString(),secondary:m?m.toString():null}}function KO(u,i,l,h){const m=h.patternDependencies;let v=!1;for(const x of i){const S=x.paint.get(`${u}-pattern`);S.isConstant()||(v=!0),NV(S.constantOr(null),m,l)&&(v=!0)}return v}function YO(u,i,l,h,m,v){const x=v.patternDependencies;for(const S of i){const A=S.paint.get(`${u}-pattern`).value;if(A.kind!=="constant"){let N=A.evaluate({zoom:h},l,{},v.availableImages);N=N&&N.name?N.name:N;const M=NV(N,x,m);if(!M)continue;const{primary:L,secondary:z}=M;L&&(l.patterns[S.id]=[L,z].filter(Boolean))}}return l}class tf{constructor(){this.portals=[]}static isOnBorder(i,l){return i<=0&&l<=0||i>=Wt&&l>=Wt}static evaluate(i){if(i.length===0)return new tf;let l=[];for(const A of i)l.push(...A.portals);if(l.length===0)return new tf;for(const A of l){const N=A.va,M=A.vb;(tf.isOnBorder(N.x,M.x)||tf.isOnBorder(N.y,M.y))&&(A.type="border")}const h=l.filter(A=>A.type!=="unevaluated"),m=l.filter(A=>A.type==="unevaluated");if(m.length===0)return new tf;m.sort((A,N)=>A.hash===N.hash?A.isTunnel===N.isTunnel?0:A.isTunnel?-1:1:A.hash<N.hash?1:-1),l=h.concat(m);let v=h.length,x=v,S=v;do if(x++,x===l.length||l[v].hash!==l[x].hash){if(x-v===2){S<v&&(l[S]=l[v],l[v]=null);const A=l[S],N=l[x-1];A.type=A.isTunnel!==N.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:N.connection.a},S++}v=x}while(v!==l.length);return l.splice(S),l.sort((A,N)=>A.hash<N.hash?1:-1),{portals:l}}}ir(tf,"ElevationPortalGraph");class Mde{constructor(i,l,h){this.outPositions=i,this.outNormals=l,this.outIndices=h,this.vertexLookup=new Map}addVertex(i,l,h){let m=i[2];h!=null&&(m*=h);const v=`${i[0]},${i[1]},${i[2]},${l[0]},${l[1]},${l[2]}`,x=this.vertexLookup.get(v);if(x!=null)return x;const S=this.outPositions.length;this.vertexLookup.set(v,S);const A=Math.trunc(16384*l[0]),N=Math.trunc(16384*l[1]),M=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(i[0],i[1],m),this.outNormals.emplaceBack(A,N,M),S}addTriangle(i,l,h){this.outIndices.emplaceBack(i,l,h)}addTriangles(i,l,h){if(i.length===0)return;const m=h.length===1,v=Ce(),x=Ce();for(let S=0;S<i.length;S+=3){const A=l[i[S+0]],N=l[i[S+1]],M=l[i[S+2]],L=m?h[0]:h[i[S+1]],z=m?h[0]:h[i[S+2]];Be(v,A.x,A.y,m?h[0]:h[i[S+0]]);const W=this.addVertex(v,x);Be(v,N.x,N.y,L);const H=this.addVertex(v,x);Be(v,M.x,M.y,z);const Q=this.addVertex(v,x);this.outIndices.emplaceBack(W,H,Q)}}addQuad(i,l,h,m,v,x){const S=this.addVertex(i,v,x),A=this.addVertex(l,v,x),N=this.addVertex(h,v,x),M=this.addVertex(m,v,x);this.addTriangle(S,A,N),this.addTriangle(N,M,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class El{constructor(i,l,h,m){this.unevaluatedPortals=new tf,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new xp,this.vertexNormals=new Gw,this.indexArray=new Ps,this.tileToMeters=Mt(i),this.bridgeProgramConfigurations=new q(l,{zoom:h,lut:m},v=>v!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new q(l,{zoom:h,lut:m},v=>v!=="fill-bridge-guard-rail-color")}addVertices(i,l){const h=this.unevalVertices.length;for(let m=0;m<i.length;m++)this.unevalVertices.push(i[m]),this.unevalHeights.push(l[m]);return h}addTriangles(i,l,h){const m=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const v of i)m.push(v+l)}addRenderableRing(i,l,h,m,v,x){const S=[new kt(v.min.x,v.min.y),new kt(v.max.x,v.min.y),new kt(v.max.x,v.max.y),new kt(v.min.x,v.max.y)];for(let A=0;A<h-1;A++){const N=l+A,M=N+1,L=this.unevalVertices[N],z=this.unevalVertices[M];if(!(L.x>=v.min.x&&L.x<=v.max.x&&L.y>=v.min.y&&L.y<=v.max.y||z.x>=v.min.x&&z.x<=v.max.x&&z.y>=v.min.y&&z.y<=v.max.y||su(L,z,S))||this.isOnBorder(L.x,z.x)||this.isOnBorder(L.y,z.y))continue;const W=El.computeEdgeHash(this.unevalVertices[N],this.unevalVertices[M]);let H,Q=this.vertexHashLookup.get(El.computePosHash(L));Q!=null?H=Q.next:(Q=this.vertexHashLookup.get(El.computePosHash(z)),H=Q!=null?Q.prev:W),this.unevalEdges.push({polygonIdx:i,a:N,b:M,hash:W,portalHash:H,isTunnel:m,type:"unevaluated",featureInfo:x})}}addPortalCandidates(i,l,h,m,v){if(l.length!==0){this.vertexHashLookup.clear();for(const x of l){if(x.length===0)continue;const S=x[0];let A=El.computeEdgeHash(S[S.length-2],S[S.length-1]);for(let N=0;N<S.length-1;N++){const M=S[N+0],L=S[N+1],z=ga(L.x-M.x,L.y-M.y),W=Wc(z);if(W===0)continue;let H="unevaluated";const Q=m.pointElevation(M),ne=m.pointElevation(L);Math.abs(Q)<.01&&Math.abs(ne)<.01?H="entrance":(this.isOnBorder(M.x,L.x)||this.isOnBorder(M.y,L.y))&&(H="border");const te=El.computeEdgeHash(M,L);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:M,vb:L,vab:z,length:W,hash:te,isTunnel:h,type:H});const le=El.computePosHash(M);this.vertexHashLookup.set(le,{prev:A,next:te}),A=te}}}}construct(i){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=z=>{z.primitiveLength=this.indexArray.length-z.primitiveOffset},m=new Mde(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const v=l(),x=l(),S=l(),A=(z,W)=>{z.sort((Q,ne)=>Q.type===W&&ne.type!==W?-1:Q.type!==W&&ne.type===W?1:0);const H=z.findIndex(Q=>Q.type!==W);return H>=0?H:z.length};let N=0;this.unevalEdges.length>0&&(N=A(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},this.tileToMeters)),h(S);const M=l(),L=l();if(this.unevalEdges.length>0){const z=this.unevalEdges.splice(N),W=A(z,"tunnel")+N;this.unevalEdges.push(...z),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},{min:N,max:W})}h(M),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(L),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(x),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(v),this.maskSegments=bi.simpleSegment(0,L.primitiveOffset,0,L.primitiveLength),this.depthSegments=bi.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableBridgeSegments=bi.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=bi.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=bi.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength)}update(i,l,h,m,v,x,S,A){this.bridgeProgramConfigurations.updatePaintArrays(i,l,v,h,m,x,S,A),this.tunnelProgramConfigurations.updatePaintArrays(i,l,v,h,m,x,S,A)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,Sde.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,Tde.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,l,h,m,v){const x=(S,A)=>{for(let N=0;N<A.length-1;N++){const M=A[N].featureIndex,L=A[N+1].vertexStart,z=i.feature(M);S.populatePaintArrays(L,z,M,{},h,l,m,void 0,v)}};x(this.bridgeProgramConfigurations,this.bridgeFeatureSections),x(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,l,h,m,v){const x=new Map;for(let S=m;S<v;S++){const A=h[S],N=A.a,M=A.b,L=El.computePosHash(i[N]),z=El.computePosHash(i[M]);let W=x.get(L);W||(W={},x.set(L,W));let H=x.get(z);H||(H={},x.set(z,H)),l[N]<=0&&l[M]<=0||(W.to=M,H.from=N)}return x}isTerminalVertex(i,l){const h=El.computePosHash(this.unevalVertices[i]),m=l.get(h);return!m||!m.from||!m.to}constructBridgeStructures(i,l,h,m,v,x){i.clearVertexLookup();const S=this.computeVertexConnections(l,h,m,v.min,v.max),A=1/x,N=.5*A,M=(bt,_t)=>Be(bt,l[_t].x,l[_t].y,h[_t]*A),L=Ce(),z=Ce(),W=Ce(),H=Ce(),Q=Ce(),ne=(bt,_t)=>{const xt=S.get(El.computePosHash(l[_t])),rt=xt.from,Tt=xt.to;if(!rt||!Tt)return;M(L,rt),M(z,_t),M(W,Tt),Jn(H),ni(L,z)||(zn(Q,z,L),Ot(H,Q)),ni(W,z)||(zn(Q,W,z),Ve(H,H,Ot(Q,Q)));const mt=lt(H);return mt>0?Je(bt,H,1/mt):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(m,v.min,v.max,(bt,_t)=>bt.featureInfo.featureIndex-_t.featureInfo.featureIndex);const le=Ce(),de=Ce(),pe=Ce(),Se=Ce(),we=Ce(),Ie=Ce(),Oe=Ce(),Ne=Ce(),Fe=Ce(),qe=[Ce(),Ce(),Ce(),Ce()],ht=[Ce(),Ce(),Ce(),Ce()],at=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],ut=(bt,_t)=>bt>_t;for(let bt=v.min;bt<v.max;bt++){const _t=m[bt];if(!_t.featureInfo.guardRailEnabled||!this.prepareEdgePoints(at,l,h,_t,ut))continue;const[xt,rt]=at;if(Be(le,xt.coord.x,xt.coord.y,A*xt.height),Be(de,rt.coord.x,rt.coord.y,A*rt.height),ni(le,de))continue;zn(pe,de,le),Ot(pe,pe);const Tt=ne(Ne,_t.a)||pe,mt=ne(Fe,_t.b)||pe;Be(Se,Tt[1],-Tt[0],0),Ot(Se,Se),Be(we,mt[1],-mt[0],0),Ot(we,we),ur(Ne,Se,Tt),Ot(Ie,Ne),ur(Ne,we,mt),Ot(Oe,Ne),Ve(qe[0],le,Je(Ne,zn(Ne,Se,Ie),N)),Ve(qe[1],le,Je(Ne,Ve(Ne,Se,Ie),N)),Ve(qe[2],le,Je(Ne,Ie,N)),qe[3]=le,Ve(ht[0],de,Je(Ne,zn(Ne,we,Oe),N)),Ve(ht[1],de,Je(Ne,Ve(Ne,we,Oe),N)),Ve(ht[2],de,Je(Ne,Oe,N)),ht[3]=de,te=this.addFeatureSection(_t.featureInfo.featureIndex,te,this.bridgeFeatureSections,i);const jt=i.addVertex(qe[0],Se,x),wt=i.addVertex(qe[1],Se,x),Qt=i.addVertex(ht[0],we,x),er=i.addVertex(ht[1],we,x);i.addTriangle(jt,wt,Qt),i.addTriangle(wt,er,Qt);const qt=i.addVertex(qe[1],Ie,x),Ht=i.addVertex(qe[2],Ie,x),xr=i.addVertex(ht[1],Oe,x),cr=i.addVertex(ht[2],Oe,x);i.addTriangle(qt,Ht,xr),i.addTriangle(Ht,cr,xr),Pr(Se,Se),Pr(we,we);const Yt=i.addVertex(qe[2],Se,x),kr=i.addVertex(qe[3],Se,x),nn=i.addVertex(ht[2],we,x),En=i.addVertex(ht[3],we,x);i.addTriangle(Yt,kr,nn),i.addTriangle(kr,En,nn);const en=this.isTerminalVertex(_t.a,S),Hn=this.isTerminalVertex(_t.b,S);xt.height<.01&&en&&i.addQuad(qe[3],qe[2],qe[1],qe[0],Pr(Tt,Tt),x),rt.height<.01&&Hn&&i.addQuad(ht[0],ht[1],ht[2],ht[3],mt,x)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,l,h,m,v,x){i.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const A=(te,le)=>te.featureInfo.featureIndex-le.featureInfo.featureIndex;this.sortSubarray(m,v.min,v.max,A),this.sortSubarray(m,x.min,x.max,A);const N=te=>Ot(te,te),M=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],L=(te,le)=>te<le,z=Ce(),W=Ce(),H=Ce(),Q=Ce(),ne=Ce();for(let te=v.min;te<v.max;te++){if(!this.prepareEdgePoints(M,l,h,m[te],L))continue;const[le,de]=M,pe=N(Be(ne,-(de.coord.y-le.coord.y),de.coord.x-le.coord.x,0));S=this.addFeatureSection(m[te].featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(Be(z,le.coord.x,le.coord.y,le.height),Be(W,de.coord.x,de.coord.y,de.height),Be(H,de.coord.x,de.coord.y,m[te].isTunnel?-.1:0),Be(Q,le.coord.x,le.coord.y,m[te].isTunnel?-.1:0),pe)}for(let te=x.min;te<x.max;te++){const le=m[te];le.isTunnel&&([le.a,le.b]=[le.b,le.a]);const de=l[le.a],pe=l[le.b],Se=N(Be(ne,-(pe.y-de.y),pe.x-de.x,0));S=this.addFeatureSection(le.featureInfo.featureIndex,S,this.tunnelFeatureSections,i),i.addQuad(Be(z,pe.x,pe.y,0),Be(W,de.x,de.y,0),Be(H,de.x,de.y,h[le.a]+4),Be(Q,pe.x,pe.y,h[le.b]+4),Se),i.addQuad(Be(z,de.x,de.y,0),Be(W,pe.x,pe.y,0),Be(H,pe.x,pe.y,h[le.b]+4),Be(Q,de.x,de.y,h[le.a]+4),Se)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,l,h,m){i.coord.x=l,i.coord.y=h,i.height=m}prepareEdgePoints(i,l,h,m,v){let x=l[m.a].x,S=l[m.a].y,A=l[m.b].x,N=l[m.b].y,M=h[m.a],L=h[m.b];const z=v(M,0),W=v(L,0);if(z&&W)return this.setElevatedPoint(i[0],x,S,M),this.setElevatedPoint(i[1],A,N,L),!0;if(!z&&!W)return!1;if(z){if(!W){const H=L/(L-M);A=jr(A,x,H),N=jr(N,S,H),L=jr(L,M,H)}}else{const H=M/(M-L);x=jr(x,A,H),S=jr(S,N,H),M=jr(M,L,H)}return this.setElevatedPoint(i[0],x,S,M),this.setElevatedPoint(i[1],A,N,L),!0}prepareEdges(i,l){if(l.length===0)return;l.sort((S,A)=>S.hash===A.hash?A.polygonIdx-S.polygonIdx:A.hash>S.hash?1:-1);let h=0,m=0,v=0,x=l[h].polygonIdx;do m++,(m===l.length||l[h].hash!==l[m].hash)&&((m-h===1||l[m-1].polygonIdx!==x)&&(v<h&&(l[v]=l[h],l[h]=null),l[v].type="none",v++),h=m,h!==l.length&&(x=l[h].polygonIdx));while(h!==l.length);if(l.splice(v),l.length!==0&&i.length!==0){l.sort((N,M)=>N.portalHash<M.portalHash?1:-1);let S=0,A=0;for(;S!==l.length&&A!==i.length;){const N=l[S],M=i[A];N.portalHash>M.hash?S++:M.hash>N.portalHash?A++:(N.type=M.type,S++)}}}isOnBorder(i,l){return i<=0&&l<=0||i>=Wt&&l>=Wt}addFeatureSection(i,l,h,m){return i!==l&&(l=i,h.push({featureIndex:i,vertexStart:m.getVertexCount()}),m.clearVertexLookup()),l}sortSubarray(i,l,h,m){const v=i.slice(l,h);v.sort(m),i.splice(l,v.length,...v)}static computeEdgeHash(i,l){return(i.y===l.y&&i.x>l.x||i.y>l.y)&&([i,l]=[l,i]),BigInt(El.computePosHash(i))<<32n|BigInt(El.computePosHash(l))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}function Dde(u,i){return u>i?1:u<i?-1:0}class JO{constructor(i=Dde,l=!1){this._compare=i,this._root=null,this._size=0,this._noDuplicates=!!l}rotateLeft(i){var l=i.right;l&&(i.right=l.left,l.left&&(l.left.parent=i),l.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=l:i.parent.right=l:this._root=l,l&&(l.left=i),i.parent=l}rotateRight(i){var l=i.left;l&&(i.left=l.right,l.right&&(l.right.parent=i),l.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=l:i.parent.right=l:this._root=l,l&&(l.right=i),i.parent=l}_splay(i){for(;i.parent;){var l=i.parent;l.parent?l.left===i&&l.parent.left===l?(this.rotateRight(l.parent),this.rotateRight(l)):l.right===i&&l.parent.right===l?(this.rotateLeft(l.parent),this.rotateLeft(l)):l.left===i&&l.parent.right===l?(this.rotateRight(l),this.rotateLeft(l)):(this.rotateLeft(l),this.rotateRight(l)):l.left===i?this.rotateRight(l):this.rotateLeft(l)}}splay(i){for(var l,h,m,v,x;i.parent;)(h=(l=i.parent).parent)&&h.parent?((m=h.parent).left===h?m.left=i:m.right=i,i.parent=m):(i.parent=null,this._root=i),v=i.left,x=i.right,i===l.left?(h&&(h.left===l?(l.right?(h.left=l.right,h.left.parent=h):h.left=null,l.right=h,h.parent=l):(v?(h.right=v,v.parent=h):h.right=null,i.left=h,h.parent=i)),x?(l.left=x,x.parent=l):l.left=null,i.right=l,l.parent=i):(h&&(h.right===l?(l.left?(h.right=l.left,h.right.parent=h):h.right=null,l.left=h,h.parent=l):(x?(h.left=x,x.parent=h):h.left=null,i.right=h,h.parent=i)),v?(l.right=v,v.parent=l):l.right=null,i.left=l,l.parent=i)}replace(i,l){i.parent?i===i.parent.left?i.parent.left=l:i.parent.right=l:this._root=l,l&&(l.parent=i.parent)}minNode(i=this._root){if(i)for(;i.left;)i=i.left;return i}maxNode(i=this._root){if(i)for(;i.right;)i=i.right;return i}insert(i,l){var h=this._root,m=null,v=this._compare;if(this._noDuplicates)for(;h;){if(m=h,v(h.key,i)===0)return;h=v(h.key,i)<0?h.right:h.left}else for(;h;)m=h,h=v(h.key,i)<0?h.right:h.left;return h={key:i,data:l,left:null,right:null,parent:m},m?v(m.key,h.key)<0?m.right=h:m.left=h:this._root=h,this.splay(h),this._size++,h}find(i){for(var l=this._root,h=this._compare;l;){var m=h(l.key,i);if(m<0)l=l.right;else{if(!(m>0))return l;l=l.left}}return null}contains(i){for(var l=this._root,h=this._compare;l;){var m=h(i,l.key);if(m===0)return!0;l=m<0?l.left:l.right}return!1}remove(i){var l=this.find(i);if(!l)return!1;if(this.splay(l),l.left)if(l.right){var h=this.minNode(l.right);h.parent!==l&&(this.replace(h,h.right),h.right=l.right,h.right.parent=h),this.replace(l,h),h.left=l.left,h.left.parent=h}else this.replace(l,l.left);else this.replace(l,l.right);return this._size--,!0}removeNode(i){if(!i)return!1;if(this.splay(i),i.left)if(i.right){var l=this.minNode(i.right);l.parent!==i&&(this.replace(l,l.right),l.right=i.right,l.right.parent=l),this.replace(i,l),l.left=i.left,l.left.parent=l}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}erase(i){var l=this.find(i);if(l){this.splay(l);var h=l.left,m=l.right,v=null;h&&(h.parent=null,v=this.maxNode(h),this.splay(v),this._root=v),m&&(h?v.right=m:this._root=m,m.parent=v),this._size--}}pop(){var i=this._root,l=null;if(i){for(;i.left;)i=i.left;l={key:i.key,data:i.data},this.remove(i.key)}return l}next(i){var l=i;if(l)if(l.right)for(l=l.right;l&&l.left;)l=l.left;else for(l=i.parent;l&&l.right===i;)i=l,l=l.parent;return l}prev(i){var l=i;if(l)if(l.left)for(l=l.left;l&&l.right;)l=l.right;else for(l=i.parent;l&&l.left===i;)i=l,l=l.parent;return l}forEach(i){for(var l=this._root,h=[],m=!1,v=0;!m;)l?(h.push(l),l=l.left):h.length>0?(i(l=h.pop(),v++),l=l.right):m=!0;return this}range(i,l,h,m){const v=[],x=this._compare;let S,A=this._root;for(;v.length!==0||A;)if(A)v.push(A),A=A.left;else{if(A=v.pop(),S=x(A.key,l),S>0)break;if(x(A.key,i)>=0&&h.call(m,A))return this;A=A.right}return this}keys(){for(var i=this._root,l=[],h=[],m=!1;!m;)i?(l.push(i),i=i.left):l.length>0?(i=l.pop(),h.push(i.key),i=i.right):m=!0;return h}values(){for(var i=this._root,l=[],h=[],m=!1;!m;)i?(l.push(i),i=i.left):l.length>0?(i=l.pop(),h.push(i.data),i=i.right):m=!0;return h}at(i){for(var l=this._root,h=[],m=!1,v=0;!m;)if(l)h.push(l),l=l.left;else if(h.length>0){if(l=h.pop(),v===i)return l;v++,l=l.right}else m=!0;return null}load(i=[],l=[],h=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const m=i.length;return h&&eR(i,l,0,m-1,this._compare),this._root=QO(null,i,l,0,m),this._size=m,this}min(){var i=this.minNode(this._root);return i?i.key:null}max(){var i=this.maxNode(this._root);return i?i.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(i,l,h,m,v){return new JO(h,v).load(i,l,m)}}function QO(u,i,l,h,m){const v=m-h;if(v>0){const x=h+Math.floor(v/2),S={key:i[x],data:l[x],parent:u};return S.left=QO(S,i,l,h,x),S.right=QO(S,i,l,x+1,m),S}return null}function eR(u,i,l,h,m){if(l>=h)return;const v=u[l+h>>1];let x=l-1,S=h+1;for(;;){do x++;while(m(u[x],v)<0);do S--;while(m(u[S],v)>0);if(x>=S)break;let A=u[x];u[x]=u[S],u[S]=A,A=i[x],i[x]=i[S],i[S]=A}eR(u,i,l,S,m),eR(u,i,S+1,h,m)}const IV=11102230246251565e-32,Yo=134217729,Lde=(3+8*IV)*IV;function tR(u,i,l,h,m){let v,x,S,A,N=i[0],M=h[0],L=0,z=0;M>N==M>-N?(v=N,N=i[++L]):(v=M,M=h[++z]);let W=0;if(L<u&&z<l)for(M>N==M>-N?(x=N+v,S=v-(x-N),N=i[++L]):(x=M+v,S=v-(x-M),M=h[++z]),v=x,S!==0&&(m[W++]=S);L<u&&z<l;)M>N==M>-N?(x=v+N,A=x-v,S=v-(x-A)+(N-A),N=i[++L]):(x=v+M,A=x-v,S=v-(x-A)+(M-A),M=h[++z]),v=x,S!==0&&(m[W++]=S);for(;L<u;)x=v+N,A=x-v,S=v-(x-A)+(N-A),N=i[++L],v=x,S!==0&&(m[W++]=S);for(;z<l;)x=v+M,A=x-v,S=v-(x-A)+(M-A),M=h[++z],v=x,S!==0&&(m[W++]=S);return v===0&&W!==0||(m[W++]=v),W}function u1(u){return new Float64Array(u)}const N_=u1(4),kV=u1(8),OV=u1(12),RV=u1(16),jl=u1(4);function d1(u,i,l){i===null?(u.inOut=!1,u.otherInOut=!0):(u.isSubject===i.isSubject?(u.inOut=!i.inOut,u.otherInOut=i.otherInOut):(u.inOut=!i.otherInOut,u.otherInOut=i.isVertical()?!i.inOut:i.inOut),i&&(u.prevInResult=!MV(i,l)||i.isVertical()?i.prevInResult:i)),u.resultTransition=MV(u,l)?function(h,m){let v,x=!h.inOut,S=!h.otherInOut;switch(m){case 0:v=x&&S;break;case 1:v=x||S;break;case 3:v=x!==S;break;case 2:v=h.isSubject?x&&!S:S&&!x}return v?1:-1}(u,l):0}function MV(u,i){switch(u.type){case 0:switch(i){case 0:return!u.otherInOut;case 1:return u.otherInOut;case 2:return u.isSubject&&u.otherInOut||!u.isSubject&&!u.otherInOut;case 3:return!0}break;case 2:return i===0||i===1;case 3:return i===2;case 1:return!1}return!1}class I_{constructor(i,l,h,m,v){this.left=l,this.point=i,this.otherEvent=h,this.isSubject=m??!1,this.type=v||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(i){const l=this.point,h=this.otherEvent.point;return this.left?(l[0]-i[0])*(h[1]-i[1])-(h[0]-i[0])*(l[1]-i[1])>0:(h[0]-i[0])*(l[1]-i[1])-(l[0]-i[0])*(h[1]-i[1])>0}isAbove(i){return!this.isBelow(i)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const i=new I_(this.point,this.left,this.otherEvent,this.isSubject,this.type);return i.contourId=this.contourId,i.resultTransition=this.resultTransition,i.prevInResult=this.prevInResult,i.isExteriorRing=this.isExteriorRing,i.inOut=this.inOut,i.otherInOut=this.otherInOut,i}}function Kd(u,i){return u[0]===i[0]&&u[1]===i[1]}function rR(u,i,l){const h=function(m,v,x,S,A,N){const M=(v-N)*(x-A),L=(m-A)*(S-N),z=M-L;if(M===0||L===0||M>0!=L>0)return z;const W=Math.abs(M+L);return Math.abs(z)>=33306690738754716e-32*W?z:-function(H,Q,ne,te,le,de,pe){let Se,we,Ie,Oe,Ne,Fe,qe,ht,at,ut,bt,_t,xt,rt,Tt,mt,jt,wt;const Qt=H-le,er=ne-le,qt=Q-de,Ht=te-de;rt=Qt*Ht,Fe=Yo*Qt,qe=Fe-(Fe-Qt),ht=Qt-qe,Fe=Yo*Ht,at=Fe-(Fe-Ht),ut=Ht-at,Tt=ht*ut-(rt-qe*at-ht*at-qe*ut),mt=qt*er,Fe=Yo*qt,qe=Fe-(Fe-qt),ht=qt-qe,Fe=Yo*er,at=Fe-(Fe-er),ut=er-at,jt=ht*ut-(mt-qe*at-ht*at-qe*ut),bt=Tt-jt,Ne=Tt-bt,N_[0]=Tt-(bt+Ne)+(Ne-jt),_t=rt+bt,Ne=_t-rt,xt=rt-(_t-Ne)+(bt-Ne),bt=xt-mt,Ne=xt-bt,N_[1]=xt-(bt+Ne)+(Ne-mt),wt=_t+bt,Ne=wt-_t,N_[2]=_t-(wt-Ne)+(bt-Ne),N_[3]=wt;let xr=function(En,en){let Hn=en[0];for(let yn=1;yn<4;yn++)Hn+=en[yn];return Hn}(0,N_),cr=22204460492503146e-32*pe;if(xr>=cr||-xr>=cr||(Ne=H-Qt,Se=H-(Qt+Ne)+(Ne-le),Ne=ne-er,Ie=ne-(er+Ne)+(Ne-le),Ne=Q-qt,we=Q-(qt+Ne)+(Ne-de),Ne=te-Ht,Oe=te-(Ht+Ne)+(Ne-de),Se===0&&we===0&&Ie===0&&Oe===0)||(cr=11093356479670487e-47*pe+Lde*Math.abs(xr),xr+=Qt*Oe+Ht*Se-(qt*Ie+er*we),xr>=cr||-xr>=cr))return xr;rt=Se*Ht,Fe=Yo*Se,qe=Fe-(Fe-Se),ht=Se-qe,Fe=Yo*Ht,at=Fe-(Fe-Ht),ut=Ht-at,Tt=ht*ut-(rt-qe*at-ht*at-qe*ut),mt=we*er,Fe=Yo*we,qe=Fe-(Fe-we),ht=we-qe,Fe=Yo*er,at=Fe-(Fe-er),ut=er-at,jt=ht*ut-(mt-qe*at-ht*at-qe*ut),bt=Tt-jt,Ne=Tt-bt,jl[0]=Tt-(bt+Ne)+(Ne-jt),_t=rt+bt,Ne=_t-rt,xt=rt-(_t-Ne)+(bt-Ne),bt=xt-mt,Ne=xt-bt,jl[1]=xt-(bt+Ne)+(Ne-mt),wt=_t+bt,Ne=wt-_t,jl[2]=_t-(wt-Ne)+(bt-Ne),jl[3]=wt;const Yt=tR(4,N_,4,jl,kV);rt=Qt*Oe,Fe=Yo*Qt,qe=Fe-(Fe-Qt),ht=Qt-qe,Fe=Yo*Oe,at=Fe-(Fe-Oe),ut=Oe-at,Tt=ht*ut-(rt-qe*at-ht*at-qe*ut),mt=qt*Ie,Fe=Yo*qt,qe=Fe-(Fe-qt),ht=qt-qe,Fe=Yo*Ie,at=Fe-(Fe-Ie),ut=Ie-at,jt=ht*ut-(mt-qe*at-ht*at-qe*ut),bt=Tt-jt,Ne=Tt-bt,jl[0]=Tt-(bt+Ne)+(Ne-jt),_t=rt+bt,Ne=_t-rt,xt=rt-(_t-Ne)+(bt-Ne),bt=xt-mt,Ne=xt-bt,jl[1]=xt-(bt+Ne)+(Ne-mt),wt=_t+bt,Ne=wt-_t,jl[2]=_t-(wt-Ne)+(bt-Ne),jl[3]=wt;const kr=tR(Yt,kV,4,jl,OV);rt=Se*Oe,Fe=Yo*Se,qe=Fe-(Fe-Se),ht=Se-qe,Fe=Yo*Oe,at=Fe-(Fe-Oe),ut=Oe-at,Tt=ht*ut-(rt-qe*at-ht*at-qe*ut),mt=we*Ie,Fe=Yo*we,qe=Fe-(Fe-we),ht=we-qe,Fe=Yo*Ie,at=Fe-(Fe-Ie),ut=Ie-at,jt=ht*ut-(mt-qe*at-ht*at-qe*ut),bt=Tt-jt,Ne=Tt-bt,jl[0]=Tt-(bt+Ne)+(Ne-jt),_t=rt+bt,Ne=_t-rt,xt=rt-(_t-Ne)+(bt-Ne),bt=xt-mt,Ne=xt-bt,jl[1]=xt-(bt+Ne)+(Ne-mt),wt=_t+bt,Ne=wt-_t,jl[2]=_t-(wt-Ne)+(bt-Ne),jl[3]=wt;const nn=tR(kr,OV,4,jl,RV);return RV[nn-1]}(m,v,x,S,A,N,W)}(u[0],u[1],i[0],i[1],l[0],l[1]);return h>0?-1:h<0?1:0}function Pp(u,i){const l=u.point,h=i.point;return l[0]>h[0]?1:l[0]<h[0]?-1:l[1]!==h[1]?l[1]>h[1]?1:-1:function(m,v,x){return m.left!==v.left?m.left?1:-1:rR(x,m.otherEvent.point,v.otherEvent.point)!==0?m.isBelow(v.otherEvent.point)?-1:1:!m.isSubject&&v.isSubject?1:-1}(u,i,l)}function Np(u,i,l){const h=new I_(i,!1,u,u.isSubject),m=new I_(i,!0,u.otherEvent,u.isSubject);return Kd(u.point,u.otherEvent.point)&&console.warn("what is that, a collapsed segment?",u),h.contourId=m.contourId=u.contourId,Pp(m,u.otherEvent)>0&&(u.otherEvent.left=!0,m.left=!1),u.otherEvent.otherEvent=m,u.otherEvent=h,l.push(m),l.push(h),l}function Xj(u,i){return u[0]*i[1]-u[1]*i[0]}function nR(u,i){return u[0]*i[0]+u[1]*i[1]}function iR(u,i,l){const h=function(A,N,M,L){const z=[N[0]-A[0],N[1]-A[1]],W=[L[0]-M[0],L[1]-M[1]];function H(Ie,Oe,Ne){return[Ie[0]+Oe*Ne[0],Ie[1]+Oe*Ne[1]]}const Q=[M[0]-A[0],M[1]-A[1]];let ne=Xj(z,W),te=ne*ne;const le=nR(z,z);if(te>0){const Ie=Xj(Q,W)/ne;if(Ie<0||Ie>1)return null;const Oe=Xj(Q,z)/ne;return Oe<0||Oe>1?null:Ie===0||Ie===1?[H(A,Ie,z)]:Oe===0||Oe===1?[H(M,Oe,W)]:[H(A,Ie,z)]}if(ne=Xj(Q,z),te=ne*ne,te>0)return null;const de=nR(z,Q)/le,pe=de+nR(z,W)/le,Se=Math.min(de,pe),we=Math.max(de,pe);return Se<=1&&we>=0?Se===1?[H(A,Se>0?Se:0,z)]:we===0?[H(A,we<1?we:1,z)]:[H(A,Se>0?Se:0,z),H(A,we<1?we:1,z)]:null}(u.point,u.otherEvent.point,i.point,i.otherEvent.point),m=h?h.length:0;if(m===0||m===1&&(Kd(u.point,i.point)||Kd(u.otherEvent.point,i.otherEvent.point))||m===2&&u.isSubject===i.isSubject)return 0;if(m===1)return!Kd(u.point,h[0])&&!Kd(u.otherEvent.point,h[0])&&Np(u,h[0],l),!Kd(i.point,h[0])&&!Kd(i.otherEvent.point,h[0])&&Np(i,h[0],l),1;const v=[];let x=!1,S=!1;return Kd(u.point,i.point)?x=!0:Pp(u,i)===1?v.push(i,u):v.push(u,i),Kd(u.otherEvent.point,i.otherEvent.point)?S=!0:Pp(u.otherEvent,i.otherEvent)===1?v.push(i.otherEvent,u.otherEvent):v.push(u.otherEvent,i.otherEvent),x&&S||x?(i.type=1,u.type=i.inOut===u.inOut?2:3,x&&!S&&Np(v[1].otherEvent,v[0].point,l),2):S?(Np(v[0],v[1].point,l),3):v[0]!==v[3].otherEvent?(Np(v[0],v[1].point,l),Np(v[1],v[2].point,l),3):(Np(v[0],v[1].point,l),Np(v[3].otherEvent,v[2].point,l),3)}function Fde(u,i){if(u===i)return 0;if(rR(u.point,u.otherEvent.point,i.point)!==0||rR(u.point,u.otherEvent.point,i.otherEvent.point)!==0)return Kd(u.point,i.point)?u.isBelow(i.otherEvent.point)?-1:1:u.point[0]===i.point[0]?u.point[1]<i.point[1]?-1:1:Pp(u,i)===1?i.isAbove(u.point)?-1:1:u.isBelow(i.point)?-1:1;if(u.isSubject!==i.isSubject)return u.isSubject?-1:1;{let l=u.point,h=i.point;if(l[0]===h[0]&&l[1]===h[1])return l=u.otherEvent.point,h=i.otherEvent.point,l[0]===h[0]&&l[1]===h[1]?0:(u.contourId??0)>(i.contourId??0)?1:-1}return Pp(u,i)===1?1:-1}class zde{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Bde(u,i,l,h){let m,v=u+1,x=i[u].point;const S=i.length;for(v<S&&(m=i[v].point);v<S&&m[0]===x[0]&&m[1]===x[1];){if(!l[v])return v;v++,v<S&&(m=i[v].point)}for(v=u-1;l[v]&&v>h;)v--;return v}function $de(u,i,l){const h=new zde;if(u.prevInResult!=null){const m=u.prevInResult,v=m.outputContourId;if(m.resultTransition>0){const x=i[v];if(x.holeOf!=null){const S=x.holeOf;i[S].holeIds.push(l),h.holeOf=S,h.depth=i[v].depth}else i[v].holeIds.push(l),h.holeOf=v,h.depth=i[v].depth+1}else h.holeOf=null,h.depth=i[v].depth}else h.holeOf=null,h.depth=0;return h}const DV=Math.max,LV=Math.min;let Kj=0;function FV(u,i,l,h,m,v){let x,S,A,N,M,L;for(x=0,S=u.length-1;x<S;x++){if(A=u[x],N=u[x+1],M=new I_(A,!1,void 0,i),L=new I_(N,!1,M,i),M.otherEvent=L,A[0]===N[0]&&A[1]===N[1])continue;M.contourId=L.contourId=l,v||(M.isExteriorRing=!1,L.isExteriorRing=!1),Pp(M,L)>0?L.left=!0:M.left=!0;const z=A[0],W=A[1];m[0]=LV(m[0],z),m[1]=LV(m[1],W),m[2]=DV(m[2],z),m[3]=DV(m[3],W),h.push(M),h.push(L)}}const Yj=[];function zV(u,i,l){let h=u,m=i;typeof u[0][0][0]=="number"&&(h=[u]),typeof i[0][0][0]=="number"&&(m=[i]);let v=function(z,W,H){let Q=null;return z.length*W.length===0&&(H===0?Q=Yj:H===2?Q=z:(H===1||H===3)&&(Q=z.length===0?W:z)),Q}(h,m,l);if(v)return v===Yj?null:v;const x=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],A=function(z,W,H,Q,ne){const te=new _g(void 0,Pp);let le,de,pe,Se,we,Ie;for(pe=0,Se=z.length;pe<Se;pe++)for(le=z[pe],we=0,Ie=le.length;we<Ie;we++)de=we===0,de&&Kj++,FV(le[we],!0,Kj,te,H,de);for(pe=0,Se=W.length;pe<Se;pe++)for(le=W[pe],we=0,Ie=le.length;we<Ie;we++)de=we===0,ne===2&&(de=!1),de&&Kj++,FV(le[we],!1,Kj,te,Q,de);return te}(h,m,x,S,l);if(v=function(z,W,H,Q,ne){let te=null;return(H[0]>Q[2]||Q[0]>H[2]||H[1]>Q[3]||Q[1]>H[3])&&(ne===0?te=Yj:ne===2?te=z:(ne===1||ne===3)&&(te=z.concat(W))),te}(h,m,x,S,l),v)return v===Yj?null:v;const N=function(z,W,H,Q,ne,te){const le=new JO(Fde),de=[],pe=Math.min(Q[2],ne[2]);let Se,we,Ie;for(;z.length!==0;){let Oe=z.pop();if(de.push(Oe),te===0&&Oe.point[0]>pe||te===2&&Oe.point[0]>Q[2])break;if(Oe.left){we=Se=le.insert(Oe),Ie=le.minNode(),Se=Se!==Ie?le.prev(Se):null,we=le.next(we);const Ne=Se?Se.key:null;let Fe;if(d1(Oe,Ne,te),we&&iR(Oe,we.key,z)===2&&(d1(Oe,Ne,te),d1(we.key,Oe,te)),Se&&iR(Se.key,Oe,z)===2){let qe=Se;qe=qe!==Ie?le.prev(qe):null,Fe=qe?qe.key:null,d1(Ne,Fe,te),d1(Oe,Ne,te)}}else Oe=Oe.otherEvent,we=Se=le.find(Oe),Se&&we&&(Se=Se!==Ie?le.prev(Se):null,we=le.next(we),le.remove(Oe),we&&Se&&iR(Se.key,we.key,z))}return de}(A,0,0,x,S,l),M=function(z){let W,H;const Q=function(le){let de,pe,Se,we,Ie;const Oe=[];for(pe=0,Se=le.length;pe<Se;pe++)de=le[pe],(de.left&&de.inResult||!de.left&&de.otherEvent.inResult)&&Oe.push(de);let Ne=!1;for(;!Ne;)for(Ne=!0,pe=0,Se=Oe.length;pe<Se;pe++)pe+1<Se&&Pp(Oe[pe],Oe[pe+1])===1&&(we=Oe[pe],Oe[pe]=Oe[pe+1],Oe[pe+1]=we,Ne=!1);for(pe=0,Se=Oe.length;pe<Se;pe++)de=Oe[pe],de.otherPos=pe;for(pe=0,Se=Oe.length;pe<Se;pe++)de=Oe[pe],de.left||(Ie=de.otherPos,de.otherPos=de.otherEvent.otherPos,de.otherEvent.otherPos=Ie);return Oe}(z),ne={},te=[];for(W=0,H=Q.length;W<H;W++){if(ne[W])continue;const le=te.length,de=$de(Q[W],te,le),pe=Ie=>{ne[Ie]=!0,Ie<Q.length&&Q[Ie]&&(Q[Ie].outputContourId=le)};let Se=W,we=W;for(de.points.push(Q[W].point);pe(Se),Se=Q[Se].otherPos,pe(Se),de.points.push(Q[Se].point),Se=Bde(Se,Q,ne,we),!(Se==we||Se>=Q.length)&&Q[Se];);te.push(de)}return te}(N),L=[];for(let z=0;z<M.length;z++){let W=M[z];if(W.isExterior()){let H=[W.points];for(let Q=0;Q<W.holeIds.length;Q++)H.push(M[W.holeIds[Q]].points);L.push(H)}}return L}function Jj(u,i,l,h){const m=[],v=h===0?(x,S,A,N,M,L)=>{x.push(new kt(L,A+(L-S)/(N-S)*(M-A)))}:(x,S,A,N,M,L)=>{x.push(new kt(S+(L-A)/(M-A)*(N-S),L))};for(const x of u){const S=[];for(const A of x){if(A.length<=2)continue;const N=[];for(let z=0;z<A.length-1;z++){const W=A[z].x,H=A[z].y,Q=A[z+1].x,ne=A[z+1].y,te=h===0?W:H,le=h===0?Q:ne;te<i?le>i&&v(N,W,H,Q,ne,i):te>l?le<l&&v(N,W,H,Q,ne,l):N.push(A[z]),le<i&&te>=i&&v(N,W,H,Q,ne,i),le>l&&te<=l&&v(N,W,H,Q,ne,l)}let M=A[A.length-1];const L=h===0?M.x:M.y;L>=i&&L<=l&&N.push(M),N.length&&(M=N[N.length-1],N[0].x===M.x&&N[0].y===M.y||N.push(N[0]),S.push(N))}S.length&&m.push(S)}return m}function Vde(u,i){const l=zV(sR(u),sR([i]),0);return l==null?[]:BV(l)}function Ude(u,i){let h=sR(u,65536);const m=[];for(;i.valid();i.next()){const[v,x]=i.get(),S=v.x*65536,A=v.y*65536,N=x.x*65536,M=x.y*65536,L=N-S,z=M-A,W=Math.hypot(L,z);if(W===0)continue;const H=Math.trunc(z/W*3),Q=-Math.trunc(L/W*3);m.push([[[S,A],[N,M],[N+H,M+Q],[S+H,A+Q],[S,A]]])}return m.length>0&&(h=zV(h,m,2)),BV(h,1/65536,128)}function sR(u,i=1){return[u.map(l=>l.map(h=>[h.x*i,h.y*i]))]}function BV(u,i=1,l){return u.map(h=>h.map((m,v)=>{const x=m.map(S=>{let A=S[0],N=S[1];return l&&(A=Math.round(A/l)*l,N=Math.round(N/l)*l),new kt(A*i,N*i)._round()});return v>0&&x.reverse(),x}))}class aR{constructor(i,l){this.layoutVertexArray=new Hd,this.indexArray=new Ps,this.lineIndexArray=new bl,this.triangleSegments=new bi,this.lineSegments=new bi,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new aa)}update(i,l,h,m,v,x,S,A){this.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,bde.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,wde.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,l,h,m,v,x,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,h,m,v,x,void 0,S)}}class oR{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new aR(i,!1),this.elevationBufferData=new aR(i,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,m){}populate(i,l,h,m){this.hasPattern=KO("fill",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:S,id:A,index:N,sourceLayerIndex:M}of i){const L=this.layers[0]._featureFilter.needGeometry,z=Gr(S,L);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),z,h))continue;const W=v?v.evaluate(z,{},h,l.availableImages):void 0,H={id:A,properties:S.properties,type:S.type,sourceLayerIndex:M,index:N,geometry:L?z.geometry:Cr(S,h,m),patterns:{},sortKey:W};x.push(H)}v&&x.sort((S,A)=>S.sortKey-A.sortKey);for(const S of x){const{geometry:A,index:N,sourceLayerIndex:M}=S;if(this.hasPattern){const L=YO("fill",this.layers,S,this.zoom,this.pixelRatio,l);this.patternFeatures.push(L)}else this.addFeature(S,A,N,h,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(i[N].feature,A,N,M,this.index)}}update(i,l,h,m,v,x,S){this.bufferData.update(i,l,h,m,v,x,S,this.worldview),this.elevationBufferData.update(i,l,h,m,v,x,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,l,h,m,v,x,S,this.worldview)}addFeatures(i,l,h,m,v,x){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,h,m,x,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,l,h,m,v,x=[],S,A){const N=c1(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,N,m,h,A):this.addGeometry(N,this.bufferData),this.bufferData.populatePaintArrays(i,h,v,x,m,S,this.worldview),this.elevationBufferData.populatePaintArrays(i,h,v,x,m,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(i,l,h,m,v){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(l,h,m,v,this.worldview))}addElevatedRoadFeature(i,l,h,m,v){const x=new Array,S=Io.getElevationFeature(i,v);if(!S)return void this.addGeometry(l,this.bufferData);{const N=this.clipPolygonsToTile(l,1);N.length>0&&x.push({polygons:N,elevationFeature:S,elevationTileID:h})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},h),featureIndex:m};for(const N of x)if(N.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new El(N.elevationTileID,this.layers,this.zoom,this.lut));const L=N.elevationFeature.isTunnel();let z=0;i.properties.hasOwnProperty(Vr)&&(z=+i.properties[Vr]),this.elevatedStructures.addPortalCandidates(N.elevationFeature.id,N.polygons,L,N.elevationFeature,z)}N.elevationFeature.constantHeight==null&&(N.polygons=this.prepareElevatedPolygons(N.polygons,N.elevationFeature,N.elevationTileID));const M=new Jl(h,N.elevationTileID);this.addElevatedGeometry(N.polygons,M,N.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m,A)}}addElevatedGeometry(i,l,h,m,v,x){const S={elevation:h,elevationSampler:l,bias:m,index:v,featureInfo:x},[A,N]=this.addGeometry(i,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:N}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,N))}addGeometry(i,l,h){let m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=null;h&&(x=h.elevationSampler.constantElevation(h.elevation,h.bias),x!=null&&(m=x,v=x));const S=(A,N,M)=>{if(h!=null)if(N.push(A),x!=null)l.elevatedLayoutVertexArray.emplaceBack(x),M.push(x);else{const L=h.elevationSampler.pointElevation(A,h.elevation,h.bias);l.elevatedLayoutVertexArray.emplaceBack(L),M.push(L),m=Math.min(m,L),v=Math.max(v,L)}};for(const A of i){let N=0;for(const de of A)N+=de.length;const M=l.triangleSegments.prepareSegment(N,l.layoutVertexArray,l.indexArray),L=M.vertexLength,z=[],W=[],H=[],Q=[],ne=[],te=l.layoutVertexArray.length;for(const de of A){if(de.length===0)continue;de!==A[0]&&W.push(z.length/2);const pe=l.lineSegments.prepareSegment(de.length,l.layoutVertexArray,l.lineIndexArray),Se=pe.vertexLength;h&&ne.push(l.layoutVertexArray.length-te),S(de[0],H,Q),l.layoutVertexArray.emplaceBack(de[0].x,de[0].y),l.lineIndexArray.emplaceBack(Se+de.length-1,Se),z.push(de[0].x),z.push(de[0].y);for(let we=1;we<de.length;we++)S(de[we],H,Q),l.layoutVertexArray.emplaceBack(de[we].x,de[we].y),l.lineIndexArray.emplaceBack(Se+we-1,Se+we),z.push(de[we].x),z.push(de[we].y);pe.vertexLength+=de.length,pe.primitiveLength+=de.length}const le=C_(z,W);for(let de=0;de<le.length;de+=3)l.indexArray.emplaceBack(L+le[de],L+le[de+1],L+le[de+2]);if(le.length>0&&h&&this.elevationMode==="hd-road-base"){const de=h.elevation.isTunnel(),pe=h.elevation.safeArea,Se=this.elevatedStructures.addVertices(H,Q);this.elevatedStructures.addTriangles(le,Se,de);const we=ne.length;if(we>0){for(let Ie=0;Ie<we-1;Ie++)this.elevatedStructures.addRenderableRing(h.index,ne[Ie]+Se,ne[Ie+1]-ne[Ie],de,pe,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,ne[we-1]+Se,H.length-ne[we-1],de,pe,h.featureInfo)}}M.vertexLength+=N,M.primitiveLength+=le.length/3}return[m,v]}prepareElevatedPolygons(i,l,h){const m=1/Mt(h),v=[];for(const x of i){const S=Ude(x,new Zo(l,m));v.push(...S)}return v}clipPolygonsToTile(i,l){const h=-l,m=-l,v=Wt+l,x=Wt+l;let S=0;const A=[],N=[];for(;S<i.length;S++){const z=i[S],W=vg(z);(W.min.x>=h&&W.max.x<=v&&W.min.y>=m&&W.max.y<=x?A:N).push(z)}if(A.length===i.length)return i;const M=[new kt(h,m),new kt(v,m),new kt(v,x),new kt(h,x),new kt(h,m)],L=A;for(const z of N)L.push(...Vde(z,M));return L}}let $V,VV,UV,qV;ir(oR,"FillBucket",{omit:["layers","patternFeatures"]}),ir(aR,"FillBufferData"),ir(El,"ElevatedStructures");class Qj{constructor(i,l,h,m){if(this.triangleCount=l.length/3,this.min=new kt(0,0),this.max=new kt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[v,x]=[i[0].clone(),i[0].clone()];for(let L=1;L<i.length;++L){const z=i[L];v.x=Math.min(v.x,z.x),v.y=Math.min(v.y,z.y),x.x=Math.max(x.x,z.x),x.y=Math.max(x.y,z.y)}if(m){const L=Math.ceil(Math.max(x.x-v.x,x.y-v.y)/m);h=Math.max(h,L)}if(h===0)return;this.min=v,this.max=x;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const A=Math.max(S.x,S.y)/h;this.cellsX=Math.max(1,Math.ceil(S.x/A)),this.cellsY=Math.max(1,Math.ceil(S.y/A)),this.xScale=1/A,this.yScale=1/A;const N=[];for(let L=0;L<this.triangleCount;L++){const z=i[l[3*L+0]].sub(this.min),W=i[l[3*L+1]].sub(this.min),H=i[l[3*L+2]].sub(this.min),Q=Yd(Math.floor(Math.min(z.x,W.x,H.x)),this.xScale,this.cellsX),ne=Yd(Math.floor(Math.max(z.x,W.x,H.x)),this.xScale,this.cellsX),te=Yd(Math.floor(Math.min(z.y,W.y,H.y)),this.yScale,this.cellsY),le=Yd(Math.floor(Math.max(z.y,W.y,H.y)),this.yScale,this.cellsY),de=new kt(0,0),pe=new kt(0,0),Se=new kt(0,0),we=new kt(0,0);for(let Ie=te;Ie<=le;++Ie){de.y=pe.y=Ie*A,Se.y=we.y=(Ie+1)*A;for(let Oe=Q;Oe<=ne;++Oe)de.x=Se.x=Oe*A,pe.x=we.x=(Oe+1)*A,(Uu(z,W,H,de,pe,we)||Uu(z,W,H,de,we,Se))&&N.push({cellIdx:Ie*this.cellsX+Oe,triIdx:L})}}if(N.length===0)return;N.sort((L,z)=>L.cellIdx-z.cellIdx||L.triIdx-z.triIdx);let M=0;for(;M<N.length;){const L=N[M].cellIdx,z={start:this.payload.length,len:0};for(;M<N.length&&N[M].cellIdx===L;)++z.len,this.payload.push(N[M++].triIdx);this.cells[L]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,l){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const h=Yd(i.x-this.min.x,this.xScale,this.cellsX),m=Yd(i.y-this.min.y,this.yScale,this.cellsY),v=this.cells[m*this.cellsX+h];if(v){this._lazyInitLookup();for(let x=0;x<v.len;x++){const S=this.payload[v.start+x],A=Math.floor(S/8),N=1<<S%8;if(!(this.lookup[A]&N)&&(this.lookup[A]|=N,l.push(S),l.length===this.triangleCount))return}}}query(i,l,h){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>l.x||i.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const m=Yd(i.x-this.min.x,this.xScale,this.cellsX),v=Yd(l.x-this.min.x,this.xScale,this.cellsX),x=Yd(i.y-this.min.y,this.yScale,this.cellsY),S=Yd(l.y-this.min.y,this.yScale,this.cellsY);for(let A=x;A<=S;A++)for(let N=m;N<=v;N++){const M=this.cells[A*this.cellsX+N];if(M)for(let L=0;L<M.len;L++){const z=this.payload[M.start+L],W=Math.floor(z/8),H=1<<z%8;if(!(this.lookup[W]&H)&&(this.lookup[W]|=H,h.push(z),h.length===this.triangleCount))return}}}}function Yd(u,i,l){return Math.max(0,Math.min(l-1,Math.floor(u*i)))}ir(Qj,"TriangleGridIndex");class GV{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){for(const h of this.footprints)l.push({footprint:h,id:i})}updateAppearances(i,l,h,m){}populate(i,l,h,m){const v=[];for(const{feature:x,id:S,index:A,sourceLayerIndex:N}of i){const M=this.layers[0]._featureFilter.needGeometry,L=Gr(x,M);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),L,h))continue;const z={id:S,properties:x.properties,type:x.type,sourceLayerIndex:N,index:A,geometry:M?L.geometry:Cr(x,h,m),patterns:{}};v.push(z)}for(const x of v){const{geometry:S,index:A,sourceLayerIndex:N}=x;this.addFeature(x,S,A,h,{},l.availableImages,l.brightness),l.featureIndex.insert(i[A].feature,S,A,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,l,h,m,v,x,S){}destroy(){}addFeature(i,l,h,m,v,x=[],S){for(const A of c1(l,2)){const N=[],M=[],L=[],z=new kt(1/0,1/0),W=new kt(-1/0,-1/0);for(const ne of A)if(ne.length!==0){ne!==A[0]&&L.push(M.length/2);for(let te=0;te<ne.length;te++)M.push(ne[te].x),M.push(ne[te].y),N.push(ne[te]),z.x=Math.min(z.x,ne[te].x),z.y=Math.min(z.y,ne[te].y),W.x=Math.max(W.x,ne[te].x),W.y=Math.max(W.y,ne[te].y)}const H=C_(M,L),Q=new Qj(N,H,8,256);this.footprints.push({vertices:N,indices:H,grid:Q,min:z,max:W})}}}ir(GV,"ClipBucket",{omit:["layers"]});const qde=ln([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gde=ln([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Wde=ln([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Hde=ln([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Zde=ln([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Xde=ln([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Kde=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Yde}=qde,h1=Number.MAX_SAFE_INTEGER,Jde=h1-1;function WV(u,i,l,h){return u.order<i||u.order===h1||!(u.clipMask&l)||function(m,v){return v.length!==0&&v.find(x=>x===m)===void 0}(h,u.clipScope)}function eA(u,i){return u.x-i.x||u.y-i.y}function HV(u,i){return eA(u.min,i.min)===0&&eA(u.max,i.max)===0}function lR(u,i){return!(u.min.x>i.max.x||u.max.x<i.min.x||u.min.y>i.max.y||u.max.y<i.min.y)}function tA(u,i){if(u.length!==i.length)return!1;for(let l=0;l<u.length;l++)if(u[l].sourceId!==i[l].sourceId||!HV(u[l],i[l])||u[l].order!==i[l].order||u[l].clipMask!==i[l].clipMask||!Ba(u[l].clipScope,i[l].clipScope))return!1;return!0}function ZV(u,i,l){const h=1/Wt,m=1/(1<<l.canonical.z),v=(i.x*h+l.canonical.x)*m+l.wrap,x=(i.y*h+l.canonical.y)*m;return{min:new kt((u.x*h+l.canonical.x)*m+l.wrap,(u.y*h+l.canonical.y)*m),max:new kt(v,x)}}function Qde(u,i,l){const h=1<<l.canonical.z,m=((i.x-l.wrap)*h-l.canonical.x)*Wt,v=(i.y*h-l.canonical.y)*Wt;return{min:new kt(((u.x-l.wrap)*h-l.canonical.x)*Wt,(u.y*h-l.canonical.y)*Wt),max:new kt(m,v)}}function cR(u,i,l,h,m,v,x){const S=u.indices,A=u.vertices,N=[];for(let M=h;M<h+m;M+=3){const L=i[l[M+0]+v],z=i[l[M+1]+v],W=i[l[M+2]+v],H=Math.min(L.x,z.x,W.x),Q=Math.max(L.x,z.x,W.x),ne=Math.min(L.y,z.y,W.y),te=Math.max(L.y,z.y,W.y);N.length=0,u.grid.query(new kt(H,ne),new kt(Q,te),N);for(let le=0;le<N.length;le++){const de=N[le];if(Uu(A[S[3*de+0]],A[S[3*de+1]],A[S[3*de+2]],L,z,W,x))return!0}}return!1}function XV(u,i,l,h){if(!u||!l)return!1;let m=u.vertices;if(!i.canonical.equals(h.canonical)||i.wrap!==h.wrap){if(l.vertices.length<u.vertices.length)return XV(l,h,u,i);const v=i.canonical,x=h.canonical,S=Math.pow(2,x.z-v.z);m=u.vertices.map(A=>new kt((A.x+v.x*Wt)*S-x.x*Wt,(A.y+v.y*Wt)*S-x.y*Wt))}return cR(l,m,u.indices,0,u.indices.length,0,0)}function KV(u,i,l,h){const m=Math.pow(2,h.z-l.z);return new kt((u+l.x*Wt)*m-h.x*Wt,(i+l.y*Wt)*m-h.y*Wt)}function YV(u,i){const l=[];i.grid.queryPoint(u,l);const h=i.indices,m=i.vertices;for(let v=0;v<l.length;v++){const x=l[v];if(Ko([m[h[3*x+0]],m[h[3*x+1]],m[h[3*x+2]]],u))return!0}return!1}const uR=[new kt(0,0),new kt(Wt,0),new kt(Wt,Wt),new kt(0,Wt)];function JV(u,i){const l=[];let h=[];if(!i||u.length<2)return[u];if(u.length===2)return su(u[0],u[1],uR)?[u]:[];for(let m=0;m<u.length+2;m++){const v=u[m%u.length],x=u[(m+1)%u.length],S=su(m===0?u[u.length-1]:u[(m-1)%u.length],v,uR),A=su(v,x,uR),N=S||A;N&&h.push(v),N&&A||h.length>0&&(h.length>1&&l.push(h),h=[])}return h.length>1&&l.push(h),l}const dR=un.types,ehe=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],the=["fill-extrusion-flood-light-ground-radius"],rhe=Math.pow(2,13),nhe=Math.pow(2,15)-1,QV=new kt(0,1),rf=2147483648;function f1(u,i,l,h,m,v,x,S){u.emplaceBack((i<<1)+x,(l<<1)+v,(Math.floor(h*rhe)<<1)+m,Math.round(S))}function p1(u,i,l){u.emplaceBack(i.x*Wt,i.y*Wt,l?1:0)}function rA(u,i,l,h,m,v){u.emplaceBack(i.x,i.y,(l.x<<1)+h,(l.y<<1)+m,v)}function m1(u,i,l){u.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}class e6{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class t6{constructor(){this.centroidXY=new kt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new kt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new kt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new kt(this.max.x-this.min.x,this.max.y-this.min.y)}}class r6{constructor(){this.acc=new kt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,l){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=l.x,i.min.y=i.max.y=l.y)}appendEdge(i,l,h){this.accCount++,this.acc._add(l);let m=!!this.borders;l.x<i.min.x?(i.min.x=l.x,m=!0):l.x>i.max.x&&(i.max.x=l.x,m=!0),l.y<i.min.y?(i.min.y=l.y,m=!0):l.y>i.max.y&&(i.max.y=l.y,m=!0),((l.x===0||l.x===Wt)&&l.x===h.x)!=((l.y===0||l.y===Wt)&&l.y===h.y)&&this.processBorderOverlap(l,h),m&&this.checkBorderIntersection(l,h)}checkBorderIntersection(i,l){l.x<0!=i.x<0&&this.addBorderIntersection(0,jr(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>Wt!=i.x>Wt&&this.addBorderIntersection(1,jr(l.y,i.y,(Wt-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,jr(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>Wt!=i.y>Wt&&this.addBorderIntersection(3,jr(l.x,i.x,(Wt-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,i.x)}}centroid(){return this.accCount===0?new kt(0,0):new kt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0):0}}function n6(u,i){const l=u.add(i)._unit(),h=Pe(u.x*l.x+u.y*l.y,-1,1);var m,v,x;return x=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(x)))/4*nhe*((m=u).x*(v=i).y-m.y*v.x<0?-1:1)}const ihe=[u=>u.x<0,u=>u.x>Wt,u=>u.y<0,u=>u.y>Wt];function she(u,i,l,h){const m=[4];if(h===0)return m;l._mult(h);const v=u.sub(l),x=i.sub(l),S=[u,i,v,x];for(let A=0;A<4;A++)for(const N of S)if(ihe[A](N)){m.push(A);break}return m}class hR{constructor(i){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Ww,this.indexArray=new Ps,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut},l=>the.includes(l)),this._segments=new bi,this.hiddenByLandmarkVertexArray=new T_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new bi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,l,h,m=!1){const v=i.length;if(v>2){let x=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*v,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let A;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const N=i[0],M=i[1];A=n6(N.sub(i[v-1])._perp()._unit(),M.sub(N)._perp()._unit())}for(let N=0;N<v;N++){const M=N===v-1?0:N+1,L=i[N],z=i[M],W=i[M===v-1?0:M+1],H=z.sub(L)._perp()._unit(),Q=n6(H,W.sub(z)._perp()._unit()),ne=A,te=Q;if(fR(L,z,l)||m&&a6(L,l)&&a6(z,l)){A=Q;continue}const le=S.vertexLength;rA(this.vertexArray,L,z,1,1,ne),rA(this.vertexArray,L,z,1,0,ne),rA(this.vertexArray,L,z,0,1,te),rA(this.vertexArray,L,z,0,0,te),S.vertexLength+=4;const de=she(L,z,H,h);for(const pe of de)this._segmentToGroundQuads[x].push({id:le,region:pe}),this._segmentToRegionTriCounts[x][pe]+=2,S.primitiveLength+=2;A=Q}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),l=i.length;for(let h=0;h<l;h++)this._segmentToGroundQuads[h].sort((m,v)=>m.region-v.region);for(let h=0;h<l;h++){const m=this._segmentToGroundQuads[h],v=i[h],x=this._segmentToRegionTriCounts[h];x.reduce((A,N)=>A+N,0);let S=0;for(let A=0;A<=4;A++){const N=x[A];if(N!==0){let M=this.regionSegments[A];M||(M=this.regionSegments[A]=new bi);const L={vertexOffset:v.vertexOffset,primitiveOffset:v.primitiveOffset+S,vertexLength:v.vertexLength,primitiveLength:N};M.get().push(L)}S+=N}for(let A=0;A<m.length;A++){const N=m[A].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,l,h,m,v,x,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,l,h,m,v,x,void 0,S)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Gde.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=i.createVertexBuffer(this.groundRadiusArray,Wde.members)))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,l,h,m,v,x,S,A){this.hasData()&&this.programConfigurations.updatePaintArrays(i,l,h,m,v,x,S,A)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&rf))}updateHiddenByLandmarkRange(i,l,h){if(!this.hasData())return;const m=l+i;if(l!==0){for(let v=i;v<m;++v)this.hiddenByLandmarkVertexArray.emplace(v,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,Xde.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const l=this.regionSegments[i];l&&l.destroy()}}}}class nA{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ps,this.footprintVertices=new Hd,this.footprintSegments=[],this.layoutVertexArray=new Vu,this.centroidVertexArray=new Oj,this.wallVertexArray=new Rj,this.indexArray=new Ps,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut},l=>ehe.includes(l)),this.segments=new bi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new hR(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,m){}populate(i,l,h,m){this.features=[],this.hasPattern=KO("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Mt(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:v,id:x,index:S,sourceLayerIndex:A}of i){const N=this.layers[0]._featureFilter.needGeometry,M=Gr(v,N);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),M,h))continue;const L={id:x,sourceLayerIndex:A,index:S,geometry:N?M.geometry:Cr(v,h,m),properties:v.properties,type:v.type,patterns:{}},z=this.layoutVertexArray.length,W=dR[L.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:v.id,feature:YO("fill-extrusion",this.layers,L,this.zoom,this.pixelRatio,l)});else if(this.wallMode)for(const H of L.geometry)for(const Q of JV(H,W))this.addFeature(v.id,L,[Q],S,h,{},l.availableImages,m,l.brightness);else this.addFeature(v.id,L,L.geometry,S,h,{},l.availableImages,m,l.brightness);l.featureIndex.insert(v,L.geometry,S,A,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,l,h,m,v,x){for(const{featureId:S,feature:A}of this.features){const N=dR[A.type]==="Polygon",{geometry:M}=A;if(this.wallMode)for(const L of M)for(const z of JV(L,N))this.addFeature(S,A,[z],A.index,l,h,m,v,x);else this.addFeature(S,A,M,A.index,l,h,m,v,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,l,h,m,v,x,S){this.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,this.worldview),this.groundEffect.update(i,l,v,h,m,x,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Yde),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,Zde.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Kde.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Hde.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,m,v,x,S,A,N){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(l,{})/this.tileToMeter,L=[new kt(0,0),new kt(Wt,Wt)],z=A.projection,W=z.name==="globe",H=this.wallMode||dR[l.type]==="Polygon",Q=new r6;Q.centroidDataIndex=this.centroidData.length;const ne=new t6;ne.buildingId=i,l.properties&&l.properties.hasOwnProperty("building_id")&&(ne.buildingId=Number(l.properties.building_id));const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(l,{},v)<=0,le=this.layers[0].paint.get("fill-extrusion-height").evaluate(l,{},v);let de;if(ne.height=le,ne.vertexArrayOffset=this.layoutVertexArray.length,ne.groundVertexArrayOffset=this.groundEffect.vertexArray.length,W&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new wp),this.wallMode){if(W)return void Nr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;de=function(Fe){const qe=Fe[0].x===Fe[Fe.length-1].x&&Fe[0].y===Fe[Fe.length-1].y;(function(qt){let Ht=0;const xr=qt.length;for(let cr=0;cr<xr;cr++)Ht+=(qt[(cr+1)%xr].x-qt[cr].x)*(qt[(cr+1)%xr].y+qt[cr].y);return Ht>=0})(Fe)||(Fe=Fe.reverse());const at={geometry:[],joinNormals:[],indices:[]},ut=[],bt=[],_t=[];let xt=Fe.length;for(;xt>=2&&Fe[xt-1].equals(Fe[xt-2]);)xt--;if(xt<(qe?3:2))return at;let rt,Tt,mt,jt,wt,Qt=0;for(;Qt<xt-1&&Fe[Qt].equals(Fe[Qt+1]);)Qt++;qe&&(rt=Fe[xt-2],wt=Fe[Qt].sub(rt)._unit()._perp());for(let qt=Qt;qt<xt;qt++){if(mt=qt===xt-1?qe?Fe[Qt+1]:void 0:Fe[qt+1],mt&&Fe[qt].equals(mt))continue;wt&&(jt=wt),rt&&(Tt=rt),rt=Fe[qt],wt=mt?mt.sub(rt)._unit()._perp():jt,jt=jt||wt;let Ht=jt.add(wt);Ht.x===0&&Ht.y===0||Ht._unit();const xr=Ht.x*wt.x+Ht.y*wt.y,cr=xr!==0?1/xr:1/0,Yt=jt.x*wt.y-jt.y*wt.x>0;let kr="miter";const nn=2;kr==="miter"&&cr>nn&&(kr="bevel"),kr==="bevel"&&(cr>100&&(kr="flipbevel"),cr<nn&&(kr="miter"));const En=(en,Hn,yn,Xi)=>{const wn=new kt(en.x,en.y),Vn=new kt(en.x,en.y);wn.x+=Hn.x*Xi,wn.y+=Hn.y*Xi,Vn.x-=Hn.x*Math.max(yn,1),Vn.y-=Hn.y*Math.max(yn,1),_t.push(Hn),ut.push(wn),bt.push(Vn)};if(kr==="miter")Ht._mult(cr),En(rt,Ht,0,0);else if(kr==="flipbevel")Ht=wt.mult(-1),En(rt,Ht,0,0),En(rt,Ht.mult(-1),0,0);else{const en=-Math.sqrt(cr*cr-1),Hn=Yt?en:0,yn=Yt?0:en;Tt&&En(rt,jt,Hn,yn),mt&&En(rt,wt,Hn,yn)}}at.geometry=[...ut,...bt.reverse(),ut[0]],at.joinNormals=[..._t,..._t.reverse(),_t[_t.length-1]];const er=at.geometry.length-1;for(let qt=0;qt<er/2;qt++)if(qt+1<er/2){let Ht=qt,xr=qt+1,cr=er-1-qt,Yt=er-2-qt;Ht=Ht===0?er-1:Ht-1,xr=xr===0?er-1:xr-1,cr=cr===0?er-1:cr-1,Yt=Yt===0?er-1:Yt-1,at.indices.push(cr),at.indices.push(xr),at.indices.push(Ht),at.indices.push(cr),at.indices.push(Yt),at.indices.push(xr)}return at}(h[0]),h=[de.geometry]}const pe=(Fe,qe)=>Fe<(qe.length-1)/2||Fe===qe.length-1,Se=this.wallMode?[h]:c1(h,500);for(let Fe=Se.length-1;Fe>=0;Fe--){const qe=Se[Fe];(qe.length===0||ohe(qe[0]))&&Se.splice(Fe,1)}let we;if(W)we=u6(Se,L,v);else{we=[];for(const Fe of Se)we.push({polygon:Fe,bounds:L})}const Ie=H?this.edgeRadius:0,Oe=Ie>0&&this.zoom<17,Ne=(Fe,qe)=>{if(Fe.length===0)return!1;const ht=Fe[Fe.length-1];return qe.x===ht.x&&qe.y===ht.y};for(const{polygon:Fe,bounds:qe}of we){let ht=0,at=0;for(const xt of Fe)H&&!xt[0].equals(xt[xt.length-1])&&xt.push(xt[0]),at+=H?xt.length-1:xt.length;const ut=this.segments.prepareSegment((H?5:4)*at,this.layoutVertexArray,this.indexArray);ne.footprintSegIdx<0&&(ne.footprintSegIdx=this.footprintSegments.length),ne.polygonSegIdx<0&&(ne.polygonSegIdx=this.polygonSegments.length);const bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},_t=new e6;if(_t.vertexOffset=this.footprintVertices.length,_t.indexOffset=3*this.footprintIndices.length,_t.ringIndices=[],H){const xt=[],rt=[];ht=ut.vertexLength;for(let mt=0;mt<Fe.length;mt++){const jt=Fe[mt];jt.length&&mt!==0&&rt.push(xt.length/2);const wt=[];let Qt,er;Qt=jt[1].sub(jt[0])._perp()._unit(),_t.ringIndices.push(jt.length-1);for(let qt=1;qt<jt.length;qt++){const Ht=jt[qt],xr=jt[qt===jt.length-1?1:qt+1],cr=Ht.clone();if(Ie){er=xr.sub(Ht)._perp()._unit();const Yt=Qt.add(er)._unit(),kr=Ie*Math.min(4,1/(Qt.x*Yt.x+Qt.y*Yt.y));cr.x+=kr*Yt.x,cr.y+=kr*Yt.y,cr.x=Math.round(cr.x),cr.y=Math.round(cr.y),Qt=er}if(!te||Ie!==0&&!Oe||Ne(wt,cr)||wt.push(cr),f1(this.layoutVertexArray,cr.x,cr.y,0,0,1,1,0),this.wallMode){const Yt=pe(qt,jt);p1(this.wallVertexArray,de.joinNormals[qt],!Yt)}ut.vertexLength++,this.footprintVertices.emplaceBack(Ht.x,Ht.y),xt.push(Ht.x,Ht.y),W&&m1(this.layoutVertexExtArray,z.projectTilePoint(cr.x,cr.y,v),z.upVector(v,cr.x,cr.y))}te&&(Ie===0||Oe)&&(wt.length!==0&&Ne(wt,wt[0])&&wt.pop(),this.groundEffect.addData(wt,qe,M))}const Tt=this.wallMode?de.indices:C_(xt,rt);for(let mt=0;mt<Tt.length;mt+=3)this.footprintIndices.emplaceBack(_t.vertexOffset+Tt[mt+0],_t.vertexOffset+Tt[mt+1],_t.vertexOffset+Tt[mt+2]),this.indexArray.emplaceBack(ht+Tt[mt],ht+Tt[mt+2],ht+Tt[mt+1]),ut.primitiveLength++;_t.indexCount+=Tt.length,_t.vertexCount+=this.footprintVertices.length-_t.vertexOffset}for(let xt=0;xt<Fe.length;xt++){const rt=Fe[xt];Q.startRing(ne,rt[0]);let Tt=rt.length>4&&o6(rt[rt.length-2],rt[0],rt[1]),mt=Ie?ahe(rt[rt.length-2],rt[0],rt[1],Ie):0;const jt=[];let wt,Qt,er;Qt=rt[1].sub(rt[0])._perp()._unit();let qt=!0;for(let Ht=1,xr=0;Ht<rt.length;Ht++){let cr=rt[Ht-1],Yt=rt[Ht];const kr=rt[Ht===rt.length-1?1:Ht+1];if(Q.appendEdge(ne,Yt,cr),fR(Yt,cr,qe)){Ie&&(Qt=kr.sub(Yt)._perp()._unit(),qt=!qt);continue}const nn=Yt.sub(cr)._perp(),En=nn.x/(Math.abs(nn.x)+Math.abs(nn.y)),en=nn.y>0?1:0,Hn=cr.dist(Yt);if(xr+Hn>32768&&(xr=0),Ie){er=kr.sub(Yt)._perp()._unit();let Vn=s6(cr,Yt,kr,i6(Qt,er),Ie);isNaN(Vn)&&(Vn=0);const yi=Yt.sub(cr)._unit();cr=cr.add(yi.mult(mt))._round(),Yt=Yt.add(yi.mult(-Vn))._round(),mt=Vn,Qt=er,te&&this.zoom>=17&&(Ne(jt,cr)||jt.push(cr),Ne(jt,Yt)||jt.push(Yt))}const yn=ut.vertexLength,Xi=rt.length>4&&o6(cr,Yt,kr);let wn=l6(xr,Tt,qt);if(f1(this.layoutVertexArray,cr.x,cr.y,En,en,0,0,wn),f1(this.layoutVertexArray,cr.x,cr.y,En,en,0,1,wn),this.wallMode){const Vn=pe(Ht-1,rt),yi=de.joinNormals[Ht-1];p1(this.wallVertexArray,yi,Vn),p1(this.wallVertexArray,yi,Vn)}if(xr+=Hn,wn=l6(xr,Xi,!qt),Tt=Xi,f1(this.layoutVertexArray,Yt.x,Yt.y,En,en,0,0,wn),f1(this.layoutVertexArray,Yt.x,Yt.y,En,en,0,1,wn),this.wallMode){const Vn=pe(Ht,rt),yi=de.joinNormals[Ht];p1(this.wallVertexArray,yi,Vn),p1(this.wallVertexArray,yi,Vn)}if(ut.vertexLength+=4,this.indexArray.emplaceBack(yn+0,yn+1,yn+2),this.indexArray.emplaceBack(yn+1,yn+3,yn+2),ut.primitiveLength+=2,Ie){const Vn=ht+(Ht===1?rt.length-2:Ht-2),yi=Ht===1?ht:Vn+1;if(this.indexArray.emplaceBack(yn+1,Vn,yn+3),this.indexArray.emplaceBack(Vn,yi,yn+3),ut.primitiveLength+=2,wt===void 0&&(wt=yn),!fR(kr,rt[Ht],qe)){const Ai=Ht===rt.length-1?wt:ut.vertexLength;this.indexArray.emplaceBack(yn+2,yn+3,Ai),this.indexArray.emplaceBack(yn+3,Ai+1,Ai),this.indexArray.emplaceBack(yn+3,yi,Ai+1),ut.primitiveLength+=3}qt=!qt}if(W){const Vn=this.layoutVertexExtArray,yi=z.projectTilePoint(cr.x,cr.y,v),Ai=z.projectTilePoint(Yt.x,Yt.y,v),Ci=z.upVector(v,cr.x,cr.y),Ki=z.upVector(v,Yt.x,Yt.y);m1(Vn,yi,Ci),m1(Vn,yi,Ci),m1(Vn,Ai,Ki),m1(Vn,Ai,Ki)}}H&&(ht+=rt.length-1),te&&Ie&&this.zoom>=17&&(jt.length!==0&&Ne(jt,jt[0])&&jt.pop(),this.groundEffect.addData(jt,qe,M,Ie>0))}this.footprintSegments.push(_t),bt.triangleCount=this.indexArray.length-bt.triangleArrayOffset,this.polygonSegments.push(bt),++ne.footprintSegLen,++ne.polygonSegLen}if(ne.vertexCount=this.layoutVertexArray.length-ne.vertexArrayOffset,ne.groundVertexCount=this.groundEffect.vertexArray.length-ne.groundVertexArrayOffset,ne.vertexCount!==0){if(ne.centroidXY=Q.borders?QV:this.encodeCentroid(Q,ne),this.centroidData.push(ne),Q.borders){this.featuresOnBorder.push(Q);const Fe=this.featuresOnBorder.length-1;for(let qe=0;qe<Q.borders.length;qe++)Q.borders[qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[qe].push(Fe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,x,S,v,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(l,m,x,S,v,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,le)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((l,h)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[h].borders[i][0])}splitToSubtiles(){const i=[];for(let S=0;S<this.centroidData.length;S++){const A=this.centroidData[S],N=+(A.min.y+A.max.y>Wt),M=2*N+(+(A.min.x+A.max.x>Wt)^N);for(let L=0;L<A.polygonSegLen;L++){const z=A.polygonSegIdx+L;i.push({centroidIdx:S,subtile:M,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const l=new Ps;i.sort((S,A)=>S.triangleSegmentIdx===A.triangleSegmentIdx?S.subtile-A.subtile:S.triangleSegmentIdx-A.triangleSegmentIdx);let h=0,m=0,v=0;for(const S of i){if(S.triangleSegmentIdx!==h)break;v++}const x=i.length;for(;m!==i.length;){h=i[m].triangleSegmentIdx;let S=0,A=m,N=m;for(let M=A;M<v&&i[M].subtile===S;M++)N++;for(;A!==v;){const M=i[A];S=M.subtile;const L=this.centroidData[M.centroidIdx].min.clone(),z=this.centroidData[M.centroidIdx].max.clone(),W={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=A;H<N;H++){const Q=i[H],ne=this.polygonSegments[Q.polygonSegmentIdx],te=this.centroidData[Q.centroidIdx].min,le=this.centroidData[Q.centroidIdx].max,de=this.indexArray.uint16;for(let pe=ne.triangleArrayOffset;pe<ne.triangleArrayOffset+ne.triangleCount;pe++)l.emplaceBack(de[3*pe],de[3*pe+1],de[3*pe+2]);W.primitiveLength+=ne.triangleCount,L.x=Math.min(L.x,te.x),L.y=Math.min(L.y,te.y),z.x=Math.max(z.x,le.x),z.y=Math.max(z.y,le.y)}W.primitiveLength>0&&this.triangleSubSegments.push({segment:W,min:L,max:z}),A=N;for(let H=A;H<v&&i[H].subtile===i[A].subtile;H++)N++}m=v;for(let M=m;M<x&&i[M].triangleSegmentIdx===i[m].triangleSegmentIdx;M++)v++}l._trim(),this.indexArray=l}getVisibleSegments(i,l,h){const m=new bi;if(this.wallMode){for(const Q of this.triangleSubSegments)m.segments.push(Q.segment);return m}let v=0,x=0;const S=1<<i.canonical.z;if(l){const Q=l.getMinMaxForTile(i);Q&&(v=Q.min,x=Q.max)}x+=this.maxHeight;const A=i.toUnwrapped();let N;const M=[A.canonical.x/S+A.wrap,A.canonical.y/S],L=[(A.canonical.x+1)/S+A.wrap,(A.canonical.y+1)/S],z=(Q,ne,te)=>[Q[0]*(1-te[0])+ne[0]*te[0],Q[1]*(1-te[1])+ne[1]*te[1]],W=[],H=[];for(const Q of this.triangleSubSegments){W[0]=Q.min.x/Wt,W[1]=Q.min.y/Wt,H[0]=Q.max.x/Wt,H[1]=Q.max.y/Wt;const ne=z(M,L,W),te=z(M,L,H);if(new Pn([ne[0],ne[1],v],[te[0],te[1],x]).intersectsPrecise(h)===0){N&&(m.segments.push(N),N=void 0);continue}const le=Q.segment;N&&N.vertexOffset!==le.vertexOffset&&(m.segments.push(N),N=void 0),N?(N.vertexLength+=le.vertexLength,N.primitiveLength+=le.primitiveLength):N={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&m.segments.push(N),m}encodeCentroid(i,l){const h=i.centroid(),m=l.span(),v=Math.min(7,Math.round(m.x*this.tileToMeter/10)),x=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new kt(Pe(h.x,1,8191)<<3|v,Pe(h.y,1,8191)<<3|x)}encodeBorderCentroid(i){if(!i.borders)return new kt(0,0);const l=i.borders,h=Number.MAX_VALUE;if(l[0][0]!==h||l[1][0]!==h){const m=l[0][0]!==h?0:1;return new kt(6|(l[0][0]!==h?0:65528),(l[m][0]+l[m][1])/2<<3|6)}{const m=l[2][0]!==h?2:3;return new kt((l[m][0]+l[m][1])/2<<3|6,6|(l[2][0]!==h?0:65528))}}showCentroid(i){const l=this.centroidData[i.centroidDataIndex];l.flags&=2147483647,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const l=i.vertexArrayOffset,h=i.vertexCount+i.vertexArrayOffset,m=i.flags&rf?QV:i.centroidXY,v=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==m.y||v!==m.x){for(let x=l;x<h;++x)this.centroidVertexArray.emplace(x,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(i.toUnwrapped());if(tA(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const v=[];for(const x of this.activeReplacements){if(x.order<h)continue;const S=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-i.canonical.z));if(x.footprint.buildingIds)for(const A of this.centroidData)A.flags&rf||x.min.x>A.max.x||A.min.x>x.max.x||x.min.y>A.max.y||A.min.y>x.max.y||x.footprint.buildingIds.has(A.buildingId)&&(A.flags|=rf);else for(const A of this.centroidData)if(!(A.flags&rf||x.min.x>A.max.x||A.min.x>x.max.x||x.min.y>A.max.y||A.min.y>x.max.y))for(let N=0;N<A.footprintSegLen;N++){const M=this.footprintSegments[A.footprintSegIdx+N];if(v.length=0,lhe(this.footprintVertices,M.vertexOffset,M.vertexCount,x.footprintTileId.canonical,i.canonical,v),cR(x.footprint,v,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-S)){A.flags|=rf;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,l,h){let m=!1;for(let v=0;v<h.footprintSegLen;v++){const x=this.footprintSegments[h.footprintSegIdx+v];let S=0;for(const A of x.ringIndices){for(let N=S,M=A+S-1;N<A+S;M=N++){const L=this.footprintVertices.int16[2*(N+x.vertexOffset)+0],z=this.footprintVertices.int16[2*(N+x.vertexOffset)+1],W=this.footprintVertices.int16[2*(M+x.vertexOffset)+1];z>l!=W>l&&i<(this.footprintVertices.int16[2*(M+x.vertexOffset)+0]-L)*(l-z)/(W-z)+L&&(m=!m)}S=A}}return m}getHeightAtTileCoord(i,l){let h=Number.NEGATIVE_INFINITY,m=!0;const v=4*(i+Wt)*Wt+(l+Wt);if(this.partLookup.hasOwnProperty(v)){const x=this.partLookup[v];return x?{height:x.height,hidden:!!(x.flags&rf)}:void 0}for(const x of this.centroidData)i>x.max.x||x.min.x>i||l>x.max.y||x.min.y>l||x.height<=h||this.footprintContainsPoint(i,l,x)&&(h=x.height,this.partLookup[v]=x,m=!!(x.flags&rf));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:m};this.partLookup[v]=void 0}}function i6(u,i){const l=u.add(i)._unit();return u.x*l.x+u.y*l.y}function ahe(u,i,l,h){const m=i.sub(u)._perp()._unit(),v=l.sub(i)._perp()._unit();return s6(u,i,l,i6(m,v),h)}function s6(u,i,l,h,m){const v=Math.sqrt(1-h*h);return Math.min(u.dist(i)/3,i.dist(l)/3,m*v/h)}function fR(u,i,l){return u.x<l[0].x&&i.x<l[0].x||u.x>l[1].x&&i.x>l[1].x||u.y<l[0].y&&i.y<l[0].y||u.y>l[1].y&&i.y>l[1].y}function a6(u,i){return u.x<i[0].x||u.x>i[1].x||u.y<i[0].y||u.y>i[1].y}function ohe(u){return u.every(i=>i.x<=0)||u.every(i=>i.x>=Wt)||u.every(i=>i.y<=0)||u.every(i=>i.y>=Wt)}function o6(u,i,l){if(u.x<0||u.x>=Wt||i.x<0||i.x>=Wt||l.x<0||l.x>=Wt)return!1;const h=l.sub(i),m=h.perp(),v=u.sub(i);return(h.x*v.x+h.y*v.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(v.x*v.x+v.y*v.y))>-.866&&m.x*v.x+m.y*v.y<0}function l6(u,i,l){const h=i?2|u:-3&u;return l?1|h:-2&h}function c6(){const u=Math.PI/32,i=Math.tan(u),l=Re;return l*Math.sqrt(1+2*i*i)-l}function u6(u,i,l){const h=1<<l.z,m=vt(l.x/h),v=vt((l.x+1)/h),x=At(l.y/h),S=At((l.y+1)/h);return function(A,N,M,L,z=0,W){const H=[];if(!A.length||!M||!L)return H;const Q=(we,Ie)=>{for(const Oe of we)H.push({polygon:Oe,bounds:Ie})},ne=Math.ceil(Math.log2(M)),te=Math.ceil(Math.log2(L)),le=ne-te,de=[];for(let we=0;we<Math.abs(le);we++)de.push(le>0?0:1);for(let we=0;we<Math.min(ne,te);we++)de.push(0),de.push(1);let pe=A;if(pe=Jj(pe,N[0].y-z,N[1].y+z,1),pe=Jj(pe,N[0].x-z,N[1].x+z,0),!pe.length)return H;const Se=[];for(de.length?Se.push({polygons:pe,bounds:N,depth:0}):Q(pe,N);Se.length;){const we=Se.pop(),Ie=we.depth,Oe=de[Ie],Ne=we.bounds[0],Fe=we.bounds[1],qe=Oe===0?Ne.x:Ne.y,ht=Oe===0?Fe.x:Fe.y,at=W?W(Oe,qe,ht):.5*(qe+ht),ut=Jj(we.polygons,qe-z,at+z,Oe),bt=Jj(we.polygons,at-z,ht+z,Oe);if(ut.length){const _t=[Ne,new kt(Oe===0?at:Fe.x,Oe===1?at:Fe.y)];de.length>Ie+1?Se.push({polygons:ut,bounds:_t,depth:Ie+1}):Q(ut,_t)}if(bt.length){const _t=[new kt(Oe===0?at:Ne.x,Oe===1?at:Ne.y),Fe];de.length>Ie+1?Se.push({polygons:bt,bounds:_t,depth:Ie+1}):Q(bt,_t)}}return H}(u,i,Math.ceil((v-m)/11.25),Math.ceil((x-S)/11.25),1,(A,N,M)=>{if(A===0)return .5*(N+M);{const L=At((l.y+N/Wt)/h);return(it(.5*(At((l.y+M/Wt)/h)+L))*h-l.y)*Wt}})}function lhe(u,i,l,h,m,v){const x=Math.pow(2,h.z-m.z);for(let S=0;S<l;S++){let A=u.int16[2*(S+i)+0],N=u.int16[2*(S+i)+1];A=(A+m.x*Wt)*x-h.x*Wt,N=(N+m.y*Wt)*x-h.y*Wt,v.push(new kt(A,N))}}let d6,h6;ir(nA,"FillExtrusionBucket",{omit:["layers","features"]}),ir(t6,"PartData"),ir(e6,"FootprintSegment"),ir(r6,"BorderCentroidData"),ir(hR,"GroundEffect");class Xg extends kt{constructor(i,l,h){super(i,l),this.z=h}}class f6 extends Xg{constructor(i,l,h,m){super(i,l,h),this.w=m}}function p6(u,i,l,h){const m=l==="x"?"y":"x",v=(h-u[l])/(i[l]-u[l]);u[m]=Math.round(u[m]+(i[m]-u[m])*v),u[l]=h,u.hasOwnProperty("z")&&(u.z=jr(u.z,i.z,v)),u.hasOwnProperty("w")&&(u.w=jr(u.w,i.w,v))}function m6(u,i,l,h){const m=l,v=h;for(const x of["x","y"]){let S=u,A=i;S[x]>=A[x]&&(S=i,A=u),S[x]<m&&A[x]>m&&p6(S,A,x,m),S[x]<v&&A[x]>v&&p6(A,S,x,v)}}function iA(u,i,l,h,m,v){const x=[];for(let S=0;S<u.length;S++){const A=u[S];let N;const M=x.length;let L=0;for(let z=0;z<A.length-1;z++){let W=A[z],H=A[z+1],Q=0;const ne=L;let te,le;v&&(Q=Math.hypot(H.x-W.x,H.y-W.y),L+=Q,te=W,le=H),W.x<i&&H.x<i||(W.x<i?W=new kt(i,W.y+(i-W.x)/(H.x-W.x)*(H.y-W.y))._round():H.x<i&&(H=new kt(i,W.y+(i-W.x)/(H.x-W.x)*(H.y-W.y))._round()),W.y<l&&H.y<l||(W.y<l?W=new kt(W.x+(l-W.y)/(H.y-W.y)*(H.x-W.x),l)._round():H.y<l&&(H=new kt(W.x+(l-W.y)/(H.y-W.y)*(H.x-W.x),l)._round()),W.x>=h&&H.x>=h||(W.x>=h?W=new kt(h,W.y+(h-W.x)/(H.x-W.x)*(H.y-W.y))._round():H.x>=h&&(H=new kt(h,W.y+(h-W.x)/(H.x-W.x)*(H.y-W.y))._round()),W.y>=m&&H.y>=m||(W.y>=m?W=new kt(W.x+(m-W.y)/(H.y-W.y)*(H.x-W.x),m)._round():H.y>=m&&(H=new kt(W.x+(m-W.y)/(H.y-W.y)*(H.x-W.x),m)._round()),N&&W.equals(N[N.length-1])||(N=[W],x.push(N),v&&v.push({progress:{min:ne+g6(te,le,W)*Q,max:1},parentIndex:S,prevPoint:te,nextPoint:le})),N.push(H),v&&(v[v.length-1].progress.max=ne+g6(te,le,H)*Q,v[v.length-1].nextPoint=le)))))}if(v&&L>0)for(let z=M;z<x.length;z++)v[z].progress.min/=L,v[z].progress.max/=L}return x}function che(u,i,l,h,m){if(u.length<2)return void h.push(u);const v=[];for(;i.valid();){const[N,M]=i.get();for(let L=0;L<u.length-1;L++){const z=u[L],W=u[L+1],H=Wg(z,W,N,M);if(H){const[Q]=H,ne=new kt(jr(z.x,W.x,Q),jr(z.y,W.y,Q));v.push({t:L+Q,distance:0,point:ne})}}i.next()}if(v.length===0)return void h.push(u);v.sort((N,M)=>N.t-M.t);let x=0,S=0,A=[];for(h.push(A);x!==u.length;){if(S===v.length){for(;x!==u.length;)A.length!==0&&A[A.length-1].equals(u[x])||A.push(u[x]),x++;break}v[S].t<=x?(A.length!==0&&A[A.length-1].equals(v[S].point)||A.push(v[S].point),Math.trunc(v[S].t),S++):(A.length!==0&&A[A.length-1].equals(u[x])||A.push(u[x]),x++)}}function g6(u,i,l){return u.x!==i.x?(l.x-u.x)/(i.x-u.x):u.y!==i.y?(l.y-u.y)/(i.y-u.y):0}function g1(u,i){return u.x*i.x+u.y*i.y}function y6(u,i){if(u.length===1){let l=0;const h=i[l++];let m;for(;!m||h.equals(m);)if(m=i[l++],!m)return 1/0;for(;l<i.length;l++){const v=i[l],x=u[0],S=m.sub(h),A=v.sub(h),N=x.sub(h),M=g1(S,S),L=g1(S,A),z=g1(A,A),W=g1(N,S),H=g1(N,A),Q=M*z-L*L,ne=(z*W-L*H)/Q,te=(M*H-L*W)/Q,le=h.z*(1-ne-te)+m.z*ne+v.z*te;if(isFinite(le))return le}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}function v6(u,i,l){let h=1/0;ui(l,i)&&(h=y6(l,i[0]));for(let m=0;m<i.length;m++){const v=i[m],x=u[m];for(let S=0;S<v.length-1;S++){const A=v[S],N=[A,v[S+1],x[S+1],x[S],A];ji(l,N)&&(h=Math.min(h,y6(l,N)))}}return h!==1/0&&h}function _6(u,i,l,h,m,v,x,S,A,N,M){return u.projection.name==="globe"?function(L,z,W,H,Q,ne,te,le,de,pe,Se){const we=[],Ie=[],Oe=L.projection.upVectorScale(Se,L.center.lat,L.worldSize).metersToTile,Ne=[0,0,0,1],Fe=[0,0,0,1],qe=(at,ut,bt,_t)=>{at[0]=ut,at[1]=bt,at[2]=_t,at[3]=1},ht=c6();W>0&&(W+=ht),H+=ht;for(const at of z){const ut=[],bt=[];for(const _t of at){const xt=_t.x+Q.x,rt=_t.y+Q.y,Tt=L.projection.projectTilePoint(xt,rt,Se),mt=L.projection.upVector(Se,_t.x,_t.y);let jt=W,wt=H;if(te){const Qt=x6(xt,rt,W,H,te,le,de,pe);jt+=Qt.base,wt+=Qt.top}W!==0?qe(Ne,Tt.x+mt[0]*Oe*jt,Tt.y+mt[1]*Oe*jt,Tt.z+mt[2]*Oe*jt):qe(Ne,Tt.x,Tt.y,Tt.z),qe(Fe,Tt.x+mt[0]*Oe*wt,Tt.y+mt[1]*Oe*wt,Tt.z+mt[2]*Oe*wt),pr(Ne,Ne,ne),pr(Fe,Fe,ne),ut.push(new Xg(Ne[0],Ne[1],Ne[2])),bt.push(new Xg(Fe[0],Fe[1],Fe[2]))}we.push(ut),Ie.push(bt)}return[we,Ie]}(u,i,l,h,m,v,x,S,A,N,M):x?function(L,z,W,H,Q,ne,te,le,de){const pe=[],Se=[],we=[0,0,0,1];for(const Ie of L){const Oe=[],Ne=[];for(const Fe of Ie){const qe=Fe.x+H.x,ht=Fe.y+H.y,at=x6(qe,ht,z,W,ne,te,le,de);we[0]=qe,we[1]=ht,we[2]=at.base,we[3]=1,hr(we,we,Q),we[3]=Math.max(we[3],1e-5);const ut=new Xg(we[0]/we[3],we[1]/we[3],we[2]/we[3]);we[0]=qe,we[1]=ht,we[2]=at.top,we[3]=1,hr(we,we,Q),we[3]=Math.max(we[3],1e-5);const bt=new Xg(we[0]/we[3],we[1]/we[3],we[2]/we[3]);Oe.push(ut),Ne.push(bt)}pe.push(Oe),Se.push(Ne)}return[pe,Se]}(i,l,h,m,v,x,S,A,N):function(L,z,W,H,Q){const ne=[],te=[],le=Q[8]*z,de=Q[9]*z,pe=Q[10]*z,Se=Q[11]*z,we=Q[8]*W,Ie=Q[9]*W,Oe=Q[10]*W,Ne=Q[11]*W;for(const Fe of L){const qe=[],ht=[];for(const at of Fe){const ut=at.x+H.x,bt=at.y+H.y,_t=Q[0]*ut+Q[4]*bt+Q[12],xt=Q[1]*ut+Q[5]*bt+Q[13],rt=Q[2]*ut+Q[6]*bt+Q[14],Tt=Q[3]*ut+Q[7]*bt+Q[15],mt=_t+le,jt=xt+de,wt=rt+pe,Qt=Math.max(Tt+Se,1e-5),er=_t+we,qt=xt+Ie,Ht=rt+Oe,xr=Math.max(Tt+Ne,1e-5);qe.push(new Xg(mt/Qt,jt/Qt,wt/Qt)),ht.push(new Xg(er/xr,qt/xr,Ht/xr))}ne.push(qe),te.push(ht)}return[ne,te]}(i,l,h,m,v)}function x6(u,i,l,h,m,v,x,S){const A=x*m.getElevationAt(u,i,!0,!0),N=v[0]!==0,M=N?v[1]===0?x*(v[0]/7-450):x*function(L,z,W){const H=Math.floor(z[0]/8),Q=Math.floor(z[1]/8),ne=10*(z[0]-8*H),te=10*(z[1]-8*Q),le=L.getElevationAt(H,Q,!0,!0),de=L.getMeterToDEM(W),pe=Math.floor(.5*(ne*de-1)),Se=Math.floor(.5*(te*de-1)),we=L.tileCoordToPixel(H,Q),Ie=2*pe+1,Oe=2*Se+1,Ne=function(bt,_t,xt,rt,Tt){return[bt.getElevationAtPixel(_t,xt,!0),bt.getElevationAtPixel(_t+Tt,xt,!0),bt.getElevationAtPixel(_t,xt+Tt,!0),bt.getElevationAtPixel(_t+rt,xt+Tt,!0)]}(L,we.x-pe,we.y-Se,Ie,Oe),Fe=Math.abs(Ne[0]-Ne[1]),qe=Math.abs(Ne[2]-Ne[3]),ht=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),at=Math.min(.25,.5*de*(Fe+qe)/Ie),ut=Math.min(.25,.5*de*ht/Oe);return le+Math.max(at*ne,ut*te)}(m,v,S):A;return{base:A+(l===0?-1:l),top:N?Math.max(M+h,A+l+2):A+h}}class uhe{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class dhe{constructor(){this.tasks={},this.taskQueue=[],tr(["process"],this),this.invoker=new uhe(this.process),this.nextId=0}add(i,l){const h=this.nextId++,m=function({type:v,isSymbolTile:x,zoom:S}){return S=S||0,v==="message"?0:v!=="maybePrepare"||x?v!=="parseTile"||x?v==="parseTile"&&x?300-S:v==="maybePrepare"&&x?400-S:500:200-S:100-S}(l);if(m===0){try{i()}finally{}return null}return this.tasks[h]={fn:i,metadata:l,priority:m,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const v=this.tasks[this.taskQueue[m]];v.priority<l&&(l=v.priority,i=m)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}class b6{constructor(i,l,h){this.target=i,this.parent=l,this.mapId=h,this.callbacks={},this.cancelCallbacks={},tr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new dhe}send(i,l,h,m,v=!1,x){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=x,this.callbacks[S]=h);const A=new Set;return this.target.postMessage({id:S,type:i,hasCallback:!!h,targetMapId:m,mustQueue:v,sourceMapId:this.mapId,data:gc(l,A)},A),{cancel:()=>{h&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(i){const l=i.data;if(!l)return;const h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const m=this.cancelCallbacks[h];delete this.cancelCallbacks[h],m&&m.cancel()}else if(l.mustQueue||Hi(self)){const m=this.callbacks[h],v=this.scheduler.add(()=>this.processTask(h,l),m&&m.metadata||{type:"message"});v&&(this.cancelCallbacks[h]=v)}else this.processTask(h,l)}processTask(i,l){if(delete this.cancelCallbacks[i],l.type==="<response>"){const h=this.callbacks[i];delete this.callbacks[i],h&&(l.error?h(Bu(l.error)):h(null,Bu(l.data)))}else{const h=new Set,m=l.hasCallback?(x,S)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:x?gc(x):null,data:gc(S,h)},h)}:()=>{},v=Bu(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,v,m);else if(this.parent.getWorkerSource){const x=l.type.split("."),{source:S,scope:A}=v;this.parent.getWorkerSource(l.sourceMapId,x[0],S,A)[x[1]](v,m)}else m(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var y1={workerUrl:"",workerClass:null,workerParams:void 0};function hhe(u){return y1.workerClass!=null?new y1.workerClass:new self.Worker(y1.workerUrl,Object.assign({name:u},y1.workerParams))}const pR="mapboxgl_preloaded_worker_pool";class Kg{constructor(i){this.active={},this.name=i}acquire(i,l=Kg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;){const h=hhe(`${this.name||""}WorkerPool: ${i}-${this.workers.length}`);this.workers.push(h)}return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pR]}numActive(){return Object.keys(this.active).length}}Kg.workerCount=2;class k_{constructor(i,l,h="Worker",m=Kg.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Rt();const v=this.workerPool.acquire(this.id,m);for(let x=0;x<v.length;x++){const S=new k_.Actor(v[x],l,this.id);S.name=`${h} ${x}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,h){Xe(this.actors,(m,v)=>{m.send(i,l,v)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let v1,mR;function sA(){return v1||(v1=new Kg),v1}k_.Actor=b6;const gR=4096;class fhe{constructor(i){this.module=i,this.memoryStack=this.module.malloc(gR),this.memoryStackNextFree=this.memoryStack}createIntArray(i){const l=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>gR?-1:(new Int32Array(this.module.heap32.buffer,l,i.length).set(i),l)}createFloatArray(i){const l=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>gR?-1:(new Float32Array(this.module.heapF32.buffer,l,i.length).set(i),l)}readStringBuffer(i){let l="";for(;this.module.heapU8[i]!==0;)l+=String.fromCharCode(this.module.heapU8[i]),++i;return l}setStyle(i){const l=i.normalScale;this.module.setStyle(l[0],l[1],l[2],i.tileToMeters)}setAOOptions(i,l){this.module.setAOOptions(i?1:0,l)}setMetricOptions(i,l){this.module.setMetricOptions(i?1:0,l)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,l){this.module.setFacadeOptions(i,l?1:0)}setFauxFacadeOptions(i,l,h){this.module.setFauxFacadeOptions(i?1:0,l?1:0,h)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,l){this.memoryStackNextFree=this.memoryStack;for(const S of i){const A=this.createIntArray(S.ringIndices),N=this.createFloatArray(S.coordinates);if(A===-1||N===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,S.roofType,N,A,S.ringIndices.length-1)}for(const S of l){let A;A=S.entrances?JSON.parse(S.entrances):[];const N=this.createFloatArray(A),M=this.createFloatArray(S.coordinates);if(N===-1||M===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,N,A.length,M,S.coordinates.length)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const h=this.module.getMeshCount(),m=new Array(h);for(let S=0;S<h;S++){const A=this.module.getPositionsPtr(S),N=this.module.getPositionsLength(S),M=new Float32Array(this.module.heapF32.buffer,A,N),L=this.module.getNormalsPtr(S),z=this.module.getNormalsLength(S),W=new Float32Array(this.module.heapF32.buffer,L,z),H=this.module.getAOPtr(S),Q=this.module.getAOLength(S),ne=new Float32Array(this.module.heapF32.buffer,H,Q),te=this.module.getUVPtr(S),le=this.module.getUVLength(S),de=new Float32Array(this.module.heapF32.buffer,te,le),pe=this.module.getFauxFacadePtr(S),Se=this.module.getFauxFacadeLength(S),we=new Uint8Array(this.module.heapU8.buffer,pe,Se),Ie=this.module.getIndicesPtr(S),Oe=this.module.getIndicesLength(S),Ne=new Int16Array(this.module.heap16.buffer,Ie,Oe),Fe=this.module.getBuildingPart(S);m[S]={positions:M,normals:W,ao:ne,uv:de,isFauxFacade:we,indices:Ne,buildingPart:Fe}}const v=this.module.getRingCount(),x=[];for(let S=0;S<v;S++){const A=this.module.getRingPtr(S),N=this.module.getRingLength(S),M=new Float32Array(this.module.heapF32.buffer,A,N);x.push(M)}return{meshes:m,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:x}}}let _1,yR,qu,O_,vR,R_=null,M_=null,w6=null,aA=null;function S6(){return Hi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:yR||As.DRACO_URL}function T6(){if(Hi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(O_)return O_;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return O_=WebAssembly.validate(u)?As.MESHOPT_SIMD_URL:As.MESHOPT_URL,O_}function phe(){return aA}const E6=5120,j6=5121,A6=5122,C6=5123,P6=5125,N6=5126,oA={[E6]:Int8Array,[j6]:Uint8Array,[A6]:Int16Array,[C6]:Uint16Array,[P6]:Uint32Array,[N6]:Float32Array},mhe={[E6]:"DT_INT8",[j6]:"DT_UINT8",[A6]:"DT_INT16",[C6]:"DT_UINT16",[P6]:"DT_UINT32",[N6]:"DT_FLOAT32"},x1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function I6(u,i,l){const h=l.json.bufferViews.length,m=l.buffers.length;i.bufferView=h,l.json.bufferViews[h]={buffer:m,byteLength:u.byteLength},l.buffers[m]=u}const _R="KHR_draco_mesh_compression";function ghe(u,i){const l=u.extensions&&u.extensions[_R];if(!l)return;const h=new qu.Decoder,m=M6(i,l.bufferView),v=new qu.Mesh;if(!h.DecodeArrayToMesh(m,m.byteLength,v))throw new Error("Failed to decode Draco mesh");const x=i.json.accessors[u.indices],S=oA[x.componentType],A=x.count*S.BYTES_PER_ELEMENT,N=qu._malloc(A);S===Uint16Array?h.GetTrianglesUInt16Array(v,A,N):h.GetTrianglesUInt32Array(v,A,N),I6(qu.memory.buffer.slice(N,N+A),x,i),qu._free(N);for(const M of Object.keys(l.attributes)){const L=h.GetAttributeByUniqueId(v,l.attributes[M]),z=i.json.accessors[u.attributes[M]],W=mhe[z.componentType],H=z.count*x1[z.type]*oA[z.componentType].BYTES_PER_ELEMENT,Q=qu._malloc(H);h.GetAttributeDataArrayForAllPoints(v,L,qu[W],H,Q),I6(qu.memory.buffer.slice(Q,Q+H),z,i),qu._free(Q)}h.destroy(),v.destroy(),delete u.extensions[_R]}const lA="EXT_meshopt_compression";function yhe(u,i){if(!u.extensions||!u.extensions[lA])return;const l=u.extensions[lA],h=new Uint8Array(i.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),m=new Uint8Array(l.count*l.byteStride);vR.decodeGltfBuffer(m,l.count,l.byteStride,h,l.mode,l.filter),u.buffer=i.buffers.length,u.byteOffset=0,i.buffers[u.buffer]=m.buffer,delete u.extensions[lA]}const k6=1179937895,O6=new TextDecoder("utf8");function R6(u,i){return new URL(u,i).href}function vhe(u,i,l,h){return fetch(R6(u.uri,h)).then(m=>m.arrayBuffer()).then(m=>{i.buffers[l]=m})}function M6(u,i){const l=u.json.bufferViews[i];return new Uint8Array(u.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function _he(u,i,l,h){if(u.uri){const m=R6(u.uri,h);return fetch(m).then(v=>v.blob()).then(v=>createImageBitmap(v)).then(v=>{i.images[l]=v})}if(u.bufferView!==void 0){const m=M6(i,u.bufferView),v=new Blob([m],{type:u.mimeType});return createImageBitmap(v).then(x=>{i.images[l]=x})}}function D6(u,i=0,l){const h={json:null,images:[],buffers:[]};if(new Uint32Array(u,i,1)[0]===k6){const M=new Uint32Array(u,i);let L=2;const z=(M[L++]>>2)-3,W=M[L++]>>2;if(L++,h.json=JSON.parse(O6.decode(M.subarray(L,L+W))),L+=W,L<z){const H=M[L++];L++;const Q=i+(L<<2);h.buffers[0]=u.slice(Q,Q+H)}}else h.json=JSON.parse(O6.decode(new Uint8Array(u,i)));const{buffers:m,images:v,meshes:x,extensionsUsed:S,bufferViews:A}=h.json;let N=Promise.resolve();if(m){const M=[];for(let L=0;L<m.length;L++){const z=m[L];z.uri?M.push(vhe(z,h,L,l)):h.buffers[L]||(h.buffers[L]=null)}N=Promise.all(M)}return N.then(()=>{const M=[],L=S&&S.includes(_R),z=S&&S.includes(lA);if(L&&M.push(function(){if(!qu)return _1??(_1=function(W){let H,Q=null;function ne(){H=new Uint8Array(Q.buffer)}function te(){throw new Error("Unexpected Draco error.")}const le={a:{a:te,d:function(de,pe,Se){return H.copyWithin(de,pe,pe+Se)},c:function(de){const pe=H.length,Se=Math.max(de>>>0,Math.ceil(1.2*pe)),we=Math.ceil((Se-pe)/65536);try{return Q.grow(we),ne(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(W,le):W.then(de=>de.arrayBuffer()).then(de=>WebAssembly.instantiate(de,le))).then(de=>{const{Rb:pe,Qb:Se,P:we,T:Ie,X:Oe,Ja:Ne,La:Fe,Qa:qe,Va:ht,Wa:at,eb:ut,jb:bt,f:_t,e:xt,yb:rt,zb:Tt,Ab:mt,Bb:jt,Db:wt,Gb:Qt}=de.instance.exports;Q=xt;const er=(()=>{let qt=0,Ht=0,xr=0,cr=0;return Yt=>{xr&&(pe(cr),pe(qt),Ht+=xr,xr=qt=0),qt||(Ht+=128,qt=Se(Ht));const kr=Yt.length+7&-8;let nn=qt;kr>=Ht&&(xr=kr,nn=cr=Se(kr));for(let En=0;En<Yt.length;En++)H[nn+En]=Yt[En];return nn}})();return ne(),_t(),{memory:xt,_free:pe,_malloc:Se,Mesh:class{constructor(){this.ptr=we()}destroy(){Ie(this.ptr)}},Decoder:class{constructor(){this.ptr=Ne()}destroy(){bt(this.ptr)}DecodeArrayToMesh(qt,Ht,xr){const cr=er(qt),Yt=Fe(this.ptr,cr,Ht,xr.ptr);return!!Oe(Yt)}GetAttributeByUniqueId(qt,Ht){return{ptr:qe(this.ptr,qt.ptr,Ht)}}GetTrianglesUInt16Array(qt,Ht,xr){ht(this.ptr,qt.ptr,Ht,xr)}GetTrianglesUInt32Array(qt,Ht,xr){at(this.ptr,qt.ptr,Ht,xr)}GetAttributeDataArrayForAllPoints(qt,Ht,xr,cr,Yt){ut(this.ptr,qt.ptr,Ht.ptr,xr,cr,Yt)}},DT_INT8:rt(),DT_UINT8:Tt(),DT_INT16:mt(),DT_UINT16:jt(),DT_UINT32:wt(),DT_FLOAT32:Qt()}})}(fetch(S6())),_1.then(W=>{qu=W,_1=void 0}))}()),z&&M.push(function(){if(vR)return;const W=function(H){let Q;const ne=WebAssembly.instantiateStreaming(H,{}).then(de=>{Q=de.instance,Q.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ne,supported:!0,decodeGltfBuffer(de,pe,Se,we,Ie,Oe){(function(Ne,Fe,qe,ht,at,ut,bt){const _t=Ne.exports.sbrk,xt=ht+3&-4,rt=_t(xt*at),Tt=_t(ut.length),mt=new Uint8Array(Ne.exports.memory.buffer);mt.set(ut,Tt);const jt=Fe(rt,ht,at,Tt,ut.length);if(jt===0&&bt&&bt(rt,xt,at),qe.set(mt.subarray(rt,rt+ht*at)),_t(rt-_t(0)),jt!==0)throw new Error(`Malformed buffer data: ${jt}`)})(Q,Q.exports[le[Ie]],de,pe,Se,we,Q.exports[te[Oe]])}}}(fetch(T6()));return W.ready.then(()=>{vR=W})}()),v)for(let W=0;W<v.length;W++)M.push(_he(v[W],h,W,l));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(L&&x)for(const{primitives:W}of x)for(const H of W)ghe(H,h);if(z&&x&&A)for(const W of A)yhe(W,h);return h})})}function L6(u){return fetch(u).then(i=>i.arrayBuffer()).then(i=>D6(i,0,u))}function xR(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function bR(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class wR{constructor(i,l,h,m){this.context=i,this.format=h,this.useMipmap=m&&m.useMipmap,this.texture=i.gl.createTexture(),this.update(l,{premultiply:m&&m.premultiply})}update(i,l){const h=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,m=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:v}=this,{gl:x}=v,{x:S,y:A}=l&&l.position?l.position:{x:0,y:0},N=S+h,M=A+m;!this.size||this.size[0]===N&&this.size[1]===M||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!l||l.premultiply!==!1));const L=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&N>0&&M>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(N,M)))+1:1;x.texStorage2D(x.TEXTURE_2D,z,this.format,N,M),this.size=[N,M]}this.size&&(L?x.texSubImage2D(x.TEXTURE_2D,0,S,A,xR(this.format),bR(this.format),i):"data"in i&&i.data&&x.texSubImage2D(x.TEXTURE_2D,0,S,A,h,m,xR(this.format),bR(this.format),i.data)),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(i,l,h=!1){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap&&!h?i===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),l!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(i,l,h,m,v){const{context:x}=this,{gl:S}=x;S.bindTexture(S.TEXTURE_2D,this.texture),l!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,l),this.magFilter=l),i!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?i===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),h!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,h),this.wrapS=h),m!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,m),this.wrapT=m),v!==this.compareMode&&(v?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,v)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=v)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class b1{constructor(i,l){this.context=i,this.texture=l}bind(i,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,i),this.minFilter=i),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}}const xhe=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),bhe=ln([{name:"a_color_3f",components:3,type:"Float32"}]),whe=ln([{name:"a_color_4f",components:4,type:"Float32"}]),She=ln([{name:"a_uv_2f",components:2,type:"Float32"}]),The=ln([{name:"a_normal_3f",components:3,type:"Float32"}]),Ehe=ln([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),jhe=ln([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function F6(u,i){const l=cA(u.projection,u.zoom,u.width,u.height),h=function(v,x,S,A,N){const M=new Te(S.lng-180*Ip,S.lat),L=new Te(S.lng+180*Ip,S.lat),z=v.project(M.lng,M.lat),W=v.project(L.lng,L.lat),H=-Math.atan2(W.y-z.y,W.x-z.x),Q=Zt.fromLngLat(S);Q.y=Pe(Q.y,-1+Ip,1-Ip);const ne=Q.toLngLat(),te=v.project(ne.lng,ne.lat),le=Zt.fromLngLat(ne);le.x+=Ip;const de=le.toLngLat(),pe=v.project(de.lng,de.lat),Se=B6(pe.x-te.x,pe.y-te.y,H),we=Zt.fromLngLat(ne);we.y+=Ip;const Ie=we.toLngLat(),Oe=v.project(Ie.lng,Ie.lat),Ne=B6(Oe.x-te.x,Oe.y-te.y,H),Fe=Math.abs(Se.x)/Math.abs(Ne.y),qe=D([]);ae(qe,qe,-H*(1-(N?0:A)));const ht=D([]);return K(ht,ht,[1,1-(1-Fe)*A,1]),ht[4]=-Ne.x/Ne.y*A,ae(ht,ht,H),V(ht,qe,ht),ht}(u.projection,0,u.center,l,i),m=z6(u);return K(h,h,[m,m,1]),h}function z6(u){const i=u.projection,l=cA(u.projection,u.zoom,u.width,u.height),h=SR(i,u.center),m=SR(i,Te.convert(i.center));return Math.pow(2,h*l+(1-l)*m)}function cA(u,i,l,h,m=1/0){const v=u.range;if(!v)return 0;const x=Math.min(m,Math.max(l,h)),S=Math.log2(x/1024);return He(v[0]+S,v[1]+S,i)}const Ip=1/4e4;function SR(u,i){const l=Pe(i.lat,-85.051129,Ue),h=new Te(i.lng-180*Ip,l),m=new Te(i.lng+180*Ip,l),v=u.project(h.lng,l),x=u.project(m.lng,l),S=Zt.fromLngLat(h),A=Zt.fromLngLat(m),N=x.x-v.x,M=x.y-v.y,L=A.x-S.x,z=A.y-S.y,W=Math.sqrt((L*L+z*z)/(N*N+M*M));return Math.log2(W)}function B6(u,i,l){const h=Math.cos(l),m=Math.sin(l);return{x:u*h-i*m,y:u*m+i*h}}function $6(u,i,l){D(u),ae(u,u,_n(i[2])),Y(u,u,_n(i[0])),ee(u,u,_n(i[1])),K(u,u,l),V(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function uA(u,i,l,h,m,v,x,S){const A=[l[0]-i[0],l[1]-i[1],0],N=[h[0]-i[0],h[1]-i[1],0];if(ze(A)<1e-12||ze(N)<1e-12)return Mn(u);const M=ur([],A,N);Ot(M,M),We(N,h,i),A[2]=(v-m)*S,N[2]=(x-m)*S;const L=A;return ur(L,A,N),Ot(L,L),na(u,M,L)}function dA(u,i,l=!1){const h=Ap(i.zoom),m=function(v,x,S){const A=x.worldSize,N=[v[12],v[13],v[14]],M=At(N[1]/A),L=vt(N[0]/A),z=D([]),W=tt(1,M)*A,H=tt(1,0)*A*st(M,x.zoom),Q=1/GO(A);let ne=H*Q;if(S){const pe=cA(x.projection,x.zoom,x.width,x.height,1024);ne=Q*x.projection.pixelSpaceConversion(x.center.lat,A,pe)}const te=ke(M,L);Ve(te,te,Je([],Ot([],te),W*ne*N[2]));const le=function(pe){const Se=[pe[0],pe[1],pe[2]];let we=[0,1,0];const Ie=ur([],we,Se);return ur(we,Se,Ie),Gt(we)===0&&(we=[0,1,0],ur(Ie,Se,we)),Ot(Ie,Ie),Ot(we,we),Ot(Se,Se),[Ie[0],Ie[1],Ie[2],0,we[0],we[1],we[2],0,Se[0],Se[1],Se[2],0,pe[0],pe[1],pe[2],1]}(te);K(z,z,[ne,ne,ne*W]),$(z,z,[-N[0],-N[1],-N[2]]);const de=V([],x.globeMatrix,le);return V(de,de,z),V(de,de,v),de}(u,i,l);if(h>0){const v=function(x,S){const A=S.worldSize,N=tt(1,0)*A*st(S.center.lat,S.zoom)/GO(A),M=tt(1,S.center.lat)*A,L=D([]);ee(L,L,_n(S.center.lng)),Y(L,L,_n(S.center.lat)),$(L,L,[0,0,oe]),K(L,L,[N,N,N*M]);const z=S.point;return $(L,L,[-z.x,-z.y,0]),V(L,L,x),V(L,S.globeMatrix,L)}(u,i);return function(x,S,A){const N=(H,Q,ne)=>{const te=ze(H),le=ze(Q),de=ef(H,Q,ne);return Je(de,de,1/ze(de)*jr(te,le,ne))},M=N([x[0],x[1],x[2]],[S[0],S[1],S[2]],A),L=N([x[4],x[5],x[6]],[S[4],S[5],S[6]],A),z=N([x[8],x[9],x[10]],[S[8],S[9],S[10]],A),W=ef([x[12],x[13],x[14]],[S[12],S[13],S[14]],A);return[M[0],M[1],M[2],0,L[0],L[1],L[2],0,z[0],z[1],z[2],0,W[0],W[1],W[2],1]}(m,v,h)}return m}function TR(u,i,l,h){const m=Pn.projectAabbCorners(h,l);let v=Number.MAX_VALUE;for(let S=0;S<m.length;++S){const A=m[S];A[0]=(.5*A[0]+.5)*i.width,A[1]=(.5-.5*A[1])*i.height,A[2]<v&&(v=A[2])}const x=function(S){const A=[];let N=0;for(let W=1;W<S.length;W++)(S[W][0]<S[N][0]||S[W][0]===S[N][0]&&S[W][1]<S[N][1])&&(N=W);let M,L=N;const z=new Uint8Array(S.length);do{if(z[L])break;A.push(new kt(S[L][0],S[L][1])),z[L]=1,M=(L+1)%S.length;for(let W=0;W<S.length;W++){if(S[W][0]===S[M][0]&&S[W][1]===S[M][1]||S[W][0]===S[L][0]&&S[W][1]===S[L][1])continue;const H=[S[W][0]-S[L][0],S[W][1]-S[L][1]],Q=[S[M][0]-S[L][0],S[M][1]-S[L][1]],ne=H[0]*Q[1]-H[1]*Q[0];(ne>0||ne===0&&H[0]*Q[0]+H[1]*Q[1]>=0&&H[0]*H[0]+H[1]*H[1]>Q[0]*Q[0]+Q[1]*Q[1])&&(M=W)}L=M}while(L!==N);return A.length>0&&A.push(A[0]),A}(m);if(ji(u,x))return v}const Yg=64,D_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function hA(u,i,l,h,m,v,x,S,A,N=!1){const M=l.zoom,L=l.project(h),z=st(h.lat,M),W=1/z;D(u),$(u,u,[L.x+x[0]*W,L.y+x[1]*W,x[2]]);let H=1,Q=1;const ne=l.worldSize;if(N){if(l.projection.name==="mercator"){let pe=0;l.elevation&&(pe=l.elevation.getAtPointOrZero(new Zt(L.x/ne,L.y/ne),0));const Se=hr([],[L.x,L.y,pe,1],l.projMatrix)[3]/l.cameraToCenterDistance;H=Se,Q=Se*st(l.center.lat,M)}else if(l.projection.name==="globe"){const pe=dA(u,l),Se=[0,0,0,1];hr(Se,Se,V([],l.projMatrix,pe));const we=Se[3]/l.cameraToCenterDistance,Ie=Ap(M),Oe=l.projection.pixelsPerMeter(h.lat,ne)*st(h.lat,M),Ne=l.projection.pixelsPerMeter(l.center.lat,ne)*st(l.center.lat,M);H=we/jr(Oe,ft(l.center.lat),Ie),Q=we*z/Oe,H*=Ne,Q*=Ne}}else H=W;K(u,u,[H,H,Q]);const te=[...u],le=i.orientation,de=[];if($6(de,[le[0]+(m?m[0]:0),le[1]+(m?m[1]:0),le[2]+(m?m[2]:0)],v),V(u,te,de),S&&l.elevation){let pe=0;const Se=[];if(A&&l.elevation){pe=function(Ie,Oe,Ne,Fe,qe){const ht=Oe.elevation;if(!ht)return 0;const at=Pn.projectAabbCorners(Ne,Fe),ut=tt(1,qe.lat)*Oe.worldSize,bt=function(Ht,xr){const cr=[0,0,1],Yt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const kr of Yt){const nn=Ht[kr.corners[0]],En=Ht[kr.corners[1]],en=Ht[kr.corners[2]],Hn=[En[0]-nn[0],En[1]-nn[1],xr*(En[2]-nn[2])],yn=ur(Hn,Hn,[en[0]-nn[0],en[1]-nn[1],xr*(en[2]-nn[2])]);Ot(yn,yn),kr.dotProductWithUp=nr(yn,cr)}return Yt.sort((kr,nn)=>kr.dotProductWithUp-nn.dotProductWithUp),Yt[0].corners}(at,ut),_t=at[bt[0]],xt=at[bt[1]],rt=at[bt[2]],Tt=at[bt[3]],mt=ht.getAtPointOrZero(new Zt(_t[0]/Oe.worldSize,_t[1]/Oe.worldSize),0),jt=ht.getAtPointOrZero(new Zt(xt[0]/Oe.worldSize,xt[1]/Oe.worldSize),0),wt=ht.getAtPointOrZero(new Zt(rt[0]/Oe.worldSize,rt[1]/Oe.worldSize),0),Qt=ht.getAtPointOrZero(new Zt(Tt[0]/Oe.worldSize,Tt[1]/Oe.worldSize),0),er=(mt+Qt)/2,qt=(jt+wt)/2;return er>qt?jt<wt?uA(Ie,xt,Tt,_t,jt,Qt,mt,ut):uA(Ie,rt,_t,Tt,wt,mt,Qt,ut):mt<Qt?uA(Ie,_t,xt,rt,mt,jt,wt,ut):uA(Ie,Tt,rt,xt,Qt,wt,jt,ut),Math.max(er,qt)}(Se,l,i.aabb,u,h);const we=V([],be([],Se),de);V(u,te,we)}else pe=l.elevation.getAtPointOrZero(new Zt(L.x/ne,L.y/ne),0);pe!==0&&(u[14]+=pe)}}class V6{constructor(i,l,h,m,v){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=i,this.uri=l,this.position=h!=null?new Te(h[0],h[1]):new Te(0,0),this.orientation=m??[0,0,0],this.nodes=v,this.uploaded=!1,this.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,l){V(i.globalMatrix,l,i.localMatrix);const h=this.nodeOverrides.get(i.name);if(h!==void 0){const x=[];v=h.orientation,D(m=x),ee(m,m,_n(v[1])),ae(m,m,_n(v[2])),Y(m,m,_n(v[0])),V(i.globalMatrix,i.globalMatrix,x)}var m,v;if(i.meshes)for(const x of i.meshes){const S=Pn.applyTransformFast(x.aabb,i.globalMatrix);this.aabb.encapsulate(S)}if(i.children)for(const x of i.children)this._applyTransformations(x,i.globalMatrix)}computeBoundsAndApplyParent(){const i=D([]);this.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.nodes)this._applyTransformations(l,i)}computeModelMatrix(i,l,h,m,v,x,S=!1){hA(this.matrix,this,i.transform,this.position,l,h,m,v,x,S)}upload(i){if(!this.uploaded){for(const l of this.nodes)ER(l,i);for(const l of this.nodes)fA(l);this.uploaded=!0}}destroy(){for(const i of this.nodes)jR(i)}}function w1(u,i,l=!1){u.uploaded||(u.gfxTexture=new wR(i,u.image,l?i.gl.R8:i.gl.RGBA8,{useMipmap:u.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function Ahe(u,i,l){u.indexBuffer=i.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=i.createVertexBuffer(u.vertexArray,xhe.members,!1,!0),u.normalArray&&(u.normalBuffer=i.createVertexBuffer(u.normalArray,The.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=i.createVertexBuffer(u.texcoordArray,She.members,!1,!0)),u.colorArray&&(u.colorBuffer=i.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?bhe:whe).members,!1,!0)),u.featureArray&&(u.pbrBuffer=i.createVertexBuffer(u.featureArray,jhe.members,!0)),u.segments=bi.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const h=u.material;h.pbrMetallicRoughness.baseColorTexture&&w1(h.pbrMetallicRoughness.baseColorTexture,i),h.pbrMetallicRoughness.metallicRoughnessTexture&&w1(h.pbrMetallicRoughness.metallicRoughnessTexture,i),h.normalTexture&&w1(h.normalTexture,i),h.occlusionTexture&&w1(h.occlusionTexture,i,l),h.emissionTexture&&w1(h.emissionTexture,i)}function ER(u,i,l){if(u.meshes)for(const h of u.meshes)Ahe(h,i,l);if(u.children)for(const h of u.children)ER(h,i,l)}function fA(u){if(u.meshes)for(const i of u.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(u.children)for(const i of u.children)fA(i)}function Che(u){u.pbrMetallicRoughness.baseColorTexture&&u.pbrMetallicRoughness.baseColorTexture.gfxTexture&&u.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),u.pbrMetallicRoughness.metallicRoughnessTexture&&u.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&u.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),u.normalTexture&&u.normalTexture.gfxTexture&&u.normalTexture.gfxTexture.destroy(),u.emissionTexture&&u.emissionTexture.gfxTexture&&u.emissionTexture.gfxTexture.destroy(),u.occlusionTexture&&u.occlusionTexture.gfxTexture&&u.occlusionTexture.gfxTexture.destroy()}function jR(u){if(u.meshes)for(const i of u.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&Che(i.material));if(u.children)for(const i of u.children)jR(i)}function Jg(u,i){const l=u.json.bufferViews[i.bufferView],h=oA[i.componentType];return new h(u.buffers[l.buffer],(i.byteOffset||0)+(l.byteOffset||0),i.count*(l.byteStride&&l.byteStride!==x1[i.type]*h.BYTES_PER_ELEMENT?l.byteStride/h.BYTES_PER_ELEMENT:x1[i.type]))}function AR(u,i,l,h){const m=oA[i.componentType],v=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),x=u.json.bufferViews[i.bufferView],S=x.byteStride?x.byteStride/m.BYTES_PER_ELEMENT:x1[i.type],A=l.float32,N=A.length/l.capacity;for(let M=0,L=0;M<i.count*S;M+=S,L+=N)for(let z=0;z<N;z++)A[L+z]=h[M+z]*v;l._trim()}function Phe(u,i,l){const h=u.indices,m=u.attributes,v={};v.indexArray=new Ps;const x=i.json.accessors[h],S=x.count/3;v.indexArray.reserve(S);const A=Jg(i,x);for(let z=0;z<S;z++)v.indexArray.emplaceBack(A[3*z],A[3*z+1],A[3*z+2]);v.indexArray._trim(),v.vertexArray=new Yl;const N=i.json.accessors[m.POSITION];v.vertexArray.reserve(N.count);const M=Jg(i,N);for(let z=0;z<N.count;z++)v.vertexArray.emplaceBack(M[3*z],M[3*z+1],M[3*z+2]);if(v.vertexArray._trim(),v.aabb=new Pn(N.min,N.max),v.centroid=function(z,W){const H=[0,0,0],Q=z.length;if(Q>0){for(let ne=0;ne<Q;ne++){const te=3*z[ne];H[0]+=W[te],H[1]+=W[te+1],H[2]+=W[te+2]}H[0]/=Q,H[1]/=Q,H[2]/=Q}return H}(A,M),m.COLOR_0!==void 0){const z=i.json.accessors[m.COLOR_0],W=x1[z.type],H=Jg(i,z);v.colorArray=W===3?new Yl:new Zd,v.colorArray.resize(z.count),AR(i,z,v.colorArray,H)}if(m.NORMAL!==void 0){v.normalArray=new Yl;const z=i.json.accessors[m.NORMAL];v.normalArray.resize(z.count);const W=Jg(i,z);AR(i,z,v.normalArray,W)}if(m.TEXCOORD_0!==void 0&&l.length>0){v.texcoordArray=new Jh;const z=i.json.accessors[m.TEXCOORD_0];v.texcoordArray.resize(z.count);const W=Jg(i,z);AR(i,z,v.texcoordArray,W)}if(m._FEATURE_ID_RGBA4444!==void 0){const z=i.json.accessors[m._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(v.featureData=Jg(i,z))}m._FEATURE_RGBA4444!==void 0&&(v.featureData=new Uint32Array(Jg(i,i.json.accessors[m._FEATURE_RGBA4444]).buffer));const L=u.material;return v.material=function(z,W){const{emissiveFactor:H=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:ne=.5,normalTexture:te,occlusionTexture:le,emissiveTexture:de,doubleSided:pe,name:Se}=z,{baseColorFactor:we=[1,1,1,1],metallicFactor:Ie=1,roughnessFactor:Oe=1,baseColorTexture:Ne,metallicRoughnessTexture:Fe}=z.pbrMetallicRoughness||{},qe=le?W[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&qe){const ht=le.extensions.KHR_texture_transform;qe.offsetScale=[ht.offset[0],ht.offset[1],ht.scale[0],ht.scale[1]]}return{name:Se,pbrMetallicRoughness:{baseColorFactor:new Dn(...we),metallicFactor:Ie,roughnessFactor:Oe,baseColorTexture:Ne?W[Ne.index]:void 0,metallicRoughnessTexture:Fe?W[Fe.index]:void 0},doubleSided:pe,emissiveFactor:new Dn(...H),alphaMode:Q,alphaCutoff:ne,normalTexture:te?W[te.index]:void 0,occlusionTexture:qe,emissionTexture:de?W[de.index]:void 0,defined:z.defined===void 0}}(L!==void 0?i.json.materials[L]:{defined:!1},l),v}function U6(u,i,l){const{matrix:h,rotation:m,translation:v,scale:x,mesh:S,extras:A,children:N,name:M}=u,L={};if(L.name=M,L.localMatrix=h||function(z,W,H,Q){var ne=W[0],te=W[1],le=W[2],de=W[3],pe=ne+ne,Se=te+te,we=le+le,Ie=ne*pe,Oe=ne*Se,Ne=ne*we,Fe=te*Se,qe=te*we,ht=le*we,at=de*pe,ut=de*Se,bt=de*we,_t=Q[0],xt=Q[1],rt=Q[2];return z[0]=(1-(Fe+ht))*_t,z[1]=(Oe+bt)*_t,z[2]=(Ne-ut)*_t,z[3]=0,z[4]=(Oe-bt)*xt,z[5]=(1-(Ie+ht))*xt,z[6]=(qe+at)*xt,z[7]=0,z[8]=(Ne+ut)*rt,z[9]=(qe-at)*rt,z[10]=(1-(Ie+Fe))*rt,z[11]=0,z[12]=H[0],z[13]=H[1],z[14]=H[2],z[15]=1,z}([],m||[0,0,0,1],v||[0,0,0],x||[1,1,1]),L.globalMatrix=R(L.localMatrix),S!==void 0){L.meshes=l[S];const z=L.anchor=[0,0];for(const W of L.meshes){const{min:H,max:Q}=W.aabb;z[0]+=H[0]+Q[0],z[1]+=H[1]+Q[1]}z[0]=Math.floor(z[0]/L.meshes.length/2),z[1]=Math.floor(z[1]/L.meshes.length/2)}if(A&&(A.id&&(L.id=A.id),A.lights&&(L.lights=function(z){if(!z.length)return[];const W=function(le){const de=atob(le),pe=new Uint8Array(de.length);for(let Se=0;Se<de.length;Se++)pe[Se]=de.codePointAt(Se);return pe}(z),H=[],Q=W.length/24,ne=new Uint16Array(W.buffer),te=new Float32Array(W.buffer);for(let le=0;le<Q;le++){const de=ne[2*le*6]/30,pe=ne[2*le*6+1]/30,Se=ne[2*le*6+10]/100,we=te[6*le+1],Ie=te[6*le+2],Oe=te[6*le+3],Ne=te[6*le+4],Fe=Oe-we,qe=Ne-Ie,ht=Math.hypot(Fe,qe);H.push({pos:[we+.5*Fe,Ie+.5*qe,pe],normal:[qe/ht,-Fe/ht,0],width:ht,height:de,depth:Se,points:[we,Ie,Oe,Ne]})}return H}(A.lights)),A.MAPBOX_geometry_bloom&&(L.isGeometryBloom=A.MAPBOX_geometry_bloom)),N){const z=[];for(const W of N)z.push(U6(i.json.nodes[W],i,l));L.children=z}return L}function Nhe(u){if(u.vertices.length===0||u.indices.length===0)return null;const i=new Qj(u.vertices,u.indices,8,256),[l,h]=[i.min.clone(),i.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:i,min:l,max:h}}function Ihe(u){if(!u.extras||!u.extras.ground)return null;const i=u.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const l=i[0];if(!l||!Array.isArray(l)||l.length===0)return null;const h=[];for(const x of l){if(!Array.isArray(x)||x.length!==2)continue;const S=x[0],A=x[1];typeof S=="number"&&typeof A=="number"&&h.push(new kt(S,A))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let m=0;for(let x=0;x<h.length;x++){const S=h[x],A=h[(x+1)%h.length],N=h[(x+2)%h.length];m+=(S.x-A.x)*(N.y-A.y)-(N.x-A.x)*(S.y-A.y)}m>0&&h.reverse();const v=C_(h.flatMap(x=>[x.x,x.y]),[]);return v.length===0?null:{vertices:h,indices:v}}function khe(u,i){const l=[],h=[];let m=0;const v=[];for(const x of u){m=l.length;const S=x.vertexArray.float32,A=x.indexArray.uint16;for(let N=0;N<x.vertexArray.length;N++)v[0]=S[3*N+0],v[1]=S[3*N+1],v[2]=S[3*N+2],pr(v,v,i),l.push(new kt(v[0],v[1]));for(let N=0;N<3*x.indexArray.length;N++)h.push(A[N]+m)}if(h.length%3!=0)return null;for(let x=0;x<h.length;x+=3){const S=l[h[x+0]],A=l[h[x+1]],N=l[h[x+2]];(S.x-A.x)*(N.y-A.y)-(N.x-A.x)*(S.y-A.y)>0&&([h[x+1],h[x+2]]=[h[x+2],h[x+1]])}return{vertices:l,indices:h}}function CR(u){const i=function(A,N){const M=[],L=WebGL2RenderingContext;if(A.json.textures)for(const z of A.json.textures){const W={magFilter:L.LINEAR,minFilter:L.NEAREST,wrapS:L.REPEAT,wrapT:L.REPEAT};z.sampler!==void 0&&Object.assign(W,A.json.samplers[z.sampler]),M.push({image:N[z.source],sampler:W,uploaded:!1})}return M}(u,u.images),l=function(A,N){const M=[];for(const L of A.json.meshes){const z=[];for(const W of L.primitives)z.push(Phe(W,A,N));M.push(z)}return M}(u,i),{scenes:h,scene:m,nodes:v}=u.json,x=h?h[m||0].nodes:[...v.keys()],S=[];for(const A of x)S.push(U6(v[A],u,l));return function(A,N,M){const L={},z=new Set;for(let W=0;W<A.length;W++){const H=M[N[W]];if(!H.extras)continue;const Q=H.extras["mapbox:footprint:version"],ne=H.extras["mapbox:footprint:id"];(Q||ne)&&z.add(W),Q==="1.0.0"&&ne&&(L[ne]=W)}for(let W=0;W<A.length;W++){if(z.has(W))continue;const H=A[W],Q=M[N[W]];if(!Q.extras)continue;let ne=null;H.id in L&&(ne=khe(A[L[H.id]].meshes,H.localMatrix)),ne||(ne=Ihe(Q)),ne&&(H.footprint=Nhe(ne))}if(z.size>0){const W=Array.from(z.values()).sort((H,Q)=>H-Q);for(let H=W.length-1;H>=0;H--)A.splice(W[H],1)}}(S,x,u.json.nodes),S}function Ohe(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const i=u.vertexArray.float32,l=u.aabb.min[0]-1,h=u.aabb.min[1]-1,m=Yg/(u.aabb.max[0]-l+2),v=Yg/(u.aabb.max[1]-h+2);for(let x=0;x<i.length;x+=3){const S=i[x+2],A=(i[x+0]-l)*m|0,N=(i[x+1]-h)*v|0;S>u.heightmap[N*Yg+A]&&(u.heightmap[N*Yg+A]=S)}}function q6(u,i,l,h,m){l.reserve(l.length+4*u.length),h.reserve(h.length+10*u.length),m.reserve(m.length+10*u.length);let v=h.length;for(const x of u){const S=Math.min(10,Math.max(4,1.3*x.height))*i,A=[-x.normal[1],x.normal[0],0],N=Math.min(.29,.1*x.width/x.depth),M=x.width-2*x.depth*i*(N+.01),L=Bt([],x.pos,A,M/2),z=Bt([],x.pos,A,-M/2),W=[L[0],L[1],L[2]+x.height],H=[z[0],z[1],z[2]+x.height],Q=Bt([],x.normal,A,N);Je(Q,Q,S);const ne=Bt([],x.normal,A,-N);Je(ne,ne,S),Ve(Q,L,Q),Ve(ne,z,ne),L[2]+=.1,z[2]+=.1,h.emplaceBack(Q[0],Q[1],Q[2]),h.emplaceBack(ne[0],ne[1],ne[2]),h.emplaceBack(L[0],L[1],L[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(W[0],W[1],W[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(L[0],L[1],L[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(Q[0],Q[1],Q[2]),h.emplaceBack(ne[0],ne[1],ne[2]);const te=M/S/2;m.emplaceBack(-te-N,-1,te,.8),m.emplaceBack(te+N,-1,te,.8),m.emplaceBack(-te,0,te,1.3),m.emplaceBack(te,0,te,1.3),m.emplaceBack(te+N,-.8,te,.7),m.emplaceBack(te+N,-.8,te,.7),m.emplaceBack(0,0,te,1.3),m.emplaceBack(0,0,te,1.3),m.emplaceBack(te+N,-1.2,te,.8),m.emplaceBack(te+N,-1.2,te,.8),l.emplaceBack(6+v,4+v,8+v),l.emplaceBack(7+v,9+v,5+v),l.emplaceBack(0+v,1+v,2+v),l.emplaceBack(1+v,3+v,2+v),v+=10}}function Rhe(u,i){const l={};l.indexArray=new Ps,l.vertexArray=new Yl,l.colorArray=new Zd,q6(u,i,l.indexArray,l.vertexArray,l.colorArray);const h={defined:!0};h.emissiveFactor=Dn.black;const m={};return m.baseColorFactor=Dn.white,h.pbrMetallicRoughness=m,l.material=h,l.aabb=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}const G6=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),Mhe=ln([{name:"a_normal_3",components:3,type:"Int16"}]),Dhe=ln([{name:"a_centroid_3",components:3,type:"Int16"}]),W6=ln([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Lhe=ln([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Fhe=ln([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),zhe=ln([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Bhe=ln([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),$he=ln([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),H6=un.types,pA=32767;function Vhe(u,i){const l=Wt+i;for(const h of u)for(const m of h)if(m.x<-i||m.x>l||m.y<-i||m.y>l)return!1;return!0}function Uhe(u){switch(u){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${u}`)}}class PR{constructor(){this.layoutVertexArray=new Yl,this.layoutAttenuationArray=new Zd,this.layoutColorArray=new bl,this.indexArray=new Ps,this.indexArrayForConflation=new Ps,this.segmentsBucket=new bi}}class NR{constructor(i){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new bi,this.entranceBloom=new PR;const l=66560;this.layoutVertexArray=new Yl,this.layoutVertexArray.reserve(l),this.layoutNormalArray=new $u,this.layoutNormalArray.reserve(l),this.layoutCentroidArray=new $u,this.layoutCentroidArray.reserve(l),this.layoutColorArray=new bl,this.layoutColorArray.reserve(l),this.layoutFloodLightDataArray=new zg,this.layoutFloodLightDataArray.reserve(l),this.layoutAOArray=new T_,this.layoutAOArray.reserve(l),this.indexArray=new Ps,this.indexArray.reserve(66560),this.indexArrayForConflation=new Ps,this.segmentsBucket=new bi,this.entranceBloom=new PR,i&&(this.layoutFacadePaintArray=new bl,this.layoutFacadeDataArray=new bp,this.layoutFacadeVerticalRangeArray=new bl)}reserve(i,l,h){this.layoutVertexArray.reserveForAdditional(i),this.layoutCentroidArray.reserveForAdditional(i),this.layoutFloodLightDataArray.reserveForAdditional(i),this.layoutNormalArray.reserveForAdditional(i),this.layoutAOArray.reserveForAdditional(i),this.layoutColorArray.reserveForAdditional(i),this.indexArray.reserveForAdditional(l),h&&(this.layoutFacadePaintArray.reserveForAdditional(i),this.layoutFacadeDataArray.reserveForAdditional(i),this.layoutFacadeVerticalRangeArray.reserveForAdditional(i))}}class Z6{constructor(i){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Jh,this.footprintsIndices=new zg,this.footprintsMin=new kt(1/0,1/0),this.footprintsMax=new kt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new NR(!1),this.buildingWithFacade=new NR(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.lut=i.lut,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection,this.groundEffect=new hR(i),this.groundEffect.groundRadiusArray=new aa,this.hasAppearances=null}updateFootprints(i,l){const h=new Qj([],[],1),m={vertices:[],indices:new Uint32Array(0),grid:h,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};l.push({footprint:m,id:i})}updateAppearances(i,l,h,m){}prepare(){return function(){if(aA!=null||w6!=null)return null;if(M_!=null)return M_;const i=fetch(As.BUILDING_GEN_URL);return M_=function(l){let h,m,v,x,S;function A(){h=new Uint8Array(S.buffer),m=new Int16Array(S.buffer),v=new Int32Array(S.buffer),x=new Float32Array(S.buffer)}function N(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},L={a:{a:N,f:function(z){const W=h.length,H=Math.max(z>>>0,Math.ceil(1.2*W)),Q=Math.ceil((H-W)/65536);try{return S.grow(Q),A(),!0}catch{return!1}},g:N,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(l,L):l.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,L))).then(z=>{const W=z.instance.exports;return(0,W.g)(),S=W.f,A(),new fhe({setStyle:W.h,setAOOptions:W.i,setMetricOptions:W.j,setStructuralOptions:W.k,setFacadeOptions:W.l,setFauxFacadeOptions:W.m,setFacadeClassifierOptions:W.n,addFeature:W.o,addFacade:W.p,generateMesh:W.q,getLastError:W.r,getOuterRingLength:W.s,getMeshCount:W.t,getPositionsPtr:W.u,getPositionsLength:W.v,getNormalsPtr:W.w,getNormalsLength:W.x,getAOPtr:W.y,getAOLength:W.z,getUVPtr:W.A,getUVLength:W.B,getFauxFacadePtr:W.C,getFauxFacadeLength:W.D,getIndicesPtr:W.E,getIndicesLength:W.F,getBuildingPart:W.G,getRingCount:W.H,getRingPtr:W.I,getRingLength:W.J,malloc:W.K,free:W.L,heapU8:h,heap16:m,heap32:v,heapF32:x})})}(i).then(l=>(M_=null,aA=l,aA)).catch(l=>{Nr("Could not load building-gen"),M_=null,w6=l}),M_}()}populate(i,l,h,m){const v=phe();if(!v)return;const x=Mt(h);this.tileToMeter=x,this.brightness=l.brightness,v.setStyle({normalScale:[1,-1,x],tileToMeters:x}),v.setAOOptions(!1,.3),v.setMetricOptions(!1,16),v.setStructuralOptions(!0),v.setFacadeClassifierOptions(3);const S=new Map,A=new Map;let N=0;for(const{feature:te}of i){if(H6[te.type]!=="LineString"){S.set(te.id,te.properties.source_id);continue}const le=this.layers[0]._featureFilter.needGeometry;if(le&&!this.layers[0]._featureFilter.filter(new Wn(this.zoom),te,h))continue;const de=Gr(te,le);if(!le&&!this.layers[0]._featureFilter.filter(new Wn(this.zoom),de,h))continue;const pe=le?de.geometry:Cr(te,h,m),Se=[];for(const Ne of pe)for(const Fe of Ne)Se.push(Fe.x),Se.push(Fe.y);const we={coordinates:Se,crossPerc:te.properties.cross_perc,distanceToRoad:te.properties.distance_to_road,entrances:te.properties.entrances,sourceId:0},Ie=te.properties.source_id;let Oe=A.get(Ie);Oe||(Oe=[],A.set(Ie,Oe)),Oe.push(we),++N}this.maxHeight=0;const M=new Array,L=new Set,z=te=>{te!=null&&L.add(te)},W=(te,le)=>{te!=null&&M.push({buildingId:te,footprintIndex:le})},H=64*(i.length-N),Q=H/2;this.buildingWithFacade.reserve(H,Q,!0),this.buildingWithoutFacade.reserve(2*H,2*Q,!1),this.footprintsIndices.reserve(16*(i.length-N)),this.footprintsVertices.reserve(8*(i.length-N));for(const{feature:te,id:le,index:de,sourceLayerIndex:pe}of i){if(H6[te.type]==="LineString")continue;const Se=this.layers[0]._featureFilter.needGeometry;if(Se&&!this.layers[0]._featureFilter.filter(new Wn(this.zoom),te,h))continue;let we=null;if(te.properties&&te.properties.hasOwnProperty("building_id")&&(we=Number(te.properties.building_id),L.has(we)))continue;const Ie=Gr(te,Se);if(!Se&&!this.layers[0]._featureFilter.filter(new Wn(this.zoom),Ie,h))continue;const Oe=Se?Ie.geometry:Cr(te,h,m),Ne=c1(Oe,500);let Fe=!1;for(const tn of Ne)if(tn.length!==1){Fe=!0;break}if(Fe){z(we);continue}if(!Vhe(Oe,163)){z(we);continue}const qe=this.layers[0],ht=Uhe(qe.layout.get("building-roof-shape").evaluate(te,{},h)),at=qe.layout.get("building-base").evaluate(te,{},h),ut=qe.layout.get("building-height").evaluate(te,{},h),bt=qe.layout.get("building-flood-light-ground-radius").evaluate(te,{},h),_t=qe.paint.get("building-ambient-occlusion-intensity"),xt=bt/this.tileToMeter;te.properties["building-part"]="roof";const rt=qe.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),Tt=qe.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="wall";const mt=qe.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),jt=qe.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="window";const wt=qe.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),Qt=qe.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="door";const er=qe.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),qt=qe.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);let Ht=qe.layout.get("building-flood-light-wall-radius").evaluate(te,{},h);Ht=Pe(Ht,0,2048);const xr=Ht/2048*pA,cr=S.get(le),Yt=A.get(cr)||[],kr=Yt.length!==0&&qe.layout.get("building-facade").evaluate(te,{},h);v.setFacadeOptions(4,!0),v.setFauxFacadeOptions(kr,!1,1);let nn=0,En=0,en=0,Hn=0,yn=0,Xi=0,wn=0,Vn=0,yi=0,Ai=0,Ci=0;if(kr){let tn=Math.round(qe.layout.get("building-facade-floors").evaluate(te,{},h));if(at===0){tn=Math.max(1,tn-(Yt.length>0?1:0));let Yi=4;if(ut>100){const ks=[10,13,15];Yi=ks[te.id?te.id%ks.length:0]}else ut<=10&&(Yi=3);v.setFacadeOptions(Yi,!0),yn=(ut<15?1.3:1.61803)*Yi/x}else yn=at/x;Xi=ut/x,yn=Math.min(yn,Xi),en=qe.layout.get("building-facade-unit-width").evaluate(te,{},h)/x,Hn=(Xi-yn)/tn,v.setFauxFacadeOptions(!0,!0,en);const Ks=qe.layout.get("building-facade-window").evaluate(te,{},h);nn=Ks[0],En=Ks[1],wn=Math.floor(65535*Math.min(1,yn/Wt)),Vn=Math.floor(65535*Math.min(1,Xi/Wt)),yi=Math.floor(255*nn)<<8|Math.floor(255*En),Ai=Math.floor(65535*Math.min(1,en/Wt)),Ci=Math.floor(65535*Math.min(1,Hn/Wt))}const Ki=Array(Ne.length),oa={x:1/0,y:1/0},Ca={x:-1/0,y:-1/0},_s={x:0,y:0};let Is=0;for(let tn=0;tn<Ne.length;tn++){const Ks=Ne[tn];if(Ks.length>0){const Yi=[],ks=Array(Ks.length+1);ks[0]=0;for(let bc=0;bc<Ks.length;bc++){const Jo=Ks[bc];for(let Pl=0;Pl<Jo.length;Pl++){const Ys=Jo[Jo.length-Pl-1];oa.x=Math.min(oa.x,Ys.x),oa.y=Math.min(oa.y,Ys.y),Ca.x=Math.max(Ca.x,Ys.x),Ca.y=Math.max(Ca.y,Ys.y),_s.x+=Ys.x,_s.y+=Ys.y,Is++,Yi.push(Ys.x),Yi.push(Ys.y)}ks[bc+1]=Yi.length}Ki[tn]={id:te.id?te.id:0,height:ut,minHeight:at,sourceId:0,roofType:ht,coordinates:Yi,ringIndices:ks}}}_s.x/=Is||1,_s.y/=Is||1;const Us=v.generateMesh(Ki,Yt);if(typeof Us=="string"){Nr(`Unable to generate building ${te.id}: ${Us}`),z(we);continue}if(Us.meshes.length===0||Us.modifiedPolygonRings.length===0){z(we);continue}const Zr=kr?this.buildingWithFacade:this.buildingWithoutFacade;let Pi=0;for(const tn of Us.meshes)Pi+=tn.positions.length/3;const Li=Zr.segmentsBucket.prepareSegment(Pi,Zr.layoutVertexArray,Zr.indexArray),Cl=[];let po=null,la=0,mo=-1;const Jd=Zr.layoutVertexArray.length,qa=Jd+Pi;Zr.layoutVertexArray.resize(qa),Zr.layoutCentroidArray.resize(qa),Zr.layoutNormalArray.resize(qa),Zr.layoutAOArray.resize(qa),Zr.layoutColorArray.resize(qa),Zr.layoutFloodLightDataArray.resize(qa),kr&&(Zr.layoutFacadePaintArray.resize(qa),Zr.layoutFacadeDataArray.resize(qa),Zr.layoutFacadeVerticalRangeArray.resize(qa));const zA=Zr.indexArray.length;let Z_=0,ko=Jd;for(const tn of Us.meshes){let Ks,Yi;if(tn.buildingPart===1)Ks=rt,Yi=Tt;else if(tn.buildingPart===0)Ks=mt,Yi=jt;else if(tn.buildingPart===2)Ks=wt,Yi=Qt;else{if(tn.buildingPart!==3)continue;Ks=er,Yi=qt}if(Yi=Pe(Yi,0,1),tn.buildingPart===3){const xs=new Array;for(let Wa=0;Wa<tn.positions.length;Wa+=12){const Dp=tn.positions[Wa+0],ua=tn.positions[Wa+1],Qo=tn.positions[Wa+3],lu=tn.positions[Wa+4],th=tn.positions[Wa+2],pM=tn.positions[Wa+8]-th,mM=1,W1=Qo-Dp,K_=lu-ua,Hu=Math.hypot(W1,K_);xs.push({pos:[Dp+.5*W1,ua+.5*K_,th],normal:[K_/Hu,-W1/Hu,0],width:Hu,height:pM,depth:mM,points:[Dp,ua,Qo,lu]})}const ca=Zr.entranceBloom.segmentsBucket.prepareSegment(10*xs.length,Zr.entranceBloom.layoutVertexArray,Zr.entranceBloom.indexArray),Os=Zr.entranceBloom.layoutVertexArray.length;la=Zr.entranceBloom.indexArray.length,q6(xs,.5/this.tileToMeter,Zr.entranceBloom.indexArray,Zr.entranceBloom.layoutVertexArray,Zr.entranceBloom.layoutAttenuationArray);const Ga=Zr.entranceBloom.layoutVertexArray.length-Os;mo=Zr.entranceBloom.indexArray.length-la;for(let Wa=0;Wa<Ga;Wa++)Zr.entranceBloom.layoutColorArray.emplaceBack(255*er.r<<8|255*er.g,255*er.b<<8|51*qt);ca.vertexLength+=Ga,ca.primitiveLength+=mo,po={part:tn.buildingPart,vertexOffset:Os,vertexLength:Ga}}Zr.layoutVertexArray.float32.set(tn.positions,3*ko);const ks=tn.positions.length/3;for(let xs=0;xs<ks;++xs){const ca=3*xs;Z_=Math.max(Z_,tn.positions[ca+2]);const Os=tn.normals[ca+1]*pA,Ga=tn.normals[ca+2]*pA,Wa=3*(ko+xs);Zr.layoutNormalArray.int16[Wa]=tn.normals[ca]*pA,Zr.layoutNormalArray.int16[Wa+1]=Os,Zr.layoutNormalArray.int16[Wa+2]=Ga;const Dp=tn.ao[xs];Zr.layoutAOArray.uint8[ko+xs]=255*Dp;const ua=1+(Dp-1)*_t,Qo=255*Ks.b*ua<<8|255*Yi;Zr.layoutColorArray.uint16[2*(ko+xs)]=255*Ks.r*ua<<8|255*Ks.g*ua,Zr.layoutColorArray.uint16[2*(ko+xs)+1]=Qo}const bc=Math.floor(_s.x),Jo=Math.floor(_s.y),Pl=Math.floor(ut);for(let xs=0;xs<ks;++xs){const ca=3*(ko+xs);Zr.layoutCentroidArray.int16[ca]=bc,Zr.layoutCentroidArray.int16[ca+1]=Jo,Zr.layoutCentroidArray.int16[ca+2]=Pl}if(Zr.layoutFloodLightDataArray.uint16.fill(tn.buildingPart===0?xr:0,ko,ko+ks),kr){const xs=255*wt.r<<8|255*wt.g,ca=255*wt.b<<8|255*Qt;for(let Os=0;Os<ks;++Os){const Ga=2*(ko+Os);Zr.layoutFacadePaintArray.uint16[Ga]=xs,Zr.layoutFacadePaintArray.uint16[Ga+1]=ca}for(let Os=0;Os<ks;++Os)if(tn.isFauxFacade[Os]){const Ga=Math.min(65535,Math.floor(tn.uv[2*Os]*Us.outerRingLength));Zr.layoutFacadeDataArray.emplace(ko+Os,1|Ga,yi,Ai,Ci),Zr.layoutFacadeVerticalRangeArray.emplace(ko+Os,wn,Vn)}else Zr.layoutFacadeDataArray.emplace(ko+Os,0,0,0,0),Zr.layoutFacadeVerticalRangeArray.emplace(ko+Os,0,0)}const Ys=Li.vertexLength,G1=tn.indices.length/3,eh=Zr.indexArray.length;Zr.indexArray.resize(eh+G1);for(let xs=0;xs<G1;++xs){const ca=3*xs,Os=3*eh+ca;Zr.indexArray.uint16[Os]=Ys+tn.indices[ca],Zr.indexArray.uint16[Os+1]=Ys+tn.indices[ca+1],Zr.indexArray.uint16[Os+2]=Ys+tn.indices[ca+2]}tn.buildingPart!==1&&tn.buildingPart!==0&&tn.buildingPart!==2&&tn.buildingPart!==3||Cl.push({part:tn.buildingPart,vertexOffset:ko,vertexLength:tn.positions.length/3}),ko+=ks,Li.vertexLength+=ks,Li.primitiveLength+=tn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Z_);const BA=Zr.indexArray.length-zA,Qd=this.footprintsIndices.length,af=this.footprintsVertices.length,Mp=[],xc=new kt(1/0,1/0),ou=new kt(-1/0,-1/0),q1=this.groundEffect.vertexArray.length;for(const tn of Us.modifiedPolygonRings){const Ks=[],Yi=new kt(1/0,1/0),ks=new kt(-1/0,-1/0);for(let bc=0;bc<tn.length;bc+=2){const Jo=tn.length-bc-2;Yi.x=Math.min(Yi.x,tn[Jo]),Yi.y=Math.min(Yi.y,tn[Jo+1]),ks.x=Math.max(ks.x,tn[Jo]),ks.y=Math.max(ks.y,tn[Jo+1]);const Pl=new kt(tn[Jo],tn[Jo+1]);Ks.push(Pl),Mp.push(Pl.x,Pl.y),this.footprintsVertices.emplaceBack(Pl.x,Pl.y)}xc.x=Math.min(xc.x,Yi.x),xc.y=Math.min(xc.y,Yi.y),ou.x=Math.max(ou.x,ks.x),ou.y=Math.max(ou.y,ks.y),this.groundEffect.addData(Ks,[Yi,ks],xt)}const X_=this.groundEffect.vertexArray.length-q1;this.groundEffect.groundRadiusArray.reserveForAdditional(X_);for(let tn=0;tn<X_;tn++)this.groundEffect.groundRadiusArray.emplaceBack(bt);(oa.x<0||Ca.x>Wt||oa.y<0||Ca.y>Wt)&&this.featuresOnBorder.push({featureId:te.id,footprintIndex:this.footprints.length});{const tn=C_(Mp,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+tn.length),this.footprintsIndices.uint16.set(tn,Qd),this.buildingIds.add(we??te.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,xc.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,xc.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ou.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ou.y);const Ks={footprintVertexOffset:af,footprintVertexLength:this.footprintsVertices.length-af,footprintIndexOffset:Qd,footprintIndexLength:this.footprintsIndices.length-Qd,min:xc,max:ou,hiddenFlags:0,indicesOffset:zA,indicesLength:BA,bloomIndicesOffset:la,bloomIndicesLength:mo,groundEffectVertexOffset:q1,groundEffectVertexLength:X_,hasFauxFacade:kr,height:Z_,promoteId:le,feature:Ie,parts:Cl,buildingBloom:po},Yi=this.footprints.length;te.id!==void 0&&this.featureFootprintLookup.set(te.id,Yi),W(we,Yi),this.footprints.push(Ks)}this.programConfigurations.populatePaintArrays(Zr.layoutVertexArray.length,te,de,{},l.availableImages,h,l.brightness),this.groundEffect.addPaintPropertiesData(te,de,{},l.availableImages,h,l.brightness),l.featureIndex.insert(te,Oe,de,pe,this.index,Jd)}M.forEach(({buildingId:te,footprintIndex:le})=>{L.has(te)&&(this.footprints[le].hiddenFlags|=4)});const ne=new Set;this.buildingIds.forEach((te,le,de)=>{L.has(te)||ne.add(te)}),this.buildingIds=ne,this.groundEffect.prepareBorderSegments()}update(i,l,h,m,v,x,S){this.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S),this.groundEffect.update(i,l,v,h,m,x,S),this.evaluate(this.layers[0],i),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){const l=h=>{h.layoutVertexBuffer=i.createVertexBuffer(h.layoutVertexArray,G6.members),h.layoutNormalBuffer=i.createVertexBuffer(h.layoutNormalArray,Mhe.members),h.layoutCentroidBuffer=i.createVertexBuffer(h.layoutCentroidArray,Dhe.members),h.layoutFloodLightDataBuffer=i.createVertexBuffer(h.layoutFloodLightDataArray,$he.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=i.createVertexBuffer(h.layoutFacadeDataArray,Fhe.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=i.createVertexBuffer(h.layoutFacadeVerticalRangeArray,zhe.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(h.entranceBloom.layoutVertexArray,G6.members),h.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,Bhe.members)),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i)};this.uploaded||(l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){const i=l=>{l.layoutVertexBuffer&&(l.layoutVertexBuffer.destroy(),l.layoutNormalBuffer.destroy(),l.layoutColorBuffer.destroy(),l.segmentsBucket.destroy(),l.indexBuffer&&l.indexBuffer.destroy(),l.entranceBloom.layoutVertexBuffer&&(l.entranceBloom.layoutVertexBuffer.destroy(),l.entranceBloom.layoutColorBuffer.destroy(),l.entranceBloom.layoutAttenuationBuffer.destroy(),l.entranceBloom.indexBuffer.destroy(),l.entranceBloom.segmentsBucket.destroy()))};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(i,l,h=!0){let m=!1;const v=h?l:0,x=0|(h?-1:~l);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of i){const A=this.footprints[S],N=A.hiddenFlags&x|v;A.hiddenFlags!==N&&(A.hiddenFlags=N,m=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return m&&(this.indexArrayForConflationUploaded=!1),m}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),this.indexArrayForConflationUploaded)return;const l=m=>{m.indexArray.length!==0&&(m.indexArrayForConflation.resize(m.indexArray.length),m.indexArrayForConflation.uint16.set(m.indexArray.uint16),m.entranceBloom.indexArrayForConflation.resize(m.entranceBloom.indexArray.length),m.entranceBloom.indexArrayForConflation.uint16.set(m.entranceBloom.indexArray.uint16))};l(this.buildingWithoutFacade),l(this.buildingWithFacade);for(const m of this.footprints){const v=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,x=m.indicesOffset+m.indicesLength;if(m.hiddenFlags!==0){for(let A=m.indicesOffset;A<x;A++)v.indexArrayForConflation.uint16[3*A+0]=0,v.indexArrayForConflation.uint16[3*A+1]=0,v.indexArrayForConflation.uint16[3*A+2]=0;const S=m.bloomIndicesOffset+m.bloomIndicesLength;for(let A=m.bloomIndicesOffset;A<S;A++)v.entranceBloom.indexArrayForConflation.uint16[3*A+0]=0,v.entranceBloom.indexArrayForConflation.uint16[3*A+1]=0,v.entranceBloom.indexArrayForConflation.uint16[3*A+2]=0}}const h=m=>{m.indexArray.length!==0&&(m.indexBuffer?m.indexBuffer.updateData(m.indexArrayForConflation):m.indexBuffer=i.createIndexBuffer(m.indexArrayForConflation,!0),m.entranceBloom.indexBuffer?m.entranceBloom.indexBuffer.updateData(m.entranceBloom.indexArrayForConflation):m.entranceBloom.indexBuffer=i.createIndexBuffer(m.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(i){const l=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=i.createVertexBuffer(h.layoutColorArray,W6.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=i.createVertexBuffer(h.layoutFacadePaintArray,Lhe.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=i.createVertexBuffer(h.entranceBloom.layoutColorArray,W6.members,!0)};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(i,l){const h=i.paint.get("building-ambient-occlusion-intensity");for(const m of this.footprints){if(4&m.hiddenFlags)continue;const v=l[m.promoteId],x=m.feature;x.properties["building-part"]="roof";const S=i.paint.get("building-color").evaluate(x,v,this.canonical).toPremultipliedRenderColor(this.lut),A=i.paint.get("building-emissive-strength").evaluate(x,v,this.canonical);x.properties["building-part"]="wall";const N=i.paint.get("building-color").evaluate(x,v,this.canonical).toPremultipliedRenderColor(this.lut),M=i.paint.get("building-emissive-strength").evaluate(x,v,this.canonical);x.properties["building-part"]="window";const L=i.paint.get("building-color").evaluate(x,v,this.canonical).toPremultipliedRenderColor(this.lut),z=i.paint.get("building-emissive-strength").evaluate(x,v,this.canonical);x.properties["building-part"]="door";const W=i.paint.get("building-color").evaluate(x,v,this.canonical).toPremultipliedRenderColor(this.lut),H=i.paint.get("building-emissive-strength").evaluate(x,v,this.canonical),Q=m.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const te of m.parts){let le,de=S;te.part===1?(de=S,le=A):te.part===0?(de=N,le=M):te.part===2?(de=L,le=z):te.part===3&&(de=W,le=H),le=Pe(le,0,1);for(let pe=0;pe<te.vertexLength;pe++){const Se=te.vertexOffset+pe,we=1+(Q.layoutAOArray.uint8[Se]/255-1)*h;Q.layoutColorArray.emplace(Se,de.r*we*255<<8|de.g*we*255,de.b*we*255<<8|255*le),m.hasFauxFacade&&Q.layoutFacadePaintArray.emplace(Se,255*L.r<<8|255*L.g,255*L.b<<8|255*z)}}const ne=m.buildingBloom;if(ne)for(let te=0;te<ne.vertexLength;te++)Q.entranceBloom.layoutColorArray.emplace(ne.vertexOffset+te,255*W.r<<8|255*W.g,255*W.b<<8|51*H)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(i,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const m=l.getReplacementRegionsForTile(i.toUnwrapped());if(tA(this.activeReplacements,m))return;this.activeReplacements=m;for(const x of this.footprints)x.hiddenFlags&=-2;const v=[];for(const x of this.activeReplacements){if(x.order<h)continue;const S=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-i.canonical.z));for(const A of this.footprints)A.min.x>x.max.x||A.max.x<x.min.x||A.min.y>x.max.y||A.max.y<x.min.y||(v.length=0,Ghe(this.footprintsVertices,A.footprintVertexOffset,A.footprintVertexLength,x.footprintTileId.canonical,i.canonical,v),cR(x.footprint,v,this.footprintsIndices.uint16,A.footprintIndexOffset,A.footprintIndexLength,0,-S)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(x.groundEffectVertexOffset,x.groundEffectVertexLength,x.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(i){if(i.id!==void 0){const l=this.featureFootprintLookup.get(i.id);return this.footprints[l]}return null}getHeightAtTileCoord(i,l){let h=Number.NEGATIVE_INFINITY,m=!0;const v=4*(i+Wt)*Wt+(l+Wt);if(this.footprintLookup.hasOwnProperty(v)){const S=this.footprintLookup[v];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const x=new kt(i,l);for(const S of this.footprints)i>S.max.x||S.min.x>i||l>S.max.y||S.min.y>l||S.height<=h||qhe(x,this.footprintsVertices.float32.subarray(2*S.footprintVertexOffset,2*(S.footprintVertexOffset+S.footprintVertexLength)),this.footprintsIndices.uint16.subarray(S.footprintIndexOffset,S.footprintIndexOffset+S.footprintIndexLength))&&(h=S.height,this.footprintLookup[v]=S,m=S.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:m};this.footprintLookup[v]=void 0}}function qhe(u,i,l){for(let h=0;h<l.length;h+=3){const m=l[h],v=l[h+1],x=l[h+2],S=i[2*m+0],A=i[2*m+1],N=i[2*v+0],M=i[2*v+1],L=i[2*x+0],z=i[2*x+1],W=(S-L)*(u.y-z)-(A-z)*(u.x-L),H=(N-S)*(u.y-A)-(M-A)*(u.x-S);if(W<0!=H<0&&W!==0&&H!==0)continue;const Q=(L-N)*(u.y-M)-(z-M)*(u.x-N);if(Q===0||Q<0==W+H<=0)return!0}return!1}function Ghe(u,i,l,h,m,v){const x=Math.pow(2,h.z-m.z);for(let S=0;S<l;S++){let A=u.float32[2*(S+i)+0],N=u.float32[2*(S+i)+1];A=(A+m.x*Wt)*x-h.x*Wt,N=(N+m.y*Wt)*x-h.y*Wt,v.push(new kt(A,N))}}let X6,K6;ir(Z6,"BuildingBucket",{omit:["layers"]}),ir(NR,"BuildingGeometry"),ir(PR,"BuildingBloomGeometry");const Whe=ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Hhe=ln([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Zhe}=Whe,Xhe=ln([{name:"a_packed",components:3,type:"Float32"}]),{members:Khe}=Xhe,Yhe=ln([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Jhe}=Yhe;class Y6{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new Cp({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const h=this.getKey(i,l);return this.positions[h]}trim(){const i=this.width,l=this.height=Nt(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,h){const m=[];let v=i.length%2==1?-i[i.length-1]*h:0,x=i[0]*h,S=!0;m.push({left:v,right:x,isDash:S,zeroLength:i[0]===0});let A=i[0];for(let N=1;N<i.length;N++){S=!S;const M=i[N];v=A*h,A+=M,x=A*h,m.push({left:v,right:x,isDash:S,zeroLength:M===0})}return m}addRoundDash(i,l,h){const m=l/2;for(let v=-h;v<=h;v++){const x=this.width*(this.nextRow+h+v);let S=0,A=i[S];for(let N=0;N<this.width;N++){N/A.right>1&&(A=i[++S]);const M=Math.abs(N-A.left),L=Math.abs(N-A.right),z=Math.min(M,L);let W;const H=v/h*(m+1);if(A.isDash){const Q=m-Math.abs(H);W=Math.sqrt(z*z+Q*Q)}else W=m-Math.sqrt(z*z+H*H);this.image.data[x+N]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(i,l){for(let A=i.length-1;A>=0;--A){const N=i[A],M=i[A+1];N.zeroLength?i.splice(A,1):M&&M.isDash===N.isDash&&(M.left=N.left,i.splice(A,1))}const h=i[0],m=i[i.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const v=this.width*this.nextRow;let x=0,S=i[x];for(let A=0;A<this.width;A++){A/S.right>1&&(S=i[++x]);const N=Math.abs(A-S.left),M=Math.abs(A-S.right),L=Math.min(N,M);this.image.data[v+A]=Math.max(0,Math.min(255,(S.isDash?L:-L)+l+128))}}addDash(i,l){const h=this.getKey(i,l);if(this.positions[h])return this.positions[h];const m=l==="round",v=m?7:0,x=2*v+1;if(this.nextRow+x>this.height)return Nr("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let M=0;M<i.length;M++)i[M]<0&&(Nr("Negative value is found in line dasharray, replacing values with 0"),i[M]=0),S+=i[M];if(S!==0){const M=this.width/S,L=this.getDashRanges(i,this.width,M);m?this.addRoundDash(L,M,v):this.addRegularDash(L,l==="square"?.5*M:0)}const A=this.nextRow+v;this.nextRow+=x;const N={tl:[A,v],br:[S,0]};return this.positions[h]=N,N}}ir(Y6,"LineAtlas");const Qhe=un.types,efe=Math.cos(Math.PI/180*37.5),tfe=Math.cos(Math.PI/180*5);class IR{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Hw,this.layoutVertexArray2=new Yl,this.patternVertexArray=new Yl,this.indexArray=new Ps,this.programConfigurations=new q(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new bi,this.maxLineLength=0,this.zOffsetVertexArray=new Yl,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:128,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,m){}populate(i,l,h,m){this.hasPattern=KO("line",this.layers,this.pixelRatio,l);const v=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Mt(h);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),W=z.isConstant()&&!z.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&W?"none":"offset",this.elevationType==="offset"&&x==="none"&&Nr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const A=[];for(const{feature:z,id:W,index:H,sourceLayerIndex:Q}of i){const ne=this.layers[0]._featureFilter.needGeometry,te=Gr(z,ne);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),te,h))continue;const le=v?v.evaluate(te,{},h):void 0,de={id:W,properties:z.properties,type:z.type,sourceLayerIndex:Q,index:H,geometry:ne?te.geometry:Cr(z,h,m),patterns:{},sortKey:le};A.push(de)}v&&A.sort((z,W)=>z.sortKey-W.sortKey);const{lineAtlas:N,featureIndex:M}=l,L=this.addConstantDashes(N);for(const z of A){const{geometry:W,index:H,sourceLayerIndex:Q}=z;if(L&&this.addFeatureDashes(z,N),this.hasPattern){const ne=YO("line",this.layers,z,this.zoom,this.pixelRatio,l);this.patternFeatures.push(ne)}else this.addFeature(z,W,H,h,N.positions,l.availableImages,l.brightness,l.elevationFeatures);M.insert(i[H].feature,W,H,Q,this.index)}}addConstantDashes(i){let l=!1;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,v=h.layout.get("line-cap").value;if(m.kind!=="constant"||v.kind!=="constant")l=!0;else{const x=v.value,S=m.value;if(!S)continue;i.addDash(S,x)}}return l}addFeatureDashes(i,l){const h=this.zoom;for(const m of this.layers){const v=m.paint.get("line-dasharray").value,x=m.layout.get("line-cap").value;if(v.kind==="constant"&&x.kind==="constant")continue;let S,A;if(v.kind==="constant"){if(S=v.value,!S)continue}else S=v.evaluate({zoom:h},i);A=x.kind==="constant"?x.value:x.evaluate({zoom:h},i),l.addDash(S,A),i.patterns[m.id]=[l.getKey(S,A)]}}update(i,l,h,m,v,x,S,A){this.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,A)}addFeatures(i,l,h,m,v,x){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,h,m,x,i.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Khe)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Jhe)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Hhe.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Zhe),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i,l){let h,m;if(l&&l>0?(h=`mapbox_clip_start_${l}`,m=`mapbox_clip_end_${l}`):(h="mapbox_clip_start",m="mapbox_clip_end"),i.properties&&i.properties.hasOwnProperty(h)&&i.properties.hasOwnProperty(m))return{start:+i.properties[h],end:+i.properties[m]}}addFeature(i,l,h,m,v,x,S,A){const N=this.layers[0].layout,M=N.get("line-join").evaluate(i,{}),L=N.get("line-cap").evaluate(i,{}),z=N.get("line-miter-limit"),W=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i;const H=!(!i.properties||!i.properties.hasOwnProperty("mapbox_line_metrics"))&&i.properties.mapbox_line_metrics;this.zOffsetValue=N.get("line-z-offset").value;const Q=this.layers[0].paint.get("line-width").value;if(Q.kind!=="constant"&&Q.isLineProgressConstant===!1&&(this.variableWidthValue=Q),this.elevationType==="road"){const ne=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,l,m,A,M,L,z,W)){const[te,le]=this.clipRuntimeLinesToTile(l,1);for(let de=0;de<te.length;de++){const pe=te[de],Se=le[de],we={progress:{min:Se.progress.min,max:Se.progress.max},nextDir:this.computeSegNextDir(Se,pe),prevDir:this.computeSegPrevDir(Se,pe)};this.addLine(pe,i,m,M,L,z,W,we,H&&Se.parentIndex>0?Se.parentIndex:null)}this.fillNonElevatedRoadSegment(ne)}}else for(let ne=0;ne<l.length;ne++)this.addLine(l[ne],i,m,M,L,z,W,void 0,H&&ne>0?ne:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,v,x,m,S,void 0,this.worldview)}computeSegNextDir(i,l){return i.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(i,l){return l[1].sub(i.prevPoint).unit()}clipLinesToTile(i,l){return iA(i,-l,-l,Wt+l,Wt+l)}clipRuntimeLinesToTile(i,l){const h=[];return[iA(i,-l,-l,Wt+l,Wt+l,h),h]}addElevatedRoadFeature(i,l,h,m,v,x,S,A){const N=[],M=Io.getElevationFeature(i,m);if(M){const L=this.clipLinesToTile(l,1),z=this.prepareElevatedLines(L,M,h);for(const W of z)N.push({geometry:W,elevation:M,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(N.length===0)return!1;for(const L of N){const z=this.layoutVertexArray.length;this.addLine(L.geometry,i,h,v,x,S,A);const W=new Jl(h,L.elevationTileID);if(L.elevation)for(let H=z;H<this.layoutVertexArray.length;H++){const Q=new kt(this.layoutVertexArray.int16[6*H]>>1,this.layoutVertexArray.int16[6*H+1]>>1),ne=W.pointElevation(Q,L.elevation,.05);this.updateHeightRange(ne),this.zOffsetVertexArray.emplaceBack(ne,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(i,l,h){if(l.constantHeight!=null)return i;const m=[],v=1/Mt(h);for(const x of i)che(x,new Zo(l,v),0,m);return m}fillNonElevatedRoadSegment(i){for(let l=i;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,l,h,m,v,x,S,A,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=N?this.lineFeatureClips(l,N):this.lineClips;const M=m==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const L=A&&A.progress.min>0,z=A&&A.progress.max<1;if(this.lineClips){let Ne={min:this.lineClips.start,max:this.lineClips.end},Fe=1;if(A){const at=this.lineClips.end-this.lineClips.start;Ne=function(ut,bt,_t){return{min:ia(ut.min,bt,_t),max:ia(ut.max,bt,_t)}}(A.progress,{min:0,max:1},Ne),at>0&&(Fe=(Ne.max-Ne.min)/at)}const qe=+l.properties.mapbox_clip_feature_len,ht=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(qe)||Number.isNaN(ht)){for(let ut=0;ut<i.length-1;ut++)this.totalDistance+=i[ut].dist(i[ut+1]);const at=this.totalDistance/(Ne.max-Ne.min);this.totalFeatureLength=Number.isFinite(at)?at:0,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=qe,this.distance=ht*Fe,this.lineClips.start=Ne.min,this.lineClips.end=Ne.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const W=Qhe[l.type]==="Polygon";let H=i.length;for(;H>=2&&i[H-1].equals(i[H-2]);)H--;let Q=0;for(;Q<H-1&&i[Q].equals(i[Q+1]);)Q++;if(H<(W?3:2))return;m==="bevel"&&(x=1.05);const ne=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let te,le,de,pe,Se,we,Ie,Oe;A&&A.prevDir&&(we=A.prevDir.perp()),A&&A.nextDir&&(Ie=A.nextDir.perp()),this.e1=this.e2=-1,W&&(te=i[H-2],Se=i[Q].sub(te)._unit()._perp());for(let Ne=Q;Ne<H;Ne++){if(de=Ne===H-1?W?i[Q+1]:void 0:i[Ne+1],de&&i[Ne].equals(de))continue;Se&&(pe=Se),te&&(le=te),te=i[Ne],Oe=this.evaluateLineProgressFeatures(le?le.dist(te):0),Se=de?de.sub(te)._unit()._perp():pe,pe=pe||Se;const Fe=le&&de;let qe=Fe?m:W||M?"butt":v;const ht=pe.x*Se.x+pe.y*Se.y;if(M){const mt=function(jt){if(jt.patternJoinNone){const wt=jt.segmentPoints.length/2,Qt=jt.lineSoFar-jt.segmentStart;for(let er=0;er<wt;++er){const qt=jt.segmentPoints[2*er+1],Ht=Math.round(jt.segmentPoints[2*er])+.5+.25*qt;jt.patternVertexArray.emplaceBack(Ht,Qt,jt.segmentStart),jt.patternVertexArray.emplaceBack(Ht,Qt,jt.segmentStart)}jt.segmentPoints.length=0}jt.e1=jt.e2=-1};if(Fe&&ht<tfe){this.updateDistance(le,te),this.addCurrentVertex(te,pe,1,1,ne,Oe),mt(this),this.addCurrentVertex(te,Se,-1,-1,ne,Oe);continue}if(le){if(!de){this.updateDistance(le,te),this.addCurrentVertex(te,pe,1,1,ne,Oe),mt(this);continue}qe="miter"}}let at=pe.add(Se);at.x===0&&at.y===0||at._unit();const ut=at.x*Se.x+at.y*Se.y,bt=ut!==0?1/ut:1/0,_t=2*Math.sqrt(2-2*ut),xt=ut<efe&&le&&de,rt=pe.x*Se.y-pe.y*Se.x>0,Tt=this.overscaling<=16?122880/(512*this.overscaling):0;if(Fe&&qe==="round"){if(bt<S)qe="miter";else if(bt<=2){const mt=kR(te,-10,8202);qe=this.elevationType==="offset"&&(mt||this.hasCrossSlope)?"miter":"fakeround"}}if(qe==="miter"&&bt>x&&(qe="bevel"),qe==="bevel"&&(bt>2&&(qe="flipbevel"),bt<x&&(qe="miter")),le&&!(qe==="miter"&&xt)&&this.updateDistance(le,te),qe==="miter")if(xt){const mt=te.dist(le);if(mt>2*Tt){const wt=te.sub(te.sub(le)._mult(Tt/mt)._round());this.updateDistance(le,wt),this.addCurrentVertex(wt,pe,0,0,ne,Oe),le=wt}this.updateDistance(le,te),at._mult(bt),this.addCurrentVertex(te,at,0,0,ne,Oe);const jt=te.dist(de);if(jt>2*Tt){const wt=te.add(de.sub(te)._mult(Tt/jt)._round());this.updateDistance(te,wt),this.addCurrentVertex(wt,Se,0,0,ne,Oe),te=wt}}else at._mult(bt),this.addCurrentVertex(te,at,0,0,ne,Oe);else if(qe==="flipbevel"){if(bt>100)at=Se.mult(-1);else{const mt=bt*pe.add(Se).mag()/pe.sub(Se).mag();at._perp()._mult(mt*(rt?-1:1))}this.addCurrentVertex(te,at,0,0,ne,Oe),this.addCurrentVertex(te,at.mult(-1),0,0,ne,Oe)}else if(qe==="bevel"||qe==="fakeround"){Oe!=null&&le&&this.addCurrentVertex(te,Ie||pe,-1,-1,ne,Oe);const mt=te.dist(le)<=2*Tt&&qe!=="bevel",jt=at.mult(rt?1:-1);jt._mult(bt);const wt=Se.mult(rt?-1:1),Qt=pe.mult(rt?-1:1),er=this.evaluateLineProgressFeatures(this.distance);if(Oe==null&&(this.addHalfVertex(te,jt.x,jt.y,!1,!rt,0,ne,er),mt||this.addHalfVertex(te,jt.x+2*Qt.x,jt.y+2*Qt.y,!1,rt,0,ne,er)),qe==="fakeround"){const qt=Math.round(180*_t/Math.PI/20);this.addHalfVertex(te,Qt.x,Qt.y,!1,rt,0,ne,er);for(let Ht=0;Ht<qt;Ht++){let xr=Ht/qt;if(xr!==.5){const Yt=xr-.5;xr+=xr*Yt*(xr-1)*((1.0904+ht*(ht*(3.55645-1.43519*ht)-3.2452))*Yt*Yt+(.848013+ht*(.215638*ht-1.06021)))}const cr=wt.sub(Qt)._mult(xr)._add(Qt)._unit();this.addHalfVertex(te,cr.x,cr.y,!1,rt,0,ne,er)}this.addHalfVertex(te,wt.x,wt.y,!1,rt,0,ne,er)}mt||Oe!=null||this.addHalfVertex(te,jt.x+2*wt.x,jt.y+2*wt.y,!1,rt,0,ne,er),Oe!=null&&de&&this.addCurrentVertex(te,we||Se,1,1,ne,Oe)}else if(qe==="butt")this.addCurrentVertex(te,at,0,0,ne,Oe);else if(qe==="square"){if(!le){const mt=L?0:-1;this.addCurrentVertex(te,at,mt,mt,ne,Oe)}if(this.addCurrentVertex(te,at,0,0,ne,Oe),le){const mt=z?0:1;this.addCurrentVertex(te,at,mt,mt,ne,Oe)}}else if(qe==="round"){if(le){const mt=!Fe&&Ie?Ie:pe;this.addCurrentVertex(te,mt,0,0,ne,Oe),!Fe&&z||this.addCurrentVertex(te,mt,1,1,ne,Oe,!0)}if(de){const mt=!Fe&&we?we:Se;!Fe&&L||this.addCurrentVertex(te,mt,-1,-1,ne,Oe,!0),this.addCurrentVertex(te,mt,0,0,ne,Oe)}}}}addVerticesTo(i,l,h,m,v,x,S,A,N,M){const L=(l.w-i.w)/this.tessellationStep|0;let z=0;const W=this.scaledDistance;if(L>1){this.lineSoFar=i.w;const Q=(l.x-i.x)/L,ne=(l.y-i.y)/L,te=(l.z-i.z)/L,le=(l.w-i.w)/L;for(let de=1;de<L;++de){i.x+=Q,i.y+=ne,i.z+=te,this.lineSoFar+=le,z+=le;const pe=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(i,h,m,M,!1,S,N,pe),this.addHalfVertex(i,v,x,M,!0,-A,N,pe)}}this.lineSoFar=l.w,this.scaledDistance=W;const H=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,h,m,M,!1,S,N,H),this.addHalfVertex(l,v,x,M,!0,-A,N,H)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):Nr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(i,l,h,m,v,x,S=!1){const A=l.x+l.y*h,N=l.y-l.x*h,M=l.y*m-l.x,L=-l.y-l.x*m;if(x!=null){const z=this.elevationType==="offset",W=-10,H=8202,Q=x.zOffset,ne=new f6(i.x,i.y,Q,this.lineSoFar),te=!!z&&kR(i,W,H),le=this.lineSoFar,de=this.distance;if(this.currentVertex)if(te){const pe=this.currentVertexIsOutside,Se=this.currentVertex,we=new f6(i.x,i.y,Q,this.lineSoFar);if(m6(Se,we,W,H),!kR(we,W,H)){if(pe){this.e1=this.e2=-1,this.distance-=Se.dist(ne),this.lineSoFar=Se.w;const Ie=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,A,N,S,!1,h,v,Ie),this.addHalfVertex(Se,M,L,S,!0,-m,v,Ie),this.prevDistance=this.distance}this.distance=this.prevDistance+Se.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Se,we,A,N,M,L,h,m,v,S),this.distance=de,this.scaledDistance=this.distance/this.totalDistance}}else{const pe=this.currentVertex;if(this.currentVertexIsOutside){m6(pe,ne,W,H),this.e1=this.e2=-1,this.distance-=pe.dist(ne),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=pe.w;const Se=this.evaluateLineProgressFeatures(pe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pe,A,N,S,!1,h,v,Se),this.addHalfVertex(pe,M,L,S,!0,-m,v,Se),this.prevDistance=this.distance,this.distance=de,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(pe,ne,A,N,M,L,h,m,v,S)}else te||(this.addHalfVertex(i,A,N,S,!1,h,v,x),this.addHalfVertex(i,M,L,S,!0,-m,v,x));this.currentVertex=ne,this.currentVertexIsOutside=te,this.lineSoFar=le}else this.addHalfVertex(i,A,N,S,!1,h,v,x),this.addHalfVertex(i,M,L,S,!0,-m,v,x)}addHalfVertex({x:i,y:l},h,m,v,x,S,A,N){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const L=jr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,L)}const M=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),A.primitiveLength++),x?this.e2=M:this.e1=M,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,l){this.prevDistance=this.distance,this.distance+=i.dist(l),this.updateScaledDistance()}}function kR(u,i,l){return u.x<i||u.x>l||u.y<i||u.y>l}let J6,Q6;function eU(u,i,l){return i*(Wt/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}ir(IR,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const tU=(u,i,l)=>(1-l)*u+l*i;function rU(u,i){return 1/eU(u,1,i.tileZoom)}function nU(u,i,l,h){return u.translatePosMatrix(h||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const iU=u=>{const i=[];sU(u)&&i.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const l=u.paint.get("line-trim-offset");l[0]===0&&l[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const h=u.layout.get("line-join").constantOr("miter")==="none",m=!!u.paint.get("line-pattern").constantOr(1);return h&&m&&i.push("LINE_JOIN_NONE"),i};function sU(u){const i=u.paint.get("line-dasharray").value;return i.kind!=="constant"||i.value}let OR;const aU=()=>OR||(OR={layout:J6||(J6=new Mi({"line-cap":new Kt(Qe.layout_line["line-cap"]),"line-join":new Kt(Qe.layout_line["line-join"]),"line-miter-limit":new Lt(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Qe.layout_line["line-round-limit"]),"line-sort-key":new Kt(Qe.layout_line["line-sort-key"]),"line-z-offset":new Kt(Qe.layout_line["line-z-offset"]),"line-elevation-reference":new Lt(Qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Lt(Qe.layout_line["line-cross-slope"]),visibility:new Lt(Qe.layout_line.visibility),"line-width-unit":new Lt(Qe.layout_line["line-width-unit"])})),paint:Q6||(Q6=new Mi({"line-opacity":new Kt(Qe.paint_line["line-opacity"]),"line-color":new Kt(Qe.paint_line["line-color"]),"line-translate":new Lt(Qe.paint_line["line-translate"]),"line-translate-anchor":new Lt(Qe.paint_line["line-translate-anchor"]),"line-width":new Kt(Qe.paint_line["line-width"]),"line-gap-width":new Kt(Qe.paint_line["line-gap-width"]),"line-offset":new Kt(Qe.paint_line["line-offset"]),"line-blur":new Kt(Qe.paint_line["line-blur"]),"line-dasharray":new Kt(Qe.paint_line["line-dasharray"]),"line-pattern":new Kt(Qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Lt(Qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new vp(Qe.paint_line["line-gradient"]),"line-trim-offset":new Lt(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Lt(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Lt(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new Kt(Qe.paint_line["line-emissive-strength"]),"line-border-width":new Kt(Qe.paint_line["line-border-width"]),"line-border-color":new Kt(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Lt(Qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},OR);class rfe extends Kt{possiblyEvaluate(i,l){return l=new Wn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition,worldview:l.worldview}),super.possiblyEvaluate(i,l)}evaluate(i,l,h,m){return l=Object.assign({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,h,m)}}let S1;function oU(u,i){return i>0?i+2*u:u}const nfe=ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ife=ln([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),sfe=ln([{name:"a_projected_pos",components:4,type:"Float32"}],4);ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const afe=ln([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ofe=ln([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),lfe=ln([{name:"a_texb",components:2,type:"Uint16"}]),cfe=ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ufe=ln([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lU=ln([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dfe=ln([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ln([{name:"triangle",components:3,type:"Uint16"}]),ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ln([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ln([{type:"Float32",name:"offsetX"}]),ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xs=24;function hfe(u,i,l){return u.sections.forEach(h=>{h.text=function(m,v,x){const S=v.layout.get("text-transform").evaluate(x,{});return S==="uppercase"?m=m.toLocaleUpperCase():S==="lowercase"&&(m=m.toLocaleLowerCase()),yc.applyArabicShaping&&(m=yc.applyArabicShaping(m)),m}(h.text,i,l)}),u}const T1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function ffe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function pfe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const RR=4294967296,cU=1/RR,uU=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let mA=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,i,l=this.length){for(;this.pos<l;){const h=this.readVarint(),m=h>>3,v=this.pos;this.type=7&h,u(m,i,this),this.pos===v&&this.skip(h)}return i}readMessage(u,i){return this.readFields(u,i,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*RR;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*RR;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const i=this.buf;let l,h;return h=i[this.pos++],l=127&h,h<128?l:(h=i[this.pos++],l|=(127&h)<<7,h<128?l:(h=i[this.pos++],l|=(127&h)<<14,h<128?l:(h=i[this.pos++],l|=(127&h)<<21,h<128?l:(h=i[this.pos],l|=(15&h)<<28,function(m,v,x){const S=x.buf;let A,N;if(N=S[x.pos++],A=(112&N)>>4,N<128||(N=S[x.pos++],A|=(127&N)<<3,N<128)||(N=S[x.pos++],A|=(127&N)<<10,N<128)||(N=S[x.pos++],A|=(127&N)<<17,N<128)||(N=S[x.pos++],A|=(127&N)<<24,N<128)||(N=S[x.pos++],A|=(1&N)<<31,N<128))return L_(m,A,v);throw new Error("Expected varint not more than 10 bytes")}(l,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,i=this.pos;return this.pos=u,u-i>=12&&uU?uU.decode(this.buf.subarray(i,u)):function(l,h,m){let v="",x=h;for(;x<m;){const S=l[x];let A,N,M,L=null,z=S>239?4:S>223?3:S>191?2:1;if(x+z>m)break;z===1?S<128&&(L=S):z===2?(A=l[x+1],(192&A)==128&&(L=(31&S)<<6|63&A,L<=127&&(L=null))):z===3?(A=l[x+1],N=l[x+2],(192&A)==128&&(192&N)==128&&(L=(15&S)<<12|(63&A)<<6|63&N,(L<=2047||L>=55296&&L<=57343)&&(L=null))):z===4&&(A=l[x+1],N=l[x+2],M=l[x+3],(192&A)==128&&(192&N)==128&&(192&M)==128&&(L=(15&S)<<18|(63&A)<<12|(63&N)<<6|63&M,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,z=1):L>65535&&(L-=65536,v+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),v+=String.fromCharCode(L),x+=z}return v}(this.buf,i,u)}readBytes(){const u=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,u);return this.pos=u,i}readPackedVarint(u=[],i){const l=this.readPackedEnd();for(;this.pos<l;)u.push(this.readVarint(i));return u}readPackedSVarint(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const i=this.readPackedEnd();for(;this.pos<i;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const i=7&u;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(u,i){this.writeVarint(u<<3|i)}realloc(u){let i=this.length||16;for(;i<this.pos+u;)i*=2;if(i!==this.length){const l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*cU),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*cU),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(i,l){let h,m;if(i>=0?(h=i%4294967296|0,m=i/4294967296|0):(h=~(-i%4294967296),m=~(-i/4294967296),4294967295^h?h=h+1|0:(h=0,m=m+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(v,x,S){S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,S.buf[S.pos]=127&(v>>>=7)}(h,0,l),function(v,x){const S=(7&v)<<4;x.buf[x.pos++]|=S|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(m,l)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const i=this.pos;this.pos=function(h,m,v){for(let x,S,A=0;A<m.length;A++){if(x=m.charCodeAt(A),x>55295&&x<57344){if(!S){x>56319||A+1===m.length?(h[v++]=239,h[v++]=191,h[v++]=189):S=x;continue}if(x<56320){h[v++]=239,h[v++]=191,h[v++]=189,S=x;continue}x=S-55296<<10|x-56320|65536,S=null}else S&&(h[v++]=239,h[v++]=191,h[v++]=189,S=null);x<128?h[v++]=x:(x<2048?h[v++]=x>>6|192:(x<65536?h[v++]=x>>12|224:(h[v++]=x>>18|240,h[v++]=x>>12&63|128),h[v++]=x>>6&63|128),h[v++]=63&x|128)}return v}(this.buf,u,this.pos);const l=this.pos-i;l>=128&&dU(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const i=u.length;this.writeVarint(i),this.realloc(i);for(let l=0;l<i;l++)this.buf[this.pos++]=u[l]}writeRawMessage(u,i){this.pos++;const l=this.pos;u(i,this);const h=this.pos-l;h>=128&&dU(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeMessage(u,i,l){this.writeTag(u,2),this.writeRawMessage(i,l)}writePackedVarint(u,i){i.length&&this.writeMessage(u,mfe,i)}writePackedSVarint(u,i){i.length&&this.writeMessage(u,gfe,i)}writePackedBoolean(u,i){i.length&&this.writeMessage(u,_fe,i)}writePackedFloat(u,i){i.length&&this.writeMessage(u,yfe,i)}writePackedDouble(u,i){i.length&&this.writeMessage(u,vfe,i)}writePackedFixed32(u,i){i.length&&this.writeMessage(u,xfe,i)}writePackedSFixed32(u,i){i.length&&this.writeMessage(u,bfe,i)}writePackedFixed64(u,i){i.length&&this.writeMessage(u,wfe,i)}writePackedSFixed64(u,i){i.length&&this.writeMessage(u,Sfe,i)}writeBytesField(u,i){this.writeTag(u,2),this.writeBytes(i)}writeFixed32Field(u,i){this.writeTag(u,5),this.writeFixed32(i)}writeSFixed32Field(u,i){this.writeTag(u,5),this.writeSFixed32(i)}writeFixed64Field(u,i){this.writeTag(u,1),this.writeFixed64(i)}writeSFixed64Field(u,i){this.writeTag(u,1),this.writeSFixed64(i)}writeVarintField(u,i){this.writeTag(u,0),this.writeVarint(i)}writeSVarintField(u,i){this.writeTag(u,0),this.writeSVarint(i)}writeStringField(u,i){this.writeTag(u,2),this.writeString(i)}writeFloatField(u,i){this.writeTag(u,5),this.writeFloat(i)}writeDoubleField(u,i){this.writeTag(u,1),this.writeDouble(i)}writeBooleanField(u,i){this.writeVarintField(u,+i)}};function L_(u,i,l){return l?4294967296*i+(u>>>0):4294967296*(i>>>0)+(u>>>0)}function dU(u,i,l){const h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(let m=l.pos-1;m>=u;m--)l.buf[m+h]=l.buf[m]}function mfe(u,i){for(let l=0;l<u.length;l++)i.writeVarint(u[l])}function gfe(u,i){for(let l=0;l<u.length;l++)i.writeSVarint(u[l])}function yfe(u,i){for(let l=0;l<u.length;l++)i.writeFloat(u[l])}function vfe(u,i){for(let l=0;l<u.length;l++)i.writeDouble(u[l])}function _fe(u,i){for(let l=0;l<u.length;l++)i.writeBoolean(u[l])}function xfe(u,i){for(let l=0;l<u.length;l++)i.writeFixed32(u[l])}function bfe(u,i){for(let l=0;l<u.length;l++)i.writeSFixed32(u[l])}function wfe(u,i){for(let l=0;l<u.length;l++)i.writeFixed64(u[l])}function Sfe(u,i){for(let l=0;l<u.length;l++)i.writeSFixed64(u[l])}function Tfe(u,i,l){i.glyphs=[],u===1&&l.readMessage(Efe,i)}function Efe(u,i,l){if(u===3){const{id:h,bitmap:m,width:v,height:x,left:S,top:A,advance:N}=l.readMessage(jfe,{});i.glyphs.push({id:h,bitmap:new Cp({width:v+6,height:x+6},m),metrics:{width:v,height:x,left:S,top:A,advance:N}})}else u===4?i.ascender=l.readSVarint():u===5&&(i.descender=l.readSVarint())}function jfe(u,i,l){u===1?i.id=l.readVarint():u===2?i.bitmap=l.readBytes():u===3?i.width=l.readVarint():u===4?i.height=l.readVarint():u===5?i.left=l.readSVarint():u===6?i.top=l.readSVarint():u===7&&(i.advance=l.readVarint())}const Al={horizontal:1,vertical:2,horizontalOnly:3};class E1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,l){const h=new E1;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new E1;return l.image=i,l}}class F_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l,h){const m=new F_;for(let v=0;v<i.sections.length;v++){const x=i.sections[v];x.image?m.addImageSection(x,h):m.addTextSection(x,l)}return m}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(l,h){let m="";for(let v=0;v<l.length;v++){const x=l.charCodeAt(v+1)||null,S=l.charCodeAt(v-1)||null;m+=!h&&(x&&kw(x)&&!T1[l[v+1]]||S&&kw(S)&&!T1[l[v-1]])||!T1[l[v]]?l[v]:T1[l[v]]}return m}(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&gA[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&gA[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new F_;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(E1.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(h)}addImageSection(i,l){const h=i.image?i.image.getPrimary():null;if(!h)return void Nr("Can't add FormattedSection with an empty image.");h.scaleSelf(l);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(E1.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function MR(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q=1){const ne=F_.fromFeature(u,m,Q);L===Al.vertical&&ne.verticalizePunctuation(z);let te=[];const le=function(Ie,Oe,Ne,Fe,qe,ht){if(!Ie)return[];const at=[],ut=function(xt,rt,Tt,mt,jt,wt){let Qt=0;for(let er=0;er<xt.length();er++){const qt=xt.getSection(er);Qt+=hU(xt.getCodePoint(er),qt,mt,jt,rt,wt)}return Qt/Math.max(1,Math.ceil(Qt/Tt))}(Ie,Oe,Ne,Fe,qe,ht),bt=Ie.text.indexOf("")>=0;let _t=0;for(let xt=0;xt<Ie.length();xt++){const rt=Ie.getSection(xt),Tt=Ie.getCodePoint(xt);if(gA[Tt]||(_t+=hU(Tt,rt,Fe,qe,Oe,ht)),xt<Ie.length()-1){const mt=dj(Tt);(Afe[Tt]||mt||rt.image)&&at.push(pU(xt+1,_t,ut,at,Cfe(Tt,Ie.getCodePoint(xt+1),mt&&bt),!1))}}return mU(pU(Ie.length(),_t,ut,at,0,!0))}(ne,N,v,i,h,W),{processBidirectionalText:de,processStyledBidirectionalText:pe}=yc;if(de&&ne.sections.length===1){const Ie=de(ne.toString(),le);for(const Oe of Ie){const Ne=new F_;Ne.text=Oe,Ne.sections=ne.sections;for(let Fe=0;Fe<Oe.length;Fe++)Ne.sectionIndex.push(0);te.push(Ne)}}else if(pe){const Ie=pe(ne.text,ne.sectionIndex,le);for(const Oe of Ie){const Ne=new F_;Ne.text=Oe[0],Ne.sectionIndex=Oe[1],Ne.sections=ne.sections,te.push(Ne)}}else te=function(Ie,Oe){const Ne=[],Fe=Ie.text;let qe=0;for(const ht of Oe)Ne.push(Ie.substring(qe,ht)),qe=ht;return qe<Fe.length&&Ne.push(Ie.substring(qe,Fe.length)),Ne}(ne,le);const Se=[],we={positionedLines:Se,text:ne.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ie,Oe,Ne,Fe,qe,ht,at,ut,bt,_t,xt,rt){let Tt=0,mt=0,jt=0;const wt=ut==="right"?1:ut==="left"?0:.5;let Qt=!1;for(const cr of qe){const Yt=cr.getSections();for(const kr of Yt){if(kr.image)continue;const nn=Oe[kr.fontStack];if(nn&&(Qt=nn.ascender!==void 0&&nn.descender!==void 0,!Qt))break}if(!Qt)break}let er=0;for(const cr of qe){cr.trim();const Yt=cr.getMaxScale(),kr=(Yt-1)*Xs,nn={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[er]=nn;const En=nn.positionedGlyphs;let en=0;if(!cr.length()){mt+=ht,++er;continue}let Hn=0,yn=0;for(let wn=0;wn<cr.length();wn++){const Vn=cr.getSection(wn),yi=cr.getSectionIndex(wn),Ai=cr.getCodePoint(wn);let Ci=Vn.scale,Ki=null,oa=null,Ca=null,_s=Xs,Is=0,Us=bt;Us===Al.vertical&&hj(Ai)&&(Us=Al.horizontal);const Zr=!(Us===Al.horizontal||!xt&&!Vd(Ai)||xt&&(gA[Ai]||g_(Ai)));if(Vn.image){const Pi=Fe.get(Vn.image.toString());if(!Pi)continue;Ca=Vn.image,Ie.iconsInText=Ie.iconsInText||!0,oa=Pi.paddedRect;const Li=Pi.displaySize;Ci=Ci*Xs/rt,Ki={width:Li[0],height:Li[1],left:0,top:-3,advance:Zr?Li[1]:Li[0],localGlyph:!1},Is=Qt?-Ki.height*Ci:Yt*Xs-17-Li[1]*Ci,_s=Ki.advance;const Cl=(Zr?Li[0]:Li[1])*Ci-Xs*Yt;Cl>0&&Cl>en&&(en=Cl)}else{const Pi=Ne[Vn.fontStack];if(!Pi)continue;Pi[Ai]&&(oa=Pi[Ai]);const Li=Oe[Vn.fontStack];if(!Li)continue;const Cl=Li.glyphs[Ai];if(!Cl)continue;if(Ki=Cl.metrics,_s=Ai!==8203?Xs:0,Qt){const po=Li.ascender!==void 0?Math.abs(Li.ascender):0,la=Li.descender!==void 0?Math.abs(Li.descender):0,mo=(po+la)*Ci;Hn<mo&&(Hn=mo,yn=(po-la)/2*Ci),Is=-po*Ci}else Is=(Yt-Ci)*Xs-17}Zr?(Ie.verticalizable=!0,En.push({glyph:Ai,image:Ca,x:Tt,y:mt+Is,vertical:Zr,scale:Ci,localGlyph:Ki.localGlyph,fontStack:Vn.fontStack,sectionIndex:yi,metrics:Ki,rect:oa}),Tt+=_s*Ci+_t):(En.push({glyph:Ai,image:Ca,x:Tt,y:mt+Is,vertical:Zr,scale:Ci,localGlyph:Ki.localGlyph,fontStack:Vn.fontStack,sectionIndex:yi,metrics:Ki,rect:oa}),Tt+=Ki.advance*Ci+_t)}En.length!==0&&(jt=Math.max(Tt-_t,jt),Qt?gU(En,wt,en,yn,ht*Yt/2):gU(En,wt,en,0,ht/2)),Tt=0;const Xi=ht*Yt+en;nn.lineOffset=Math.max(en,kr),mt+=Xi,++er}const qt=mt,{horizontalAlign:Ht,verticalAlign:xr}=DR(at);(function(cr,Yt,kr,nn,En,en){const Hn=(Yt-kr)*En,yn=-en*nn;for(const Xi of cr)for(const wn of Xi.positionedGlyphs)wn.x+=Hn,wn.y+=yn})(Ie.positionedLines,wt,Ht,xr,jt,qt),Ie.top+=-xr*qt,Ie.bottom=Ie.top+qt,Ie.left+=-Ht*jt,Ie.right=Ie.left+jt,Ie.hasBaseline=Qt}(we,i,l,h,te,x,S,A,L,N,z,H),!function(Ie){for(const Oe of Ie)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(Se))return we}const gA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Afe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hU(u,i,l,h,m,v){if(i.image){const x=h.get(i.image.toString());return x?x.displaySize[0]*i.scale*Xs/v+m:0}{const x=l[i.fontStack],S=x&&x.glyphs[u];return S?S.metrics.advance*i.scale+m:0}}function fU(u,i,l,h){const m=Math.pow(u-i,2);return h?u<i?m/2:2*m:m+Math.abs(l)*l}function Cfe(u,i,l){let h=0;return u===10&&(h-=1e4),l&&(h+=150),u!==40&&u!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function pU(u,i,l,h,m,v){let x=null,S=fU(i,l,m,v);for(const A of h){const N=fU(i-A.x,l,m,v)+A.badness;N<=S&&(x=A,S=N)}return{index:u,x:i,priorBreak:x,badness:S}}function mU(u){return u?mU(u.priorBreak).concat(u.index):[]}function DR(u){let i=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function gU(u,i,l,h,m){if(!(i||l||h||m))return;const v=u.length-1,x=u[v],S=(x.x+x.metrics.advance*x.scale)*i;for(let A=0;A<=v;A++)u[A].x-=S,u[A].y+=l+h+m}function LR(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function yA(u,i,l,h){const{horizontalAlign:m,verticalAlign:v}=DR(h),x=l[0]-u.displaySize[0]*m,S=l[1]-u.displaySize[1]*v;return{imagePrimary:u,imageSecondary:i,top:S,bottom:S+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function FR(u,i,l,h,m,v){const x=u.imagePrimary;let S;if(x.content){const ne=x.content,te=x.pixelRatio||1;S=[ne[0]/te,ne[1]/te,x.displaySize[0]-ne[2]/te,x.displaySize[1]-ne[3]/te]}const A=i.left*v,N=i.right*v;let M,L,z,W;l==="width"||l==="both"?(W=m[0]+A-h[3],L=m[0]+N+h[1]):(W=m[0]+(A+N-x.displaySize[0])/2,L=W+x.displaySize[0]);const H=i.top*v,Q=i.bottom*v;return l==="height"||l==="both"?(M=m[1]+H-h[0],z=m[1]+Q+h[2]):(M=m[1]+(H+Q-x.displaySize[1])/2,z=M+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:M,right:L,bottom:z,left:W,collisionPadding:S}}function yU(u){return!u.imagePrimary.stretchX}function vU(u){return!u.imagePrimary.stretchY}function _U(u){return{width:u.right-u.left,height:u.bottom-u.top}}const nf=128;function Qg(u,i,l,h){const{expression:m}=i;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new Wn(u+1,{worldview:l}),void 0,void 0,void 0,h)};if(m.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:x}=m;let S=0;for(;S<v.length&&v[S]<=u;)S++;S=Math.max(0,S-1);let A=S;for(;A<v.length&&v[A]<u+1;)A++;A=Math.min(v.length-1,A);const N=v[S],M=v[A];return m.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:M,interpolationType:x}:{kind:"camera",minZoom:N,maxZoom:M,minSize:m.evaluate(new Wn(N,{worldview:l}),void 0,void 0,void 0,h),maxSize:m.evaluate(new Wn(M,{worldview:l}),void 0,void 0,void 0,h),interpolationType:x}}}function zR(u,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:m}){return u.kind==="source"?h/nf:u.kind==="composite"?jr(h/nf,m/nf,l):i}function z_(u,i,l=1){let h=0,m=0;if(u.kind==="constant")m=u.layoutSize*l;else if(u.kind!=="source"){const{interpolationType:v,minZoom:x,maxZoom:S}=u,A=v?Pe(xl.interpolationFactor(v,i,x,S),0,1):0;u.kind==="camera"?m=jr(u.minSize,u.maxSize,A)*l:h=A*l}return{uSizeT:h,uSize:m}}class sf extends kt{constructor(i,l,h,m,v){super(i,l),this.angle=m,this.z=h,v!==void 0&&(this.segment=v)}clone(){return new sf(this.x,this.y,this.z,this.angle,this.segment)}}function xU(u,i,l,h,m){if(i.segment===void 0)return!0;let v=i,x=i.segment+1,S=0;for(;S>-l/2;){if(x--,x<0)return!1;S-=u[x].dist(v),v=u[x]}S+=u[x].dist(u[x+1]),x++;const A=[];let N=0;for(;S<l/2;){const M=u[x],L=u[x+1];if(!L)return!1;let z=u[x-1].angleTo(M)-M.angleTo(L);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:S,angleDelta:z}),N+=z;S-A[0].distance>h;)N-=A.shift().angleDelta;if(N>m)return!1;x++,S+=M.dist(L)}return!0}function bU(u){let i=0;for(let l=0;l<u.length-1;l++)i+=u[l].dist(u[l+1]);return i}function wU(u,i,l){return u?.6*i*l:0}function SU(u,i){return Math.max(u?u.right-u.left:0,i?i.right-i.left:0)}function Pfe(u,i,l,h,m,v){const x=wU(l,m,v),S=SU(l,h)*v;let A=0;const N=bU(u)/2;for(let M=0;M<u.length-1;M++){const L=u[M],z=u[M+1],W=L.dist(z);if(A+W>N){const H=(N-A)/W,Q=jr(L.x,z.x,H),ne=jr(L.y,z.y,H),te=new sf(Q,ne,0,z.angleTo(L),M);return!x||xU(u,te,S,x,i)?te:void 0}A+=W}}function Nfe(u,i,l,h,m,v,x,S,A){const N=wU(h,v,x),M=SU(h,m),L=M*x,z=u[0].x===0||u[0].x===A||u[0].y===0||u[0].y===A;return i-L<i/4&&(i=L+i/4),TU(u,z?i/2*S%i:(M/2+2*v)*x*S%i,i,N,l,L,z,!1,A)}function TU(u,i,l,h,m,v,x,S,A){const N=v/2,M=bU(u);let L=0,z=i-l,W=[];for(let H=0;H<u.length-1;H++){const Q=u[H],ne=u[H+1],te=Q.dist(ne),le=ne.angleTo(Q);for(;z+l<L+te;){z+=l;const de=(z-L)/te,pe=jr(Q.x,ne.x,de),Se=jr(Q.y,ne.y,de);if(pe>=0&&pe<A&&Se>=0&&Se<A&&z-N>=0&&z+N<=M){const we=new sf(pe,Se,0,le,H);h&&!xU(u,we,v,h,m)||W.push(we)}}L+=te}return S||W.length||x||(W=TU(u,L/2,l,h,m,v,x,!0,A)),W}function EU(u){let i=0,l=0;for(const x of u)i+=x.w*x.h,l=Math.max(l,x.w);u.sort((x,S)=>S.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let m=0,v=0;for(const x of u)for(let S=h.length-1;S>=0;S--){const A=h[S];if(!(x.w>A.w||x.h>A.h)){if(x.x=A.x,x.y=A.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===A.w&&x.h===A.h){const N=h.pop();N&&S<h.length&&(h[S]=N)}else x.h===A.h?(A.x+=x.w,A.w-=x.w):x.w===A.w?(A.y+=x.h,A.h-=x.h):(h.push({x:A.x+x.w,y:A.y,w:A.w-x.w,h:x.h}),A.y+=x.h,A.h-=x.h);break}}return{w:m,h:v,fill:i/(m*v)||0}}ir(sf,"Anchor");class j1{static getImagePositionScale(i,l,h){if(l&&i){const{sx:m,sy:v}=i;return{x:m,y:v}}return{x:h,y:h}}constructor(i,l,h,m){this.paddedRect=i;const{pixelRatio:v,version:x,stretchX:S,stretchY:A,content:N,sdf:M,usvg:L}=l;this.pixelRatio=v,this.stretchX=S,this.stretchY=A,this.content=N,this.version=x,this.padding=h,this.sdf=M,this.usvg=L,this.scale=j1.getImagePositionScale(m,L,v)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function BR(u,i,l){const h=jo.parse(u),m=function(v,x,S=[1,1]){return{x:0,y:0,w:(v.data?v.data.width:v.width*S[0])+2*x,h:(v.data?v.data.height:v.height*S[1])+2*x}}(i,l,[h.sx,h.sy]);return{bin:m,imagePosition:new j1(m,i,l,h),imageVariant:h}}class jU{constructor(i,l,h){const m=new Map,v=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(i,m,1,x),this.addImages(l,v,2,x);const{w:S,h:A}=EU(x),N=new Aa({width:S||1,height:A||1});for(const[M,L]of i.entries()){const z=m.get(M).paddedRect;Aa.copy(L.data,N,{x:0,y:0},{x:z.x+1,y:z.y+1},L.data,null,L.sdf)}for(const[M,L]of l.entries()){const z=v.get(M),W=z.paddedRect;let H=z.padding;const Q=W.x+H,ne=W.y+H,te=L.data.width,le=L.data.height;H=H>1?H-1:H,Aa.copy(L.data,N,{x:0,y:0},{x:Q,y:ne},L.data,h),Aa.copy(L.data,N,{x:0,y:le-H},{x:Q,y:ne-H},{width:te,height:H},h),Aa.copy(L.data,N,{x:0,y:0},{x:Q,y:ne+le},{width:te,height:H},h),Aa.copy(L.data,N,{x:te-H,y:0},{x:Q-H,y:ne},{width:H,height:le},h),Aa.copy(L.data,N,{x:0,y:0},{x:Q+te,y:ne},{width:H,height:le},h),Aa.copy(L.data,N,{x:te-H,y:le-H},{x:Q-H,y:ne-H},{width:H,height:H},h),Aa.copy(L.data,N,{x:0,y:le-H},{x:Q+te,y:ne-H},{width:H,height:H},h),Aa.copy(L.data,N,{x:0,y:0},{x:Q+te,y:ne+le},{width:H,height:H},h),Aa.copy(L.data,N,{x:te-H,y:0},{x:Q-H,y:ne+le},{width:H,height:H},h)}this.lut=h,this.image=N,this.iconPositions=m,this.patternPositions=v}addImages(i,l,h,m){for(const[v,x]of i.entries()){const{bin:S,imagePosition:A,imageVariant:N}=BR(v,x,h);l.set(v,A),m.push(S),x.hasRenderCallback&&this.haveRenderCallbacks.push(N.id)}}patchUpdatedImages(i,l,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>i.hasImage(m,h)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const m of i.getUpdatedImages(h)){for(const v of this.iconPositions.keys()){const x=jo.parse(v);if(To.isEqual(x.id,m)){const S=i.getImage(m,h);this.patchUpdatedImage(this.iconPositions.get(v),S,l,null)}}for(const v of this.patternPositions.keys()){const x=jo.parse(v);if(To.isEqual(x.id,m)){const S=i.getImage(m,h);this.patchUpdatedImage(this.patternPositions.get(v),S,l,this.lut)}}}}patchUpdatedImage(i,l,h,m=null){if(!i||!l||i.version===l.version)return;i.version=l.version;const[v,x]=i.tl,S=i.sdf;if(this.lut||S){const A={width:l.data.width,height:l.data.height},N=new Aa(A);Aa.copy(l.data,N,{x:0,y:0},{x:0,y:0},A,m,S),h.update(N,{position:{x:v,y:x}})}else h.update(l.data,{position:{x:v,y:x}})}}ir(j1,"ImagePosition"),ir(jU,"ImageAtlas");const A1=1e20;function AU(u,i,l,h,m,v,x,S,A){for(let N=i;N<i+h;N++)CU(u,l*v+N,v,m,x,S,A);for(let N=l;N<l+m;N++)CU(u,N*v+i,1,h,x,S,A)}function CU(u,i,l,h,m,v,x){v[0]=0,x[0]=-A1,x[1]=A1,m[0]=u[i];for(let S=1,A=0,N=0;S<h;S++){m[S]=u[i+S*l];const M=S*S;do{const L=v[A];N=(m[S]-m[L]+M-L*L)/(S-L)/2}while(N<=x[A]&&--A>-1);A++,v[A]=S,x[A]=N,x[A+1]=A1}for(let S=0,A=0;S<h;S++){for(;x[A+1]<S;)A++;const N=v[A],M=S-N;u[i+S*l]=m[N]+M*M}}const $R={none:0,ideographs:1,all:2};class B_{constructor(i,l,h){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const h=[],m=this.url||As.GLYPHS_URL;for(const v in i)for(const x of i[v])h.push({stack:v,id:x});Xe(h,({stack:v,id:x},S)=>{let A=this.entries[v];A||(A=this.entries[v]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=A.glyphs[x];if(N!==void 0)return void S(null,{stack:v,id:x,glyph:N});if(N=this._tinySDF(A,v,x),N)return A.glyphs[x]=N,void S(null,{stack:v,id:x,glyph:N});const M=Math.floor(x/256);if(256*M>65535)return Nr("glyphs > 65535 not supported"),void S(null,{stack:v,id:x,glyph:N});if(A.ranges[M])return void S(null,{stack:v,id:x,glyph:N});let L=A.requests[M];L||(L=A.requests[M]=[],B_.loadGlyphRange(v,M,m,this.requestManager,(z,W)=>{if(W){A.ascender=W.ascender,A.descender=W.descender;for(const H in W.glyphs)this._doesCharSupportLocalGlyph(+H)||(A.glyphs[+H]=W.glyphs[+H]);A.ranges[M]=!0}for(const H of L)H(z,W);delete A.requests[M]})),L.push((z,W)=>{z?S(z):W&&S(null,{stack:v,id:x,glyph:W.glyphs[x]||null})})},(v,x)=>{if(v)l(v);else if(x){const S={};for(const{stack:A,id:N,glyph:M}of x)S[A]===void 0&&(S[A]={}),S[A].glyphs===void 0&&(S[A].glyphs={}),S[A].glyphs[N]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},S[A].ascender=this.entries[A].ascender,S[A].descender=this.entries[A].descender;l(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==$R.none&&(this.localGlyphMode===$R.all?!!this.localFontFamily:!!this.localFontFamily&&(p_(i)||oj(i)||mp(i)||Ig(i)||pp(i)||gp(i)||(l=i)>=131072&&l<=173791||(h=>h>=66736&&h<=66815)(i)));var l}_tinySDF(i,l,h){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(h))return;let v=i.tinySDF;if(!v){let Q="400";/bold/i.test(l)?Q="900":/medium/i.test(l)?Q="500":/light/i.test(l)&&(Q="200"),v=i.tinySDF=new B_.TinySDF({fontFamily:m,fontWeight:Q,fontSize:48,buffer:6,radius:16}),v.fontWeight=Q}if(this.localGlyphs[v.fontWeight][h])return this.localGlyphs[v.fontWeight][h];const x=String.fromCodePoint(h),{data:S,width:A,height:N,glyphWidth:M,glyphHeight:L,glyphLeft:z,glyphTop:W,glyphAdvance:H}=v.draw(x);return this.localGlyphs[v.fontWeight][h]={id:h,bitmap:new Cp({width:A,height:N},S),metrics:{width:M/2,height:L/2,left:z/2,top:W/2-27,advance:H/2,localGlyph:!0}}}}function PU(u,i){return u+i[1]-i[0]}function VR(u,i,l,h,m=1){const v=[],x=u.imagePrimary,S=x.pixelRatio,A=x.paddedRect.w-2,N=x.paddedRect.h-2,M=(u.right-u.left)*m,L=(u.bottom-u.top)*m,z=x.stretchX||[[0,A]],W=x.stretchY||[[0,N]],H=z.reduce(PU,0),Q=W.reduce(PU,0),ne=A-H,te=N-Q;let le=0,de=H,pe=0,Se=Q,we=0,Ie=ne,Oe=0,Ne=te;if(x.content&&h){const qe=x.content;le=vA(z,0,qe[0]),pe=vA(W,0,qe[1]),de=vA(z,qe[0],qe[2]),Se=vA(W,qe[1],qe[3]),we=qe[0]-le,Oe=qe[1]-pe,Ie=qe[2]-qe[0]-de,Ne=qe[3]-qe[1]-Se}const Fe=(qe,ht,at,ut)=>{const bt=_A(qe.stretch-le,de,M,u.left*m),_t=xA(qe.fixed-we,Ie,qe.stretch,H),xt=_A(ht.stretch-pe,Se,L,u.top*m),rt=xA(ht.fixed-Oe,Ne,ht.stretch,Q),Tt=_A(at.stretch-le,de,M,u.left*m),mt=xA(at.fixed-we,Ie,at.stretch,H),jt=_A(ut.stretch-pe,Se,L,u.top*m),wt=xA(ut.fixed-Oe,Ne,ut.stretch,Q),Qt=new kt(bt,xt),er=new kt(Tt,xt),qt=new kt(Tt,jt),Ht=new kt(bt,jt),xr=new kt(_t/S,rt/S),cr=new kt(mt/S,wt/S),Yt=i*Math.PI/180;if(Yt){const yn=Math.sin(Yt),Xi=Math.cos(Yt),wn=[Xi,-yn,yn,Xi];Qt._matMult(wn),er._matMult(wn),Ht._matMult(wn),qt._matMult(wn)}const kr=qe.stretch+qe.fixed,nn=at.stretch+at.fixed,En=ht.stretch+ht.fixed,en=ut.stretch+ut.fixed,Hn=u.imageSecondary;return{tl:Qt,tr:er,bl:Ht,br:qt,texPrimary:{x:x.paddedRect.x+1+kr,y:x.paddedRect.y+1+En,w:nn-kr,h:en-En},texSecondary:Hn?{x:Hn.paddedRect.x+1+kr,y:Hn.paddedRect.y+1+En,w:nn-kr,h:en-En}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xr,pixelOffsetBR:cr,minFontScaleX:Ie/S/M,minFontScaleY:Ne/S/L,isSDF:l}};if(x.stretchX||x.stretchY){const qe=NU(z,ne,H),ht=NU(W,te,Q);for(let at=0;at<qe.length-1;at++){const ut=qe[at],bt=qe[at+1];for(let _t=0;_t<ht.length-1;_t++)v.push(Fe(ut,ht[_t],bt,ht[_t+1]))}}else v.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:N+1}));return v}function Ife(u,i){const l=u.stretchY||[[0,u.paddedRect.h-2]];return u.stretchX||u.stretchY?IU(u.stretchX||[[0,u.paddedRect.w-2]])*IU(l):1}function vA(u,i,l){let h=0;for(const m of u)h+=Math.max(i,Math.min(l,m[1]))-Math.max(i,Math.min(l,m[0]));return h}function NU(u,i,l){const h=[{fixed:-1,stretch:0}];for(const[m,v]of u){const x=h[h.length-1];h.push({fixed:m-x.stretch,stretch:x.stretch}),h.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return h.push({fixed:i+1,stretch:l}),h}function IU(u){return 2*u.length+1}function _A(u,i,l,h){return u/i*l+h}function xA(u,i,l,h){return u-i*l/h}function kfe(u,i,l,h){const m=i+u.positionedLines[h].lineOffset;return h===0?l+m/2:l+(m+(i+u.positionedLines[h-1].lineOffset))/2}function kU(u,i,l,h,m,v,x,S,A){const N=[];if(i.positionedLines.length===0)return N;const M=(A!==void 0?A:h.layout.get("text-rotate").evaluate(v,{}))*Math.PI/180,L=function(ne){const te=ne[0],le=ne[1],de=te*le;return de>0?[te,-le]:de<0?[-te,le]:te===0?[le,te]:[le,-te]}(l);let z=Math.abs(i.top-i.bottom);for(const ne of i.positionedLines)z-=ne.lineOffset;const W=i.positionedLines.length,H=z/W;let Q=i.top-l[1];for(let ne=0;ne<W;++ne){const te=i.positionedLines[ne];Q=kfe(i,H,Q,ne);for(const le of te.positionedGlyphs){if(!le.rect)continue;const de=le.rect||{};let pe=4,Se=!0,we=1,Ie=0;if(le.image){const er=x.get(le.image.toString());if(!er)continue;if(er.sdf){Nr("SDF images are not supported in formatted text and will be ignored.");continue}Se=!1,we=er.pixelRatio,pe=1/we}const Oe=(m||S)&&le.vertical,Ne=le.metrics.advance*le.scale/2,Fe=le.metrics,qe=le.rect;if(qe===null)continue;S&&i.verticalizable&&(Ie=le.image?Ne-le.metrics.width*le.scale/2:0);const ht=m?[le.x+Ne,le.y]:[0,0];let at=[0,0],ut=[0,0],bt=!1;m||(Oe?(ut=[le.x+Ne+L[0],le.y+L[1]-Ie],bt=!0):at=[le.x+Ne+l[0],le.y+l[1]-Ie]);const _t=qe.w*le.scale/(we*(le.localGlyph?2:1)),xt=qe.h*le.scale/(we*(le.localGlyph?2:1));let rt,Tt,mt,jt;if(Oe){const er=le.y-Q,qt=new kt(-Ne,Ne-er),Ht=-Math.PI/2,xr=new kt(...ut);rt=new kt(-Ne+at[0],at[1]),rt._rotateAround(Ht,qt)._add(xr),rt.x+=-er+Ne,rt.y-=(Fe.left-pe)*le.scale;const cr=le.image?Fe.advance*le.scale:Xs*le.scale,Yt=String.fromCodePoint(le.glyph);ffe(Yt)?rt.x+=(1-pe)*le.scale:pfe(Yt)?rt.x+=cr-Fe.height*le.scale+(-pe-1)*le.scale:rt.x+=le.image||Fe.width+2*pe===qe.w&&Fe.height+2*pe===qe.h?(cr-xt)/2:(cr-(Fe.height+2*pe)*le.scale)/2,Tt=new kt(rt.x,rt.y-_t),mt=new kt(rt.x+xt,rt.y),jt=new kt(rt.x+xt,rt.y-_t)}else{const er=(Fe.left-pe)*le.scale-Ne+at[0],qt=(-Fe.top-pe)*le.scale+at[1],Ht=er+_t,xr=qt+xt;rt=new kt(er,qt),Tt=new kt(Ht,qt),mt=new kt(er,xr),jt=new kt(Ht,xr)}if(M){let er;er=m?new kt(0,0):bt?new kt(L[0],L[1]):new kt(l[0],l[1]),rt._rotateAround(M,er),Tt._rotateAround(M,er),mt._rotateAround(M,er),jt._rotateAround(M,er)}const wt=new kt(0,0),Qt=new kt(0,0);N.push({tl:rt,tr:Tt,bl:mt,br:jt,texPrimary:de,texSecondary:void 0,writingMode:i.writingMode,glyphOffset:ht,sectionIndex:le.sectionIndex,isSDF:Se,pixelOffsetTL:wt,pixelOffsetBR:Qt,minFontScaleX:0,minFontScaleY:0})}}return N}function Ofe(u,i=1,l=!1){let h=1/0,m=1/0,v=-1/0,x=-1/0;const S=u[0];for(let W=0;W<S.length;W++){const H=S[W];(!W||H.x<h)&&(h=H.x),(!W||H.y<m)&&(m=H.y),(!W||H.x>v)&&(v=H.x),(!W||H.y>x)&&(x=H.y)}const A=Math.min(v-h,x-m);let N=A/2;const M=new _g([],Rfe);if(A===0)return new kt(h,m);for(let W=h;W<v;W+=A)for(let H=m;H<x;H+=A)M.push(new $_(W+N,H+N,N,u));let L=function(W){let H=0,Q=0,ne=0;const te=W[0];for(let le=0,de=te.length,pe=de-1;le<de;pe=le++){const Se=te[le],we=te[pe],Ie=Se.x*we.y-we.x*Se.y;Q+=(Se.x+we.x)*Ie,ne+=(Se.y+we.y)*Ie,H+=3*Ie}return new $_(Q/H,ne/H,0,W)}(u),z=M.length;for(;M.length;){const W=M.pop();(W.d>L.d||!L.d)&&(L=W,l&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,z)),W.max-L.d<=i||(N=W.h/2,M.push(new $_(W.p.x-N,W.p.y-N,N,u)),M.push(new $_(W.p.x+N,W.p.y-N,N,u)),M.push(new $_(W.p.x-N,W.p.y+N,N,u)),M.push(new $_(W.p.x+N,W.p.y+N,N,u)),z+=4)}return l&&(console.log(`num probes: ${z}`),console.log(`best distance: ${L.d}`)),L.p}function Rfe(u,i){return i.max-u.max}B_.loadGlyphRange=function(u,i,l,h,m){const v=256*i,x=v+255,S=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",`${v}-${x}`),So.Glyphs);cg(S,(A,N)=>{if(A)m(A);else if(N){const M={},L=function(z){return new mA(z).readFields(Tfe,{})}(N);for(const z of L.glyphs)M[z.id]=z;m(null,{glyphs:M,ascender:L.ascender,descender:L.descender})}})},B_.TinySDF=class{constructor({fontSize:u=24,buffer:i=3,radius:l=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=i,this.cutoff=h,this.radius=l,this.lang=S;const A=this.size=u+4*i,N=this._createCanvas(A),M=this.ctx=N.getContext("2d",{willReadFrequently:!0});M.font=`${x} ${v} ${u}px ${m}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(u){const i=document.createElement("canvas");return i.width=i.height=u,i}draw(u){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(u),x=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),A=Math.min(this.size-this.buffer,x+Math.ceil(h)),N=S+2*this.buffer,M=A+2*this.buffer,L=Math.max(N*M,0),z=new Uint8ClampedArray(L),W={data:z,width:N,height:M,glyphWidth:S,glyphHeight:A,glyphTop:x,glyphLeft:0,glyphAdvance:i};if(S===0||A===0)return W;const{ctx:H,buffer:Q,gridInner:ne,gridOuter:te}=this;this.lang&&(H.lang=this.lang),H.clearRect(Q,Q,S,A),H.fillText(u,Q,Q+x);const le=H.getImageData(Q,Q,S,A);te.fill(A1,0,L),ne.fill(0,0,L);for(let de=0;de<A;de++)for(let pe=0;pe<S;pe++){const Se=le.data[4*(de*S+pe)+3]/255;if(Se===0)continue;const we=(de+Q)*N+pe+Q;if(Se===1)te[we]=0,ne[we]=A1;else{const Ie=.5-Se;te[we]=Ie>0?Ie*Ie:0,ne[we]=Ie<0?Ie*Ie:0}}AU(te,0,0,N,M,N,this.f,this.v,this.z),AU(ne,Q,Q,S,A,N,this.f,this.v,this.z);for(let de=0;de<L;de++){const pe=Math.sqrt(te[de])-Math.sqrt(ne[de]);z[de]=Math.round(255-255*(pe/this.radius+this.cutoff))}return W}};class $_{constructor(i,l,h,m){this.p=new kt(i,l),this.h=h,this.d=function(v,x){let S=!1,A=1/0;for(let N=0;N<x.length;N++){const M=x[N];for(let L=0,z=M.length,W=z-1;L<z;W=L++){const H=M[L],Q=M[W];H.y>v.y!=Q.y>v.y&&v.x<(Q.x-H.x)*(v.y-H.y)/(Q.y-H.y)+H.x&&(S=!S),A=Math.min(A,Ep(v,H,Q))}}return(S?1:-1)*Math.sqrt(A)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const Mfe=Object.keys,UR=Number.POSITIVE_INFINITY,Dfe=Math.sqrt(2);function kp(u,i,l,h,m){const v=LR(u)&&u.collisionPadding?u.collisionPadding:[0,0,0,0],x={top:u.top-v[1],bottom:u.bottom+v[3],left:u.left-v[0],right:u.right+v[2],scaled:!1};return h!==void 0&&function(S,A){S.top*=A,S.bottom*=A,S.left*=A,S.right*=A,S.scaled=!0}(x,h),l&&function(S,A){if(!A)return;const N=_n(A),M=new kt(S.left,S.top),L=new kt(S.right,S.top),z=new kt(S.left,S.bottom),W=new kt(S.right,S.bottom),H=new kt(0,0);M._rotateAround(N,H),L._rotateAround(N,H),z._rotateAround(N,H),W._rotateAround(N,H),S.left=Math.min(M.x,L.x,z.x,W.x),S.right=Math.max(M.x,L.x,z.x,W.x),S.top=Math.min(M.y,L.y,z.y,W.y),S.bottom=Math.max(M.y,L.y,z.y,W.y)}(x,l),m&&(x.left+=m[0],x.right+=m[0],x.top+=m[1],x.bottom+=m[1]),i?{top:Math.min(i.top,x.top),bottom:Math.max(i.bottom,x.bottom),left:Math.min(i.left,x.left),right:Math.max(i.right,x.right),scaled:i.scaled||x.scaled}:x}function OU(u,[i,l]){let h=0,m=0;if(l===UR){i<0&&(i=0);const v=i/Dfe;switch(u){case"top-right":case"top-left":m=v-7;break;case"bottom-right":case"bottom-left":m=7-v;break;case"bottom":m=7-i;break;case"top":m=i-7}switch(u){case"top-right":case"bottom-right":h=-v;break;case"top-left":case"bottom-left":h=v;break;case"left":h=i;break;case"right":h=-i}}else{switch(i=Math.abs(i),l=Math.abs(l),u){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(u){case"top-right":case"bottom-right":case"right":h=-i;break;case"top-left":case"bottom-left":case"left":h=i}}return[h,m]}function Lfe(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H){const Q=u.layers[0],ne=Q.appearances;if(ne.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const te={iconBBox:null,iconVerticalBBox:null},le={textBBox:null,textVerticalBBox:null},{baseIconRotate:de,baseTextRotate:pe,iconScaleFactor:Se}=function(Ie,Oe,Ne){const Fe=Ie.get("icon-rotate").evaluate(Oe,{},Ne),qe=Ie.get("text-rotate").evaluate(Oe,{},Ne),[ht,at]=Ie.get("icon-size-scale-range");return{baseIconRotate:Fe,baseTextRotate:qe,iconScaleFactor:Pe(1,ht,at)}}(h,m,v);i&&(te.iconBBox=kp(i,te.iconBBox,de,x),l)&&(te.iconVerticalBBox=kp(l,te.iconVerticalBBox,de+90,x));const we=wA(L.horizontal);we&&(le.textBBox=kp(we,le.textBBox,pe,1,W)),L.vertical&&(le.textVerticalBBox=kp(L.vertical,le.textVerticalBBox,pe+90,1,W));for(const Ie of ne)Ie.hasIconProperties()&&Ffe(te,u,Q,Ie,m,v,S,de,x,A,i,N,Se,M,H),Ie.hasTextProperties()&&zfe(le,Q,Ie,m,v,W,pe,z,we,L.vertical);return{iconBBox:te.iconBBox,iconVerticalBBox:te.iconVerticalBBox,textBBox:le.textBBox,textVerticalBBox:le.textVerticalBBox}}function Ffe(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H){const{appearanceIconOffset:Q,appearanceIconRotate:ne,appearanceIconSize:te}=RU(h,l,m,v,x,S,A,N.iconScaleFactor);let le=null,de=null,pe=null;h.hasProperty("icon-image")?pe=function(Se,we,Ie,Oe,Ne,Fe,qe,ht){let at=null;const ut=we.getAppearanceValueAndResolveTokens(Ie,"icon-image",Oe,Ne,ht);if(ut){const bt=Se.getResolvedImageFromTokens(ut),_t=Ie.getUnevaluatedProperty("icon-size"),xt=C1(bt,Qg(Se.zoom,_t,Se.worldview,ht),_t,Ne,Se.zoom,Oe,Se.pixelRatio,qe,Se.worldview,ht);at=Fe.get(xt.iconPrimary.toString())}return at}(i,l,h,m,v,L,z,H):M&&(pe=M.imagePrimary),pe&&(le=yA(pe,null,Q,W),i.allowVerticalPlacement&&(de=yA(pe,null,Q,W))),le&&(u.iconBBox=kp(le,u.iconBBox,ne,te)),de&&(u.iconVerticalBBox=kp(de,u.iconVerticalBBox,ne+90,te))}function RU(u,i,l,h,m,v,x,S){const A=u.hasProperty("icon-offset")?i.getAppearanceValueAndResolveTokens(u,"icon-offset",l,h,[]):null,N=A&&Array.isArray(A)?A:m,M=u.hasProperty("icon-rotate")?i.getAppearanceValueAndResolveTokens(u,"icon-rotate",l,h,[]):null,L=typeof M=="number"?M:v,z=u.hasProperty("icon-size")?i.getAppearanceValueAndResolveTokens(u,"icon-size",l,h,[]):null;return{appearanceIconOffset:N,appearanceIconRotate:L,appearanceIconSize:typeof z=="number"?z*S:x}}function zfe(u,i,l,h,m,v,x,S,A,N){const{appearanceTextOffset:M,appearanceTextRotate:L,appearanceTextSize:z}=MU(l,i,h,m,v,x,S),W=z/S;A&&(u.textBBox=kp(A,u.textBBox,L,W,M)),N&&(u.textVerticalBBox=kp(N,u.textVerticalBBox,L+90,W,M))}function MU(u,i,l,h,m,v,x){const S=u.hasProperty("text-offset")?i.getAppearanceValueAndResolveTokens(u,"text-offset",l,h,[]):null,A=S&&Array.isArray(S)?[S[0]*Xs,S[1]*Xs]:m,N=u.hasProperty("text-rotate")?i.getAppearanceValueAndResolveTokens(u,"text-rotate",l,h,[]):null,M=typeof N=="number"?N:v,L=u.hasProperty("text-size")?i.getAppearanceValueAndResolveTokens(u,"text-size",l,h,[]):null;return{appearanceTextOffset:A,appearanceTextRotate:M,appearanceTextSize:typeof L=="number"?L:x}}function bA(u,i,l,h,m,v,x,S,A){if(!i||!i.usvg)return;const N=_U(h),M=_U(m),L=v!=="both"&&v!=="width"||!yU(h)?1:M.width/N.width,z=v!=="both"&&v!=="height"||!vU(h)?1:M.height/N.height;l.scaleSelf(L,z);const W=l.toString();x.set(W,l),S.set(W,i);const{imagePosition:H}=BR(W,i,1);A.set(W,H)}function DU(u,i,l,h,m,v,x,S,A,N){if(!u)return;const M=function(L,z,W,H,Q,ne,te){if(L.kind==="camera")return L.maxSize;if(L.kind==="composite"){const le=z.possiblyEvaluate(new Wn(L.maxZoom,{worldview:ne}),W,te).evaluate(Q,{},W,te),de=z.possiblyEvaluate(new Wn(L.minZoom,{worldview:ne}),W,te).evaluate(Q,{},W,te);return Math.max(le,de)}return z.possiblyEvaluate(new Wn(H,{worldview:ne}),W,te).evaluate(Q,{},W,te)}(i,l,h,m,v,A,N);return u.scaleSelf(M*S*x)}function C1(u,i,l,h,m,v,x,S,A,N){return{iconPrimary:DU(u.getPrimary(),i,l,h,m,v,x,S,A,N),iconSecondary:DU(u.getSecondary(),i,l,h,m,v,x,S,A,N)}}function Bfe(u,i,l){if(!i)return;const h=l.get(u.toString()),m=l.get(i.toString());h&&m&&(h.paddedRect.w===m.paddedRect.w&&h.paddedRect.h===m.paddedRect.h||Nr(`Mismatch in icon variant sizes: ${u.toString()} and ${i.toString()}`),h.usvg!==m.usvg&&Nr(`Mismatch in icon variant image types: ${u.id} and ${i.id}`))}function LU(u,i,l,h){if(!u)return;const m=i.get(l.toString());if(u.imagePrimary=m,h){const v=i.get(h.toString());u.imageSecondary=v}}function $fe(u,i){for(const l in u.horizontal)FU(u.horizontal[l],i);FU(u.vertical,i)}function FU(u,i){if(u){for(const l of u.positionedLines)for(const h of l.positionedGlyphs)if(h.image!==null){const m=h.image.toString();h.rect=i.get(m).paddedRect}}}function qR(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vfe(u,i,l,h,m,v,x,S,A){const N=wA(v.horizontal)||v.vertical,M=l.get("icon-text-fit-padding").evaluate(h,{},m);let L,z=i;return i&&A!=="none"&&(u.allowVerticalPlacement&&v.vertical&&(L=FR(i,v.vertical,A,M,S,x)),N&&(z=FR(i,N,A,M,S,x))),{defaultShapedIcon:z,verticallyShapedIcon:L}}function zU(u,i){return u*i/24}function Ufe(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le,de,pe,Se,we,Ie){let Oe=x.textMaxSize.evaluate(i,{},z);Oe===void 0?Oe=S*x.textScaleFactor:Oe*=x.textScaleFactor;const Ne=u.layers[0].layout,Fe=zU(S,x.textScaleFactor),qe=wA(l.horizontal)||l.vertical,ht=u.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((ne!=="none"||ht)&&u.appearanceFeatureData&&u.featureToAppearanceIndex[i.index]<u.appearanceFeatureData.length){const qt=u.appearanceFeatureData[u.featureToAppearanceIndex[i.index]];qt&&(qt.textShaping=qe,qt.iconTextFitPadding=Ne.get("icon-text-fit-padding").evaluate(i,{},z),qt.fontScale=Fe,qt.textScaleFactor=x.textScaleFactor)}const at=W.name==="globe",ut=u.tilePixelRatio*Oe/24,bt=(jt=u.overscaling,u.zoom>18&&jt>2&&(jt>>=1),Math.max(Wt/(512*jt),1)*Ne.get("symbol-spacing")),_t=Ne.get("text-padding")*u.tilePixelRatio,xt=Ne.get("icon-padding")*u.tilePixelRatio,rt=_n(Ne.get("text-max-angle")),Tt=Ne.get("icon-rotation-alignment")==="map"&&de!=="point",mt=bt/2;var jt;u.hasAnyIconTextFit===!1&&ne!=="none"&&(u.hasAnyIconTextFit=!0);const wt=i.properties?+i.properties[hn]:null,Qt=wt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(wt):65535,er=(qt,Ht,xr)=>{if(Ht.x<0||Ht.x>=Wt||Ht.y<0||Ht.y>=Wt)return;let cr=null;if(at){const{x:Yt,y:kr,z:nn}=W.projectTilePoint(Ht.x,Ht.y,xr);cr={anchor:new sf(Yt,kr,nn,0,void 0),up:W.upVector(xr,Ht.x,Ht.y)}}(function(Yt,kr,nn,En,en,Hn,yn,Xi,wn,Vn,yi,Ai,Ci,Ki,oa,Ca,_s,Is,Us,Zr,Pi,Li,Cl,po,la,mo,Jd,qa,zA,Z_,ko,BA){const Qd=Yt.addToLineVertexArray(kr,En);let af,Mp,xc,ou,q1,X_,tn,Ks=0,Yi=0,ks=0,bc=0,Jo=-1,Pl=-1;const Ys={};let G1=Qf("");const eh=nn?nn.anchor:kr,xs=qa!=="none";let ca=0,Os=0;if(wn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ua=wn.layout.get("text-offset").evaluate(Pi,{},la);ca=ua[0]*Xs,Os=ua[1]*Xs}else ca=wn.layout.get("text-radial-offset").evaluate(Pi,{},la)*Xs,Os=UR;if(Yt.allowVerticalPlacement&&en.vertical){const ua=en.vertical;if(oa)X_=HR(ua),Xi&&(tn=HR(Xi));else{const Qo=wn.layout.get("text-rotate").evaluate(Pi,{},la)+90;xc=SA(Vn,eh,kr,yi,Ai,Ci,ua,Ki,Qo,Ca,BA),Xi&&(ou=SA(Vn,eh,kr,yi,Ai,Ci,Xi,Is,Qo,null,ko))}}if(Hn){const ua=wn.layout.get("icon-rotate").evaluate(Pi,{},la),Qo=VR(Hn,ua,Cl,xs,Li.iconScaleFactor),lu=Xi?VR(Xi,ua,Cl,xs,Li.iconScaleFactor):void 0;Mp=SA(Vn,eh,kr,yi,Ai,Ci,Hn,Is,ua,null,Z_);const th=function(Hu,tme,nq,rme,iq,sq,nme,kit,gM){const aq=Hu.layers[0],oq=aq.appearances;let Y_=tme.length;if(nq&&(Y_=Math.max(Y_,nq.length)),oq.length===0)return Y_;const[ime,sme]=rme.get("icon-size-scale-range"),ame=Pe(1,ime,sme);for(const lq of oq){const cq=lq.getUnevaluatedProperties();if(cq._values["icon-image"].value!==void 0){const uq=aq.getAppearanceValueAndResolveTokens(lq,"icon-image",iq,sq,gM);if(uq){const dq=Hu.getResolvedImageFromTokens(uq);if(dq){const hq=cq._values["icon-size"],ome=C1(dq,Qg(Hu.zoom,hq,Hu.worldview,gM),hq,sq,Hu.zoom,iq,Hu.pixelRatio,ame,Hu.worldview,gM),lme=nme.get(ome.iconPrimary.toString());Y_=Math.max(Y_,Ife(lme))}}}}return Y_}(Yt,Qo,lu,wn.layout,Pi,la,Yt.iconAtlasPositions,0,po);Ks=4*th;const pM=wn.layout.get("icon-size").evaluate(Pi,{},la,po),mM=Li.compositeIconSizes?Li.compositeIconSizes[0].evaluate(Pi,{},la,po):0,W1=Li.compositeIconSizes?Li.compositeIconSizes[1].evaluate(Pi,{},la,po):0,K_=WR(Yt.layerIds[0],Yt.iconSizeData,pM,Li.iconScaleFactor,mM,W1);Yt.addSymbols(Yt.icon,Qo,K_,Zr,Us,Pi,void 0,nn,kr,Qd.lineStartIndex,Qd.lineLength,-1,po,la,mo,Jd,Yt.symbolInstances.length,th),Jo=Yt.icon.placedSymbolArray.length-1,lu&&(Yi=4*th,Yt.addSymbols(Yt.icon,lu,K_,Zr,Us,Pi,Al.vertical,nn,kr,Qd.lineStartIndex,Qd.lineLength,-1,po,la,mo,Jd,Yt.symbolInstances.length,th),Pl=Yt.icon.placedSymbolArray.length-1)}for(const ua in en.horizontal){const Qo=ua,lu=en.horizontal[Qo];af||(G1=Qf(lu.text),oa?q1=HR(lu):af=SA(Vn,eh,kr,yi,Ai,Ci,lu,Ki,wn.layout.get("text-rotate").evaluate(Pi,{},la),Ca,BA));const th=lu.positionedLines.length===1;if(ks+=BU(Yt,nn,kr,lu,yn,wn,oa,Pi,Ca,Qd,en.vertical?Al.horizontal:Al.horizontalOnly,th?Mfe(en.horizontal):[Qo],Ys,Jo,Li,po,la,Yt.symbolInstances.length,mo),th)break}en.vertical&&(bc+=BU(Yt,nn,kr,en.vertical,yn,wn,oa,Pi,Ca,Qd,Al.vertical,["vertical"],Ys,Pl,Li,po,la,Yt.symbolInstances.length,mo));let Ga=-1;const Wa=(ua,Qo)=>ua?Math.max(ua,Qo):Qo;Ga=Wa(q1,Ga),Ga=Wa(X_,Ga),Ga=Wa(tn,Ga);const Dp=Ga>-1?1:0;Yt.glyphOffsetArray.length>=65535&&Nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,Pi.sortKey),Yt.symbolInstances.emplaceBack(kr.x,kr.y,eh.x,eh.y,eh.z,Ys.right>=0?Ys.right:-1,Ys.center>=0?Ys.center:-1,Ys.left>=0?Ys.left:-1,Ys.vertical>=0?Ys.vertical:-1,Jo,Pl,G1,af!==void 0?af:Yt.collisionBoxArray.length,af!==void 0?af+1:Yt.collisionBoxArray.length,xc!==void 0?xc:Yt.collisionBoxArray.length,xc!==void 0?xc+1:Yt.collisionBoxArray.length,Mp!==void 0?Mp:Yt.collisionBoxArray.length,Mp!==void 0?Mp+1:Yt.collisionBoxArray.length,ou||Yt.collisionBoxArray.length,ou?ou+1:Yt.collisionBoxArray.length,yi,ks,bc,Ks,Yi,Dp,0,ca,Os,Ga,0,xs?1:0,zA)})(u,Ht,cr,qt,l,h,v,m,u.layers[0],u.collisionBoxArray,i.index,i.sourceLayerIndex,u.index,_t,le,N,0,xt,Tt,te,i,x,M,L,z,H,Q,ne,Qt,pe,Se,we)};if(de==="line")for(const qt of iA(i.geometry,0,0,Wt,Wt)){const Ht=Nfe(qt,bt,rt,l.vertical||qe,h,24,ut,u.overscaling,Wt);for(const xr of Ht)qe&&qfe(u,qe.text,mt,xr)||er(qt,xr,z)}else if(de==="line-center"){for(const qt of i.geometry)if(qt.length>1){const Ht=Pfe(qt,rt,l.vertical||qe,h,24,ut);Ht&&er(qt,Ht,z)}}else if(i.type==="Polygon")for(const qt of c1(i.geometry,0)){const Ht=Ofe(qt,16);er(qt[0],new sf(Ht.x,Ht.y,0,0,void 0),z)}else if(i.type==="LineString")for(const qt of i.geometry)er(qt,new sf(qt[0].x,qt[0].y,0,0,void 0),z);else if(i.type==="Point")for(const qt of i.geometry)for(const Ht of qt)er([Ht],new sf(Ht.x,Ht.y,0,0,void 0),z)}const GR=255,ey=GR*nf;function BU(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le){const de=kU(0,h,A,v,x,S,m,u.allowVerticalPlacement,void 0),pe=v.layout.get("text-size").evaluate(S,{},ne),Se=H.compositeTextSizes?H.compositeTextSizes[0].evaluate(S,{},ne):0,we=H.compositeTextSizes?H.compositeTextSizes[1].evaluate(S,{},ne):0,Ie=WR(u.layerIds[0],u.textSizeData,pe,H.textScaleFactor,Se,we);u.addSymbols(u.text,de,Ie,A,x,S,M,i,l,N.lineStartIndex,N.lineLength,W,Q,ne,le,!1,te,de.length);for(const Oe of L)z[Oe]=u.text.placedSymbolArray.length-1;return 4*de.length}function WR(u,i,l,h,m,v){const x=i;let S=null;return x.kind==="source"?(S=[nf*l*h],S[0]>ey&&Nr(`${u}: Value for "text-size" is >= ${GR}. Reduce your "text-size".`)):x.kind==="composite"&&(S=[nf*m*h,nf*v*h],(S[0]>ey||S[1]>ey)&&Nr(`${u}: Value for "text-size" is >= ${GR}. Reduce your "text-size".`)),S}function wA(u){for(const i in u)return u[i];return null}function SA(u,i,l,h,m,v,x,S,A,N,M){let L,z,W,H;if(L=M?M.top:x.top,z=M?M.bottom:x.bottom,W=M?M.left:x.left,H=M?M.right:x.right,LR(x)&&x.collisionPadding){const Q=x.collisionPadding;W-=Q[0],L-=Q[1],H+=Q[2],z+=Q[3]}if(A){const Q=new kt(W,L),ne=new kt(H,L),te=new kt(W,z),le=new kt(H,z),de=_n(A);let pe=new kt(0,0);N&&(pe=new kt(N[0],N[1])),Q._rotateAround(de,pe),ne._rotateAround(de,pe),te._rotateAround(de,pe),le._rotateAround(de,pe),W=Math.min(Q.x,ne.x,te.x,le.x),H=Math.max(Q.x,ne.x,te.x,le.x),L=Math.min(Q.y,ne.y,te.y,le.y),z=Math.max(Q.y,ne.y,te.y,le.y)}return u.emplaceBack(i.x,i.y,i.z,l.x,l.y,W,L,H,z,S,h,m,v),u.length-1}function HR(u){LR(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const i=u.bottom-u.top;return i>0?Math.max(10,i):null}function qfe(u,i,l,h){const m=u.compareText;if(i in m){const v=m[i];for(let x=v.length-1;x>=0;x--)if(h.dist(v[x])<l)return!0}else m[i]=[];return m[i].push(h),!1}function $U(u,i){const l=u.fovAboveCenter,h=u.elevation?u.elevation.getMinElevationBelowMSL()*i:0,m=(u._camera.position[2]*u.worldSize-h)/Math.cos(u._pitch),v=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-u._pitch-l,.01));let x=Math.sin(u._pitch)*v+m;const S=m*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let A=Math.max(u.zoom-17,0);u.isOrthographic&&(A/=10),x*=1+A}return Math.min(1.01*x,S)}function P1(u,i){if(!i.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:i};const l=Math.pow(2,-u.z),h=u.x*l,m=(u.x+1)*l,v=u.y*l,x=(u.y+1)*l,S=vt(h),A=vt(m),N=At(v),M=At(x),L=i.project(S,N),z=i.project(A,N),W=i.project(A,M),H=i.project(S,M);let Q=Math.min(L.x,z.x,W.x,H.x),ne=Math.min(L.y,z.y,W.y,H.y),te=Math.max(L.x,z.x,W.x,H.x),le=Math.max(L.y,z.y,W.y,H.y);const de=l/16;function pe(we,Ie,Oe,Ne,Fe,qe){const ht=(Oe+Fe)/2,at=(Ne+qe)/2,ut=i.project(vt(ht),At(at)),bt=Math.max(0,Q-ut.x,ne-ut.y,ut.x-te,ut.y-le);Q=Math.min(Q,ut.x),te=Math.max(te,ut.x),ne=Math.min(ne,ut.y),le=Math.max(le,ut.y),bt>de&&(pe(we,ut,Oe,Ne,ht,at),pe(ut,Ie,ht,at,Fe,qe))}pe(L,z,h,v,m,v),pe(z,W,m,v,m,x),pe(W,H,m,x,h,x),pe(H,L,h,x,h,v),Q-=de,ne-=de,te+=de,le+=de;const Se=1/Math.max(te-Q,le-ne);return{scale:Se,x:Q*Se,y:ne*Se,x2:te*Se,y2:le*Se,projection:i}}function VU(u,{x:i,y:l},h=0){return new kt(((i-h)*u.scale-u.x)*Wt,(l*u.scale-u.y)*Wt)}const Gfe=D(new Float32Array(16));class Op{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,l){return{x:0,y:0,z:0}}unproject(i,l){return new Te(0,0)}projectTilePoint(i,l,h){return{x:i,y:l,z:0}}locationPoint(i,l,h,m=!0){return i._coordinatePoint(i.locationCoordinate(l,h),m)}pixelsPerMeter(i,l){return tt(1,i)*l}pixelSpaceConversion(i,l,h){return 1}farthestPixelDistance(i){return $U(i,i.pixelsPerMeter)}pointCoordinate(i,l,h,m){const v=i.horizonLineFromTop(!1),x=new kt(l,Math.max(v,h));return i.rayIntersectionCoordinate(i.pointRayIntersection(x,m))}pointCoordinate3D(i,l,h){const m=new kt(l,h);if(i.elevation)return i.elevation.pointCoordinate(m);{const v=this.pointCoordinate(i,m.x,m.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(i,l){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,l.x,l.y);const h=i.horizonLineFromTop();return l.y<h}createInversionMatrix(i,l){return Gfe}createTileMatrix(i,l,h){let m,v,x;const S=h.canonical,A=D(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=P1(S,this);m=1,v=N.x+h.wrap*N.scale,x=N.y,K(A,A,[m/N.scale,m/N.scale,i.pixelsPerMeter/l])}else m=l/i.zoomScale(S.z),v=(S.x+Math.pow(2,S.z)*h.wrap)*m,x=S.y*m;return $(A,A,[v,x,0]),K(A,A,[m/Wt,m/Wt,1]),A}upVector(i,l,h){return[0,0,1]}upVectorScale(i,l,h){return{metersToTile:1}}}class Wfe extends Op{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[l,h]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(_n(l));this.n=(m+Math.sin(_n(h)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,l){const{n:h,c:m,r0:v}=this,x=_n(i-this.center[0]),S=_n(l),A=Math.sqrt(m-2*h*Math.sin(S))/h;return{x:A*Math.sin(x*h),y:A*Math.cos(x*h)-v,z:0}}unproject(i,l){const{n:h,c:m,r0:v}=this,x=v+l;let S=Math.atan2(i,Math.abs(x))*Math.sign(x);x*h<0&&(S-=Math.PI*Math.sign(i)*Math.sign(x));const A=_n(this.center[0])*h;S=nt(S,-Math.PI-A,Math.PI-A);const N=Pe(Ke(S/h)+this.center[0],-180,180),M=Math.asin(Pe((m-(i*i+x*x)*h*h)/(2*h),-1,1)),L=Pe(Ke(M),-85.051129,Ue);return new Te(N,L)}}const N1=1.340264,I1=-.081106,k1=893e-6,O1=.003796,TA=Math.sqrt(3)/2;class Hfe extends Op{project(i,l){l=l/180*Math.PI,i=i/180*Math.PI;const h=Math.asin(TA*Math.sin(l)),m=h*h,v=m*m*m;return{x:.5*(i*Math.cos(h)/(TA*(N1+3*I1*m+v*(7*k1+9*O1*m)))/Math.PI+.5),y:1-.5*(h*(N1+I1*m+v*(k1+O1*m))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,m=h*h,v=m*m*m;for(let M,L,z,W=0;W<12&&(L=h*(N1+I1*m+v*(k1+O1*m))-l,z=N1+3*I1*m+v*(7*k1+9*O1*m),M=L/z,h=Pe(h-M,-Math.PI/3,Math.PI/3),m=h*h,v=m*m*m,!(Math.abs(M)<1e-12));++W);const x=TA*i*(N1+3*I1*m+v*(7*k1+9*O1*m))/Math.cos(h),S=Math.asin(Math.sin(h)/TA),A=Pe(180*x/Math.PI,-180,180),N=Pe(180*S/Math.PI,-85.051129,Ue);return new Te(A,N)}}class Zfe extends Op{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){return{x:.5+i/360,y:.5-l/360,z:0}}unproject(i,l){const h=360*(i-.5),m=Pe(360*(.5-l),-85.051129,Ue);return new Te(h,m)}}const V_=Math.PI/2;function EA(u){return Math.tan((V_+u)/2)}class Xfe extends Op{constructor(i){super(i),this.center=i.center||[0,30];const[l,h]=this.parallels=i.parallels||[30,30];let m=_n(l),v=_n(h);this.southernCenter=m+v<0,this.southernCenter&&(m=-m,v=-v);const x=Math.cos(m),S=EA(m);this.n=m===v?Math.sin(m):Math.log(x/Math.cos(v))/Math.log(EA(v)/S),this.f=x*Math.pow(EA(m),this.n)/this.n}project(i,l){l=_n(l),this.southernCenter&&(l=-l),i=_n(i-this.center[0]);const h=1e-6,{n:m,f:v}=this;v>0?l<-V_+h&&(l=-V_+h):l>V_-h&&(l=V_-h);const x=v/Math.pow(EA(l),m);let S=x*Math.sin(m*i),A=v-x*Math.cos(m*i);return S=.5*(S/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:S,y:this.southernCenter?A:1-A,z:0}}unproject(i,l){i=(2*i-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:m}=this,v=m-l,x=Math.sign(v),S=Math.sign(h)*Math.sqrt(i*i+v*v);let A=Math.atan2(i,Math.abs(v))*x;v*h<0&&(A-=Math.PI*Math.sign(i)*x);const N=Pe(Ke(A/h)+this.center[0],-180,180),M=Pe(Ke(2*Math.atan(Math.pow(m/S,1/h))-V_),-85.051129,Ue);return new Te(N,this.southernCenter?-M:M)}}class UU extends Op{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,l){return{x:Ye(i),y:it(l),z:0}}unproject(i,l){const h=vt(i),m=At(l);return new Te(h,m)}}const qU=_n(Ue);class Kfe extends Op{project(i,l){const h=(l=_n(l))*l,m=h*h;return{x:.5*((i=_n(i))*(.8707-.131979*h+m*(m*(.003971*h-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+m*(.028874*h-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,m=25,v=0,x=h*h;do{x=h*h;const N=x*x;v=(h*(1.007226+x*(.015085+N*(.028874*x-.044475-.005916*N)))-l)/(1.007226+x*(.045255+N*(.259866*x-.311325-.005916*11*N))),h=Pe(h-v,-qU,qU)}while(Math.abs(v)>1e-6&&--m>0);x=h*h;const S=Pe(Ke(i/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),A=Ke(h);return new Te(S,A)}}const GU=_n(Ue);class Yfe extends Op{project(i,l){l=_n(l),i=_n(i);const h=Math.cos(l),m=2/Math.PI,v=Math.acos(h*Math.cos(i/2)),x=Math.sin(v)/v,S=.5*(i*m+2*h*Math.sin(i/2)/x)||0,A=.5*(l+Math.sin(l)/x)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(i,l){let h=i=(2*i-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,v=25;const x=1e-6;let S=0,A=0;do{const N=Math.cos(m),M=Math.sin(m),L=2*M*N,z=M*M,W=N*N,H=Math.cos(h/2),Q=Math.sin(h/2),ne=2*H*Q,te=Q*Q,le=1-W*H*H,de=le?1/le:0,pe=le?Math.acos(N*H)*Math.sqrt(1/le):0,Se=.5*(2*pe*N*Q+2*h/Math.PI)-i,we=.5*(pe*M+m)-l,Ie=.5*de*(W*te+pe*N*H*z)+1/Math.PI,Oe=de*(ne*L/4-pe*M*Q),Ne=.125*de*(L*Q-pe*M*W*ne),Fe=.5*de*(z*H+pe*te*N)+.5,qe=Oe*Ne-Fe*Ie;S=(we*Oe-Se*Fe)/qe,A=(Se*Ne-we*Ie)/qe,h=Pe(h-S,-Math.PI,Math.PI),m=Pe(m-A,-GU,GU)}while((Math.abs(S)>x||Math.abs(A)>x)&&--v>0);return new Te(Ke(h),Ke(m))}}class WU extends Op{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){const{scale:h,cosPhi:m}=this;return{x:_n(i)*m*h+.5,y:-Math.sin(_n(l))/m*h+.5,z:0}}unproject(i,l){const{scale:h,cosPhi:m}=this,v=-(l-.5)/h,x=Pe(Ke((i-.5)/h)/m,-180,180),S=Math.asin(Pe(v*m,-1,1)),A=Pe(Ke(S),-85.051129,Ue);return new Te(x,A)}}class Jfe extends UU{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,l,h){const m=n1(i,l,h);return pr(m,m,Wj(Xd(h))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,l,h){const m=ke(l.lat,l.lng),v=Ot([],m),x=h?i._centerAltitude+h:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(l),i._centerAltitude):i._centerAltitude;Bt(m,m,v,tt(1,0)*Wt*x);const S=D(new Float64Array(16));return V(S,i.pixelMatrix,i.globeMatrix),pr(m,m,S),new kt(m[0],m[1])}pixelsPerMeter(i,l){return tt(1,0)*l}pixelSpaceConversion(i,l,h){const m=tt(1,i)*l,v=jr(tt(1,45)*l,m,h);return this.pixelsPerMeter(i,l)/v}createTileMatrix(i,l,h){const m=qO(Xd(h.canonical));return V(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,l){const{center:h}=i,m=Wj(Xd(l));return ee(m,m,_n(h.lng)),Y(m,m,_n(h.lat)),K(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,l,h,m){return aV(i,l,h,!0)||new Zt(0,0)}pointCoordinate3D(i,l,h){const m=this.pointCoordinate(i,l,h,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,l){return!aV(i,l.x,l.y,!1)}farthestPixelDistance(i){const l=function(m,v){const x=m.cameraToCenterDistance,S=m._centerAltitude*v,A=m._camera,N=m._camera.forward(),M=Ve([],Je([],N,-x),[0,0,S]),L=m.worldSize/(2*Math.PI),z=[0,0,-L],W=m.width/m.height,H=Math.tan(m.fovAboveCenter),Q=Je([],A.up(),H),ne=Je([],A.right(),H*W),te=Ot([],Ve([],Ve([],N,Q),ne)),le=[];let de;if(new si(M,te).closestPointOnSphere(z,L,le)){const pe=Ve([],le,z),Se=zn([],pe,M);de=Math.cos(m.fovAboveCenter)*ze(Se)}else{const pe=zn([],M,z),Se=zn([],z,M);Ot(Se,Se);const we=ze(pe)-L;de=Math.sqrt(we*(we+2*L));const Ie=Math.acos(de/(L+we))-Math.acos(nr(N,Se));de*=Math.cos(Ie)}return 1.01*de}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),h=Ap(i.zoom);if(h>0){const m=$U(i,tt(1,i.center.lat)*i.worldSize),v=i.worldSize/(2*Math.PI),x=Math.max(i.width,i.height)/i.worldSize*Math.PI;return jr(l,m+v*(1-Math.cos(x)),Math.pow(h,10))}return l}upVector(i,l,h){return n1(l,h,i,1)}upVectorScale(i){return{metersToTile:Uj(Gj(Xd(i)))}}}function HU(u){const i=u.parallels,l=!!i&&Math.abs(i[0]+i[1])<.01;switch(u.name){case"mercator":return new UU(u);case"equirectangular":return new Zfe(u);case"naturalEarth":return new Kfe(u);case"equalEarth":return new Hfe(u);case"winkelTripel":return new Yfe(u);case"albers":return l?new WU(u):new Wfe(u);case"lambertConformalConic":return l?new WU(u):new Xfe(u);case"globe":return new Jfe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Qfe=un.types,epe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function R1(u,i,l,h,m,v,x,S,A,N,M,L,z){const W=S?Math.min(ey,Math.round(S[0])):0,H=S?Math.min(ey,Math.round(S[1])):0;u.emplaceBack(i,l,Math.round(32*h),Math.round(32*m),v,x,(W<<1)+(A?1:0),0+(H<<1),16*N,16*M,256*L,256*z)}function M1(u,i,l){u.emplaceBack(i,l)}function D1(u,i,l,h,m,v,x){u.emplaceBack(i,l,h,m,v,x)}const jA=(u,i,l,h)=>{for(let m=0;m<i;m++)u.emplaceBack(l[0],l[1],l[2],h[0],h[1],h[2])};function U_(u,i,l,h,m){u.emplaceBack(i,l,h,m),u.emplaceBack(i,l,h,m),u.emplaceBack(i,l,h,m),u.emplaceBack(i,l,h,m)}function tpe(u){for(const i of u.sections)if(Ud(i.text))return!0;return!1}class ZR{constructor(i){this.layoutVertexArray=new Zw,this.indexArray=new Ps,this.programConfigurations=i,this.segments=new bi,this.dynamicLayoutVertexArray=new Zd,this.opacityVertexArray=new Kw,this.placedSymbolArray=new Cj,this.iconTransitioningVertexArray=new bl,this.globeExtVertexArray=new Xw,this.zOffsetVertexArray=new aa,this.orientationVertexArray=new w_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(i,l){const h=[],m=this.layoutVertexArray.uint16;for(let v=0;v<l;++v){const x=12*(i+v);h.push(...m.slice(x,x+12))}return h}updateSymbolVertexData(i,l,h,m,v,x,S,A,N,M,L,z,W){const H=this.layoutVertexArray.uint16,Q=12*i;H[Q]=l,H[Q+1]=h,H[Q+2]=m,H[Q+3]=v,H[Q+4]=x,H[Q+5]=S,H[Q+6]=A,H[Q+7]=N,H[Q+8]=M,H[Q+9]=L,H[Q+10]=z,H[Q+11]=W}upload(i,l,h,m,v,x){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,nfe.members,!!x),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,sfe.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,epe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,lfe.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,ife.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||v)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,afe.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,ofe.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ir(ZR,"SymbolBuffers");class XR{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new bi,this.collisionVertexArray=new b_,this.collisionVertexArrayExt=new Zd}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,cfe.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,ufe.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ir(XR,"CollisionBuffers");class AA{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=D([]),this.placementViewportMatrix=D([]);const l=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.localizable=i.localizable,this.textSizeData=Qg(this.zoom,l["text-size"],this.worldview,i.availableImages),this.iconSizeData=Qg(this.zoom,l["icon-size"],this.worldview,i.availableImages);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.lut=i.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>Al[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(i){const l=this.layers[0].getAppearances();if(!l||l.length===0)return!1;const h=Array.isArray(i)?i:[i];return l.some(m=>h.some(v=>m.getProperty(v)!=null))}createArrays(){this.text=new ZR(new q(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new ZR(new q(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new $g,this.lineVertexArray=new Ij,this.symbolInstances=new Nj}calculateGlyphDependencies(i,l,h,m,v){for(const x of i){const S=x.codePointAt(0);if(S===void 0)break;if(l[S]=!0,m&&v&&S<=65535){const A=T1[x];A&&(l[A.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(i,l,h,m,v,x,S){if(!i.hasProperty("icon-size"))return S*x;let A=1;const N=i.getUnevaluatedProperties()._values["icon-size"],M=Qg(this.zoom,N,this.worldview,v),L=z_(M,l);if(M.kind!=="constant"&&M.kind!=="camera"||(A=L.uSize),M.kind==="composite"){const{minZoom:z,maxZoom:W}=M,H=N.possiblyEvaluate(new Wn(z,{worldview:this.worldview}),m),Q=N.possiblyEvaluate(new Wn(W,{worldview:this.worldview}),m),ne=H.evaluate(h,{},m,v);A=ne+(Q.evaluate(h,{},m,v)-ne)*L.uSizeT}return M.kind==="source"&&(A=N.possiblyEvaluate(new Wn(this.zoom,{worldview:this.worldview}),m).evaluate(h,{},m,v)),A*x}updateFootprints(i,l){}updateReplacement(i,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!tA(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}getResolvedImageFromTokens(i){return typeof i=="string"?Ao.build(i):i}populate(i,l,h,m){const v=this.layers[0],x=v.layout,S=this.projection.name==="globe",A=x.get("text-font"),N=x.get("text-field"),M=x.get("icon-image"),[L,z]=x.get("icon-size-scale-range"),W=Pe(l.scaleFactor||1,L,z),H=(N.value.kind!=="constant"||N.value.value instanceof Ua&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),Q=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,ne=this.hasAnyAppearanceProperty("icon-image"),te=x.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!H&&!Q&&!ne)return;const le=l.iconDependencies,de=l.glyphDependencies,pe=l.availableImages,Se=new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),we=Ie=>{const Oe=Ie.id.toString();le.has(Oe)?le.get(Oe).push(Ie):le.set(Oe,[Ie])};for(const Ie of i){const{feature:Oe,id:Ne,index:Fe,sourceLayerIndex:qe}=Ie,ht=v._featureFilter.needGeometry,at=Gr(Oe,ht);if(!v._featureFilter.filter(Se,at,h))continue;if(ht||(at.geometry=Cr(Oe,h,m)),S&&Oe.type!==1&&h.z<=5){const jt=at.geometry,wt=.98078528056,Qt=(er,qt)=>nr(n1(er.x,er.y,h,1),n1(qt.x,qt.y,h,1))<wt;for(let er=0;er<jt.length;er++)jt[er]=or(jt[er],Qt)}let ut,bt;if(H){const jt=v.getValueAndResolveTokens("text-field",at,h,pe),wt=Ua.factory(jt);tpe(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||Mw()==="unavailable"||this.hasRTLText&&yc.isParsed())&&(ut=hfe(wt,v,at))}if(Q){const jt=v.getValueAndResolveTokens("icon-image",at,h,pe);bt=this.getResolvedImageFromTokens(jt)}const _t=this.layers[0];let xt=!1;if(!bt&&ne){const jt=_t.getAppearances();for(const wt of jt)if(wt.getProperty("icon-image")){const Qt=_t.getAppearanceValueAndResolveTokens(wt,"icon-image",at,h,pe);if(Qt){bt=this.getResolvedImageFromTokens(Qt),xt=!0;break}}}if(!ut&&!bt)continue;const rt=this.sortFeaturesByKey?te.evaluate(at,{},h):void 0,Tt={id:Ne,text:ut,icon:bt,index:Fe,sourceLayerIndex:qe,geometry:at.geometry,properties:Oe.properties,type:Qfe[Oe.type],sortKey:rt};if(this.features.push(Tt),this.featureToAppearanceIndex[Fe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Ne,properties:Oe.properties,usesAppearanceIconAsPlaceholder:xt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),bt){const jt=_t._unevaluatedLayout._values,{iconPrimary:wt,iconSecondary:Qt}=C1(bt,this.iconSizeData,jt["icon-size"],h,this.zoom,Tt,this.pixelRatio,W,this.worldview,pe);we(wt),Qt&&(this.hasAnySecondaryIcon=!0,we(Qt))}const mt=_t.getAppearances();if(mt.length!==0&&mt.forEach(jt=>{if(!jt.getProperty("icon-image"))return;const wt=this.getCombinedIconPrimary(jt,_t,at,h,pe,Tt,W);wt&&we(wt)}),ut){const jt=A.evaluate(at,{},h).join(","),wt=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Al.vertical)>=0;for(const Qt of ut.sections)if(Qt.image){const er=Qt.image.getPrimary().scaleSelf(this.pixelRatio),qt=er.id.toString(),Ht=le.get(qt)||[];Ht.push(er),le.set(qt,Ht)}else{const er=Iw(ut.toString()),qt=Qt.fontStack||jt,Ht=de[qt]=de[qt]||{};this.calculateGlyphDependencies(Qt.text,Ht,wt,this.allowVerticalPlacement,er)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(Ie){const Oe={},Ne={},Fe=[];let qe=0;function ht(_t){Fe.push(Ie[_t]),qe++}function at(_t,xt,rt){const Tt=Ne[_t];return delete Ne[_t],Ne[xt]=Tt,Fe[Tt].geometry[0].pop(),Fe[Tt].geometry[0]=Fe[Tt].geometry[0].concat(rt[0]),Tt}function ut(_t,xt,rt){const Tt=Oe[xt];return delete Oe[xt],Oe[_t]=Tt,Fe[Tt].geometry[0].shift(),Fe[Tt].geometry[0]=rt[0].concat(Fe[Tt].geometry[0]),Tt}function bt(_t,xt,rt){const Tt=rt?xt[0][xt[0].length-1]:xt[0][0];return`${_t}:${Tt.x}:${Tt.y}`}for(let _t=0;_t<Ie.length;_t++){const xt=Ie[_t],rt=xt.geometry,Tt=xt.text?xt.text.toString():null;if(!Tt){ht(_t);continue}const mt=bt(Tt,rt),jt=bt(Tt,rt,!0);if(mt in Ne&&jt in Oe&&Ne[mt]!==Oe[jt]){const wt=ut(mt,jt,rt),Qt=at(mt,jt,Fe[wt].geometry);delete Oe[mt],delete Ne[jt],Ne[bt(Tt,Fe[Qt].geometry,!0)]=Qt,Fe[wt].geometry=null}else mt in Ne?at(mt,jt,rt):jt in Oe?ut(mt,jt,rt):(ht(_t),Oe[mt]=qe-1,Ne[jt]=qe-1)}return Fe.filter(_t=>_t.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ie of l.elevationFeatures)this.elevationFeatureIdToIndex.set(Ie.id,this.elevationFeatures.length),this.elevationFeatures.push(Ie)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ie,Oe)=>Ie.sortKey-Oe.sortKey)}getCombinedIconPrimary(i,l,h,m,v,x,S){let A,N;const M=i.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const L=l.getAppearanceValueAndResolveTokens(i,"icon-image",h,m,v);A=this.getResolvedImageFromTokens(L)}else{const L=l.getValueAndResolveTokens("icon-image",h,m,v);A=this.getResolvedImageFromTokens(L)}if(A){const L=i.hasProperty("icon-size")?M._values["icon-size"]:l._unevaluatedLayout._values["icon-size"];N=C1(A,Qg(this.zoom,L,this.worldview,v),L,m,this.zoom,x,this.pixelRatio,S,this.worldview,v).iconPrimary}return N}updateSymbolInstanceIconVertices(i,l,h,m,v,x,S,A,N,M,L,z,W,H){if(i.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(l.activeAppearance===h)return{vertexOffsetDelta:i.numIconVertices,hasChanges:!1};if(h){const Q=this.getCombinedIconPrimary(h,N,m,x,S,{sortKey:void 0,text:void 0,icon:null,index:i.featureIndex,sourceLayerIndex:i.featureIndex,geometry:[],properties:l.properties,type:"Point",id:l.id},M);if(!Q)return{vertexOffsetDelta:0,hasChanges:!1};const ne=Q.toString(),te=this.iconAtlasPositions&&this.iconAtlasPositions.get(ne);if(te){const{appearanceIconOffset:le,appearanceIconRotate:de}=RU(h,N,m,x,z,H,W,M);let pe=yA(te,void 0,le,N.layout.get("icon-anchor").evaluate(m,L,x));const Se=te.sdf,we=N.layout.get("icon-text-fit").constantOr("none");we!=="none"&&l.textShaping&&l.iconTextFitPadding&&l.fontScale&&(pe=FR(pe,l.textShaping,we,l.iconTextFitPadding,le,l.fontScale));const Ie=this.calculateEffectiveAppearanceIconSize(h,A.zoom,m,x,S,M,W),Oe=0,Ne=1+(Math.min(ey,Math.round(Ie*nf))<<1),Fe=VR(pe,de,Se,we!=="none",M);l.isUsingAppearanceIconVertexData||(l.isUsingAppearanceIconVertexData=!0,l.layoutBasedIconVertexData=this.icon.getSymbolVertexData(v,i.numIconVertices));let qe=v;for(let at=0;at<Fe.length;++at){const ut=Fe[at],bt=l.layoutBasedIconVertexData[0]||i.tileAnchorX,_t=l.layoutBasedIconVertexData[1]||i.tileAnchorY,xt=16*ut.pixelOffsetTL.x,rt=16*ut.pixelOffsetTL.y,Tt=16*ut.pixelOffsetBR.x,mt=16*ut.pixelOffsetBR.y,jt=16*ut.minFontScaleX,wt=16*ut.minFontScaleY;this.icon.updateSymbolVertexData(qe,bt,_t,Math.round(32*ut.tl.x),Math.round(32*ut.tl.y),ut.texPrimary.x,ut.texPrimary.y,Oe,Ne,xt,rt,jt,wt),this.icon.updateSymbolVertexData(qe+1,bt,_t,Math.round(32*ut.tr.x),Math.round(32*ut.tr.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y,Oe,Ne,Tt,rt,jt,wt),this.icon.updateSymbolVertexData(qe+2,bt,_t,Math.round(32*ut.bl.x),Math.round(32*ut.bl.y),ut.texPrimary.x,ut.texPrimary.y+ut.texPrimary.h,Oe,Ne,xt,mt,jt,wt),this.icon.updateSymbolVertexData(qe+3,bt,_t,Math.round(32*ut.br.x),Math.round(32*ut.br.y),ut.texPrimary.x+ut.texPrimary.w,ut.texPrimary.y+ut.texPrimary.h,Oe,Ne,Tt,mt,jt,wt),qe+=4}const ht=i.numIconVertices-4*Fe.length;for(let at=0;at<ht;++at)this.icon.updateSymbolVertexData(qe+at,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:i.numIconVertices,hasChanges:!0}}}else if(l.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:i.numIconVertices,hasChanges:!0}}else if(l.isUsingAppearanceIconVertexData){const ne=l.layoutBasedIconVertexData.length/12;for(let te=0;te<ne;++te){const le=te*12;this.icon.updateSymbolVertexData(v+te,l.layoutBasedIconVertexData[le+0],l.layoutBasedIconVertexData[le+1],l.layoutBasedIconVertexData[le+2],l.layoutBasedIconVertexData[le+3],l.layoutBasedIconVertexData[le+4],l.layoutBasedIconVertexData[le+5],l.layoutBasedIconVertexData[le+6],l.layoutBasedIconVertexData[le+7],l.layoutBasedIconVertexData[le+8],l.layoutBasedIconVertexData[le+9],l.layoutBasedIconVertexData[le+10],l.layoutBasedIconVertexData[le+11])}return l.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:ne,hasChanges:!0}}return{vertexOffsetDelta:i.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le){const de=i.numHorizontalGlyphVertices>0||i.numVerticalGlyphVertices>0;if(!de)return{vertexOffsetDelta:de?i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices:0,hasChanges:!1};if(l.activeAppearance===h)return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!1};if(h&&l.textShaping){const{appearanceTextOffset:pe,appearanceTextRotate:Se,appearanceTextSize:we}=MU(h,S,m,x,L,W,z);l.fontScale=zU(we,l.textScaleFactor);const Ie=h.getUnevaluatedProperty("text-size");let Oe=this.textSizeData,Ne=ne,Fe=te;h.hasProperty("text-size")&&(Oe=Qg(this.zoom,Ie,this.worldview,le),Ne=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Fe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const qe=l.textShaping.bottom-L[1],ht=l.textShaping.left-L[0],at=l.textShaping.right-L[0];l.textShaping.top=pe[1]+(l.textShaping.top-L[1]),l.textShaping.bottom=pe[1]+qe,l.textShaping.left=pe[0]+ht,l.textShaping.right=pe[0]+at;const ut=kU(0,l.textShaping,pe,S,!1,m,N,this.allowVerticalPlacement,Se),bt=we&&Oe.kind==="composite"?Ie.possiblyEvaluate(new Wn(Ne,{}),x).evaluate(m,M,x):H,_t=we&&Oe.kind==="composite"?Ie.possiblyEvaluate(new Wn(Fe,{}),x).evaluate(m,M,x):Q,xt=WR(h.name,Oe,we,A,bt,_t),rt=Array.isArray(xt)?xt[1]:we,Tt=0,mt=1+(Math.min(ey,Math.round(rt*nf))<<1);l.isUsingAppearanceTextVertexData||(l.isUsingAppearanceTextVertexData=!0,l.layoutBasedTextVertexData=this.text.getSymbolVertexData(v,i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices));for(let jt=0;jt<ut.length&&jt<(i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices)/4;++jt){const wt=ut[jt],Qt=wt.glyphOffset[1],er=i.tileAnchorX,qt=i.tileAnchorY,Ht=v+4*jt;this.text.updateSymbolVertexData(Ht,er,qt,Math.round(32*wt.tl.x),Math.round(32*(Qt+wt.tl.y)),wt.texPrimary.x,wt.texPrimary.y,Tt,mt,wt.pixelOffsetTL.x,wt.pixelOffsetTL.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ht+1,er,qt,Math.round(32*wt.tr.x),Math.round(32*(Qt+wt.tr.y)),wt.texPrimary.x+wt.texPrimary.w,wt.texPrimary.y,Tt,mt,wt.pixelOffsetBR.x,wt.pixelOffsetTL.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ht+2,er,qt,Math.round(32*wt.bl.x),Math.round(32*(Qt+wt.bl.y)),wt.texPrimary.x,wt.texPrimary.y+wt.texPrimary.h,Tt,mt,wt.pixelOffsetTL.x,wt.pixelOffsetBR.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ht+3,er,qt,Math.round(32*wt.br.x),Math.round(32*(Qt+wt.br.y)),wt.texPrimary.x+wt.texPrimary.w,wt.texPrimary.y+wt.texPrimary.h,Tt,mt,wt.pixelOffsetBR.x,wt.pixelOffsetBR.y,wt.minFontScaleX,wt.minFontScaleY)}return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!0}}if(l.isUsingAppearanceTextVertexData){const Se=l.layoutBasedTextVertexData.length/12;for(let we=0;we<Se;++we){const Ie=we*12;this.text.updateSymbolVertexData(v+we,l.layoutBasedTextVertexData[Ie+0],l.layoutBasedTextVertexData[Ie+1],l.layoutBasedTextVertexData[Ie+2],l.layoutBasedTextVertexData[Ie+3],l.layoutBasedTextVertexData[Ie+4],l.layoutBasedTextVertexData[Ie+5],l.layoutBasedTextVertexData[Ie+6],l.layoutBasedTextVertexData[Ie+7],l.layoutBasedTextVertexData[Ie+8],l.layoutBasedTextVertexData[Ie+9],l.layoutBasedTextVertexData[Ie+10],l.layoutBasedTextVertexData[Ie+11])}return l.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:Se,hasChanges:!0}}return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!1}}update(i,l,h,m,v,x,S){this.text.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,l,v,h,m,x,S,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let l=!1;const h=Mt(i),m=1/h;let v=!1,x=!1;for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S),N=Me(1,0,0),M=Me(0,1,0),{numHorizontalGlyphVertices:L,numVerticalGlyphVertices:z,numIconVertices:W,numVerticalIconVertices:H}=A,Q=L>0||z>0,ne=W>0,te=this.elevationFeatures[A.elevationFeatureIndex];if(te){const le=new kt(A.tileAnchorX,A.tileAnchorY),de=.075+te.pointElevation(le);A.zOffset!==de&&(l=!0,A.zOffset=de),de!==0&&(this.hasAnyZOffset=!0);const pe=te.computeSlopeNormal(le,m),Se=na(Or(),Me(0,0,1),pe);Xn(N,N,Se),Xn(M,M,Se),N[2]*=h,M[2]*=h,N[0]===1&&N[1]===0&&N[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(v=v||Q,x=x||ne)}if(Q&&(jA(this.text.orientationVertexArray,L,N,M),jA(this.text.orientationVertexArray,z,N,M)),ne){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:de}=A;le>=0&&jA(this.icon.orientationVertexArray,W,N,M),de>=0&&jA(this.icon.orientationVertexArray,H,N,M)}}v||(this.text.orientationVertexArray=void 0),x||(this.icon.orientationVertexArray=void 0),l&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(v,x,S)=>{h+=x,h>v.length&&v.resize(h);for(let A=-x;A<0;A++)v.emplace(A+h,S)},l=(v,x,S)=>{m+=x,m>v.length&&v.resize(m);for(let A=-x;A<0;A++)v.emplace(A+m,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,m=0;for(let v=0;v<this.symbolInstances.length;v++){const x=this.symbolInstances.get(v),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:N}=x,M=x.zOffset,L=N>0;if((S>0||A>0)&&(i(this.text.zOffsetVertexArray,S,M),i(this.text.zOffsetVertexArray,A,M)),L){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:W}=x;z>=0&&l(this.icon.zOffsetVertexArray,N,M),W>=0&&l(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i,l,h,m,v){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(x=>x.appearances&&x.appearances.length>0)),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(i,l,h,m,v){if(!(i&&l&&h&&this.appearanceFeatureData))return!1;const x=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,S=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!x&&!S)return!1;const A=this.layers[0],N=A.layout;let M=1,L=0,z=!1;if(x){const[te,le]=N.get("icon-size-scale-range");M=Pe(1,te,le)}let W=1,H=0,Q=!1;if(S){const[te,le]=N.get("text-size-scale-range");W=Pe(1,te,le)}const ne=new Map;if(v&&h)for(const te of h){const le=v.getImage(te,A.scope);if(le){const de=new jo(te.toString());ne.set(de.toString(),le)}}for(let te=0;te<this.symbolInstances.length;te++){const le=this.symbolInstances.get(te),de=this.featureToAppearanceIndex[le.featureIndex],pe=de!==void 0?this.appearanceFeatureData[de]:void 0;if(!pe)continue;const Se=pe.id,we=l&&Se!==void 0?l[String(Se)]:void 0,Ie={type:"Point",id:pe.id,properties:pe.properties,geometry:[]},Oe=A.appearances&&A.appearances.find(Ne=>Ne.isActive({globals:m,feature:Ie,canonical:i,featureState:we}));if(S){const Ne=N.get("text-size"),Fe=N.get("text-offset").evaluate(Ie,we,i),qe=Ne.evaluate(Ie,we,i),ht=N.get("text-rotate").evaluate(Ie,we,i),at=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,ut=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,bt=Ne.evaluate(Ie,{zoom:at},i),_t=Ne.evaluate(Ie,{zoom:ut},i),xt=this.updateSymbolInstanceTextVertices(le,pe,Oe,Ie,H,i,A,W,ne,we,Fe,qe,ht,bt,_t,at,ut,h);H+=xt.vertexOffsetDelta,Q=Q||xt.hasChanges}if(x){const Ne=N.get("icon-offset").evaluate(Ie,we,i),Fe=N.get("icon-size").evaluate(Ie,we,i,h),qe=N.get("icon-rotate").evaluate(Ie,we,i),ht=this.updateSymbolInstanceIconVertices(le,pe,Oe,Ie,L,i,h,m,A,M,we,Ne,Fe,qe);L+=ht.vertexOffsetDelta,z=z||ht.hasChanges}pe.activeAppearance=Oe}return z&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),Q&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),z||Q}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=HU(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:m,y:v}of l)this.lineVertexArray.emplaceBack(m,v);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q,ne,te,le){const de=i.indexArray,pe=i.layoutVertexArray,Se=i.globeExtVertexArray,we=i.segments.prepareSegment(4*le,pe,de,this.canOverlap?x.sortKey:void 0),Ie=this.glyphOffsetArray.length,Oe=we.vertexLength,Ne=this.allowVerticalPlacement&&S===Al.vertical?Math.PI/2:0,Fe=x.text&&x.text.sections;for(let at=0;at<l.length;at++){const{tl:ut,tr:bt,bl:_t,br:xt,texPrimary:rt,texSecondary:Tt,pixelOffsetTL:mt,pixelOffsetBR:jt,minFontScaleX:wt,minFontScaleY:Qt,glyphOffset:er,isSDF:qt,sectionIndex:Ht}=l[at],xr=we.vertexLength,cr=er[1];if(R1(pe,N.x,N.y,ut.x,cr+ut.y,rt.x,rt.y,h,qt,mt.x,mt.y,wt,Qt),R1(pe,N.x,N.y,bt.x,cr+bt.y,rt.x+rt.w,rt.y,h,qt,jt.x,mt.y,wt,Qt),R1(pe,N.x,N.y,_t.x,cr+_t.y,rt.x,rt.y+rt.h,h,qt,mt.x,jt.y,wt,Qt),R1(pe,N.x,N.y,xt.x,cr+xt.y,rt.x+rt.w,rt.y+rt.h,h,qt,jt.x,jt.y,wt,Qt),A){const{x:Yt,y:kr,z:nn}=A.anchor,[En,en,Hn]=A.up;D1(Se,Yt,kr,nn,En,en,Hn),D1(Se,Yt,kr,nn,En,en,Hn),D1(Se,Yt,kr,nn,En,en,Hn),D1(Se,Yt,kr,nn,En,en,Hn),U_(i.dynamicLayoutVertexArray,Yt,kr,nn,Ne)}else U_(i.dynamicLayoutVertexArray,N.x,N.y,N.z,Ne);if(ne){const Yt=Tt||rt;M1(i.iconTransitioningVertexArray,Yt.x,Yt.y),M1(i.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y),M1(i.iconTransitioningVertexArray,Yt.x,Yt.y+Yt.h),M1(i.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y+Yt.h)}de.emplaceBack(xr,xr+1,xr+2),de.emplaceBack(xr+1,xr+2,xr+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(er[0]),at!==l.length-1&&Ht===l[at+1].sectionIndex||i.programConfigurations.populatePaintArrays(pe.length,x,x.index,{},W,H,Q,Fe&&Fe[Ht],this.worldview)}const qe=le-l.length;qe!==0&&this._addNullVertices(qe,pe,h,A,Se,i,ne,we,de);const ht=A?A.anchor:N;i.placedSymbolArray.emplaceBack(ht.x,ht.y,ht.z,N.x,N.y,Ie,this.glyphOffsetArray.length-Ie,Oe,M,L,N.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],S,0,0,0,z,0),i.symbolInstanceIndices.push(te)}_addNullVertices(i,l,h,m,v,x,S,A,N){for(let M=0;M<i;M++){for(let z=0;z<4;z++)R1(l,0,0,0,0,0,0,h,!1,0,0,0,0),m&&D1(v,0,0,0,0,0,0),U_(x.dynamicLayoutVertexArray,0,0,0,0),S&&M1(x.iconTransitioningVertexArray,0,0);const L=A.vertexLength;N.emplaceBack(L,L+1,L+2),N.emplaceBack(L+1,L+2,L+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(i,l,h,m,v,x,S){i.emplaceBack(l,h,m,v,x,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,l,h,m,v,x,S){const A=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),N=A.vertexLength,M=S.tileAnchorX,L=S.tileAnchorY;for(let W=0;W<4;W++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,l,i.padding,S.zOffset),this._commitLayoutVertex(h.layoutVertexArray,m,v,x,M,L,new kt(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,v,x,M,L,new kt(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,v,x,M,L,new kt(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,m,v,x,M,L,new kt(i.x1,i.y2)),A.vertexLength+=4;const z=h.indexArray;z.emplaceBack(N,N+1),z.emplaceBack(N+1,N+2),z.emplaceBack(N+2,N+3),z.emplaceBack(N+3,N),A.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,h,m,v,x){for(let S=m;S<v;S++){const A=h.get(S),N=this.getSymbolInstanceTextSize(i,x,l,S);this._addCollisionDebugVertices(A,N,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(i,l,h,m,v,x){for(let S=m;S<v;S++){const A=h.get(S),N=this.getSymbolInstanceIconSize(i,l,x.placedIconSymbolIndex);this._addCollisionDebugVertices(A,N,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,x)}}generateCollisionDebugBuffers(i,l,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new XR(__,lU.members,bl),this.iconCollisionBox=new XR(__,lU.members,bl);const m=z_(this.iconSizeData,i),v=z_(this.textSizeData,i,h);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(v,i,l,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(v,i,l,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(m,i,l,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(m,i,l,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,l,h,m){const v=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),x=zR(this.textSizeData,i,v)/Xs;return this.tilePixelRatio*x}getSymbolInstanceIconSize(i,l,h){const m=this.icon.placedSymbolArray.get(h),v=zR(this.iconSizeData,i,m);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(i,l,h,m){i.emplaceBack(l,-h,-h,m),i.emplaceBack(l,h,-h,m),i.emplaceBack(l,h,h,m),i.emplaceBack(l,-h,h,m)}_updateTextDebugCollisionBoxes(i,l,h,m,v,x,S){for(let A=m;A<v;A++){const N=h.get(A),M=this.getSymbolInstanceTextSize(i,x,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,N.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(i,l,h,m,v,x,S){for(let A=m;A<v;A++){const N=h.get(A),M=this.getSymbolInstanceIconSize(i,l,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,N.padding,x.zOffset)}}updateCollisionDebugBuffers(i,l,h,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const v=z_(this.iconSizeData,i,m),x=z_(this.textSizeData,i,h);for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(x,i,l,A.textBoxStartIndex,A.textBoxEndIndex,A,h),this._updateTextDebugCollisionBoxes(x,i,l,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,h),this._updateIconDebugCollisionBoxes(v,i,l,A.iconBoxStartIndex,A.iconBoxEndIndex,A,m),this._updateIconDebugCollisionBoxes(v,i,l,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,h,m,v,x,S,A,N){const M={};if(l<h){const{x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe,featureIndex:Se}=i.get(l);M.textBox={x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe},M.textFeatureIndex=Se}if(m<v){const{x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe,featureIndex:Se}=i.get(m);M.verticalTextBox={x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe},M.verticalTextFeatureIndex=Se}if(x<S){const{x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe,featureIndex:Se}=i.get(x);M.iconBox={x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe},M.iconFeatureIndex=Se}if(A<N){const{x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe,featureIndex:Se}=i.get(A);M.verticalIconBox={x1:L,y1:z,x2:W,y2:H,padding:Q,projectedAnchorX:ne,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:de,tileAnchorY:pe},M.verticalIconFeatureIndex=Se}return M}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),m=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<m;v+=4)i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),m=[],v=[],x=[];for(let S=0;S<this.symbolInstances.length;++S){x.push(S);const A=this.symbolInstances.get(S);m.push(0|Math.round(l*A.tileAnchorX+h*A.tileAnchorY)),v.push(A.featureIndex)}return x.sort((S,A)=>m[S]-m[A]||v[A]-v[S]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:v,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:N}=h;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&v!==m&&this.addIndicesForPlacedSymbol(this.text,v),x>=0&&x!==v&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(i){const l=this.symbolInstances.get(this.text.symbolInstanceIndices[i]).elevationFeatureIndex;let h;return this.elevationFeatures&&l<this.elevationFeatures.length&&(h=this.elevationFeatures[l]),h}}function ZU(u,i){return i.replace(/{([^{}]+)}/g,(l,h)=>h in u?String(u[h]):"")}let XU,KU,KR;ir(AA,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),AA.addDynamicAttributes=U_;class YU{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Eo,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ir(YU,"FormatSectionOverride",{omit:["defaultValue"]});const YR=()=>KR||(KR={layout:XU||(XU=new Mi({"symbol-placement":new Lt(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Lt(Qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Lt(Qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Lt(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Lt(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(Qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Lt(Qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Kt(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(Qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Lt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Kt(Qe.layout_symbol["icon-rotate"]),"icon-padding":new Lt(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(Qe.layout_symbol["icon-offset"]),"icon-anchor":new Kt(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(Qe.layout_symbol["text-field"]),"text-font":new Kt(Qe.layout_symbol["text-font"]),"text-size":new Kt(Qe.layout_symbol["text-size"]),"text-size-scale-range":new Lt(Qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Kt(Qe.layout_symbol["text-max-width"]),"text-line-height":new Kt(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(Qe.layout_symbol["text-justify"]),"text-radial-offset":new Kt(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Kt(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(Qe.layout_symbol["text-rotate"]),"text-padding":new Lt(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Qe.layout_symbol["text-keep-upright"]),"text-transform":new Kt(Qe.layout_symbol["text-transform"]),"text-offset":new Kt(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Lt(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Qe.layout_symbol["text-optional"]),visibility:new Lt(Qe.layout_symbol.visibility)})),paint:KU||(KU=new Mi({"icon-opacity":new Kt(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Kt(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Kt(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Kt(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new Kt(Qe.paint_symbol["icon-color"]),"icon-halo-color":new Kt(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Lt(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Kt(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Kt(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Kt(Qe.paint_symbol["text-color"],{runtimeType:ao,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Kt(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Lt(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Lt(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Lt(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Lt(Qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Kt(Qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},KR);class CA extends co{constructor(i,l,h,m){super(i,YR(),l,h,m,i.layout?i.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=D([]),this.hasOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}_handleSpecialPaintPropertyUpdate(i){i!=="icon-occlusion-opacity"&&i!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(i,l){super.recalculate(i,l),this.appearances&&this.appearances.forEach(m=>{m.recalculate(i,l,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const v of h)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,l,h,m){return this._saturation===i&&this._contrast===l&&this._brightnessMin===h&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(v,x,S,A){v=ya(v),x=Ui(x);const N=B(),M=v/3,L=1-2*M,z=[L,M,M,0,M,L,M,0,M,M,L,0,0,0,0,1],W=.5-.5*x,H=A-S;return V(N,[H,0,0,0,0,H,0,0,0,0,H,0,S,S,S,1],[x,0,0,0,0,x,0,0,0,0,x,0,W,W,W,1]),V(N,N,z),N}(i,l,h,m),this._saturation=i,this._contrast=l,this._brightnessMin=h,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,l,h,m){const v=this.layout.get(i).evaluate(l,{},h,m),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Cg(x.value)||!v?v:ZU(l.properties,v)}getAppearanceValueAndResolveTokens(i,l,h,m,v){const x=i.getProperty(l);if(!x)return;const S=x.evaluate(h,{},m,v),A=i.getUnevaluatedProperties()._values[l];return A.isDataDriven()||Cg(A.value)||!S||typeof S!="string"?S:ZU(h.properties,S)}createBucket(i){return new AA(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of YR().paint.overridableProperties){if(!CA.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new YU(l),m=new l_(h,l.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new Pg("source",m):new Hh("composite",m,l.value.zoomStops,l.value.interpolationType),this.paint._values[i]=new Xh(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&CA.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),m=YR().paint.properties[l];let v=!1;const x=S=>{for(const A of S)if(m.overrides&&m.overrides.hasOverride(A))return void(v=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Ua)x(h.value.value.sections);else if(h.value.kind==="source"){const S=N=>{v||(N instanceof Lu&&Vs(N.value)===tp?x(N.value.sections):N instanceof dr?x(N.sections):N.eachChild(S))},A=h.value;A._styleExpression&&S(A._styleExpression.expression)}return v}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,l,h){return{config:new U(this,{zoom:l,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let JU,QU,e8,t8;var JR=ln([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function PA(u,i,l,h,m,v,x,S){const A=[u,i,1,l,h,1,m,v,1],N=[x,S,1],M=P([],A),[L,z,W]=Kr(N,N,M);return k(A,A,[L,0,0,0,z,0,0,0,W])}function r8(u,i,l,h,m,v,x,S){const A=function(N,M,L,z,W,H,Q,ne){const te=PA(0,0,1,0,1,1,0,1),le=PA(N,M,L,z,W,H,Q,ne);return k(le,le,P([],te))}(u,i,l,h,m,v,x,S);return[A[2]/A[8]/Wt,A[5]/A[8]/Wt]}function NA(u){return[u[0],Math.min(Math.max(u[1],-85.051129),Ue)]}class n8 extends Du{constructor(i,l,h,m){super(),this.id=i,this.dispatcher=h,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=l,this._dirty=!1}load(i,l){if(this._loaded=l||!1,this.fire(new Mu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=kv(this.map._requestManager.transformRequest(this.url,So.Image),(h,m)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new hg(h)):m&&(this.image=m instanceof HTMLImageElement?gl.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new b1(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Mu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof b1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=i[0][1],h=i[0][1];for(const v of i)v[1]>h&&(h=v[1]),v[1]<l&&(l=v[1]);const m=(h+l)/2;if(m>Ue?this.onNorthPole=!0:m<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const v=i.map(Zt.fromLngLat);this.tileID=function(x){let S=1/0,A=1/0,N=-1/0,M=-1/0;for(const Q of x)S=Math.min(S,Q.x),A=Math.min(A,Q.y),N=Math.max(N,Q.x),M=Math.max(M,Q.y);const L=Math.max(N-S,M-A),z=Math.max(0,Math.floor(-Math.log2(L))),W=Math.pow(2,z);let H=Math.floor((S+N)/2*W);return H>1&&(H-=1),new Hg(z,H,Math.floor((A+M)/2*W))}(v),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Mu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof b1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const te in this.tiles){const le=this.tiles[te];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=P1(new Hg(0,0,0),this.map.transform.projection),h=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const le=te[1].x-te[0].x,de=te[1].y-te[0].y,pe=te[2].x-te[1].x,Se=te[2].y-te[1].y,we=te[3].x-te[2].x,Ie=te[3].y-te[2].y,Oe=te[0].x-te[3].x,Ne=te[0].y-te[3].y,Fe=le*Se-pe*de,qe=pe*Ie-we*Se,ht=we*Ne-Oe*Ie,at=Oe*de-le*Ne;return Fe>0&&qe>0&&ht>0&&at>0||Fe<0&&qe<0&&ht<0&&at<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=P1(this.tileID,this.map.transform.projection),[v,x,S,A]=this.coordinates.map(te=>{const le=m.projection.project(te[0],te[1]);return VU(m,le)._round()});this.perspectiveTransform=r8(v.x,v.y,x.x,x.y,S.x,S.y,A.x,A.y);const N=this._boundsArray=new Vu;N.emplaceBack(v.x,v.y,0,0),N.emplaceBack(x.x,x.y,Wt,0),N.emplaceBack(A.x,A.y,0,Wt),N.emplaceBack(S.x,S.y,Wt,Wt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(N,JR.members),this.boundsSegments=bi.simpleSegment(0,0,4,2);const M=[],L=[NA((z=this.coordinates)[0]),NA(z[1]),NA(z[2]),NA(z[3])];var z;const[W,H,Q,ne]=function(te){let le=te[0][0],de=le,pe=te[0][1],Se=pe;for(let we=1;we<te.length;we++)te[we][0]<le?le=te[we][0]:te[we][0]>de&&(de=te[we][0]),te[we][1]<pe?pe=te[we][1]:te[we][1]>Se&&(Se=te[we][1]);return[le,pe,de-le,Se-pe]}(L);{const te=new Vu,[le,de,pe,Se]=function(xt){let rt=xt[0].x,Tt=rt,mt=xt[0].y,jt=mt;for(let wt=1;wt<xt.length;wt++)xt[wt].x<rt?rt=xt[wt].x:xt[wt].x>Tt&&(Tt=xt[wt].x),xt[wt].y<mt?mt=xt[wt].y:xt[wt].y>jt&&(jt=xt[wt].y);return[rt,mt,Tt-rt,jt-mt]}(h),we=xt=>[(xt.x-le)/pe,(xt.y-de)/Se],[Ie,Oe,Ne,Fe]=h.map(we),qe=function(xt,rt,Tt,mt,jt,wt,Qt,er){const qt=PA(0,0,1,0,1,1,0,1);return k(qt,qt,P([],PA(xt,rt,Tt,mt,jt,wt,Qt,er)))}(Ie[0],Ie[1],Oe[0],Oe[1],Ne[0],Ne[1],Fe[0],Fe[1]);this.elevatedGlobePerspectiveTransform=r8(Ie[0],Ie[1],Oe[0],Oe[1],Ne[0],Ne[1],Fe[0],Fe[1]);const ht=(xt,rt)=>{M.push(xt.lng);const Tt=Math.round((xt.lng-W)/Q*Wt),mt=Math.round((xt.lat-H)/ne*Wt),jt=we(rt),wt=Kr([],[jt[0],jt[1],1],qe),Qt=Math.round(wt[0]/wt[2]*Wt),er=Math.round(wt[1]/wt[2]*Wt);te.emplaceBack(Tt,mt,Qt,er)},at=h[3].x-h[0].x,ut=h[3].y-h[0].y,bt=h[2].x-h[1].x,_t=h[2].y-h[1].y;for(let xt=0;xt<65;xt++){const rt=xt/64,Tt=[h[0].x+rt*at,h[0].y+rt*ut],mt=[h[1].x+rt*bt,h[1].y+rt*_t],jt=mt[0]-Tt[0],wt=mt[1]-Tt[1];for(let Qt=0;Qt<65;Qt++){const er=Qt/64,qt={x:Tt[0]+jt*er,y:Tt[1]+wt*er};ht(l.projection.unproject(qt.x,qt.y),qt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(te,JR.members)}{this.maxLongitudeTriangleSize=0;let te=[],le=new Ps;const de=(pe,Se,we)=>{le.emplaceBack(pe,Se,we);const Ie=M[pe],Oe=M[Se],Ne=M[we],Fe=Math.min(Math.min(Ie,Oe),Ne),qe=Math.max(Math.max(Ie,Oe),Ne)-Fe;qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=qe),te.push(Fe+qe/2)};for(let pe=0;pe<64;pe++)for(let Se=0;Se<64;Se++){const we=65*pe+Se,Ie=we+1,Oe=we+65,Ne=Oe+1;de(we,Oe,Ie),de(Ie,Oe,Ne)}[te,le]=function(pe,Se){const we=Array.from({length:pe.length},(Ne,Fe)=>Fe);we.sort((Ne,Fe)=>pe[Ne]-pe[Fe]);const Ie=[],Oe=new Ps;for(let Ne=0;Ne<we.length;Ne++){const Fe=we[Ne];Ie.push(pe[Fe]);const qe=3*Fe,ht=qe+1;Oe.emplaceBack(Se.uint16[qe],Se.uint16[ht],Se.uint16[ht+1])}return[Ie,Oe]}(te,le),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(le)}this.elevatedGlobeSegments=bi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Q/Wt,0,ne/Wt,0,0,H,W,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const l=this.map.painter.context,h=l.gl;!this._dirty||this.texture instanceof b1||(this.texture?this.texture.update(this.image):(this.texture=new wR(l,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(l)}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let m=(v=i+180)+360*Math.round((h[0]-v)/360);var v;const x=new bi,S=(L,z)=>{x.segments.push({vertexOffset:0,primitiveOffset:L,vertexLength:l.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-m)<=A){const L=ei(h,0,h.length,m+A);return L===h.length||S(L,Qn(h,L+1,h.length,m+360-A)-L),x}m<h[0]&&(m+=360);const N=Qn(h,0,h.length,m-A);if(N===h.length)return S(0,h.length),x;S(0,N-0);const M=ei(h,N+1,h.length,m+A);return M!==h.length&&S(M,h.length-M),x}}const rpe=(Math.pow(256,2)-1)/16907520;class i8 extends co{constructor(i,l,h,m){super(i,{layout:e8||(e8=new Mi({visibility:new Lt(Qe.layout_raster.visibility)})),paint:t8||(t8=new Mi({"raster-opacity":new Lt(Qe.paint_raster["raster-opacity"]),"raster-color":new vp(Qe.paint_raster["raster-color"]),"raster-color-mix":new Lt(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new Lt(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Lt(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Lt(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Lt(Qe.paint_raster["raster-array-band"]),"raster-elevation":new Lt(Qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof n8&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[h,m]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(m)||h===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=i1({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,m])}}let s8,a8,o8,l8,c8;class u8 extends co{constructor(i,l,h,m){super(i,{layout:s8||(s8=new Mi({visibility:new Lt(Qe["layout_raster-particle"].visibility)})),paint:a8||(a8=new Mi({"raster-particle-array-band":new Lt(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Lt(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new vp(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Lt(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Lt(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Lt(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Lt(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Lt(Qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._updateColorRamp(),this.lastInvalidatedAt=gl.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=i1({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=gl.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class npe extends co{constructor(i,l){super(i,{},l,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function QR(u,i,l){const h=[0,0,1],m=Mn([]);return $s(m,m,l?-_n(u)+Math.PI:_n(u)),oi(m,m,-_n(i)),Xn(h,h,m),Ot(h,h)}const d8={None:0,Model:1,Symbol:2,FillExtrusion:4};class IA{constructor(i,l,h,m){this.message=(i?`${i}: `:"")+h,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}function eM(u,i){const l=u.indexOf("://")===-1;try{return new URL(u,l&&i?"http://example.com":void 0),!0}catch{return!1}}class h8{constructor(i,l){this.feature=i,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class f8{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Qw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(i){const l=16*i,h=this.instancedDataArray.float32;let m=Math.floor(h[l+2]);const v=1.05*(h[l+2]-m);return m/=100,[h[l]%1*1.05,h[l+1]%1*1.05,v,m]}tileCoordinatesForInstance(i){const l=16*i,h=this.instancedDataArray.float32;let m=h[l+0];return m=m>Wt?m-Wt:m,new kt(Math.trunc(m),Math.trunc(h[l+1]))}translationForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+4],h[l+5],h[l+6]]}rotationScaleForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+7],h[l+8],h[l+9],h[l+10],h[l+11],h[l+12],h[l+13],h[l+14],h[l+15]]}transformForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+7],h[l+8],h[l+9],h[l+4],h[l+10],h[l+11],h[l+12],h[l+5],h[l+13],h[l+14],h[l+15],h[l+6],0,0,0,1]}}class tM{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaledZ=this.canonical.z+Math.log2(i.overscaling),this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,m){}populate(i,l,h,m){this.tileToMeter=Mt(h);const v=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:S,index:A,sourceLayerIndex:N}of i){const M=S??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),L=Gr(x,v);if(!this.layers[0]._featureFilter.filter(new Wn(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),L,h))continue;const z={id:M,sourceLayerIndex:N,index:A,geometry:v?L.geometry:Cr(x,h,m),properties:x.properties,type:x.type,patterns:{}},W=this.addFeature(z,z.geometry,L);W&&l.featureIndex.insert(x,z.geometry,A,N,this.index,this.instancesPerModel[W].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const i=this.layers[0].modelManager,l=this.layers[0].scope;let h=0;for(const m of this.modelUris){const v=i.getModel(m,l);if(!v)continue;const x=this.instancesPerModel[m];if(x){const S=.5*Pt(v.aabb.max,v.aabb.min)*x.maxScale+x.maxXYTranslationDistance,A=Math.min(Wt,Math.max(S/this.tileToMeter,256));h=Math.max(A,h)}}return h}update(i,l,h,m){for(const v in this.instancesPerModel){const x=this.instancesPerModel[v];for(const S in i)x.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(x.features[x.idToFeaturesIndex[S]],i[S],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const m of h.features){const v=this.layers[0],x=m.feature,S=this.canonical,A=v.paint.get("model-rotation").evaluate(x,{},S),N=v.paint.get("model-scale").evaluate(x,{},S),M=v.paint.get("model-translation").evaluate(x,{},S);ni(m.rotation,A)&&ni(m.scale,N)&&ni(m.translation,M)||(this.evaluate(m,m.featureStates,h,!0),i=!0)}}return i}updateReplacement(i,l,h,m){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const v=l.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(tA(this.activeReplacements,v))return!1;this.activeReplacements=v;let x=!1;for(const S in this.instancesPerModel){const A=this.instancesPerModel[S],N=A.instancedDataArray;for(const M of A.features){const L=M.instancedDataOffset,z=M.instancedDataCount;for(let W=0;W<z;W++){const H=16*(W+L);let Q=N.float32[H+0];const ne=Q>Wt;Q=ne?Q-Wt:Q;const te=Math.floor(Q),le=Math.floor(N.float32[H+1]);let de=!1;for(const pe of this.activeReplacements)if(!WV(pe,h,d8.Model,m)&&!(pe.min.x>te||te>pe.max.x||pe.min.y>le||le>pe.max.y)&&(de=YV(KV(te,le,i.canonical,pe.footprintTileId.canonical),pe.footprint),de))break;N.float32[H]=de?Q+Wt:Q,x=x||de!==ne}}}return x}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=i.createVertexBuffer(h.instancedDataArray,Ehe.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(i){for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];m.instancedDataArray.length!==0&&m.instancedDataBuffer&&m.instancedDataBuffer.destroy()}const l=this.layers[0].modelManager;if(i&&l&&this.modelUris&&this.modelsRequested)for(const h of this.modelUris)l.removeModel(h,"",!0)}addFeature(i,l,h){const m=this.layers[0],v=m.layout.get("model-id"),x=m.layout.get("model-allow-density-reduction"),S=v.evaluate(h,{},this.canonical);if(!S)return Nr(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),S;(eM(S,!1)||this.styleDefinedModelURLs[S]!==void 0)&&(this.modelUris.includes(S)||this.modelUris.push(S)),this.instancesPerModel[S]||(this.instancesPerModel[S]=new f8);const A=this.instancesPerModel[S],N=A.instancedDataArray,M=new h8(h,N.length);for(const L of l)for(const z of L){if(z.x<0||z.x>=Wt||z.y<0||z.y>=Wt)continue;if(this.lookupDim!==0&&x){const H=(this.lookupDim-1)/Wt,Q=this.lookupDim*(z.y*H|0)+z.x*H|0;if(this.lookup){if(this.lookup[Q]!==0)continue;this.lookup[Q]=1}}this.instanceCount++;const W=N.length;N.resize(W+1),A.instancesEvaluatedElevation.push(0),N.float32[16*W]=z.x,N.float32[16*W+1]=z.y}return M.instancedDataCount=A.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(i.id&&(A.idToFeaturesIndex[i.id]=A.features.length),A.features.push(M),this.evaluate(M,{},A,!1)),S}getModelUris(){return this.modelUris}evaluate(i,l,h,m){const v=this.layers[0],x=i.feature,S=this.canonical,A=i.rotation=v.paint.get("model-rotation").evaluate(x,l,S),N=i.scale=v.paint.get("model-scale").evaluate(x,l,S),M=i.translation=v.paint.get("model-translation").evaluate(x,l,S),L=Object.assign({},v.paint.get("model-color").evaluate(x,l,S));L.a=v.paint.get("model-color-mix-intensity").evaluate(x,l,S);const z=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const W=M[0]*M[0]+M[1]*M[1],H=W>0?Math.sqrt(W):0;h.maxScale=Math.max(Math.max(h.maxScale,N[0]),Math.max(N[1],N[2])),h.maxXYTranslationDistance=Math.max(h.maxXYTranslationDistance,H),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),$6(z,A,N);const Q=Math.round(100*L.a)+L.b/1.05;for(let ne=0;ne<i.instancedDataCount;++ne){const te=i.instancedDataOffset+ne,le=16*te,de=h.instancedDataArray.float32;let pe=0;m&&(pe=de[le+6]-h.instancesEvaluatedElevation[te]);const Se=0|de[le+1];de[le]=(0|de[le])+L.r/1.05,de[le+1]=Se+L.g/1.05,de[le+2]=Q,de[le+3]=1/(S.z>10?this.tileToMeter:Mt(S,Se)),de[le+4]=M[0],de[le+5]=M[1],de[le+6]=M[2]+pe,de[le+7]=z[0],de[le+8]=z[1],de[le+9]=z[2],de[le+10]=z[4],de[le+11]=z[5],de[le+12]=z[6],de[le+13]=z[8],de[le+14]=z[9],de[le+15]=z[10],h.instancesEvaluatedElevation[te]=M[2]}}}let p8,m8;ir(tM,"ModelBucket",{omit:["layers"]}),ir(f8,"PerModelAttributes"),ir(h8,"ModelFeature");class q_{constructor(i,l,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(i,l,h){const m=h||i.findDEMTileFor(l);if(!m||!m.dem)return;const v=m.dem,x=m.tileID,S=1<<l.canonical.z-x.canonical.z;return new q_(m,v.dim/Wt/S,[(l.canonical.x/S-x.canonical.x)*v.dim,(l.canonical.y/S-x.canonical.y)*v.dim])}tileCoordToPixel(i,l){const h=l*this._scale+this._offset[1];return new kt(Math.floor(i*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(i,l,h,m){const v=i*this._scale+this._offset[0],x=l*this._scale+this._offset[1],S=Math.floor(v),A=Math.floor(x),N=this._dem;return m=!!m,h?jr(jr(N.get(S,A,m),N.get(S,A+1,m),x-A),jr(N.get(S+1,A,m),N.get(S+1,A+1,m),x-A),v-S):N.get(S,A,m)}getElevationAtPixel(i,l,h){return this._dem.get(i,l,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*tt(1,i)*this._dem.stride}}const rM=new Float32Array(262144),ty=new Uint8Array(262144);function g8(u){let i=0;if(u.meshes)for(const l of u.meshes)i=Math.max(i,l.aabb.max[2]);if(u.children)for(const l of u.children)i=Math.max(i,g8(l));return i}function y8(u,i,l){if(u.meshes)for(const h of u.meshes){if(h.aabb.min[0]===1/0)continue;const m=Pn.applyTransform(h.aabb,u.globalMatrix);l.insert(i,m.min[0],m.min[1],m.max[0],m.max[1])}if(u.children)for(const h of u.children)y8(h,i,l)}const v8=["","wall","door","roof","window","lamp","logo"];class _8{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:g8(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const l=new Pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==i&&(h.transformedAabb=Pn.applyTransformFast(h.aabb,this.node.globalMatrix),l.encapsulate(h.transformedAabb)),i++;this.aabb=l}return this.aabb}}class kA{constructor(i,l,h,m,v,x,S,A){this.id=h,this.layers=i,this.layerIds=this.layers.map(N=>N.fqid),this.stateDependentLayerIds=this.layers.filter(N=>N.isStateDependent()).map(N=>N.id),this.modelTraits|=D_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=D_.HasMapboxMeshFeatures),v&&(this.modelTraits|=D_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const N of l)this.nodesInfo.push(new _8(N)),y8(N,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(i,l){for(const h of this.getNodesInfo()){const m=h.node;m.footprint&&l.push({footprint:m.footprint,id:i})}}updateAppearances(i,l,h,m){}update(i){const l=Object.keys(i).length!==0;if(l&&!this.stateDependentLayers.length)return;const h=l?this.stateDependentLayers:this.layers;if(!Ba(i,this.states))for(const m of h)this.evaluate(m,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const h of l){const m=h.node;this.uploaded?this.updatePbrBuffer(m):ER(m,i,!0)}for(const h of l)fA(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let l=!1;if(!i.meshes)return l;for(const h of i.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),l=!0);return l}needsReEvaluation(i,l,h){const m=i.transform.projectionOptions,v=i.style.getBrightness(),x=this.brightness!==v;if(!this.uploaded||this.dirty||m.name!==this.projection.name||L1(h.paint.get("model-color").value,x)||L1(h.paint.get("model-color-mix-intensity").value,x)||L1(h.paint.get("model-roughness").value,x)||L1(h.paint.get("model-emissive-strength").value,x)||L1(h.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=m,this.brightness=v;const S=this.getNodesInfo();for(const A of S)A.state=null;return!0}return!1}evaluateTransform(i,l){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const h=this.getNodesInfo(),m=this.id.canonical;for(const v of h){const x=v.feature;v.evaluatedTranslation=l.paint.get("model-translation").evaluate(x,{},m),v.evaluatedScale=l.paint.get("model-scale").evaluate(x,{},m)}}evaluate(i,l){const h=this.getNodesInfo();for(const m of h){if(!m.node.meshes)continue;const v=m.feature,x=l&&l[v.id];if(Ba(x,m.state))continue;m.state=structuredClone(x);const S=m.node.meshes&&m.node.meshes[0].featureData,A=m.evaluatedColor[2],N=m.evaluatedRMEA[2],M=this.id.canonical;if(m.hasTranslucentParts=!1,S){for(let L=0;L<v8.length;L++){const z=v8[L];z.length&&(v.properties.part=z);const W=i.paint.get("model-color").evaluate(v,x,M).toPremultipliedRenderColor(null),H=i.paint.get("model-color-mix-intensity").evaluate(v,x,M);m.evaluatedColor[L]=[W.r,W.g,W.b,H],m.evaluatedRMEA[L][0]=i.paint.get("model-roughness").evaluate(v,x,M),m.evaluatedRMEA[L][2]=i.paint.get("model-emissive-strength").evaluate(v,x,M),m.evaluatedRMEA[L][3]=W.a,m.emissionHeightBasedParams[L]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(v,x,M),!m.hasTranslucentParts&&W.a<1&&(m.hasTranslucentParts=!0)}delete v.properties.part,spe(m,A!==m.evaluatedColor[2]||N!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(v,x,M);m.evaluatedTranslation=i.paint.get("model-translation").evaluate(v,x,M),m.evaluatedScale=i.paint.get("model-scale").evaluate(v,x,M),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,l,h,m){const v=i.findDEMTileFor(h);if(v&&(v.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(v.dem&&v.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=v.tileID.overscaledZ;const x=q_.create(i,h,v);if(!x)return;this.modelTraits&D_.HasMapboxMeshFeatures&&this.updateDEM(i,x,h,m);for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const N=A.footprint.vertices;let M=x.getElevationAt(N[0].x,N[0].y,!0,!0);for(let L=1;L<N.length;L++)M=Math.min(M,x.getElevationAt(N[L].x,N[L].y,!0,!0));A.elevation=M}}this.terrainTile=v.tileID.canonical,this.terrainExaggeration=l}}updateDEM(i,l,h,m){let v=l._dem._modifiedForSources[m];if(v===void 0&&(l._dem._modifiedForSources[m]=[],v=l._dem._modifiedForSources[m]),v.includes(h.canonical))return;const x=l._dem.dim;v.push(h.canonical);let S=!1;for(const A of this.getNodesInfo()){const N=A.node;if(!N.footprint||!N.footprint.grid)continue;const M=N.footprint.grid,L=l.tileCoordToPixel(M.min.x,M.min.y),z=l.tileCoordToPixel(M.max.x,M.max.y),W=Math.min(Math.min(x-z.y,L.x),Math.min(L.y,x-z.x));if(W<0)continue;const H=Pe(W,2,5);let Q=Math.max(0,L.x-H),ne=Math.max(0,L.y-H),te=Math.min(z.x+H,x-1),le=Math.min(z.y+H,x-1);for(let we=ne;we<=le;++we)for(let Ie=Q;Ie<=te;++Ie)ty[we*x+Ie]=255;let de=0,pe=0;for(let we=0;we<M.cellsY;++we)for(let Ie=0;Ie<M.cellsX;++Ie){if(!M.cells[we*M.cellsX+Ie])continue;const Oe=l.tileCoordToPixel(M.min.x+Ie/M.xScale,M.min.y+we/M.yScale),Ne=l.tileCoordToPixel(M.min.x+(Ie+1)/M.xScale,M.min.y+(we+1)/M.yScale);for(let Fe=Oe.y;Fe<=Math.min(Ne.y+1,x-1);++Fe)for(let qe=Oe.x;qe<=Math.min(Ne.x+1,x-1);++qe)ty[Fe*x+qe]===255&&(ty[Fe*x+qe]=0,de+=l.getElevationAtPixel(qe,Fe),pe++)}const Se=de/pe;Q=Math.max(1,L.x-H),ne=Math.max(1,L.y-H),te=Math.min(z.x+H,x-2),le=Math.min(z.y+H,x-2),S=!0;for(let we=ne;we<=le;++we)for(let Ie=Q;Ie<=te;++Ie)ty[we*x+Ie]===0&&(rM[we*x+Ie]=l._dem.set(Ie,we,Se));for(let we=1;we<H;++we){Q=Math.max(1,L.x-we),ne=Math.max(1,L.y-we),te=Math.min(z.x+we,x-2),le=Math.min(z.y+we,x-2);for(let Ie=ne;Ie<=le;++Ie)for(let Oe=Q;Oe<=te;++Oe){const Ne=Ie*x+Oe;if(ty[Ne]===255){let Fe=0,qe=0,ht=-1,at=-1;for(let ut=-1;ut<=1;++ut)for(let bt=-1;bt<=1;++bt){const _t=(Ie+ut)*x+Oe+bt;if(ty[_t]>=we)continue;const xt=rM[_t],rt=Math.abs(xt);rt>qe&&(Fe=xt,qe=rt,ht=bt,at=ut)}if(qe>.1){const ut=1-(we+.5*Math.abs(ht*at))/H;let bt=l._dem.get(Oe,Ie)+Fe*ut;const _t=l._dem.get(Oe+ht,Ie+at),xt=l._dem.get(Oe-ht,Ie-at,!0);(bt-_t)*(bt-xt)>0&&(bt=(_t+xt)/2),rM[Ne]=l._dem.set(Oe,Ie,bt),ty[Ne]=we}}}}}S&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=gl.now())}setFilter(i){this.filter=i?zw(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Wn(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const l of i)fA(l.node),jR(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(i.toUnwrapped());for(const m of this.getNodesInfo()){const v=m.node.footprint;m.hiddenByReplacement=!!v&&!h.find(x=>x.footprint===v)}}getHeightAtTileCoord(i,l){const h=[],m=[0,0,0],v=D([]);for(const x of this.getNodesInfo()){const S=x.node.meshes[0],A=S.transformedAabb;if(i<A.min[0]||l<A.min[1]||i>A.max[0]||l>A.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};G(v,x.node.globalMatrix),m[0]=i,m[1]=l,pr(m,m,v);const N=(m[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*Yg|0,M=Math.min(63,(m[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*Yg|0)*Yg+Math.min(63,N),L=S.heightmap[M];if(!(L<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:L,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new kt(i,l),new kt(i,l),h),h.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function L1(u,i){return u instanceof Pg&&!u.isLightConstant&&i}function ipe(u,i,l,h,m,v,x,S){let A=(61440&i|(61440&i)>>4)>>8,N=(3840&i|(3840&i)>>4)>>4,M=240&i|(240&i)>>4;l[3]>0&&(A=jr(A,255*l[0],l[3]),N=jr(N,255*l[1],l[3]),M=jr(M,255*l[2],l[3]));const L=A<<8|N,z=M<<8|Math.floor(255*h[3]),W=function(we){const Ie=Pe(we,0,2);return Math.min(Math.round(.5*Ie*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],H=Pe(m[0],0,1),Q=Pe(m[1],0,1),ne=Pe(m[2],0,1),te=Pe(m[3],0,1);let le,de,pe,Se;if(H!==Q&&x!==v&&Q!==H){const we=x-v;de=1/(we*(Q-H)),pe=-(v+we*H)/(we*(Q-H));const Ie=Pe(m[4],-1,1);Se=Math.pow(10,Ie),le=255*ne<<8|255*te}else le=65535,de=0,pe=1,Se=1;if(u.emplaceBack(L,z,W,le,de,pe,Se),S){const we=S.length;S.clear();for(let Ie=0;Ie<we;Ie++)S.emplaceBack(L,z,W,le,de,pe,Se)}}function spe(u,i,l){const h=u.node;let m=0;const v=l&D_.HasMeshoptCompression;for(const x of h.meshes){if(h.lights&&h.lightMeshIndex===m||!x.featureData)continue;x.featureArray=new Bg,x.featureArray.reserve(x.featureData.length);let S=i;for(const A of x.featureData){const N=v?65535&A:A>>16&65535,M=v?A>>16&65535:65535&A,L=(15&M)<8?15&M:0,z=u.evaluatedRMEA[L],W=u.evaluatedColor[L],H=u.emissionHeightBasedParams[L];let Q;if(S&&L===2&&h.lights&&(Q=new Bg,Q.resize(10*h.lights.length)),ipe(x.featureArray,N,W,z,H,x.aabb.min[2],x.aabb.max[2],Q),Q&&S){S=!1;const ne=h.meshes[h.lightMeshIndex];ne.featureArray=Q,ne.featureArray._trim()}}x.featureArray._trim(),m++}}ir(kA,"Tiled3dModelBucket",{omit:["layers"]}),ir(_8,"Tiled3dModelFeature");const ape=["id","tile","layer","source","sourceLayer","state"];class ry{constructor(i,l,h,m,v){this.type="Feature",this._vectorTileFeature=i,this._z=l,this._x=h,this._y=m,this.properties=i?i.properties:{},this.id=v}clone(){const i=new ry(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of ape)this[l]!==void 0&&(i[l]=this[l]);return i}}class ny extends Du{constructor(i,l,h,m){super(),this.id=i,this.type="model",this.models=[],this._options=l,this._modelsInfo=new Map}loadGLTFFromURI(i){return L6(this.map._requestManager.transformRequest(i,So.Model).url)}load(){for(const i in this._options.models){const l=this._options.models[i],h=this._modelsInfo.get(i);if(h){h.modelSpec=l;const m=h.model;m&&(m.position=l.position!=null?new Te(l.position[0],l.position[1]):new Te(0,0),m.orientation=l.orientation!=null?l.orientation:[0,0,0],ny.applyModelSpecification(m,l),m.computeBoundsAndApplyParent(),this.models.push(m))}else this._modelsInfo.set(i,{modelSpec:l,model:null}),this.loadGLTFFromURI(l.uri).then(m=>{if(!m)return;const v=this._modelsInfo.get(i);if(!v)return;const x=CR(m),S=v.modelSpec,A=new V6(i,S.uri,S.position,S.orientation,x);ny.applyModelSpecification(A,S),A.computeBoundsAndApplyParent(),this.models.push(A),v.model=A,this.loaded()&&this.fire(new Mu("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(m=>{this.fire(new hg(new Error(`Could not load model ${i} from ${l.uri}: ${m.message}`)))})}this.loaded()&&this.fire(new Mu("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(i,l){l.nodeOverrides&&ny.convertNodeOverrides(i,l.nodeOverrides),l.materialOverrides&&ny.convertMaterialOverrides(i,l.materialOverrides),l.nodeOverrideNames&&(i.nodeOverrideNames=[...l.nodeOverrideNames]),l.materialOverrideNames&&(i.materialOverrideNames=[...l.materialOverrideNames]),l.featureProperties&&(i.featureProperties=l.featureProperties)}static convertNodeOverrides(i,l){if(Array.isArray(l)&&l.every(h=>typeof h=="string")){i.nodeOverrideNames=[];for(const h of l)i.nodeOverrideNames.push(h)}else Object.entries(l).forEach(([h,m])=>{const v={orientation:[0,0,0]};if(m.hasOwnProperty("orientation")){const x=m.orientation;x&&(v.orientation=x)}i.nodeOverrides.set(h,v)})}static convertMaterialOverrides(i,l){if(Array.isArray(l)&&l.every(h=>typeof h=="string")){i.materialOverrideNames=[];for(const h of l)i.materialOverrideNames.push(h)}else Object.entries(l).forEach(([h,m])=>{const v={color:new Dn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},x=m["model-color"];x!==void 0&&(v.color.r=x[0],v.color.g=x[1],v.color.b=x[2]);const S=m["model-color-mix-intensity"];S!==void 0&&(v.colorMix=S);const A=m["model-emissive-strength"];A!==void 0&&(v.emissionStrength=A);const N=m["model-opacity"];N!==void 0&&(v.opacity=N),i.materialOverrides.set(h,v)})}onAdd(i){this.map=i,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const i of this._modelsInfo.values())if(i.model==null)return!1;return!0}getModels(){return this.models}loadTile(i,l){}serialize(){return this._options}setProperty(i,l){return!1}reload(){const i=Kh(this.id,this.scope);this.map.style.clearSource(i),this.models=[],this._modelsInfo.clear(),this.load()}setModels(i){this.models=[];const l=new Map;for(const h in i){const m=i[h];if(this._modelsInfo.has(h)){const v=this._modelsInfo.get(h);v&&v.modelSpec.uri===m.uri&&l.set(h,v)}}this._modelsInfo=l,this._options.models=i,this.load()}}function nM(u,i,l,h){const m=1<<u.z;i.lat=At((h/Wt+u.y)/m),i.lng=vt((l/Wt+u.x)/m)}function ope(u,i,l,h){const m=u.getNodesInfo()[i];if(!m||m.hiddenByReplacement||!m.node.meshes)return;let v=Number.MAX_VALUE;const x=m.node,S=l.tile,A=h.calculatePosMatrix(S.tileID.toUnwrapped(),h.worldSize),N=m.evaluatedScale;let M=0;h.elevation&&x.elevation&&(M=x.elevation*h.elevation.exaggeration()),$(A,A,[(x.anchor?x.anchor[0]:0)*(N[0]-1),(x.anchor?x.anchor[1]:0)*(N[1]-1),M]),K(A,A,N);const L=l.queryGeometry,z=L.isPointQuery()?L.screenBounds:L.screenGeometry,W=function(Q){const ne=V([],A,Q.globalMatrix);V(ne,h.expandedFarZProjMatrix,ne);for(let te=0;te<Q.meshes.length;++te){const le=Q.meshes[te];if(te===Q.lightMeshIndex)continue;const de=TR(z,h,ne,le.aabb);de!=null&&(v=Math.min(de,v))}if(Q.children)for(const te of Q.children)W(te)};if(W(x),v===Number.MAX_VALUE)return;const H=new Te(0,0);return nM(S.tileID.canonical,H,m.node.anchor[0],m.node.anchor[1]),{intersectionZ:v,position:H,feature:m.feature}}const lpe={circle:class extends co{constructor(u,i,l,h){super(u,{layout:tV||(tV=new Mi({"circle-sort-key":new Kt(Qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Lt(Qe.layout_circle["circle-elevation-reference"]),visibility:new Lt(Qe.layout_circle.visibility)})),paint:rV||(rV=new Mi({"circle-radius":new Kt(Qe.paint_circle["circle-radius"]),"circle-color":new Kt(Qe.paint_circle["circle-color"]),"circle-blur":new Kt(Qe.paint_circle["circle-blur"]),"circle-opacity":new Kt(Qe.paint_circle["circle-opacity"]),"circle-translate":new Lt(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Lt(Qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}createBucket(u){return new ho(u)}queryRadius(u){const i=u;return Qh("circle-radius",this,i)+Qh("circle-stroke-width",this,i)+j_(this.paint.get("circle-translate"))}queryIntersectsFeature(u,i,l,h,m,v,x,S){const A=eV(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return mV(u,h,v,x,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,i,l){const h=pV(this);return{config:new U(this,{zoom:i,lut:l}),defines:h,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends co{createBucket(u){return new yV(u)}constructor(u,i,l,h){super(u,{layout:vV||(vV=new Mi({visibility:new Lt(Qe.layout_heatmap.visibility)})),paint:_V||(_V=new Mi({"heatmap-radius":new Kt(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vp(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=i1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return Qh("heatmap-radius",this,u)}queryIntersectsFeature(u,i,l,h,m,v,x,S){const A=this.paint.get("heatmap-radius").evaluate(i,l);return mV(u,h,v,x,S,!0,!0,new kt(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,i,l){return u==="heatmap"?{config:new U(this,{zoom:i,lut:l}),overrideFog:!1}:{}}},hillshade:class extends co{constructor(u,i,l,h){super(u,{layout:xV||(xV=new Mi({visibility:new Lt(Qe.layout_hillshade.visibility)})),paint:bV||(bV=new Mi({"hillshade-illumination-direction":new Lt(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Lt(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Lt(Qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,i,l){return{overrideFog:!1}}},fill:class extends co{constructor(u,i,l,h){super(u,{layout:$V||($V=new Mi({"fill-sort-key":new Kt(Qe.layout_fill["fill-sort-key"]),visibility:new Lt(Qe.layout_fill.visibility),"fill-elevation-reference":new Lt(Qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Kt(Qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:VV||(VV=new Mi({"fill-antialias":new Lt(Qe.paint_fill["fill-antialias"]),"fill-opacity":new Kt(Qe.paint_fill["fill-opacity"]),"fill-color":new Kt(Qe.paint_fill["fill-color"]),"fill-outline-color":new Kt(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kt(Qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Lt(Qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Lt(Qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Kt(Qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Kt(Qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Kt(Qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}getProgramIds(){const u=this.paint.get("fill-pattern"),i=u&&u.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(u,i,l){return{config:new U(this,{zoom:i,lut:l}),overrideFog:!1}}recalculate(u,i){super.recalculate(u,i);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new oR(u)}queryRadius(){return j_(this.paint.get("fill-translate"))}queryIntersectsFeature(u,i,l,h,m,v){return!u.queryGeometry.isAboveHorizon&&ui(Q$(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?i&&!u:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends co{constructor(u,i,l,h){super(u,{layout:d6||(d6=new Mi({visibility:new Lt(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Lt(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:h6||(h6=new Mi({"fill-extrusion-opacity":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Lt(Qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new nA(u)}queryRadius(){return j_(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,i,l,h,m,v,x,S,A){const N=eV(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(i,l),L=this.paint.get("fill-extrusion-base").evaluate(i,l),z=[0,0],W=S&&v.elevation,H=v.elevation?v.elevation.exaggeration():1,Q=u.tile.getBucket(this);if(W&&Q instanceof nA){const pe=Q.centroidVertexArray,Se=A+1;Se<pe.length&&(z[0]=pe.geta_centroid_pos0(Se),z[1]=pe.geta_centroid_pos1(Se))}if(z[0]===0&&z[1]===1)return!1;v.projection.name==="globe"&&(h=u6([h],[new kt(0,0),new kt(Wt,Wt)],u.tileID.canonical).map(pe=>pe.polygon).flat());const ne=W?S:null,[te,le]=_6(v,h,L,M,N,x,ne,z,H,v.center.lat,u.tileID.canonical),de=u.queryGeometry;return v6(te,le,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},building:class extends co{constructor(u,i,l,h){super(u,{layout:X6||(X6=new Mi({visibility:new Lt(Qe.layout_building.visibility),"building-facade":new Kt(Qe.layout_building["building-facade"]),"building-facade-floors":new Kt(Qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Kt(Qe.layout_building["building-facade-unit-width"]),"building-facade-window":new Kt(Qe.layout_building["building-facade-window"]),"building-roof-shape":new Kt(Qe.layout_building["building-roof-shape"]),"building-height":new Kt(Qe.layout_building["building-height"]),"building-base":new Kt(Qe.layout_building["building-base"]),"building-flood-light-wall-radius":new Kt(Qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Kt(Qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Kt(Qe.layout_building["building-flip-roof-orientation"])})),paint:K6||(K6=new Mi({"building-opacity":new Lt(Qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Lt(Qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Lt(Qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Lt(Qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Lt(Qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Lt(Qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Lt(Qe.paint_building["building-cast-shadows"]),"building-color":new Kt(Qe.paint_building["building-color"]),"building-emissive-strength":new Kt(Qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Lt(Qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Lt(Qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Lt(Qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Lt(Qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Lt(Qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Z6(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,i,l,h,m,v,x,S,A,N){let M=this.layout.get("building-height").evaluate(i,l);const L=this.layout.get("building-base").evaluate(i,l),z=u.tile.getBucket(this).getFootprint(i);if(z){if(z.hiddenFlags!==0)return!1;M=z.height}const[W,H]=_6(v,h,L,M,new kt(0,0),x,null,[0,0],1,v.center.lat,u.tileID.canonical),Q=u.queryGeometry;return v6(W,H,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends co{constructor(u,i,l,h){const m=aU();super(u,m,i,l,h),m.layout&&(this.layout=new lo(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof wg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(u,i){super.recalculate(u,i),this.paint._values["line-floorwidth"]=(()=>{if(S1)return S1;const l=aU();return S1=new rfe(l.paint.properties["line-width"].specification),S1.useIntegerZoom=!0,S1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new IR(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,i,l){const h=iU(this);return{config:new U(this,{zoom:i,lut:l}),defines:h,overrideFog:!1}}queryRadius(u){const i=u,l=oU(Qh("line-width",this,i),Qh("line-gap-width",this,i)),h=Qh("line-offset",this,i);return l/2+Math.abs(h)+j_(this.paint.get("line-translate"))}queryIntersectsFeature(u,i,l,h,m,v){if(u.queryGeometry.isAboveHorizon)return!1;const x=Q$(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),S=u.pixelToTileUnitsFactor/2*oU(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),A=this.paint.get("line-offset").evaluate(i,l);return A&&(h=function(N,M){const L=[],z=new kt(0,0);for(let W=0;W<N.length;W++){const H=N[W],Q=[];for(let ne=0;ne<H.length;ne++){const te=H[ne],le=H[ne+1],de=ne===0?z:te.sub(H[ne-1])._unit()._perp(),pe=ne===H.length-1?z:le.sub(te)._unit()._perp(),Se=de._add(pe)._unit();Se._mult(1/(Se.x*pe.x+Se.y*pe.y)),Q.push(Se._mult(M)._add(te))}L.push(Q)}return L}(h,A*u.pixelToTileUnitsFactor)),function(N,M,L){for(let z=0;z<M.length;z++){const W=M[z];if(N.length>=3){for(let H=0;H<W.length;H++)if(Ko(N,W[H]))return!0}if(ms(N,W,L))return!0}return!1}(x,h,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:CA,background:class extends co{constructor(u,i,l,h){super(u,{layout:JU||(JU=new Mi({visibility:new Lt(Qe.layout_background.visibility)})),paint:QU||(QU=new Mi({"background-pitch-alignment":new Lt(Qe.paint_background["background-pitch-alignment"]),"background-color":new Lt(Qe.paint_background["background-color"]),"background-pattern":new Lt(Qe.paint_background["background-pattern"]),"background-opacity":new Lt(Qe.paint_background["background-opacity"]),"background-emissive-strength":new Lt(Qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,i,l){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:i8,"raster-particle":u8,sky:class extends co{constructor(u,i,l,h){super(u,{layout:o8||(o8=new Mi({visibility:new Lt(Qe.layout_sky.visibility)})),paint:l8||(l8=new Mi({"sky-type":new Lt(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Lt(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Lt(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Lt(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Lt(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new vp(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Lt(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Lt(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Lt(Qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=i1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(u,i){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),m=!h,v=u.style.light,x=v.properties.get("position");return m&&v.properties.get("anchor")==="viewport"&&Nr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?QR(x.azimuthal,90-x.polar,i):QR(h[0],90-h[1],i)}const l=this.paint.get("sky-gradient-center");return QR(l[0],90-l[1],i)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends co{constructor(u,i,l,h){super(u,{paint:c8||(c8=new Mi({}))},i,null)}},model:class extends co{constructor(u,i,l,h){super(u,{layout:p8||(p8=new Mi({visibility:new Lt(Qe.layout_model.visibility),"model-id":new Kt(Qe.layout_model["model-id"]),"model-allow-density-reduction":new Lt(Qe.layout_model["model-allow-density-reduction"])})),paint:m8||(m8=new Mi({"model-opacity":new Kt(Qe.paint_model["model-opacity"]),"model-rotation":new Kt(Qe.paint_model["model-rotation"]),"model-scale":new Kt(Qe.paint_model["model-scale"]),"model-translation":new Kt(Qe.paint_model["model-translation"]),"model-color":new Kt(Qe.paint_model["model-color"]),"model-color-mix-intensity":new Kt(Qe.paint_model["model-color-mix-intensity"]),"model-type":new Lt(Qe.paint_model["model-type"]),"model-cast-shadows":new Lt(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Lt(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Lt(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Kt(Qe.paint_model["model-emissive-strength"]),"model-roughness":new Kt(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Kt(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Lt(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Lt(Qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Lt(Qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Kt({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new tM(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof kA?8191:0}queryRenderedFeatures(u,i,l){const h=i.getSource();if(!(h&&h instanceof ny))return{};const m=h,v={};v[this.id]=[];const x=v[this.id];let S=0;for(const A of m.models){const N=i.getFeatureState(this.sourceLayer,A.id),M={type:"Unknown",id:A.id,properties:A.featureProperties},L=this.paint.get("model-rotation").evaluate(M,N),z=this.paint.get("model-scale").evaluate(M,N),W=this.paint.get("model-translation").evaluate(M,N),H=this.paint.get("model-elevation-reference");let Q=[];hA(Q,A,l,A.position,L,z,W,H==="ground",H==="ground",!1),l.projection.name==="globe"&&(Q=dA(Q,l));const ne=V([],l.projMatrix,Q),te=TR(u.isPointQuery()?u.screenBounds:u.screenGeometry,l,ne,A.aabb);if(te!=null){const le=new ry(void 0,0,0,0,A.id);le.layer=this.layer,le.properties=structuredClone(A.featureProperties),le.properties.layer=this.id,le.properties.uri=A.uri,le.properties.orientation=A.orientation,le.sourceLayer=this.sourceLayer,le.geometry={type:"Point",coordinates:[A.position.lng,A.position.lat]},le.state=N,le.source=this.source,x.push({featureIndex:S,feature:le,intersectionZ:te})}++S}return v}queryIntersectsFeature(u,i,l,h,m,v,x,S,A,N){if(!this.modelManager)return!1;const M=this.modelManager,L=u.tile.getBucket(this);if(!(L&&L instanceof tM))return!1;for(const z in L.instancesPerModel){const W=L.instancesPerModel[z],H=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(W.idToFeaturesIndex.hasOwnProperty(H)){const Q=W.features[W.idToFeaturesIndex[H]],ne=M.getModel(z,N||this.scope);if(!ne)return!1;let te=[];const le=new Te(0,0),de=L.canonical;let pe=Number.MAX_VALUE;for(let Se=0;Se<Q.instancedDataCount;++Se){const we=16*(Q.instancedDataOffset+Se),Ie=W.instancedDataArray.float32,Oe=[Ie[we+4],Ie[we+5],Ie[we+6]];nM(de,le,Math.floor(Ie[we]),Math.floor(Ie[we+1])),hA(te,ne,v,le,Q.rotation,Q.scale,Oe,!1,!1,!1),v.projection.name==="globe"&&(te=dA(te,v));const Ne=V([],v.projMatrix,te),Fe=u.queryGeometry,qe=TR(Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,v,Ne,ne.aabb);qe!=null&&(pe=Math.min(qe,pe))}return pe!==Number.MAX_VALUE&&pe}}return!1}_handleOverridablePaintPropertyUpdate(u,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const i=this._transitionablePaint._values[u];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Hh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends co{constructor(u,i,l,h){super(u,{layout:UV||(UV=new Mi({"clip-layer-types":new Lt(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Lt(Qe.layout_clip["clip-layer-scope"])})),paint:qV||(qV=new Mi({}))},i,l,h)}recalculate(u,i){super.recalculate(u,i)}createBucket(u){return new GV(u)}is3D(u){return!0}}},iM=new Dn(0,0,0);function cpe(u,i,l){u===1&&i.icons.push(function(h,m){return function(v){if(v.usvg_tree.height||(v.usvg_tree.height=v.usvg_tree.width),!v.metadata)return v;const{metadata:x}=v;if(x.content_area){const{content_area:S}=x;S.left==null&&(S.left=0),S.top==null&&(S.top=S.left),S.width==null&&(S.width=v.usvg_tree.width),S.height==null&&(S.height=S.width)}if(x.text_placeholder){const{text_placeholder:S}=x;S.top==null&&(S.top=S.left),S.height==null&&(S.height=S.width)}return x.stretch_x&&x.stretch_x.length&&x8(x,"x"),x.stretch_y&&x.stretch_y.length&&x8(x,"y"),v}(h.readFields(upe,{name:void 0},m))}(l,l.readVarint()+l.pos))}function x8(u,i){const l=[],h=u[`stretch_${i}`];let m=null;for(let v=0;v<h.length;v++)m===null?m=l.length===0?h[0]:l[l.length-1][1]+h[v]:(l.push([m,m+h[v]]),m=null);u[`stretch_${i}_areas`]=l}function upe(u,i,l){u===1?i.name=l.readString():u===2?i.metadata=function(h,m){return h.readFields(dpe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(l,l.readVarint()+l.pos):u===3&&(i.usvg_tree=function(h,m){return h.readFields(ppe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(l,l.readVarint()+l.pos),i.data="usvg_tree")}function dpe(u,i,l){u===1?i.stretch_x=l.readPackedVarint():u===2?i.stretch_y=l.readPackedVarint():u===3?i.content_area=b8(l,l.readVarint()+l.pos):u===4?i.variables.push(function(h,m){return h.readFields(fpe,{name:void 0},m)}(l,l.readVarint()+l.pos)):u===5&&(i.text_placeholder=b8(l,l.readVarint()+l.pos))}function b8(u,i){return u.readFields(hpe,{},i)}function hpe(u,i,l){u===1?i.left=l.readVarint():u===2?i.width=l.readVarint():u===3?i.top=l.readVarint():u===4&&(i.height=l.readVarint())}function fpe(u,i,l){u===1?i.name=l.readString():u===2&&(i.rgb_color=MA(l.readVarint()),i.value="rgb_color")}function ppe(u,i,l){u===1?i.width=i.height=l.readVarint():u===2?i.height=l.readVarint():u===3?i.children.push(OA(l,l.readVarint()+l.pos)):u===4?i.linear_gradients.push(function(h,m){return h.readFields(bpe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(l,l.readVarint()+l.pos)):u===5?i.radial_gradients.push(function(h,m){return h.readFields(Spe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(l,l.readVarint()+l.pos)):u===7?i.clip_paths.push(function(h,m){return h.readFields(Tpe,{children:[]},m)}(l,l.readVarint()+l.pos)):u===8&&i.masks.push(function(h,m){const v=h.readFields(Epe,{left:0,width:20,mask_type:1,children:[]},m);return v.height==null&&(v.height=v.width),v.top==null&&(v.top=v.left),v}(l,l.readVarint()+l.pos))}function OA(u,i){return u.readFields(mpe,{},i)}function mpe(u,i,l){u===1?(i.group=function(h,m){return h.readFields(gpe,{opacity:255,children:[]},m)}(l,l.readVarint()+l.pos),i.node="group"):u===2&&(i.path=function(h,m){return h.readFields(vpe,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(l,l.readVarint()+l.pos),i.node="path")}function gpe(u,i,l){u===1?i.transform=RA(l,l.readVarint()+l.pos):u===2?i.opacity=l.readVarint():u===5?i.clip_path_idx=l.readVarint():u===6?i.mask_idx=l.readVarint():u===7&&i.children.push(OA(l,l.readVarint()+l.pos))}function RA(u,i){return u.readFields(ype,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function ype(u,i,l){u===1?i.sx=l.readFloat():u===2?i.ky=l.readFloat():u===3?i.kx=l.readFloat():u===4?i.sy=l.readFloat():u===5?i.tx=l.readFloat():u===6&&(i.ty=l.readFloat())}function vpe(u,i,l){u===1?i.fill=function(h,m){return h.readFields(_pe,{rgb_color:iM,paint:"rgb_color",opacity:255},m)}(l,l.readVarint()+l.pos):u===2?i.stroke=function(h,m){return h.readFields(xpe,{rgb_color:iM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(l,l.readVarint()+l.pos):u===3?i.paint_order=l.readVarint():u===5?l.readPackedVarint(i.commands):u===6?i.step=l.readFloat():u===7?l.readPackedSVarint(i.diffs):u===8&&(i.rule=l.readVarint())}function _pe(u,i,l){u===1?(i.rgb_color=MA(l.readVarint()),i.paint="rgb_color"):u===2?(i.linear_gradient_idx=l.readVarint(),i.paint="linear_gradient_idx"):u===3?(i.radial_gradient_idx=l.readVarint(),i.paint="radial_gradient_idx"):u===5&&(i.opacity=l.readVarint())}function MA(u){return new Dn((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function xpe(u,i,l){u===1?(i.rgb_color=MA(l.readVarint()),i.paint="rgb_color"):u===2?(i.linear_gradient_idx=l.readVarint(),i.paint="linear_gradient_idx"):u===3?(i.radial_gradient_idx=l.readVarint(),i.paint="radial_gradient_idx"):u===5?l.readPackedFloat(i.dasharray):u===6?i.dashoffset=l.readFloat():u===7?i.miterlimit=l.readFloat():u===8?i.opacity=l.readVarint():u===9?i.width=l.readFloat():u===10?i.linecap=l.readVarint():u===11&&(i.linejoin=l.readVarint())}function bpe(u,i,l){u===1?i.transform=RA(l,l.readVarint()+l.pos):u===2?i.spread_method=l.readVarint():u===3?i.stops.push(w8(l,l.readVarint()+l.pos)):u===4?i.x1=l.readFloat():u===5?i.y1=l.readFloat():u===6?i.x2=l.readFloat():u===7&&(i.y2=l.readFloat())}function w8(u,i){return u.readFields(wpe,{offset:0,opacity:255,rgb_color:iM},i)}function wpe(u,i,l){u===1?i.offset=l.readFloat():u===2?i.opacity=l.readVarint():u===3&&(i.rgb_color=MA(l.readVarint()))}function Spe(u,i,l){u===1?i.transform=RA(l,l.readVarint()+l.pos):u===2?i.spread_method=l.readVarint():u===3?i.stops.push(w8(l,l.readVarint()+l.pos)):u===4?i.cx=l.readFloat():u===5?i.cy=l.readFloat():u===6?i.r=l.readFloat():u===7?i.fx=l.readFloat():u===8?i.fy=l.readFloat():u===9&&(i.fr=l.readFloat())}function Tpe(u,i,l){u===1?i.transform=RA(l,l.readVarint()+l.pos):u===2?i.clip_path_idx=l.readVarint():u===3&&i.children.push(OA(l,l.readVarint()+l.pos))}function Epe(u,i,l){u===1?i.left=i.top=l.readFloat():u===2?i.width=i.height=l.readFloat():u===3?i.top=l.readFloat():u===4?i.height=l.readFloat():u===5?i.mask_type=l.readVarint():u===6?i.mask_idx=l.readVarint():u===7&&i.children.push(OA(l,l.readVarint()+l.pos))}class jpe{static calculate(i={},l=[]){const h=new Map,m=new Map;if(Object.keys(i).length===0)return h;l.forEach(v=>{m.set(v.name,v.rgb_color||new Dn(0,0,0))});for(const[v,x]of Object.entries(i))m.has(v)?h.set(m.get(v).toString(),x):console.warn(`Ignoring unknown image variable "${v}"`);return h}}function G_(u,i=255,l){const h=i/255,m=u.toString(),v=l.has(m)?l.get(m).clone():u.clone();return v.a*=h,v.toString()}function F1(u,i){if(!Lh()){const l=document.createElement("canvas");return l.width=u,l.height=i,l}return new OffscreenCanvas(u,i)}let sM,z1=null;function aM(u,i,l,h,m){for(const v of h.children)S8(u,i,l,v,m)}function S8(u,i,l,h,m){h.group?(u.save(),function(v,x,S,A,N){const M=A.mask_idx!=null?S.masks[A.mask_idx]:null,L=A.clip_path_idx!=null?S.clip_paths[A.clip_path_idx]:null;if(A.transform&&(x=W_(A.transform).preMultiplySelf(x)),!function(H,Q,ne){return H.opacity!==255||Q||ne}(A,L!=null,M!=null))return void aM(v,x,S,A,N);const z=F1(v.canvas.width,v.canvas.height),W=z.getContext("2d");aM(W,x,S,A,N),L&&N8(W,x,S,L),M&&I8(W,x,S,M,N),v.globalAlpha=A.opacity/255,v.drawImage(z,0,0)}(u,i,l,h.group,m),u.restore()):h.path&&(u.save(),function(v,x,S,A,N){v.setTransform(x),A.paint_order===1?(T8(v,S,A,N),j8(v,S,A,N)):(j8(v,S,A,N),T8(v,S,A,N))}(u,i,l,h.path,m),u.restore())}function T8(u,i,l,h){const m=l.fill;if(!m)return;const v=m.opacity/255;switch(u.save(),u.beginPath(),k8(l,u),m.paint){case"rgb_color":u.fillStyle=G_(m.rgb_color,m.opacity,h);break;case"linear_gradient_idx":{const x=i.linear_gradients[m.linear_gradient_idx];x.transform&&u.setTransform(W_(x.transform).preMultiplySelf(u.getTransform())),u.fillStyle=A8(u,x,v,h);break}case"radial_gradient_idx":{const x=i.radial_gradients[m.radial_gradient_idx];x.transform&&u.setTransform(W_(x.transform).preMultiplySelf(u.getTransform())),u.fillStyle=C8(u,x,v,h)}}u.fill(E8(l)),u.restore()}function E8(u){return u.rule===1?"nonzero":u.rule===2?"evenodd":void 0}function j8(u,i,l,h){const m=l.stroke;if(!m)return;const v=O8(l);u.lineWidth=m.width,u.miterLimit=m.miterlimit,u.setLineDash(m.dasharray),u.lineDashOffset=m.dashoffset;const x=m.opacity/255;switch(m.paint){case"rgb_color":u.strokeStyle=G_(m.rgb_color,m.opacity,h);break;case"linear_gradient_idx":u.strokeStyle=A8(u,i.linear_gradients[m.linear_gradient_idx],x,h,!0);break;case"radial_gradient_idx":u.strokeStyle=C8(u,i.radial_gradients[m.radial_gradient_idx],x,h,!0)}switch(m.linejoin){case 2:case 1:u.lineJoin="miter";break;case 3:u.lineJoin="round";break;case 4:u.lineJoin="bevel"}switch(m.linecap){case 1:u.lineCap="butt";break;case 2:u.lineCap="round";break;case 3:u.lineCap="square"}u.stroke(v)}function A8(u,i,l,h,m=!1){if(i.stops.length===1){const z=i.stops[0];return G_(z.rgb_color,z.opacity*l,h)}const{x1:v,y1:x,x2:S,y2:A}=i;let N=new DOMPoint(v,x),M=new DOMPoint(S,A);if(m){const z=W_(i.transform);N=z.transformPoint(N),M=z.transformPoint(M)}const L=u.createLinearGradient(N.x,N.y,M.x,M.y);for(const z of i.stops)L.addColorStop(z.offset,G_(z.rgb_color,z.opacity*l,h));return L}function C8(u,i,l,h,m=!1){if(i.stops.length===1){const te=i.stops[0];return G_(te.rgb_color,te.opacity*l,h)}const v=W_(i.transform),{fx:x,fy:S,fr:A,cx:N,cy:M,r:L}=i;let z=new DOMPoint(x,S),W=new DOMPoint(N,M),H=A,Q=L;if(m){z=v.transformPoint(z),W=v.transformPoint(W);const te=(v.a+v.d)/2;H=A*te,Q=i.r*te}const ne=u.createRadialGradient(z.x,z.y,H,W.x,W.y,Q);for(const te of i.stops)ne.addColorStop(te.offset,G_(te.rgb_color,te.opacity*l,h));return ne}function P8(u,i,l,h){const m=h.transform?W_(h.transform).preMultiplySelf(i):i,v=F1(u.canvas.width,u.canvas.height),x=v.getContext("2d");for(const A of h.children)if(A.group)P8(x,m,l,A.group);else if(A.path){const N=A.path,M=new Path2D;M.addPath(O8(N),m),x.fill(M,E8(N))}const S=h.clip_path_idx!=null?l.clip_paths[h.clip_path_idx]:null;S&&N8(x,m,l,S),u.globalCompositeOperation="source-over",u.drawImage(v,0,0)}function N8(u,i,l,h){const m=F1(u.canvas.width,u.canvas.height);P8(m.getContext("2d"),i,l,h),u.globalCompositeOperation="destination-in",u.drawImage(m,0,0)}function I8(u,i,l,h,m){if(h.children.length===0)return;const v=h.mask_idx!=null?l.masks[h.mask_idx]:null;v&&I8(u,i,l,v,m);const x=u.canvas.width,S=u.canvas.height,A=F1(x,S),N=A.getContext("2d"),M=h.width,L=h.height,z=h.left,W=h.top,H=new Path2D,Q=new Path2D;Q.rect(z,W,M,L),H.addPath(Q,i),N.clip(H);for(const le of h.children)S8(N,i,l,le,m);const ne=N.getImageData(0,0,x,S),te=ne.data;if(h.mask_type===1)for(let le=0;le<te.length;le+=4)te[le+3]=te[le+3]/255*(.2126*te[le]+.7152*te[le+1]+.0722*te[le+2]);N.putImageData(ne,0,0),u.globalCompositeOperation="destination-in",u.drawImage(A,0,0)}function W_(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function k8(u,i){const l=u.step;let h=u.diffs[0]*l,m=u.diffs[1]*l;i.moveTo(h,m);for(let v=0,x=2;v<u.commands.length;v++)switch(u.commands[v]){case 1:h+=u.diffs[x++]*l,m+=u.diffs[x++]*l,i.moveTo(h,m);break;case 2:h+=u.diffs[x++]*l,m+=u.diffs[x++]*l,i.lineTo(h,m);break;case 3:{const S=h+u.diffs[x++]*l,A=m+u.diffs[x++]*l;h=S+u.diffs[x++]*l,m=A+u.diffs[x++]*l,i.quadraticCurveTo(S,A,h,m);break}case 4:{const S=h+u.diffs[x++]*l,A=m+u.diffs[x++]*l,N=S+u.diffs[x++]*l,M=A+u.diffs[x++]*l;h=N+u.diffs[x++]*l,m=M+u.diffs[x++]*l,i.bezierCurveTo(S,A,N,M,h,m);break}case 5:i.closePath();break}return i}function O8(u){return k8(u,new Path2D)}class DA{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const l=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,l),l}put(i,l){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,l)}delete(i){this.cache.delete(i)}}ir(DA,"LRUCache");class oM{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Aa(i,i.data)}getFromCache(i,l,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new DA(150)),this.cacheMap.get(h).get(Kh(i.toString(),l))}setInCache(i,l,h,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new DA(150));const v=this.cacheDependenciesMap.get(m),x=Kh(i.id.toString(),h);v.get(x)||v.set(x,new Set);const S=this.cacheMap.get(m),A=i.toString();v.get(x).add(A),S.put(Kh(i.toString(),h),l)}removeImagesFromCacheByIds(i,l,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const m=this.cacheMap.get(h),v=this.cacheDependenciesMap.get(h);for(const x of i){const S=Kh(x.toString(),l);if(v.has(S)){for(const A of v.get(S))m.delete(A);v.delete(S)}}}rasterize(i,l,h,m){const v=this.getFromCache(i,h,m);if(v)return v.clone();const x=function(A,N){const M=jpe.calculate(N.params,A.metadata?A.metadata.variables:[]),L=A.usvg_tree,z=L.width,W=L.height,H=Math.max(1,Math.round(z*N.sx)),Q=Math.max(1,Math.round(W*N.sy)),ne=new DOMMatrix([H/z,0,0,Q/W,0,0]);return z1===null&&(z1=F1(10,10),sM=z1.getContext("2d",{willReadFrequently:!0})),z1.width=H,z1.height=Q,aM(sM,ne,L,L,M),sM.getImageData(0,0,H,Q)}(l.icon,i),S=oM._getImage(x);return this.setInCache(i,S,h,m),S.clone()}}class R8{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const h=this.toIdx(i,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function M8(u,i,l,h){let m=0,v=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(l[x]<u[x]||l[x]>i[x])return null}else{const S=1/h[x];let A=(u[x]-l[x])*S,N=(i[x]-l[x])*S;if(A>N){const M=A;A=N,N=M}if(A>m&&(m=A),N<v&&(v=N),m>v)return null}return m}function D8(u,i,l,h,m,v,x,S,A,N,M){const L=h-u,z=m-i,W=v-l,H=x-u,Q=S-i,ne=A-l,te=M[1]*ne-M[2]*Q,le=M[2]*H-M[0]*ne,de=M[0]*Q-M[1]*H,pe=L*te+z*le+W*de;if(Math.abs(pe)<1e-15)return null;const Se=1/pe,we=N[0]-u,Ie=N[1]-i,Oe=N[2]-l,Ne=(we*te+Ie*le+Oe*de)*Se;if(Ne<0||Ne>1)return null;const Fe=Ie*W-Oe*z,qe=Oe*L-we*W,ht=we*z-Ie*L,at=(M[0]*Fe+M[1]*qe+M[2]*ht)*Se;return at<0||Ne+at>1?null:(H*Fe+Q*qe+ne*ht)*Se}function L8(u,i,l){return(u-i)/(l-i)}function F8(u,i,l,h,m,v,x,S,A){const N=1<<l,M=v-h,L=x-m,z=(u+1)/N*M+h,W=(i+0)/N*L+m,H=(i+1)/N*L+m;S[0]=(u+0)/N*M+h,S[1]=W,A[0]=z,A[1]=H}class z8{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(v){const x=Math.ceil(Math.log2(v.dim/8)),S=[];let A=Math.ceil(Math.pow(2,x));const N=1/A,M=(W,H,Q,ne,te)=>{const le=ne?1:0,de=(W+1)*Q-le,pe=H*Q,Se=(H+1)*Q-le;te[0]=W*Q,te[1]=pe,te[2]=de,te[3]=Se};let L=new R8(A);const z=[];for(let W=0;W<A*A;W++){M(W%A,Math.floor(W/A),N,!1,z);const H=Rp(z[0],z[1],v),Q=Rp(z[2],z[1],v),ne=Rp(z[2],z[3],v),te=Rp(z[0],z[3],v);L.minimums.push(Math.min(H,Q,ne,te)),L.maximums.push(Math.max(H,Q,ne,te)),L.leaves.push(1)}for(S.push(L),A/=2;A>=1;A/=2){const W=S[S.length-1];L=new R8(A);for(let H=0;H<A*A;H++){M(H%A,Math.floor(H/A),2,!0,z);const Q=W.getElevation(z[0],z[1]),ne=W.getElevation(z[2],z[1]),te=W.getElevation(z[2],z[3]),le=W.getElevation(z[0],z[3]),de=W.isLeaf(z[0],z[1]),pe=W.isLeaf(z[2],z[1]),Se=W.isLeaf(z[2],z[3]),we=W.isLeaf(z[0],z[3]),Ie=Math.min(Q.min,ne.min,te.min,le.min),Oe=Math.max(Q.max,ne.max,te.max,le.max),Ne=de&&pe&&Se&&we;L.maximums.push(Oe),L.minimums.push(Ie),L.leaves.push(Oe-Ie<=5&&Ne?1:0)}S.push(L)}return S}(this.dem),h=l.length-1,m=l[h];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(i,l,h,m,v,x,S=1){return M8([i,l,-100],[h,m,this.maximums[0]*S],v,x)}raycast(i,l,h,m,v,x,S=1){if(!this.nodeCount)return null;const A=this.raycastRoot(i,l,h,m,v,x,S);if(A==null)return null;const N=[],M=[],L=[],z=[],W=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;W.length>0;){const{idx:H,t:Q,nodex:ne,nodey:te,depth:le}=W.pop();if(this.leaves[H]){F8(ne,te,le,i,l,h,m,L,z);const pe=1<<le,Se=(ne+0)/pe,we=(ne+1)/pe,Ie=(te+0)/pe,Oe=(te+1)/pe,Ne=Rp(Se,Ie,this.dem)*S,Fe=Rp(we,Ie,this.dem)*S,qe=Rp(we,Oe,this.dem)*S,ht=Rp(Se,Oe,this.dem)*S,at=D8(L[0],L[1],Ne,z[0],L[1],Fe,z[0],z[1],qe,v,x),ut=D8(z[0],z[1],qe,L[0],z[1],ht,L[0],L[1],Ne,v,x),bt=Math.min(at!==null?at:Number.MAX_VALUE,ut!==null?ut:Number.MAX_VALUE);if(bt!==Number.MAX_VALUE)return bt;{const _t=Bt([],v,x,Q);if(B8(Ne,Fe,ht,qe,L8(_t[0],L[0],z[0]),L8(_t[1],L[1],z[1]))>=_t[2])return Q}continue}let de=0;for(let pe=0;pe<this._siblingOffset.length;pe++){F8((ne<<1)+this._siblingOffset[pe][0],(te<<1)+this._siblingOffset[pe][1],le+1,i,l,h,m,L,z),L[2]=-100,z[2]=this.maximums[this.childOffsets[H]+pe]*S;const Se=M8(L,z,v,x);if(Se!=null){const we=Se;N[pe]=we;let Ie=!1;for(let Oe=0;Oe<de&&!Ie;Oe++)we>=N[M[Oe]]&&(M.splice(Oe,0,pe),Ie=!0);Ie||(M[de]=pe),de++}}for(let pe=0;pe<de;pe++){const Se=M[pe];W.push({idx:this.childOffsets[H]+Se,t:N[Se],nodex:(ne<<1)+this._siblingOffset[Se][0],nodey:(te<<1)+this._siblingOffset[Se][1],depth:le+1})}}return null}_addNode(i,l,h){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,h,m,v){if(i[m].isLeaf(l,h)===1)return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const x=m-1,S=i[x];let A=0,N=0;for(let M=0;M<this._siblingOffset.length;M++){const L=2*l+this._siblingOffset[M][0],z=2*h+this._siblingOffset[M][1],W=S.getElevation(L,z),H=S.isLeaf(L,z),Q=this._addNode(W.min,W.max,H);H&&(A|=1<<M),N||(N=Q)}for(let M=0;M<this._siblingOffset.length;M++)A&1<<M||this._construct(i,2*l+this._siblingOffset[M][0],2*h+this._siblingOffset[M][1],x,N+M)}}function B8(u,i,l,h,m,v){return jr(jr(u,l,v),jr(i,h,v),m)}function Rp(u,i,l){const h=l.dim,m=Pe(u*h-.5,0,h-1),v=Pe(i*h-.5,0,h-1),x=Math.floor(m),S=Math.floor(v),A=Math.min(x+1,h-1),N=Math.min(S+1,h-1);return B8(l.get(x,S),l.get(A,S),l.get(x,N),l.get(A,N),m-x,v-S)}const Ape={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Cpe(u,i,l){return(256*u*256+256*i+l)/10-1e4}function Ppe(u,i,l){return 256*u+i+l/256-32768}class LA{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,h,m=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Nr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,x=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let A=0;A<v;A++)x[this._idx(-1,A)]=x[this._idx(0,A)],x[this._idx(v,A)]=x[this._idx(v-1,A)],x[this._idx(A,-1)]=x[this._idx(A,0)],x[this._idx(A,v)]=x[this._idx(A,v-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(v,-1)]=x[this._idx(v-1,0)],x[this._idx(-1,v)]=x[this._idx(0,v-1)],x[this._idx(v,v)]=x[this._idx(v-1,v-1)]}const S=h==="terrarium"?Ppe:Cpe;for(let A=0;A<x.length;++A){const N=4*A;this.floatView[A]=S(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=gl.now()}_buildQuadTree(){this._tree=new z8(this)}get(i,l,h=!1){h&&(i=Pe(i,-1,this.dim),l=Pe(l,-1,this.dim));const m=this._idx(i,l);return this.floatView[m]}set(i,l,h){const m=this._idx(i,l),v=this.floatView[m];return this.floatView[m]=h,h-v}static getUnpackVector(i){return Ape[i]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}static pack(i,l){const h=[0,0,0,0],m=LA.getUnpackVector(l);let v=Math.floor((i+m[3])/m[2]);return h[2]=v%256,v=Math.floor(v/256),h[1]=v%256,v=Math.floor(v/256),h[0]=v,h}getPixels(){return new TV({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,v=l*this.dim+this.dim,x=h*this.dim,S=h*this.dim+this.dim;switch(l){case-1:m=v-1;break;case 1:v=m+1}switch(h){case-1:x=S-1;break;case 1:S=x+1}const A=-l*this.dim,N=-h*this.dim;for(let M=x;M<S;M++)for(let L=m;L<v;L++){const z=4*this._idx(L,M),W=4*this._idx(L+A,M+N);this.pixels[z+0]=i.pixels[W+0],this.pixels[z+1]=i.pixels[W+1],this.pixels[z+2]=i.pixels[W+2],this.pixels[z+3]=i.pixels[W+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Npe(u,i,l){u===1?i.headerLength=l.readFixed32():u===2?i.x=l.readVarint():u===3?i.y=l.readVarint():u===4?i.z=l.readVarint():u===5&&i.layers.push(function(h,m){return h.readFields(Mpe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(l,l.readVarint()+l.pos))}function Ipe(u,i,l){u===1?(i.delta_filter=function(h,m){return h.readFields(kpe,{blockSize:0},m)}(l,l.readVarint()+l.pos),i.filter="delta_filter"):u===2?(l.readVarint(),i.filter="zigzag_filter"):u===3?(l.readVarint(),i.filter="bitshuffle_filter"):u===4&&(l.readVarint(),i.filter="byteshuffle_filter")}function kpe(u,i,l){u===1&&(i.blockSize=l.readVarint())}function Ope(u,i,l){u===1?(l.readVarint(),i.codec="gzip_data"):u===2?(l.readVarint(),i.codec="jpeg_image"):u===3?(l.readVarint(),i.codec="webp_image"):u===4&&(l.readVarint(),i.codec="png_image")}function Rpe(u,i,l){let h=0,m=0;u===1?i.firstByte=l.readFixed64():u===2?i.lastByte=l.readFixed64():u===3?i.filters.push(function(v,x){return v.readFields(Ipe,{},x)}(l,l.readVarint()+l.pos)):u===4?i.codec=function(v,x){return v.readFields(Ope,{},x)}(l,l.readVarint()+l.pos):u===5?m=l.readFloat():u===6?h=l.readFloat():u===7?i.bands.push(l.readString()):u===8?i.offset=l.readDouble():u===9&&(i.scale=l.readDouble()),i.offset===0&&(i.offset=m),i.scale===0&&(i.scale=h)}function Mpe(u,i,l){u===1?i.version=l.readVarint():u===2?i.name=l.readString():u===3?i.units=l.readString():u===4?i.tileSize=l.readVarint():u===5?i.buffer=l.readVarint():u===6?i.pixelFormat=l.readVarint():u===7&&i.dataIndex.push(function(h,m){return h.readFields(Rpe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(l,l.readVarint()+l.pos))}function Dpe(u,i,l){if(u===2)(function(h,m,v){h.readFields(Lpe,v,m)})(l,l.readVarint()+l.pos,i);else if(u===3)throw new Error("Not implemented")}function Lpe(u,i,l){if(u===1){let h=0;const m=l.readVarint()+l.pos;for(;l.pos<m;)i[h++]=l.readVarint()}}function Fpe(u,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let l=i[3];for(let h=2;h>=1;h--){const m=h===1?1:0,v=h===2?1:0;for(let x=0;x<i[0];x++){const S=i[1]*x;for(let A=m;A<i[1];A++){const N=i[2]*(A+S);for(let M=v;M<i[2];M++){const L=i[3]*(M+N);for(let z=0;z<i[3];z++){const W=L+z;u[W]+=u[W-l]}}}}l*=i[h]}return u}function zpe(u){for(let i=0,l=u.length;i<l;i++)u[i]=u[i]>>>1^-(1&u[i]);return u}function Bpe(u,i){switch(i){case"uint32":return u;case"uint16":for(let l=0;l<u.length;l+=2){const h=u[l],m=u[l+1];u[l]=(240&h)>>4|(61440&h)>>8|(240&m)<<4|61440&m,u[l+1]=15&h|(3840&h)>>4|(15&m)<<8|(3840&m)<<4}return u;case"uint8":for(let l=0;l<u.length;l+=4){const h=u[l],m=u[l+1],v=u[l+2],x=u[l+3];u[l+0]=(192&h)>>6|(192&m)>>4|(192&v)>>2|192&x,u[l+1]=(48&h)>>4|(48&m)>>2|48&v|(48&x)<<2,u[l+2]=(12&h)>>2|12&m|(12&v)<<2|(12&x)<<4,u[l+3]=3&h|(3&m)<<2|(3&v)<<4|(3&x)<<6}return u;default:throw new Error(`Invalid pixel format, "${i}"`)}}ir(LA,"DEMData"),ir(z8,"DemMinMaxQuadTree",{omit:["dem"]});var _c=Uint8Array,B1=Uint16Array,$pe=Int32Array,$8=new _c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),V8=new _c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vpe=new _c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),U8=function(u,i){for(var l=new B1(31),h=0;h<31;++h)l[h]=i+=1<<u[h-1];var m=new $pe(l[30]);for(h=1;h<30;++h)for(var v=l[h];v<l[h+1];++v)m[v]=v-l[h]<<5|h;return{b:l,r:m}},q8=U8($8,2),G8=q8.b,Upe=q8.r;G8[28]=258,Upe[258]=28;for(var qpe=U8(V8,0).b,W8=new B1(32768),Ns=0;Ns<32768;++Ns){var H_=(43690&Ns)>>1|(21845&Ns)<<1;W8[Ns]=((65280&(H_=(61680&(H_=(52428&H_)>>2|(13107&H_)<<2))>>4|(3855&H_)<<4))>>8|(255&H_)<<8)>>1}var $1=function(u,i,l){for(var h=u.length,m=0,v=new B1(i);m<h;++m)u[m]&&++v[u[m]-1];var x,S=new B1(i);for(m=1;m<i;++m)S[m]=S[m-1]+v[m-1]<<1;x=new B1(1<<i);var A=15-i;for(m=0;m<h;++m)if(u[m])for(var N=m<<4|u[m],M=i-u[m],L=S[u[m]-1]++<<M,z=L|(1<<M)-1;L<=z;++L)x[W8[L]>>A]=N;return x},V1=new _c(288);for(Ns=0;Ns<144;++Ns)V1[Ns]=8;for(Ns=144;Ns<256;++Ns)V1[Ns]=9;for(Ns=256;Ns<280;++Ns)V1[Ns]=7;for(Ns=280;Ns<288;++Ns)V1[Ns]=8;var H8=new _c(32);for(Ns=0;Ns<32;++Ns)H8[Ns]=5;var Gpe=$1(V1,9),Wpe=$1(H8,5),lM=function(u){for(var i=u[0],l=1;l<u.length;++l)u[l]>i&&(i=u[l]);return i},Gu=function(u,i,l){var h=i/8|0;return(u[h]|u[h+1]<<8)>>(7&i)&l},cM=function(u,i){var l=i/8|0;return(u[l]|u[l+1]<<8|u[l+2]<<16)>>(7&i)},Hpe=function(u){return(u+7)/8|0},Zpe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wu=function(u,i,l){var h=new Error(i||Zpe[u]);if(h.code=u,Error.captureStackTrace&&Error.captureStackTrace(h,Wu),!l)throw h;return h},Xpe=new _c(0),Kpe=typeof TextDecoder<"u"&&new TextDecoder;try{Kpe.decode(Xpe,{stream:!0})}catch{}const Ype={gzip_data:"gzip"};class au extends Error{constructor(i){super(i),this.name="MRTError"}}const Jpe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Z8={uint32:1,uint16:2,uint8:4},Qpe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let uM;class FA{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const l=this.layers[i];if(!l)throw new au(`Layer '${i}' not found`);return l}getHeaderLength(i){const l=new Uint8Array(i),h=new DataView(i);if(l[0]!==13)throw new au("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(i){const l=new Uint8Array(i),h=this.getHeaderLength(i);if(l.length<h)throw new au(`Expected header with length >= ${h} but got buffer of length ${l.length}`);const m=new uM(l.subarray(0,h)).readFields(Npe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new au(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const v of m.layers)this.layers[v.name]=new X8(v,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const l=[],h=this.getLayer(i.layerName);for(let m of i.blockIndices){const v=h.dataIndex[m],x=v.firstByte-i.firstByte,S=v.lastByte-i.firstByte;if(h._blocksInProgress.has(m))continue;const A={layerName:h.name,firstByte:x,lastByte:S,pixelFormat:h.pixelFormat,blockIndex:m,blockShape:[v.bands.length].concat(h.bandShape),buffer:h.buffer,codec:v.codec.codec,filters:v.filters.map(N=>N.filter)};h._blocksInProgress.add(m),l.push(A)}return new K8(l,()=>{l.forEach(m=>h._blocksInProgress.delete(m.blockIndex))},(m,v)=>{if(l.forEach(x=>h._blocksInProgress.delete(x.blockIndex)),m)throw m;v.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class X8{constructor({version:i,name:l,units:h,tileSize:m,pixelFormat:v,buffer:x,dataIndex:S},A){if(this.version=i,this.version!==1)throw new au(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=l,this.units=h,this.tileSize=m,this.buffer=x,this.pixelFormat=Jpe[v],this.dataIndex=S,this.bandShape=[m+2*x,m+2*x,Z8[this.pixelFormat]],this._decodedBlocks=new DA(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Z8[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const l=i.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,i.data)}getBlockForBand(i){let l=0;switch(typeof i){case"string":for(const[h,m]of this.dataIndex.entries()){for(const[v,x]of m.bands.entries())if(x===i)return{bandIndex:l+v,blockIndex:h,blockBandIndex:v};l+=m.bands.length}break;case"number":for(const[h,m]of this.dataIndex.entries()){if(i>=l&&i<l+m.bands.length)return{bandIndex:i,blockIndex:h,blockBandIndex:i-l};l+=m.bands.length}break;default:throw new au(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let l=1/0,h=-1/0;const m=[],v=new Set;for(const x of i){const{blockIndex:S}=this.getBlockForBand(x);if(S<0)throw new au(`Invalid band: ${JSON.stringify(x)}`);const A=this.dataIndex[S];m.includes(S)||m.push(S),v.add(S),l=Math.min(l,A.firstByte),h=Math.max(h,A.lastByte)}if(v.size>this.cacheSize)throw new au(`Number of blocks to decode (${v.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:h,blockIndices:m}}hasBand(i){const{blockIndex:l}=this.getBlockForBand(i);return l>=0}hasDataForBand(i){const{blockIndex:l}=this.getBlockForBand(i);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(i){const{blockIndex:l,blockBandIndex:h}=this.getBlockForBand(i);if(l<0)throw new au(`Band not found: ${JSON.stringify(i)}`);const m=this._decodedBlocks.get(l.toString());if(!m)throw new au(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const v=this.dataIndex[l],x=this.bandShape.reduce((N,M)=>N*M,1),S=h*x,A=m.subarray(S,S+x);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:v.offset,scale:v.scale}}}FA.setPbf=function(u){uM=u};class K8{constructor(i,l,h){this.tasks=i,this._onCancel=l,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,l){this._finalized||(this._onComplete(i,l),this._finalized=!0)}}FA.performDecoding=function(u,i){const l=new Uint8Array(u);return Promise.all(i.tasks.map(h=>{const{layerName:m,firstByte:v,lastByte:x,pixelFormat:S,blockShape:A,blockIndex:N,filters:M,codec:L}=h,z=l.subarray(v,x+1),W=new Uint32Array(A[0]*A[1]*A[2]);let H;if(L!=="gzip_data")throw new au(`Unhandled codec: ${L}`);return H=function(Q,ne){if(!globalThis.DecompressionStream&&ne==="gzip_data")return Promise.resolve((Se=function(Oe){Oe[0]==31&&Oe[1]==139&&Oe[2]==8||Wu(6,"invalid gzip data");var Ne=Oe[3],Fe=10;4&Ne&&(Fe+=2+(Oe[10]|Oe[11]<<8));for(var qe=(Ne>>3&1)+(Ne>>4&1);qe>0;qe-=!Oe[Fe++]);return Fe+(2&Ne)}(te=Q),Se+8>te.length&&Wu(6,"invalid gzip data"),function(Oe,Ne,Fe,qe){var ht=Oe.length;if(!ht||Ne.f&&!Ne.l)return Fe||new _c(0);var at=!Fe,ut=at||Ne.i!=2,bt=Ne.i;at&&(Fe=new _c(3*ht));var _t=function(mo){var Jd=Fe.length;if(mo>Jd){var qa=new _c(Math.max(2*Jd,mo));qa.set(Fe),Fe=qa}},xt=Ne.f||0,rt=Ne.p||0,Tt=Ne.b||0,mt=Ne.l,jt=Ne.d,wt=Ne.m,Qt=Ne.n,er=8*ht;do{if(!mt){xt=Gu(Oe,rt,1);var qt=Gu(Oe,rt+1,3);if(rt+=3,!qt){var Ht=Oe[(wn=Hpe(rt)+4)-4]|Oe[wn-3]<<8,xr=wn+Ht;if(xr>ht){bt&&Wu(0);break}ut&&_t(Tt+Ht),Fe.set(Oe.subarray(wn,xr),Tt),Ne.b=Tt+=Ht,Ne.p=rt=8*xr,Ne.f=xt;continue}if(qt==1)mt=Gpe,jt=Wpe,wt=9,Qt=5;else if(qt==2){var cr=Gu(Oe,rt,31)+257,Yt=Gu(Oe,rt+10,15)+4,kr=cr+Gu(Oe,rt+5,31)+1;rt+=14;for(var nn=new _c(kr),En=new _c(19),en=0;en<Yt;++en)En[Vpe[en]]=Gu(Oe,rt+3*en,7);rt+=3*Yt;var Hn=lM(En),yn=(1<<Hn)-1,Xi=$1(En,Hn);for(en=0;en<kr;){var wn,Vn=Xi[Gu(Oe,rt,yn)];if(rt+=15&Vn,(wn=Vn>>4)<16)nn[en++]=wn;else{var yi=0,Ai=0;for(wn==16?(Ai=3+Gu(Oe,rt,3),rt+=2,yi=nn[en-1]):wn==17?(Ai=3+Gu(Oe,rt,7),rt+=3):wn==18&&(Ai=11+Gu(Oe,rt,127),rt+=7);Ai--;)nn[en++]=yi}}var Ci=nn.subarray(0,cr),Ki=nn.subarray(cr);wt=lM(Ci),Qt=lM(Ki),mt=$1(Ci,wt),jt=$1(Ki,Qt)}else Wu(1);if(rt>er){bt&&Wu(0);break}}ut&&_t(Tt+131072);for(var oa=(1<<wt)-1,Ca=(1<<Qt)-1,_s=rt;;_s=rt){var Is=(yi=mt[cM(Oe,rt)&oa])>>4;if((rt+=15&yi)>er){bt&&Wu(0);break}if(yi||Wu(2),Is<256)Fe[Tt++]=Is;else{if(Is==256){_s=rt,mt=null;break}var Us=Is-254;Is>264&&(Us=Gu(Oe,rt,(1<<(Li=$8[en=Is-257]))-1)+G8[en],rt+=Li);var Zr=jt[cM(Oe,rt)&Ca],Pi=Zr>>4;if(Zr||Wu(3),rt+=15&Zr,Ki=qpe[Pi],Pi>3){var Li=V8[Pi];Ki+=cM(Oe,rt)&(1<<Li)-1,rt+=Li}if(rt>er){bt&&Wu(0);break}ut&&_t(Tt+131072);var Cl=Tt+Us;if(Tt<Ki){var po=0-Ki,la=Math.min(Ki,Cl);for(po+Tt<0&&Wu(3);Tt<la;++Tt)Fe[Tt]=qe[po+Tt]}for(;Tt<Cl;++Tt)Fe[Tt]=Fe[Tt-Ki]}}Ne.l=mt,Ne.p=_s,Ne.b=Tt,Ne.f=xt,mt&&(xt=1,Ne.m=wt,Ne.d=jt,Ne.n=Qt)}while(!xt);return Tt!=Fe.length&&at?function(mo,Jd,qa){return(qa==null||qa>mo.length)&&(qa=mo.length),new _c(mo.subarray(0,qa))}(Fe,0,Tt):Fe.subarray(0,Tt)}(te.subarray(Se,-8),{i:2},new _c(((de=te)[(pe=de.length)-4]|de[pe-3]<<8|de[pe-2]<<16|de[pe-1]<<24)>>>0),le)));var te,le,de,pe,Se;const we=Ype[ne];if(!we)throw new Error(`Unhandled codec: ${ne}`);const Ie=new globalThis.DecompressionStream(we);return new Response(new Blob([Q]).stream().pipeThrough(Ie)).arrayBuffer().then(Oe=>new Uint8Array(Oe))}(z,L).then(Q=>(function(ne,te){ne.readFields(Dpe,te)}(new uM(Q),W),new Qpe[S](W.buffer))),H.then(Q=>{for(let ne=M.length-1;ne>=0;ne--)switch(M[ne]){case"delta_filter":Fpe(Q,A);break;case"zigzag_filter":zpe(Q);break;case"bitshuffle_filter":Bpe(Q,S);break;default:throw new au(`Unhandled filter "${M[ne]}"`)}return{layerName:m,blockIndex:N,data:Q}}).catch(Q=>{throw Q})}))},ir(K8,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ir(FA,"MapboxRasterTile"),ir(X8,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Y8{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class J8{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Zh(Wt,16,0),this.featureIndexArray=new Vg,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,l,h,m,v,x=0,S=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,v,x);const N=this.grid;for(let M=0;M<l.length;M++){const L=l[M],z=[1/0,1/0,-1/0,-1/0];for(let W=0;W<L.length;W++){const H=L[W];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}S!==0&&(z[0]-=S,z[1]-=S,z[2]+=S,z[3]+=S),z[0]<Wt&&z[1]<Wt&&z[2]>=0&&z[3]>=0&&N.insert(A,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ln(new mA(this.rawTileData)).layers,this.sourceLayerCoder=new Y8(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,l){const{tilespaceGeometry:h,transform:m,tileTransform:v,pixelPosMatrix:x,availableImages:S,worldview:A}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const N=l.queryRadius?l.queryRadius:0,M=h.bufferedTilespaceBounds,L=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(Q,ne,te,le)=>iu(h.bufferedTilespaceGeometry,Q-N,ne-N,te+N,le+N));L.sort(eme);let z=null;m.elevation&&L.length>0&&(z=q_.create(m.elevation,this.tileID));const W={};let H;for(let Q=0;Q<L.length;Q++){const ne=L[Q];if(ne===H)continue;H=ne;const te=this.featureIndexArray.get(ne);let le=null;this.is3DTile?this.loadMatchingModelFeature(W,te,i,h,m,A):this.loadMatchingFeature(W,te,i,S,A,(de,pe,Se,we=0)=>(le||(le=Cr(de,this.tileID.canonical,v)),pe.queryIntersectsFeature(h,de,Se,le,this.z,m,x,z,we,l.scope)))}return W}loadMatchingFeature(i,l,h,m,v,x){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:N,layoutVertexArrayOffset:M}=l,L=this.bucketLayerIDs[A],z=h.layers,W=Object.keys(z);if(W.length&&!Qr(W,L))return;const H=h.sourceCache,Q=this.sourceLayerCoder.decode(N),ne=this.vtLayers[Q].feature(S),te=this.getId(ne,Q);for(let le=0;le<L.length;le++){const de=L[le];if(!z[de])continue;const{styleLayer:pe,targets:Se}=z[de];let we={};te!==void 0&&(we=H.getFeatureState(pe.sourceLayer,te));const Ie=!x||x(ne,pe,we,M);if(!Ie)continue;const Oe=new ry(ne,this.z,this.x,this.y,te);Oe.tile=this.tileID.canonical,Oe.state=we;let Ne=this.serializedLayersCache.get(de);Ne||(Ne=pe.serialize(),Ne.id=de,this.serializedLayersCache.set(de,Ne)),Oe.source=Ne.source,Oe.sourceLayer=Ne["source-layer"],Oe.layer=Object.assign({},Ne),Oe.layer.paint=Q8(Ne.paint,pe.paint,ne,we,m),Oe.layer.layout=Q8(Ne.layout,pe.layout,ne,we,m);let Fe=!1;for(const qe of Se){this.updateFeatureProperties(Oe,qe);const{filter:ht}=qe;if(ht){if(ne.properties=Oe.properties,ht.needGeometry){const at=Gr(ne,!0);if(!ht.filter(new Wn(this.tileID.overscaledZ,{worldview:v}),at,this.tileID.canonical))continue}else if(!ht.filter(new Wn(this.tileID.overscaledZ,{worldview:v}),ne))continue}Fe=!0,qe.targetId&&this.addFeatureVariant(Oe,qe)}Fe&&this.appendToResult(i,de,S,Oe,Ie)}}loadMatchingModelFeature(i,l,h,m,v,x){const{featureIndex:S,bucketIndex:A}=l,N=this.bucketLayerIDs[A],M=h.layers,L=Object.keys(M);if(!L.length||Qr(L,N))for(let z=0;z<N.length;z++){const W=N[z],{styleLayer:H,targets:Q}=M[W];if(H.type!=="model")continue;const ne=m.tile,te=ne.getBucket(H);if(!(te&&te instanceof kA))continue;const le=ope(te,S,m,v);if(!le)continue;const{z:de,x:pe,y:Se}=ne.tileID.canonical,{feature:we,intersectionZ:Ie,position:Oe}=le;let Ne={};we.id!==void 0&&(Ne=h.sourceCache.getFeatureState(H.sourceLayer,we.id));const Fe=new ry({},de,pe,Se,we.id);Fe.tile=this.tileID.canonical,Fe.state=Ne,Fe.properties=we.properties,Fe.geometry={type:"Point",coordinates:[Oe.lng,Oe.lat]};let qe=this.serializedLayersCache.get(W);qe||(qe=H.serialize(),qe.id=W,this.serializedLayersCache.set(W,qe)),Fe.source=qe.source,Fe.sourceLayer=qe["source-layer"],Fe.layer=Object.assign({},qe);let ht=!1;for(const at of Q){this.updateFeatureProperties(Fe,at);const{filter:ut}=at;if(ut){if(we.properties=Fe.properties,ut.needGeometry){if(!ut.filter(new Wn(this.tileID.overscaledZ,{worldview:x}),we,this.tileID.canonical))continue}else if(!ut.filter(new Wn(this.tileID.overscaledZ,{worldview:x}),we))continue}ht=!0,at.targetId&&this.addFeatureVariant(Fe,at)}ht&&this.appendToResult(i,W,S,Fe,Ie)}}updateFeatureProperties(i,l,h){if(l.properties){const m={};for(const v in l.properties){const x=l.properties[v].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,h);x!=null&&(m[v]=x)}i.properties=m}}addFeatureVariant(i,l,h){const m={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(m.properties=i.properties),i.variants=i.variants||{},i.variants[l.targetId]=i.variants[l.targetId]||[],i.variants[l.targetId].push(m)}appendToResult(i,l,h,m,v){let x=i[l];x===void 0&&(x=i[l]=[]),x.push({featureIndex:h,feature:m,intersectionZ:v})}lookupSymbolFeatures(i,l,h,m,v,x){const S={};this.loadVTLayers();for(const A of i)this.loadMatchingFeature(S,{bucketIndex:l,sourceLayerIndex:h,featureIndex:A,layoutVertexArrayOffset:0},m,v,x);return S}loadFeature(i){const{featureIndex:l,sourceLayerIndex:h}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(h),v=this.vtFeatures[m];if(v[l])return v[l];const x=this.vtLayers[m].feature(l);return v[l]=x,x}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const v=$d(m);if(v.result!=="success"){const x=v.value.map(S=>`${S.key}: ${S.message}`).join(", ");return void Nr(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=v.value}h=this.promoteIdExpression.evaluate({zoom:0},i)}else h=i.properties[m];typeof h=="boolean"&&(h=Number(h))}return h}}function Q8(u,i,l,h,m){return _r(u,(v,x)=>{const S=i instanceof lo?i.get(x):null;return S&&S.evaluate?S.evaluate(l,h,void 0,m):S})}function eme(u,i){return i-u}ir(J8,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const eq=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dM{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=h>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=eq[15&h];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[S]=new Uint32Array(i,4,1);return new dM(S,x,v,i)}constructor(i,l=64,h=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=eq.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,S=i*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-S%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+S+A),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+S+A,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=l,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return hM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:S}=this,A=[0,v.length-1,0],N=[];for(;A.length;){const M=A.pop()||0,L=A.pop()||0,z=A.pop()||0;if(L-z<=S){for(let ne=z;ne<=L;ne++){const te=x[2*ne],le=x[2*ne+1];te>=i&&te<=h&&le>=l&&le<=m&&N.push(v[ne])}continue}const W=z+L>>1,H=x[2*W],Q=x[2*W+1];H>=i&&H<=h&&Q>=l&&Q<=m&&N.push(v[W]),(M===0?i<=H:l<=Q)&&(A.push(z),A.push(W-1),A.push(1-M)),(M===0?h>=H:m>=Q)&&(A.push(W+1),A.push(L),A.push(1-M))}return N}within(i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,S=[0,m.length-1,0],A=[],N=h*h;for(;S.length;){const M=S.pop()||0,L=S.pop()||0,z=S.pop()||0;if(L-z<=x){for(let ne=z;ne<=L;ne++)rq(v[2*ne],v[2*ne+1],i,l)<=N&&A.push(m[ne]);continue}const W=z+L>>1,H=v[2*W],Q=v[2*W+1];rq(H,Q,i,l)<=N&&A.push(m[W]),(M===0?i-h<=H:l-h<=Q)&&(S.push(z),S.push(W-1),S.push(1-M)),(M===0?i+h>=H:l+h>=Q)&&(S.push(W+1),S.push(L),S.push(1-M))}return A}}function hM(u,i,l,h,m,v){if(m-h<=l)return;const x=h+m>>1;tq(u,i,x,h,m,v),hM(u,i,l,h,x-1,1-v),hM(u,i,l,x+1,m,1-v)}function tq(u,i,l,h,m,v){for(;m>h;){if(m-h>600){const N=m-h+1,M=l-h+1,L=Math.log(N),z=.5*Math.exp(2*L/3),W=.5*Math.sqrt(L*z*(N-z)/N)*(M-N/2<0?-1:1);tq(u,i,l,Math.max(h,Math.floor(l-M*z/N+W)),Math.min(m,Math.floor(l+(N-M)*z/N+W)),v)}const x=i[2*l+v];let S=h,A=m;for(U1(u,i,h,l),i[2*m+v]>x&&U1(u,i,h,m);S<A;){for(U1(u,i,S,A),S++,A--;i[2*S+v]<x;)S++;for(;i[2*A+v]>x;)A--}i[2*h+v]===x?U1(u,i,h,A):(A++,U1(u,i,A,m)),A<=l&&(h=A+1),l<=A&&(m=A-1)}}function U1(u,i,l,h){fM(u,l,h),fM(i,2*l,2*h),fM(i,2*l+1,2*h+1)}function fM(u,i,l){const h=u[i];u[i]=u[l],u[l]=h}function rq(u,i,l,h){const m=u-l,v=i-h;return m*m+v*v}s.$=qb,s.A=jo,s.B=Kh,s.C=2,s.D=k_,s.E=Du,s.F=j1,s.G=EU,s.H=zv,s.I=To,s.J=yj,s.K=Ir,s.L=Ar,s.M=xw,s.N=a_,s.O=YE,s.P=kt,s.Q=Cg,s.R=So,s.S=y_,s.T=wR,s.U=$d,s.V=IA,s.W=c_,s.X=op,s.Y=ap,s.Z=bg,s._=Co,s.a=function(u){return As.API_CDN_URL_REGEX.test(u)},s.a$=At,s.a0=mg,s.a1=EE,s.a2=Fw,s.a3=class extends IA{},s.a4=o_,s.a5=_w,s.a6=Qe,s.a7=function(u){const i=u.value;return i?mg(i)?eM(i,!0)?[]:[new IA(u.key,i,`invalid url "${i}"`)]:[new IA(u.key,i,`string expected, "${Ir(i)}" found`)]:[]},s.a8=yp,s.a9=Mi,s.aA=Pe,s.aB=V,s.aC=hr,s.aD=oe,s.aE=Ko,s.aF=Ye,s.aG=$t,s.aH=function(u,i){const l={};for(let h=0;h<i.length;h++){const m=i[h];m in u&&(l[m]=u[m])}return l},s.aI=$e,s.aJ=it,s.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,i,l,h){const m=this.entries[u]=this.entries[u]||{callbacks:[]};if(m.result){const[v,x]=m.result;return this.scheduler?this.scheduler.add(()=>{h(v,x)},i):h(v,x),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=l((v,x)=>{m.result=[v,x];for(const S of m.callbacks)this.scheduler?this.scheduler.add(()=>{S(v,x)},i):S(v,x);setTimeout(()=>delete this.entries[u],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(v=>v!==h),m.callbacks.length||(m.cancel(),delete this.entries[u]))}}},s.aL=function(u,i,l){const h=JSON.stringify(u.request);return u.data&&(this.deduped.entries[h]={result:[null,u.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},m=>{const v=cg(u.request,(x,S,A)=>{x?m(x):S&&m(null,{rawData:S,vectorTile:l?void 0:new Ln(new mA(S)),responseHeaders:new Map(A.entries())})});return()=>{v.cancel(),m()}},i)},s.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=og,s.aO=function(u){Zc++,Zc>Db&&(u.getActor().send("enforceCacheSizeLimit",_E),Zc=0)},s.aP=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},s.aQ=fo,s.aR=i8,s.aS=u8,s.aT=Te,s.aU=n8,s.aV=function(u,i){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<u.length;h++){const m=document.createElement("source");dO(u[h])||(l.crossOrigin="Anonymous"),m.src=u[h],l.appendChild(m)}return{cancel:()=>{}}},s.aW=b1,s.aX=ny,s.aY=tr,s.aZ=P1,s.a_=vt,s.aa=Lt,s.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,i){return Wi(u.expression.evaluate(i))}interpolate(u,i,l){return{x:jr(u.x,i.x,l),y:jr(u.y,i.y,l),z:jr(u.z,i.z,l),azimuthal:jr(u.azimuthal,i.azimuthal,l),polar:jr(u.polar,i.polar,l)}}},s.ac=Wn,s.ad=Hh,s.ae=Zt,s.af=pr,s.ag=ze,s.ah=He,s.ai=lo,s.aj=Ap,s.ak=jr,s.al=Wt,s.am=Bb,s.an=_n,s.ao=Dn,s.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,i){return function([l,h]){const m=Wi([1,l,h]);return{x:m.x,y:m.y,z:m.z}}(u.expression.evaluate(i))}interpolate(u,i,l){return{x:jr(u.x,i.x,l),y:jr(u.y,i.y,l),z:jr(u.z,i.z,l)}}},s.aq=function(u,i,l=0,h=!0){const m=new kt(l,l),v=u.sub(m),x=i.add(m),S=[v,new kt(x.x,v.y),x,new kt(v.x,x.y)];return h&&S.push(v.clone()),S},s.ar=function(u,i){const l=[];for(let h=0;h<u.length;h++){const m=nt(h-1,-1,u.length-1),v=nt(h+1,-1,u.length-1),x=u[h],S=u[v],A=u[m].sub(x).unit(),N=S.sub(x).unit(),M=N.angleWithSep(A.x,A.y),L=A.add(N).unit().mult(-1*i/Math.sin(M/2));l.push(x.add(L))}return l},s.as=VU,s.at=iu,s.au=function(u,i,l=0){return Me(((i.x-l)*u.scale-u.x)*Wt,(i.y*u.scale-u.y)*Wt,et(i.z,i.y))},s.av=zn,s.aw=Ot,s.ax=si,s.ay=eU,s.az=function(u){let i=1/0,l=1/0,h=-1/0,m=-1/0;for(const v of u)i=Math.min(i,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),m=Math.max(m,v.y);return{min:new kt(i,l),max:new kt(h,m)}},s.b=function(u){return As.API_FONTS_REGEX.test(u)},s.b$=KV,s.b0=Ps,s.b1=Vu,s.b2=Rt,s.b3=jj,s.b4=AA,s.b5=function(){yc.isLoading()||yc.isLoaded()||Mw()!=="deferred"||Dw()},s.b6=zw,s.b7=Gr,s.b8=ry,s.b9=xi,s.bA=D,s.bB=ae,s.bC=B,s.bD=function(u,i){const{x:l,y:h}=u.point,m=dV(l,h,u.worldSize/u._pixelsPerMercatorPixel,0,0);return V(m,m,qO(Xd(i)))},s.bE=T,s.bF=Jn,s.bG=Pt,s.bH=Bt,s.bI=ur,s.bJ=nr,s.bK=z_,s.bL=Al,s.bM=zR,s.bN=function(u,i,l,h,m){const v=5*i+2;u.float32[v+0]=l,u.float32[v+1]=h,u.float32[v+2]=m},s.bO=U_,s.bP=ga,s.bQ=pc,s.bR=ml,s.bS=mi,s.bT=nt,s.bU=function(u,i,l,h){var m=new b(4);return m[0]=u,m[1]=i,m[2]=l,m[3]=h,m},s.bV=class{isDataAvailableAtPoint(u){const i=this._source();if(this.isUsingMockSource()||!i||u.y<0||u.y>1)return!1;const l=i.getSource().maxzoom,h=1<<l,m=Math.floor(u.x),v=Math.floor((u.x-m)*h),x=Math.floor(u.y*h),S=this.findDEMTileFor(new fo(l,m,l,v,x));return!(!S||!S.dem)}getAtPointOrZero(u,i=0){return this.getAtPoint(u,i)||0}getAtPoint(u,i,l=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const h=this._source();if(!h||u.y<0||u.y>1)return i;const m=h.getSource().maxzoom,v=1<<m,x=Math.floor(u.x),S=u.x-x,A=new fo(m,x,m,Math.floor(S*v),Math.floor(u.y*v)),N=this.findDEMTileFor(A);if(!N||!N.dem)return i;const M=N.dem,L=1<<N.tileID.canonical.z,z=(S*L-N.tileID.canonical.x)*M.dim,W=(u.y*L-N.tileID.canonical.y)*M.dim,H=Math.floor(z),Q=Math.floor(W);return(l?this.exaggeration():1)*jr(jr(M.get(H,Q),M.get(H,Q+1),W-Q),jr(M.get(H+1,Q),M.get(H+1,Q+1),W-Q),z-H)}static getAtTileOffset(u,i,l,h){const m=1<<u.canonical.z;return h?h.pointElevation(i):l?l.getAtPointOrZero(new Zt(u.wrap+(u.canonical.x+i.x/Wt)/m,(u.canonical.y+i.y/Wt)/m)):0}static getAtTileOffsetFunc(u,i,l,h){return(m,v,x)=>{const S=this.getAtTileOffset(u,m,v,x),A=h.upVector(u.canonical,m.x,m.y);return Je(A,A,S*h.upVectorScale(u.canonical,i,l).metersToTile),A}}getForTilePoints(u,i,l,h){if(this.isUsingMockSource())return!1;const m=q_.create(this,u,h);return!!m&&(i.forEach(v=>{v[2]=this.exaggeration()*m.getElevationAt(v[0],v[1],l)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(u);if(!i||!i.dem)return null;const l=i.dem.tree,h=i.tileID,m=1<<u.canonical.z-h.canonical.z;let v=u.canonical.x/m-h.canonical.x,x=u.canonical.y/m-h.canonical.y,S=0;for(let A=0;A<u.canonical.z-h.canonical.z&&!l.leaves[S];A++){v*=2,x*=2;const N=2*Math.floor(x)+Math.floor(v);S=l.childOffsets[S]+N,v%=1,x%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let i=!1,l=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const m of u){const v=this.getMinMaxForTile(m.tileID);v&&(l=Math.min(l,v.min),h=Math.max(h,v.max),i=!0)}return i?{min:l,max:h}:null}},s.bW=iA,s.bX=ji,s.bY=Xs,s.bZ=WV,s.b_=d8,s.ba=IR,s.bb=oR,s.bc=Cr,s.bd=Hd,s.be=zg,s.bf=sV,s.bg=bi,s.bh=C_,s.bi=JR,s.bj=function(u,i){const l=Ap(i.zoom);if(l===0)return Xd(u);const h=qj(u),m=UO(h),v=Ye(h.getWest())*i.worldSize,x=Ye(h.getEast())*i.worldSize,S=it(h.getNorth())*i.worldSize,A=it(h.getSouth())*i.worldSize,N=[v,S,0],M=[x,S,0],L=[v,A,0],z=[x,A,0],W=G([],i.globeMatrix);return pr(N,N,W),pr(M,M,W),pr(L,L,W),pr(z,z,W),m[0]=ef(m[0],L,l),m[1]=ef(m[1],z,l),m[2]=ef(m[2],M,l),m[3]=ef(m[3],N,l),Pn.fromPoints(m)},s.bk=Wj,s.bl=G,s.bm=n1,s.bn=ef,s.bo=$u,s.bp=hde,s.bq=ie,s.br=$,s.bs=FA,s.bt=mA,s.bu=cg,s.bv=function(u,i){const l=[];for(const h in u)h in i||l.push(h);return l},s.bw=Xe,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=Ba,s.bz=R,s.c=$a,s.c$=function(u,i,l){let h=0;for(let m=0;m<2;++m)u[m]>0&&(h+=(u[m]-0)*(u[m]-0)),i[m]<0&&(h+=(0-i[m])*(0-i[m]));return h},s.c0=YV,s.c1=DR,s.c2=OU,s.c3=qR,s.c4=dM,s.c5=Je,s.c6=lt,s.c7=Mn,s.c8=function(u,i,l){l*=.5;var h=i[0],m=i[1],v=i[2],x=i[3],S=Math.sin(l),A=Math.cos(l);return u[0]=h*A+m*S,u[1]=m*A-h*S,u[2]=v*A+x*S,u[3]=x*A-v*S,u},s.c9=oi,s.cA=Ce,s.cB=Hs,s.cC=z6,s.cD=Hg,s.cE=lV,s.cF=function(u,i,l,h,m,v,x,S,A){if(A.name==="globe")return lV(u,i,new Hg(l,h,m),!1);const N=P1({z:l,x:h,y:m},A);return new Pn([(v+N.x/N.scale)*i,i*(N.y/N.scale),x],[(v+N.x2/N.scale)*i,i*(N.y2/N.scale),S])},s.cG=function(u,i,l){return u[0]=Math.min(i[0],l[0]),u[1]=Math.min(i[1],l[1]),u[2]=Math.min(i[2],l[2]),u[3]=Math.min(i[3],l[3]),u},s.cH=function(u,i,l){return u[0]=Math.max(i[0],l[0]),u[1]=Math.max(i[1],l[1]),u[2]=Math.max(i[2],l[2]),u[3]=Math.max(i[3],l[3]),u},s.cI=function(u){const i=Math.round((u+45+360)%360/90)%4;return ce[i]},s.cJ=Ue,s.cK=Xt,s.cL=6,s.cM=function(u){const i=D(new Float64Array(16));V(i,u.pixelMatrix,u.globeMatrix);const l=[0,_e,0],h=[0,ye,0];return pr(l,l,i),pr(h,h,i),[l[0]>0&&l[0]<=u.width&&l[1]>0&&l[1]<=u.height&&!WO(u,new Te(u.center.lat,90)),h[0]>0&&h[0]<=u.width&&h[1]>0&&h[1]<=u.height&&!WO(u,new Te(u.center.lat,-90))]},s.cN=function(u,i){const{scale:l}=u.tileTransform,h=l*Wt/(u.tileSize*Math.pow(2,i.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(m,v,x){var S=v[1],A=v[2],N=v[3],M=x[0],L=x[1];return m[0]=v[0]*M,m[1]=S*M,m[2]=A*L,m[3]=N*L,m}(new Float32Array(4),i.inverseAdjustmentMatrix,[h,h])},s.cO=cA,s.cP=ue,s.cQ=F6,s.cR=function(u){const i=F6(u,!0);return T([],[i[0],i[1],i[4],i[5]])},s.cS=K,s.cT=Di,s.cU=Y,s.cV=function(u){const{x:i,y:l}=u.point,{lng:h,lat:m}=u._center;return dV(i,l,u.worldSize,h,m)},s.cW=Ee,s.cX=Ke,s.cY=A_,s.cZ=su,s.c_=5,s.ca=Ei,s.cb=function(u,i){return u[0]=-i[0],u[1]=-i[1],u[2]=-i[2],u[3]=i[3],u},s.cc=be,s.cd=function(u,i,l,h,m){var v=1/Math.tan(i/2);if(u[0]=v/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=v,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,m!=null&&m!==1/0){var x=1/(h-m);u[10]=(m+h)*x,u[14]=2*m*h*x}else u[10]=-1,u[14]=-2*h;return u},s.ce=function(u,i,l,h,m,v,x){var S=1/(i-l),A=1/(h-m),N=1/(v-x);return u[0]=-2*S,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*A,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*N,u[11]=0,u[12]=(i+l)*S,u[13]=(m+h)*A,u[14]=(x+v)*N,u[15]=1,u},s.cf=tt,s.cg=function(u,i,l){u[4*i+0]=l[0],u[4*i+1]=l[1],u[4*i+2]=l[2],u[4*i+3]=l[3]},s.ch=wl,s.ci=Gg,s.cj=ps,s.ck=Sl,s.cl=Tp,s.cm=HU,s.cn=function(){var u=new b(4);return b!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},s.co=function(u,i,l){var h=i[0],m=i[1],v=i[2],x=i[3],S=Math.sin(l),A=Math.cos(l);return u[0]=h*A+v*S,u[1]=m*A+x*S,u[2]=h*-S+v*A,u[3]=m*-S+x*A,u},s.cp=function(u,i){return u[0]===i[0]&&u[1]===i[1]&&u[2]===i[2]&&u[3]===i[3]},s.cq=ni,s.cr=function(u){var i=u[0],l=u[1],h=u[2],m=u[3];return Math.sqrt(i*i+l*l+h*h+m*m)},s.cs=fl,s.ct=Xn,s.cu=iV,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Et,s.d=function(u){return As.API_TILEJSON_REGEX.test(u)},s.d$=class{constructor(u,i,l,h){this.context=u,this.format=h,this.size=l,this.texture=u.gl.createTexture();const[m,v,x]=this.size,{gl:S}=u;S.bindTexture(S.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in i&&i.data&&S.texImage3D(S.TEXTURE_3D,0,this.format,m,v,x,0,xR(this.format),bR(this.format),i.data)}bind(u,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_3D,this.texture),u!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,u),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,u),this.minFilter=u),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},s.d0=function(u){return u*u*u*u*u},s.d1=Ze,s.d2=45,s.d3=E_,s.d4=function(u,i,l){const h=Math.sqrt(u*u+i*i+l*l),m=h>0?Math.acos(l/h)*qo:0;let v=u!==0||i!==0?Math.atan2(-i,-u)*qo+90:0;return v<0&&(v+=360),[h,v,m]},s.d5=Me,s.d6=Wi,s.d7=Mt,s.d8=Ve,s.d9=Pn,s.dA=function(u){return u({pluginStatus:oo,pluginURL:Gd}),Rw.on("pluginStateChange",u),u},s.dB=$j,s.dC=class extends vc{constructor(u){super(u),this.current=J$}set(u,i,l){if(this.fetchUniformLocation(u,i)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},s.dD=me,s.dE=function(u,i,l){const h=Ap(l.zoom),m=u.style.map._antialias,v=u.terrain&&u.terrain.exaggeration()>0;return h===0&&!m&&!v},s.dF=function(u){const i=u.pixelsPerMeter,l=i/tt(1,u.center.lat),h=D(new Float64Array(16));return $(h,h,[u.point.x,u.point.y,0]),K(h,h,[l,l,i]),Float32Array.from(h)},s.dG=qj,s.dH=function(u){const i=80.051129;u=Pe(u,-80.051129,i)/i*90;const l=Math.pow(Math.abs(Math.sin(_n(u))),3);return Math.round(l*(xe.length-1))},s.dI=function(u,i,l,h){const m=i.getNorth(),v=i.getSouth(),x=i.getWest(),S=i.getEast(),A=1<<u.z,N=S-x,M=m-v,L=N/he,z=-M/xe[l],W=[0,L,0,z,0,0,m,x,0];if(u.z>0){const H=180/h;k(W,W,[H/N+1,0,0,0,H/M+1,0,-.5*H/L,.5*H/z,1])}return W[2]=A,W[5]=u.x,W[8]=u.y,W},s.dJ=Xd,s.dK=function(u,i,l){const h=D(new Float64Array(16)),m=(i/(1<<u)-.5)*Math.PI*2;return ee(h,l.globeMatrix,m),Float32Array.from(h)},s.dL=TV,s.dM=Uj,s.dN=function(u,i){return[Math.pow(u[0],2.2)*i,Math.pow(u[1],2.2)*i,Math.pow(u[2],2.2)*i]},s.dO=C,s.dP=function(u,i){var l=Math.sin(i),h=Math.cos(i);return u[0]=h,u[1]=l,u[2]=0,u[3]=-l,u[4]=h,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},s.dQ=Kr,s.dR=uV,s.dS=Ui,s.dT=ya,s.dU=256,s.dV=function(u,i){const l=[0,0,0];return pr(l,l,Wj(Xd(i.canonical))),pr(l,l,u),l},s.dW=u=>({u_matrix:new Tp(u),u_texsize:new Sl(u),u_pixels_to_tile_units:new o(u),u_device_pixel_ratio:new ps(u),u_width_scale:new ps(u),u_floor_width_scale:new ps(u),u_image:new wl(u),u_units_to_pixels:new Sl(u),u_tile_units_to_pixels:new ps(u),u_alpha_discard_threshold:new ps(u),u_trim_offset:new Sl(u),u_trim_fade_range:new Sl(u),u_trim_gradient_mix_range:new Sl(u),u_trim_color:new E_(u),u_zbias_factor:new ps(u),u_tile_to_meter:new ps(u),u_ground_shadow_factor:new Gg(u),u_pattern_transition:new ps(u)}),s.dX=u=>({u_matrix:new Tp(u),u_pixels_to_tile_units:new o(u),u_device_pixel_ratio:new ps(u),u_width_scale:new ps(u),u_floor_width_scale:new ps(u),u_units_to_pixels:new Sl(u),u_dash_image:new wl(u),u_gradient_image:new wl(u),u_image_height:new ps(u),u_texsize:new Sl(u),u_tile_units_to_pixels:new ps(u),u_alpha_discard_threshold:new ps(u),u_trim_offset:new Sl(u),u_trim_fade_range:new Sl(u),u_trim_gradient_mix_range:new Sl(u),u_trim_color:new E_(u),u_zbias_factor:new ps(u),u_tile_to_meter:new ps(u),u_ground_shadow_factor:new Gg(u)}),s.dY=u=>({u_camera_to_center_distance:new ps(u),u_extrude_scale:new o(u),u_device_pixel_ratio:new ps(u),u_matrix:new Tp(u),u_inv_rot_matrix:new Tp(u),u_merc_center:new Sl(u),u_tile_id:new Gg(u),u_zoom_transition:new ps(u),u_up_dir:new Gg(u),u_emissive_strength:new ps(u)}),s.dZ=x_,s.d_=dfe,s.da=We,s.db=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},s.dc=L6,s.dd=CR,s.de=V6,s.df=eM,s.dg=function(u,i){return u.readFields(cpe,{icons:[]},i)},s.dh=sA,s.di=B_,s.dj=$R,s.dk=lg,s.dl=pj,s.dm=ag,s.dn=Qf,s.dp=$r,s.dq=function(u){const i=u.indexOf(Mg);return i>=0?u.slice(0,i):u},s.dr=function(u){return u.indexOf(Mg)>=0},s.ds=function(u){const i=u.lastIndexOf(Mg);return i>=0?u.slice(i+1):""},s.dt=function(u){const i=[],l=u.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),u.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},s.du=function(u,i,l,h){return u.type==="custom"?new npe(u,i):new lpe[u.type](u,i,l,h)},s.dv=Er,s.dw=function(u){const i=u.indexOf(Mg);return i>=0?u.slice(i+1):""},s.dx=class extends ry{constructor(u,i){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},s.dy=Rw,s.dz=Ru,s.e=As,s.e$=Be,s.e0=pV,s.e1=(u,i,l,h,m,v)=>{const x=u.transform,S=x.projection.name==="globe";let A;if(v.paint.get("circle-pitch-alignment")==="map")if(S){const M=uV(x.zoom,i.canonical)*x._pixelsPerMercatorPixel;A=Float32Array.from([M,0,0,M])}else A=x.calculatePixelsToTileUnitsMatrix(l);else A=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(x.projection),u_matrix:u.translatePosMatrix(i.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:gl.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:yde,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:v.paint.get("circle-emissive-strength")};if(S){N.u_inv_rot_matrix=h,N.u_merc_center=m,N.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],N.u_zoom_transition=Ap(x.zoom);const M=m[0]*Wt,L=m[1]*Wt;N.u_up_dir=x.projection.upVector(new Hg(0,0,0),M,L)}return N},s.e2=iU,s.e3=Ao,s.e4=(u,i,l,h,m,v,x,S,A,N)=>{const M=u.transform,L=M.pitch<15?tU(.07,.7,Pe((14-M.zoom)/5,0,1)):.07,z=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:nU(u,i,l,h),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:m,u_width_scale:v,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:rU(i,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:l.lut).toArray01(),u_zbias_factor:L,u_tile_to_meter:Mt(i.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:N}},s.e5=(u,i,l,h,m,v,x,S,A,N)=>{const M=u.transform,L=M.calculatePixelsToTileUnitsMatrix(i),z=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",W=M.pitch<15?tU(.07,.7,Pe((14-M.zoom)/5,0,1)):.07;return{u_matrix:nU(u,i,l,h),u_pixels_to_tile_units:L,u_device_pixel_ratio:v,u_width_scale:x,u_floor_width_scale:S,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:sU(l)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rU(i,u.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:l.lut).toArray01(),u_zbias_factor:W,u_tile_to_meter:Mt(i.tileID.canonical,0),u_ground_shadow_factor:N}},s.e6=Nt,s.e7=i1,s.e8=et,s.e9=ude,s.eA=function(u,i){var l=2*Math.acos(i[3]),h=Math.sin(l/2);return h>_?(u[0]=i[0]/h,u[1]=i[1]/h,u[2]=i[2]/h):(u[0]=1,u[1]=0,u[2]=0),l},s.eB=nM,s.eC=hA,s.eD=dA,s.eE=[1,1,1],s.eF=q_,s.eG=Ct,s.eH=function(u,i,l,h){var m=i[0],v=i[1],x=i[2],S=i[3];return u[0]=m+h*(l[0]-m),u[1]=v+h*(l[1]-v),u[2]=x+h*(l[2]-x),u[3]=S+h*(l[3]-S),u},s.eI=D_,s.eJ=bl,s.eK=Jh,s.eL=function(u,i,l,h,m,v,x,S,A,N,M,L,z,W,H,Q){var ne=new b(16);return ne[0]=u,ne[1]=i,ne[2]=l,ne[3]=h,ne[4]=m,ne[5]=v,ne[6]=x,ne[7]=S,ne[8]=A,ne[9]=N,ne[10]=M,ne[11]=L,ne[12]=z,ne[13]=W,ne[14]=H,ne[15]=Q,ne},s.eM=Re,s.eN=Fg,s.eO=Yw,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new kt(1/0,1/0),max:new kt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,i=!1){const l=ZV(new kt(0,0),new kt(Wt,Wt),u),h=[];if(i&&!lR(l,this._globalClipBounds))return h;for(const m of this._activeRegions){if(m.hiddenByOverlap||!lR(l,m))continue;const v=Qde(m.min,m.max,u);h.push({min:v.min,max:v.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return h}setSources(u){this._setSources(u.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const l=[];for(const h of i.cache.getVisibleCoordinates()){const m=i.cache.getTile(h).buckets[i.layer];m&&m.updateFootprints(h.toUnwrapped(),l)}return l},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(u){const i=u.getFootprints();if(i.length===0)return;const l=u.getOrder(),h=u.getClipMask(),m=u.getClipScope();for(const v of i){if(!v.footprint)continue;const x=ZV(v.footprint.min,v.footprint.max,v.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:v.id,footprint:v.footprint,order:l,clipMask:h,clipScope:m})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,l)=>i.priority-l.priority||eA(i.min,l.min)||eA(i.max,l.max)||i.order-l.order||i.clipMask-l.clipMask||function(h,m){const v=(x,S)=>x+S;return h.length-m.length||h.reduce(v,"").localeCompare(m.reduce(v,""))}(i.clipScope,l.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let i=0;for(;!u&&i!==this._activeRegions.length;){const l=this._activeRegions[i],h=this._prevRegions[i];u=l.priority!==h.priority||!HV(l,h)||l.order!==h.order||l.clipMask!==h.clipMask||!Ba(l.clipScope,h.clipScope),this._activeRegions[i].hiddenByOverlap=h.hiddenByOverlap,++i}}if(u){++this._updateTime;for(const l of this._activeRegions)l.order!==h1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const i=l=>{const h=this._activeRegions;if(l>=h.length)return l;const m=h[l].priority;for(;l<h.length&&h[l].priority===m;)++l;return l};if(this._sourceIds.length>1){let l=0,h=i(l);for(;l!==h;){let m=l;const v=l;for(;m!==h;){const x=this._activeRegions[m];x.hiddenByOverlap=!1;for(let S=0;S<v;S++){const A=this._activeRegions[S];if(!A.hiddenByOverlap&&x.order===h1&&lR(x,A)&&(x.hiddenByOverlap=XV(x.footprint,x.tileId,A.footprint,A.tileId),x.hiddenByOverlap))break}++m}l=h,h=i(l)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=u.length-1;i>=0;i--)this._addSource(u[i]);this._computeReplacement()}},s.eQ=h1,s.eR=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,i){const l=new Hd,h=new Ps,m=[],v=u+1+2,x=i[0]+1,S=i[0]+1+(1+i.length),A=(N,M,L)=>{let z=N===v-1?N-2:N===0?N:N-1;return z+=L?24575:0,[z,M]};for(let N=0;N<v;++N)l.emplaceBack(...A(N,0,!0));for(let N=0;N<x;++N)for(let M=0;M<v;++M)l.emplaceBack(...A(M,N,(M===0||M===v-1)&&!0));for(let N=0;N<i.length;++N){const M=i[N];for(let L=0;L<v;++L)l.emplaceBack(...A(L,M,!0))}for(let N=0;N<i.length;++N){const M=h.length,L=i[N]+1+2,z=new Ps;for(let Q=0;Q<L-1;Q++){const ne=Q===L-2,te=ne?v*(S-i.length+N-Q):v;for(let le=0;le<v-1;le++){const de=Q*v+le;Q===0||ne||le===0||le===v-2?(z.emplaceBack(de+1,de,de+te),z.emplaceBack(de+te,de+te+1,de+1)):(h.emplaceBack(de+1,de,de+te),h.emplaceBack(de+te,de+te+1,de+1))}}const W=bi.simpleSegment(0,M,l.length,h.length-M);for(let Q=0;Q<z.uint16.length;Q+=3)h.emplaceBack(z.uint16[Q],z.uint16[Q+1],z.uint16[Q+2]);const H=bi.simpleSegment(0,M,l.length,h.length-M);m.push({withoutSkirts:W,withSkirts:H})}return{vertices:l,indices:h,segments:m}}_createGrid(u){const i=this._fillGridMeshWithLods(he,xe);this._gridSegments=i.segments,this._gridBuffer=u.createVertexBuffer(i.vertices,sV.members),this._gridIndexBuffer=u.createIndexBuffer(i.indices,!0)}_createPoles(u){const i=new Ps;for(let x=0;x<=he;x++)i.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=u.createIndexBuffer(i,!0);const l=new Yh,h=new Yh,m=new Yh,v=new Yh;this._poleSegments=[];for(let x=0,S=0;x<5;x++){const A=360/(1<<x);l.emplaceBack(0,-oe,0,.5,0),h.emplaceBack(0,-oe,0,.5,1),m.emplaceBack(0,-oe,0,.5,.5),v.emplaceBack(0,-oe,0,.5,.5);for(let N=0;N<=he;N++){let M=N/he,L=0;const z=jr(0,A,M),[W,H,Q]=Le(mde,gde,z,oe);l.emplaceBack(W,H,Q,M,L),h.emplaceBack(W,H,Q,M,1-L);const ne=_n(z);M=.5+.5*Math.sin(ne),L=.5+.5*Math.cos(ne),m.emplaceBack(W,H,Q,M,L),v.emplaceBack(W,H,Q,M,1-L)}this._poleSegments.push(bi.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(l,Vj,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(h,Vj,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(m,Vj,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(v,Vj,!1)}getGridBuffers(u,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},s.eS=Jde,s.eT=je,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=Ge,s.eW=It,s.eX=function(u,i,l){return u[0]=i[0]/l[0],u[1]=i[1]/l[1],u[2]=i[2]/l[2],u},s.eY=hs,s.eZ=ke,s.e_=Gt,s.ea=nA,s.eb=c6,s.ec=rf,s.ed=450,s.ee=7,s.ef=st,s.eg=function(u,i){if(u===i){var l=i[1],h=i[2],m=i[3],v=i[6],x=i[7],S=i[11];u[1]=i[4],u[2]=i[8],u[3]=i[12],u[4]=l,u[6]=i[9],u[7]=i[13],u[8]=h,u[9]=v,u[11]=i[14],u[12]=m,u[13]=x,u[14]=S}else u[0]=i[0],u[1]=i[4],u[2]=i[8],u[3]=i[12],u[4]=i[1],u[5]=i[5],u[6]=i[9],u[7]=i[13],u[8]=i[2],u[9]=i[6],u[10]=i[10],u[11]=i[14],u[12]=i[3],u[13]=i[7],u[14]=i[11],u[15]=i[15];return u},s.eh=rpe,s.ei=ln,s.ej=e1,s.ek=256,s.el=qO,s.em=Yl,s.en=ee,s.eo=function(u,i){return u[0]=i[0],u[1]=i[1],u[2]=i[2],u[3]=i[4],u[4]=i[5],u[5]=i[6],u[6]=i[8],u[7]=i[9],u[8]=i[10],u},s.ep=Yh,s.eq=HE,s.er=S_,s.es=function(u,i,l,h,m){return Pe((u-i)/(l-i)*(m-h)+h,h,m)},s.et=$s,s.eu=function(u,i){var l=i[0],h=i[1],m=i[2],v=i[3],x=i[4],S=i[5],A=i[6],N=i[7],M=i[8],L=M*x-S*N,z=-M*v+S*A,W=N*v-x*A,H=l*L+h*z+m*W;return H?(u[0]=L*(H=1/H),u[1]=(-M*h+m*N)*H,u[2]=(S*h-m*x)*H,u[3]=z*H,u[4]=(M*l-m*A)*H,u[5]=(-S*l+m*v)*H,u[6]=W*H,u[7]=(-N*l+h*A)*H,u[8]=(x*l-h*v)*H,u):null},s.ev=2,s.ew=Pr,s.ex=Or,s.ey=fe,s.ez=function(u,i){var l=new b(3);fe(l,i);var h=1/l[0],m=1/l[1],v=1/l[2],x=i[0]*h,S=i[1]*m,A=i[2]*v,N=i[4]*h,M=i[5]*m,L=i[6]*v,z=i[8]*h,W=i[9]*m,H=i[10]*v,Q=x+M+H,ne=0;return Q>0?(ne=2*Math.sqrt(Q+1),u[3]=.25*ne,u[0]=(L-W)/ne,u[1]=(z-A)/ne,u[2]=(S-N)/ne):x>M&&x>H?(ne=2*Math.sqrt(1+x-M-H),u[3]=(L-W)/ne,u[0]=.25*ne,u[1]=(S+N)/ne,u[2]=(z+A)/ne):M>H?(ne=2*Math.sqrt(1+M-x-H),u[3]=(z-A)/ne,u[0]=(S+N)/ne,u[1]=.25*ne,u[2]=(L+W)/ne):(ne=2*Math.sqrt(1+H-x-M),u[3]=(S-N)/ne,u[0]=(z+A)/ne,u[1]=(L+W)/ne,u[2]=.25*ne),u},s.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(i,l)=>String.fromCharCode(+("0x"+l))))},s.f0=function([u,i,l]){const h=Math.hypot(u,i,l),m=Math.atan2(u,l),v=.5*Math.PI-Math.acos(-i/h);return new Te(Ke(m),Ke(v))},s.f1=Sr,s.f2=SR,s.f3=function(u){const i=u.navigator?u.navigator.userAgent:null;return!!function(l){if(gn==null){const h=l.navigator?l.navigator.userAgent:null;gn=!!l.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return gn}(u)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(u,i){_E=u,Db=i},s.f5=WO,s.f6=hV,s.f7=function(u){const i=[0,0,0],l=D(new Float64Array(16));return V(l,u.pixelMatrix,u.globeMatrix),pr(i,i,l),new kt(i[0],i[1])},s.f8=function(){const u=v1;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(pR),v1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){sA().acquire(pR)},s.fA=LA,s.fB=un,s.fC=function(u){let i=0;if(new Uint32Array(u,0,1)[0]!==k6){const l=new Uint32Array(u,0,7),[,,h,m,v,x]=l;i=l.byteLength+m+v+x+v,(h!==u.byteLength||i>=u.byteLength)&&Nr("Invalid b3dm header information.")}return D6(u,i)},s.fD=function(u,i){const l=CR(u);for(const h of l){for(const m of h.meshes)Ohe(m);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(Rhe(h.lights,i)))}return l},s.fE=kA,s.fF=Hi,s.fG=b6,s.fH=yc,s.fI=Po,s.fJ=function(u){vl(),sa!=null&&sa.then(i=>{i.keys().then(l=>{for(let h=0;h<l.length-u;h++)i.delete(l[h]).catch(m=>Nr(m.message))}).catch(l=>Nr(l.message))}).catch(i=>Nr(i.message))},s.fa=Mw,s.fb=function(u,i,l=!1){if(oo===Po.deferred||oo===Po.loading||oo===Po.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gd=gl.resolveURL(u),oo=Po.deferred,qd=i,Ow(),l||Dw()},s.fc=function(u){O_=gl.resolveURL(u),R_||(R_=new k_(sA(),new Du)),R_.broadcast("setMeshoptUrl",O_)},s.fd=T6,s.fe=function(u){yR=gl.resolveURL(u),R_||(R_=new k_(sA(),new Du)),R_.broadcast("setDracoUrl",yR)},s.ff=S6,s.fg=y1,s.fh=function(u){const i=Ou();if(!i)return;const l=i.delete(vE);u&&l.then(()=>u()).catch(u)},s.fi=Kg,s.fj=ir,s.fk=Cp,s.fl=2,s.fm=Y8,s.fn=J8,s.fo=Y6,s.fp=hn,s.fq="hd_road_elevation",s.fr=Io,s.fs=_r,s.ft=tf,s.fu=BR,s.fv=1,s.fw=function(u,i,l,h,m,v,x,S=1,A,N,M,L){u.createArrays(),u.tilePixelRatio=Wt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const z=u.layers[0].layout,W=u.layers[0]._unevaluatedLayout._values,H={};H.scaleFactor=S,H.textSizeScaleRange=z.get("text-size-scale-range"),H.iconSizeScaleRange=z.get("icon-size-scale-range");const[Q,ne]=H.textSizeScaleRange,[te,le]=H.iconSizeScaleRange;H.textScaleFactor=Pe(H.scaleFactor,Q,ne),H.iconScaleFactor=Pe(H.scaleFactor,te,le);const de=W["text-size"],pe=W["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:qe}=u.textSizeData;H.compositeTextSizes=[de.possiblyEvaluate(new Wn(Fe,{worldview:M}),v),de.possiblyEvaluate(new Wn(qe,{worldview:M}),v)]}if(u.iconSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:qe}=u.iconSizeData;H.compositeIconSizes=[pe.possiblyEvaluate(new Wn(Fe,{worldview:M}),v,L),pe.possiblyEvaluate(new Wn(qe,{worldview:M}),v,L)]}H.layoutTextSize=de.possiblyEvaluate(new Wn(x+1,{worldview:M}),v),H.layoutIconSize=pe.possiblyEvaluate(new Wn(x+1,{worldview:M}),v,L),H.textMaxSize=de.possiblyEvaluate(new Wn(18,{worldview:M}),v);const Se=z.get("symbol-placement"),we=z.get("text-rotation-alignment")==="map"&&Se!=="point",Ie=z.get("text-size");let Oe=!1;const Ne=[];for(const Fe of u.features){const qe=z.get("text-font").evaluate(Fe,{},v).join(","),ht=Ie.evaluate(Fe,{},v)*H.textScaleFactor,at=H.layoutTextSize.evaluate(Fe,{},v)*H.textScaleFactor,ut=H.layoutIconSize.evaluate(Fe,{},v,L)*H.iconScaleFactor,bt={horizontal:{},vertical:void 0},_t=Fe.text;let xt,rt=[0,0];if(_t){const yn=_t.toString(),Xi=z.get("text-letter-spacing").evaluate(Fe,{},v)*Xs,wn=z.get("text-line-height").evaluate(Fe,{},v)*Xs,Vn=OO(yn)?Xi:0,yi=z.get("text-anchor").evaluate(Fe,{},v),Ai=z.get("text-variable-anchor");if(!Ai){const _s=z.get("text-radial-offset").evaluate(Fe,{},v);if(_s)rt=OU(yi,[_s*Xs,UR]);else{const Is=z.get("text-offset").evaluate(Fe,{},v);rt=[Is[0]*Xs,Is[1]*Xs]}}let Ci=we?"center":z.get("text-justify").evaluate(Fe,{},v);const Ki=Se==="point",oa=Ki?z.get("text-max-width").evaluate(Fe,{},v)*Xs:1/0,Ca=_s=>{u.allowVerticalPlacement&&Iw(yn)&&(bt.vertical=MR(_t,i,l,m,qe,oa,wn,yi,_s,Vn,rt,Al.vertical,!0,at,ht,A))};if(!we&&Ai){const _s=Ci==="auto"?Ai.map(Us=>qR(Us)):[Ci];let Is=!1;for(let Us=0;Us<_s.length;Us++){const Zr=_s[Us];if(!bt.horizontal[Zr])if(Is)bt.horizontal[Zr]=bt.horizontal[0];else{const Pi=MR(_t,i,l,m,qe,oa,wn,"center",Zr,Vn,rt,Al.horizontal,!1,at,ht,A);Pi&&(bt.horizontal[Zr]=Pi,Is=Pi.positionedLines.length===1)}}Ca("left")}else{if(Ci==="auto"&&(Ci=qR(yi)),Ki||z.get("text-writing-mode").indexOf("horizontal")>=0||!Iw(yn)){const _s=MR(_t,i,l,m,qe,oa,wn,yi,Ci,Vn,rt,Al.horizontal,!1,at,ht,A);_s&&(bt.horizontal[Ci]=_s)}Ca(Ki?"left":Ci)}}let Tt,mt,jt,wt,Qt,er,qt=!1;const Ht=z.get("icon-text-fit").evaluate(Fe,{},v);if(Fe.icon&&Fe.icon.hasPrimary()){const yn=C1(Fe.icon,u.iconSizeData,W["icon-size"],v,u.zoom,Fe,A,H.iconScaleFactor,M,L);Tt=yn.iconPrimary,jt=yn.iconSecondary;const Xi=Tt.toString();if(mt=h.get(Xi),mt&&(Qt=z.get("icon-offset").evaluate(Fe,{},v),er=z.get("icon-anchor").evaluate(Fe,{},v),xt=yA(m.get(Xi),jt?m.get(jt.toString()):void 0,Qt,er),qt=mt.sdf,u.sdfIcons===void 0?u.sdfIcons=mt.sdf:u.sdfIcons!==mt.sdf&&Nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mt.pixelRatio!==u.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),jt){const wn=jt.toString();wt=h.get(wn)}}Oe=Oe||!(!Fe.icon||!Fe.icon.hasSecondary());const xr=wA(bt.horizontal)||bt.vertical;u.iconsInText||(u.iconsInText=!!xr&&xr.iconsInText);const cr=at*H.textScaleFactor/Xs,{defaultShapedIcon:Yt,verticallyShapedIcon:kr}=Vfe(u,xt,z,Fe,v,bt,cr,Qt,Ht);Ht!=="none"&&xt&&(yU(xt)||vU(xt))&&(bA(0,mt,Tt,xt,Yt,Ht,N,h,m),bA(0,wt,jt,xt,Yt,Ht,N,h,m),kr&&(bA(0,mt,Tt,xt,kr,Ht,N,h,m),bA(0,wt,jt,xt,kr,Ht,N,h,m))),xt=Yt;const{iconBBox:nn,iconVerticalBBox:En,textBBox:en,textVerticalBBox:Hn}=Lfe(u,xt,kr,z,Fe,v,ut,Qt,H,m,er,bt,at,rt,L);Ne.push({feature:Fe,shapedTextOrientations:bt,shapedText:xr,shapedIcon:xt,iconPrimary:Tt,iconSecondary:jt,iconOffset:Qt,iconAnchor:er,verticallyShapedIcon:kr,layoutTextSize:at,layoutIconSize:ut,textOffset:rt,isSDFIcon:qt,iconTextFit:Ht,iconCollisionBounds:nn,iconVerticalCollisionBounds:En,textCollisionBounds:en,textVerticalCollisionBounds:Hn})}return{featureData:Ne,sizes:H,hasAnySecondaryIcon:Oe,textAlongLine:we,symbolPlacement:Se}},s.fx=jU,s.fy=function(u,i,l,h,m,v,x,S,A,N){u.iconAtlasPositions=N.iconPositions;const{featureData:M,hasAnySecondaryIcon:L,sizes:z,textAlongLine:W,symbolPlacement:H}=i;for(const Q of M){const{shapedIcon:ne,verticallyShapedIcon:te,feature:le,shapedTextOrientations:de,shapedText:pe,layoutTextSize:Se,textOffset:we,isSDFIcon:Ie,iconPrimary:Oe,iconSecondary:Ne,iconTextFit:Fe,iconOffset:qe,iconCollisionBounds:ht,iconVerticalCollisionBounds:at,textCollisionBounds:ut}=Q;LU(ne,N.iconPositions,Oe,Ne),LU(te,N.iconPositions,Oe,Ne),$fe(de,N.iconPositions),Bfe(Oe,Ne,N.iconPositions),(pe||ne)&&Ufe(u,le,de,ne,te,A,z,Se,0,we,Ie,h,m,x,S,L,Fe,qe,W,H,ht,at,ut)}l&&u.generateCollisionDebugBuffers(v,u.collisionBoxArray,z.textScaleFactor)},s.fz=Ln,s.g=function(u,i){return Ru(Object.assign(u,{method:"GET"}),i)},s.h=function(u){return u.indexOf("mapbox:")===0},s.i=function(u){return As.API_STYLE_REGEX.test(u)&&!$a(u)},s.j=Pd,s.k=Kf,s.l=function(u){return decodeURIComponent(atob(u).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(u,i){return Ru(Object.assign(u,{type:"json"}),i)},s.n=kv,s.o=gl,s.p=function(u,i){return Ru(Object.assign(u,{method:"POST"}),i)},s.q=Aa,s.r=Lh,s.s=function(u){try{const i=self[u];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return mR||(mR=new Kg("ImageRasterizer")),mR},s.u=function(){return function u(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},s.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},s.w=Nr,s.x=oM,s.y=hg,s.z=Mu}),d(["./shared"],function(s){function _(Ke){const ce=Ke?Ke.url.toString():void 0;return ce?performance.getEntriesByName(ce):[]}function b(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let me="[";for(const je of Ke)me+=`${b(je)},`;return`${me}]`}let ce="{";for(const me of Object.keys(Ke).sort())ce+=`${me}:${b(Ke[me])},`;return`${ce}}`}function T(Ke){let ce="";for(const me of s.bx)ce+=`/${b(Ke[me])}`;return ce}function C(Ke,ce){return function me(je){return typeof je=="string"&&je===ce||(Array.isArray(je)?je.some(me):!(!je||typeof je!="object")&&Object.values(je).some(me))}(Ke)}class P{constructor(ce){this.keyCache={},this._layers={},this._layerConfigs={},ce&&this.replace(ce)}replace(ce,me){this._layerConfigs={},this._layers={},this.update(ce,[],me)}update(ce,me,je){this._options=je;for(const Pe of ce)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=s.du(Pe,this.scope,null,this._options)).compileFilter(je),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of me)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const Ge=function(Pe,He){const nt={};for(let ct=0;ct<Pe.length;ct++){const Rt=Pe[ct];let Nt=He&&He[Rt.id];Nt||(Rt.type==="symbol"?Nt=Rt.id:(Nt=T(Rt),Rt.type==="line"&&Rt.paint&&C(Rt.paint["line-width"],"line-progress")&&(Nt+=`/${b(Rt.paint["line-width"])}`))),He&&(He[Rt.id]=Nt);let tr=nt[Nt];tr||(tr=nt[Nt]=[]),tr.push(Rt)}const Xe=[];for(const ct in nt)Xe.push(nt[ct]);return Xe}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of Ge){const He=Pe.map(tr=>this._layers[tr.id]),nt=He[0];if(nt.visibility==="none")continue;const Xe=nt.source||"";let ct=this.familiesBySource[Xe];ct||(ct=this.familiesBySource[Xe]={});const Rt=nt.sourceLayer||"_geojsonTileLayer";let Nt=ct[Rt];Nt||(Nt=ct[Rt]=[]),Nt.push(He)}}}const k=1*s.fl;class B{constructor(ce){const me={},je=[];for(const nt in ce){const Xe=ce[nt],ct=me[nt]={};for(const Rt in Xe.glyphs){const Nt=Xe.glyphs[+Rt];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const tr=Nt.metrics.localGlyph?k:1,_r={x:0,y:0,w:Nt.bitmap.width+2*tr,h:Nt.bitmap.height+2*tr};je.push(_r),ct[Rt]=_r}}const{w:Ge,h:Pe}=s.G(je),He=new s.fk({width:Ge||1,height:Pe||1});for(const nt in ce){const Xe=ce[nt];for(const ct in Xe.glyphs){const Rt=Xe.glyphs[+ct];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const Nt=me[nt][ct],tr=Rt.metrics.localGlyph?k:1;s.fk.copy(Rt.bitmap,He,{x:0,y:0},{x:Nt.x+tr,y:Nt.y+tr},Rt.bitmap)}}this.image=He,this.positions=me}}function R(Ke,ce,me){Ke[ce]?me&&(Ke[ce].center=me):Ke[ce]={floorIds:new Set,center:me||[0,0],floors:{}}}function D(Ke,ce,me,je){for(const Ge of ce)R(Ke,Ge),Ke[Ge].floors[me]=je,Ke[Ge].floorIds.add(me)}function G(Ke){return{id:Ke.properties.id.toString(),center:Ke.properties.center.toString().split(";").map(Number)}}function V(Ke){return{id:Ke.properties.id.toString(),isDefault:!!Ke.properties.is_default&&Ke.properties.is_default,connections:Ke.properties.connected_floor_ids?new Set(Ke.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ke.properties.conflicted_floor_ids?new Set(Ke.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ke.properties.building_ids?new Set(Ke.properties.building_ids.toString().split(";")):new Set,name:Ke.properties.name.toString(),zIndex:Ke.properties.z_index}}function $(Ke,ce){return ce.every(me=>Ke.properties&&Ke.properties[me]!=null)}function K(Ke){return $(Ke,["type","id","name"])&&Ke.properties.type==="building"}function Y(Ke){return $(Ke,["type","id","name","z_index"])&&Ke.properties.type==="floor"}s.fj(B,"GlyphAtlas");class ee{constructor(ce){this.tileID=new s.aQ(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.lut=ce.lut,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.scope=ce.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ce.showCollisionBoxes,this.collectResourceTiming=!!ce.request&&ce.request.collectResourceTiming,this.promoteId=ce.promoteId,this.isSymbolTile=ce.isSymbolTile,this.tileTransform=s.aZ(ce.tileID.canonical,ce.projection),this.projection=ce.projection,this.worldview=ce.worldview,this.localizableLayerIds=ce.localizableLayerIds,this.brightness=ce.brightness,this.extraShadowCaster=!!ce.extraShadowCaster,this.tessellationStep=ce.tessellationStep,this.scaleFactor=ce.scaleFactor,this.worldview=ce.worldview,this.indoor=ce.indoor}parse(ce,me,je,Ge,Pe,He){this.status="parsing",this.data=ce,this.collisionBoxArray=new s.b3;const nt=new s.fm(Object.keys(ce.layers).sort()),Xe=new s.fn(this.tileID,this.promoteId);Xe.bucketLayerIDs=[];const ct={},Rt=new s.fo(256,256),Nt={featureIndex:Xe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Rt,availableImages:je,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const $r=this.indoor.indoorState.activeFloorsVisible,Qr=function(Rr,Nr,li){const vs=function(xi,gn){if(!xi)return s.w("No source layers defined in indoor specification"),gn;if(xi.size===0)return gn;const Ei=xi.difference(gn);for(const Qn of Ei)s.w(`Missing source layer required in indoor specification: ${Qn}`);return gn.intersection(gn)}(Nr.sourceLayers,new Set(Object.keys(Rr.layers))),Wi=Nr.indoorState,Hi=function(xi,gn,Ei,Qn){const ei=new Set,Ui=new Set,ya=new Set,ia=new Map,As={},Pd=$a=>{const Go=ia.get($a)||new Set;for(const Hl of ei)if((ia.get(Hl)||new Set).has($a)||Go.has(Hl))return!0;return!1};for(const $a of gn){const Go=xi.layers[$a];if(Go)for(let Hl=0;Hl<Go.length;Hl++){const mc=Go.feature(Hl);if(K(mc)){const{id:Wo,center:io}=G(mc);R(As,Wo,io),ei.add(Wo);continue}if(Y(mc)){const{id:Wo,isDefault:io,connections:ku,conflicts:Lh,buildings:gl,name:sg,zIndex:ag}=V(mc);D(As,gl,Wo,{name:sg,zIndex:ag}),ia.set(Wo,Lh),(Wo===Qn||ku.has(Qn))&&ei.add(Wo),Ui.add(Wo),io&&ya.add(Wo)}}else s.w(`indoor source layer not found: ${$a}`)}if(Ei)for(const $a of Ei)Ui.has($a)&&(Pd($a)||ei.add($a));for(const $a of ya)ei.has($a)||Pd($a)||ei.add($a);return{buildings:As,activeFloors:ei}}(Rr,vs,Wi.lastActiveFloors,Wi.selectedFloorId);return li.send("setIndoorData",Hi),Hi}(ce,this.indoor,Pe);Nt.activeFloors=$r?Qr.activeFloors:void 0}const tr=[],_r=me.familiesBySource[this.source];for(const $r in _r){const Qr=ce.layers[$r];if(!Qr)continue;let Rr=!1,Nr=!1,li=!1;for(const gn of _r[$r])gn[0].type==="symbol"?Rr=!0:Nr=!0,gn[0].is3D()&&gn[0].type!=="model"&&(li=!0);if(this.extraShadowCaster&&!li||this.isSymbolTile===!0&&!Rr||this.isSymbolTile===!1&&!Nr)continue;Qr.version===1&&s.w(`Vector tile source "${this.source}" layer "${$r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vs=nt.encode($r),Wi=[],Hi=this.localizableLayerIds&&this.localizableLayerIds.has($r);let xi=!1;for(let gn=0,Ei=0;gn<Qr.length;gn++){const Qn=Qr.feature(gn),ei=Xe.getId(Qn,$r),Ui=Qn.properties?Qn.properties.worldview:null;if(Hi&&this.worldview&&typeof Ui=="string")if(Ui==="all")Qn.properties.$localized=!0;else{if(!Ui.split(",").includes(this.worldview))continue;Qn.properties.$localized=!0,Qn.properties.worldview=this.worldview}!xi&&Qn.properties&&Qn.properties.hasOwnProperty(s.fp)&&(xi=!0),Wi.push({feature:Qn,id:ei,index:Ei,sourceLayerIndex:vs}),Ei++}xi&&!Nt.elevationFeatures&&ce.layers.hasOwnProperty(s.fq)&&(Nt.elevationFeatures=s.fr.parseFrom(ce.layers[s.fq],this.canonical));for(const gn of _r[$r]){const Ei=gn[0];if(this.extraShadowCaster&&(!Ei.is3D()||Ei.type==="model")||this.isSymbolTile!==void 0&&Ei.type==="symbol"!==this.isSymbolTile||Ei.minzoom&&this.zoom<Math.floor(Ei.minzoom)||Ei.maxzoom&&this.zoom>=Ei.maxzoom||Ei.visibility==="none")continue;ae(gn,this.zoom,Nt.brightness,je,this.worldview);const Qn=ct[Ei.id]=Ei.createBucket({index:Xe.bucketLayerIDs.length,layers:gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ge,worldview:this.worldview,localizable:Hi,availableImages:je});Xe.bucketLayerIDs.push(gn.map(Ui=>s.B(Ui.id,Ui.scope)));let ei=Qn.prepare?Qn.prepare():null;ei!=null?(ei=ei.then(()=>Qn.populate(Wi,Nt,this.tileID.canonical,this.tileTransform)),tr.push(ei)):Qn.populate(Wi,Nt,this.tileID.canonical,this.tileTransform)}}const Er=()=>{let $r,Qr,Rr,Nr,li,vs;Rt.trim();const Wi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Hi=()=>{if($r)return this.status="done",He($r);if(this.extraShadowCaster)this.status="done",He(null,{buckets:Object.values(ct).filter(gn=>!gn.isEmpty()),featureIndex:Xe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Nt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Qr&&Rr&&Nr){const gn=new B(Qr),Ei=new Map;for(const[Ui,ya]of Rr.entries()){const{imagePosition:ia}=s.fu(Ui,ya,s.fv);Ei.set(Ui,ia)}const Qn={};for(const Ui in ct){const ya=ct[Ui];ya instanceof s.b4&&(ae(ya.layers,this.zoom,Nt.brightness,je,this.worldview),Qn[Ui]=s.fw(ya,Qr,gn.positions,Rr,Ei,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,li,this.worldview,je))}const ei={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,Rr,li,()=>{ei.iconsPending=!1,xi(Qn,gn,ei)}),this.rasterizeIfNeeded(Pe,Nr,vs,()=>{ei.patternsPending=!1,xi(Qn,gn,ei)})}},xi=(gn,Ei,Qn,ei)=>{if(Qn.iconsPending||Qn.patternsPending)return;const Ui=new s.fx(Rr,Nr,this.lut);for(const ya in ct){const ia=ct[ya];if(ya in gn)s.fy(ia,gn[ya],this.showCollisionBoxes,je,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Rr,Ui);else if(ia.hasPattern&&(ia instanceof s.ba||ia instanceof s.bb||ia instanceof s.ea)){ae(ia.layers,this.zoom,Nt.brightness,je,this.worldview);const As=Object.fromEntries(Ui.patternPositions);ia.addFeatures(Nt,this.tileID.canonical,As,je,this.tileTransform,this.brightness)}}this.status="done",He(null,{buckets:Object.values(ct).filter(ya=>!ya.isEmpty()),featureIndex:Xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,lineAtlas:Rt,imageAtlas:Ui,brightness:Nt.brightness})};if(!this.extraShadowCaster){const gn=s.fs(Nt.glyphDependencies,ei=>Object.keys(ei).map(Number));Object.keys(gn).length?Pe.send("getGlyphs",{uid:this.uid,stacks:gn},(ei,Ui)=>{$r||($r=ei,Qr=Ui,Hi())},void 0,!1,Wi):Qr={};const Ei=Array.from(Nt.iconDependencies.keys()).map(ei=>s.I.parse(ei));Ei.length?Pe.send("getImages",{images:Ei,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ei,Ui)=>{$r||($r=ei,Rr=new Map,li=this.updateImageMapAndGetImageTaskQueue(Rr,Ui,Nt.iconDependencies),Hi())},void 0,!1,Wi):(Rr=new Map,li=new Map);const Qn=Array.from(Nt.patternDependencies.keys()).map(ei=>s.I.parse(ei));Qn.length?Pe.send("getImages",{images:Qn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ei,Ui)=>{$r||($r=ei,Nr=new Map,vs=this.updateImageMapAndGetImageTaskQueue(Nr,Ui,Nt.patternDependencies),Hi())},void 0,!1,Wi):(Nr=new Map,vs=new Map)}if(Nt.elevationFeatures&&Nt.elevationFeatures.length>0){const gn=[];for(const Qn of Object.values(ct))if(Qn instanceof s.bb){const ei=Qn.getUnevaluatedPortalGraph();ei&&gn.push(ei)}const Ei=s.ft.evaluate(gn);for(const Qn of Object.values(ct))if(Qn instanceof s.bb){const ei=ce.layers[nt.decode(Qn.sourceLayerIndex)];Qn.setEvaluatedPortalGraph(Ei,ei,this.tileID.canonical,Nt.availableImages,Nt.brightness)}}Hi()};tr.length>0?Promise.allSettled(tr).then(Er).catch(He):Er()}updateParameters(ce){this.scaleFactor=ce.scaleFactor,this.showCollisionBoxes=ce.showCollisionBoxes,this.projection=ce.projection,this.brightness=ce.brightness,this.tileTransform=s.aZ(ce.tileID.canonical,ce.projection),this.extraShadowCaster=ce.extraShadowCaster,this.lut=ce.lut,this.worldview=ce.worldview,this.indoor=ce.indoor}rasterizeIfNeeded(ce,me,je,Ge){Array.from(me.values()).some(Pe=>Pe.usvg)?this.rasterize(ce,me,je,Ge):Ge()}updateImageMapAndGetImageTaskQueue(ce,me,je){const Ge=new Map;for(const Pe of me.keys()){const He=je.get(Pe)||[];for(const nt of He){const Xe=nt.toString(),ct=me.get(nt.id.toString());ct.usvg?Ge.has(Xe)||(Ge.set(Xe,nt),ce.set(Xe,Object.assign({},ct))):ce.set(Xe,ct)}}return Ge}rasterize(ce,me,je,Ge){this.rasterizeTask=ce.send("rasterizeImages",{scope:this.scope,tasks:je},(Pe,He)=>{if(!Pe)for(const[nt,Xe]of He.entries()){const ct=Object.assign(me.get(nt),{data:Xe});me.set(nt,ct)}Ge()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ae(Ke,ce,me,je,Ge){const Pe=new s.ac(ce,{brightness:me,worldview:Ge});for(const He of Ke)He.recalculate(Pe,je)}class ie extends s.E{constructor(ce,me,je,Ge,Pe,He,nt){super(),this.actor=ce,this.layerIndex=me,this.availableImages=je,this.availableModels=Ge,this.loadVectorData=He||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ce.scheduler),this.isSpriteLoaded=Pe,this.scheduler=ce.scheduler,this.brightness=nt}loadTile(ce,me){const je=ce.uid,Ge=ce&&ce.request,Pe=Ge&&Ge.collectResourceTiming,He=this.loading[je]=new ee(ce);He.abort=this.loadVectorData(ce,(nt,Xe)=>{const ct=!this.loading[je];if(delete this.loading[je],He.cancelRasterize(),ct||nt||!Xe)return He.status="done",ct||(this.loaded[je]=He),me(nt);const Rt=Xe.rawData,Nt={},tr=s.aM(Xe.responseHeaders);tr&&tr.expires&&(Nt.expires=tr.expires),tr&&tr.cacheControl&&(Nt.cacheControl=tr.cacheControl),He.vectorTile=Xe.vectorTile||new s.fz(new s.bt(Rt));const _r=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Er,$r)=>{if(Er||!$r)return me(Er);const Qr={};if(Pe){const Rr=_(Ge);Rr.length>0&&(Qr.resourceTiming=JSON.parse(JSON.stringify(Rr)))}me(null,Object.assign({rawTileData:Rt.slice(0),responseHeaders:Xe.responseHeaders},$r,Nt,Qr))})};this.isSpriteLoaded?_r():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_r,{type:"parseTile",isSymbolTile:ce.isSymbolTile,zoom:ce.tileZoom}):_r()}),this.loaded=this.loaded||{},this.loaded[je]=He})}reloadTile(ce,me){const je=this.loaded,Ge=ce.uid;if(je&&je[Ge]){const Pe=je[Ge];Pe.updateParameters(ce);const He=(nt,Xe)=>{const ct=Pe.reloadCallback;ct&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ct)),me(nt,Xe)};Pe.status==="parsing"?Pe.reloadCallback=He:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He):He())}else me(null,void 0)}abortTile(ce,me){const je=ce.uid,Ge=this.loading[je];Ge&&(Ge.abort&&Ge.abort(),delete this.loading[je]),me()}removeTile(ce,me){const je=this.loaded,Ge=ce.uid;je&&je[Ge]&&delete je[Ge],me()}}class ge{loadTile(ce,me){const{uid:je,encoding:Ge,rawImageData:Pe,padding:He}=ce,nt=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,He):Pe;me(null,new s.fA(je,nt,Ge,He<1))}reloadTile(ce,me){me(null,null)}abortTile(ce,me){me()}removeTile(ce,me){me()}getImageData(ce,me){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ce.width,ce.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ce.width,this.offscreenCanvas.height=ce.height,this.offscreenCanvasContext.drawImage(ce,0,0,ce.width,ce.height);const je=this.offscreenCanvasContext.getImageData(-me,-me,ce.width+2*me,ce.height+2*me);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),je}}s.bs.setPbf(s.bt);class fe{constructor(ce){this._mrt=new s.bs(ce.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ce.uid,this.tileID=ce.tileID,this.source=ce.source}parse(ce,me){const je=this._mrt;this.status="parsing",this._entireBuffer=ce;try{je.parseHeader(ce),this._isHeaderLoaded=!0;const Ge=[];for(const Pe in je.layers){const He=je.getLayer(Pe),nt=He.getDataRange(He.getBandList()),Xe=je.createDecodingTask(nt),ct=ce.slice(nt.firstByte,nt.lastByte+1),Rt=s.bs.performDecoding(ct,Xe).then(Nt=>Xe.complete(null,Nt)).catch(Nt=>Xe.complete(Nt,null));Ge.push(Rt)}Promise.allSettled(Ge).then(()=>me(null,je)).catch(Pe=>me(Pe))}catch(Ge){me(Ge)}}}class be{constructor(ce){this.actor=ce,this.loading={},this.loaded={}}loadTile(ce,me){const je=ce.uid,Ge=ce.request,Pe=this.loading[je]=new fe(ce),{cancel:He}=s.bu(Ge,(nt,Xe,ct)=>{const Rt=!this.loading[je];if(delete this.loading[je],Rt||nt||!Xe)return Pe.status="done",Rt||(this.loaded[je]=Pe),me(nt);Pe.parse(Xe,(Nt,tr)=>{if(Nt||!tr)return me(Nt);me(null,tr,ct)}),this.loaded[je]=Pe});Pe.abort=He}reloadTile(ce,me){me(null,void 0)}abortTile(ce,me){const je=ce.uid,Ge=this.loading[je];Ge&&(Ge.abort&&Ge.abort(),delete this.loading[je]),me()}removeTile(ce,me){const je=ce.uid;this.loaded[je]&&delete this.loaded[je],me()}decodeRasterArray(ce,me){s.bs.performDecoding(ce.buffer,ce.task).then(je=>me(null,je)).catch(je=>me(je))}}const ue=s.fB.prototype.toGeoJSON;class Ce{constructor(ce){this._feature=ce,this.extent=s.al,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(this._feature.type===1){const ce=[];for(const me of this._feature.geometry)ce.push([new s.P(me[0],me[1])]);return ce}{const ce=[];for(const me of this._feature.geometry){const je=[];for(const Ge of me)je.push(new s.P(Ge[0],Ge[1]));ce.push(je)}return ce}}toGeoJSON(ce,me,je){return ue.call(this,ce,me,je)}}class ve{constructor(ce,me){this.name=ce,this.extent=s.al,this.length=me.length,this._jsonFeatures=me}feature(ce){return new Ce(this._jsonFeatures[ce])}}class ze{constructor(ce){this.layers={},this.extent=s.al;for(const me of Object.keys(ce))this.layers[me]=new ve(me,ce[me])}}const Me=64/4096;class Be{constructor(){this.features=new Map}clear(){this.features.clear()}load(ce=[],me){for(const je of ce){const Ge=je.id;if(Ge==null)continue;let Pe=this.features.get(Ge);Pe&&this.updateCache(Pe,me),je.geometry?(Pe=We(je),this.updateCache(Pe,me),this.features.set(Ge,Pe)):this.features.delete(Ge),this.updateCache(Pe,me)}}updateCache(ce,me){for(const{canonical:je,uid:Ge}of Object.values(me)){const{z:Pe,x:He,y:nt}=je;Ve(ce,Math.pow(2,Pe),He,nt)&&delete me[Ge]}}getTile(ce,me,je){const Ge=Math.pow(2,ce),Pe=[];for(const He of this.features.values())Ve(He,Ge,me,je)&&Pe.push(Je(He,Ge,me,je));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function Ve({minX:Ke,minY:ce,maxX:me,maxY:je},Ge,Pe,He){return Ke<(Pe+1+Me)/Ge&&ce<(He+1+Me)/Ge&&me>(Pe-Me)/Ge&&je>(He-Me)/Ge}function We(Ke){const{id:ce,geometry:me,properties:je}=Ke;if(!me)return;if(me.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ge,coordinates:Pe}=me,He={id:ce,type:1,geometry:[],tags:je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},nt=He.geometry;if(Ge==="Point")Ee(Pe,nt,He);else if(Ge==="MultiPoint")for(const Xe of Pe)Ee(Xe,nt,He);else if(Ge==="LineString")He.type=2,ot(Pe,nt,He);else if(Ge==="MultiLineString")He.type=2,yt(Pe,nt,He);else if(Ge==="Polygon")He.type=3,yt(Pe,nt,He,!0);else{if(Ge!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");He.type=3;for(const Xe of Pe)yt(Xe,nt,He,!0)}return He}function Ee([Ke,ce],me,je){const Ge=s.aF(Ke);let Pe=s.aJ(ce);Pe=Pe<0?0:Pe>1?1:Pe,me.push(Ge,Pe),je.minX=Math.min(je.minX,Ge),je.minY=Math.min(je.minY,Pe),je.maxX=Math.max(je.maxX,Ge),je.maxY=Math.max(je.maxY,Pe)}function ot(Ke,ce,me,je=!1,Ge=!1){const Pe=[];for(const He of Ke)Ee(He,Pe,me);ce.push(Pe),je&&function(He,nt){let Xe=0;for(let ct=0,Rt=He.length,Nt=Rt-2;ct<Rt;Nt=ct,ct+=2)Xe+=(He[ct]-He[Nt])*(He[ct+1]+He[Nt+1]);if(Xe>0===nt)for(let ct=0,Rt=He.length;ct<Rt/2;ct+=2){const Nt=He[ct],tr=He[ct+1];He[ct]=He[Rt-2-ct],He[ct+1]=He[Rt-1-ct],He[Rt-2-ct]=Nt,He[Rt-1-ct]=tr}}(Pe,Ge)}function yt(Ke,ce,me,je=!1){for(let Ge=0;Ge<Ke.length;Ge++)ot(Ke[Ge],ce,me,je,Ge===0)}function Je(Ke,ce,me,je){const{id:Ge,type:Pe,geometry:He,tags:nt}=Ke,Xe=[];if(Pe===1)(function(ct,Rt,Nt,tr,_r){for(let Er=0;Er<ct.length;Er+=2){const $r=Math.round(s.al*(ct[Er+0]*Rt-Nt)),Qr=Math.round(s.al*(ct[Er+1]*Rt-tr));_r.push([$r,Qr])}})(He,ce,me,je,Xe);else if(Pe===2)for(const ct of He)Bt(ct,ce,me,je,Xe);else if(Pe===3)for(const ct of He)Pt(ct,ce,me,je,Xe);return{id:Ge,type:Pe,geometry:Xe,tags:nt}}function Bt(Ke,ce,me,je,Ge){const He=s.al+128;let nt;for(let Xe=0;Xe<Ke.length-2;Xe+=2){let ct=Math.round(s.al*(Ke[Xe+0]*ce-me)),Rt=Math.round(s.al*(Ke[Xe+1]*ce-je)),Nt=Math.round(s.al*(Ke[Xe+2]*ce-me)),tr=Math.round(s.al*(Ke[Xe+3]*ce-je));const _r=Nt-ct,Er=tr-Rt;ct<-128&&Nt<-128||(ct<-128?(Rt+=Math.round(Er*((-128-ct)/_r)),ct=-128):Nt<-128&&(tr=Rt+Math.round(Er*((-128-ct)/_r)),Nt=-128),Rt<-128&&tr<-128||(Rt<-128?(ct+=Math.round(_r*((-128-Rt)/Er)),Rt=-128):tr<-128&&(Nt=ct+Math.round(_r*((-128-Rt)/Er)),tr=-128),ct>=He&&Nt>=He||(ct>=He?(Rt+=Math.round(Er*((He-ct)/_r)),ct=He):Nt>=He&&(tr=Rt+Math.round(Er*((He-ct)/_r)),Nt=He),Rt>=He&&tr>=He||(Rt>=He?(ct+=Math.round(_r*((He-Rt)/Er)),Rt=He):tr>=He&&(Nt=ct+Math.round(_r*((He-Rt)/Er)),tr=He),nt&&ct===nt[nt.length-1][0]&&Rt===nt[nt.length-1][1]||(nt=[[ct,Rt]],Ge.push(nt)),nt.push([Nt,tr])))))}}function Pt(Ke,ce,me,je,Ge){const Pe=(me-Me)/ce,He=(je-Me)/ce,nt=(me+1+Me)/ce,Xe=(je+1+Me)/ce;function ct(tr,_r){let Er=0;return tr<Pe?Er|=1:tr>nt&&(Er|=2),_r<He?Er|=4:_r>Xe&&(Er|=8),Er}let Rt=[];for(let tr=1;tr<=8;tr*=2){let _r=Ke[Ke.length-2],Er=Ke[Ke.length-1],$r=!(ct(_r,Er)&tr);for(let Qr=0;Qr<Ke.length;Qr+=2){const Rr=Ke[Qr],Nr=Ke[Qr+1],li=!(ct(Rr,Nr)&tr);li!==$r&&(8&tr?Rt.push(_r+(Rr-_r)*(Xe-Er)/(Nr-Er),Xe):4&tr?Rt.push(_r+(Rr-_r)*(He-Er)/(Nr-Er),He):2&tr?Rt.push(nt,Er+(Nr-Er)*(nt-_r)/(Rr-_r)):1&tr&&Rt.push(Pe,Er+(Nr-Er)*(Pe-_r)/(Rr-_r))),li&&Rt.push(Rr,Nr),_r=Rr,Er=Nr,$r=li}if(!(Ke=Rt).length||tr===8)break;Rt=[]}const Nt=[];for(let tr=0;tr<Rt.length;tr+=2)Nt.push([Math.round(s.al*(Rt[tr]*ce-me)),Math.round(s.al*(Rt[tr+1]*ce-je))]);Nt.length&&Ge.push(Nt)}function pt({name:Ke,features:ce},me){me.writeStringField(1,Ke),me.writeVarintField(5,s.al);const je=new Map,Ge=new Map,Pe={keys:je,values:Ge,feature:null};for(const He of ce)Pe.feature=He,me.writeMessage(2,Gt,Pe);for(const He of je.keys())me.writeStringField(3,He);for(const He of Ge.keys())me.writeMessage(4,Et,He)}function Gt(Ke,ce){const me=Ke.feature;me.id!==void 0&&Number.isSafeInteger(+me.id)&&ce.writeVarintField(1,+me.id),me.tags&&ce.writeMessage(2,Pr,Ke),ce.writeVarintField(3,me.type),ce.writeMessage(4,ur,me)}function Pr({keys:Ke,values:ce,feature:me},je){for(const Ge of Object.keys(me.tags)){let Pe=me.tags[Ge];if(Pe===null)continue;let He=Ke.get(Ge);He===void 0&&(He=Ke.size,Ke.set(Ge,He)),je.writeVarint(He);const nt=typeof Pe;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Pe=JSON.stringify(Pe));let Xe=ce.get(Pe);Xe===void 0&&(Xe=ce.size,ce.set(Pe,Xe)),je.writeVarint(Xe)}}function Ot(Ke,ce){return(ce<<3)+(7&Ke)}function nr(Ke){return Ke<<1^Ke>>31}function ur(Ke,ce){const{geometry:me,type:je}=Ke;let Ge=0,Pe=0;if(je===1){ce.writeVarint(Ot(1,me.length));for(const He of me){const nt=He[0]-Ge,Xe=He[1]-Pe;ce.writeVarint(nr(nt)),ce.writeVarint(nr(Xe)),Ge+=nt,Pe+=Xe}}else for(const He of me){if(He.length===0)continue;ce.writeVarint(Ot(1,1));const nt=He.length-(je===3?1:0);for(let Xe=0;Xe<nt;Xe++){Xe===1&&ce.writeVarint(Ot(2,nt-1));const ct=He[Xe][0]-Ge,Rt=He[Xe][1]-Pe;ce.writeVarint(nr(ct)),ce.writeVarint(nr(Rt)),Ge+=ct,Pe+=Rt}je===3&&ce.writeVarint(Ot(7,1))}}function Et(Ke,ce){const me=typeof Ke;me==="string"?ce.writeStringField(1,Ke):me==="boolean"?ce.writeBooleanField(7,Ke):me==="number"&&(Ke%1!=0?ce.writeDoubleField(3,Ke):Ke<0?ce.writeSVarintField(6,Ke):ce.writeVarintField(5,Ke))}const pr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},Kr=Math.fround||(Xn=new Float32Array(1),Ke=>(Xn[0]=+Ke,Xn[0]));var Xn;class Jn{constructor(ce){this.options=Object.assign(Object.create(pr),ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ce){const{log:me,minZoom:je,maxZoom:Ge}=this.options;me&&console.time("total time");const Pe=`prepare ${ce.length} points`;me&&console.time(Pe),this.points=ce;const He=[];for(let Xe=0;Xe<ce.length;Xe++){const ct=ce[Xe];if(!ct.geometry)continue;const[Rt,Nt]=ct.geometry.coordinates,tr=Kr(hs(Rt)),_r=Kr(lt(Nt));He.push(tr,_r,1/0,Xe,-1,1),this.options.reduce&&He.push(0)}let nt=this.trees[Ge+1]=this._createTree(He);me&&console.timeEnd(Pe);for(let Xe=Ge;Xe>=je;Xe--){const ct=+Date.now();nt=this.trees[Xe]=this._createTree(this._cluster(nt,Xe)),me&&console.log("z%d: %d clusters in %dms",Xe,nt.numItems,+Date.now()-ct)}return me&&console.timeEnd("total time"),this}getClusters(ce,me){let je=((ce[0]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,ce[1]));let Pe=ce[2]===180?180:((ce[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)je=-180,Pe=180;else if(je>Pe){const Nt=this.getClusters([je,Ge,180,He],me),tr=this.getClusters([-180,Ge,Pe,He],me);return Nt.concat(tr)}const nt=this.trees[this._limitZoom(me)],Xe=nt.range(hs(je),lt(He),hs(Pe),lt(Ge)),ct=nt.data,Rt=[];for(const Nt of Xe){const tr=this.stride*Nt;Rt.push(ct[tr+5]>1?ni(ct,tr,this.clusterProps):this.points[ct[tr+3]])}return Rt}getChildren(ce){const me=this._getOriginId(ce),je=this._getOriginZoom(ce),Ge="No cluster with the specified id.",Pe=this.trees[je];if(!Pe)throw new Error(Ge);const He=Pe.data;if(me*this.stride>=He.length)throw new Error(Ge);const nt=this.options.radius/(this.options.extent*Math.pow(2,je-1)),Xe=Pe.within(He[me*this.stride],He[me*this.stride+1],nt),ct=[];for(const Rt of Xe){const Nt=Rt*this.stride;He[Nt+4]===ce&&ct.push(He[Nt+5]>1?ni(He,Nt,this.clusterProps):this.points[He[Nt+3]])}if(ct.length===0)throw new Error(Ge);return ct}getLeaves(ce,me,je){const Ge=[];return this._appendLeaves(Ge,ce,me=me||10,je=je||0,0),Ge}getTile(ce,me,je){const Ge=this.trees[this._limitZoom(ce)],Pe=Math.pow(2,ce),{extent:He,radius:nt}=this.options,Xe=nt/He,ct=(je-Xe)/Pe,Rt=(je+1+Xe)/Pe,Nt={features:[]};return this._addTileFeatures(Ge.range((me-Xe)/Pe,ct,(me+1+Xe)/Pe,Rt),Ge.data,me,je,Pe,Nt),me===0&&this._addTileFeatures(Ge.range(1-Xe/Pe,ct,1,Rt),Ge.data,Pe,je,Pe,Nt),me===Pe-1&&this._addTileFeatures(Ge.range(0,ct,Xe/Pe,Rt),Ge.data,-1,je,Pe,Nt),Nt.features.length?Nt:null}getClusterExpansionZoom(ce){let me=this._getOriginZoom(ce)-1;for(;me<=this.options.maxZoom;){const je=this.getChildren(ce);if(me++,je.length!==1)break;ce=je[0].properties.cluster_id}return me}_appendLeaves(ce,me,je,Ge,Pe){const He=this.getChildren(me);for(const nt of He){const Xe=nt.properties;if(Xe&&Xe.cluster?Pe+Xe.point_count<=Ge?Pe+=Xe.point_count:Pe=this._appendLeaves(ce,Xe.cluster_id,je,Ge,Pe):Pe<Ge?Pe++:ce.push(nt),ce.length===je)break}return Pe}_createTree(ce){const me=new s.c4(ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let je=0;je<ce.length;je+=this.stride)me.add(ce[je],ce[je+1]);return me.finish(),me.data=ce,me}_addTileFeatures(ce,me,je,Ge,Pe,He){for(const nt of ce){const Xe=nt*this.stride,ct=me[Xe+5]>1;let Rt,Nt,tr;if(ct)Rt=zn(me,Xe,this.clusterProps),Nt=me[Xe],tr=me[Xe+1];else{const $r=this.points[me[Xe+3]];Rt=$r.properties;const[Qr,Rr]=$r.geometry.coordinates;Nt=hs(Qr),tr=lt(Rr)}const _r={type:1,geometry:[[Math.round(this.options.extent*(Nt*Pe-je)),Math.round(this.options.extent*(tr*Pe-Ge))]],tags:Rt};let Er;Er=ct||this.options.generateId?me[Xe+3]:this.points[me[Xe+3]].id,Er!==void 0&&(_r.id=Er),He.features.push(_r)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,me){const{radius:je,extent:Ge,reduce:Pe,minPoints:He}=this.options,nt=je/(Ge*Math.pow(2,me)),Xe=ce.data,ct=[],Rt=this.stride;for(let Nt=0;Nt<Xe.length;Nt+=Rt){if(Xe[Nt+2]<=me)continue;Xe[Nt+2]=me;const tr=Xe[Nt],_r=Xe[Nt+1],Er=ce.within(Xe[Nt],Xe[Nt+1],nt),$r=Xe[Nt+5];let Qr=$r;for(const Rr of Er){const Nr=Rr*Rt;Xe[Nr+2]>me&&(Qr+=Xe[Nr+5])}if(Qr>$r&&Qr>=He){let Rr,Nr=tr*$r,li=_r*$r,vs=-1;const Wi=(Nt/Rt<<5)+(me+1)+this.points.length;for(const Hi of Er){const xi=Hi*Rt;if(Xe[xi+2]<=me)continue;Xe[xi+2]=me;const gn=Xe[xi+5];Nr+=Xe[xi]*gn,li+=Xe[xi+1]*gn,Xe[xi+4]=Wi,Pe&&(Rr||(Rr=this._map(Xe,Nt,!0),vs=this.clusterProps.length,this.clusterProps.push(Rr)),Pe(Rr,this._map(Xe,xi)))}Xe[Nt+4]=Wi,ct.push(Nr/Qr,li/Qr,1/0,Wi,-1,Qr),Pe&&ct.push(vs)}else{for(let Rr=0;Rr<Rt;Rr++)ct.push(Xe[Nt+Rr]);if(Qr>1)for(const Rr of Er){const Nr=Rr*Rt;if(!(Xe[Nr+2]<=me)){Xe[Nr+2]=me;for(let li=0;li<Rt;li++)ct.push(Xe[Nr+li])}}}}return ct}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,me,je){if(ce[me+5]>1){const He=this.clusterProps[ce[me+6]];return je?Object.assign({},He):He}const Ge=this.points[ce[me+3]].properties,Pe=this.options.map(Ge);return je&&Pe===Ge?Object.assign({},Pe):Pe}}function ni(Ke,ce,me){return{type:"Feature",id:Ke[ce+3],properties:zn(Ke,ce,me),geometry:{type:"Point",coordinates:[(je=Ke[ce],360*(je-.5)),Ct(Ke[ce+1])]}};var je}function zn(Ke,ce,me){const je=Ke[ce+5],Ge=je>=1e4?`${Math.round(je/1e3)}k`:je>=1e3?Math.round(je/100)/10+"k":je,Pe=Ke[ce+6],He=Pe===-1?{}:Object.assign({},me[Pe]);return Object.assign(He,{cluster:!0,cluster_id:Ke[ce+3],point_count:je,point_count_abbreviated:Ge})}function hs(Ke){return Ke/360+.5}function lt(Ke){const ce=Math.sin(Ke*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function Ct(Ke){const ce=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function Xt(Ke,ce,me,je){let Ge=je;const Pe=ce+(me-ce>>1);let He,nt=me-ce;const Xe=Ke[ce],ct=Ke[ce+1],Rt=Ke[me],Nt=Ke[me+1];for(let tr=ce+3;tr<me;tr+=3){const _r=Sr(Ke[tr],Ke[tr+1],Xe,ct,Rt,Nt);if(_r>Ge)He=tr,Ge=_r;else if(_r===Ge){const Er=Math.abs(tr-Pe);Er<nt&&(He=tr,nt=Er)}}Ge>je&&(He-ce>3&&Xt(Ke,ce,He,je),Ke[He+2]=Ge,me-He>3&&Xt(Ke,He,me,je))}function Sr(Ke,ce,me,je,Ge,Pe){let He=Ge-me,nt=Pe-je;if(He!==0||nt!==0){const Xe=((Ke-me)*He+(ce-je)*nt)/(He*He+nt*nt);Xe>1?(me=Ge,je=Pe):Xe>0&&(me+=He*Xe,je+=nt*Xe)}return He=Ke-me,nt=ce-je,He*He+nt*nt}function yr(Ke,ce,me,je){const Ge={id:Ke??null,type:ce,geometry:me,tags:je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")hr(Ge,me);else if(ce==="Polygon")hr(Ge,me[0]);else if(ce==="MultiLineString")for(const Pe of me)hr(Ge,Pe);else if(ce==="MultiPolygon")for(const Pe of me)hr(Ge,Pe[0]);return Ge}function hr(Ke,ce){for(let me=0;me<ce.length;me+=3)Ke.minX=Math.min(Ke.minX,ce[me]),Ke.minY=Math.min(Ke.minY,ce[me+1]),Ke.maxX=Math.max(Ke.maxX,ce[me]),Ke.maxY=Math.max(Ke.maxY,ce[me+1])}function Or(Ke,ce,me,je){if(!ce.geometry)return;const Ge=ce.geometry.coordinates;if(Ge&&Ge.length===0)return;const Pe=ce.geometry.type,He=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2);let nt=[],Xe=ce.id;if(me.promoteId?Xe=ce.properties[me.promoteId]:me.generateId&&(Xe=je||0),Pe==="Point")Mn(Ge,nt);else if(Pe==="MultiPoint")for(const ct of Ge)Mn(ct,nt);else if(Pe==="LineString")oi(Ge,nt,He,!1);else if(Pe==="MultiLineString"){if(me.lineMetrics){for(const ct of Ge)nt=[],oi(ct,nt,He,!1),Ke.push(yr(Xe,"LineString",nt,ce.properties));return}$s(Ge,nt,He,!1)}else if(Pe==="Polygon")$s(Ge,nt,He,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const ct of ce.geometry.geometries)Or(Ke,{id:Xe,geometry:ct,properties:ce.properties},me,je);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ct of Ge){const Rt=[];$s(ct,Rt,He,!0),nt.push(Rt)}}Ke.push(yr(Xe,Pe,nt,ce.properties))}function Mn(Ke,ce){ce.push(fs(Ke[0]),za(Ke[1]),0)}function oi(Ke,ce,me,je){let Ge,Pe,He=0;for(let Xe=0;Xe<Ke.length;Xe++){const ct=fs(Ke[Xe][0]),Rt=za(Ke[Xe][1]);ce.push(ct,Rt,0),Xe>0&&(He+=je?(Ge*Rt-ct*Pe)/2:Math.sqrt(Math.pow(ct-Ge,2)+Math.pow(Rt-Pe,2))),Ge=ct,Pe=Rt}const nt=ce.length-3;ce[2]=1,Xt(ce,0,nt,me),ce[nt+2]=1,ce.size=Math.abs(He),ce.start=0,ce.end=ce.size}function $s(Ke,ce,me,je){for(let Ge=0;Ge<Ke.length;Ge++){const Pe=[];oi(Ke[Ge],Pe,me,je),ce.push(Pe)}}function fs(Ke){return Ke/360+.5}function za(Ke){const ce=Math.sin(Ke*Math.PI/180),me=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return me<0?0:me>1?1:me}function Ta(Ke,ce,me,je,Ge,Pe,He,nt){if(je/=ce,Pe>=(me/=ce)&&He<je)return Ke;if(He<me||Pe>=je)return null;const Xe=[];for(const ct of Ke){const Rt=ct.geometry;let Nt=ct.type;const tr=Ge===0?ct.minX:ct.minY,_r=Ge===0?ct.maxX:ct.maxY;if(tr>=me&&_r<je){Xe.push(ct);continue}if(_r<me||tr>=je)continue;let Er=[];if(Nt==="Point"||Nt==="MultiPoint")fl(Rt,Er,me,je,Ge);else if(Nt==="LineString")na(Rt,Er,me,je,Ge,!1,nt.lineMetrics);else if(Nt==="MultiLineString")ga(Rt,Er,me,je,Ge,!1);else if(Nt==="Polygon")ga(Rt,Er,me,je,Ge,!0);else if(Nt==="MultiPolygon")for(const $r of Rt){const Qr=[];ga($r,Qr,me,je,Ge,!0),Qr.length&&Er.push(Qr)}if(Er.length){if(nt.lineMetrics&&Nt==="LineString"){for(const $r of Er)Xe.push(yr(ct.id,Nt,$r,ct.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(Er.length===1?(Nt="LineString",Er=Er[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=Er.length===3?"Point":"MultiPoint"),Xe.push(yr(ct.id,Nt,Er,ct.tags))}}return Xe.length?Xe:null}function fl(Ke,ce,me,je,Ge){for(let Pe=0;Pe<Ke.length;Pe+=3){const He=Ke[Pe+Ge];He>=me&&He<=je&&pl(ce,Ke[Pe],Ke[Pe+1],Ke[Pe+2])}}function na(Ke,ce,me,je,Ge,Pe,He){let nt=js(Ke);const Xe=Ge===0?ml:Wl;let ct,Rt,Nt=Ke.start;for(let Qr=0;Qr<Ke.length-3;Qr+=3){const Rr=Ke[Qr],Nr=Ke[Qr+1],li=Ke[Qr+2],vs=Ke[Qr+3],Wi=Ke[Qr+4],Hi=Ge===0?Rr:Nr,xi=Ge===0?vs:Wi;let gn=!1;He&&(ct=Math.sqrt(Math.pow(Rr-vs,2)+Math.pow(Nr-Wi,2))),Hi<me?xi>me&&(Rt=Xe(nt,Rr,Nr,vs,Wi,me),He&&(nt.start=Nt+ct*Rt)):Hi>je?xi<je&&(Rt=Xe(nt,Rr,Nr,vs,Wi,je),He&&(nt.start=Nt+ct*Rt)):pl(nt,Rr,Nr,li),xi<me&&Hi>=me&&(Rt=Xe(nt,Rr,Nr,vs,Wi,me),gn=!0),xi>je&&Hi<=je&&(Rt=Xe(nt,Rr,Nr,vs,Wi,je),gn=!0),!Pe&&gn&&(He&&(nt.end=Nt+ct*Rt),ce.push(nt),nt=js(Ke)),He&&(Nt+=ct)}let tr=Ke.length-3;const _r=Ke[tr],Er=Ke[tr+1],$r=Ge===0?_r:Er;$r>=me&&$r<=je&&pl(nt,_r,Er,Ke[tr+2]),tr=nt.length-3,Pe&&tr>=3&&(nt[tr]!==nt[0]||nt[tr+1]!==nt[1])&&pl(nt,nt[0],nt[1],nt[2]),nt.length&&ce.push(nt)}function js(Ke){const ce=[];return ce.size=Ke.size,ce.start=Ke.start,ce.end=Ke.end,ce}function ga(Ke,ce,me,je,Ge,Pe){for(const He of Ke)na(He,ce,me,je,Ge,Pe,!1)}function pl(Ke,ce,me,je){Ke.push(ce,me,je)}function ml(Ke,ce,me,je,Ge,Pe){const He=(Pe-ce)/(je-ce);return pl(Ke,Pe,me+(Ge-me)*He,1),He}function Wl(Ke,ce,me,je,Ge,Pe){const He=(Pe-me)/(Ge-me);return pl(Ke,ce+(je-ce)*He,Pe,1),He}function pc(Ke,ce){const me=[];for(let je=0;je<Ke.length;je++){const Ge=Ke[je],Pe=Ge.type;let He;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")He=Wc(Ge.geometry,ce);else if(Pe==="MultiLineString"||Pe==="Polygon"){He=[];for(const nt of Ge.geometry)He.push(Wc(nt,ce))}else if(Pe==="MultiPolygon"){He=[];for(const nt of Ge.geometry){const Xe=[];for(const ct of nt)Xe.push(Wc(ct,ce));He.push(Xe)}}me.push(yr(Ge.id,Pe,He,Ge.tags))}return me}function Wc(Ke,ce){const me=[];me.size=Ke.size,Ke.start!==void 0&&(me.start=Ke.start,me.end=Ke.end);for(let je=0;je<Ke.length;je+=3)me.push(Ke[je]+ce,Ke[je+1],Ke[je+2]);return me}function Hc(Ke,ce){if(Ke.transformed)return Ke;const me=1<<Ke.z,je=Ke.x,Ge=Ke.y;for(const Pe of Ke.features){const He=Pe.geometry,nt=Pe.type;if(Pe.geometry=[],nt===1)for(let Xe=0;Xe<He.length;Xe+=2)Pe.geometry.push(Gn(He[Xe],He[Xe+1],ce,me,je,Ge));else for(let Xe=0;Xe<He.length;Xe++){const ct=[];for(let Rt=0;Rt<He[Xe].length;Rt+=2)ct.push(Gn(He[Xe][Rt],He[Xe][Rt+1],ce,me,je,Ge));Pe.geometry.push(ct)}}return Ke.transformed=!0,Ke}function Gn(Ke,ce,me,je,Ge,Pe){return[Math.round(me*(Ke*je-Ge)),Math.round(me*(ce*je-Pe))]}function Ws(Ke,ce,me,je,Ge){const Pe=ce===Ge.maxZoom?0:Ge.tolerance/((1<<ce)*Ge.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:me,y:je,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const nt of Ke)jn(He,nt,Pe,Ge);return He}function jn(Ke,ce,me,je){const Ge=ce.geometry,Pe=ce.type,He=[];if(Ke.minX=Math.min(Ke.minX,ce.minX),Ke.minY=Math.min(Ke.minY,ce.minY),Ke.maxX=Math.max(Ke.maxX,ce.maxX),Ke.maxY=Math.max(Ke.maxY,ce.maxY),Pe==="Point"||Pe==="MultiPoint")for(let nt=0;nt<Ge.length;nt+=3)He.push(Ge[nt],Ge[nt+1]),Ke.numPoints++,Ke.numSimplified++;else if(Pe==="LineString")mi(He,Ge,Ke,me,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let nt=0;nt<Ge.length;nt++)mi(He,Ge[nt],Ke,me,Pe==="Polygon",nt===0);else if(Pe==="MultiPolygon")for(let nt=0;nt<Ge.length;nt++){const Xe=Ge[nt];for(let ct=0;ct<Xe.length;ct++)mi(He,Xe[ct],Ke,me,!0,ct===0)}if(He.length){let nt=ce.tags||null;if(Pe==="LineString"&&je.lineMetrics){nt={};for(const ct in ce.tags)nt[ct]=ce.tags[ct];nt.mapbox_clip_start=Ge.start/Ge.size,nt.mapbox_clip_end=Ge.end/Ge.size}const Xe={geometry:He,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:nt};ce.id!==null&&(Xe.id=ce.id),Ke.features.push(Xe)}}function mi(Ke,ce,me,je,Ge,Pe){const He=je*je;if(je>0&&ce.size<(Ge?He:je))return void(me.numPoints+=ce.length/3);const nt=[];for(let Xe=0;Xe<ce.length;Xe+=3)(je===0||ce[Xe+2]>He)&&(me.numSimplified++,nt.push(ce[Xe],ce[Xe+1])),me.numPoints++;Ge&&function(Xe,ct){let Rt=0;for(let Nt=0,tr=Xe.length,_r=tr-2;Nt<tr;_r=Nt,Nt+=2)Rt+=(Xe[Nt]-Xe[_r])*(Xe[Nt+1]+Xe[_r+1]);if(Rt>0===ct)for(let Nt=0,tr=Xe.length;Nt<tr/2;Nt+=2){const _r=Xe[Nt],Er=Xe[Nt+1];Xe[Nt]=Xe[tr-2-Nt],Xe[Nt+1]=Xe[tr-1-Nt],Xe[tr-2-Nt]=_r,Xe[tr-1-Nt]=Er}}(nt,Pe),Ke.push(nt)}const ii={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class bo{constructor(ce,me){const je=(me=this.options=function(Pe,He){for(const nt in He)Pe[nt]=He[nt];return Pe}(Object.create(ii),me)).debug;if(je&&console.time("preprocess data"),me.maxZoom<0||me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(me.promoteId&&me.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ge=function(Pe,He){const nt=[];if(Pe.type==="FeatureCollection")for(let Xe=0;Xe<Pe.features.length;Xe++)Or(nt,Pe.features[Xe],He,Xe);else Or(nt,Pe.type==="Feature"?Pe:{geometry:Pe},He);return nt}(ce,me);this.tiles={},this.tileCoords=[],je&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",me.indexMaxZoom,me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ge=function(Pe,He){const nt=He.buffer/He.extent;let Xe=Pe;const ct=Ta(Pe,1,-1-nt,nt,0,-1,2,He),Rt=Ta(Pe,1,1-nt,2+nt,0,-1,2,He);return(ct||Rt)&&(Xe=Ta(Pe,1,-nt,1+nt,0,-1,2,He)||[],ct&&(Xe=pc(ct,1).concat(Xe)),Rt&&(Xe=Xe.concat(pc(Rt,-1)))),Xe}(Ge,me),Ge.length&&this.splitTile(Ge,0,0,0),je&&(Ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ce,me,je,Ge,Pe,He,nt){const Xe=[ce,me,je,Ge],ct=this.options,Rt=ct.debug;for(;Xe.length;){Ge=Xe.pop(),je=Xe.pop(),me=Xe.pop(),ce=Xe.pop();const Nt=1<<me,tr=Ea(me,je,Ge);let _r=this.tiles[tr];if(!_r&&(Rt>1&&console.time("creation"),_r=this.tiles[tr]=Ws(ce,me,je,Ge,ct),this.tileCoords.push({z:me,x:je,y:Ge}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",me,je,Ge,_r.numFeatures,_r.numPoints,_r.numSimplified),console.timeEnd("creation"));const gn=`z${me}`;this.stats[gn]=(this.stats[gn]||0)+1,this.total++}if(_r.source=ce,Pe==null){if(me===ct.indexMaxZoom||_r.numPoints<=ct.indexMaxPoints)continue}else{if(me===ct.maxZoom||me===Pe)continue;if(Pe!=null){const gn=Pe-me;if(je!==He>>gn||Ge!==nt>>gn)continue}}if(_r.source=null,ce.length===0)continue;Rt>1&&console.time("clipping");const Er=.5*ct.buffer/ct.extent,$r=.5-Er,Qr=.5+Er,Rr=1+Er;let Nr=null,li=null,vs=null,Wi=null,Hi=Ta(ce,Nt,je-Er,je+Qr,0,_r.minX,_r.maxX,ct),xi=Ta(ce,Nt,je+$r,je+Rr,0,_r.minX,_r.maxX,ct);ce=null,Hi&&(Nr=Ta(Hi,Nt,Ge-Er,Ge+Qr,1,_r.minY,_r.maxY,ct),li=Ta(Hi,Nt,Ge+$r,Ge+Rr,1,_r.minY,_r.maxY,ct),Hi=null),xi&&(vs=Ta(xi,Nt,Ge-Er,Ge+Qr,1,_r.minY,_r.maxY,ct),Wi=Ta(xi,Nt,Ge+$r,Ge+Rr,1,_r.minY,_r.maxY,ct),xi=null),Rt>1&&console.timeEnd("clipping"),Xe.push(Nr||[],me+1,2*je,2*Ge),Xe.push(li||[],me+1,2*je,2*Ge+1),Xe.push(vs||[],me+1,2*je+1,2*Ge),Xe.push(Wi||[],me+1,2*je+1,2*Ge+1)}}getTile(ce,me,je){ce=+ce,me=+me,je=+je;const Ge=this.options,{extent:Pe,debug:He}=Ge;if(ce<0||ce>24)return null;const nt=1<<ce,Xe=Ea(ce,me=me+nt&nt-1,je);if(this.tiles[Xe])return Hc(this.tiles[Xe],Pe);He>1&&console.log("drilling down to z%d-%d-%d",ce,me,je);let ct,Rt=ce,Nt=me,tr=je;for(;!ct&&Rt>0;)Rt--,Nt>>=1,tr>>=1,ct=this.tiles[Ea(Rt,Nt,tr)];return ct&&ct.source?(He>1&&(console.log("found parent tile z%d-%d-%d",Rt,Nt,tr),console.time("drilling down")),this.splitTile(ct.source,Rt,Nt,tr,ce,me,je),He>1&&console.timeEnd("drilling down"),this.tiles[Xe]?Hc(this.tiles[Xe],Pe):null):null}}function Ea(Ke,ce,me){return 32*((1<<Ke)*me+ce)+Ke}function kt(Ke,ce){const me=Ke.tileID.canonical;if(!this._geoJSONIndex)return void ce(null,null);const je=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!je)return void ce(null,null);const Ge=ct=>ct.tags&&"3d_elevation_id"in ct.tags&&"source"in ct.tags&&ct.tags.source==="elevation",Pe=je.features.filter(ct=>Ge(ct));let He={_geojsonTileLayer:je.features};Pe.length>0&&(He={_geojsonTileLayer:je.features.filter(ct=>!Ge(ct)),hd_road_elevation:Pe});const nt=new ze(He),Xe=function(ct){const Rt=new s.bt;for(const Nt of Object.keys(ct))Rt.writeMessage(3,pt,{name:Nt,features:ct[Nt]});return Rt.finish()}(He).buffer;ce(null,{vectorTile:nt,rawData:Xe})}class Ba extends ie{constructor(ce,me,je,Ge,Pe,He,nt){super(ce,me,je,Ge,Pe,kt,nt),He&&(this.loadGeoJSON=He),this._dynamicIndex=new Be}loadData(ce,me){const je=ce&&ce.request,Ge=je&&je.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ce,(Pe,He)=>{if(Pe||!He)return me(Pe);if(typeof He!="object")return me(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));{try{if(ce.filter){const Xe=s.U(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Xe.result==="error")throw new Error(Xe.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));He.features=He.features.filter(ct=>Xe.value.evaluate({zoom:0},ct))}ce.dynamic?(He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),ce.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(He.features,this.loaded),ce.cluster&&(He.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ce.cluster?new Jn(function({superclusterOptions:Xe,clusterProperties:ct}){if(!ct||!Xe)return Xe;const Rt={},Nt={},tr={accumulated:null,zoom:0},_r={properties:null},Er=Object.keys(ct);for(const $r of Er){const[Qr,Rr]=ct[$r],Nr=s.U(Rr),li=s.U(typeof Qr=="string"?[Qr,["accumulated"],["get",$r]]:Qr);Rt[$r]=Nr.value,Nt[$r]=li.value}return Xe.map=$r=>{_r.properties=$r;const Qr={};for(const Rr of Er)Qr[Rr]=Rt[Rr].evaluate(tr,_r);return Qr},Xe.reduce=($r,Qr)=>{_r.properties=Qr;for(const Rr of Er)tr.accumulated=$r[Rr],$r[Rr]=Nt[Rr].evaluate(tr,_r)},Xe}(ce)).load(He.features):ce.dynamic?this._dynamicIndex:function(Xe,ct){return new bo(Xe,ct)}(He,ce.geojsonVtOptions)}catch(Xe){return me(Xe)}const nt={};if(Ge){const Xe=_(je);Xe&&(nt.resourceTiming={},nt.resourceTiming[ce.source]=JSON.parse(JSON.stringify(Xe)))}me(null,nt)}})}reloadTile(ce,me){const je=this.loaded;return je&&je[ce.uid]?ce.partial?me(null,void 0):super.reloadTile(ce,me):this.loadTile(ce,me)}loadGeoJSON(ce,me){if(ce.request)s.m(ce.request,me);else{if(typeof ce.data!="string")return me(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return me(null,JSON.parse(ce.data))}catch{return me(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ce,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(je){me(je)}}getClusterChildren(ce,me){try{me(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(je){me(je)}}getClusterLeaves(ce,me){try{me(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(je){me(je)}}}class wo{constructor(ce,me,je){this.tileID=new s.aQ(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ce.projection,this.brightness=me,this.worldview=je}parse(ce,me,je,Ge){this.status="parsing";const Pe=new s.aQ(je.tileID.overscaledZ,je.tileID.wrap,je.tileID.canonical.z,je.tileID.canonical.x,je.tileID.canonical.y),He=[],nt=me.familiesBySource[je.source],Xe=new s.fn(Pe,je.promoteId);Xe.bucketLayerIDs=[],Xe.is3DTile=!0,s.fC(ce).then(ct=>{if(!ct)return Ge(new Error("Could not parse tile"));const Rt=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||ct.json.asset.extras&&ct.json.asset.extras.MAPBOX_mesh_features,Nt=ct.json.extensionsUsed&&ct.json.extensionsUsed.includes("EXT_meshopt_compression"),tr=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const _r in nt)for(const Er of nt[_r]){const $r=Er[0];Xe.bucketLayerIDs.push(Er.map(Nr=>s.B(Nr.id,Nr.scope))),$r.recalculate(tr,[]);const Qr=s.fD(ct,1/s.d7(je.tileID.canonical)),Rr=new s.fE(Er,Qr,Pe,Rt,Nt,this.brightness,Xe,this.worldview);Rt||(Rr.needsUpload=!0),He.push(Rr),Rr.evaluate($r)}this.status="done",Ge(null,{buckets:He,featureIndex:Xe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ct=>Ge(new Error(ct.message)))}}class qo{constructor(ce,me,je,Ge,Pe,He,nt,Xe){this.actor=ce,this.layerIndex=me,this.availableImages=je,this.availableModels=Ge,this.brightness=nt,this.loading={},this.loaded={},this.worldview=Xe}loadTile(ce,me){const je=ce.uid,Ge=this.loading[je]=new wo(ce,this.brightness,this.worldview);s.bu(ce.request,(Pe,He)=>{const nt=!this.loading[je];return delete this.loading[je],nt||Pe?(Ge.status="done",nt||(this.loaded[je]=Ge),me(Pe)):He&&He.byteLength!==0?void Ge.parse(He,this.layerIndex,ce,(Xe,ct)=>{Ge.status="done",this.loaded=this.loaded||{},this.loaded[je]=Ge,Xe||!ct?me(Xe):me(null,ct)}):(Ge.status="done",this.loaded[je]=Ge,me())})}reloadTile(ce,me){const je=this.loaded,Ge=ce.uid;if(je&&je[Ge]){const Pe=je[Ge];Pe.projection=ce.projection,Pe.brightness=ce.brightness;const He=(nt,Xe)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(ce,me)),me(nt,Xe)};Pe.status==="parsing"?Pe.reloadCallback=He:Pe.status==="done"&&this.loadTile(ce,me)}}abortTile(ce,me){const je=ce.uid;this.loading[je]&&delete this.loading[je],me()}removeTile(ce,me){const je=this.loaded,Ge=ce.uid;je&&je[Ge]&&delete je[Ge],me()}}class _n{constructor(ce){this.self=ce,this.actor=new s.fG(ce,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:ie,geojson:Ba,"raster-dem":ge,"raster-array":be,"batched-model":qo},this.workerSources={},this.self.registerWorkerSource=(me,je)=>{if(this.workerSourceTypes[me])throw new Error(`Worker source with name "${me}" already registered.`);this.workerSourceTypes[me]=je},this.self.registerRTLTextPlugin=me=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=me.applyArabicShaping,s.fH.processBidirectionalText=me.processBidirectionalText,s.fH.processStyledBidirectionalText=me.processStyledBidirectionalText;for(const je of this.rtlPluginParsingListeners)je(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ce,me,je){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.availableModels[ce],delete this.workerSources[ce],je()}checkIfReady(ce,me,je){je()}setReferrer(ce,me){this.referrer=me}spriteLoaded(ce,me){this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={});const{scope:je,isLoaded:Ge}=me;if(this.isSpriteLoaded[ce][je]=Ge,this.workerSources[ce]&&this.workerSources[ce][je])for(const Pe in this.workerSources[ce][je]){const He=this.workerSources[ce][je][Pe];for(const nt in He){const Xe=He[nt];Xe instanceof ie&&(Xe.isSpriteLoaded=Ge,Xe.fire(new s.z("isSpriteLoaded")))}}}setImages(ce,me,je){this.availableImages[ce]||(this.availableImages[ce]={});const{scope:Ge,images:Pe}=me;if(this.availableImages[ce][Ge]=Pe,this.workerSources[ce]&&this.workerSources[ce][Ge]){for(const He in this.workerSources[ce][Ge]){const nt=this.workerSources[ce][Ge][He];for(const Xe in nt)nt[Xe].availableImages=Pe}je()}else je()}setModels(ce,{scope:me,models:je},Ge){if(this.availableModels[ce]||(this.availableModels[ce]={}),this.availableModels[ce][me]=je,this.workerSources[ce]&&this.workerSources[ce][me]){for(const Pe in this.workerSources[ce][me]){const He=this.workerSources[ce][me][Pe];for(const nt in He)He[nt].availableModels=je}Ge()}else Ge()}setProjection(ce,me){this.projections[ce]=s.cm(me)}setBrightness(ce,me,je){this.brightness=me,je()}setWorldview(ce,me,je){this.worldview=me,je()}setLayers(ce,me,je){this.getLayerIndex(ce,me.scope).replace(me.layers,me.options),je()}updateLayers(ce,me,je){this.getLayerIndex(ce,me.scope).update(me.layers,me.removedIds,me.options),je()}loadTile(ce,me,je){me.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,me.type,me.source,me.scope).loadTile(me,je)}decodeRasterArray(ce,me,je){this.getWorkerSource(ce,me.type,me.source,me.scope).decodeRasterArray(me,je)}reloadTile(ce,me,je){me.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,me.type,me.source,me.scope).reloadTile(me,je)}abortTile(ce,me,je){this.getWorkerSource(ce,me.type,me.source,me.scope).abortTile(me,je)}removeTile(ce,me,je){this.getWorkerSource(ce,me.type,me.source,me.scope).removeTile(me,je)}removeSource(ce,me,je){if(!(this.workerSources[ce]&&this.workerSources[ce][me.scope]&&this.workerSources[ce][me.scope][me.type]&&this.workerSources[ce][me.scope][me.type][me.source]))return;const Ge=this.workerSources[ce][me.scope][me.type][me.source];delete this.workerSources[ce][me.scope][me.type][me.source],Ge.removeSource!==void 0?Ge.removeSource(me,je):je()}loadWorkerSource(ce,me,je){try{this.self.importScripts(me.url),je()}catch(Ge){je(Ge)}}syncRTLPluginState(ce,me,je){if(s.fH.isParsed())je(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(je);else try{s.fH.setState(me);const Ge=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||Ge==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(Ge),s.fH.isParsed()?je(null,!0):this.rtlPluginParsingListeners.push(je))}catch(Ge){je(Ge)}}setDracoUrl(ce,me){this.dracoUrl=me}getAvailableImages(ce,me){this.availableImages[ce]||(this.availableImages[ce]={});let je=this.availableImages[ce][me];return je||(je=[]),je}getAvailableModels(ce,me){this.availableModels[ce]||(this.availableModels[ce]={});let je=this.availableModels[ce][me];return je||(je={}),je}getLayerIndex(ce,me){this.layerIndexes[ce]||(this.layerIndexes[ce]={});let je=this.layerIndexes[ce][me];return je||(je=this.layerIndexes[ce][me]=new P,je.scope=me),je}getWorkerSource(ce,me,je,Ge){const Pe=this.workerSources;return Pe[ce]||(Pe[ce]={}),Pe[ce][Ge]||(Pe[ce][Ge]={}),Pe[ce][Ge][me]||(Pe[ce][Ge][me]={}),this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={}),Pe[ce][Ge][me][je]||(Pe[ce][Ge][me][je]=new this.workerSourceTypes[me]({send:(He,nt,Xe,ct,Rt,Nt)=>this.actor.send(He,nt,Xe,ce,Rt,Nt),scheduler:this.actor.scheduler},this.getLayerIndex(ce,Ge),this.getAvailableImages(ce,Ge),this.getAvailableModels(ce,Ge),this.isSpriteLoaded[ce][Ge],void 0,this.brightness,this.worldview)),Pe[ce][Ge][me][je]}rasterizeImagesWorker(ce,me,je){const Ge=new Map;for(const[Pe,{image:He,imageVariant:nt}]of me.tasks.entries()){const Xe=this.imageRasterizer.rasterize(nt,He,me.scope,ce);Ge.set(Pe,Xe)}je(void 0,Ge)}removeRasterizedImages(ce,me,je){this.imageRasterizer.removeImagesFromCacheByIds(me.imageIds,me.scope,ce),je()}enforceCacheSizeLimit(ce,me){s.fJ(me)}getWorkerPerformanceMetrics(ce,me,je){je(void 0,void 0)}}return s.fF(self)&&(self.worker=new _n(self)),_n}),d(["./shared"],function(s){var _="3.18.0";const b={create:"create",load:"load",fullLoad:"fullLoad"},T={mark(g){performance.mark(g)},measure(g,o,f){performance.measure(g,o,f)}};function C(g){const o=g.name.split("?")[0];return s.a(o)&&o.includes("mapbox-gl.js")?"javascript":s.a(o)&&o.includes("mapbox-gl.css")?"css":s.b(o)?"fontRange":s.c(o)?"sprite":s.i(o)?"style":s.d(o)?"tilejson":"other"}var P,k={},B=function(){if(P)return k;function g(y){return!o(y)}function o(y){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,j,I=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(I);try{j=new Worker(O),E=!0}catch{E=!1}return j&&j.terminate(),URL.revokeObjectURL(O),E}()?function(){var E=document.createElement("canvas");E.width=E.height=1;var j=E.getContext("2d");if(!j)return!1;var I=j.getImageData(0,0,1,1);return I&&I.width===E.width}()?(f[w=y&&y.failIfMajorPerformanceCaveat]===void 0&&(f[w]=function(E){var j,I=function(O){var U=document.createElement("canvas"),q=Object.create(g.webGLContextAttributes);return q.failIfMajorPerformanceCaveat=O,U.getContext("webgl2",q)}(E);if(!I)return!1;try{j=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!j||I.isContextLost())&&(I.shaderSource(j,"void main() {}"),I.compileShader(j),I.getShaderParameter(j,I.COMPILE_STATUS)===!0)}(w)),f[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}P=1,k.supported=g,k.notSupportedReason=o;var f={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},k}();function R(g,o,f){const y=document.createElement(g);return o!=null&&(y.className=o),f&&f.appendChild(y),y}function D(g,o,f){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const w of Object.keys(o))y.setAttributeNS(null,w,String(o[w]));return f&&f.appendChild(y),y}const G=typeof document<"u"?document.documentElement&&document.documentElement.style:null,V=G&&G.userSelect!==void 0?"userSelect":"WebkitUserSelect";let $;function K(){G&&V&&($=G[V],G[V]="none")}function Y(){G&&V&&(G[V]=$)}function ee(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ee,!0)}function ae(){window.addEventListener("click",ee,!0),window.setTimeout(()=>{window.removeEventListener("click",ee,!0)},0)}function ie(g,o){const f=g.getBoundingClientRect();return be(g,f,o)}function ge(g,o){const f=g.getBoundingClientRect(),y=[];for(let w=0;w<o.length;w++)y.push(be(g,f,o[w]));return y}function fe(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function be(g,o,f){const y=g.offsetWidth===o.width?1:g.offsetWidth/o.width;return new s.P((f.clientX-o.left)*y,(f.clientY-o.top)*y)}const ue="01",Ce="NO_ACCESS_TOKEN";class ve{constructor(o,f,y){this._transformRequestFn=o,this._customAccessToken=f,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const o=function(){let f="";for(let y=0;y<10;y++)f+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,f].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,f){return this._transformRequestFn&&this._transformRequestFn(o,f)||{url:o}}normalizeStyleURL(o,f){if(!s.h(o))return o;const y=Me(o);return y.params.push(`sdk=js-${_}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||f)}normalizeGlyphsURL(o,f){if(!s.h(o))return o;const y=Me(o);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||f)}normalizeModelURL(o,f){if(!s.h(o))return o;const y=Me(o);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||f)}normalizeSourceURL(o,f,y,w){if(!s.h(o))return o;const E=Me(o);return E.path=`/v4/${E.authority}.json`,E.params.push("secure"),y&&E.params.push(`language=${y}`),w&&E.params.push(`worldview=${w}`),this._makeAPIURL(E,this._customAccessToken||f)}normalizeIconsetURL(o,f){const y=Me(o);return s.h(o)?(y.path=`/styles/v1${y.path}/iconset.pbf`,this._makeAPIURL(y,this._customAccessToken||f)):Be(y)}normalizeSpriteURL(o,f,y,w){const E=Me(o);return s.h(o)?(E.path=`/styles/v1${E.path}/sprite${f}${y}`,this._makeAPIURL(E,this._customAccessToken||w)):(E.path+=`${f}${y}`,Be(E))}normalizeTileURL(o,f,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!s.h(o))return o;const w=Me(o);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${f||y&&w.authority!=="raster"&&y===512?"@2x":""}${s.k.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${s.e.RASTER_URL_PREFIX}${w.path}`:w.authority==="rasterarrays"?w.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${w.path}`:w.authority==="3dtiles"?w.path=`/${s.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${s.e.TILE_URL_VERSION}${w.path}`);const E=this._customAccessToken||function(j){for(const I of j){const O=I.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(w.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,E)}canonicalizeTileURL(o,f){const y=Me(o);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return o;let w="mapbox://";y.path.match(/^\/raster\/v1\//)?w+=`raster/${y.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${y.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${y.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let E=y.params;return f&&(E=E.filter(j=>!j.match(/^access_token=/))),E.length&&(w+=`?${E.join("&")}`),w}canonicalizeTileset(o,f){const y=!!f&&s.h(f),w=[];for(const E of o.tiles||[])s.j(E)?w.push(this.canonicalizeTileURL(E,y)):w.push(E);return w}_makeAPIURL(o,f){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=Me(s.e.API_URL);if(o.protocol=w.protocol,o.authority=w.authority,o.protocol==="http"){const E=o.params.indexOf("secure");E>=0&&o.params.splice(E,1)}if(w.path!=="/"&&(o.path=`${w.path}${o.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Be(o);if(f=f||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!f)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(f[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return o.params=o.params.filter(E=>E.indexOf("access_token")===-1),o.params.push(`access_token=${f||""}`),Be(o)}}const ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Me(g){const o=g.match(ze);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Be(g){const o=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${o}`}const Ve="mapbox.eventData";function We(g){if(!g)return null;const o=g.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(s.l(o[1]))}catch{return null}}class Ee{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const f=We(s.e.ACCESS_TOKEN);let y="";return y=f&&f.u?s.f(f.u):s.e.ACCESS_TOKEN||"",o?`${Ve}.${o}:${y}`:`${Ve}:${y}`}fetchEventData(){const o=s.s("localStorage"),f=this.getStorageKey(),y=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp");if(o)try{const E=localStorage.getItem(f);E&&(this.eventData=JSON.parse(E));const j=localStorage.getItem(y);j&&(this.anonId=j);const I=localStorage.getItem(w);I&&(this.anonIdTimestamp=Number(I));const O=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<O)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=s.s("localStorage"),f=this.getStorageKey(),y=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp"),E=this.anonId,j=this.anonIdTimestamp;if(o&&E)try{localStorage.setItem(y,E),Object.keys(this.eventData).length>=1&&localStorage.setItem(f,JSON.stringify(this.eventData)),j&&localStorage.setItem(w,j.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,f,y,w){if(!s.e.EVENTS_URL)return;const E=Me(s.e.EVENTS_URL);E.params.push(`access_token=${w||s.e.ACCESS_TOKEN||""}`);const j={event:this.type,created:new Date(o).toISOString()},I=f?Object.assign(j,f):j,O={url:Be(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(O,U=>{this.pendingRequest=null,y(U),this.saveEventData(),this.processRequests(w)})}queueRequest(o,f){this.queue.push(o),this.processRequests(f)}}class ot extends Ee{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!s.e.EVENTS_URL||!o&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const f=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:f},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:f,payload:y}=this.queue.shift();this.postEvent(f,y,()=>{},o)}}const yt=new class extends Ee{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,o){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(f=>s.h(f)||s.j(f))&&this.queueRequest(Date.now(),o)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=We(s.e.ACCESS_TOKEN),f=o?o.u:s.e.ACCESS_TOKEN;let y=f!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),y=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),j=new Date(w),I=(w-this.eventData.lastSuccess)/864e5;y=y||I>=1||I<-1||E.getDate()!==j.getDate()}else y=!0;y?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:ue,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=w,this.eventData.tokenU=f)},g):this.processRequests()}},Je=yt.postTurnstileEvent.bind(yt),Bt=new class extends Ee{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,o,f,y){this.skuToken=o,this.errorCb=y,s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},f):this.errorCb(new Error(Ce)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:f}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:ue,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g))}remove(){this.errorCb=null}},Pt=Bt.postMapLoadEvent.bind(Bt),pt=new class extends Ee{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let o=this.mapInstanceIdMap.get(g);return o||(o=s.u(),this.mapInstanceIdMap.set(g,o)),o}getEventId(g){const o=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,o+1),o}postStyleLoadEvent(g,o){const{map:f,style:y,importedStyles:w}=o;if(!s.e.EVENTS_URL||!g&&!s.e.ACCESS_TOKEN)return;const E=this.getMapInstanceId(f),j={mapInstanceId:E,eventId:this.getEventId(E),style:y};w.length&&(j.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:j},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:f}=this.queue.shift();this.postEvent(o,f,()=>{},g)}},Gt=pt.postStyleLoadEvent.bind(pt),Pr=new ot({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ot=Pr.postMetricsEvent.bind(Pr),nr=new ot({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),ur=nr.postMetricsEvent.bind(nr),Et=new class extends Ee{constructor(){super("gljs.performance")}postPerformanceEvent(g,o){s.e.EVENTS_URL&&(g||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:f}=this.queue.shift(),y=function(w){const E=performance.getEntriesByType("resource"),j=performance.getEntriesByType("mark"),I=function(J){const se={};if(J){for(const re in J)if(re!=="other")for(const oe of J[re]){const he=`${re}ResolveRangeMin`,xe=`${re}ResolveRangeMax`,_e=`${re}RequestCount`,ye=`${re}RequestCachedCount`;se[he]=Math.min(se[he]||1/0,oe.startTime),se[xe]=Math.max(se[xe]||-1/0,oe.responseEnd);const Le=ke=>{se[ke]===void 0&&(se[ke]=0),++se[ke]};oe.transferSize!==void 0&&oe.transferSize===0&&Le(ye),Le(_e)}}return se}(function(J,se){const re={};if(J)for(const oe of J){const he=se(oe);re[he]===void 0&&(re[he]=[]),re[he].push(oe)}return re}(E,C)),O=window.devicePixelRatio,U=navigator.connection||navigator.mozConnection||navigator.webkitConnection,q=U?U.effectiveType:void 0,X={counters:[],metadata:[],attributes:[]},Z=(J,se,re)=>{re!=null&&J.push({name:se,value:re.toString()})};for(const J in I)Z(X.counters,J,I[J]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(Z(X.counters,"interactionRangeMin",w.interactionRange[0]),Z(X.counters,"interactionRangeMax",w.interactionRange[1])),j)for(const J of Object.values(b)){const se=j.find(re=>re.name===J);se&&Z(X.counters,J,se.startTime)}return Z(X.counters,"visibilityHidden",w.visibilityHidden),Z(X.attributes,"style",function(J){if(J)for(const se of J){const re=se.name.split("?")[0];if(s.i(re)){const oe=re.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(E)),Z(X.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),Z(X.attributes,"fogEnabled",w.fogEnabled?"true":"false"),Z(X.attributes,"projection",w.projection),Z(X.attributes,"zoom",w.zoom),Z(X.metadata,"devicePixelRatio",O),Z(X.metadata,"connectionEffectiveType",q),Z(X.metadata,"navigatorUserAgent",navigator.userAgent),Z(X.metadata,"screenWidth",window.screen.width),Z(X.metadata,"screenHeight",window.screen.height),Z(X.metadata,"windowWidth",window.innerWidth),Z(X.metadata,"windowHeight",window.innerHeight),Z(X.metadata,"mapWidth",w.width/O),Z(X.metadata,"mapHeight",w.height/O),Z(X.metadata,"webglRenderer",w.renderer),Z(X.metadata,"webglVendor",w.vendor),Z(X.metadata,"sdkVersion",_),Z(X.metadata,"sdkIdentifier","mapbox-gl-js"),X}(f);for(const w of y.metadata);for(const w of y.counters);for(const w of y.attributes);this.postEvent(o,y,()=>{},g)}},pr=Et.postPerformanceEvent.bind(Et),Kr=new class extends Ee{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,o,f,y){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const w=Me(s.e.API_URL+s.e.SESSION_PATH);w.params.push(`sku=${o||""}`),w.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const E={url:Be(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(E,j=>{this.pendingRequest=null,f(j),this.saveEventData(),this.processRequests(y)})}getSessionAPI(g,o,f,y){this.skuToken=o,this.errorCb=y,s.e.SESSION_PATH&&s.e.API_URL&&(f||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},f):this.errorCb(new Error(Ce)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:f}=this.queue.shift();o&&this.success[o]||this.getSession(f,this.skuToken,y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g)}remove(){this.errorCb=null}},Xn=Kr.getSessionAPI.bind(Kr),Jn=new Set;function ni(g,o){o?Jn.add(g):Jn.delete(g)}class zn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,f){this._updatedSourceCaches[o]=f,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const f=o.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(o.id),this.setDirty()}removeLayer(o){const f=o.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][o.id]=o,this._updatedLayers[f].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const f in this._updatedLayers)o[f]=o[f]||{},o[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)o[f]=o[f]||{},o[f].removedIds=Object.keys(this._removedLayers[f]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,f){this._updatedImages[f]=this._updatedImages[f]||new Set,this._updatedImages[f].add(s.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function hs(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class lt extends s.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new s.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const f=this.atlasTexture.get(o);f&&(f.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,f){this.imageProviders.has(f)||this.imageProviders.set(f,new Map),this.imageProviders.get(f).set(o.id,o)}removeImageProvider(o,f){this.imageProviders.has(f)&&this.imageProviders.get(f).delete(o)}getPendingImageProviders(){const o=[];for(const f of this.imageProviders.values())for(const y of f.values())y.hasPendingRequests()&&o.push(y);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,f){if(this.loaded.get(f)!==o&&(this.loaded.set(f,o),o)){for(const{ids:y,callback:w}of this.requestors)this._notify(y,f,w);this.requestors=[]}}hasImage(o,f){return!!this.getImage(o,f)}getImage(o,f){return this.images.get(f).get(o.toString())}addImage(o,f,y){this._validate(o,y)&&this.images.get(f).set(o.toString(),y)}_validate(o,f){let y=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "content" value`))),y=!1),y}_validateStretch(o,f){if(!o)return!0;let y=0;for(const w of o){if(w[0]<y||w[1]<w[0]||f<w[1])return!1;y=w[1]}return!0}_validateContent(o,f){return o?o.length!==4||!f.usvg&&(o[0]<0||f.data.width<o[0]||o[1]<0||f.data.height<o[1]||o[2]<0||f.data.width<o[2]||o[3]<0||f.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,f,y){const w=this.images.get(f).get(o.toString());y.version=w.version+1,this.images.get(f).set(o.toString(),y),this.updatedImages.get(f).add(o),this.removeFromImageRasterizerCache(o,f)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,f){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:f}):this.imageRasterizer.removeImagesFromCacheByIds([o],f))}removeImage(o,f){const y=this.images.get(f),w=y.get(o.toString());y.delete(o.toString()),this.patterns.get(f).delete(o.toString()),this.removeFromImageRasterizerCache(o,f),w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(f=>s.I.from(f))}getImages(o,f,y){const w=[],E=[],j=this.imageProviders.get(f);for(const q of o){if(!q.iconsetId){w.push(q);continue}const X=j.get(q.iconsetId);X&&(this.getImage(q,f)?E.push(q):X.addPendingRequest(q))}if(w.length===0)return void this._notify(E,f,y);let I=!0;const O=!!this.loaded.get(f),U=this.images.get(f);if(!O)for(const q of w)U.has(q.toString())||(I=!1);O||I?this._notify(w,f,y):this.requestors.push({ids:w,scope:f,callback:y})}rasterizeImages(o,f){const y=new Map,{tasks:w,scope:E}=o;for(const[j,I]of w.entries()){const O=this.getImage(I.id,E);O&&y.set(j,{image:O,imageVariant:I})}this._rasterizeImages(E,y,f)}_rasterizeImages(o,f,y){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:f,scope:o},y);else{const w=new Map;for(const[E,{image:j,imageVariant:I}]of f.entries())w.set(E,this.imageRasterizer.rasterize(I,j,o,0));y(void 0,w)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,f,y){const w=this.images.get(f),E=new Map;for(const j of o){if(!w.get(j.toString())){if(j.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:j.name}))}const I=w.get(j.toString());if(!I){s.w(`Image "${j.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(O,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),E.set(s.I.toString(j),O)}y(null,E)}getPixelSize(o){const{width:f,height:y}=this.atlasImage.get(o);return{width:f,height:y}}getPattern(o,f,y){const w=o.toString(),E=this.patterns.get(f),j=E.get(w),I=this.getImage(o,f);if(!I)return null;if(j){if(j.position.version===I.version)return j.position;j.position.version=I.version}else{if(I.usvg&&!I.data){const O=this.getPatternInFlightId(w,f);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const U=new s.A(o).scaleSelf(s.o.devicePixelRatio),q=new Map([[U.toString(),{image:I,imageVariant:U}]]);return this._rasterizeImages(f,q,(X,Z)=>this.storePatternImage(U,f,I,y,Z)),null}this.storePattern(o,f,I)}return this._updatePatternAtlas(f,y),E.get(w).position}getPatternInFlightId(o,f){return s.B(o,f)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,f,y,w,E){const j=o.toString(),I=E?E.get(j):void 0;I&&(y.data=I,this.storePattern(o.id,f,y),this._updatePatternAtlas(f,w),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),f)))}storePattern(o,f,y){const w={w:y.data.width+2*s.C,h:y.data.height+2*s.C,x:0,y:0},E=new s.F(w,y,s.C);this.patterns.get(f).set(o.toString(),{bin:w,position:E})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,f){const y=o.gl;let w=this.atlasTexture.get(f);w?this.dirty&&(w.update(this.atlasImage.get(f)),this.dirty=!1):(w=new s.T(o,this.atlasImage.get(f),y.RGBA8),this.atlasTexture.set(f,w)),w.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(o,f){const y=this.patterns.get(o),w=Array.from(y.values()).map(({bin:U})=>U),{w:E,h:j}=s.G(w),I=this.atlasImage.get(o);I.resize({width:E||1,height:j||1});const O=this.images.get(o);for(const[U,{bin:q,position:X}]of y.entries()){let Z=X.padding;const J=q.x+Z,se=q.y+Z,re=O.get(U).data,oe=re.width,he=re.height;Z=Z>1?Z-1:Z,s.q.copy(re,I,{x:0,y:0},{x:J,y:se},{width:oe,height:he},f),s.q.copy(re,I,{x:0,y:he-Z},{x:J,y:se-Z},{width:oe,height:Z},f),s.q.copy(re,I,{x:0,y:0},{x:J,y:se+he},{width:oe,height:Z},f),s.q.copy(re,I,{x:oe-Z,y:0},{x:J-Z,y:se},{width:Z,height:he},f),s.q.copy(re,I,{x:0,y:0},{x:J+oe,y:se},{width:Z,height:he},f),s.q.copy(re,I,{x:oe-Z,y:he-Z},{x:J-Z,y:se-Z},{width:Z,height:Z},f),s.q.copy(re,I,{x:0,y:he-Z},{x:J+oe,y:se-Z},{width:Z,height:Z},f),s.q.copy(re,I,{x:0,y:0},{x:J+oe,y:se+he},{width:Z,height:Z},f),s.q.copy(re,I,{x:oe-Z,y:0},{x:J-Z,y:se+he},{width:Z,height:Z},f)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,f){const y=this.images.get(f);for(const w of o){if(this.callbackDispatchedThisFrame.get(f).has(w.toString()))continue;this.callbackDispatchedThisFrame.get(f).add(w.toString());const E=y.get(w.toString());hs(E)&&this.updateImage(w,f,E)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ct(g){const o=g.value,f=g.valueSpec,y=g.style,w=g.styleSpec,E=g.key,j=g.arrayElementValidator||Gn;if(!Array.isArray(o))return[new s.V(E,o,`array expected, ${s.K(o)} found`)];if(f.length&&o.length!==f.length)return[new s.V(E,o,`array length ${f.length} expected, length ${o.length} found`)];if(f["min-length"]&&o.length<f["min-length"])return[new s.V(E,o,`array length at least ${f["min-length"]} expected, length ${o.length} found`)];let I={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};w.$version<7&&(I.function=f.function),s.H(f.value)&&(I=f.value);let O=[];for(let U=0;U<o.length;U++)O=O.concat(j({array:o,arrayIndex:U,value:o[U],valueSpec:I,style:y,styleSpec:w,key:`${E}[${U}]`},!0));return O}function Xt(g){const o=g.key,f=g.value,y=g.valueSpec;if(!s.L(f))return[new s.V(o,f,`number expected, ${s.K(f)} found`)];if(f!=f)return[new s.V(o,f,"number expected, NaN found")];if("minimum"in y){let w=y.minimum;if(Array.isArray(y.minimum)&&(w=y.minimum[g.arrayIndex]),f<w)return[new s.V(o,f,`${f} is less than the minimum value ${w}`)]}if("maximum"in y){let w=y.maximum;if(Array.isArray(y.maximum)&&(w=y.maximum[g.arrayIndex]),f>w)return[new s.V(o,f,`${f} is greater than the maximum value ${w}`)]}return[]}function Sr(g){const o=g.key,f=g.value;if(!s.H(f))return[new s.V(o,f,`object expected, ${s.K(f)} found`)];const y=g.valueSpec,w=s.J(f.type);let E,j,I,O={};const U=w!=="categorical"&&f.property===void 0,q=!U,X=function(re){const oe=re.stops;return Array.isArray(oe)&&Array.isArray(oe[0])&&s.H(oe[0][0])}(f),Z=Ws({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(re){if(w==="identity")return[new s.V(re.key,re.value,'identity function may not have a "stops" property')];let oe=[];const he=re.value;return oe=oe.concat(Ct({key:re.key,value:he,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:J})),Array.isArray(he)&&he.length===0&&oe.push(new s.V(re.key,he,"array must have at least one stop")),oe},default:function(re){return Gn({key:re.key,value:re.value,valueSpec:y,style:re.style,styleSpec:re.styleSpec})}}});return w==="identity"&&U&&Z.push(new s.V(g.key,g.value,'missing required property "property"')),w==="identity"||f.stops||Z.push(new s.V(g.key,g.value,'missing required property "stops"')),w==="exponential"&&y.expression&&!s.M(y)&&Z.push(new s.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(q&&!s.N(y)?Z.push(new s.V(g.key,g.value,"property functions not supported")):U&&!s.O(y)&&Z.push(new s.V(g.key,g.value,"zoom functions not supported"))),w!=="categorical"&&!X||f.property!==void 0||Z.push(new s.V(g.key,g.value,'"property" property is required')),Z;function J(re){let oe=[];const he=re.value,xe=re.key;if(!Array.isArray(he))return[new s.V(xe,he,`array expected, ${s.K(he)} found`)];if(he.length!==2)return[new s.V(xe,he,`array length 2 expected, length ${he.length} found`)];if(X){if(!s.H(he[0]))return[new s.V(xe,he,`object expected, ${s.K(he[0])} found`)];const _e=he[0];if(_e.zoom===void 0)return[new s.V(xe,he,"object stop key must have zoom")];if(_e.value===void 0)return[new s.V(xe,he,"object stop key must have value")];const ye=s.J(_e.zoom);if(typeof ye!="number")return[new s.V(xe,_e.zoom,"stop zoom values must be numbers")];if(I&&I>ye)return[new s.V(xe,_e.zoom,"stop zoom values must appear in ascending order")];ye!==I&&(I=ye,j=void 0,O={}),oe=oe.concat(Ws({key:`${xe}[0]`,value:he[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Xt,value:se}}))}else oe=oe.concat(se({key:`${xe}[0]`,value:he[0],style:re.style,styleSpec:re.styleSpec},he));return s.Q(s.S(he[1]))?oe.concat([new s.V(`${xe}[1]`,he[1],"expressions are not allowed in function stops.")]):oe.concat(Gn({key:`${xe}[1]`,value:he[1],valueSpec:y,style:re.style,styleSpec:re.styleSpec}))}function se(re,oe){const he=s.K(re.value),xe=s.J(re.value),_e=re.value!==null?re.value:oe;if(E){if(he!==E)return[new s.V(re.key,_e,`${he} stop domain type must match previous stop domain type ${E}`)]}else E=he;if(he!=="number"&&he!=="string"&&he!=="boolean"&&typeof xe!="number"&&typeof xe!="string"&&typeof xe!="boolean")return[new s.V(re.key,_e,"stop domain value must be a number, string, or boolean")];if(he!=="number"&&w!=="categorical"){let ye=`number expected, ${he} found`;return s.N(y)&&w===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(re.key,_e,ye)]}return w!=="categorical"||he!=="number"||typeof xe=="number"&&isFinite(xe)&&Math.floor(xe)===xe?w!=="categorical"&&he==="number"&&typeof xe=="number"&&typeof j=="number"&&j!==void 0&&xe<j?[new s.V(re.key,_e,"stop domain values must appear in ascending order")]:(j=xe,w==="categorical"&&xe in O?[new s.V(re.key,_e,"stop domain values must be unique")]:(O[xe]=!0,[])):[new s.V(re.key,_e,`integer expected, found ${String(xe)}`)]}}function yr(g){const o=(g.expressionContext==="property"?s.W:s.U)(s.S(g.value),g.valueSpec);if(o.result==="error")return o.value.map(y=>new s.V(`${g.key}${y.key}`,g.value,y.message));const f=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!f.outputDefined())return[new s.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!s.Z(f))return[new s.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return hr(f,g);if(g.expressionContext==="appearance")return Or(f,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!s.X(f,["zoom","feature-state"]))return[new s.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!s.Y(f))return[new s.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hr(g,o){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const w of o.valueSpec.expression.parameters)f.delete(w);if(f.size===0)return[];const y=[];return g instanceof s._&&f.has(g.name)?[new s.V(o.key,o.value,`["${g.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(g.eachChild(w=>{y.push(...hr(w,o))}),y)}function Or(g,o){const f=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const w of o.valueSpec.expression.parameters)f.add(w);if(f.size===0)return[];const y=[];return g instanceof s._&&!f.has(g.name)?[new s.V(o.key,o.value,`["${g.name}"] is not an allowed parameter`)]:(g.eachChild(w=>{y.push(...Or(w,o))}),y)}function Mn(g){const o=g.key,f=g.value,y=g.valueSpec,w=[];return Array.isArray(y.values)?y.values.indexOf(s.J(f))===-1&&w.push(new s.V(o,f,`expected one of [${y.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(y.values).indexOf(s.J(f))===-1&&w.push(new s.V(o,f,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(f)} found`)),w}function oi(g){return s.a2(s.S(g.value))?yr(Object.assign({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):$s(g)}function $s(g){const o=g.value,f=g.key;if(!Array.isArray(o))return[new s.V(f,o,`array expected, ${s.K(o)} found`)];if(o.length<1)return[new s.V(f,o,"filter array must have at least 1 element")];const y=g.styleSpec;let w=Mn({key:`${f}[0]`,value:o[0],valueSpec:y.filter_operator});const E=()=>{o.length>=2&&(s.a0(o[1])||w.push(new s.V(`${f}[1]`,o[1],`string expected, ${s.K(o[1])} found`)));for(let j=2;j<o.length;j++)s.J(o[1])==="$type"?w=w.concat(Mn({key:`${f}[${j}]`,value:o[j],valueSpec:y.geometry_type})):s.a0(o[j])||s.L(o[j])||s.$(o[j])||w.push(new s.V(`${f}[${j}]`,o[j],`string, number, or boolean expected, ${s.K(o[j])} found.`))};switch(s.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&s.J(o[1])==="$type"&&w.push(new s.V(f,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&w.push(new s.V(f,o,`filter array for operator "${o[0]}" must have 3 elements`)),E();break;case"==":case"!=":o.length!==3&&w.push(new s.V(f,o,`filter array for operator "${o[0]}" must have 3 elements`)),E();break;case"in":case"!in":E();break;case"any":case"all":case"none":for(let j=1;j<o.length;j++)w=w.concat($s({key:`${f}[${j}]`,value:o[j],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":o.length!==2?w.push(new s.V(f,o,`filter array for "${o[0]}" operator must have 2 elements`)):s.a0(o[1])||w.push(new s.V(`${f}[1]`,o[1],`string expected, ${s.K(o[1])} found`))}return w}function fs(g,o){const f=g.key,y=g.style,w=g.layer,E=g.styleSpec,j=g.value,I=g.objectKey,O=E[`${o}_${g.layerType}`];if(!O)return[];const U=I.match(/^(.*)-use-theme$/);if(U&&O[U[1]])return s.Q(s.S(j))?[].concat(Gn({key:f,value:j,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:y,styleSpec:E,expressionContext:"property",propertyType:o,propertyKey:I})):Gn({key:f,value:j,valueSpec:{type:"string"},style:y,styleSpec:E});const q=I.match(/^(.*)-transition$/);if(o==="paint"&&q&&O[q[1]]&&O[q[1]].transition)return Gn({key:f,value:j,valueSpec:E.transition,style:y,styleSpec:E});const X=g.valueSpec||O[I];if(!X)return[new s.a3(f,j,`unknown property "${I}"`)];let Z;if(s.a0(j)&&s.N(X)&&!X.tokens&&(Z=/^{([^}]+)}$/.exec(j))){const se=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new s.V(f,j,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${se}.`)]}const J=[];if(g.layerType==="symbol")I!=="text-field"||!y||y.glyphs||y.imports||J.push(new s.V(f,j,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(j))&&s.J(j.type)==="identity"&&J.push(new s.V(f,j,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&o==="paint"&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&s.N(X)&&(s.a5(X)||s.O(X))){const se=s.W(s.S(j),X).value,re="expression"in se&&se.expression||"_styleExpression"in se&&se._styleExpression&&se._styleExpression.expression;re&&!s.X(re,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(re)&&s.Z(re)||J.push(new s.V(f,j,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(Gn({key:g.key,value:j,valueSpec:X,style:y,styleSpec:E,expressionContext:"property",propertyType:o,propertyKey:I}))}function za(g){return fs(g,"paint")}function Ta(g){return fs(g,"layout")}function fl(g){let o=[];const f=g.value,y=g.key,w=g.style,E=g.styleSpec;if(!s.H(f))return[new s.V(y,f,"object expected")];f.type||f.ref||o.push(new s.V(y,f,'either "type" or "ref" is required'));let j=s.J(f.type);const I=s.J(f.ref);if(f.id){const O=s.J(f.id);for(let U=0;U<g.arrayIndex;U++){const q=w.layers[U];s.J(q.id)===O&&o.push(new s.V(y,f.id,`duplicate layer id "${O}", previously used at line ${q.id.__line__}`))}}if("ref"in f){let O;["type","source","source-layer","filter","layout"].forEach(U=>{U in f&&o.push(new s.V(y,f[U],`"${U}" is prohibited for ref layers`))}),w.layers.forEach(U=>{s.J(U.id)===I&&(O=U)}),O?O.ref?o.push(new s.V(y,f.ref,"ref cannot reference another ref layer")):j=s.J(O.type):typeof I=="string"&&o.push(new s.V(y,f.ref,`ref layer "${I}" not found`))}else if(j!=="background"&&j!=="sky"&&j!=="slot")if(f.source)if(s.a0(f.source)){const O=w.sources&&w.sources[f.source],U=O&&s.J(O.type);O?U==="vector"&&j==="raster"?o.push(new s.V(y,f.source,`layer "${f.id}" requires a raster source`)):U==="raster"&&j!=="raster"?o.push(new s.V(y,f.source,`layer "${f.id}" requires a vector source`)):U!=="vector"||f["source-layer"]?U==="raster-dem"&&j!=="hillshade"?o.push(new s.V(y,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):U!=="raster-array"||["raster","raster-particle"].includes(j)?j==="line"&&f.paint&&(f.paint["line-gradient"]||f.paint["line-trim-offset"])&&U==="geojson"&&!O.lineMetrics?o.push(new s.V(y,f,`layer "${f.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):j==="raster-particle"&&U!=="raster-array"&&o.push(new s.V(y,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):o.push(new s.V(y,f.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new s.V(y,f,`layer "${f.id}" must specify a "source-layer"`)):o.push(new s.V(y,f.source,`source "${f.source}" not found`))}else o.push(new s.V(`${y}.source`,f.source,'"source" must be a string'));else o.push(new s.V(y,f,'missing required property "source"'));return o=o.concat(Ws({key:y,value:f,valueSpec:E.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gn({key:`${y}.type`,value:f.type,valueSpec:E.layer.type,style:g.style,styleSpec:g.styleSpec,object:f,objectKey:"type"}),filter:O=>oi(Object.assign({layerType:j},O)),layout:O=>Ws({layer:f,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":U=>Ta(Object.assign({layerType:j},U))}}),paint:O=>Ws({layer:f,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":U=>za(Object.assign({layerType:j,layer:f},U))}}),appearances(O){const U=Ct({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:Z=>function(J){const{key:se,layer:re,layerType:oe}=J,he=s.J(J.value),xe=s.J(he.name),_e=s.J(he.condition),ye=Ws({key:se,value:he,valueSpec:J.styleSpec.appearance,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{condition:Le=>function(ke){const Re=[];return Re.push(...yr({key:ke.key,value:ke.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Re}(Object.assign({layer:re,layerType:oe},Le)),properties:Le=>function(ke){const Re=[],{styleSpec:Ae,layer:Te,layerType:$e}=ke,Ze=Ae[`paint_${$e}`],Ye=Ae[`layout_${$e}`],it=ke.object[ke.objectKey];for(const tt in it){const vt=tt in Ze?"paint":tt in Ye?"layout":void 0;if(!vt){Re.push(new s.V(ke.key,tt,`unknown property "${tt}" for layer type "${$e}"`));continue}const At=Object.assign({},ke,{key:`${ke.key}.${tt}`,object:it,objectKey:tt,layer:Te,layerType:$e,value:it[tt],valueSpec:vt==="paint"?Ze[tt]:Ye[tt]});Re.push(...fs(At,vt))}return Re}(Object.assign({layer:re,layerType:oe},Le))}});return xe!=="hidden"&&_e===void 0&&ye.push(new s.V(J.key,"name",'Appearance with name different than "hidden" must have a condition')),ye}(Object.assign({layerType:j,layer:f},Z))}),q=Array.isArray(O.value)?O.value:[],X=new Set;return q.forEach((Z,J)=>{const se=s.J(Z.name);if(se)if(X.has(se)){const re=s.J(f.id);U.push(new s.V(O.key,se,`Duplicated appearance name "${se}" for layer "${re}"`))}else X.add(se)}),U}}})),o}function na({key:g,value:o}){return s.a0(o)?[]:[new s.V(g,o,`string expected, ${s.K(o)} found`)]}const js={promoteId:function g({key:o,value:f}){if(s.a0(f))return na({key:o,value:f});if(Array.isArray(f)){const w=[],E=s.S(f),j=s.U(E);return j.result==="error"&&j.value.forEach(I=>{w.push(new s.V(`${o}${I.key}`,null,`${I.message}`))}),s.X(j.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||w.push(new s.V(`${o}`,null,"promoteId expression should be only feature dependent")),w}if(!s.H(f))return[new s.V(o,f,`string, expression or object expected, "${s.K(f)}" found`)];const y=[];for(const w in f)y.push(...g({key:`${o}.${w}`,value:f[w]}));return y}};function ga(g){const o=g.value,f=g.key,y=g.styleSpec,w=g.style;if(!s.H(o))return[new s.V(f,o,`object expected, ${s.K(o)} found`)];if(!("type"in o))return[new s.V(f,o,'"type" is required')];const E=s.J(o.type);let j=[];switch(["vector","raster","raster-dem","raster-array"].includes(E)&&("url"in o||"tiles"in o||j.push(new s.a3(f,o,'Either "url" or "tiles" is required.'))),E){case"vector":case"raster":case"raster-dem":case"raster-array":return j=j.concat(Ws({key:f,value:o,valueSpec:y[`source_${E.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:js})),j;case"geojson":if(j=Ws({key:f,value:o,valueSpec:y.source_geojson,style:w,styleSpec:y,objectElementValidators:js}),"cluster"in o&&"clusterProperties"in o){if(!s.H(o.clusterProperties))return[new s.V(`${f}.clusterProperties`,o,`object expected, ${s.K(o)} found`)];for(const I in o.clusterProperties){const O=o.clusterProperties[I];if(!Array.isArray(O))return[new s.V(`${f}.clusterProperties.${I}`,O,"array expected")];const[U,q]=O,X=typeof U=="string"?[U,["accumulated"],["get",I]]:U;j.push(...yr({key:`${f}.${I}.map`,value:q,expressionContext:"cluster-map"})),j.push(...yr({key:`${f}.${I}.reduce`,value:X,expressionContext:"cluster-reduce"}))}}return j;case"video":return Ws({key:f,value:o,valueSpec:y.source_video,style:w,styleSpec:y});case"image":return Ws({key:f,value:o,valueSpec:y.source_image,style:w,styleSpec:y});case"canvas":return[new s.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mn({key:`${f}.type`,value:o.type,valueSpec:{values:pl(y)}})}}function pl(g){return g.source.reduce((o,f)=>{const y=g[f];return y.type.type==="enum"&&(o=o.concat(Object.keys(y.type.values||{}))),o},[])}function ml(g){const o=g.value,f=g.styleSpec,y=f.light,w=g.style;if(o===void 0)return[];if(!s.H(o))return[new s.V("light",o,`object expected, ${s.K(o)} found`)];let E=[];for(const j in o){const I=j.match(/^(.*)-transition$/),O=j.match(/^(.*)-use-theme$/);E=E.concat(O&&y[O[1]]?Gn({key:j,value:o[j],valueSpec:{type:"string"},style:w,styleSpec:f}):I&&y[I[1]]&&y[I[1]].transition?Gn({key:j,value:o[j],valueSpec:f.transition,style:w,styleSpec:f}):y[j]?Gn({key:j,value:o[j],valueSpec:y[j],style:w,styleSpec:f}):[new s.V(j,o[j],`unknown property "${j}"`)])}return E}function Wl(g){const o=g.value;if(!o)return[];const f=g.key;if(!s.H(o))return[new s.V(f,o,`object expected, ${s.K(o)} found`)];let y=[];const w=g.styleSpec,E=w["light-3d"],j=g.style,I=g.style.lights;for(const q of["type","id"])if(!(q in o))return y=y.concat([new s.V(f,o,`missing property "${q}"`)]),y;if(!s.a0(o.type))return y=y.concat([new s.V(`${f}.type`,o.type,"string expected")]),y;if(I)for(let q=0;q<g.arrayIndex;q++){const X=s.J(o.type),Z=I[q];s.J(Z.type)===X&&y.push(new s.V(f,o.id,`duplicate light type "${o.type}", previously defined at line ${Z.id.__line__}`))}const O=`properties_light_${o.type}`;if(!(O in w))return y=y.concat([new s.V(`${f}.type`,o,`Invalid light type ${o.type}`)]),y;const U=w[O];for(const q in o)if(q==="properties"){const X=o[q];if(!s.H(X))return y=y.concat([new s.V("properties",X,`object expected, ${s.K(X)} found`)]),y;for(const Z in X){const J=Z.match(/^(.*)-transition$/),se=Z.match(/^(.*)-use-theme$/);y=y.concat(se&&U[se[1]]?Gn({key:q,value:X[Z],valueSpec:{type:"string"},style:j,styleSpec:w}):J&&U[J[1]]&&U[J[1]].transition?Gn({key:q,value:o[q],valueSpec:w.transition,style:j,styleSpec:w}):U[Z]?Gn({key:Z,value:X[Z],valueSpec:U[Z],style:j,styleSpec:w}):[new s.a3(g.key,X[Z],`unknown property "${Z}"`)])}}else y=y.concat(E[q]?Gn({key:q,value:o[q],valueSpec:E[q],style:j,styleSpec:w}):[new s.a3(q,o[q],`unknown property "${q}"`)]);return y}function pc(g){const o=g.value,f=g.key,y=g.style,w=g.styleSpec,E=w.terrain;if(o==null)return[];if(!s.H(o))return[new s.V("terrain",o,`object expected, ${s.K(o)} found`)];let j=[];for(const I in o){const O=I.match(/^(.*)-transition$/),U=I.match(/^(.*)-use-theme$/);j=j.concat(U&&E[U[1]]?Gn({key:I,value:o[I],valueSpec:{type:"string"},style:y,styleSpec:w}):O&&E[O[1]]&&E[O[1]].transition?Gn({key:I,value:o[I],valueSpec:w.transition,style:y,styleSpec:w}):E[I]?Gn({key:I,value:o[I],valueSpec:E[I],style:y,styleSpec:w}):[new s.a3(I,o[I],`unknown property "${I}"`)])}if(o.source)if(s.a0(o.source)){const I=y.sources&&y.sources[o.source],O=I&&s.J(I.type);I?O!=="raster-dem"&&j.push(new s.V(`${f}.source`,o.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):j.push(new s.V(`${f}.source`,o.source,`source "${o.source}" not found`))}else j.push(new s.V(`${f}.source`,o.source,"source must be a string"));else j.push(new s.V(f,o,'terrain is missing required property "source"'));return j}function Wc(g){const o=g.value,f=g.style,y=g.styleSpec,w=y.fog;if(o===void 0)return[];if(!s.H(o))return[new s.V("fog",o,`object expected, ${s.K(o)} found`)];let E=[];for(const j in o){const I=j.match(/^(.*)-transition$/),O=j.match(/^(.*)-use-theme$/);E=E.concat(O&&w[O[1]]?Gn({key:j,value:o[j],valueSpec:{type:"string"},style:f,styleSpec:y}):I&&w[I[1]]&&w[I[1]].transition?Gn({key:j,value:o[j],valueSpec:y.transition,style:f,styleSpec:y}):w[j]?Gn({key:j,value:o[j],valueSpec:w[j],style:f,styleSpec:y}):[new s.a3(j,o[j],`unknown property "${j}"`)])}return E}const Hc={"*":()=>[],array:Ct,boolean:function(g){const o=g.value,f=g.key;return s.$(o)?[]:[new s.V(f,o,`boolean expected, ${s.K(o)} found`)]},number:Xt,color:function({key:g,value:o}){return s.a0(o)?s.a1.parseCSSColor(o)===null?[new s.V(g,o,`color expected, "${o}" found`)]:[]:[new s.V(g,o,`color expected, ${s.K(o)} found`)]},enum:Mn,filter:oi,function:Sr,layer:fl,object:Ws,source:ga,model:s.a7,light:ml,"light-3d":Wl,terrain:pc,fog:Wc,string:na,formatted:function(g){return na(g).length===0?[]:yr(g)},resolvedImage:function(g){return na(g).length===0?[]:yr(g)},projection:function(g){const o=g.value,f=g.styleSpec,y=f.projection,w=g.style;if(s.H(o)){let E=[];for(const j in o)E=E.concat(Gn({key:j,value:o[j],valueSpec:y[j],style:w,styleSpec:f}));return E}return s.a0(o)?[]:[new s.V("projection",o,`object or string expected, ${s.K(o)} found`)]},import:function(g){const o=g.key,{value:f,styleSpec:y}=g;if(!s.H(f))return[new s.V(o,f,"import must be an object")];const{data:w,...E}=f;Object.defineProperty(E,"__line__",{value:f.__line__,enumerable:!1});let j=Ws(Object.assign({},g,{value:E,valueSpec:y.import}));return s.J(E.id)===""&&j.push(new s.V(`${g.key}.id`,E,"import id can't be an empty string")),w&&(j=j.concat(mi(w,y,{key:`${g.key}.data`}))),j},iconset:function(g){const o=g.value,f=g.key,y=g.styleSpec,w=g.style;if(!s.H(o))return[new s.V(f,o,"object expected")];if(!o.type)return[new s.V(f,o,'"type" is required')];const E=s.J(o.type);let j=[];if(j=j.concat(Ws({key:f,value:o,valueSpec:y[`iconset_${E}`],style:w,styleSpec:y})),function(I,O){return!(I!=="source"||!O.source)}(E,o)){const I=w.sources&&w.sources[o.source],O=I&&s.J(I.type);I?O!=="raster-array"&&j.push(new s.V(f,o.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):j.push(new s.V(f,o.source,`source "${o.source}" not found`))}return j}};function Gn(g,o=!1){const f=g.value,y=g.valueSpec,w=g.styleSpec;if(y.expression){if(s.a4(s.J(f)))return Sr(g);if(s.Q(s.S(f)))return yr(g)}if(y.type&&Hc[y.type]){const E=Hc[y.type](g);return o===!0&&E.length>0&&Array.isArray(g.value)?yr(g):E}return Ws(Object.assign({},g,{valueSpec:y.type?w[y.type]:y}))}function Ws(g){const o=g.key,f=g.value,y=g.valueSpec||{},w=g.objectElementValidators||{},E=g.style,j=g.styleSpec;if(!s.H(f))return[new s.V(o,f,`object expected, ${s.K(f)} found`)];let I=[];for(const O in f){const U=O.split(".")[0];let q;w[U]?q=w[U]:y[U]?q=Gn:w["*"]?q=w["*"]:y["*"]&&(q=Gn),q?I=I.concat(q({key:(o&&`${o}.`)+O,value:f[O],valueSpec:y[U]||y["*"],style:E,styleSpec:j,object:f,objectKey:O},f)):I.push(new s.a3(o,f[O],`unknown property "${O}"`))}for(const O in y){if(w[O])continue;const U=y[O];U.required&&U.default===void 0&&f[O]===void 0&&I.push(new s.V(o,f,`missing required property "${O}"`))}return I}function jn({key:g,value:o}){const f=na({key:g,value:o});if(f.length)return f;const y=o;return y.indexOf("{fontstack}")===-1&&f.push(new s.V(g,o,'"glyphs" url must include a "{fontstack}" token')),y.indexOf("{range}")===-1&&f.push(new s.V(g,o,'"glyphs" url must include a "{range}" token')),f}function mi(g,o=s.a6,f={}){return Ws({key:f.key||"",value:g,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:g,objectElementValidators:{glyphs:jn}})}function ii(g,o=s.a6){return Pe(mi(g,o))}const bo=g=>Pe(ga(g)),Ea=g=>Pe(ml(g)),kt=g=>Pe(Wl(g)),Ba=g=>Pe(pc(g)),wo=g=>Pe(Wc(g)),qo=g=>Pe(function(o){const f=o.value,y=o.style,w=o.styleSpec,E=w.snow;if(f===void 0)return[];if(!s.H(f))return[new s.V("snow",f,`object expected, ${s.K(f)} found`)];let j=[];for(const I in f){const O=I.match(/^(.*)-transition$/);j=j.concat(O&&E[O[1]]&&E[O[1]].transition?Gn({key:I,value:f[I],valueSpec:w.transition,style:y,styleSpec:w}):E[I]?Gn({key:I,value:f[I],valueSpec:E[I],style:y,styleSpec:w}):[new s.a3(I,f[I],`unknown property "${I}"`)])}return j}(g)),_n=g=>Pe(function(o){const f=o.value,y=o.style,w=o.styleSpec,E=w.rain;if(f===void 0)return[];if(!s.H(f))return[new s.V("rain",f,`object expected, ${s.K(f)} found`)];let j=[];for(const I in f){const O=I.match(/^(.*)-transition$/);j=j.concat(O&&E[O[1]]&&E[O[1]].transition?Gn({key:I,value:f[I],valueSpec:w.transition,style:y,styleSpec:w}):E[I]?Gn({key:I,value:f[I],valueSpec:E[I],style:y,styleSpec:w}):[new s.a3(I,f[I],`unknown property "${I}"`)])}return j}(g)),Ke=g=>Pe(fl(g)),ce=g=>Pe(oi(g)),me=g=>Pe(za(g)),je=g=>Pe(Ta(g)),Ge=g=>Pe(s.a7(g));function Pe(g){return g.slice().sort((o,f)=>o.line&&f.line?o.line-f.line:0)}function He(g,o){let f=!1;if(o&&o.length)for(const y of o)y instanceof s.a3?s.w(y.message):(g.fire(new s.y(new Error(y.message))),f=!0);return f}const nt=s.a6.light;let Xe;class ct extends s.E{constructor(o,f="flat"){super(),this._transitionable=new s.a8(Xe||(Xe=new s.a9({anchor:new s.aa(nt.anchor),position:new s.ab(nt.position),color:new s.aa(nt.color),intensity:new s.aa(nt.intensity)}))),this.setLight(o,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,f,y={}){this._validate(Ea,o,y)||(this._transitionable.setTransitionOrValue(o),this.id=f)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y){return(!y||y.validate!==!1)&&He(this,o.call(ii,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Rt=s.a6.terrain;let Nt=class extends s.E{constructor(g,o,f,y,w){super(),this.scope=f,this._transitionable=new s.a8(new s.a9({source:new s.aa(Rt.source),exaggeration:new s.aa(Rt.exaggeration)}),f,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=w}get(){return this._transitionable.serialize()}set(g,o){this._transitionable.setTransitionOrValue(g,o)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new s.ac(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const o=g.value.expression;if(!o)return null;let f=-1,y=-1,w=1;for(const E of o.zoomStops)w=o.evaluate(new s.ac(E,{worldview:this.worldview})),w>.01?(f=E,y=-1):y=E;return w<.01&&f>0&&y>f?[f,y]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof s.ad}};const tr=.05;function _r(g,o,f,y){const w=s.ah(45,65,f),[E,j]=Er(g,y);let I=1-Math.min(1,Math.exp((o-E)/(j-E)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*w*g.alpha}function Er(g,o){const f=.5/Math.tan(.5*o);return[g.range[0]+f,g.range[1]+f]}function $r(g,o,f,y,w){const E=s.af([],[o,f,y],w.mercatorFogMatrix);return _r(g,s.ag(E),w.pitch,w._fov)}function Qr(g,o,f,y,w,E,j){const I=[[f,y,0],[w,y,0],[w,E,0],[f,E,0]];let O=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(const q of I){const X=s.af([],q,o),Z=s.ag(X);O=Math.min(O,Z),U=Math.max(U,Z)}return[_r(g,O,j.pitch,j._fov),_r(g,U,j.pitch,j._fov)]}const Rr=s.a6.fog;class Nr extends s.E{constructor(o,f,y,w){super();const E=new s.a9({range:new s.aa(Rr.range),color:new s.aa(Rr.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Rr["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Rr["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Rr["horizon-blend"]),"star-intensity":new s.aa(Rr["star-intensity"]),"vertical-range":new s.aa(Rr["vertical-range"])});this._transitionable=new s.a8(E,y,new Map(w)),this.set(o,w),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new s.ai(E),this.scope=y}get state(){const o=this._transform,f=o.projection.name==="globe",y=s.aj(o.zoom),w=this.properties.get("range"),E=[.5,3];return{range:f?[s.ak(E[0],w[0],y),s.ak(E[1],w[1],y)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,f,y={}){if(this._validate(wo,o,y))return;const w=Object.assign({},o);for(const E of Object.keys(Rr))w[E]===void 0&&(w[E]=Rr[E].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,o))*f.a}getOpacityAtLatLng(o,f){return this._transform.projection.supportsFog?function(y,w,E){const j=s.ae.fromLngLat(w),I=E.elevation?E.elevation.getAtPointOrZero(j):0;return $r(y,j.x,j.y,I,E)}(this.state,o,f):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Qr(this.state,f,0,0,s.al,s.al,this._transform)}getOpacityForBounds(o,f,y,w,E){return this._transform.projection.supportsFog?Qr(this.state,o,f,y,w,E,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Er(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const y of f){const w=o.points[y];let E;if(w[2]>=0)E=w;else{const j=o.points[y-4];E=s.am(j,w,j[2]/(j[2]-w[2]))}if($r(this.state,E[0],E[1],0,this._transform)>=tr)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,f,y){return(!y||y.validate!==!1)&&He(this,o.call(ii,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let li,vs,Wi,Hi=class extends s.E{constructor(g,o,f,y){super();const w=li||(li=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(w,f,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(w),this.scope=f}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),f=this.properties.get("direction"),y=s.an(f[0]),w=-Math.max(s.an(f[1]),.01),E=[Math.cos(y)*Math.cos(w),Math.sin(y)*Math.cos(w),Math.sin(w)],j=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=j,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(o.r,o.g,o.b,o.a*g),direction:E,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(g,o,f={}){if(this._validate(qo,g,f))return;const y=Object.assign({},g),w=s.a6.snow;for(const E of Object.keys(w))y[E]===void 0&&(y[E]=w[E].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,f){return(!f||f.validate!==!1)&&He(this,g.call(ii,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},xi=class extends s.E{constructor(g,o,f,y){super();const w=vs||(vs=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(w,f,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(w),this.scope=f}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),f=this.properties.get("direction"),y=s.an(f[0]),w=-Math.max(s.an(f[1]),.01),E=[Math.cos(y)*Math.cos(w),Math.sin(y)*Math.cos(w),Math.sin(w)],j=this.properties.get("vignette-color");return j.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(o.r,o.g,o.b,o.a*g),direction:E,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(g,o,f={}){if(this._validate(_n,g,f))return;const y=Object.assign({},g),w=s.a6.rain;for(const E of Object.keys(w))y[E]===void 0&&(y[E]=w[E].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,f){return(!f||f.validate!==!1)&&He(this,g.call(ii,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class gn extends s.E{constructor(o,f,y,w){super(),this.scope=y,this._options=o,this.properties=new s.ai(f),this._transitionable=new s.a8(f,y,new Map(w)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,f){this._options=o,this._transitionable.setTransitionOrValue(o.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Ei=()=>Wi||(Wi=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let Qn;const ei=()=>Qn||(Qn=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class Ui{constructor(o,f,y){this.screenBounds=o,this.cameraPoint=y.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(o,f){let y,w;if(o instanceof s.P||typeof o[0]=="number"){const E=s.P.convert(o);y=[E],w=f.isPointAboveHorizon(E)}else{const E=s.P.convert(o[0]),j=s.P.convert(o[1]),I=E.add(j)._div(2);y=[E,j],w=s.aq(E,j).every(O=>f.isPointAboveHorizon(O))&&f.isPointAboveHorizon(I)}return new Ui(y,w,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const f=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.aq(f,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<y.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?w[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(w[3]=this.cameraPoint)),s.ar(w,o)}bufferedCameraGeometryGlobe(o){const f=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.aq(f,y,o),E=this.cameraPoint.clone();switch(3*((E.y>f.y)+(E.y>y.y))+((E.x>f.x)+(E.x>y.x))){case 0:w[0]=E,w[4]=E.clone();break;case 1:w.splice(1,0,E);break;case 2:w[1]=E;break;case 3:w.splice(4,0,E);break;case 5:w.splice(2,0,E);break;case 6:w[3]=E;break;case 7:w.splice(3,0,E);break;case 8:w[2]=E}return w}containsTile(o,f,y,w=0){const E=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/f._pixelsPerMercatorPixel+1,j=y?this._bufferedCameraMercator(E,f):this._bufferedScreenMercator(E,f);let I=o.tileID.wrap+(j.unwrapped?w:0);const O=j.polygon.map(oe=>s.as(o.tileTransform,oe,I));if(!s.at(O,0,0,s.al,s.al))return;I=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const U=this.screenGeometryMercator.polygon.map(oe=>s.au(o.tileTransform,oe,I)),q=U.map(oe=>new s.P(oe[0],oe[1])),X=f.getFreeCameraOptions().position||new s.ae(0,0,0),Z=s.au(o.tileTransform,X,I),J=U.map(oe=>{const he=s.av(oe,oe,Z);return s.aw(he,he),new s.ax(Z,he)}),se=s.ay(o,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:J,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(re=s.az(O),re.min.x=s.aA(re.min.x,0,s.al),re.min.y=s.aA(re.min.y,0,s.al),re.max.x=s.aA(re.max.x,0,s.al),re.max.y=s.aA(re.max.y,0,s.al),re),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:se};var re}_bufferedScreenMercator(o,f){const y=As(o);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),f):{polygon:this.bufferedScreenGeometry(o).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[y]=w,w}}_bufferedCameraMercator(o,f){const y=As(o);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),f):{polygon:this.bufferedCameraGeometry(o).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[y]=w,w}}_projectAndResample(o,f){const y=function(E,j){const I=s.aB([],j.pixelMatrix,j.globeMatrix),O=[0,-s.aD,0,1],U=[0,s.aD,0,1],q=[0,0,0,1];s.aC(O,O,I),s.aC(U,U,I),s.aC(q,q,I);const X=new s.P(O[0]/O[3],O[1]/O[3]),Z=new s.P(U[0]/U[3],U[1]/U[3]),J=s.aE(E,X)&&O[3]<q[3],se=s.aE(E,Z)&&U[3]<q[3];if(!J&&!se)return null;const re=function(Re,Ae,Te){for(let $e=1;$e<Re.length;$e++){const Ze=ia(Ae.pointCoordinate3D(Re[$e-1]).x),Ye=ia(Ae.pointCoordinate3D(Re[$e]).x);if(Te<0){if(Ze<Ye)return{idx:$e,t:-Ze/(Ye-1-Ze)}}else if(Ye<Ze)return{idx:$e,t:(1-Ze)/(Ye+1-Ze)}}return null}(E,j,J?-1:1);if(!re)return null;const{idx:oe,t:he}=re;let xe=oe>1?ya(E.slice(0,oe),j):[],_e=oe<E.length?ya(E.slice(oe),j):[];xe=xe.map(Re=>new s.P(ia(Re.x),Re.y)),_e=_e.map(Re=>new s.P(ia(Re.x),Re.y));const ye=[...xe];ye.length===0&&ye.push(_e[_e.length-1]);const Le=s.ak(ye[ye.length-1].y,(_e.length===0?xe[0]:_e[0]).y,he);let ke;return ke=J?[new s.P(0,Le),new s.P(0,0),new s.P(1,0),new s.P(1,Le)]:[new s.P(1,Le),new s.P(1,1),new s.P(0,1),new s.P(0,Le)],ye.push(...ke),_e.length===0?ye.push(xe[0]):ye.push(..._e),{polygon:ye.map(Re=>new s.ae(Re.x,Re.y)),unwrapped:!1}}(o,f);if(y)return y;const w=function(E,j){let I=!1,O=-1/0,U=0;for(let X=0;X<E.length-1;X++)E[X].x>O&&(O=E[X].x,U=X);for(let X=0;X<E.length-1;X++){const Z=(U+X)%(E.length-1),J=E[Z],se=E[Z+1];Math.abs(J.x-se.x)>.5&&(J.x<se.x?(J.x+=1,Z===0&&(E[E.length-1].x+=1)):(se.x+=1,Z+1===E.length-1&&(E[0].x+=1)),I=!0)}const q=s.aF(j.center.lng);return I&&q<Math.abs(q-1)&&E.forEach(X=>{X.x-=1}),{polygon:E,unwrapped:I}}(ya(o,f).map(E=>new s.P(ia(E.x),E.y)),f);return{polygon:w.polygon.map(E=>new s.ae(E.x,E.y)),unwrapped:w.unwrapped}}}function ya(g,o){return s.aG(g,f=>{const y=o.pointCoordinate3D(f);f.x=y.x,f.y=y.y},1/256)}function ia(g){return g<0?1+g%1:g%1}function As(g){return 100*g|0}function Pd(g,o,f,y,w){const E=function(I,O){if(I)return w(I);if(O){if(g.url&&O.tiles&&g.tiles&&delete g.tiles,O.variants){if(!Array.isArray(O.variants))return w(new Error("variants must be an array"));for(const q of O.variants){if(q==null||typeof q!="object"||q.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(q.capabilities))return w(new Error("capabilities must be an array"));if(q.capabilities.length===1&&q.capabilities[0]==="meshopt"){O=Object.assign(O,q);break}}}const U=s.aH(Object.assign({},O,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);U.tiles=o.canonicalizeTileset(U,g.url),w(null,U)}},j=function(I,O,U){if(!I)return null;if(!O&&!U)return I;U=U||I.worldview_default;const q=Object.values(I.language||{});if(q.length===0)return null;const X=Object.values(I.worldview||{});if(X.length===0)return null;const Z=q.every(se=>se===O),J=X.every(se=>se===U);return Z&&J?I:O in(I.language_options||{})||U in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(g.data,f,y);return j?s.o.frame(()=>E(null,j)):g.url?s.m(o.transformRequest(o.normalizeSourceURL(g.url,null,f,y),s.R.Source),E):s.o.frame(()=>{const{data:I,...O}=g;E(null,O)})}function $a(g,o){const f=Math.pow(2,o.z),y=Math.floor(s.aF(g.getWest())*f),w=Math.floor(s.aJ(g.getNorth())*f),E=Math.ceil(s.aF(g.getEast())*f),j=Math.ceil(s.aJ(g.getSouth())*f);return o.x>=y&&o.x<E&&o.y>=w&&o.y<j}class Go{constructor(o,f,y){this.bounds=o?s.aI.convert(this.validateBounds(o)):null,this.minzoom=f||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const f of o)this.extraBounds.push(s.aI.convert(this.validateBounds(f)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!$a(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const f of this.extraBounds)if($a(f,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const f=new Go(o.bounds,o.minzoom,o.maxzoom);return f.addExtraBounds(o.extra_bounds),f}}class Hl extends s.E{constructor(o,f,y,w){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(f,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.aK}load(o){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,f,y,(w,E)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new s.y(w));else if(E){if(Object.assign(this,E),this.hasWorldviews=!!E.worldview_options,E.worldview_default&&(this.worldviewDefault=E.worldview_default),E.vector_layers){this.vectorLayers=E.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const j of E.vector_layers)this.vectorLayerIds.push(j.id),E.worldview&&E.worldview[j.source]&&this.localizableLayerIds.add(j.id)}this.tileBounds=Go.fromTileJSON(E),Je(E.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(w)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,f){const y=o.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(y),E=this.map._requestManager.transformRequest(w,s.R.Tile),j=this.map.style?this.map.style.getLut(this.scope):null,I=j?{image:j.image.clone()}:null,O={request:E,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(y)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=f:o.request=o.actor.send("reloadTile",O,U.bind(this));else if(o.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",O,U.bind(this),void 0,!0);else{const q=s.aL.call({deduped:this._deduped},O,(X,Z)=>{if(X||!Z)U.call(this,X);else{const J=s.aM(Z.responseHeaders);O.data={rawData:Z.rawData.slice(0),expires:J.expires,cacheControl:J.cacheControl},o.actor&&o.actor.send("loadTile",O,U.bind(this),void 0,!0)}},!0);o.request={cancel:q}}function U(q,X){return delete o.request,o.aborted?f(null):q&&q instanceof s.aN&&q.status!==404?f(q):(X&&X.resourceTiming&&(o.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&o.setExpiryData(X),o.loadVectorData(X,this.map.painter),s.aO(this.dispatcher),f(null,X),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,f){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mc extends s.E{constructor(o,f,y,w){super(),this.id=o,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},f),Object.assign(this,s.aH(f,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const f=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,null,f,(y,w)=>{this._tileJSONRequest=null,this._loaded=!0,y?this.fire(new s.y(y)):w&&(Object.assign(this,w),w.raster_layers&&(this.rasterLayers=w.raster_layers,this.rasterLayerIds=this.rasterLayers.map(E=>E.id)),this.tileBounds=Go.fromTileJSON(w),Je(w.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(y)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,f){const y=s.o.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);o.request=s.n(this.map._requestManager.transformRequest(w,s.R.Tile),(E,j,I)=>{if(delete o.request,o.aborted)return o.state="unloaded",f(null);if(E)return o.state="errored",f(E);if(!j)return f(null);const O=s.aM(I);this.map._refreshExpiredTiles&&o.setExpiryData(O),o.setTexture(j,this.map.painter),o.state="loaded",s.aO(this.dispatcher),f(null)})}abortTile(o,f){o.request&&(o.request.cancel(),delete o.request),f&&f()}unloadTile(o,f){o.texture&&o.texture instanceof s.T?(o.destroy(!1),o.texture&&o.texture instanceof s.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wo([g,o],f,y,{scaled:w=!0}={}){const{tileSize:E,buffer:j}=y,{x:I,y:O,z:U}=f;if(!isFinite(I)||!isFinite(O)||!isFinite(U))throw new Error("Invalid MRT header");const q=2**U,X=q*s.aF(g),Z=q*s.aJ(o);return function([J,se],re,{scaled:oe=!0}={}){if(!re)throw new Error("bandView is undefined");const{data:he,tileSize:xe,buffer:_e,offset:ye,scale:Le,dimension:ke}=re;if(J<-_e||J>xe+_e||se<-_e||se>xe+_e)throw new Error(`Point (${J}, ${se}) out of bounds for tileSize=${xe}, buffer=${_e}`);const Re=(se+_e)*(xe+2*_e)+(J+_e);if(new Uint32Array(he.buffer)[Re]===4294967295)return null;let Ae=[];Ae=oe?[]:new re.data.constructor(ke);for(let Te=0;Te<ke;Te++)Ae[Te]=Math.round(1e12*(he[ke*Re+Te]*Le+ye))/1e12;return Ae}([Math.min(Math.max(-j,Math.floor((X-I)*E)),E-1+j),Math.min(Math.max(-j,Math.floor((Z-O)*E)),E-1+j)],y,{scaled:w})}class io extends mc{constructor(o,f,y,w){super(o,f,y,w),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},f)}triggerRepaint(o){const f=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);f&&f.enabled&&y&&f._clearRenderCacheForTile(y.id,o.tileID),this.map.triggerRepaint()}loadTile(o,f){const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(y,s.R.Tile),E={request:w,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=w,o.actor||(o.actor=this.dispatcher.getActor());const j=(I,O,U)=>{if(delete o.request,o.aborted)return o.state="unloaded",f(null);if(I)return I.name==="AbortError"?void 0:(o.state="errored",f(I));if(this.map._refreshExpiredTiles&&O){const q=s.aM(U);o.setExpiryData(q)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!O)return f(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=O}f(null)};o.request=this.partial?o.fetchHeader(void 0,j.bind(this)):o.actor.send("loadTile",E,j.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,f){const y=o.texturePerLayer;if(o.flushAllQueues(),y.size){o.destroy(!1);for(const w of y.values())this.map.painter.saveTileTexture(w)}else o.destroy()}prepareTile(o,f,y,w){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(f,y,w,(E,j)=>{if(E)return o.state="errored",this.fire(new s.y(E)),void this.triggerRepaint(o);j&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(y,j,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:E})=>E===o),y=f&&f.fields,w=y&&y.bands&&y.bands;return w?w[0]:0}getTextureDescriptor(o,f,y){if(!o)return;const w=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let E=null;f instanceof s.aR?E=f.paint.get("raster-array-band"):f instanceof s.aS&&(E=f.paint.get("raster-particle-array-band"));const j=E||this.getInitialBand(w);if(j==null)return;if(!o.textureDescriptorPerLayer.get(f.id))return void this.prepareTile(o,w,f.id,j);if(o.updateNeeded(f.id,j)&&!y)return;const I=o.textureDescriptorPerLayer.get(f.id);return Object.assign({},I,{texture:o.texturePerLayer.get(f.id)})}getImages(o,f){const y=new Map;for(const w of o)for(const E of f){const[j,I]=E.split("/"),O=w.getLayer(j);if(!O||!O.hasBand(I)||!O.hasDataForBand(I))continue;const{bytes:U,tileSize:q,buffer:X}=O.getBandView(I),Z=q+2*X,J={data:new s.q({width:Z,height:Z},U),pixelRatio:2,sdf:!1,usvg:!1,version:0};y.set(E,J)}return y}queryRasterArrayValueByBandId(o,f,y){const w=f._mrt;return new Promise(E=>{const j={},I=new Set;for(const[O,U]of Object.entries(w.layers)){if(y.layerName&&O!==y.layerName)continue;const q={};j[O]=q;for(const{bands:X}of U.dataIndex)for(const Z of X)y.bands&&!y.bands.includes(Z)||(I.add(s.B(O,Z)),f.fetchBand(O,null,Z,J=>{s.o.frame(()=>{q[Z]=J?null:Wo([o.lng,o.lat],w,U.getBandView(Z)),I.delete(s.B(O,Z)),I.size===0&&E(j)})},!1))}I.size===0&&E(j)})}_loadTileForQuery(o,f){if(this._loadTileLoaded[o.uid])return void f(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(f);this._loadTilePending[o.uid]=[f];const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(y,s.R.Tile);o.actor.send("loadTile",{request:w,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(E,j,I)=>{if(E)return this._loadTilePending[o.uid].forEach(O=>O(E,null)),void delete this._loadTilePending[o.uid];if(!j)return this._loadTilePending[o.uid].forEach(O=>O(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&j){const O=s.aM(I);o.setExpiryData(O)}o._mrt=j,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(O=>O(null,j)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,f,y){return new Promise((w,E)=>{this._loadTileForQuery(f,(j,I)=>{j?E(j):w(I?this.queryRasterArrayValueByBandId(o,f,y):null)})})}queryRasterArrayValue(o,f){const y=s.aT.convert(o),w=this.findLoadedParent(y);return w&&w._mrt?f.bands||!this.partial?this.queryRasterArrayValueByBandId(y,w,f):this.queryRasterArrayValueByAllBands(y,w,f):Promise.resolve(null)}findLoadedParent(o){const f=s.ae.fromLngLat(o,this.map.transform.tileSize),y=this.maxzoom+1,w=1<<y,E=Math.floor(f.x),j=Math.floor((f.x-E)*w),I=Math.floor(f.y*w),O=this.map.style.getSourceCache(this.id),U=new s.aQ(y,E,y,j,I);return O.findLoadedParent(U,this.minzoom)}}const ku={vector:Hl,raster:mc,"raster-dem":class extends mc{constructor(g,o,f,y){super(g,o,f,y),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(g,o){const f=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(w,E){w&&(g.state="errored",o(w)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",o(null))}g.request=s.n(this.map._requestManager.transformRequest(f,s.R.Tile),(function(w,E,j){if(delete g.request,g.aborted)g.state="unloaded",o(null);else if(w)g.state="errored",o(w);else if(E){const I=s.aM(j);this.map._refreshExpiredTiles&&g.setExpiryData(I);const O=ImageBitmap&&E instanceof ImageBitmap&&s.r(),U=1-(E.width-s.aP(E.width))/2;U<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const q=O?E:s.o.getImageData(E,U),X={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:q,encoding:this.encoding,padding:U};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",X,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const o=g.canonical,f=Math.pow(2,o.z),y=(o.x-1+f)%f,w=o.x===0?g.wrap-1:g.wrap,E=(o.x+1+f)%f,j=o.x+1===f?g.wrap+1:g.wrap,I={};return I[new s.aQ(g.overscaledZ,w,o.z,y,o.y).key]={backfilled:!1},I[new s.aQ(g.overscaledZ,j,o.z,E,o.y).key]={backfilled:!1},o.y>0&&(I[new s.aQ(g.overscaledZ,w,o.z,y,o.y-1).key]={backfilled:!1},I[new s.aQ(g.overscaledZ,g.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new s.aQ(g.overscaledZ,j,o.z,E,o.y-1).key]={backfilled:!1}),o.y+1<f&&(I[new s.aQ(g.overscaledZ,w,o.z,y,o.y+1).key]={backfilled:!1},I[new s.aQ(g.overscaledZ,g.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new s.aQ(g.overscaledZ,j,o.z,E,o.y+1).key]={backfilled:!1}),I}},"raster-array":io,geojson:class extends s.E{constructor(g,o,f,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(y),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const w=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*w,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*w,extent:s.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*w,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const f of this._data.features)o.set(f.id,f);for(const f of g.features)o.set(f.id,f);this._data.features=[...o.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterChildren(g,o){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterLeaves(g,o,f,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:o,offset:f},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:g},this.workerOptions);o.scope=this.scope;const f=this._data;typeof f=="string"?(o.request=this.map._requestManager.transformRequest(s.o.resolveURL(f),s.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(y,w)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new s.y(y));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(E.resourceTiming=w.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new s.z("data",E)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=s.B(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,o){const f=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,w=y?{image:y.image.clone()}:null,E=this._partialReload,j={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:E,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};g.request=this.actor.send(f,j,(I,O)=>E&&!O?(g.state="loaded",o(null)):(delete g.request,g.destroy(!1),g.aborted?o(null):I?o(I):(g.loadVectorData(O,this.map.painter,f==="reloadTile"),o(null))),void 0,f==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,o){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(g,o,f,y){super(g,o,f,y),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const o of g.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.R.Source).url);s.aV(this.urls,(o,f)=>{this._loaded=!0,o?this.fire(new s.y(o)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const o=this.video.seekable;g<o.start(0)||g>o.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,o=g.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(g,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(g,o,f,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,o,f,(y,w)=>{this._tileJSONRequest=null,this._loaded=!0,y?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.y(y))):w&&(Object.assign(this,w),w.bounds&&(this.tileBounds=new Go(w.bounds,this.minzoom,this.maxzoom)),Je(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,o){const f=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(f,s.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=o;else{if(g.buckets){const E=Object.values(g.buckets);for(const j of E)j.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,w.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,w.bind(this),void 0,!0);function w(E,j){return g.aborted?o(null):E&&E.status!==404?o(E):(this.map._refreshExpiredTiles&&j&&g.setExpiryData(j),g.loadModelData(j,this.map.painter),g.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(g,o,f,y){super(g,o,f,y),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(E=>typeof E!="number"))||this.fire(new s.y(new s.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${g}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends s.E{constructor(g,o,f,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=o,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Go(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:o,y:f,z:y}=g.canonical;return this._implementation.hasTile({x:o,y:f,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,o){const{x:f,y,z:w}=g.tileID.canonical,E=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:f,y,z:w},{signal:E.signal})).then((function(j){return delete g.request,g.aborted?(g.state="unloaded",o(null)):j===void 0?(g.state="errored",o(null)):j===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",o(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(j)?(this.loadTileData(g,j),g.state="loaded",void o(null)):(g.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.name!=="AbortError"&&(g.state="errored",o(j))}),g.request.cancel=()=>E.abort()}loadTileData(g,o){g.setTexture(o,this.map.painter)}unloadTile(g,o){if(g.texture&&g.texture instanceof s.T?(g.destroy(!1),g.texture&&g.texture instanceof s.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:f,y,z:w}=g.tileID.canonical;this._implementation.unloadTile({x:f,y,z:w})}o&&o()}abortTile(g,o){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=s.B(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Lh=function(g,o,f,y){const w=new ku[o.type](g,o,f,y);if(w.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${w.id}`);return s.aY(["load","abort","unload","serialize","prepare"],w),w};function gl(g,o,f=""){return`${f}:${o.id||""}:${o.layer.id}:${function(y){if("layerId"in y)return`layer:${y.layerId}`;{const{featuresetId:w,importId:E}=y;return`featureset:${w}${E?`:import:${E}`:""}`}}(g.target)}`}function sg(g,o,f,y=""){if(g.uniqueFeatureID){const w=gl(g,o,y);if(f.has(w))return!0;f.add(w)}return!1}function ag(g,o,f,y,w=!1,E=void 0){const j=o.sourceCache.transform,I=o.sourceCache.tilesIn(g,o.has3DLayers,w);I.sort(Db);const O=[];for(const U of I){const q=U.tile.queryRenderedFeatures(o,U,f,y,j,w,E);Object.keys(q).length&&O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:q})}for(const U in o.layers){const q=o.layers[U];if(q.styleLayer){const X=q.styleLayer.queryRenderedFeatures(g,o.sourceCache,y);Object.keys(X).length&&O.push({wrappedTileID:0,queryResults:X})}}return O.length===0?{}:function(U){const q={},X={};for(const Z of U){const J=Z.queryResults,se=Z.wrappedTileID,re=X[se]=X[se]||{};for(const oe in J){const he=J[oe],xe=re[oe]=re[oe]||{},_e=q[oe]=q[oe]||[];for(const ye of he)xe[ye.featureIndex]||(xe[ye.featureIndex]=!0,_e.push(ye))}}return q}(O)}function vE(g,o,f,y,w,E){const j={},I=y.queryRenderedSymbols(g),O=[];for(const U of Object.keys(I).map(Number))O.push(w[U]);O.sort(Db);for(const U of O){const q=U.featureIndex.lookupSymbolFeatures(I[U.bucketInstanceId],U.bucketIndex,U.sourceLayerIndex,o,f,E);for(const X in q){const Z=j[X]=j[X]||[],J=q[X];J.sort((se,re)=>{const oe=U.featureSortOrder;if(oe){const he=oe.indexOf(se.featureIndex);return oe.indexOf(re.featureIndex)-he}return re.featureIndex-se.featureIndex});for(const se of J)Z.push(se)}}return j}function _E(g,o){const f=g.getRenderableIds().map(E=>g.getTileByID(E)),y=[],w={};for(let E=0;E<f.length;E++){const j=f[E],I=j.tileID.canonical.key;w[I]||(w[I]=!0,j.querySourceFeatures(y,o))}return y}function Db(g,o){const f=g.tileID,y=o.tileID;return f.overscaledZ-y.overscaledZ||f.canonical.y-y.canonical.y||f.wrap-y.wrap||f.canonical.x-y.canonical.x}function Lb(g,o){const f={};if(!o)return f;for(const y of g){const w=y.layerIds.map(E=>o.getLayer(E)).filter(Boolean);if(w.length!==0){y.layers=w,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>w.filter(j=>j.id===E)[0]));for(const E of w)f[E.fqid]=y}}return f}const sa=32,yl=33,Ou=new Uint16Array(8184);for(let g=0;g<2046;g++){let o=g+2,f=0,y=0,w=0,E=0,j=0,I=0;for(1&o?w=E=j=sa:f=y=I=sa;(o>>=1)>1;){const U=f+w>>1,q=y+E>>1;1&o?(w=f,E=y,f=j,y=I):(f=w,y=E,w=j,E=I),j=U,I=q}const O=4*g;Ou[O+0]=f,Ou[O+1]=y,Ou[O+2]=w,Ou[O+3]=E}const vl=new Uint16Array(2178),Zc=new Uint8Array(1089),Kf=new Uint16Array(1089);function Yf(g){return g===0?-.03125:g===32?.03125:0}const Fh={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Nd{constructor(o,f,y,w,E,j){this.tileID=o,this.uid=s.b2(),this.uses=0,this.tileSize=f,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection),this.worldview=j,this._hasAppearances=null}registerFadeDuration(o){const f=o+this.timeAdded;f<s.o.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,f,y){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Lb(o.buckets,f.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const E=this.buckets[w];if(E instanceof s.b4){if(this.hasSymbolBuckets=!0,!y)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const E=this.buckets[w];if(E instanceof s.b4&&E.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const w in this.buckets){const E=this.buckets[w],j=f.style.getOwnLayer(w);if(!j)continue;const I=j.queryRadius(E);this.queryPadding=Math.max(this.queryPadding,I)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,f,y){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Lb(o.buckets,f.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,f){for(const E in this.buckets){const j=this.buckets[E];if(j.uploadPending()){let I={},O=[],U={zoom:0,pitch:0,brightness:0,worldview:""};if(f){if(f.style){O=f.style.listImages();const q=j.layers[0],X=q.sourceLayer||"_geojsonTileLayer",Z=f.style.getLayerSourceCache(q);Z&&(I=Z._state.getState(X,void 0))}U={zoom:f.transform.zoom||0,pitch:f.transform.pitch||0,brightness:f.style.getBrightness()||0,worldview:f.worldview||""}}j.upload(o,this.tileID.canonical,I,O,U)}}const y=o.gl,w=this.imageAtlas;w&&!w.uploaded&&(this.imageAtlasTexture=new s.T(o,w.image,y.RGBA8,{useMipmap:!!w.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(o,this.glyphAtlasImage,y.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(o,this.lineAtlas.image,y.R8),this.lineAtlas.uploaded=!0)}prepare(o,f,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,y),!f||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=f.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(f)),(this._lastUpdatedBrightness||w||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(f,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const f in this.buckets){const y=this.buckets[f];y.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,y.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,f,y,w,E,j,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const O=this.evaluateQueryRenderedFeaturePadding(),U=function(q,X){const Z=s.bq([],[.5*q.width,.5*-q.height,1]);return s.br(Z,Z,[1,-1,0]),s.aB(Z,Z,q.calculateProjMatrix(X.toUnwrapped())),Float32Array.from(Z)}(E,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:f,pixelPosMatrix:U,transform:w,availableImages:y,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:O,scope:I})}querySourceFeatures(o,f){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const w=y.loadVTLayers(),E=f?f.sourceLayer:"",j=w._geojsonTileLayer||w[E];if(!j)return;const I=s.b6(f&&f.filter),{z:O,x:U,y:q}=this.tileID.canonical,X={z:O,x:U,y:q};for(let Z=0;Z<j.length;Z++){const J=j.feature(Z);if(I.needGeometry){const oe=s.b7(J,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J))continue;const se=y.getId(J,E),re=new s.b8(J,O,U,q,se);re.tile=X,o.push(re)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const f=this.expirationTime;if(o.cacheControl){const y=s.b9(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let w=!1;if(this.expirationTime>y)w=!1;else if(f)if(this.expirationTime<f)w=!0;else{const E=this.expirationTime-f;E?this.expirationTime=y+Math.max(E,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const f in this.buckets)if(o.style.hasLayer(f)&&this.buckets[f].layers.some(y=>y.appearances&&y.appearances.length>0))return!0;return!1}updateBuckets(o,f){if(!this.latestFeatureIndex||!o.style)return;const y=o.style.listImages(),w=o.style.getBrightness();for(const E in this.buckets){if(!o.style.hasLayer(E))continue;const j=this.buckets[E],I=j.layers[0],O=I.sourceLayer||"_geojsonTileLayer",U=o.style.getLayerSourceCache(I);let q={};U&&(q=U._state.getState(O,void 0));const X=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(q).length>0&&!f;j.hasAppearances=j.layers.some(re=>re.appearances&&re.appearances.length>0);const J=Z?j.stateDependentLayers:j.layers;if(Z&&j.stateDependentLayers.length!==0||f){const re=this.latestFeatureIndex.loadVTLayers();j.update(q,re[O],y,X,J,f,w)}if(Z&&j.stateDependentLayers.length!==0||f||j.hasAppearances){const re={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};j.updateAppearances(this.tileID.canonical,q,y,re,o.imageManager)}(j instanceof s.ba||j instanceof s.bb)&&o._terrain&&o._terrain.enabled&&U&&j.uploadPending()&&o._terrain._clearRenderCacheForTile(U.id,this.tileID);const se=o&&o.style&&o.style.getOwnLayer(E);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(j)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=s.o.now()+o}setTexture(o,f){const y=f.context,w=y.gl;this.texture=this.texture||f.getTileTexture(o.width),this.texture&&this.texture instanceof s.T?this.texture.update(o):(this.texture=new s.T(y,o,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(o,f){const y={};for(const w of f)y[w]=!0;this.dependencies[o]=y}hasDependency(o,f){for(const y of o){const w=this.dependencies[y];if(w){for(const E of f)if(w[E])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const y=s.bc(Fh,this.tileID.canonical,this.tileTransform)[0],w=new s.bd,E=new s.be;for(let j=0;j<y.length;j++){const{x:I,y:O}=y[j];w.emplaceBack(I,O),E.emplaceBack(j)}E.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(w,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,w.length,E.length)}_makeTileBoundsBuffers(o,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const y=s.bc(Fh,this.tileID.canonical,this.tileTransform)[0];let w,E;if(this.isRaster){const j=function(I,O){const U=s.aZ(I,O),q=Math.pow(2,I.z);for(let oe=0;oe<yl;oe++)for(let he=0;he<yl;he++){const xe=s.a_((I.x+(he+Yf(he))/sa)/q),_e=s.a$((I.y+(oe+Yf(oe))/sa)/q),ye=O.project(xe,_e),Le=oe*yl+he;vl[2*Le+0]=Math.round((ye.x*U.scale-U.x)*s.al),vl[2*Le+1]=Math.round((ye.y*U.scale-U.y)*s.al)}Zc.fill(0),Kf.fill(0);for(let oe=2045;oe>=0;oe--){const he=4*oe,xe=Ou[he+0],_e=Ou[he+1],ye=Ou[he+2],Le=Ou[he+3],ke=xe+ye>>1,Re=_e+Le>>1,Ae=ke+Re-_e,Te=Re+xe-ke,$e=_e*yl+xe,Ze=Le*yl+ye,Ye=Re*yl+ke,it=Math.hypot((vl[2*$e+0]+vl[2*Ze+0])/2-vl[2*Ye+0],(vl[2*$e+1]+vl[2*Ze+1])/2-vl[2*Ye+1])>=16;Zc[Ye]=Zc[Ye]||(it?1:0),oe<1022&&(Zc[Ye]=Zc[Ye]||Zc[(_e+Te>>1)*yl+(xe+Ae>>1)]||Zc[(Le+Te>>1)*yl+(ye+Ae>>1)])}const X=new s.b1,Z=new s.b0;let J=0;function se(oe,he){const xe=he*yl+oe;return Kf[xe]===0&&(X.emplaceBack(vl[2*xe+0],vl[2*xe+1],oe*s.al/sa,he*s.al/sa),Kf[xe]=++J),Kf[xe]-1}function re(oe,he,xe,_e,ye,Le){const ke=oe+xe>>1,Re=he+_e>>1;if(Math.abs(oe-ye)+Math.abs(he-Le)>1&&Zc[Re*yl+ke])re(ye,Le,oe,he,ke,Re),re(xe,_e,ye,Le,ke,Re);else{const Ae=se(oe,he),Te=se(xe,_e),$e=se(ye,Le);Z.emplaceBack(Ae,Te,$e)}}return re(0,0,sa,sa,sa,0),re(sa,sa,0,0,0,sa),{vertices:X,indices:Z}}(this.tileID.canonical,f);w=j.vertices,E=j.indices}else{w=new s.b1,E=new s.b0;for(const{x:I,y:O}of y)w.emplaceBack(I,O,0,0);const j=s.bh(w.int16.subarray(0,4*w.length),void 0,4);for(let I=0;I<j.length;I+=3)E.emplaceBack(j[I],j[I+1],j[I+2])}this._tileBoundsBuffer=o.createVertexBuffer(w,s.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(E),this._tileBoundsSegments=s.bg.simpleSegment(0,0,w.length,E.length)}_makeGlobeTileDebugBuffers(o,f){const y=f.projection;if(!y||y.name!=="globe"||f.freezeTileCoverage)return;const w=this.tileID.canonical,E=s.bj(w,f),j=s.bk(E),I=s.aj(f.zoom);let O;I>0&&(O=s.bl(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,w,f,j,O,I),this._makeGlobeTileDebugTextBuffer(o,w,f,j,O,I)}_globePoint(o,f,y,w,E,j,I){let O=s.bm(o,f,y);if(j){const U=1<<y.z,q=s.aF(w.center.lng),X=s.aJ(w.center.lat),Z=(y.x+.5)/U-q;let J=0;Z>.5?J=-1:Z<-.5&&(J=1);let se=(o/s.al+y.x)/U+J,re=(f/s.al+y.y)/U;se=(se-q)*w._pixelsPerMercatorPixel+q,re=(re-X)*w._pixelsPerMercatorPixel+X;const oe=[se*w.worldSize,re*w.worldSize,0];s.af(oe,oe,j),O=s.bn(O,oe,I)}return s.af(O,O,E)}_makeGlobeTileDebugBorderBuffer(o,f,y,w,E,j){const I=new s.bd,O=new s.be,U=new s.bo,q=(Z,J,se,re,oe)=>{const he=(se-Z)/(oe-1),xe=(re-J)/(oe-1),_e=I.length;for(let ye=0;ye<oe;ye++){const Le=Z+ye*he,ke=J+ye*xe;I.emplaceBack(Le,ke);const Re=this._globePoint(Le,ke,f,y,w,E,j);U.emplaceBack(Re[0],Re[1],Re[2]),O.emplaceBack(_e+ye)}},X=s.al;q(0,0,X,0,16),q(X,0,X,X,16),q(X,X,0,X,16),q(0,X,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(O),this._tileDebugBuffer=o.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(U,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,O.length)}_makeGlobeTileDebugTextBuffer(o,f,y,w,E,j){const I=s.al/4,O=new s.bd,U=new s.b0,q=new s.bo,X=25;U.reserve(32),O.reserve(X),q.reserve(X);const Z=(J,se)=>X*J+se;for(let J=0;J<X;J++){const se=J*I;for(let re=0;re<X;re++){const oe=re*I;O.emplaceBack(oe,se);const he=this._globePoint(oe,se,f,y,w,E,j);q.emplaceBack(he[0],he[1],he[2])}}for(let J=0;J<4;J++)for(let se=0;se<4;se++){const re=Z(J,se),oe=Z(J,se+1),he=Z(J+1,se),xe=Z(J+1,se+1);U.emplaceBack(re,oe,he),U.emplaceBack(he,oe,xe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(U),this._tileDebugTextBuffer=o.createVertexBuffer(O,s.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(q,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,X,32)}destroy(o=!0){for(const f in this.buckets)this.buckets[f].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class Iv extends Nd{constructor(o,f,y,w,E){super(o,f,y,w,E),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,f,y){const w=y.context,E=w.gl;let j=this.texturePerLayer.get(o)||y.getTileTexture(f.width);j&&j instanceof s.T?j.update(f,{premultiply:!1}):j=new s.T(w,f,E.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,j)}flushQueues(o){const f=this._workQueuePerLayer.get(o)||[],y=this._fetchQueuePerLayer.get(o)||[];for(;f.length;)f.pop()();for(;y.length;)y.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const f=this._workQueuePerLayer.get(o)||[];for(;f.length;)f.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const f=this._fetchQueuePerLayer.get(o)||[];for(;f.length;)f.pop()()}}fetchHeader(o=16384,f){const y=this._mrt=new s.bs(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=s.bu(w,(E,j,I)=>{if(E)f(E);else try{const O=y.getHeaderLength(j);if(O>o)return void(this.request=this.fetchHeader(O,f));y.parseHeader(j),this._isHeaderLoaded=!0;let U=0;for(const q of Object.values(y.layers))U=Math.max(U,q.dataIndex[q.dataIndex.length-1].lastByte);j.byteLength>=U&&(this.entireBuffer=j),f(null,this.entireBuffer||j,I)}catch(O){f(O)}}),this.request}fetchBandForRender(o,f,y,w){this.fetchBand(o,f,y,E=>{if(E)return void w(E);this.updateTextureDescriptor(o,f,y);const j=this.textureDescriptorPerLayer.get(f);w(null,j?j.img:null)})}fetchBand(o,f,y,w,E=!0){const j=this._mrt;if(!this._isHeaderLoaded||!j)return void w(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void w(new Error("Can't fetch tile band without an actor"));let O;const U=s.B(String(y),s.B(this.tileID.key,o));let q=this._taskQueue.get(U);q?q.add(w):(q=new Set,q.add(w),this._taskQueue.set(U,q));const X=(re,oe)=>{O.complete(re,oe),re?w(re):(q.forEach(he=>he(null,oe)),this._taskQueue.delete(U))},Z=(re,oe)=>{if(re)return w(re);const he=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:oe,task:O},X,void 0,!0);if(f!==null){const xe=this._workQueuePerLayer.get(f)||[];xe.push(()=>{he&&he.cancel(),O.cancel()}),this._workQueuePerLayer.has(f)||this._workQueuePerLayer.set(f,xe)}};let J;try{J=j.getLayer(o)}catch(re){if(this.state==="reloading")return;throw re}if(!J)return void w(new Error(`Unknown sourceLayer "${o}"`));if(J.hasDataForBand(y))return q.forEach(re=>re(null,null)),void this._taskQueue.delete(U);const se=J.getDataRange([y]);if(O=j.createDecodingTask(se),!O||O.tasks.length)if(f!==null&&this.flushQueues(f),this.entireBuffer)Z(null,this.entireBuffer.slice(se.firstByte,se.lastByte+1));else{const re=Object.assign({},this.requestParams,{headers:{Range:`bytes=${se.firstByte}-${se.lastByte}`}}),oe=s.bu(re,Z);if(f!==null){const he=this._fetchQueuePerLayer.get(f)||[];he.push(()=>{oe.cancel(),O.cancel()}),this._fetchQueuePerLayer.has(f)||this._fetchQueuePerLayer.set(f,he)}}}updateNeeded(o,f){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==f||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,f,y){if(!this._mrt)return;const w=this._mrt.getLayer(o);if(!w||!w.hasBand(y)||!w.hasDataForBand(y))return;const{bytes:E,tileSize:j,buffer:I,offset:O,scale:U}=w.getBandView(y),q=j+2*I,X=new s.q({width:q,height:q},E),Z=this.texturePerLayer.get(f);Z&&Z instanceof s.T&&Z.update(X,{premultiply:!1}),this.textureDescriptorPerLayer.set(f,{layer:o,band:y,img:X,buffer:I,offset:O,tileSize:j,format:w.pixelFormat,mix:[U,256*U,65536*U,16777216*U]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const f of this.texturePerLayer.values())f&&f instanceof s.T&&f.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class xE{constructor(o,f){this.max=o,this.onRemove=f,this.reset()}reset(){for(const o in this.data)for(const f of this.data[o])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(o,f,y){const w=o.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const E={value:f,timeout:void 0};if(y!==void 0&&(E.timeout=setTimeout(()=>{this.remove(o,E)},y)),this.data[w].push(E),this.order.push(w),this.order.length>this.max){const j=this._getAndRemoveByKey(this.order[0]);j&&this.onRemove(j)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const f=this.data[o].shift();return f.timeout&&clearTimeout(f.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),f.value}getByKey(o){const f=this.data[o];return f?f[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,f){if(!this.has(o))return this;const y=o.wrapped().key,w=f===void 0?0:this.data[y].indexOf(f),E=this.data[y][w];return this.data[y].splice(w,1),E.timeout&&clearTimeout(E.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(E.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(o){const f=[];for(const y in this.data)for(const w of this.data[y])o(w.value)||f.push(w);for(const y of f)this.remove(y.value.tileID,y)}}class bE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,f,y){const w=String(f);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][w]=this.stateChanges[o][w]||{},Object.assign(this.stateChanges[o][w],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const E in this.state[o])E!==w&&(this.deletedStates[o][E]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][w]===null){this.deletedStates[o][w]={};for(const E in this.state[o][w])y[E]||(this.deletedStates[o][w][E]=null)}else for(const E in y)this.deletedStates[o]&&this.deletedStates[o][w]&&this.deletedStates[o][w][E]===null&&delete this.deletedStates[o][w][E]}removeFeatureState(o,f,y){if(this.deletedStates[o]===null)return;const w=String(f);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&f!==void 0)this.deletedStates[o][w]!==null&&(this.deletedStates[o][w]=this.deletedStates[o][w]||{},this.deletedStates[o][w][y]=null);else if(f!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][w])for(y in this.deletedStates[o][w]={},this.stateChanges[o][w])this.deletedStates[o][w][y]=null;else this.deletedStates[o][w]=null;else this.deletedStates[o]=null}getState(o,f){const y=this.state[o]||{},w=this.stateChanges[o]||{},E=this.deletedStates[o];if(E===null)return{};if(f!==void 0){const I=String(f),O=Object.assign({},y[I],w[I]);if(E){const U=E[f];if(U===null)return{};for(const q in U)delete O[q]}return O}const j=Object.assign({},y,w);if(E)for(const I in E)delete j[I];return j}initializeTileState(o,f){o.refreshFeatureState(f)}coalesceChanges(o,f){const y={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const E={};for(const j in this.stateChanges[w])this.state[w][j]||(this.state[w][j]={}),Object.assign(this.state[w][j],this.stateChanges[w][j]),E[j]=this.state[w][j];y[w]=E}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const E={};if(this.deletedStates[w]===null)for(const j in this.state[w])E[j]={},this.state[w][j]={};else for(const j in this.deletedStates[w]){if(this.deletedStates[w][j]===null)this.state[w][j]={};else if(this.state[w][j])for(const I of Object.keys(this.deletedStates[w][j]))delete this.state[w][j][I];E[j]=this.state[w][j]}y[w]=y[w]||{},Object.assign(y[w],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const w in o)o[w].refreshFeatureState(f)}}class So extends s.E{constructor(o,f,y){super(),this.id=o,this._onlySymbols=y,f.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new xE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new bE,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,f){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,f)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const y=this._tiles[f];y.upload(o,this.map?this.map.painter:void 0),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(og).map(o=>o.key)}getRenderableIds(o,f){const y=[];for(const w in this._tiles)this._isIdRenderable(+w,o,f)&&y.push(this._tiles[w]);return o?y.sort((w,E)=>{const j=w.tileID,I=E.tileID,O=new s.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle),U=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return j.overscaledZ-I.overscaledZ||U.y-O.y||U.x-O.x}).map(w=>w.tileID.key):y.map(w=>w.tileID).sort(og).map(w=>w.key)}hasRenderableParent(o){const f=this.findLoadedParent(o,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(o,f,y){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(f||!this._tiles[o].holdingForFade())&&(y||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,f){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=f),this._loadTile(y,this._tileLoaded.bind(this,y,o,f)))}_tileLoaded(o,f,y,w,E){if(w){if(o.state="errored",w.status!==404)this._source.fire(new s.y(w,{tile:o}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=s.o.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(f,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let j=new Map;E&&E.responseHeaders&&(j=E.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:j}))}_backfillDEM(o){const f=this.getRenderableIds();for(let w=0;w<f.length;w++){const E=f[w];if(o.neighboringTiles&&o.neighboringTiles[E]){const j=this.getTileByID(E);y(o,j),y(j,o)}}function y(w,E){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let j=E.tileID.canonical.x-w.tileID.canonical.x;const I=E.tileID.canonical.y-w.tileID.canonical.y,O=Math.pow(2,w.tileID.canonical.z),U=E.tileID.key;j===0&&I===0||Math.abs(I)>1||(Math.abs(j)>1&&(Math.abs(j+O)===1?j+=O:Math.abs(j-O)===1&&(j-=O)),E.dem&&w.dem&&(w.dem.backfillBorder(E.dem,j,I),w.neighboringTiles&&w.neighboringTiles[U]&&(w.neighboringTiles[U].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,f,y,w){for(const E in this._tiles){let j=this._tiles[E];if(w[E]||!j.hasData()||j.tileID.overscaledZ<=f||j.tileID.overscaledZ>y)continue;let I=j.tileID;for(;j&&j.tileID.overscaledZ>f+1;){const U=j.tileID.scaledTo(j.tileID.overscaledZ-1);j=this._tiles[U.key],j&&j.hasData()&&(I=U)}let O=I;for(;O.overscaledZ>f;)if(O=O.scaledTo(O.overscaledZ-1),o[O.key]){w[I.key]=I;break}}}findLoadedParent(o,f){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=f?y:null}for(let y=o.overscaledZ-1;y>=f;y--){const w=o.scaledTo(y),E=this._getLoadedTile(w);if(E)return E}}_getLoadedTile(o){const f=this._tiles[o.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,f){f=f||this._source.tileSize;const y=Math.ceil(o.width/f)+1,w=Math.ceil(o.height/f)+1,E=Math.floor(y*w*5),j=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,E):E,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,j):j;this._cache.setMaxSize(I)}handleWrapJump(o){const f=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,f){const y={};for(const w in this._tiles){const E=this._tiles[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),y[E.tileID.key]=E}this._tiles=y;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(o,f,y,w,E){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(o,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const j=this._source.type==="batched-model";let I,O=this._source.maxzoom;const U=this.map&&this.map.painter?this.map.painter._terrain:null;if(U&&U.sourceCache===this&&U.attenuationRange()){const Z=U.attenuationRange()[0],J=Math.floor(Z)-Math.log2(U.getDemUpscale());O>J&&(O=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new s.aQ(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=o.clone();Z.tileCoverLift=this.tileCoverLift,I=Z.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:j}),this._source.minzoom<=1&&o.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=o.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:j}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);I=I.filter(J=>Z(J))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!lg(this._source.type)){const Z=o.coveringZoomLevel({tileSize:f||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),J=Math.min(Z,this._source.maxzoom);if(j){const se=o.extendTileCover(I,J);for(const re of se)I.push(re)}else if(E){const se=o.extendTileCoverToNearPlane(I,this.transform.getFrustum(J),J);for(const re of se)I.push(re)}else if(this.castsShadows&&w){const se=o.extendTileCover(I,J,w,16);for(const re of se)this._shadowCasterTiles[re.key]=!0,I.push(re)}}const q=this._updateRetainedTiles(I);if(lg(this._source.type)&&I.length!==0){const Z={},J={},se=Object.keys(q);for(const oe of se){const he=q[oe],xe=this._tiles[oe];if(!xe||xe.fadeEndTime&&xe.fadeEndTime<=s.o.now())continue;const _e=this.findLoadedParent(he,Math.max(he.overscaledZ-So.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),Z[_e.tileID.key]=_e.tileID),J[oe]=he}const re=I[I.length-1].overscaledZ;for(const oe in this._tiles){const he=this._tiles[oe];if(q[oe]||!he.hasData())continue;let xe=he.tileID;for(;xe.overscaledZ>re;){xe=xe.scaledTo(xe.overscaledZ-1);const _e=this._tiles[xe.key];if(_e&&_e.hasData()&&J[xe.key]){q[oe]=he.tileID;break}}}for(const oe in Z)q[oe]||(this._coveredTiles[oe]=!0,q[oe]=Z[oe])}for(const Z in q)this._tiles[Z].clearFadeHold();const X=s.bv(this._tiles,q);for(const Z of X){const J=this._tiles[Z];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const f={};if(o.length===0)return f;const y={},w=o.reduce((U,q)=>Math.min(U,q.overscaledZ),1/0),E=o[0].overscaledZ,j=Math.max(E-So.maxOverzooming,this._source.minzoom),I=Math.max(E+So.maxUnderzooming,this._source.minzoom),O={};for(const U of o){const q=this._addTile(U);f[U.key]=U,q.hasData()||w<this._source.maxzoom&&(O[U.key]=U)}this._retainLoadedChildren(O,w,I,f);for(const U of o){let q=this._tiles[U.key];if(q.hasData())continue;if(U.canonical.z>=this._source.maxzoom){const Z=U.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){f[Z.key]=Z;continue}}else{const Z=U.children(this._source.maxzoom);if(f[Z[0].key]&&f[Z[1].key]&&f[Z[2].key]&&f[Z[3].key])continue}let X=q.wasRequested();for(let Z=U.overscaledZ-1;Z>=j;--Z){const J=U.scaledTo(Z);if(y[J.key]||(y[J.key]=!0,q=this.getTile(J),!q&&X&&(q=this._addTile(J)),q&&(f[J.key]=J,X=q.wasRequested(),q.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const f=[];let y,w=this._tiles[o].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){y=this._loadedParentTiles[w.key];break}f.push(w.key);const E=w.scaledTo(w.overscaledZ-1);if(y=this._getLoadedTile(E),y)break;w=E}for(const E of f)this._loadedParentTiles[E]=y}}_addTile(o){let f=this._tiles[o.key];if(f)return f.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),f;f=this._cache.getAndRemove(o),f&&(this._setTileReloadTimer(o.key,f),f.tileID=o,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,f)));const y=!!f;if(!y){const w=this.map?this.map.painter:null,E=this._source.tileSize*o.overscaleFactor();f=this._source.type==="raster-array"?new Iv(o,E,this.transform.tileZoom,w,this._isRaster):new Nd(o,E,this.transform.tileZoom,w,this._isRaster,this._source.worldview),this._loadTile(f,this._tileLoaded.bind(this,f,o.key,f.state))}return f.uses++,this._tiles[o.key]=f,y||this._source.fire(new s.z("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(o,f){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=f.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const f=this._tiles[o];f&&(f.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),f.uses>0||(f.hasData()&&f.state!=="reloading"||f.state==="empty"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,f,y){const w=[],E=this.transform;if(!E)return w;const j=E.projection.name==="globe",I=s.aF(E.center.lng);for(const O in this._tiles){const U=this._tiles[O];if(y&&U.clearQueryDebugViz(),U.holdingForFade())continue;let q;if(j){const X=U.tileID.canonical;if(X.z===0){const Z=[Math.abs(s.aA(I,...Ru(X,-1))-I),Math.abs(s.aA(I,...Ru(X,1))-I)];q=[0,2*Z.indexOf(Math.min(...Z))-1]}else{const Z=[Math.abs(s.aA(I,...Ru(X,-1))-I),Math.abs(s.aA(I,...Ru(X,0))-I),Math.abs(s.aA(I,...Ru(X,1))-I)];q=[Z.indexOf(Math.min(...Z))-1]}}else q=[0];for(const X of q){const Z=o.containsTile(U,E,f,X);Z&&w.push(Z)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,f){const y=this.getRenderableIds(o,f).map(E=>this._tiles[E].tileID),w=this.transform.projection.name==="globe";for(const E of y)E.projMatrix=this.transform.calculateProjMatrix(E.toUnwrapped()),E.expandedProjMatrix=w?this.transform.calculateProjMatrix(E.toUnwrapped(),!1,!0):E.projMatrix;return y}sortCoordinatesByDistance(o){const f=o.slice(),y=this.transform._camera.position,w=this.transform._camera.forward(),E={};for(const j of f){const I=1/(1<<j.canonical.z);E[j.key]=((j.canonical.x+.5)*I+j.wrap-y[0])*w[0]+((j.canonical.y+.5)*I-y[1])*w[1]-y[2]*w[2]}return f.sort((j,I)=>E[j.key]-E[I.key]),f}hasTransition(){if(this._source.hasTransition())return!0;if(lg(this._source.type))for(const o in this._tiles){const f=this._tiles[o];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(o,f,y){this._state.updateState(o=o||"_geojsonTileLayer",f,y)}removeFeatureState(o,f,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",f,y)}getFeatureState(o,f){return this._state.getState(o=o||"_geojsonTileLayer",f)}setDependencies(o,f,y){const w=this._tiles[o];w&&w.setDependencies(f,y)}reloadTilesForDependencies(o,f){for(const y in this._tiles)this._tiles[y].hasDependency(o,f)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(o,f))}_preloadTiles(o,f){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(o,f))};return void this._source.on("data",O)}const y=new Map,w=Array.isArray(o)?o:[o],E=this.map.painter.terrain,j=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const O of w){const U=O.coveringTiles({tileSize:j,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const q of U)y.set(q.key,q);this.usedForTerrain&&O.updateElevation(!1)}const I=Array.from(y.values());s.bw(I,(O,U)=>{const q=new Nd(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(q,X=>{this._source.type==="raster-dem"&&q.dem&&this._backfillDEM(q),U(X,q)})},f)}}function og(g,o){const f=Math.abs(2*g.wrap)-+(g.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||y-f||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function lg(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function Ru(g,o){const f=1<<g.z;return[g.x/f+o,(g.x+1)/f+o]}So.maxOverzooming=10,So.maxUnderzooming=3;class cg{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,f=!1;for(const y in this.style._mergedLayers){const w=this.style._mergedLayers[y];if(w.type==="fill-extrusion"||w.type==="building")this.layers.push({layer:w,visible:o,visibilityChanged:f});else if(w.type==="model"){const E=this.style.getLayerSource(w);E&&E.type==="batched-model"&&this.layers.push({layer:w,visible:o,visibilityChanged:f})}}}onNewFrame(o){this.layersGotHidden=!1;for(const f of this.layers){const y=f.layer;let w=!1;y.type==="fill-extrusion"?w=!y.isHidden(o)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="building"?w=!y.isHidden(o)&&y.paint.get("building-opacity")>0:y.type==="model"&&(w=!y.isHidden(o)&&y.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&f.visible,f.visible=w}}updateZOffset(o,f){this.currentBuildingBuckets=[];for(const w of this.layers){const E=w.layer,j=this.style.getLayerSourceCache(E);let I=1;E.type==="fill-extrusion"?I=w.visible?E.paint.get("fill-extrusion-vertical-scale"):0:E.type==="building"&&(I=w.visible?E.paint.get("building-vertical-scale"):0);let O=j?j.getTile(f):null;if(!O&&j)for(const U in j._tiles){const q=j._tiles[U];if(f.canonical.isChildOf(q.tileID.canonical)){O=q;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(E):null,tileID:O?O.tileID:f,verticalScale:I})}o.hasAnyZOffset=!1;let y=!1;for(let w=0;w<o.symbolInstances.length;w++){const E=o.symbolInstances.get(w),j=E.zOffset,I=this._getHeightAtTileOffset(f,E.tileAnchorX,E.tileAnchorY);E.zOffset=I!==Number.NEGATIVE_INFINITY?I:j,y||j===E.zOffset||(y=!0),o.hasAnyZOffset||E.zOffset===0||(o.hasAnyZOffset=!0)}y&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,f,y,w){let E=f,j=y;if(o.canonical.z!==w.canonical.z){const I=w.canonical,O=1/(1<<o.canonical.z-I.z);E=(f+o.canonical.x*s.al)*O-I.x*s.al|0,j=(y+o.canonical.y*s.al)*O-I.y*s.al|0}return{tileX:E,tileY:j}}_getHeightAtTileOffset(o,f,y){let w,E;for(let j=0;j<this.layers.length;++j){const I=this.layers[j].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:O,tileID:U,verticalScale:q}=this.currentBuildingBuckets[j];if(!O)continue;const{tileX:X,tileY:Z}=this._mapCoordToOverlappingTile(o,f,y,U),J=O.getHeightAtTileCoord(X,Z);J&&J.height!==void 0&&(J.hidden?w=J.height:E=Math.max(J.height*q,E||0))}if(E!==void 0)return E;for(let j=0;j<this.layers.length;++j){const I=this.layers[j];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:O,tileID:U}=this.currentBuildingBuckets[j];if(!O)continue;const{tileX:q,tileY:X}=this._mapCoordToOverlappingTile(o,f,y,U),Z=O.getHeightAtTileCoord(q,X);if(Z&&!Z.hidden)return Z.height===void 0&&w!==void 0?Math.min(Z.maxHeight,w)*Z.verticalScale:Z.height?Z.height*Z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function dO(g,o){const f={};for(const y in g)y!=="ref"&&(f[y]=g[y]);return s.bx.forEach(y=>{y in o&&(f[y]=o[y])}),f}function Fb(g){g=g.slice();const o=Object.create(null);for(let f=0;f<g.length;f++)o[g[f].id]=g[f];for(let f=0;f<g.length;f++)"ref"in g[f]&&(g[f]=dO(g[f],o[g[f].ref]));return g}const bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Jf(g,o,f){f.push({command:bn.addSource,args:[g,o[g]]})}function kv(g,o,f){o.push({command:bn.removeSource,args:[g]}),f[g]=!0}function wE(g,o,f,y){kv(g,f,y),Jf(g,o,f)}function SE(g,o,f){let y;for(y in g[f])if(g[f].hasOwnProperty(y)&&y!=="data"&&!s.by(g[f][y],o[f][y]))return!1;for(y in o[f])if(o[f].hasOwnProperty(y)&&y!=="data"&&!s.by(g[f][y],o[f][y]))return!1;return!0}function ug(g,o,f,y,w,E){let j;for(j in o=o||{},g=g||{})g.hasOwnProperty(j)&&(s.by(g[j],o[j])||f.push({command:E,args:[y,j,o[j],w]}));for(j in o)o.hasOwnProperty(j)&&!g.hasOwnProperty(j)&&(s.by(g[j],o[j])||f.push({command:E,args:[y,j,o[j],w]}))}function Id(g){return g.id}function dg(g,o){return g[o.id]=o,g}function Ov(g,o,f){const y=o.createTileMatrix(g,g.worldSize,f.toUnwrapped());return s.aB(new Float32Array(16),g.projMatrix,y)}function hO(g,o,f){if(o.projection.name===f.projection.name)return g.projMatrix;const y=f.clone();return y.setProjection(o.projection),Ov(y,o.getProjection(),g)}function Qf(g,o,f){return o.name===f.projection.name?g.projMatrix:Ov(f,o,g)}class Mu{constructor(o,f){this.reset(o,f)}reset(o,f){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.aA(o,0,1);let f=1,y=this._distances[f];const w=o*this.paddedLength+this.padding;for(;y<w&&f<this._distances.length;)y=this._distances[++f];const E=f-1,j=this._distances[E],I=y-j,O=I>0?(w-j)/I:0;return this.points[E].mult(1-O).add(this.points[f].mult(O))}}class hg{constructor(o,f,y){const w=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(f/y);for(let j=0;j<this.xCellCount*this.yCellCount;j++)w.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=f,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,f,y,w,E){this._forEachCell(f,y,w,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(E)}insertCircle(o,f,y,w){this._forEachCell(f-w,y-w,f+w,y+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(f),this.circles.push(y),this.circles.push(w)}_insertBoxCell(o,f,y,w,E,j){this.boxCells[E].push(j)}_insertCircleCell(o,f,y,w,E,j){this.circleCells[E].push(j)}_query(o,f,y,w,E,j){if(y<0||o>this.width||w<0||f>this.height)return!E&&[];const I=[];if(o<=0&&f<=0&&this.width<=y&&this.height<=w){if(E)return!0;for(let O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const U=this.circles[3*O],q=this.circles[3*O+1],X=this.circles[3*O+2];I.push({key:this.circleKeys[O],x1:U-X,y1:q-X,x2:U+X,y2:q+X})}return j?I.filter(j):I}return this._forEachCell(o,f,y,w,this._queryCell,I,{hitTest:E,seenUids:{box:{},circle:{}}},j),E?I.length>0:I}_queryCircle(o,f,y,w,E){const j=o-y,I=o+y,O=f-y,U=f+y;if(I<0||j>this.width||U<0||O>this.height)return!w&&[];const q=[];return this._forEachCell(j,O,I,U,this._queryCellCircle,q,{hitTest:w,circle:{x:o,y:f,radius:y},seenUids:{box:{},circle:{}}},E),w?q.length>0:q}query(o,f,y,w,E){return this._query(o,f,y,w,!1,E)}hitTest(o,f,y,w,E){return this._query(o,f,y,w,!0,E)}hitTestCircle(o,f,y,w){return this._queryCircle(o,f,y,!0,w)}_queryCell(o,f,y,w,E,j,I,O){const U=I.seenUids,q=this.boxCells[E];if(q!==null){const Z=this.bboxes;for(const J of q)if(!U.box[J]){U.box[J]=!0;const se=4*J;if(o<=Z[se+2]&&f<=Z[se+3]&&y>=Z[se+0]&&w>=Z[se+1]&&(!O||O(this.boxKeys[J]))){if(I.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[J],x1:Z[se],y1:Z[se+1],x2:Z[se+2],y2:Z[se+3]})}}}const X=this.circleCells[E];if(X!==null){const Z=this.circles;for(const J of X)if(!U.circle[J]){U.circle[J]=!0;const se=3*J;if(this._circleAndRectCollide(Z[se],Z[se+1],Z[se+2],o,f,y,w)&&(!O||O(this.circleKeys[J]))){if(I.hitTest)return j.push(!0),!0;{const re=Z[se],oe=Z[se+1],he=Z[se+2];j.push({key:this.circleKeys[J],x1:re-he,y1:oe-he,x2:re+he,y2:oe+he})}}}}}_queryCellCircle(o,f,y,w,E,j,I,O){const U=I.circle,q=I.seenUids,X=this.boxCells[E];if(X!==null){const J=this.bboxes;for(const se of X)if(!q.box[se]){q.box[se]=!0;const re=4*se;if(this._circleAndRectCollide(U.x,U.y,U.radius,J[re+0],J[re+1],J[re+2],J[re+3])&&(!O||O(this.boxKeys[se])))return j.push(!0),!0}}const Z=this.circleCells[E];if(Z!==null){const J=this.circles;for(const se of Z)if(!q.circle[se]){q.circle[se]=!0;const re=3*se;if(this._circlesCollide(J[re],J[re+1],J[re+2],U.x,U.y,U.radius)&&(!O||O(this.circleKeys[se])))return j.push(!0),!0}}}_forEachCell(o,f,y,w,E,j,I,O){const U=this._convertToXCellCoord(o),q=this._convertToYCellCoord(f),X=this._convertToXCellCoord(y),Z=this._convertToYCellCoord(w);for(let J=U;J<=X;J++)for(let se=q;se<=Z;se++)if(E.call(this,o,f,y,w,this.xCellCount*se+J,j,I,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,f,y,w,E,j){const I=w-o,O=E-f,U=y+j;return U*U>I*I+O*O}_circleAndRectCollide(o,f,y,w,E,j,I){const O=(j-w)/2,U=Math.abs(o-(w+O));if(U>O+y)return!1;const q=(I-E)/2,X=Math.abs(f-(E+q));if(X>q+y)return!1;if(U<=O||X<=q)return!0;const Z=U-O,J=X-q;return Z*Z+J*J<=y*y}}const TE=Math.tan(85*Math.PI/180);function zh(g,o,f,y,w,E,j){const I=s.bC();if(f)if(E.name==="globe"){const O=s.bD(w,o);s.aB(I,I,O)}else{const O=s.bE([],j);I[0]=O[0],I[1]=O[1],I[4]=O[2],I[5]=O[3],y||s.bB(I,I,w.angle)}else s.aB(I,w.labelPlaneMatrix,g);return I}function Du(g,o,f,y,w,E,j){const I=zh(g,o,f,y,w,E,j);return E.name==="globe"&&f||(I[2]=I[6]=I[10]=I[14]=0),I}function To(g,o,f,y,w,E,j){if(f){if(E.name==="globe"){const I=zh(g,o,f,y,w,E,j);return s.bl(I,I),s.aB(I,g,I),I}{const I=s.bz(g),O=s.bA([]);return O[0]=j[0],O[1]=j[1],O[4]=j[2],O[5]=j[3],s.aB(I,I,O),y||s.bB(I,I,-w.angle),I}}return w.glCoordMatrix}function Zl(g,o,f,y){const w=[g,o,f,1];f?s.aC(w,w,y):Mv(w,w,y);const E=w[3];return w[0]/=E,w[1]/=E,w[2]/=E,w}function Rv(g,o){return Math.min(.5+g/o*.5,1.5)}function EE(g,o){const f=g[0]/g[3],y=g[1]/g[3];return f>=-o[0]&&f<=o[0]&&y>=-o[1]&&y<=o[1]}function Dn(g,o,f,y,w,E,j,I,O,U,q=1){const X=f.transform,Z=y?g.textSizeData:g.iconSizeData,J=s.bK(Z,f.transform.zoom,q),se=X.projection.name==="globe",re=[256/f.width*2+1,256/f.height*2+1],oe=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let he=null;se&&(he=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const xe=g.lineVertexArray,_e=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ye=f.transform.width/f.transform.height;let Le,ke=!1;for(let Re=0;Re<_e.length;Re++){const Ae=_e.get(Re),{numGlyphs:Te,writingMode:$e}=Ae;if($e!==s.bL.vertical||ke||Le===s.bL.horizontal||(ke=!0),Le=$e,(Ae.hidden||$e===s.bL.vertical)&&!ke){so(Te,oe);continue}ke=!1;const Ze=new s.P(Ae.tileAnchorX,Ae.tileAnchorY),Ye=g.elevationType==="road",it=!!X.elevation||Ye;let{x:tt,y:vt,z:At}=X.projection.projectTilePoint(Ze.x,Ze.y,U.canonical),et=null;if(it){const sr=Ye?g.getElevationFeatureForText(Re):null;et={getElevation:O,elevation:X.elevation,elevationFeature:sr};const[vr,Cr,Gr]=O(Ze,X.elevation,sr);tt+=vr,vt+=Cr,At+=Gr}const Ue=[tt,vt,At,1];if(s.aC(Ue,Ue,o),!EE(Ue,re)){so(Te,oe);continue}const ft=Ue[3],st=Rv(f.transform.getCameraToCenterDistance(X.projection),ft),It=s.bM(Z,J,Ae),Mt=j?It/st:It*st,Zt=Zl(tt,vt,At,w);if(Zt[3]<=0){so(Te,oe);continue}let Dt={};const $t=s.an(g.layers[0].layout.get("text-max-angle")),lr=Math.cos($t),or=j?null:et,Jt=AE(Ae,Mt,!1,I,o,w,E,g.glyphOffsetArray,xe,oe,he,Zt,Ze,Dt,ye,or,X.projection,U,j,lr);ke=Jt.useVertical,or&&Jt.needsFlipping&&(Dt={}),(Jt.notEnoughRoom||ke||Jt.needsFlipping&&AE(Ae,Mt,!0,I,o,w,E,g.glyphOffsetArray,xe,oe,he,Zt,Ze,Dt,ye,or,X.projection,U,j,lr).notEnoughRoom)&&so(Te,oe)}y?(g.text.dynamicLayoutVertexBuffer.updateData(oe),he&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(he)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),he&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(he))}function zb(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe){const{lineStartIndex:he,glyphStartIndex:xe,segment:_e}=I,ye=xe+I.numGlyphs,Le=he+I.lineLength,ke=o.getoffsetX(xe),Re=o.getoffsetX(ye-1),Ae=Bh(g*ke,f,y,w,E,j,_e,he,Le,O,U,q,X,Z,!0,J,se,re,oe);if(!Ae)return null;const Te=Bh(g*Re,f,y,w,E,j,_e,he,Le,O,U,q,X,Z,!0,J,se,re,oe);return Te?{first:Ae,last:Te}:null}function jE(g,o,f,y){return g===s.bL.horizontal&&Math.abs(y)>Math.abs(f)?{useVertical:!0}:g===s.bL.vertical?y>0?{needsFlipping:!0}:null:o!==0&&function(w,E){return w===0||Math.abs(E/w)>TE}(f,y)?o===1?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function AE(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe,_e){const ye=o/24,Le=g.lineOffsetX*ye,ke=g.lineOffsetY*ye,{lineStartIndex:Re,glyphStartIndex:Ae,numGlyphs:Te,segment:$e,writingMode:Ze,flipState:Ye}=g,it=Re+g.lineLength,tt=vt=>{if(q){const[ft,st,It]=vt.up,Mt=U.length;s.bN(q,Mt+0,ft,st,It),s.bN(q,Mt+1,ft,st,It),s.bN(q,Mt+2,ft,st,It),s.bN(q,Mt+3,ft,st,It)}const[At,et,Ue]=vt.point;s.bO(U,At,et,Ue,vt.angle)};if(Te>1){const vt=zb(ye,I,Le,ke,f,X,Z,g,O,E,J,re,!1,oe,he,xe,_e);if(!vt)return{notEnoughRoom:!0};if(y&&!f){let[At,et,Ue]=vt.first.point,[ft,st,It]=vt.last.point;[At,et]=Zl(At,et,Ue,j),[ft,st]=Zl(ft,st,It,j);const Mt=jE(Ze,Ye,(ft-At)*se,st-et);if(g.flipState=Mt&&Mt.needsFlipping?1:2,Mt)return Mt}tt(vt.first);for(let At=Ae+1;At<Ae+Te-1;At++){const et=Bh(ye*I.getoffsetX(At),Le,ke,f,X,Z,$e,Re,it,O,E,J,re,!1,!1,oe,he,xe,_e);if(!et)return U.length-=4*(At-Ae),{notEnoughRoom:!0};tt(et)}tt(vt.last)}else{if(y&&!f){const At=Zl(Z.x,Z.y,0,w),et=Re+$e+1,Ue=new s.P(O.getx(et),O.gety(et)),ft=Zl(Ue.x,Ue.y,0,w),st=ft[3]>0?ft:Bb(Z,Ue,At,1,w,void 0,oe,he.canonical),It=jE(Ze,Ye,(st[0]-At[0])*se,st[1]-At[1]);if(g.flipState=It&&It.needsFlipping?1:2,It)return It}const vt=Bh(ye*I.getoffsetX(Ae),Le,ke,f,X,Z,$e,Re,it,O,E,J,re,!1,!1,oe,he,xe,_e);if(!vt)return{notEnoughRoom:!0};tt(vt)}return{}}function jr(g,o,f,y,w){const{x:E,y:j,z:I}=y.projectTilePoint(g.x,g.y,o);if(!w)return Zl(E,j,I,f);const[O,U,q]=w.getElevation(g,w.elevation,w.elevationFeature);return Zl(E+O,j+U,I+q,f)}function Bb(g,o,f,y,w,E,j,I){const O=jr(g.sub(o)._unit()._add(g),I,w,j,E);return s.av(O,f,O),s.aw(O,O),s.bH(O,f,O,y)}function Bh(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe){const _e=y?g-o:g+o;let ye=_e>0?1:-1,Le=0;y&&(ye*=-1,Le=Math.PI),ye<0&&(Le+=Math.PI);let ke=I+j+(ye>0?0:1)|0,Re=w,Ae=w,Te=0,$e=0;const Ze=Math.abs(_e),Ye=[],it=[];let tt=E,vt=tt,At=s.bF([]);const et=()=>Bb(vt,tt,Ae,Ze-Te+1,q,Z,re,oe.canonical);for(;Te+$e<=Ze;){if(ke+=ye,ke<I||ke>=O)return null;if(Ae=Re,vt=tt,Ye.push(Ae),J&&it.push(vt),tt=new s.P(U.getx(ke),U.gety(ke)),Re=X[ke],!Re){const or=jr(tt,oe.canonical,q,re,Z);Re=or[3]>0?X[ke]=or:et()}Te+=$e;const $t=s.av([],Re,Ae),lr=s.bG(Ae,Re);if(f&&lr>0&&$e>0&&s.bJ(At,$t)/($e*lr)<xe)return null;$e=lr,At=$t}se&&Z&&(X[ke]&&(Re=et(),$e=s.bG(Ae,Re),At=s.av([],Re,Ae)),X[ke]=Re);const Ue=(Ze-Te)/$e,ft=tt.sub(vt)._mult(Ue)._add(vt),st=s.bH([],Ae,At,Ue);let It=[0,0,1],Mt=At[0],Zt=At[1];if(he&&(It=re.upVector(oe.canonical,ft.x,ft.y),It[0]!==0||It[1]!==0||It[2]!==1)){const $t=[It[2],0,-It[0]],lr=s.bI([],It,$t);s.aw($t,$t),s.aw(lr,lr),Mt=s.bJ(At,$t),Zt=s.bJ(At,lr)}if(f){const $t=s.bI([],It,At);s.aw($t,$t),s.bH(st,st,$t,f*ye)}const Dt=Le+Math.atan2(Zt,Mt);return Ye.push(st),J&&it.push(ft),{point:st,angle:Dt,path:Ye,tilePath:it,up:It}}function so(g,o){const f=o.length,y=f+4*g;o.resize(y),o.float32.fill(-1/0,4*f,4*y)}function Mv(g,o,f){const y=o[0],w=o[1];return g[0]=f[0]*y+f[4]*w+f[12],g[1]=f[1]*y+f[5]*w+f[13],g[3]=f[3]*y+f[7]*w+f[15],g}const Eo=100;class mr{constructor(o,f,y=new hg(o.width+200,o.height+200,25),w=new hg(o.width+200,o.height+200,25)){this.transform=o,this.grid=y,this.ignoredGrid=w,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Eo,this.screenBottomBoundary=o.height+Eo,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=f}placeCollisionBox(o,f,y,w,E,j,I,O,U,q,X){let Z=y.projectedAnchorX,J=y.projectedAnchorY,se=y.projectedAnchorZ;const re=y.tileAnchorX,oe=y.tileAnchorY,he=y.elevation,xe=y.tileID,_e=o.getProjection();if(he&&xe){const[it,tt,vt]=_e.upVector(xe.canonical,y.tileAnchorX,y.tileAnchorY),At=_e.upVectorScale(xe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Z+=it*he*At,J+=tt*he*At,se+=vt*he*At}const ye=o.projection.name==="globe",Le=o.projection.name==="globe"?s.aj(this.transform.zoom):0;if(xe&&ye&&Le<1&&!j){const it=1<<xe.canonical.z,tt=s.bP(re,oe);s.bQ(tt,tt,1/s.al),s.bR(tt,tt,s.bP(xe.canonical.x,xe.canonical.y)),s.bQ(tt,tt,1/it),s.bS(tt,tt,s.bP(w[0],w[1])),tt[0]=s.bT(tt[0],-.5,.5),s.bQ(tt,tt,s.al);const vt=s.bU(tt[0],tt[1],s.al/(2*Math.PI),1);s.aC(vt,vt,E),Z=s.ak(Z,vt[0],Le),J=s.ak(J,vt[1],Le),se=s.ak(se,vt[2],Le)}const ke=this.projectAndGetPerspectiveRatio(q,Z,J,se,y.tileID,_e.name==="globe"||!!he||this.transform.pitch>0,_e),Re=U*ke.perspectiveRatio,Ae=(y.x1*f+I.x-y.padding)*Re+ke.point.x,Te=(y.y1*f+I.y-y.padding)*Re+ke.point.y,$e=(y.x2*f+I.x+y.padding)*Re+ke.point.x,Ze=(y.y2*f+I.y+y.padding)*Re+ke.point.y,Ye=ke.perspectiveRatio<=.55||ke.occluded;return!this.isInsideGrid(Ae,Te,$e,Ze)||!O&&this.grid.hitTest(Ae,Te,$e,Ze,X)||Ye?{box:[],offscreen:!1,occluded:ke.occluded}:{box:[Ae,Te,$e,Ze],offscreen:this.isOffscreen(Ae,Te,$e,Ze),occluded:!1}}placeCollisionCircles(o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe){const he=[],xe=this.transform.elevation,_e=o.getProjection(),ye=o.elevationType==="road",Le=!!xe||ye,ke=s.bV.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,_e),Re=new s.P(y.tileAnchorX,y.tileAnchorY),Ae=new s.P(y.tileAnchorX,y.tileAnchorY);let{x:Te,y:$e,z:Ze}=_e.projectTilePoint(Ae.x,Ae.y,oe.canonical),Ye=null;if(Le){const lr=ye?o.getElevationFeatureForText(w):null;Ye={getElevation:ke,elevation:xe,elevationFeature:lr};const[or,Jt,sr]=ke(Re,xe,lr);Te+=or,$e+=Jt,Ze+=sr}const it=_e.name==="globe",tt=this.projectAndGetPerspectiveRatio(O,Te,$e,Ze,oe,it||!!xe||this.transform.pitch>0,_e),{perspectiveRatio:vt}=tt,At=(Z?I/vt:I*vt)/s.bY,et=Zl(Te,$e,Ze,U),Ue=y.lineOffsetX*At,ft=y.lineOffsetY*At,st=s.an(o.layers[0].layout.get("text-max-angle")),It=Math.cos(st),Mt=tt.signedDistanceFromCamera>0?zb(At,j,Ue,ft,ye&&y.flipState===1,et,Ae,y,E,U,{},Le&&!Z?Ye:null,Z&&Le,_e,oe,Z,It):null;let Zt=!1,Dt=!1,$t=!0;if(Mt&&!tt.occluded){const lr=.5*se*vt+re,or=new s.P(-100,-100),Jt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),sr=new Mu,{first:vr,last:Cr}=Mt,Gr=vr.path.length;let un=[];for(let Br=Gr-1;Br>=1;Br--)un.push(vr.path[Br]);for(let Br=1;Br<Cr.path.length;Br++)un.push(Cr.path[Br]);const Mr=2.5*lr;q&&(un=un.map(([Br,$n,Ln],Un)=>(Le&&!it&&(Ln=ke(Un<Gr-1?vr.tilePath[Gr-1-Un]:Cr.tilePath[Un-Gr+2],xe,Ye.elevationFeature)[2]),Zl(Br,$n,Ln,q))),un.some(Br=>Br[3]<=0)&&(un=[]));let xn=[];if(un.length>0){let Br=1/0,$n=-1/0,Ln=1/0,Un=-1/0;for(const hn of un)Br=Math.min(Br,hn[0]),Ln=Math.min(Ln,hn[1]),$n=Math.max($n,hn[0]),Un=Math.max(Un,hn[1]);$n>=or.x&&Br<=Jt.x&&Un>=or.y&&Ln<=Jt.y&&(xn=[un.map(hn=>new s.P(hn[0],hn[1]))],(Br<or.x||$n>Jt.x||Ln<or.y||Un>Jt.y)&&(xn=s.bW(xn,or.x,or.y,Jt.x,Jt.y)))}for(const Br of xn){sr.reset(Br,.25*lr);let $n=0;$n=sr.length<=.5*lr?1:Math.ceil(sr.paddedLength/Mr)+1;for(let Ln=0;Ln<$n;Ln++){const Un=Ln/Math.max($n-1,1),hn=sr.lerp(Un),Vr=hn.x+Eo,An=hn.y+Eo;he.push(Vr,An,lr,0);const wi=Vr-lr,Si=An-lr,Cn=Vr+lr,an=An+lr;if($t=$t&&this.isOffscreen(wi,Si,Cn,an),Dt=Dt||this.isInsideGrid(wi,Si,Cn,an),!f&&this.grid.hitTestCircle(Vr,An,lr,J)&&(Zt=!0,!X))return{circles:[],offscreen:!1,collisionDetected:Zt,occluded:!1}}}}return{circles:!X&&Zt||!Dt?[]:he,offscreen:$t,collisionDetected:Zt,occluded:tt.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let y=1/0,w=1/0,E=-1/0,j=-1/0;for(const q of o){const X=new s.P(q.x+Eo,q.y+Eo);y=Math.min(y,X.x),w=Math.min(w,X.y),E=Math.max(E,X.x),j=Math.max(j,X.y),f.push(X)}const I=this.grid.query(y,w,E,j).concat(this.ignoredGrid.query(y,w,E,j)),O={},U={};for(const q of I){const X=q.key;if(O[X.bucketInstanceId]===void 0&&(O[X.bucketInstanceId]={}),O[X.bucketInstanceId][X.featureIndex])continue;const Z=[new s.P(q.x1,q.y1),new s.P(q.x2,q.y1),new s.P(q.x2,q.y2),new s.P(q.x1,q.y2)];s.bX(f,Z)&&(O[X.bucketInstanceId][X.featureIndex]=!0,U[X.bucketInstanceId]===void 0&&(U[X.bucketInstanceId]=[]),U[X.bucketInstanceId].push(X.featureIndex))}return U}insertCollisionBox(o,f,y,w,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:E},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,f,y,w,E){const j=f?this.ignoredGrid:this.grid,I={bucketInstanceId:y,featureIndex:w,collisionGroupID:E};for(let O=0;O<o.length;O+=4)j.insertCircle(I,o[O],o[O+1],o[O+2])}projectAndGetPerspectiveRatio(o,f,y,w,E,j,I){const O=[f,y,w,1];let U=!1;w||this.transform.pitch>0?(s.aC(O,O,o),this.fogState&&E&&I.name!=="globe"&&(U=function(Z,J,se,re,oe,he){const xe=he.calculateFogTileMatrix(oe),_e=[J,se,re];return s.af(_e,_e,xe),_r(Z,s.ag(_e),he.pitch,he._fov)}(this.fogState,f,y,w,E.toUnwrapped(),this.transform)>.9)):Mv(O,O,o);const q=O[3];return{point:new s.P((O[0]/q+1)/2*this.transform.width+Eo,(-O[1]/q+1)/2*this.transform.height+Eo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/q*.5,1.5),signedDistanceFromCamera:q,occluded:j&&O[2]>q||U}}isOffscreen(o,f,y,w){return y<Eo||o>=this.screenRightBoundary||w<Eo||f>this.screenBottomBoundary}isInsideGrid(o,f,y,w){return y>=0&&o<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const o=s.bA([]);return s.br(o,o,[-100,-100,0]),o}}class Rn{constructor(o,f,y,w){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?f:-f))):w&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Tn{constructor(o,f,y,w,E,j=!1){this.text=new Rn(o?o.text:null,f,y,E),this.icon=new Rn(o?o.icon:null,f,w,E),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(o,f,y,w=!1){this.text=o,this.icon=f,this.skipFade=y,this.clipped=w}}class ep{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Bn{constructor(o,f,y,w,E){this.bucketInstanceId=o,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=w,this.tileID=E}}class Dv{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const f=++this.maxGroupID;this.collisionGroups[o]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[o]}}function tp(g,o,f,y,w){const{horizontalAlign:E,verticalAlign:j}=s.c1(g),I=-(E-.5)*o,O=-(j-.5)*f,U=s.c2(g,y);return new s.P(I+U[0]*w,O+U[1]*w)}function $h(g,o,f,y,w){const E=new s.P(g,o);return f&&E._rotate(y?w:-w),E}class Va{constructor(o,f,y,w,E,j){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new mr(this.transform,E),this.buildingIndex=j,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Dv(y),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,f,y,w,E=1){const j=y.getBucket(f),I=y.latestFeatureIndex;if(!j||!I||f.fqid!==j.layerIds[0])return;const O=j.layers[0].layout,U=j.layers[0].paint,q=y.collisionBoxArray,X=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Z=y.tileSize/s.al,J=y.tileID.toUnwrapped();this.transform.setProjection(j.projection);const se=(re=y.tileID,oe=j.getProjection(),he=this.transform,oe.name===this.projection?he.calculateProjMatrix(re.toUnwrapped()):Ov(he,oe,re));var re,oe,he;const xe=O.get("text-pitch-alignment")==="map",_e=O.get("text-rotation-alignment")==="map";f.compileFilter(f.options);const ye=f.dynamicFilter(),Le=f.dynamicFilterNeedsFeature(),ke=this.transform.calculatePixelsToTileUnitsMatrix(y),Re=Du(se,y.tileID.canonical,xe,_e,this.transform,j.getProjection(),ke);let Ae=null;const Te=j.getProjection().createInversionMatrix(this.transform,y.tileID.canonical);if(xe){const Ue=To(se,y.tileID.canonical,xe,_e,this.transform,j.getProjection(),ke);Ae=s.aB([],this.transform.labelPlaneMatrix,Ue)}let $e=null;ye&&y.latestFeatureIndex&&($e={unwrappedTileID:J,dynamicFilter:ye,dynamicFilterNeedsFeature:Le}),this.retainedQueryData[j.bucketInstanceId]=new Bn(j.bucketInstanceId,I,j.sourceLayerIndex,j.index,y.tileID);const[Ze,Ye]=j.layers[0].layout.get("text-size-scale-range"),it=s.aA(E,Ze,Ye),[tt,vt]=O.get("icon-size-scale-range"),At=s.aA(E,tt,vt),et={bucket:j,layout:O,paint:U,posMatrix:se,invMatrix:Te,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:$e,scale:X,textPixelRatio:Z,holdingForFade:y.holdingForFade(),collisionBoxArray:q,partiallyEvaluatedTextSize:s.bK(j.textSizeData,this.transform.zoom,it),partiallyEvaluatedIconSize:s.bK(j.iconSizeData,this.transform.zoom,At),collisionGroup:this.collisionGroups.get(j.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(w)for(const Ue of j.sortKeyRanges){const{sortKey:ft,symbolInstanceStart:st,symbolInstanceEnd:It}=Ue;o.push({sortKey:ft,symbolInstanceStart:st,symbolInstanceEnd:It,parameters:et})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:j.symbolInstances.length,parameters:et})}attemptAnchorPlacement(o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe,_e,ye,Le){const{textOffset0:ke,textOffset1:Re,crossTileID:Ae}=re,Te=[ke,Re],$e=tp(o,j,I,Te,O),Ze=this.collisionIndex.placeCollisionBox(he,O,f,y,w,E,$h($e.x,$e.y,U,q,this.transform.angle),se,X,Z,J.predicate);if(_e){const Ye=he.getSymbolInstanceIconSize(Le,this.transform.zoom,re.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(he,Ye,_e,y,w,E,$h($e.x,$e.y,U,q,this.transform.angle),se,X,Z,J.predicate).box.length===0)return}if(Ze.box.length>0){let Ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Ye=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Te,width:j,height:I,anchor:o,textScale:O,prevAnchor:Ye},this.markUsedJustification(he,o,re,xe),he.allowVerticalPlacement&&(this.markUsedOrientation(he,xe,re),this.placedOrientations[Ae]=xe),{shift:$e,placedGlyphBoxes:Ze}}}placeLayerBucketPart(o,f,y,w,E=1){const{bucket:j,layout:I,paint:O,posMatrix:U,textLabelPlaneMatrix:q,labelToScreenMatrix:X,clippingData:Z,textPixelRatio:J,mercatorCenter:se,invMatrix:re,holdingForFade:oe,collisionBoxArray:he,partiallyEvaluatedTextSize:xe,partiallyEvaluatedIconSize:_e,collisionGroup:ye,latestFeatureIndex:Le}=o.parameters,ke=I.get("text-optional"),Re=I.get("icon-optional"),Ae=I.get("text-allow-overlap"),Te=I.get("icon-allow-overlap"),$e=I.get("text-rotation-alignment")==="map",Ze=I.get("icon-rotation-alignment")==="map",Ye=I.get("text-pitch-alignment")==="map",it=O.get("symbol-z-offset"),tt=I.get("symbol-elevation-reference")==="sea",vt=I.get("symbol-placement"),[At,et]=I.get("text-size-scale-range"),[Ue,ft]=I.get("icon-size-scale-range"),st=s.aA(E,At,et),It=s.aA(E,Ue,ft),Mt=I.get("text-variable-anchor"),Zt=$e&&vt!=="point",Dt=Ze&&vt!=="point",$t=Mt&&j.hasTextData(),lr=j.hasIconTextFit()&&$t&&j.hasIconData();this.transform.setProjection(j.projection);const or=$t||Zt,Jt=Dt||lr;let sr=Ae&&(Te||!j.hasIconData()||Re),vr=Te&&(Ae||!j.hasTextData()||ke);const Cr=!it.isConstant();!j.collisionArrays&&he&&j.deserializeCollisionBoxes(he),y&&w&&j.updateCollisionDebugBuffers(this.transform.zoom,he,st,It);const Gr=(Mr,xn,Br)=>{const{crossTileID:$n,numVerticalGlyphVertices:Ln}=Mr;let Un=null;if(Z&&Z.dynamicFilterNeedsFeature||Cr){const ji=this.retainedQueryData[j.bucketInstanceId];Un=Le.loadFeature({featureIndex:Mr.featureIndex,bucketIndex:ji.bucketIndex,sourceLayerIndex:ji.sourceLayerIndex,layoutVertexArrayOffset:0});const ts=Un.properties?Un.properties.worldview:null;if(j.localizable&&j.worldview&&typeof ts=="string")if(ts==="all")Un.properties.$localized=!0;else{if(!ts.split(",").includes(j.worldview))return;Un.properties.$localized=!0,Un.properties.worldview=j.worldview}}if(Z&&!(0,Z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:j.worldview},Un,this.retainedQueryData[j.bucketInstanceId].tileID.canonical,new s.P(Mr.tileAnchorX,Mr.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[$n]=new ao(!1,!1,!1,!0),void f.add($n);const hn=it.evaluate(Un,{});if(f.has($n))return;if(oe)return void(this.placements[$n]=new ao(!1,!1,!1));let Vr=!1,An=!1,wi=!0,Si=!1,Cn=!1,an=null,Ur={box:null,offscreen:null,occluded:null},si={box:null},Di=null,ci=null,fi=null,uo=0,No=0,Hs=0;Br.textFeatureIndex?uo=Br.textFeatureIndex:Mr.useRuntimeCollisionCircles&&(uo=Mr.featureIndex),Br.verticalTextFeatureIndex&&(No=Br.verticalTextFeatureIndex);const Pn=j.elevationFeatures?j.elevationFeatures[Mr.elevationFeatureIndex]:void 0,Zo=ji=>{ji.tileID=this.retainedQueryData[j.bucketInstanceId].tileID;const ts=this.transform.elevation;ji.elevation=tt?hn:hn+s.bV.getAtTileOffset(ji.tileID,new s.P(ji.tileAnchorX,ji.tileAnchorY),ts,Pn),ji.elevation+=Mr.zOffset},va=Br.textBox;if(va){Zo(va);const ji=ui=>{let ms=s.bL.horizontal;if(j.allowVerticalPlacement&&!ui&&this.prevPlacement){const ja=this.prevPlacement.placedOrientations[$n];ja&&(this.placedOrientations[$n]=ja,ms=ja,this.markUsedOrientation(j,ms,Mr))}return ms},ts=(ui,ms)=>{if(j.allowVerticalPlacement&&Ln>0&&Br.verticalTextBox){for(const ja of j.writingModes)if(ja===s.bL.vertical?(Ur=ms(),si=Ur):Ur=ui(),Ur&&Ur.box&&Ur.box.length)break}else Ur=ui()};if(Mt){let ui=Mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$n]){const Zi=this.prevPlacement.variableOffsets[$n];ui.indexOf(Zi.anchor)>0&&(ui=ui.filter(Xo=>Xo!==Zi.anchor),ui.unshift(Zi.anchor))}const ms=(Zi,Xo,Wg)=>{const nu=j.getSymbolInstanceTextSize(xe,Mr,this.transform.zoom,xn),Ep=(Zi.x2-Zi.x1)*nu+2*Zi.padding,jp=(Zi.y2-Zi.y1)*nu+2*Zi.padding,Ko=Mr.hasIconTextFit&&!Te?Xo:null;Ko&&Zo(Ko);let iu={box:[],offscreen:!1,occluded:!1};const su=Ae?2*ui.length:ui.length;for(let Tl=0;Tl<su;++Tl){const Uu=this.attemptAnchorPlacement(ui[Tl%ui.length],Zi,se,re,or,Ep,jp,nu,$e,Ye,J,U,ye,Tl>=ui.length,Mr,xn,j,Wg,Ko,xe,_e);if(Uu&&(iu=Uu.placedGlyphBoxes,iu&&iu.box&&iu.box.length)){Vr=!0,an=Uu.shift;break}}return iu};ts(()=>ms(va,Br.iconBox,s.bL.horizontal),()=>{const Zi=Br.verticalTextBox;return Zi&&Zo(Zi),j.allowVerticalPlacement&&!(Ur&&Ur.box&&Ur.box.length)&&Ln>0&&Zi?ms(Zi,Br.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Ur&&(Vr=Ur.box,wi=Ur.offscreen,Si=Ur.occluded);const ja=ji(!(!Ur||!Ur.box));if(!Vr&&this.prevPlacement){const Zi=this.prevPlacement.variableOffsets[$n];Zi&&(this.variableOffsets[$n]=Zi,this.markUsedJustification(j,Zi.anchor,Mr,ja))}}else{const ui=(ms,ja)=>{const Zi=j.getSymbolInstanceTextSize(xe,Mr,this.transform.zoom,xn),Xo=this.collisionIndex.placeCollisionBox(j,Zi,ms,se,re,or,new s.P(0,0),Ae,J,U,ye.predicate);return Xo&&Xo.box&&Xo.box.length&&(this.markUsedOrientation(j,ja,Mr),this.placedOrientations[$n]=ja),Xo};ts(()=>ui(va,s.bL.horizontal),()=>{const ms=Br.verticalTextBox;return j.allowVerticalPlacement&&Ln>0&&ms?(Zo(ms),ui(ms,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),ji(!!(Ur&&Ur.box&&Ur.box.length))}}if(Di=Ur,Vr=Di&&Di.box&&Di.box.length>0,wi=Di&&Di.offscreen,Si=Di&&Di.occluded,Mr.useRuntimeCollisionCircles){const ji=Mr.centerJustifiedTextSymbolIndex>=0?Mr.centerJustifiedTextSymbolIndex:Mr.verticalPlacedTextSymbolIndex,ts=j.text.placedSymbolArray.get(ji),ui=s.bM(j.textSizeData,xe,ts),ms=I.get("text-padding");ci=this.collisionIndex.placeCollisionCircles(j,Ae,ts,ji,j.lineVertexArray,j.glyphOffsetArray,ui,U,q,X,y,Ye,ye.predicate,Mr.collisionCircleDiameter*ui/s.bY,ms,this.retainedQueryData[j.bucketInstanceId].tileID),Vr=Ae||ci.circles.length>0&&!ci.collisionDetected,wi=wi&&ci.offscreen,Si=ci.occluded}if(Br.iconFeatureIndex&&(Hs=Br.iconFeatureIndex),Br.iconBox){const ji=ts=>{Zo(ts);const ui=Mr.hasIconTextFit&&an?$h(an.x,an.y,$e,Ye,this.transform.angle):new s.P(0,0),ms=j.getSymbolInstanceIconSize(_e,this.transform.zoom,Mr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(j,ms,ts,se,re,Jt,ui,Te,J,U,ye.predicate)};si&&si.box&&si.box.length&&Br.verticalIconBox?(fi=ji(Br.verticalIconBox),An=fi.box.length>0):(fi=ji(Br.iconBox),An=fi.box.length>0),wi=wi&&fi.offscreen,Cn=fi.occluded}const Io=ke||Mr.numHorizontalGlyphVertices===0&&Ln===0,Jl=Re||Mr.numIconVertices===0;if(Io||Jl?Jl?Io||(An=An&&Vr):Vr=An&&Vr:An=Vr=An&&Vr,Vr&&Di&&Di.box&&this.collisionIndex.insertCollisionBox(Di.box,I.get("text-ignore-placement"),j.bucketInstanceId,si&&si.box&&No?No:uo,ye.ID),An&&fi&&this.collisionIndex.insertCollisionBox(fi.box,I.get("icon-ignore-placement"),j.bucketInstanceId,Hs,ye.ID),ci&&(Vr&&this.collisionIndex.insertCollisionCircles(ci.circles,I.get("text-ignore-placement"),j.bucketInstanceId,uo,ye.ID),y)){const ji=j.bucketInstanceId;let ts=this.collisionCircleArrays[ji];ts===void 0&&(ts=this.collisionCircleArrays[ji]=new ep);for(let ui=0;ui<ci.circles.length;ui+=4)ts.circles.push(ci.circles[ui+0]),ts.circles.push(ci.circles[ui+1]),ts.circles.push(ci.circles[ui+2]),ts.circles.push(ci.collisionDetected?1:0)}const ho=j.projection.name!=="globe";sr=sr&&(ho||!Si),vr=vr&&(ho||!Cn),this.placements[$n]=new ao(Vr||sr,An||vr,wi||j.justReloaded),f.add($n)},un=this.retainedQueryData[j.bucketInstanceId].tileID;if(j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,un),j.elevationType==="road"&&j.updateRoadElevation(un.canonical),j.updateZOffset(),j.sortFeaturesByY){const Mr=j.getSortedSymbolIndexes(this.transform.angle);for(let xn=Mr.length-1;xn>=0;--xn){const Br=Mr[xn];Gr(j.symbolInstances.get(Br),Br,j.collisionArrays[Br])}j.hasAnyZOffset&&s.w(`${j.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(j.hasAnyZOffset){const Mr=j.getSortedIndexesByZOffset();for(let xn=0;xn<Mr.length;++xn){const Br=Mr[xn];Gr(j.symbolInstances.get(Br),Br,j.collisionArrays[Br])}}else for(let Mr=o.symbolInstanceStart;Mr<o.symbolInstanceEnd;Mr++)Gr(j.symbolInstances.get(Mr),Mr,j.collisionArrays[Mr]);if(y&&j.bucketInstanceId in this.collisionCircleArrays){const Mr=this.collisionCircleArrays[j.bucketInstanceId];s.bl(Mr.invProjMatrix,U),Mr.viewportMatrix=this.collisionIndex.getViewportMatrix()}j.justReloaded=!1}markUsedJustification(o,f,y,w){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:O,crossTileID:U}=y,q=s.c3(f),X=w===s.bL.vertical?O:q==="left"?E:q==="center"?j:q==="right"?I:-1;E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=X>=0&&E!==X?0:U),j>=0&&(o.text.placedSymbolArray.get(j).crossTileID=X>=0&&j!==X?0:U),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=X>=0&&I!==X?0:U),O>=0&&(o.text.placedSymbolArray.get(O).crossTileID=X>=0&&O!==X?0:U)}markUsedOrientation(o,f,y){const w=f===s.bL.horizontal||f===s.bL.horizontalOnly?f:0,E=f===s.bL.vertical?f:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:U}=y,q=o.text.placedSymbolArray;j>=0&&(q.get(j).placedOrientation=w),I>=0&&(q.get(I).placedOrientation=w),O>=0&&(q.get(O).placedOrientation=w),U>=0&&(q.get(U).placedOrientation=E)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(o):1,E=f?f.opacities:{},j=f?f.variableOffsets:{},I=f?f.placedOrientations:{};for(const O in this.placements){const U=this.placements[O],q=E[O];q?(this.opacities[O]=new Tn(q,w,U.text,U.icon,null,U.clipped),y=y||U.text!==q.text.placed||U.icon!==q.icon.placed):(this.opacities[O]=new Tn(null,w,U.text,U.icon,U.skipFade,U.clipped),y=y||U.text||U.icon)}for(const O in E){const U=E[O];if(!this.opacities[O]){const q=new Tn(U,w,!1,!1);q.isHidden()||(this.opacities[O]=q,y=y||U.text.placed||U.icon.placed)}}for(const O in j)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=j[O]);for(const O in I)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=I[O]);y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:o)}updateLayerOpacities(o,f,y,w){w&&(this.lastReplacementSourceUpdateTime=w.updateTime);const E=new Set;for(const j of f){const I=j.getBucket(o);I&&j.latestFeatureIndex&&o.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,E,j,j.collisionBoxArray,y,w,j.tileID,o.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,j.tileID),I.elevationType==="road"&&I.updateRoadElevation(j.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(o,f,y,w,E,j,I,O){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const U=o.layers[0].layout,q=o.layers[0].paint,X=!!o.layers[0].dynamicFilter(),Z=new Tn(null,0,!1,!1,!0),J=U.get("text-allow-overlap"),se=U.get("icon-allow-overlap"),re=U.get("text-variable-anchor"),oe=U.get("text-rotation-alignment")==="map",he=U.get("text-pitch-alignment")==="map",xe=q.get("symbol-z-offset"),_e=U.get("symbol-elevation-reference")==="sea",ye=!xe.isConstant(),Le=new Tn(null,0,J&&(se||!o.hasIconData()||U.get("icon-optional")),se&&(J||!o.hasTextData()||U.get("text-optional")),!0);!o.collisionArrays&&w&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(w);const ke=(Ae,Te,$e)=>{for(let Ze=0;Ze<Te/4;Ze++)Ae.opacityVertexArray.emplaceBack($e)};let Re=0;j&&o.updateReplacement(I,j);for(let Ae=0;Ae<o.symbolInstances.length;Ae++){const Te=o.symbolInstances.get(Ae),{numHorizontalGlyphVertices:$e,numVerticalGlyphVertices:Ze,crossTileID:Ye,numIconVertices:it,tileAnchorX:tt,tileAnchorY:vt}=Te;let At=null;const et=this.retainedQueryData[o.bucketInstanceId];ye&&Te&&et&&(At=y.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:et.bucketIndex,sourceLayerIndex:et.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=xe.evaluate(At,{}),ft=f.has(Ye);let st=this.opacities[Ye];ft?st=Z:st||(st=Le,this.opacities[Ye]=st),f.add(Ye);const It=$e>0||Ze>0,Mt=it>0,Zt=this.placedOrientations[Ye],Dt=Zt===s.bL.vertical,$t=Zt===s.bL.horizontal||Zt===s.bL.horizontalOnly;!It&&!Mt||st.isHidden()||Re++;let lr=!1;if((It||Mt)&&j)for(const or of o.activeReplacements){if(s.bZ(or,E,s.b_.Symbol,O)||or.min.x>tt||tt>or.max.x||or.min.y>vt||vt>or.max.y)continue;const Jt=s.b$(tt,vt,I.canonical,or.footprintTileId.canonical);if(lr=s.c0(Jt,or.footprint),lr)break}if(It){const or=lr?jo:Ua(st.text);ke(o.text,$e,Dt?jo:or),ke(o.text,Ze,$t?jo:or);const Jt=st.text.isHidden(),{leftJustifiedTextSymbolIndex:sr,centerJustifiedTextSymbolIndex:vr,rightJustifiedTextSymbolIndex:Cr,verticalPlacedTextSymbolIndex:Gr}=Te,un=o.text.placedSymbolArray,Mr=Jt||Dt?1:0;sr>=0&&(un.get(sr).hidden=Mr),vr>=0&&(un.get(vr).hidden=Mr),Cr>=0&&(un.get(Cr).hidden=Mr),Gr>=0&&(un.get(Gr).hidden=Jt||$t?1:0);const xn=this.variableOffsets[Ye];xn&&this.markUsedJustification(o,xn.anchor,Te,Zt);const Br=this.placedOrientations[Ye];Br&&(this.markUsedJustification(o,"left",Te,Br),this.markUsedOrientation(o,Br,Te))}if(Mt){const or=lr?jo:Ua(st.icon),{placedIconSymbolIndex:Jt,verticalPlacedIconSymbolIndex:sr}=Te,vr=o.icon.placedSymbolArray,Cr=st.icon.isHidden()?1:0;Jt>=0&&(ke(o.icon,it,Dt?jo:or),vr.get(Jt).hidden=Cr),sr>=0&&(ke(o.icon,Te.numVerticalIconVertices,$t?jo:or),vr.get(sr).hidden=Cr)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const or=o.collisionArrays[Ae];if(or){let Jt=new s.P(0,0),sr=!0;if(or.textBox||or.verticalTextBox){if(re){const Cr=this.variableOffsets[Ye];Cr?(Jt=tp(Cr.anchor,Cr.width,Cr.height,Cr.textOffset,Cr.textScale),oe&&Jt._rotate(he?this.transform.angle:-this.transform.angle)):sr=!1}X&&(sr=!st.clipped),or.textBox&&as(o.textCollisionBox.collisionVertexArray,st.text.placed,!sr||Dt,Ue,_e,Jt.x,Jt.y),or.verticalTextBox&&as(o.textCollisionBox.collisionVertexArray,st.text.placed,!sr||$t,Ue,_e,Jt.x,Jt.y)}const vr=sr&&!!(!$t&&or.verticalIconBox);or.iconBox&&as(o.iconCollisionBox.collisionVertexArray,st.icon.placed,vr,Ue,_e,Te.hasIconTextFit?Jt.x:0,Te.hasIconTextFit?Jt.y:0),or.verticalIconBox&&as(o.iconCollisionBox.collisionVertexArray,st.icon.placed,!vr,Ue,_e,Te.hasIconTextFit?Jt.x:0,Te.hasIconTextFit?Jt.y:0)}}}if(o.fullyClipped=Re===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Ae.invProjMatrix,o.placementViewportMatrix=Ae.viewportMatrix,o.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,f){const y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>o}isStale(){return this.stale}setStale(){this.stale=!0}}function as(g,o,f,y,w,E,j){g.emplaceBack(o?1:0,f?1:0,E||0,j||0,y,w?1:0),g.emplaceBack(o?1:0,f?1:0,E||0,j||0,y,w?1:0),g.emplaceBack(o?1:0,f?1:0,E||0,j||0,y,w?1:0),g.emplaceBack(o?1:0,f?1:0,E||0,j||0,y,w?1:0)}const fO=Math.pow(2,25),fg=Math.pow(2,24),$b=Math.pow(2,17),pg=Math.pow(2,16),Lv=Math.pow(2,9),Vb=Math.pow(2,8),Fv=Math.pow(2,1);function Ua(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,f=Math.floor(127*g.opacity);return f*fO+o*fg+f*$b+o*pg+f*Lv+o*Vb+f*Fv+o}const jo=0;class Ao{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,f,y,w,E,j){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(f.getBucketParts(I,w,o[this._currentTileIndex],this._sortAcrossTiles,j),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((O,U)=>O.sortKey-U.sortKey));this._currentPartIndex<I.length;){const O=I[this._currentPartIndex];if(f.placeLayerBucketPart(O,this._seenCrossTileIDs,y,O.symbolInstanceStart===0,j),this._currentPartIndex++,E())return!0}return!1}}class Ub{startNewPlacement(o,f,y,w,E,j,I,O){return this.placement=new Va(o,w,E,j,I,O),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=y,this._fadeDuration=w,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(o,f,y,w,E){const j=s.o.now(),I=()=>{const O=s.o.now()-j;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&O>2};for(;this._currentPlacementIndex>=0;){const O=f[o[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&O.visibility!=="none"&&(!O.minzoom||O.minzoom<=U)&&(!O.maxzoom||O.maxzoom>U)){const q=O,X=q.layout.get("symbol-z-elevate"),Z=q.layout.get("symbol-sort-key").constantOr(1)!==void 0,J=q.layout.get("symbol-z-order"),se=J==="viewport-y"||J==="auto"&&!(J!=="viewport-y"&&Z),re=q.layout.get("text-allow-overlap")||q.layout.get("icon-allow-overlap")||q.layout.get("text-ignore-placement")||q.layout.get("icon-ignore-placement"),oe=se&&re,he=this._inProgressLayer=this._inProgressLayer||new Ao(q),xe=s.B(O.source,O.scope);if(he.continuePlacement(X||oe?w[xe]:y[xe],this.placement,this._showCollisionBoxes,O,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const kd=512/s.al/2;class Vs{constructor(o,f,y){this.tileID=o,this.bucketInstanceId=y,this.index=new s.c4(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=o.canonical.x*s.al,E=o.canonical.y*s.al;for(let j=0;j<f.length;j++){const{key:I,crossTileID:O,tileAnchorX:U,tileAnchorY:q}=f.get(j),X=Math.floor((w+U)*kd),Z=Math.floor((E+q)*kd);this.index.add(X,Z),this.keys.push(I),this.crossTileIDs.push(O)}this.index.finish()}findMatches(o,f,y){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=kd/Math.pow(2,f.canonical.z-this.tileID.canonical.z),j=f.canonical.x*s.al,I=f.canonical.y*s.al;for(let O=0;O<o.length;O++){const U=o.get(O);if(U.crossTileID)continue;const{key:q,tileAnchorX:X,tileAnchorY:Z}=U,J=Math.floor((j+X)*E),se=Math.floor((I+Z)*E),re=this.index.range(J-w,se-w,J+w,se+w).sort((oe,he)=>oe-he);for(const oe of re){const he=this.crossTileIDs[oe];if(this.keys[oe]===q&&!y.has(he)){y.add(he),U.crossTileID=he;break}}}}}class Xc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const f=Math.round((o-this.lng)/360);if(f!==0)for(const y in this.indexes){const w=this.indexes[y],E={};for(const j in w){const I=w[j];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+f),E[I.tileID.key]=I}this.indexes[y]=E}this.lng=o}addBucket(o,f,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let E=0;E<f.symbolInstances.length;E++)f.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const w=this.usedCrossTileIDs[o.overscaledZ];for(const E in this.indexes){const j=this.indexes[E];if(Number(E)>o.overscaledZ)for(const I in j){const O=j[I];O.tileID.isChildOf(o)&&O.findMatches(f.symbolInstances,o,w)}else{const I=j[o.scaledTo(Number(E)).key];I&&I.findMatches(f.symbolInstances,o,w)}}for(let E=0;E<f.symbolInstances.length;E++){const j=f.symbolInstances.get(E);j.crossTileID||(j.crossTileID=y.generate(),w.add(j.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Vs(o,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(o,f){for(const y of f.crossTileIDs)this.usedCrossTileIDs[o].delete(y)}removeStaleBuckets(o){let f=!1;for(const y in this.indexes){const w=this.indexes[y];for(const E in w)o[w[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,w[E]),delete w[E],f=!0)}return f}}class Cs{constructor(){this.layerIndexes={},this.crossTileIDs=new Xc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,f,y,w){let E=this.layerIndexes[o.fqid];E===void 0&&(E=this.layerIndexes[o.fqid]=new Lu);let j=!1;const I={};w.name!=="globe"&&E.handleWrapJump(y);for(const O of f){const U=O.getBucket(o);U&&o.fqid===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(O.tileID,U,this.crossTileIDs)&&(j=!0),I[U.bucketInstanceId]=!0)}return E.removeStaleBuckets(I)&&(j=!0),j}pruneUnusedLayers(o){const f={};o.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const Od=771;class Lr{constructor(o,f,y,w){this.blendFunction=o,this.blendColor=f.toNonPremultipliedRenderColor(null),this.mask=y,this.blendEquation=w}}Lr.Replace=[1,0,1,0],Lr.disabled=new Lr(Lr.Replace,s.ao.transparent,[!1,!1,!1,!1]),Lr.unblended=new Lr(Lr.Replace,s.ao.transparent,[!0,!0,!0,!0]),Lr.alphaBlended=new Lr([1,Od,1,Od],s.ao.transparent,[!0,!0,!0,!0]),Lr.alphaBlendedNonPremultiplied=new Lr([770,Od,770,Od],s.ao.transparent,[!0,!0,!0,!0]),Lr.multiply=new Lr([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Lr.additive=new Lr([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class dr{constructor(o,f,y){this.func=o,this.mask=f,this.range=y}}dr.ReadOnly=!1,dr.ReadWrite=!0,dr.disabled=new dr(519,dr.ReadOnly,[0,1]);const rp=7680;class Ir{constructor(o,f,y,w,E,j){this.test=o,this.ref=f,this.mask=y,this.fail=w,this.depthFail=E,this.pass=j}}Ir.disabled=new Ir({func:519,mask:0},0,0,rp,rp,rp);const zv=1029,mg=2305;class Ar{constructor(o,f,y){this.enable=o,this.mode=f,this.frontFace=y}}function qb(g,o){const f=s.ca(g,3);s.cc(g,o),s.cg(g,3,f)}function Gb(g,o){const f=s.c7([]);return s.c8(f,f,-o),s.c9(f,f,-g),f}function Kc(g,o){const f=[g[0],g[1],0],y=[o[0],o[1],0];if(s.ag(f)>=1e-15){const j=s.aw([],f);s.c5(y,j,s.bJ(y,j)),o[0]=y[0],o[1]=y[1]}const w=s.bI([],o,g);if(s.c6(w)<1e-15)return null;const E=Math.atan2(-w[1],w[0]);return Gb(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}Ar.disabled=new Ar(!1,zv,mg),Ar.backCCW=new Ar(!0,zv,mg),Ar.backCW=new Ar(!0,zv,2304),Ar.frontCW=new Ar(!0,1028,2304),Ar.frontCCW=new Ar(!0,1028,mg);class CE{constructor(o,f){this.position=o,this.orientation=f}get position(){return this._position}set position(o){if(o){const f=o instanceof s.ae?o:new s.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(f.x=s.bT(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(o,f,y){if(this.orientation=null,!this.position)return;const w=this.position,E=y||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(o)):0),j=s.ae.fromLngLat(o,E),I=[j.x-w.x,j.y-w.y,j.z-w.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Kc(I,f)}setPitchBearing(o,f){this.orientation=Gb(s.an(o),s.an(-f))}}class np{constructor(o,f){this._transform=s.bA([]),this.orientation=f,this.position=o}get mercatorPosition(){const o=this.position;return new s.ae(o[0],o[1],o[2])}get position(){const o=s.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var f;o&&s.cg(this._transform,3,[(f=o)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.c7([]),o&&qb(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,f){this._orientation=Gb(o,f),qb(this._transform,this._orientation)}forward(){const o=s.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,f){const y=new Float64Array(16);return s.bl(y,this.getWorldToCamera(o,f)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,f,y){const w=this.position;s.c5(w,w,-o);const E=new Float64Array(16);return s.bq(E,[y,y,y]),s.br(E,E,w),E[10]*=f,E}getWorldToCamera(o,f){const y=new Float64Array(16),w=new Float64Array(4),E=this.position;return s.cb(w,this._orientation),s.c5(E,E,-o),s.cc(y,w),s.br(y,y,E),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=f,y[9]*=f,y[10]*=f,y[11]*=f,y}getCameraToClipPerspective(o,f,y,w){const E=new Float64Array(16);return s.cd(E,o,f,y,w),E}getCameraToClipOrthographic(o,f,y,w,E,j){const I=new Float64Array(16);return s.ce(I,o,f,y,w,E,j),I}getDistanceToElevation(o,f=!1){const y=o===0?0:s.cf(o,f?s.a$(this.position[1]):this.position[1]),w=this.forward();return(y-this.position[2])/w[2]}clone(){return new np([...this.position],[...this.orientation])}}const Co=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o});class Wb{constructor(o=0,f=0,y=0,w=0){if(isNaN(o)||o<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=f,this.left=y,this.right=w}interpolate(o,f,y){return f.top!=null&&o.top!=null&&(this.top=s.ak(o.top,f.top,y)),f.bottom!=null&&o.bottom!=null&&(this.bottom=s.ak(o.bottom,f.bottom,y)),f.left!=null&&o.left!=null&&(this.left=s.ak(o.left,f.left,y)),f.right!=null&&o.right!=null&&(this.right=s.ak(o.right,f.right,y)),this}getCenter(o,f){const y=s.aA((this.left+o-this.right)/2,0,o),w=s.aA((this.top+f-this.bottom)/2,0,f);return new s.P(y,w)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Wb(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Yc=15;class Bv{constructor(o,f,y,w,E,j,I){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=o||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=w??60,this.setProjection(j),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wb,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new np,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Bv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Yc}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,f=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(o||y)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const y=this.getProjection(),w=!s.by(f,y);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const f=o!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const f=-o*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const f=s.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const f=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let w=0,E=0;for(let j=0;j<f.length;j++){const I=new s.P(f[j][0]*this.width,y+f[j][1]*(this.height-y)),O=o.pointCoordinate(I);if(!O)continue;const U=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);w+=O[3]*U,E+=U}return E===0?NaN:w/E}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*f,w=this._mercatorZfromZoom(o),E=this._mercatorZfromZoom(this._maxZoom),j=Math.max(w-y,E);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){const f=this.elevation,y=o.elevation,w=f!=null!=(y!=null)||f&&y&&f.exaggeration()!==y.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!w}computeZoomRelativeTo(o){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let y;y=o.z<this._camera.position[2]?[f.x,f.y,f.z]:[o.x,o.y,o.z];const w=s.ag(s.av([],this._camera.position,y));return s.aA(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let f=!1;if(o.orientation&&!s.cp(o.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(o.orientation)),o.position){const y=[o.position.x,o.position.y,o.position.z];s.cq(y,this._camera.position)||(this._setCameraPosition(y),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,f=new CE;return f.position=new s.ae(o[0],o[1],o[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(o){if(!s.cr(o))return!1;s.cs(o,o);const f=s.ct([],[0,0,-1],o),y=s.ct([],[0,-1,0],o);if(y[2]<0)return!1;const w=Kc(f,y);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(o){const f=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;o[2]=s.aA(o[2],w/y,w/f),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,f,y){this._unmodified=!1,this._edgeInsets.interpolate(o,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const f=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(o){const f=[new s.cu(0,o)];if(this.renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),w=this.pointCoordinate(new s.P(this.width,0)),E=this.pointCoordinate(new s.P(this.width,this.height)),j=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(y.x,w.x,E.x,j.x)),O=Math.floor(Math.max(y.x,w.x,E.x,j.x)),U=1;for(let q=I-U;q<=O+U;q++)q!==0&&f.push(new s.cu(q,o))}return f}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,f,y,w){let E=[];const j=y!=null,I=!j;if(I&&this.zoom<f||j&&y[0]===0&&y[1]===0)return E;const O=new Set,U=(X,Z,J,se,re)=>{const oe=s.cY(Z,X,J,se,re);O.has(oe)||(E.push(new s.aQ(X,Z,J,se,re)),O.add(oe))};for(let X=0;X<o.length;X++){const Z=o[X];if(I&&Z.canonical.z!==f||j&&w!==void 0&&w>Z.canonical.z)continue;const J=Z.canonical,se=Z.overscaledZ,re=Z.wrap,oe=1<<J.z,he=J.x+1<oe,xe=J.x>0,_e=J.y+1<oe,ye=J.y>0,Le=Z.wrap-(xe?0:1),ke=Z.wrap+(he?0:1),Re=xe?J.x-1:oe-1,Ae=he?J.x+1:0;if(j)y[0]<0?(U(se,ke,J.z,Ae,J.y),y[1]<0&&_e&&(U(se,re,J.z,J.x,J.y+1),U(se,ke,J.z,Ae,J.y+1)),y[1]>0&&ye&&(U(se,re,J.z,J.x,J.y-1),U(se,ke,J.z,Ae,J.y-1))):y[0]>0?(U(se,Le,J.z,Re,J.y),y[1]<0&&_e&&(U(se,re,J.z,J.x,J.y+1),U(se,Le,J.z,Re,J.y+1)),y[1]>0&&ye&&(U(se,re,J.z,J.x,J.y-1),U(se,Le,J.z,Re,J.y-1))):y[1]<0&&_e?U(se,re,J.z,J.x,J.y+1):ye&&U(se,re,J.z,J.x,J.y-1);else{const Te=Z.visibleQuadrants;1&Te&&(U(se,Le,J.z,Re,J.y),ye&&(U(se,re,J.z,J.x,J.y-1),U(se,Le,J.z,Re,J.y-1))),2&Te&&(U(se,ke,J.z,Ae,J.y),ye&&(U(se,re,J.z,J.x,J.y-1),U(se,ke,J.z,Ae,J.y-1))),4&Te&&(U(se,Le,J.z,Re,J.y),_e&&(U(se,re,J.z,J.x,J.y+1),U(se,Le,J.z,Re,J.y+1))),8&Te&&(U(se,ke,J.z,Ae,J.y),_e&&(U(se,re,J.z,J.x,J.y+1),U(se,ke,J.z,Ae,J.y+1)))}}const q=[];for(const X of E)E.some(Z=>X.isChildOf(Z))||q.push(X);if(E=q.filter(X=>!o.some(Z=>!!(X.overscaledZ<f&&Z.isChildOf(X))||X.equals(Z)||X.isChildOf(Z))),I){const X=1<<f,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[X*Z.x,X*Z.y],se=4,re=se*se;E=E.filter(oe=>{const he=oe.canonical.x+.5-J[0],xe=oe.canonical.y+.5-J[1];return he*he+xe*xe<re})}return E}extendTileCoverToNearPlane(o,f,y){const w=[],E=new Set;for(const xe of o)E.add(xe.key);const j=(xe,_e,ye,Le,ke)=>{const Re=s.cY(_e,xe,ye,Le,ke);E.has(Re)||(w.push(new s.aQ(xe,_e,ye,Le,ke)),E.add(Re))},I=o.reduce((xe,_e)=>Math.max(xe,_e.overscaledZ),y),O=1<<y,U=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],q=new s.P(0,0),X=new s.P(0,0),Z=(xe,_e)=>{const ye=Math.floor(xe[0]),Le=Math.floor(xe[1]),ke=(xe[0]-ye)*s.al,Re=(xe[1]-Le)*s.al,Ae=Math.floor(_e[0]),Te=Math.floor(_e[1]),$e=(_e[0]-Ae)*s.al,Ze=(_e[1]-Te)*s.al;for(let Ye=-1;Ye<=1;Ye++){const it=ye+Ye;if(!(it<0||it>=O)){q.x=ke-Ye*s.al,X.x=$e-(it-Ae)*s.al;for(let tt=-1;tt<=1;tt++){const vt=Le+tt;q.y=Re-tt*s.al,X.y=Ze-(vt-Te)*s.al,s.cZ(q,X,U)&&j(I,0,y,it,vt)}}}},J=f.points,se=J[s.cv],re=J[s.cw],oe=this._projectToGround(se,J[s.cx]),he=this._projectToGround(re,J[s.cy]);return Z(se,oe),Z(re,he),w}_projectToGround(o,f){return s.cz(s.cA(),o,f,o[2]/(o[2]-f[2]))}coveringTiles(o){let f=this.coveringZoomLevel(o);const y=f,w=this.elevation&&this.elevation.exaggeration(),E=w&&!o.isTerrainDEM,j=this.projection.name==="mercator";if(o.minzoom!==void 0&&f<o.minzoom)return[];o.maxzoom!==void 0&&f>o.maxzoom&&(f=o.maxzoom);const I=this.locationCoordinate(this.center),O=this.center.lat,U=1<<f,q=[U*I.x,U*I.y,0],X=this.projection.name==="globe",Z=!X,J=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,Z),se=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=U*s.cf(1,this.center.lat),oe=this._camera.position[2]/s.cf(1,this.center.lat),he=[U*se.x,U*se.y,oe*(Z?1:re)],xe=X||w,_e=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ye=this.isLODDisabled(!0)?f:0;let Le;if(this._elevation&&o.isTerrainDEM)Le=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Le=Ue?Ue.max:this._centerAltitude}else Le=this._centerAltitude;const ke=o.isTerrainDEM?-Le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?s.cC(this):1,Ae=Ue=>{const st=new s.ae(Ue.x+25e-6,Ue.y,Ue.z),It=new s.ae(Ue.x,Ue.y+25e-6,Ue.z),Mt=Ue.toLngLat(),Zt=st.toLngLat(),Dt=It.toLngLat(),$t=this.locationCoordinate(Mt),lr=this.locationCoordinate(Zt),or=this.locationCoordinate(Dt),Jt=Math.hypot(lr.x-$t.x,lr.y-$t.y),sr=Math.hypot(or.x-$t.x,or.y-$t.y);return Math.sqrt(Jt*sr)*Re/25e-6},Te=Ue=>{const ft=Le,st=ke;return{aabb:s.cF(this,U,0,0,0,Ue,st,ft,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:ft,wrap:Ue,fullyVisible:!1}},$e=[];let Ze=[];const Ye=f,it=o.reparseOverscaled?y:f,tt=(oe-this._centerAltitude)*re,vt=Ue=>{if(!this._elevation||!Ue.tileID||!j)return;const ft=this._elevation.getMinMaxForTile(Ue.tileID),st=Ue.aabb;ft?(st.min[2]=ft.min,st.max[2]=ft.max,st.center[2]=(st.min[2]+st.max[2])/2):(Ue.shouldSplit=et(Ue),Ue.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},At=(Ue,ft)=>{if(.707*ft<Ue)return 1;const st=ft/Ue;return st/(1.4144271570014144+(Math.pow(1.1,st-1.4144271570014144+1)-1)/(1.1-1)-1)},et=Ue=>{if(Ue.zoom<ye)return!0;if(Ue.zoom===Ye)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const ft=Ue.aabb.distanceX(he),st=Ue.aabb.distanceY(he);let It=tt,Mt=1;if(X){It=Ue.aabb.distanceZ(he);const sr=Math.pow(2,Ue.zoom),vr=s.a$((Ue.y+1)/sr),Cr=s.a$(Ue.y/sr),Gr=Math.min(Math.max(O,vr),Cr),un=s.d1(Gr)/s.d1(O);if(Mt=Gr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,un/this._mercatorScaleRatio),this.zoom<=s.c_&&Ue.zoom===Ye-1&&un>=.9)return!0}else if(E&&(It=Ue.aabb.distanceZ(he)*re),this.projection.isReprojectedInTileSpace&&y<=5){const sr=Math.pow(2,Ue.zoom),vr=Ae(new s.ae((Ue.x+.5)/sr,(Ue.y+.5)/sr));Mt=vr>.85?1:vr}if(!j&&!X){const sr=Math.sqrt(ft*ft+st*st+It*It);let vr=(1<<Ye-Ue.zoom)*_e*Mt;return vr*=At(Math.max(It,tt),sr),sr<vr}let Zt=Number.MAX_VALUE,Dt=0;const $t=Ue.aabb.getCorners(),lr=[];for(const sr of $t){s.av(lr,sr,he),X||(E?lr[2]*=re:lr[2]=tt);const vr=s.bJ(lr,this._camera.forward());vr<Zt&&(Zt=vr,Dt=Math.abs(lr[2]))}let or=(1<<Ye-Ue.zoom)*_e*Mt;if(or*=At(Math.max(Dt,tt),Zt),Zt<or)return!0;const Jt=Ue.aabb.closestPoint(q);return Jt[0]===q[0]&&Jt[1]===q[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)$e.push(Te(-Ue)),$e.push(Te(Ue));for($e.push(Te(0));$e.length>0;){const Ue=$e.pop(),ft=Ue.x,st=Ue.y;let It=Ue.fullyVisible;const Mt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!It){let Zt=xe?Ue.aabb.intersects(J):Ue.aabb.intersectsFlat(J);if(Zt===0&&Mt()){const Dt=new s.cD(Ue.zoom,ft,st);Zt=s.cE(this,U,Dt,!0).intersects(J)}if(Zt===0)continue;It=Zt===2}if(Ue.zoom===Ye||!et(Ue)){const Zt=Ue.zoom===Ye?it:Ue.zoom;if(o.minzoom&&o.minzoom>Zt)continue;let Dt=0;if(!It){let Jt=xe?Ue.aabb.intersectsPrecise(J):Ue.aabb.intersectsPreciseFlat(J);if(Jt===0&&Mt()){const sr=new s.cD(Ue.zoom,ft,st);Jt=s.cE(this,U,sr,!0).intersectsPrecise(J)}if(Jt===0)continue;if(o.calculateQuadrantVisibility)if(J.containsPoint(Ue.aabb.center))Dt=15;else for(let sr=0;sr<4;sr++)Ue.aabb.quadrant(sr).intersects(J)!==0&&(Dt|=1<<sr)}const $t=q[0]-(.5+ft+(Ue.wrap<<Ue.zoom))*(1<<f-Ue.zoom),lr=q[1]-.5-st,or=Ue.tileID?Ue.tileID:new s.aQ(Zt,Ue.wrap,Ue.zoom,ft,st);o.calculateQuadrantVisibility&&(or.visibleQuadrants=Dt),Ze.push({tileID:or,distanceSq:$t*$t+lr*lr});continue}for(let Zt=0;Zt<4;Zt++){const Dt=(ft<<1)+Zt%2,$t=(st<<1)+(Zt>>1),lr={aabb:j?Ue.aabb.quadrant(Zt):s.cF(this,U,Ue.zoom+1,Dt,$t,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Dt,y:$t,wrap:Ue.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};E&&!X&&(lr.tileID=new s.aQ(Ue.zoom+1===Ye?it:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Dt,$t),vt(lr)),$e.push(lr)}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,ft=this.horizonLineFromTop();Ze=Ze.filter(st=>{const It=[0,0,0,1],Mt=[s.al,s.al,0,1],Zt=this.calculateFogTileMatrix(st.tileID.toUnwrapped());s.aC(It,It,Zt),s.aC(Mt,Mt,Zt);const Dt=s.cG([],It,Mt),$t=s.cH([],It,Mt),lr=s.c$(Dt,$t);if(lr===0)return!0;let or=!1;const Jt=this._elevation;if(Jt&&lr>Ue&&ft!==0){const sr=this.calculateProjMatrix(st.tileID.toUnwrapped());let vr;o.isTerrainDEM||(vr=Jt.getMinMaxForTile(st.tileID)),vr||(vr={min:ke,max:Le});const Cr=s.cI(this.rotation),Gr=[Cr[0]*s.al,Cr[1]*s.al,vr.max];s.af(Gr,Gr,sr),or=(1-Gr[1])*this.height*.5<ft}return lr<Ue||or})}return Ze.sort((Ue,ft)=>Ue.distanceSq-ft.distanceSq).map(Ue=>Ue.tileID)}resize(o,f){this.width=o,this.height=f,this.pixelsToGLUnits=[2/o,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const f=s.aA(o.lat,-s.cJ,s.cJ),y=this.projection.project(o.lng,f);return new s.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,f){let y,w;const E=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;y=(f.x-E.x)/I,w=(f.y-E.y)/I}else{const I=this.pointCoordinate(f),O=this.pointCoordinate(E);y=I.x-O.x,w=I.y-O.y}const j=this.locationCoordinate(o);this.setLocation(new s.ae(j.x-y,j.y-w))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,f){return this.projection.locationPoint(this,o,f)}locationPoint3D(o,f){return this.projection.locationPoint(this,o,f,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,f){return this.coordinateLocation(this.pointCoordinate3D(o,f))}locationCoordinate(o,f){const y=f?s.cf(f,o.lat):void 0,w=this.projection.project(o.lng,o.lat);return new s.ae(w.x,w.y,y)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,f){const y=f??this._centerAltitude,w=[o.x,o.y,0,1],E=[o.x,o.y,1,1];s.aC(w,w,this.pixelMatrixInverse),s.aC(E,E,this.pixelMatrixInverse);const j=E[3];s.cK(w,w,1/w[3]),s.cK(E,E,1/j);const I=w[2],O=E[2];return{p0:w,p1:E,t:I===O?0:(y-I)/(O-I)}}screenPointToMercatorRay(o){const f=[o.x,o.y,0,1],y=[o.x,o.y,1,1];return s.aC(f,f,this.pixelMatrixInverse),s.aC(y,y,this.pixelMatrixInverse),s.cK(f,f,1/f[3]),s.cK(y,y,1/y[3]),f[2]=s.cf(f[2],this._center.lat)*this.worldSize,y[2]=s.cf(y[2],this._center.lat)*this.worldSize,s.cK(f,f,1/this.worldSize),s.cK(y,y,1/this.worldSize),new s.ax([f[0],f[1],f[2]],s.aw([],s.av([],y,f)))}rayIntersectionCoordinate(o){const{p0:f,p1:y,t:w}=o,E=s.cf(f[2],this._center.lat),j=s.cf(y[2],this._center.lat);return new s.ae(s.ak(f[0],y[0],w)/this.worldSize,s.ak(f[1],y[1],w)/this.worldSize,s.ak(E,j,w))}pointCoordinate(o,f=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,f)}pointCoordinate3D(o,f){if(!this.elevation)return this.pointCoordinate(o,f);let y=this.projection.pointCoordinate3D(this,o.x,o.y);if(y)return new s.ae(y[0],y[1],y[2]);let w=0,E=this.horizonLineFromTop();if(o.y>E)return this.pointCoordinate(o,f);const j=.02*E,I=o.clone();for(let O=0;O<10&&E-w>j;O++){I.y=s.ak(w,E,.66);const U=this.projection.pointCoordinate3D(this,I.x,I.y);U?(E=I.y,y=U):w=I.y}return y?new s.ae(y[0],y[1],y[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(o);const f=this.pointCoordinate(o);return f.y>=0&&f.y<=1}_coordinatePoint(o,f){const y=f&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,w=[o.x*this.worldSize,o.y*this.worldSize,y+o.toAltitude(),1];return s.aC(w,w,this.pixelMatrix),w[3]>0?new s.P(w[0]/w[3],w[1]/w[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:f}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=this.pointLocation3D(new s.P(f,o)),j=this.pointLocation3D(new s.P(w,o)),I=this.pointLocation3D(new s.P(w,y)),O=this.pointLocation3D(new s.P(f,y));let U=Math.min(E.lng,j.lng,I.lng,O.lng),q=Math.max(E.lng,j.lng,I.lng,O.lng),X=Math.min(E.lat,j.lat,I.lat,O.lat),Z=Math.max(E.lat,j.lat,I.lat,O.lat);const J=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,re=(oe,he,xe,_e,ye)=>{const Le=(oe+xe)/2,ke=(he+_e)/2,Re=new s.P(Le,ke),{lng:Ae,lat:Te}=this.pointLocation3D(Re),$e=Math.max(0,U-Ae,X-Te,Ae-q,Te-Z);U=Math.min(U,Ae),q=Math.max(q,Ae),X=Math.min(X,Te),Z=Math.max(Z,Te),(ye<se||$e>J)&&(re(oe,he,Le,ke,ye+1),re(Le,ke,xe,_e,ye+1))};if(re(f,o,w,o,1),re(w,o,w,y,1),re(w,y,f,y,1),re(f,y,f,o,1),this.projection.name==="globe"){const[oe,he]=s.cM(this);oe?(Z=90,q=180,U=-180):he&&(X=-90,q=180,U=-180)}return new s.aI(new s.aT(U,X),new s.aT(q,Z))}_getBoundsRectangular(o,f){const{top:y,left:w}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,I=new s.P(w,y),O=new s.P(j,y),U=new s.P(j,E),q=new s.P(w,E);let X=this.pointCoordinate(I,o),Z=this.pointCoordinate(O,o);const J=this.pointCoordinate(U,f),se=this.pointCoordinate(q,f),re=(oe,he)=>(he.y-oe.y)/(he.x-oe.x);return X.y>1&&Z.y>=0?X=new s.ae((1-se.y)/re(se,X)+se.x,1):X.y<0&&Z.y<=1&&(X=new s.ae(-se.y/re(se,X)+se.x,0)),Z.y>1&&X.y>=0?Z=new s.ae((1-J.y)/re(J,Z)+J.x,1):Z.y<0&&X.y<=1&&(Z=new s.ae(-J.y/re(J,Z)+J.x,0)),new s.aI().extend(this.coordinateLocation(X)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=o.visibleDemTiles.reduce((y,w)=>{if(w.dem){const E=w.dem.tree;y.min=Math.min(y.min,E.minimums[0]),y.max=Math.max(y.max,E.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*o.exaggeration(),f.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-f*(1-this._horizonShift);return o?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,f){return this.projection.createTileMatrix(this,f,o)}calculateDistanceTileData(o){const f=o.key,y=this._distanceTileDataCache;if(y[f])return y[f];const w=o.canonical,E=1/this.height,j=this.cameraWorldSize,I=j/this.zoomScale(w.z),O=(w.x+Math.pow(2,w.z)*o.wrap)*I,U=w.y*I,q=this.point;q.x*=j/this.worldSize,q.y*=j/this.worldSize;const X=this.angle,Z=Math.sin(-X),J=-Math.cos(-X);return y[f]={bearing:[Z,J],center:[(q.x-O)*E,(q.y-U)*E],scale:I/s.al*E},y[f]}calculateFogTileMatrix(o){const f=o.key,y=this._fogTileMatrixCache;if(y[f])return y[f];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.aB(w,this.worldToFogMatrix,w),y[f]=new Float32Array(w),y[f]}calculateProjMatrix(o,f=!1,y=!1){const w=o.key;let E;if(E=y?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,E[w])return E[w];const j=this.calculatePosMatrix(o,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,s.aB(j,I,j),E[w]=new Float32Array(j),E[w]}calculatePixelsToTileUnitsMatrix(o){const f=o.tileID.key,y=this._pixelsToTileUnitsCache;if(y[f])return y[f];const w=s.cN(o,this);return y[f]=w,y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,f=s.bq([],[o,o,o]);return s.aB(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const f=s.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),w=this._camera.forward(),E=s.cf(1,this._center.lat);y[2]/=E,w[2]/=E,s.aw(w,w);const j=o.raycast(y,w,o.exaggeration());if(j){const I=s.bH([],y,w,j),O=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),U=(O.z+s.ag([O.x-y[0],O.y-y[1],O.z-y[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const f=this._elevation,y=s.cf(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(y),E=f.getAtPointOrZero(new s.ae(...w)),j=this.pixelsPerMeter/this.worldSize*E,I=this._minimumHeightOverTerrain(),O=w[2]-j;if(O<=I)if(O<0||o){const U=this.locationCoordinate(this._center,this._centerAltitude),q=[w[0],w[1],U.z-w[2]],X=s.ag(q);q[2]-=(I-O)/this._pixelsPerMercatorPixel;const Z=s.ag(q);if(Z===0)return;s.c5(q,q,X/Z*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],U.z*this._pixelsPerMercatorPixel-q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Z=this.center;return Z.lat=s.aA(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Z.lng=s.aA(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const f=this._unmodified,{x:y,y:w}=this.point;let E=0,j=y,I=w;const O=this.width/2,U=this.height/2,q=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(w-U<q&&(I=q+U),w+U>X&&(I=X-U),X-q<this.height&&(E=Math.max(E,this.height/(X-q)),I=(X+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,se=this.worldSize/2-(Z+J)/2;j=(y+se+this.worldSize)%this.worldSize-se,j-O<Z&&(j=Z+O),j+O>J&&(j=J-O),J-Z<this.width&&(E=Math.max(E,this.width/(J-Z)),j=(J+Z)/2)}j===y&&I===w||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(j,I))),E&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,f=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const w=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this.projection.zAxisUnit==="meters"?y:1,j=this._camera.getWorldToCamera(this.worldSize,E);let I;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-o.x/this.width,O[9]=2*o.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),$e=Te*this.aspect,Ze=-$e,Ye=-Te;$e-=o.x,Ze-=o.x,Te+=o.y,Ye+=o.y,I=this._camera.getCameraToClipOrthographic(Ze,$e,Ye,Te,this._nearZ,this._farZ),((it,tt,vt,At)=>{for(let et=0;et<16;et++)it[et]=s.ak(tt[et],vt[et],At)})(I,I,O,s.d0(this.pitch>=Yc?1:this.pitch/Yc))}else I=O;const U=s.cP([],O,j);let q=s.cP([],I,j);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),$e=s.bA([]);s.br($e,$e,[Te.x*this.worldSize,Te.y*this.worldSize,0]),s.aB($e,$e,s.cQ(this)),s.br($e,$e,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),s.aB(q,q,$e),s.aB(U,U,$e),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],q,[this.worldSize,this.worldSize,this.worldSize/E,1]),this.projMatrix=q,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),f){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-o.x/this.width,Te[9]=2*o.y/this.height,this.expandedFarZProjMatrix=s.cP([],Te,j)}else this.expandedFarZProjMatrix=this.projMatrix;const X=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(X,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const Z=new Float32Array(16);s.bA(Z),s.cS(Z,Z,[1,-1,1]),s.cU(Z,Z,this._pitch),s.bB(Z,Z,this.angle);const J=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(J);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-o.x/this.width,J[9]=2*(o.y+se)/this.height,this.skyboxMatrix=s.aB(Z,J,Z);const re=this.point,oe=re.x,he=re.y,xe=this.width%2/2,_e=this.height%2/2,ye=Math.cos(this.angle),Le=Math.sin(this.angle),ke=oe-Math.round(oe)+ye*xe+Le*_e,Re=he-Math.round(he)+ye*_e+Le*xe,Ae=new Float64Array(q);if(s.br(Ae,Ae,[ke>.5?ke-1:ke,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ae,q=s.bC(),s.cS(q,q,[this.width/2,-this.height/2,1]),s.br(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=s.bC(),s.cS(q,q,[1,-1,1]),s.br(q,q,[-1,-1,0]),s.cS(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,U),this._calcFogMatrices(),this._distanceTileDataCache={},q=s.bl(new Float64Array(16),this.pixelMatrix),!q)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=q,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(Te,Te,j),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=q;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,y=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,E=[o,o,f];s.c5(E,E,w),s.c5(y,y,-1),s.cW(y,y,E);const j=s.bC();s.br(j,j,y),s.cS(j,j,E),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,f,w)}_computeCameraPosition(o){const f=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),w=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-o/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-y[0]*E,w.y/this.worldSize-y[1]*E,o/this.worldSize*this._centerAltitude-y[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],w=o[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(E=Math.min((f-y)/w,1)),this._camera.position=s.bH([],this._camera.position,o,E),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,f=this._camera.forward(),{pitch:y,bearing:w}=this._camera.getPitchBearing(),E=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((o[2]-E)/Math.cos(y),j),O=this._zoomFromMercatorZ(I);s.bH(o,o,f,I),this._pitch=s.aA(y,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(w,-Math.PI,Math.PI),this._setZoom(s.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let f=0,y=s.cL,w=0,E=1/0;for(;y-f>1e-6&&y>f;){const j=f+.5*(y-f),I=this.tileSize*Math.pow(2,j),O=this.getCameraToCenterDistance(this.projection,j,I),U=this.scaleZoom(O/(Math.max(0,o)*this.tileSize)),q=Math.abs(j-U);q<E&&(E=q,w=j),j<U?f=j:y=j}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,f){const y=Math.min(o.x,f.x),w=Math.max(o.x,f.x),E=Math.min(o.y,f.y),j=Math.max(o.y,f.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(y,E),new s.P(w,j),new s.P(y,j),new s.P(w,E)],O=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const q of I){const X=this.pointRayIntersection(q);if(X.t<0)return!0;const Z=this.rayIntersectionCoordinate(X);if(Z.x<O||Z.y<0||Z.x>U||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(o,f){const y=s.ag(s.av([],this._camera.position,o)),w=this._zoomFromMercatorZ(y)+f;return y-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([f,y,w],E){const j=[f,y,w,1];s.aC(j,j,E);const I=j[3]=Math.max(j[3],1e-6);return j[0]/=I,j[1]/=I,j[2]/=I,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,o))}}getCameraToCenterDistance(o,f=this.zoom,y=this.worldSize){const w=s.cO(o,f,this.width,this.height,1024),E=o.pixelSpaceConversion(this.center.lat,y,w);let j=.5/Math.tan(.5*this._fov)*this.height*E;return this.isOrthographic&&(j=s.ak(1,j,s.d0(this.pitch>=Yc?1:this.pitch/Yc))),j}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(o,o,this.globeMatrix),o}getFrustum(o){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Xl=(g,o)=>{if(o>0&&g.terrain&&s.w("Cutoff is currently disabled on terrain"),o<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=g.transform,y=Math.max(Math.abs(f._zoom-(g.minCutoffZoom-1)),1),w=f.isLODDisabled(!1)?s.ah(60,45,f.pitch):s.ah(30,15,f.pitch),E=f._farZ-f._nearZ,j=o*f.height,I=((1-(O=w))*f.cameraToCenterDistance+O*(f._farZ+j))*y;var O;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(I-f._nearZ)/E,(I-j-f._nearZ)/E]}}},Rd=2048;class pO{constructor(o,f){this.aabb=o,this.lastCascade=f}}class gg{add(o,f){const y=this.receivers[o.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],f.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],f.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],f.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],f.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],f.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],f.max[2])):this.receivers[o.key]=new pO(f,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,f,y){const w=s.d9.fromPoints(o.points);let E=0;for(const j in this.receivers){const I=this.receivers[j];if(!I||!w.intersectsAabb(I.aabb))continue;I.aabb.min=w.closestPoint(I.aabb.min),I.aabb.max=w.closestPoint(I.aabb.max);const O=I.aabb.getCorners();for(let U=0;U<y.length;U++){let q=!0;for(const X of O){const Z=[X[0]*f,X[1]*f,X[2]];if(s.af(Z,Z,y[U].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){q=!1;break}}if(I.lastCascade=U,E=Math.max(E,U),q)break}}return E+1}}class yg{constructor(o){this.painter=o,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new gg,this._depthMode=new dr(o.context.gl.LEQUAL,dr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,f){const y=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!f||!f.properties)return;const w=f.properties.get("shadow-intensity"),E=f.properties.get("shadow-draw-before-layer");if(!f.shadowsEnabled()||w<=0)return;let j=-1,I=0;for(const he of y.style.order){const xe=y.style._mergedLayers[he];xe.hasShadowPass()&&!xe.isHidden(o.zoom)&&(j=I),E&&E===he&&(this._drawShadowAfterLayer=I>0?I-1:0),I+=1}if(this._enabled=j>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=j);const O=y.context,U=Rd,q=Rd;if(this._cascades.length===0||Rd!==this._cascades[0].texture.size[0]){this._cascades=[];for(let he=0;he<2;++he){const xe=y._shadowMapDebug,_e=O.gl,ye=O.createFramebuffer(U,q,xe?1:0,"texture"),Le=new s.T(O,{width:U,height:q,data:null},_e.DEPTH_COMPONENT16);if(ye.depthAttachment.set(Le.texture),xe){const ke=new s.T(O,{width:U,height:q,data:null},_e.RGBA8);ye.colorAttachment0.set(ke.texture)}this._cascades.push({framebuffer:ye,texture:Le,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=PE(f);let X=0;if(o.elevation){const he=o.elevation,xe=[1e4,-1e4];he.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ye=_e.dem.tree;xe[0]=Math.min(xe[0],ye.minimums[0]),xe[1]=Math.max(xe[1],ye.maximums[0])}),xe[0]!==1e4&&(X=(xe[1]-xe[0])*he.exaggeration())}const Z=1.5*o.cameraToCenterDistance,J=3*Z,se=new Float64Array(16);for(let he=0;he<this._cascades.length;++he){const xe=this._cascades[he];let _e=o.height/50,ye=1;he===0?ye=Z:(_e=Z,ye=J);const[Le,ke]=NE(o,this.shadowDirection,_e,ye,Rd,X);xe.scale=o.scale,xe.matrix=Le,xe.boundingSphereRadius=ke,s.bl(se,xe.matrix),xe.frustum=s.cB.fromInvProjectionMatrix(se,1,0,!0),xe.far=ye}const re=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[re].far,this._cascades[re].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Rd,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const oe=y.transform.elevation;for(const he of this._groundShadowTiles){let xe={min:0,max:0};if(oe){const _e=oe.getMinMaxForTile(he);_e&&(xe=_e)}this.addShadowReceiver(he.toUnwrapped(),xe.min,xe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,f){if(!this.enabled)return;const y=this.painter,w=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),w.viewport.set([0,0,Rd,Rd]);for(let E=0;E<this._numCascadesToRender;++E){y.currentShadowCascade=E,w.bindFramebuffer.set(this._cascades[E].framebuffer.framebuffer),w.clear({color:s.ao.white,depth:1});for(const j of o.order){const I=o._mergedLayers[j];if(!I.hasShadowPass()||I.isHidden(y.transform.zoom))continue;const O=o.getLayerSourceCache(I),U=O?f[O.id]:void 0;(I.type==="model"||U&&U.length)&&y.renderLayer(y,O,I,U)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,f=o.style,y=o.context,w=y.gl,E=f.directionalLight,j=f.ambientLight;if(!E||!j)return;const I=[],O=Xl(o,o.longestCutoffRange);O.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const U=Kl(f,E,j),q=new dr(w.LEQUAL,dr.ReadOnly,o.depthRangeFor3D),X=new Ir({func:w.EQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.KEEP);for(const Z of this._groundShadowTiles){const J=Z.toUnwrapped(),se=o.isTileAffectedByFog(Z),re=o.getOrCreateProgram("groundShadow",{defines:I,overrideFog:se});this.setupShadows(J,re),o.uploadCommonUniforms(y,re,J,null,O);const oe=Co(o.transform.calculateProjMatrix(J),U);re.draw(o,w.TRIANGLES,q,X,Lr.multiply,Ar.disabled,oe,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Lr.unblended:Lr.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(o){const f=this.painter.transform,y=f.calculatePosMatrix(o,f.worldSize);return s.aB(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(o){const f=s.bz(o);return s.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,o),f}setupShadows(o,f,y){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,j=E.gl,I=this._uniformValues,O=new Float64Array(16),U=w.calculatePosMatrix(o,w.worldSize);for(let q=0;q<this._cascades.length;q++)s.aB(O,this._cascades[q].matrix,U),I[q===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),E.activeTexture.set(j.TEXTURE0+11+q),this._cascades[q].texture.bindExtraParam(j.LINEAR,j.LINEAR,j.CLAMP_TO_EDGE,j.CLAMP_TO_EDGE,j.GREATER);if(this.useNormalOffset=!!y,this.useNormalOffset){const q=s.d7(o.canonical),X=2/w.tileSize*s.al/Rd,Z=X*this._cascades[0].boundingSphereRadius,J=X*this._cascades[this._cascades.length-1].boundingSphereRadius,se=(y==="vector-tile"?1:3)*function(re){const oe=s.aA((re-22)/-22,0,1);return .125*(1-oe)+4*oe}(w.zoom);I.u_shadow_normal_offset=[q,Z*se,J*se],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(E,I)}setupShadowsFromMatrix(o,f,y=!1){if(!this.enabled)return;const w=this.painter.context,E=w.gl,j=this._uniformValues,I=new Float64Array(16);for(let O=0;O<2;O++)s.aB(I,this._cascades[O].matrix,o),j[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),w.activeTexture.set(E.TEXTURE0+11+O),this._cascades[O].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);this.useNormalOffset=y,y?(j.u_shadow_normal_offset=[1,3,3],j.u_shadow_bias=[6e-5,.0012,.012]):j.u_shadow_bias=[36e-5,.0012,.012],f.setShadowUniformValues(w,j)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,f,y,w){if(w[2]>=0)return{};const E=function(O,U,q){const X=q/(1<<O.canonical.z);return new s.d9([O.canonical.x*X+O.wrap*q,O.canonical.y*X+O.wrap*q,0],[(O.canonical.x+1)*X+O.wrap*q,(O.canonical.y+1)*X+O.wrap*q,U])}(o,f,y).getCorners(),j=f/-w[2];w[0]<0?(s.d8(E[0],E[0],[w[0]*j,0,0]),s.d8(E[3],E[3],[w[0]*j,0,0])):w[0]>0&&(s.d8(E[1],E[1],[w[0]*j,0,0]),s.d8(E[2],E[2],[w[0]*j,0,0])),w[1]<0?(s.d8(E[0],E[0],[0,w[1]*j,0]),s.d8(E[1],E[1],[0,w[1]*j,0])):w[1]>0&&(s.d8(E[2],E[2],[0,w[1]*j,0]),s.d8(E[3],E[3],[0,w[1]*j,0]));const I={};return I.vertices=E,I.planes=[$v(E[1],E[0],E[4]),$v(E[2],E[1],E[5]),$v(E[3],E[2],E[6]),$v(E[0],E[3],E[7])],I}addShadowReceiver(o,f,y){this._receivers.add(o,s.d9.fromTileIdAndHeight(o,f,y))}getMaxCascadeForTile(o){const f=this._receivers.get(o);return f&&f.lastCascade?f.lastCascade:0}}function $v(g,o,f){const y=s.av([],f,o),w=s.av([],g,o),E=s.bI([],y,w),j=s.ag(E);return j===0?[0,0,1,0]:(s.c5(E,E,1/j),[E[0],E[1],E[2],-s.bJ(E,o)])}function PE(g){const o=g.properties.get("direction"),f=s.d4(o.x,o.y,o.z);f[2]=s.aA(f[2],0,75);const y=s.d6([f[0],f[1],f[2]]);return s.d5(y.x,y.y,y.z)}function Kl(g,o,f){const y=o.properties.get("color-use-theme")==="none",w=o.properties.get("color"),E=o.properties.get("intensity"),j=o.properties.get("direction"),I=[j.x,j.y,j.z],O=f.properties.get("color-use-theme")==="none",U=f.properties.get("color"),q=f.properties.get("intensity"),X=Math.max(s.bJ([0,0,1],I),0),Z=[0,0,0];s.c5(Z,U.toPremultipliedRenderColor(O?null:g.getLut(o.scope)).toArray01Linear().slice(0,3),q);const J=[0,0,0];return s.c5(J,w.toPremultipliedRenderColor(y?null:g.getLut(f.scope)).toArray01Linear().slice(0,3),X*E),s.db([Z[0]>0?Z[0]/(Z[0]+J[0]):0,Z[1]>0?Z[1]/(Z[1]+J[1]):0,Z[2]>0?Z[2]/(Z[2]+J[2]):0])}function NE(g,o,f,y,w,E){const j=g.zoom,I=g.scale,O=g.worldSize,U=1/O,q=g.aspect,X=Math.sqrt(1+q*q)*Math.tan(.5*g.fovX),Z=X*X,J=y-f,se=y+f;let re,oe;Z>J/se?(re=y,oe=y*X):(re=.5*se*(1+Z),oe=.5*Math.sqrt(J*J+2*(y*y+f*f)*Z+se*se*Z*Z));const he=g.projection.pixelsPerMeter(g.center.lat,O),xe=g._camera.getCameraToWorldMercator(),_e=[0,0,-re*U];s.af(_e,_e,xe);let ye=oe*U;const Le=function(It){return It[0]/=I,It[1]/=I,It[2]=s.cf(It[2],g._center.lat),It},ke=g._edgeInsets;if(!(ke.left===0&&ke.top===0&&ke.right===0&&ke.bottom===0||ke.left===ke.right&&ke.top===ke.bottom)){const It=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?he:1),Mt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,f,y);Mt[8]=2*-g.centerOffset.x/g.width,Mt[9]=2*g.centerOffset.y/g.height;const Zt=new Float64Array(16);s.cP(Zt,Mt,It);const Dt=new Float64Array(16);s.bl(Dt,Zt);const $t=s.cB.fromInvProjectionMatrix(Dt,O,j,!0);for(const lr of $t.points){const or=Le(lr);ye=Math.max(ye,s.c6(s.da([],_e,or)))}}ye*=w/(w-1);const Re=Math.acos(o[2]),Ae=Math.atan2(-o[0],-o[1]),Te=new np;Te.position=_e,Te.setPitchBearing(Re,Ae);const $e=Te.getWorldToCamera(O,he),Ze=ye*O,Ye=Math.min(g._mercatorZfromZoom(17)*O*-2,-2*Ze),it=Te.getCameraToClipOrthographic(-Ze,Ze,-Ze,Ze,Ye,(Ze+E*he)/o[2]),tt=new Float64Array(16);s.aB(tt,it,$e);const vt=s.d5(Math.floor(1e6*_e[0])/1e6*O,Math.floor(1e6*_e[1])/1e6*O,0),At=.5*w,et=[0,0,0];s.af(et,vt,tt),s.c5(et,et,At);const Ue=[Math.floor(et[0]),Math.floor(et[1]),Math.floor(et[2])],ft=[0,0,0];s.av(ft,et,Ue),s.c5(ft,ft,-1/At);const st=new Float64Array(16);return s.bA(st),s.br(st,st,ft),s.aB(tt,st,tt),[tt,Ze]}class Vv extends s.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,f){return s.dc(this.requestManager.transformRequest(f,s.R.Model).url).then(y=>{if(!y)return;const w=s.dd(y),E=new s.de(o,f,void 0,void 0,w);return E.computeBoundsAndApplyParent(),E}).catch(y=>{if(y&&y.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${o} from ${f}: ${y.message}`)))})}load(o,f,y={forceReload:!1}){this.models[f]||(this.models[f]={});const w=Object.keys(o),E=[],j=[];for(const I of w){const O=o[I];this.hasURLBeenRequested(O)&&!y.forceReload||(this.modelByURL[O]={modelId:I,scope:f},E.push(this.loadModel(I,O)),j.push(I)),this.models[f][I]||(this.models[f][I]={model:null,numReferences:1})}this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+j.length,Promise.allSettled(E).then(I=>{for(let O=0;O<I.length;O++){const{status:U}=I[O];if(U==="rejected")continue;const{value:q}=I[O];this.models[f][j[O]]||(this.models[f][j[O]]={model:null,numReferences:1}),this.models[f][j[O]].model=q}this.numModelsLoading[f]-=j.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,f,y={exactIdMatch:!1}){return!!(y.exactIdMatch?this.getModel(o,f):this.getModelByURL(this.modelUris[f][o]))}getModel(o,f){return this.models[f]||(this.models[f]={}),this.models[f][o]?this.models[f][o].model:void 0}getModelByURL(o){if(!o)return null;const f=this.modelByURL[o];return f?this.models[f.scope][f.modelId].model:null}hasModelBeenAdded(o,f){return this.models[f]&&this.models[f][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,f,y){this.models[y]||(this.models[y]={}),this.modelUris[y]||(this.modelUris[y]={});const w=this.requestManager.normalizeModelURL(f);if((this.hasModel(o,y,{exactIdMatch:!0})||this.hasModelBeenAdded(o,y))&&this.modelUris[y][o]===w)this.models[y][o].numReferences++;else if(this.hasURLBeenRequested(w)){const{scope:E,modelId:j}=this.modelByURL[w];this.models[E][j].numReferences++}else this.modelUris[y][o]=w,this.load({[o]:this.modelUris[y][o]},y)}addModelURLs(o,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const y=this.modelUris[f];for(const w in o)y[w]=this.requestManager.normalizeModelURL(o[w])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const y={};for(const w of o)this.hasModel(w,f,{exactIdMatch:!0})||this.hasURLBeenRequested(w)?this.models[f][w].numReferences++:this.modelUris[f][w]&&!this.hasURLBeenRequested(w)?y[w]=this.modelUris[f][w]:!this.hasURLBeenRequested(w)&&s.df(w,!1)&&(this.modelUris[f][w]=this.requestManager.normalizeModelURL(w),y[w]=this.modelUris[f][w]);this.load(y,f)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,f,y=!1,w=!1){if(this.models[f]&&this.models[f][o]&&(this.models[f][o].numReferences--,this.models[f][o].numReferences===0||w)){const E=this.modelUris[f][o];y||delete this.modelUris[f][o],delete this.modelByURL[E];const j=this.models[f][o].model;if(!j)return;delete this.models[f][o],j.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const f of Object.keys(this.models[o])){const y=this.models[o][f].model;delete this.models[o][f],y&&y.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,f){this.models[f]||(this.models[f]={});for(const y in this.models[f])this.models[f][y].model&&this.models[f][y].model.upload(o.context)}}const vg=s.a6.colorTheme,Md=new s.a9({data:new s.aa(vg.data)});function mO(g){if(!g.metadata||!g.metadata.content_area)return;const o=s.o.devicePixelRatio,{left:f,top:y,width:w,height:E}=g.metadata.content_area,j=f*o,I=y*o;return[j,I,j+w*o,I+E*o]}function IE(g){if(g)return g.map(([o,f])=>[o*s.o.devicePixelRatio,f*s.o.devicePixelRatio])}class gO{constructor(o,f,y){this.id=o,this.scope=f,this.sourceCache=y,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const f=this.sourceCache.getVisibleCoordinates();if(f.length===0)return o;const y=this.sourceCache.getSource();if(!(y instanceof io))return o;const w=f.map(j=>this.sourceCache.getTile(j)),E=y.getImages(w,Array.from(this.pendingRequests));for(const[j,I]of E)o.set(s.I.from({name:j,iconsetId:this.id}),I),this.pendingRequests.delete(j);for(const j of this.pendingRequests)this.missingRequests.add(j);return this.pendingRequests.clear(),o}}class Hb{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",f=>this._onIndoorUpdate(f)),this._container}_createButton(o,f){const y=R("button",o,this._container);return y.type="button",y.addEventListener("click",f),y}_createSeparator(){return R("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,f){this._map&&(o.setAttribute("aria-label",f),o.textContent=f)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const f=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",f&&Array.from(this._container.children).forEach(y=>y.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const f=this._map;this._model&&f&&f._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});R("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,f){for(let y=0;y<o.length;y++){const w=o[y],E=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(w.id)});this._setButtonTitle(E,w.zIndex.toString()),this._model&&w.id===this._model.selectedFloorId&&f&&E.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(E),y<o.length-1&&this._createSeparator()}}}class yO extends s.E{constructor(o){super(),this._style=o,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[f,y]of Object.entries(o.buildings))if(this._buildings[f])for(const w of y.floorIds)this._buildings[f].floors[w]||(this._buildings[f].floors[w]=y.floors[w]);else this._buildings[f]=y;for(const f of o.activeFloors)this._activeFloors.add(f);this._updateIndoorSelector()}getIndoorTileOptions(o,f){const y=this._style.getIndoorSourceLayers(o,f);return y&&this._indoorState?{sourceLayers:y,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Hb,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const o=this._style.map.transform,f=function(y,w,E,j){let I=null,O=Number.MAX_SAFE_INTEGER;if(j<16)return null;for(const[U,q]of Object.entries(y)){const X=q.center;if(X){const Z=w.distanceTo(s.aT.convert(X));Z<O&&E.contains(X)&&(O=Z,I=U)}}return I}(this._buildings,o.center,o.getBounds(),o.zoom);f!==this._closestBuildingId&&(this._closestBuildingId=f,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,f=this._closestBuildingId,y=f&&o?o[f]:void 0;if(!y)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let w=null;for(const j of y.floorIds)if(this._activeFloors&&this._activeFloors.has(j)){w=j;break}const E=Array.from(y.floorIds).map(j=>({id:j,name:y.floors[j].name,zIndex:y.floors[j].zIndex})).sort((j,I)=>I.zIndex-j.zIndex);this.fire(new s.z("selector-update",{selectedFloorId:w,activeFloorsVisible:this._activeFloorsVisible,floors:E}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const Fu=(g,o)=>He(g,o&&o.filter(f=>f.identifier!=="source.canvas")),kE=s.aH(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),OE=s.aH(bn,["setCenter","setZoom","setBearing","setPitch"]),Uv=new Set(["background","sky","slot","custom"]),Zb={version:8,layers:[],sources:{}},Dd={duration:300,delay:0};class Ho extends s.E{constructor(o,f={}){super(),this.map=o,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=Object.assign({},Dd),this._buildingIndex=new cg(this),this.crossTileSymbolIndex=new Cs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=f.styleChanges||new zn,this._hasDataDrivenEmissive=!1,this.indoorManager=new yO(this),this.dispatcher=f.dispatcher?f.dispatcher:new s.D(s.dh(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new lt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new s.di(o._requestManager,f.localFontFamily?s.dj.all:f.localIdeographFontFamily?s.dj.ideographs:s.dj.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new Vv(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._indoorDependentLayers=f.indoorDependentLayers?f.indoorDependentLayers:new Set,this._config=f.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:f.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const y=this;this._rtlTextPluginCallback=Ho.registerForPluginStateChange(w=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(E,j)=>{if(s.dl(E),j&&j.every(I=>I))for(const I in y._sourceCaches){const O=y._sourceCaches[I],U=O.getSource().type;U!=="vector"&&U!=="geojson"||O.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const E=this.getOwnSource(w.sourceId);if(E&&E.vectorLayerIds)for(const j in this._layers){const I=this._layers[j];I.source===E.id&&this._validateLayer(I)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(s.h(o))return o;const f=s.dm(o);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${s.dn(JSON.stringify(o))}`}_diffStyle(o,f,y){this.globalId=this._getGlobalId(o);const w=(E,j)=>{try{j(null,this.setState(E,y))}catch(I){j(I,!1)}};if(typeof o=="string"){const E=this.map._requestManager.normalizeStyleURL(o),j=this.map._requestManager.transformRequest(E,s.R.Style);s.m(j,(I,O)=>{I?this.fire(new s.y(I)):O&&w(O,f)})}else typeof o=="object"&&w(o,f)}loadURL(o,f={}){this.fire(new s.z("dataloading",{dataType:"style"}));const y=typeof f.validate=="boolean"?f.validate:!s.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,f.accessToken),this.resolvedImports.add(o);const w=this.importsCache.get(o);if(w)return this._load(w,y);const E=this.map._requestManager.transformRequest(o,s.R.Style);this._request=s.m(E,(j,I)=>{if(this._request=null,j)this.fire(new s.y(j));else if(I)return this.importsCache.set(o,I),this._load(I,y)})}loadJSON(o,f={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=s.o.frame(()=>{this._request=null,this._load(o,f.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Zb,!1)}_loadImports(o,f,y){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const E of o){const j=this._createFragmentStyle(E),I=new Promise(q=>{j.once("style.import.load",q),j.once("error",q)}).then(()=>this.mergeAll());if(w.push(I),this.resolvedImports.has(E.url)){j.loadEmpty();continue}const O=E.data||this.importsCache.get(E.url);O?(j.loadJSON(O,{validate:f}),this._isInternalStyle(O)&&(j.globalId=null)):E.url?j.loadURL(E.url,{validate:f}):j.loadEmpty();const U={style:j,id:E.id,config:E.config};if(y){const q=this.fragments.findIndex(({id:X})=>X===y);this.fragments=this.fragments.slice(0,q).concat(U).concat(this.fragments.slice(q))}else this.fragments.push(U)}return Promise.allSettled(w)}getImportGlobalIds(o=this,f=new Set){for(const y of o.fragments)y.style.globalId&&f.add(y.style.globalId),this.getImportGlobalIds(y.style,f);return[...f.values()]}_createFragmentStyle(o){const f=this.scope?s.B(o.id,this.scope):o.id;let y;const w=this._initialConfig&&this._initialConfig[f];(o.config||w)&&(y=Object.assign({},o.config,w));const E=new Ho(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return E.setEventedParent(this.map,{style:E}),E}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,f){if(this._isInternalStyle(o)){const E=Object.assign({},Zb,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(E,f)}if(this.updateConfig(this._config,o.schema),f&&Fu(this,ii(o)))return;this._loaded=!0,this.stylesheet=s.dp(o);const y=()=>{for(const O in o.sources)this.addSource(O,o.sources[O],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const O in o.iconsets)this.addIconset(O,o.iconsets[O]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const E=Fb(this.stylesheet.layers);if(this._order=E.map(O=>O.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new ct(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ct(this.stylesheet.light)),this._layers={};for(const O of E){const U=s.du(O,this.scope,this._styleColorTheme.lut,this.options);U.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(U.fqid),U.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(U.fqid),this._hasAppearances=this._hasAppearances||U.getAppearances().length!==0,U.setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U;const q=this.getOwnLayerSourceCache(U),X=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&U.canCastShadows()&&X&&(q.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const j=this.stylesheet.terrain;j&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(j,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();o.imports?this._loadImports(o.imports,f).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(O=>{this.fire(new s.y(new Error("Failed to load imports",O))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const w=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(w){const E=this._evaluateColorThemeData(w);this._loadColorTheme(E).then(()=>{y()}).catch(j=>{s.w(`Couldn't load color theme from the stylesheet: ${j}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,f,y,w,E,j,I,O,U,q;const X={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Z=>{if(Z.stylesheet){if(Z.light!=null&&(o=Z.light),Z.stylesheet.lights)for(const J of Z.stylesheet.lights)J.type==="ambient"&&Z.ambientLight!=null&&(f=Z.ambientLight),J.type==="directional"&&Z.directionalLight!=null&&(y=Z.directionalLight);w=this._prioritizeTerrain(w,Z.terrain,Z.stylesheet.terrain),Z.stylesheet.fog&&Z.fog!=null&&(E=Z.fog),Z.stylesheet.snow&&Z.snow!=null&&(j=Z.snow),Z.stylesheet.rain&&Z.rain!=null&&(I=Z.rain),Z.stylesheet.camera!=null&&(q=Z.stylesheet.camera),Z.stylesheet.projection!=null&&(O=Z.stylesheet.projection),Z.stylesheet.transition!=null&&(U=Z.stylesheet.transition),X[Z.scope]=Z._styleColorTheme}}),this.light=o,this.ambientLight=f,this.directionalLight=y,this.fog=E,this.snow=j,this.rain=I,this._styleColorThemeForScope=X,w===null?delete this.terrain:this.terrain=w,this.camera=q||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},Dd,U),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const f=y=>{for(const w of y.fragments)f(w.style);o(y)};f(this)}_prioritizeTerrain(o,f,y){const w=o&&o.drapeRenderMode===0;return y===null?f&&f.drapeRenderMode===0?f:w?o:null:f!=null&&(!o||w||f&&f.drapeRenderMode===1)?f:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{o=this._prioritizeTerrain(o,f.terrain,f.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(o=f.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},f={},y={};this.forEachFragmentStyle(w=>{for(const E in w._sourceCaches){const j=s.B(E,w.scope);o[j]=w._sourceCaches[E]}for(const E in w._otherSourceCaches){const j=s.B(E,w.scope);f[j]=w._otherSourceCaches[E]}for(const E in w._symbolSourceCaches){const j=s.B(E,w.scope);y[j]=w._symbolSourceCaches[E]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=y}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const f of Object.values(o.stylesheet.indoor)){const y=f,w=s.B(y.sourceId,o.scope);this._mergedIndoor[w]=new Set(y.sourceLayers||[])}})}mergeLayers(){const o={},f=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(j=>{for(const I of j._order){const O=j._layers[I];if(O.type==="slot"){const U=s.dq(I);if(o[U])continue;o[U]=[]}O.slot&&o[O.slot]?o[O.slot].push(O):f.push(O)}}),this._mergedOrder=[];let w=-1;const E=(j=[])=>{for(const I of j)if(I.type==="slot"){const O=s.dq(I.id);o[O]&&E(o[O]),this._mergedSlots.push(O)}else{const O=s.B(I.id,I.scope);this._mergedOrder.push(O),y[O]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,w=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(E(f),this._has3DLayers){const j={};for(let I=0;I<this._mergedOrder.length;++I){const O=this._mergedOrder[I];j[O]=I===w?1:I<w?y[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,O)=>j[I]-j[O])}this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(f,y,w){const E=Object.assign({},y);for(const I of Object.keys(vg))E[I]===void 0&&(E[I]=vg[I].default);const j=new s.a8(Md,f,new Map(w));return j.setTransitionOrValue(E,w),j.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,w)=>{const E="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let j=o;j.startsWith(E)||(j=E+j);const I=s.I.from("mapbox-reserved-lut"),O=new Image;O.src=j,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void y();this._styleColorTheme.lutLoading=!1;const{width:U,height:q,data:X}=s.o.getImageData(O);if(q>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(U!==q*q)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:U,height:q},X),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Z=this.imageManager.getImage(I,this.scope);Z?(this._styleColorTheme.lut={image:Z.data,data:o},y()):w(new Error("Missing LUT image."))}})}getLut(o){const f=this._styleColorThemeForScope[o];return f?f.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(f,y,w){let E,j,I;const O=s.o.devicePixelRatio>1?"@2x":"";let U=s.m(y.transformRequest(y.normalizeSpriteURL(f,O,".json"),s.R.SpriteJSON),(Z,J)=>{U=null,I||(I=Z,E=J,X())}),q=s.n(y.transformRequest(y.normalizeSpriteURL(f,O,".png"),s.R.SpriteImage),(Z,J)=>{q=null,I||(I=Z,j=J,X())});function X(){if(I)w(I);else if(E&&j){const Z=s.o.getImageData(j),J={};for(const se in E){const{width:re,height:oe,x:he,y:xe,sdf:_e,pixelRatio:ye,stretchX:Le,stretchY:ke,content:Re}=E[se],Ae=new s.q({width:re,height:oe});s.q.copy(Z,Ae,{x:he,y:xe},{x:0,y:0},{width:re,height:oe},null),J[se]={data:Ae,pixelRatio:ye!==void 0?ye:1,sdf:_e!==void 0&&_e,stretchX:Le,stretchY:ke,content:Re,usvg:!1,version:0}}w(null,J)}}return{cancel(){U&&(U.cancel(),U=null),q&&(q.cancel(),q=null)}}}(o,this.map._requestManager,(f,y)=>{if(this._spriteRequest=null,f)this.fire(new s.y(f));else if(y){const w=new Map;for(const E in y)w.set(s.I.from(E),y[E]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(o,f){if(f.type==="sprite")return void this._loadSprite(f.url);const y=this.getOwnSourceCache(f.source);if(!y)return void this.fire(new s.y(new Error(`Source "${f.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const w=y.getSource();if(w.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${f.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));w.partial=!1;const E=new gO(o,this.scope,y);this.imageManager.addImageProvider(E,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!s.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const f=this.map._spriteFormat==="auto";var y,w;this._spriteRequest=(w=(E,j)=>{if(this._spriteRequest=null,E)f?this._loadSprite(o):this.fire(new s.y(E));else if(j){const I=new Map;for(const O in j)I.set(s.I.from(O),j[O]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((y=this.map._requestManager).transformRequest(y.normalizeIconsetURL(o),s.R.Iconset),(E,j)=>{if(E)return void w(E);const I={},O=s.dg(new s.bt(j));for(const U of O.icons){const q={version:1,pixelRatio:s.o.devicePixelRatio,content:mO(U),stretchX:U.metadata?IE(U.metadata.stretch_x_areas):void 0,stretchY:U.metadata?IE(U.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:U};I[U.name]=q}w(null,I)}))}_validateLayer(o){const f=this.getOwnSource(o.source);if(!f)return;const y=o.sourceLayer;y&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.y(new Error(`Source layer "${y}" does not exist on source "${f.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,f)=>{const y=this.fragments[f];return y&&y.style&&(o.data=y.style.serialize()),o})}_serializeSources(){const o={};for(const f in this._sourceCaches){const y=this._sourceCaches[f].getSource();o[y.id]||(o[y.id]=y.serialize())}return o}_serializeLayers(o){const f=[];for(const y of o){const w=this._layers[y];w&&w.type!=="custom"&&f.push(w.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const o in this._mergedLayers){const f=this._mergedLayers[o];if(f._transitionablePaint&&f._transitionablePaint._values){const y=f._transitionablePaint._values["line-emissive-strength"];if(y&&y.value&&y.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const f=this.getOwnLayer(o);if(f)return f;this.fire(new s.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const f=this.getOwnSource(o);if(f)return f;this.fire(new s.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,f){const y=this.map.painter;if(y)for(let w=o.minzoom||0;w<(o.maxzoom||25.5);w++){const E=o.getProgramIds();if(E)for(const j of E){const I=o.getDefaultProgramParams(j,f.zoom,this._styleColorTheme.lut);I&&(y.style=this,this.fog&&(y._fogVisible=!0,I.overrideFog=!0,y.getOrCreateProgram(j,I)),y._fogVisible=!1,I.overrideFog=!1,y.getOrCreateProgram(j,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,y.getOrCreateProgram(j,I)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const f=this.calculateLightsBrightness();o.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const y=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const O in I){const{updatedIds:U,removedIds:q}=I[O];(U||q)&&(this._updateWorkerLayers(O,U,q),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const E={};for(const I in this._mergedSourceCaches){const O=this._mergedSourceCaches[I];E[I]=O.used,O.used=!1,O.tileCoverLift=0}for(const I of this._mergedOrder){const O=this._mergedLayers[I];if(O.visibility!=="none"&&O.recalculate(o,this._availableImages),!O.isHidden(o.zoom)){const U=this.getLayerSourceCache(O);U&&(U.used=!0,U.tileCoverLift=Math.max(U.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,o)}):this.precompilePrograms(O,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();const j=this.imageManager.getPendingImageProviders();for(const I of j)I.sourceCache.used=!0;for(const I in E){const O=this._mergedSourceCaches[I];E[I]!==O.used&&O.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),y&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const f of o){const y=f.resolvePendingRequests(),w=this.getFragmentStyle(f.scope);w&&w.addImages(y)}}_updateTilesForChangedImages(){const o={};for(const f in this._mergedSourceCaches){const y=this._mergedSourceCaches[f].getSource().scope;o[y]=o[y]||this._changes.getUpdatedImages(y),o[y].length!==0&&this._mergedSourceCaches[f].reloadTilesForDependencies(["icons","patterns"],o[y])}for(const f in o)this._changes.resetUpdatedImages(f)}_updateWorkerLayers(o,f,y){const w=this.getFragmentStyle(o);w&&this.dispatcher.broadcast("updateLayers",{layers:f?w._serializeLayers(f):[],scope:o,removedIds:y||[],options:w.options})}setState(o,f){if(this._checkLoaded(),Fu(this,ii(o)))return!1;(o=s.dp(o)).layers=Fb(o.layers);const y=function(j,I){if(!j)return[{command:bn.setStyle,args:[I]}];let O=[];try{if(!s.by(j.version,I.version))return[{command:bn.setStyle,args:[I]}];if(s.by(j.center,I.center)||O.push({command:bn.setCenter,args:[I.center]}),s.by(j.zoom,I.zoom)||O.push({command:bn.setZoom,args:[I.zoom]}),s.by(j.bearing,I.bearing)||O.push({command:bn.setBearing,args:[I.bearing]}),s.by(j.pitch,I.pitch)||O.push({command:bn.setPitch,args:[I.pitch]}),s.by(j.sprite,I.sprite)||O.push({command:bn.setSprite,args:[I.sprite]}),s.by(j.glyphs,I.glyphs)||O.push({command:bn.setGlyphs,args:[I.glyphs]}),s.by(j.imports,I.imports)||function(J=[],se=[],re){se=se||[];const oe=(J=J||[]).map(Id),he=se.map(Id),xe=J.reduce(dg,{}),_e=se.reduce(dg,{}),ye=oe.slice();let Le,ke,Re,Ae;for(Le=0,ke=0;Le<oe.length;Le++)Re=oe[Le],_e.hasOwnProperty(Re)?ke++:(re.push({command:bn.removeImport,args:[Re]}),ye.splice(ye.indexOf(Re,ke),1));for(Le=0,ke=0;Le<he.length;Le++)Re=he[he.length-1-Le],ye[ye.length-1-Le]!==Re&&(xe.hasOwnProperty(Re)?(re.push({command:bn.removeImport,args:[Re]}),ye.splice(ye.lastIndexOf(Re,ye.length-ke),1)):ke++,Ae=ye[ye.length-Le],re.push({command:bn.addImport,args:[_e[Re],Ae]}),ye.splice(ye.length-Le,0,Re));for(const Te of se){const $e=xe[Te.id];$e&&(delete $e.data,s.by($e,Te)||re.push({command:bn.updateImport,args:[Te.id,Te]}))}}(j.imports,I.imports,O),s.by(j.transition,I.transition)||O.push({command:bn.setTransition,args:[I.transition]}),s.by(j.light,I.light)||O.push({command:bn.setLight,args:[I.light]}),s.by(j.fog,I.fog)||O.push({command:bn.setFog,args:[I.fog]}),s.by(j.snow,I.snow)||O.push({command:bn.setSnow,args:[I.snow]}),s.by(j.rain,I.rain)||O.push({command:bn.setRain,args:[I.rain]}),s.by(j.projection,I.projection)||O.push({command:bn.setProjection,args:[I.projection]}),s.by(j.lights,I.lights)||O.push({command:bn.setLights,args:[I.lights]}),s.by(j.camera,I.camera)||O.push({command:bn.setCamera,args:[I.camera]}),s.by(j.iconsets,I.iconsets)||function(J,se,re){let oe;for(oe in se=se||{},J=J||{})J.hasOwnProperty(oe)&&(se.hasOwnProperty(oe)||re.push({command:bn.removeIconset,args:[oe]}));for(oe in se){if(!se.hasOwnProperty(oe))continue;const he=se[oe];J.hasOwnProperty(oe)?s.by(J[oe],he)||(re.push({command:bn.removeIconset,args:[oe]}),re.push({command:bn.addIconset,args:[oe,he]})):re.push({command:bn.addIconset,args:[oe,he]})}}(j.iconsets,I.iconsets,O),!s.by(j["color-theme"],I["color-theme"]))return[{command:bn.setStyle,args:[I]}];const U={},q=[];(function(J,se,re,oe){let he;for(he in se=se||{},J=J||{})J.hasOwnProperty(he)&&(se.hasOwnProperty(he)||kv(he,re,oe));for(he in se){if(!se.hasOwnProperty(he))continue;const xe=se[he];J.hasOwnProperty(he)?s.by(J[he],xe)||(J[he].type==="geojson"&&xe.type==="geojson"&&SE(J,se,he)?re.push({command:bn.setGeoJSONSourceData,args:[he,xe.data]}):wE(he,se,re,oe)):Jf(he,se,re)}})(j.sources,I.sources,q,U);const X=[];j.layers&&j.layers.forEach(J=>{J.source&&U[J.source]?O.push({command:bn.removeLayer,args:[J.id]}):X.push(J)});let Z=j.terrain;Z&&U[Z.source]&&(O.push({command:bn.setTerrain,args:[void 0]}),Z=void 0),O=O.concat(q),s.by(Z,I.terrain)||O.push({command:bn.setTerrain,args:[I.terrain]}),function(J,se,re){se=se||[];const oe=(J=J||[]).map(Id),he=se.map(Id),xe=J.reduce(dg,{}),_e=se.reduce(dg,{}),ye=oe.slice(),Le=Object.create(null);let ke,Re,Ae,Te,$e,Ze,Ye;for(ke=0,Re=0;ke<oe.length;ke++)Ae=oe[ke],_e.hasOwnProperty(Ae)?Re++:(re.push({command:bn.removeLayer,args:[Ae]}),ye.splice(ye.indexOf(Ae,Re),1));for(ke=0,Re=0;ke<he.length;ke++)Ae=he[he.length-1-ke],ye[ye.length-1-ke]!==Ae&&(xe.hasOwnProperty(Ae)?(re.push({command:bn.removeLayer,args:[Ae]}),ye.splice(ye.lastIndexOf(Ae,ye.length-Re),1)):Re++,Ze=ye[ye.length-ke],re.push({command:bn.addLayer,args:[_e[Ae],Ze]}),ye.splice(ye.length-ke,0,Ae),Le[Ae]=!0);for(ke=0;ke<he.length;ke++)if(Ae=he[ke],Te=xe[Ae],$e=_e[Ae],!Le[Ae]&&!s.by(Te,$e))if(s.by(Te.source,$e.source)&&s.by(Te["source-layer"],$e["source-layer"])&&s.by(Te.type,$e.type)){for(Ye in ug(Te.layout,$e.layout,re,Ae,null,bn.setLayoutProperty),ug(Te.paint,$e.paint,re,Ae,null,bn.setPaintProperty),s.by(Te.slot,$e.slot)||re.push({command:bn.setSlot,args:[Ae,$e.slot]}),s.by(Te.filter,$e.filter)||re.push({command:bn.setFilter,args:[Ae,$e.filter]}),s.by(Te.minzoom,$e.minzoom)&&s.by(Te.maxzoom,$e.maxzoom)||re.push({command:bn.setLayerZoomRange,args:[Ae,$e.minzoom,$e.maxzoom]}),Te)Te.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?ug(Te[Ye],$e[Ye],re,Ae,Ye.slice(6),bn.setPaintProperty):s.by(Te[Ye],$e[Ye])||re.push({command:bn.setLayerProperty,args:[Ae,Ye,$e[Ye]]}));for(Ye in $e)$e.hasOwnProperty(Ye)&&!Te.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?ug(Te[Ye],$e[Ye],re,Ae,Ye.slice(6),bn.setPaintProperty):s.by(Te[Ye],$e[Ye])||re.push({command:bn.setLayerProperty,args:[Ae,Ye,$e[Ye]]}))}else re.push({command:bn.removeLayer,args:[Ae]}),Ze=ye[ye.lastIndexOf(Ae)+1],re.push({command:bn.addLayer,args:[$e,Ze]})}(X,I.layers,O)}catch(U){console.warn("Unable to compute style diff:",U),O=[{command:bn.setStyle,args:[I]}]}return O}(this.serialize(),o).filter(j=>!(j.command in OE));if(y.length===0)return!1;const w=y.filter(j=>!(j.command in kE));if(w.length>0)throw new Error(`Unimplemented: ${w.map(j=>j.command).join(", ")}.`);const E=[];return y.forEach(j=>{E.push(this[j.command](...j.args))}),f&&Promise.all(E).then(f).catch(f),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[f,y]of o.entries()){if(this.getImage(f))return this.fire(new s.y(new Error(`An image with the name "${f.name}" already exists.`)));this.imageManager.addImage(f,this.scope,y),this._changes.updateImage(f,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(o,f){return this.getImage(o)?this.fire(new s.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,f),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(o,f,y=!1){this.imageManager.updateImage(o,this.scope,f),y&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(o,f,y={}){return this._checkLoaded(),this._validate(Ge,`models.${o}`,f,null,y)||(this.modelManager.addModel(o,f,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,f,y={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(bo,`sources.${o}`,f,null,y))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=Lh(o,f,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const E=j=>{const I=(j?"symbol:":"other:")+w.id,O=s.B(I,this.scope),U=this._sourceCaches[I]=new So(O,w,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=U,U.onAdd(this.map)};E(!1),f.type!=="vector"&&f.type!=="geojson"||E(!0),w.onAdd&&w.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const f=this.getOwnSource(o);if(!f)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===o)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const w=Object.entries(this.stylesheet.iconsets).find(([E,j])=>j.type==="source"&&j.source===o);if(w)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while iconset "${w[0]}" is using it.`)))}const y=this.getOwnSourceCaches(o);for(const w of y){const E=s.dq(w.id);delete this._sourceCaches[E],this._changes.discardSourceCacheUpdate(w.id),w.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,f){this._checkLoaded(),this.getOwnSource(o).setData(f),this._changes.setDirty()}getOwnSource(o){const f=this.getOwnSourceCache(o);return f&&f.getSource()}getOwnSources(){const o=[];for(const f in this._otherSourceCaches){const y=this.getOwnSourceCache(f);y&&o.push(y.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const f in o){const y=o[f]._tiles;for(const w in y){const E=y[w];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const E of o){if(this._validate(kt,"lights",E))return;switch(E.type){case"ambient":if(this.ambientLight){const j=this.ambientLight;j.set(E),j.updateTransitions(f)}else this.ambientLight=new gn(E,Ei(),this.scope,this.options);break;case"directional":if(this.directionalLight){const j=this.directionalLight;j.set(E),j.updateTransitions(f)}else this.directionalLight=new gn(E,ei(),this.scope,this.options)}}const y=Object.assign(f,{worldview:this.map.getWorldview()}),w=new s.ac(this.z||0,y);this.ambientLight&&this.ambientLight.recalculate(w),this.directionalLight&&this.directionalLight.recalculate(w),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,f=this.ambientLight;if(!o||!f)return;const y=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),w=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),E=o.properties.get("intensity"),j=o.properties.get("direction"),I=1-s.d4(j.x,j.y,j.z)[2]/90,O=y(w)*E*I,U=f.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),q=f.properties.get("intensity"),X=y(U)*q;return Number(((O+X)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(s.dr(o)){const f=s.ds(o),y=this.fragments.find(({id:E})=>E===f);if(!y)return;const w=s.dq(o);return y.style.getFragmentStyle(w)}{const f=this.fragments.find(({id:y})=>y===o);return f?f.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const f={},y=(w,E="")=>`${w}::${E}`;this._featuresetSelectors={};for(const w in o){const E=this._featuresetSelectors[w]=[];for(const j of o[w].selectors){if(j.featureNamespace){const O=this.getOwnLayer(j.layer);if(!O){s.w(`Layer is undefined for selector: ${j.layer}`);continue}const U=y(O.source,O.sourceLayer);if(U in f&&f[U]!==j.featureNamespace){s.w(`"featureNamespace ${j.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}f[U]=j.featureNamespace}let I;if(j.properties)for(const O in j.properties){const U=s.U(j.properties[O]);U.result==="success"&&(I=I||{},I[O]=U.value)}E.push({layerId:j.layer,namespace:j.featureNamespace,properties:I,uniqueFeatureID:j._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const f=this.getFragmentStyle(o);if(!f||!f.stylesheet.featuresets)return[];const y=[];for(const w in f.stylesheet.featuresets)y.push({featuresetId:w,importId:f.scope?f.scope:void 0});return y}getFeaturesetLayers(o,f){const y=this.getFragmentStyle(f),w=y.stylesheet.featuresets;if(!w||!w[o])return this.fire(new s.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const E=[];for(const j of w[o].selectors){const I=y.getOwnLayer(j.layer);I&&E.push(I)}return E}getConfigProperty(o,f){const y=this.getFragmentStyle(o);if(!y)return null;const w=s.B(f,y.scope),E=y.options.get(w),j=E?E.value||E.default:null;return j?j.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,f){const y=s.B(o,f);return this._mergedIndoor[y]}setIndoorData(o,f){this.indoorManager.setIndoorData(f)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,f,y){const w=this.getFragmentStyle(o);if(!w)return;const E=w.stylesheet.schema;if(!E||!E[f])return;const j=s.U(y);if(j.result!=="success")return void Fu(this,j.value);const I=j.value.expression,O=s.B(f,w.scope),U=w.options.get(O);if(!U)return;let q;const{minValue:X,maxValue:Z,stepValue:J,type:se,values:re}=E[f],oe=s.U(E[f].default);oe.result==="success"&&(q=oe.value.expression),q?(this.options.set(O,Object.assign({},U,{value:I,default:q,minValue:X,maxValue:Z,stepValue:J,type:se,values:re})),this.updateConfigDependencies(f)):this.fire(new s.y(new Error(`No schema defined for the config option "${f}" in the "${o}" fragment.`)))}getConfig(o){const f=this.getFragmentStyle(o);if(!f)return null;const y=f.stylesheet.schema;if(!y)return null;const w={};for(const E in y){const j=s.B(E,f.scope),I=f.options.get(j),O=I?I.value||I.default:null;w[E]=O?O.serialize():null}return w}setConfig(o,f){const y=this.getFragmentStyle(o);y&&(y.updateConfig(f,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const f=this.getFragmentStyle(o);return f?f.stylesheet.schema:null}setSchema(o,f){const y=this.getFragmentStyle(o);y&&(y.stylesheet.schema=f,y.updateConfig(y._config,f),this.updateConfigDependencies())}updateConfig(o,f){if(this._config=o,o||f)if(f)for(const y in f){let w,E;const j=s.U(f[y].default);if(j.result==="success"&&(w=j.value.expression),o&&o[y]!==void 0){const Z=s.U(o[y]);Z.result==="success"&&(E=Z.value.expression)}const{minValue:I,maxValue:O,stepValue:U,type:q,values:X}=f[y];if(w){const Z=s.B(y,this.scope);this.options.set(Z,{default:w,value:E,minValue:I,maxValue:O,stepValue:U,type:q,values:X})}else this.fire(new s.y(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,f=()=>!0){for(const y of o){const w=this.getLayer(y);w&&f(w)&&(w.possiblyEvaluateVisibility(),this._updateLayer(w),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,f=>!o||f.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(f=>{const y=f._styleColorTheme.colorThemeOverride?f._styleColorTheme.colorThemeOverride:f._styleColorTheme.colorTheme;if(y){const w=f._evaluateColorThemeData(y);(!f._styleColorTheme.lut&&w!==""||f._styleColorTheme.lut&&w!==f._styleColorTheme.lut.data)&&f.setColorTheme(y)}}),this._changes.setDirty()}addLayer(o,f,y={}){this._checkLoaded();const w=o.id;if(this._layers[w])return void this.fire(new s.y(new Error(`Layer with id "${w}" already exists on this map`)));let E;if(o.type==="custom"){if(Fu(this,s.dt(o)))return;E=s.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(w,o.source),o=s.dp(o),o=Object.assign(o,{source:w})),this._validate(Ke,`layers.${w}`,o,{arrayIndex:-1},y))return;E=s.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(E),E.setEventedParent(this,{layer:{id:w}})}const j=s.B(E.source,E.scope);E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(j),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(j);let I=this._order.length;if(f){const X=this._order.indexOf(f);if(X===-1)return void this.fire(new s.y(new Error(`Layer with id "${f}" does not exist on this map.`)));E.slot&&E.slot!==this._layers[f].slot?s.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`):I=X}this._order.splice(I,0,w),this._handleLayerOrderChange(),this._layers[w]=E;const O=this.getOwnLayerSourceCache(E),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&E.canCastShadows()&&U&&(O.castsShadows=!0);const q=this._changes.getRemovedLayer(E);if(q&&E.source&&O&&E.type!=="custom"){this._changes.discardLayerRemoval(E);const X=s.B(E.source,E.scope);q.type!==E.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),O.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),E.scope=this.scope,this.mergeLayers()}moveLayer(o,f){this._checkLoaded();const y=this._checkLayer(o);if(!y||o===f)return;const w=this._order.indexOf(o);this._order.splice(w,1);let E=this._order.length;if(f){const j=this._order.indexOf(f);if(j===-1)return void this.fire(new s.y(new Error(`Layer with id "${f}" does not exist on this map.`)));y.slot&&y.slot!==this._layers[f].slot?s.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`):E=j}this._order.splice(E,0,o),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(o){this._checkLoaded();const f=this._checkLayer(o);if(!f)return;f.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),delete this._layers[o],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(f.fqid),this._indoorDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const w=this.getOwnLayerSourceCache(f);if(w&&w.castsShadows){let E=!1;for(const j in this._layers)if(this._layers[j].source===f.source&&this._layers[j].canCastShadows()){E=!0;break}w.castsShadows=E}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const f in this._layers)if(this._layers[f].type===o)return!0;return!1}setLayerZoomRange(o,f,y){this._checkLoaded();const w=this._checkLayer(o);w&&(w.minzoom===f&&w.maxzoom===y||(f!=null&&(w.minzoom=f),y!=null&&(w.maxzoom=y),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,f){this._checkLoaded();const y=this._checkLayer(o);y&&y.slot!==f&&(y.slot=f,this._updateLayer(y))}setFilter(o,f,y={}){this._checkLoaded();const w=this._checkLayer(o);if(w&&!s.by(w.filter,f))return f==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(ce,`layers.${w.id}.filter`,f,{layerType:w.type},y)||(w.filter=s.dp(f),this._updateLayer(w)))}getFilter(o){const f=this._checkLayer(o);if(f)return s.dp(f.filter)}setLayoutProperty(o,f,y,w={}){this._checkLoaded();const E=this._checkLayer(o);if(E&&!s.by(E.getLayoutProperty(f),y)){if(y!=null&&(!w||w.validate!==!1)&&Fu(E,je.call(ii,{key:`layers.${o}.layout.${f}`,layerType:E.type,objectKey:f,value:y,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;E.setLayoutProperty(f,y),E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E.fqid),this._updateLayer(E)}}setLayerProperty(o,f,y,w={}){this._checkLoaded();const E=this._checkLayer(o);E&&(f==="appearances"?(E.setAppearances(y),this._changes.setDirty()):E.isPaintProperty(f)?this.setPaintProperty(o,f,y,w):this.setLayoutProperty(o,f,y,w))}getLayoutProperty(o,f){const y=this._checkLayer(o);if(y)return y.getLayoutProperty(f)}setPaintProperty(o,f,y,w={}){this._checkLoaded();const E=this._checkLayer(o);if(!E||s.by(E.getPaintProperty(f),y)||y!=null&&(!w||w.validate!==!1)&&Fu(E,me.call(ii,{key:`layers.${o}.paint.${f}`,layerType:E.type,objectKey:f,value:y,styleSpec:s.a6})))return;const j=E.setPaintProperty(f,y);E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E.fqid),j&&this._updateLayer(E),this._changes.updatePaintProperties(E)}getPaintProperty(o,f){const y=this._checkLayer(o);if(y)return y.getPaintProperty(f)}setFeatureState(o,f){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:O,importId:U}=o.target,q=this.getFragmentStyle(U),X=q.getFeaturesetLayers(O);for(const{source:Z,sourceLayer:J}of X)q.setFeatureState({id:o.id,source:Z,sourceLayer:J},f)}else if("layerId"in o.target){const{layerId:O}=o.target,U=this.getLayer(O);this.setFeatureState({id:o.id,source:U.source,sourceLayer:U.sourceLayer},f)}return}const y=o.source,w=o.sourceLayer,E=this._checkSource(y);if(!E)return;const j=E.type;if(j==="geojson"&&w)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(y);for(const O of I)O.setFeatureState(w,o.id,f)}removeFeatureState(o,f){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:O,importId:U}=o.target,q=this.getFragmentStyle(U),X=q.getFeaturesetLayers(O);for(const{source:Z,sourceLayer:J}of X)q.removeFeatureState({id:o.id,source:Z,sourceLayer:J},f)}else if("layerId"in o.target){const{layerId:O}=o.target,U=this.getLayer(O);this.removeFeatureState({id:o.id,source:U.source,sourceLayer:U.sourceLayer},f)}return}const y=o.source,w=this._checkSource(y);if(!w)return;const E=w.type,j=E==="vector"?o.sourceLayer:void 0;if(E==="vector"&&!j)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(y);for(const O of I)O.removeFeatureState(j,o.id,f)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let E;if("featuresetId"in o.target){const{featuresetId:j,importId:I}=o.target,O=this.getFragmentStyle(I),U=O.getFeaturesetLayers(j);for(const{source:q,sourceLayer:X}of U){const Z=O.getFeatureState({id:o.id,source:q,sourceLayer:X});if(Z&&!E)E=Z;else if(!s.by(E,Z))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:j}=o.target,I=this.getLayer(j);E=this.getFeatureState({id:o.id,source:I.source,sourceLayer:I.sourceLayer})}return E}const f=o.source,y=o.sourceLayer,w=this._checkSource(f);if(w){if(w.type!=="vector"||y)return o.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(y,o.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),f=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateFilteredLayers(o){for(const f of Object.values(this._mergedLayers))o(f)&&this._updateLayer(f)}_updateLayer(o){this._changes.updateLayer(o);const f=this.getLayerSourceCache(o),y=s.B(o.source,o.scope),w=this._changes.getUpdatedSourceCaches();o.source&&!w[y]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),f.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const f=I=>this._mergedLayers[I].is3D(!!this.terrain),y=this.order,w={},E=[];for(let I=y.length-1;I>=0;I--){const O=y[I];if(f(O)){w[O]=I;for(const U of o){const q=U[O];if(q)for(const X of q)E.push(X)}}}E.sort((I,O)=>O.intersectionZ-I.intersectionZ);const j=[];for(let I=y.length-1;I>=0;I--){const O=y[I];if(f(O))for(let U=E.length-1;U>=0;U--){const q=E[U].feature;if(q.layer&&w[q.layer.id]<I)break;j.push(q),E.pop()}else for(const U of o){const q=U[O];if(q)for(const X of q)j.push(X.feature)}}return j}queryRasterValue(o,f,y){const w=this.getOwnSource(o);return w?w.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):w.queryRasterArrayValue(f,y):(this.fire(new s.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,f,y){let w;f&&!Array.isArray(f)&&f.filter&&(this._validate(ce,"queryRenderedFeatures.filter",f.filter,null,f),w=s.b6(f.filter));const E={},j=q=>{if(Uv.has(q.type))return;const X=this.getOwnLayerSourceCache(q),Z=E[X.id]=E[X.id]||{sourceCache:X,layers:{},has3DLayers:!1};q.is3D(!!this.terrain)&&(Z.has3DLayers=!0),Z.layers[q.fqid]=Z.layers[q.fqid]||{styleLayer:q,targets:[]},Z.layers[q.fqid].targets.push({filter:w})};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const q of f.layers){const X=this._layers[q];if(!X)return this.fire(new s.y(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];j(X)}}else for(const q in this._layers)j(this._layers[q]);const I=this._queryRenderedFeatures(o,E,y),O=this._flattenAndSortRenderedFeatures(I),U=[];for(const q of O)s.dw(q.layer.id)===this.scope&&U.push(q);return U}queryRenderedFeatureset(o,f,y){let w;f&&!Array.isArray(f)&&f.filter&&(this._validate(ce,"queryRenderedFeatures.filter",f.filter,null,f),w=s.b6(f.filter));const E="mock",j=[];if(f&&f.target)j.push(Object.assign({},f,{targetId:E,filter:w}));else{const q=this.getFeaturesetDescriptors();for(const X of q)j.push({targetId:E,filter:w,target:X});for(const{style:X}of this.fragments){const Z=X.getFeaturesetDescriptors();for(const J of Z)j.push({targetId:E,filter:w,target:J})}}const I=this.queryRenderedTargets(o,j,y),O=[],U=new Set;for(const q of I)for(const X of q.variants[E])sg(X,q,U)||O.push(new s.dx(q,X));return O}queryRenderedTargets(o,f,y){const w={},E=(I,O,U,q)=>{const X=w[O.id]=w[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(X.layers[I.fqid]=X.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(X.has3DLayers=!0),!q)return U.uniqueFeatureID=!1,void X.layers[I.fqid].targets.push(U);X.layers[I.fqid].targets.push(Object.assign({},U,{namespace:q.namespace,properties:q.properties,uniqueFeatureID:q.uniqueFeatureID}))};for(const I of f)if("featuresetId"in I.target){const{featuresetId:O,importId:U}=I.target,q=this.getFragmentStyle(U);if(!q||!q._featuresetSelectors)continue;const X=q._featuresetSelectors[O];if(!X){this.fire(new s.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Z of X){const J=q.getOwnLayer(Z.layerId);J&&!Uv.has(J.type)&&E(J,q.getOwnLayerSourceCache(J),I,Z)}}else if("layerId"in I.target){const{layerId:O}=I.target,U=this.getLayer(O);if(!U||Uv.has(U.type))continue;E(U,this.getLayerSourceCache(U),I)}const j=this._queryRenderedFeatures(o,w,y);return this._flattenAndSortRenderedFeatures(j)}_queryRenderedFeatures(o,f,y){const w=[],E=!!this.map._showQueryGeometry,j=Ui.createFromScreenPoints(o,y);for(const I in f){const O=ag(j,f[I],this._availableImages,y,E,this.getActualScope());Object.keys(O).length&&w.push(O)}if(this.placement)for(const I in f){if(!f[I].sourceCache._onlySymbols)continue;const O=vE(j.screenGeometry,f[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&w.push(O)}return w}querySourceFeatures(o,f){const y=f&&f.filter;y&&this._validate(ce,"querySourceFeatures.filter",y,null,f);let w=[];const E=this.getOwnSourceCaches(o);for(const j of E)w=w.concat(_E(j,f));return w}addSourceType(o,f,y){return Ho.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(Ho.setSourceType(o,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:f.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,f,y={}){this._checkLoaded();const w=this.light.getLight();let E=!1;for(const I in o)if(!s.by(o[I],w[I])){E=!0;break}if(!E)return;const j=this._getTransitionParameters();this.light.setLight(o,f,y),this.light.updateTransitions(j)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,f=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=o;const w=!("source"in o)||o.source==null;if(f===1){if(this.disableElevatedTerrain)return;if("source"in y&&typeof y.source=="object"){const I="terrain-dem-src";this.addSource(I,y.source),y=s.dp(y),y=Object.assign(y,{source:I})}const E=Object.assign({},y),j={};if(this.terrain&&w){E.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(j.style=I.serialize())}if(this._validate(Ba,"terrain",E,j))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&f!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,f),this.fire(new s.z("data",{dataType:"style"}))}else{const E=this.terrain,j=E.get();for(const I of Object.keys(s.a6.terrain))!y.hasOwnProperty(I)&&s.a6.terrain[I].default&&(y[I]=s.a6.terrain[I].default);for(const I in o)if(!s.by(o[I],j[I])){E.set(o,this.options),this.stylesheet.terrain=o;const O=this._getTransitionParameters({duration:0});E.updateTransitions(O),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const f=this.fog=new Nr(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_createSnow(o){const f=this.snow=new Hi(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_createRain(o){const f=this.rain=new xi(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!s.by(f.get(),o)){f.set(o,this.options),this.stylesheet.fog=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const f=this.snow;if(!s.by(f.get(),o)){f.set(o,this.options),this.stylesheet.snow=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const f=this.rain;if(!s.by(f.get(),o)){f.set(o,this.options),this.stylesheet.rain=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!f)return this._styleColorTheme.lut=null,void o();const y=this._evaluateColorThemeData(f);this._loadColorTheme(y).then(()=>{this.fire(new s.z("colorthemeset")),o()}).catch(w=>{s.w(`Couldn't set color theme: ${w}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,f){const y=this.getFragmentStyle(o);y&&(y._styleColorTheme.colorThemeOverride=f,y._reloadColorTheme())}_getTransitionParameters(o){return{now:s.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],f=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?o.push(y):f.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...f)}_createTerrain(o,f){const y=this.terrain=new Nt(o,f,this.scope,this.options,this.map.getWorldview());f===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});y.updateTransitions(w)}_force3DLayerUpdate(){for(const o in this._layers){const f=this._layers[o];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const f=this._layers[o];f.type==="symbol"&&this._updateLayer(f)}}_validate(o,f,y,w,E={}){if(E&&E.validate===!1)return!1;const j=Object.assign({},this.serialize());return Fu(this,o.call(ii,Object.assign({key:f,style:j,value:y,styleSpec:s.a6},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const f=this.getSourceCaches(o);for(const y of f)y.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const f=this._mergedLayers[o];f._clear&&f._clear()}}reloadSource(o){const f=this.getSourceCaches(o);for(const y of f)y.resume(),y.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let f;this.directionalLight&&(f=PE(this.directionalLight));const y=new Set,w=new Set;for(const E in this._mergedLayers){const j=this._mergedLayers[E];j.type==="building"&&y.add(j.source),j.hasElevation()&&!w.has(j.source)&&w.add(j.source)}for(const E in this._mergedSourceCaches){const j=this._mergedSourceCaches[E],I=w.has(j._source.id);y.has(j._source.id)&&(j._source.reparseOverscaled=!1),j.update(o,void 0,void 0,f,I)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const f=this._sourceCaches[o];f.resume(),f.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Ub),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(o,f,y,w,E){this.pauseablePlacement||(this.pauseablePlacement=new Ub);let j=!1,I=!1;const O={},U={};for(const re of this._mergedOrder){const oe=this._mergedLayers[re];if(oe.type!=="symbol")continue;const he=s.B(oe.source,oe.scope);let xe=O[he];if(!xe){const ye=this.getLayerSourceCache(oe);if(!ye)continue;const Le=ye.getRenderableIds(!0).map(ke=>ye.getTileByID(ke));U[he]=Le.slice(),xe=O[he]=Le.sort((ke,Re)=>Re.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Re.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(oe,xe,o.center.lng,o.projection);j=j||_e}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const q=!!(this.placement&&!o.equals(this.placement.transform)),X=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),Z=q||X||j,J=(Z||this.pauseablePlacement.isStale())&&y===0,se=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),o.zoom)&&y!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||J||se)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(o,this._mergedOrder,f,y,w,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?Z&&y!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),j&&this.pauseablePlacement.setStale()),I||j){this._buildingIndex.onNewFrame(o.zoom);for(let re=0;re<this._mergedOrder.length;re++){const oe=this._mergedLayers[this._mergedOrder[re]];if(oe.type!=="symbol"||oe.visibility==="none")continue;const he=this.isLayerClipped(oe);this.placement.updateLayerOpacities(oe,O[s.B(oe.source,oe.scope)],re,he?E:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,f){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:E})=>E===o.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!f)return y.push(o),this._loadImports([o],!0);const w=y.findIndex(({id:E})=>E===f);return w===-1&&this.fire(new s.y(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,w).concat(o).concat(y.slice(w)),this._loadImports([o],!0,f)}updateImport(o,f){this._checkLoaded();const y=this.stylesheet.imports||[],w=this.getImportIndex(o);return w===-1?this:typeof f=="string"?(this.setImportUrl(o,f),this):(f.url&&f.url!==y[w].url&&this.setImportUrl(o,f.url),s.by(f.config,y[w].config)||this.setImportConfig(o,f.config,f.data.schema),s.by(f.data,y[w].data)||this.setImportData(o,f.data),this)}moveImport(o,f){this._checkLoaded();let y=this.stylesheet.imports||[];const w=this.getImportIndex(o);if(w===-1)return this;const E=this.getImportIndex(f);if(E===-1)return this;const j=y[w],I=this.fragments[w];return y=y.filter(({id:O})=>O!==o),this.fragments=this.fragments.filter(({id:O})=>O!==o),this.stylesheet.imports=y.slice(0,E).concat(j).concat(y.slice(E)),this.fragments=this.fragments.slice(0,E).concat(I).concat(this.fragments.slice(E)),this.mergeLayers(),this}setImportUrl(o,f){this._checkLoaded();const y=this.stylesheet.imports||[],w=this.getImportIndex(o);if(w===-1)return this;y[w].url=f;const E=this.fragments[w];return E.style=this._createFragmentStyle(y[w]),E.style.on("style.import.load",()=>this.mergeAll()),E.style.loadURL(f),this}setImportData(o,f){this._checkLoaded();const y=this.getImportIndex(o),w=this.stylesheet.imports||[];return y===-1?this:f?(this.fragments[y].style.setState(f),this._reloadImports(),this):(delete w[y].data,this.setImportUrl(o,w[y].url))}setImportConfig(o,f,y){this._checkLoaded();const w=this.getImportIndex(o),E=this.stylesheet.imports||[];if(w===-1)return this;f?E[w].config=f:delete E[w].config;const j=this.fragments[w];y&&j.style.stylesheet&&(j.style.stylesheet.schema=y);const I=j.style.stylesheet&&j.style.stylesheet.schema;return j.config=f,j.style.updateConfig(f,I),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(o);y!==-1&&(f.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(o){const f=(this.stylesheet.imports||[]).findIndex(y=>y.id===o);return f===-1&&this.fire(new s.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),f}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const f in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[f];y&&o.push(y.getSource())}return o}getSource(o,f){const y=this.getSourceCache(o,f);return y&&y.getSource()}getLayerSource(o){const f=this.getLayerSourceCache(o);return f&&f.getSource()}getSourceCache(o,f){const y=s.B(o,f);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(o){const f=s.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[o]&&f.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&f.push(this._mergedSymbolSourceCaches[o]),f}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const f in o){const y=o[f];y==="reload"?this.reloadSource(f):y==="clear"&&this.clearSource(f)}}updateLayers(o){const f=this._changes.getUpdatedPaintProperties();for(const y of f){const w=this.getLayer(y);w&&w.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,f,y){this.imageManager.getImages(f.images,f.scope,y),this._updateTilesForChangedImages();const w=j=>{if(j){const I=f.images.map(O=>s.I.toString(O));j.setDependencies(f.tileID.key,f.type,I)}},E=s.B(f.source,f.scope);w(this._mergedOtherSourceCaches[E]),w(this._mergedSymbolSourceCaches[E]),f.images.some(j=>j.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(o,f,y){this.imageManager.rasterizeImages(f,y)}getGlyphs(o,f,y){this.glyphManager.getGlyphs(f.stacks,y)}getResource(o,f,y){return s.dz(f,y)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const f=[];return this._otherSourceCaches[o]&&f.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&f.push(this._symbolSourceCaches[o]),f}_isSourceCacheLoaded(o){const f=this.getOwnSourceCaches(o);return f.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${o}'`))),!1):f.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,f){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const y=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),w=o.type==="building";if(o.is3D(!!this.terrain)){if(y||w||f&&f.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ho.getSourceType=function(g){return ku[g]},Ho.setSourceType=function(g,o){ku[g]=o},Ho.registerForPluginStateChange=s.dA;var Xb=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Kb=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ip=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,sp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Yb=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,qv=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_l=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_g=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Wt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Jb=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Qb=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const xg=/#include\s+"([^"]+)"/g,Jc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,ew=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Vh=new Set(["ifdef","ifndef","elif","if","defined"]),Uh=new Set;Fd(Xb,Uh),Fd(ip,Uh),Fd(Kb,Uh);const Ld={"_prelude_fog.vertex.glsl":qv,"_prelude_terrain.vertex.glsl":Yb,"_prelude_shadow.vertex.glsl":Jb,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":_l,"_prelude_shadow.fragment.glsl":Qb,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":_g,"_prelude_raster_particle.glsl":Wt},Gv={};mn("",Yb),mn(_l,qv),mn(Qb,Jb),mn(_g,""),mn(Wt,"");const RE=mn(Kb,ip),Wv=Xb,vO=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Wv,RE.fragmentSource].join(`
`),ME=["precision highp float;",Wv,RE.vertexSource].join(`
`);var tw={background:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:mn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:mn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:mn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:mn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:mn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:mn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:mn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:mn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:mn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:mn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:mn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:mn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sp),skyboxGradient:mn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sp),skyboxCapture:mn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:mn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:mn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:mn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:mn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:mn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Fd(g,o){const f=g.split(`
`);for(let y of f){if(y=y.trimStart(),y[0]!=="#"||!y.includes("if")||y.startsWith("#endif"))continue;const w=y.match(ew);if(w)for(const E of w)Vh.has(E)||o.add(E)}}function mn(g,o){const f=new Set,y=[],w=[];g=g.replace(xg,(j,I)=>(w.push(I),"")),o=o.replace(xg,(j,I)=>(y.push(I),""));let E=new Set(Uh);Fd(g,E),Fd(o,E);for(const j of[...y,...w])Gv[j]||(Gv[j]=new Set,Fd(Ld[j],Gv[j])),E=new Set([...E,...Gv[j]]);return{fragmentSource:g=g.replace(Jc,(j,I,O,U,q)=>(f.add(q),I==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${O} ${U} ${q};
#else
uniform ${O} ${U} u_${q};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${O} ${U} ${q} = u_${q};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${O} ${U} ${q};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(Jc,(j,I,O,U,q)=>{const X=`MATERIAL_ATTRIBUTE_OFFSET_${q}`,Z=U==="float"?"vec2":U,J=`GET_ATTRIBUTE_${Z}(a_${q}, materialInfo, ${X})`,se=q.match(/color/)?"color":Z;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${O} ${U} a_${q};
#endif
`:f.has(q)?I==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
    #if !defined(${X})
        in ${O} ${Z} a_${q};
    #endif
out ${O} ${U} ${q};
#else
uniform ${O} ${U} u_${q};
#endif
`:I==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${O} ${U} ${q} = u_${q};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${q})
    #ifdef ${X}
        ${q} = unpack_mix_${se}(${J}, u_${q}_t);
    #else
        ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
    #endif
#else
    ${O} ${U} ${q} = u_${q};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${O} ${U} a_${q};
    out ${O} ${U} ${q};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
    #if !defined(${X})
        in ${O} ${Z} a_${q};
    #endif
#else
uniform ${O} ${U} u_${q};
#endif
`:I==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${O} ${U} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${Z} a_${q};
#else
uniform ${O} ${U} u_${q};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${O} ${U} ${q} = a_${q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    #ifdef ${X}
        ${O} ${U} ${q} = ${J};
    #else
        ${O} ${U} ${q} = a_${q};
    #endif
#else
    ${O} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    #ifdef ${X}
        ${O} ${U} ${q} = unpack_mix_${se}(${J}, u_${q}_t);
    #else
        ${O} ${U} ${q} = unpack_mix_${se}(a_${q}, u_${q}_t);
    #endif
#else
    ${O} ${U} ${q} = u_${q};
#endif
`}),usedDefines:E,vertexIncludes:y,fragmentIncludes:w}}class _O{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,f,y,w,E,j,I,O){this.context=o;let U=this.boundPaintVertexBuffers.length!==w.length;for(let X=0;!U&&X<w.length;X++)this.boundPaintVertexBuffers[X]!==w[X]&&(U=!0);let q=this.boundDynamicVertexBuffers.length!==I.length;for(let X=0;!q&&X<I.length;X++)this.boundDynamicVertexBuffers[X]!==I[X]&&(q=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||U||q||this.boundIndexBuffer!==E||this.boundVertexOffset!==j)this.freshBind(f,y,w,E,j,I,O);else{o.bindVertexArrayOES.set(this.vao);for(const X of I)X&&(X.bind(),O&&X.instanceCount&&X.setVertexAttribDivisor(o.gl,f,O));E&&E.dynamicDraw&&E.bind()}}freshBind(o,f,y,w,E,j,I){const O=this.context,U=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=w,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=j,f.enableAttributes(U,o),f.bind(),f.setVertexAttribPointers(U,o,E);for(const q of y)q.enableAttributes(U,o),q.bind(),q.setVertexAttribPointers(U,o,E);for(const q of j)q&&(q.enableAttributes(U,o),q.bind(),q.setVertexAttribPointers(U,o,E),I&&q.instanceCount&&q.setVertexAttribDivisor(U,o,I));w&&w.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xO(g,o){const f=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new s.ae(0,y/f).toLngLat().lat,new s.ae(0,(y+1)/f).toLngLat().lat]}function bO(g,o,f,y,w,E,j){const I=g.context,O=I.gl,U=f.hillshadeFBO;if(!U)return;g.prepareDrawTile();const q=g.isTileAffectedByFog(o),X=[];g.terrain&&g.terrain.renderingToTexture&&g.emissiveMode==="mrt-fallback"&&X.push("USE_MRT1");const Z=g.getOrCreateProgram("hillshade",{overrideFog:q,defines:X});I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,U.colorAttachment0.get());const J=((he,xe,_e,ye)=>{const Le=_e.paint.get("hillshade-shadow-color"),ke=_e.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Re=_e.paint.get("hillshade-highlight-color"),Ae=_e.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=_e.paint.get("hillshade-accent-color"),$e=_e.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ze=_e.paint.get("hillshade-emissive-strength");let Ye=s.an(_e.paint.get("hillshade-illumination-direction"));if(_e.paint.get("hillshade-illumination-anchor")==="viewport")Ye-=he.transform.angle;else if(he.style&&he.style.enable3dLights()&&he.style.directionalLight){const tt=he.style.directionalLight.properties.get("direction"),vt=s.d4(tt.x,tt.y,tt.z);Ye=s.an(vt[1])}const it=!he.options.moving;return{u_matrix:ye||he.transform.calculateProjMatrix(xe.tileID.toUnwrapped(),it),u_image:0,u_latrange:xO(0,xe.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),Ye],u_shadow:Le.toPremultipliedRenderColor(ke?null:_e.lut),u_highlight:Re.toPremultipliedRenderColor(Ae?null:_e.lut),u_emissive_strength:Ze,u_accent:Te.toPremultipliedRenderColor($e?null:_e.lut)}})(g,f,y,g.terrain?o.projMatrix:null);g.uploadCommonUniforms(I,Z,o.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:re,tileBoundsSegments:oe}=g.getTileBoundsBuffers(f);Z.draw(g,O.TRIANGLES,w,E,j,Ar.disabled,J,y.id,se,re,oe)}function rw(g,o,f){if(!o.needsDEMTextureUpload)return;const y=g.context,w=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(f.stride);const E=f.getPixels();o.demTexture?o.demTexture.update(E,{premultiply:!1}):o.demTexture=new s.T(y,E,w.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function wO(g,o,f){const y=g.context,w=y.gl;if(!o.dem)return;const E=o.dem;if(y.activeTexture.set(w.TEXTURE1),rw(g,o,E),!o.demTexture)return;o.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const j=E.dim;y.activeTexture.set(w.TEXTURE0);let I=o.hillshadeFBO;if(!I){const Z=new s.T(y,{width:j,height:j,data:null},w.RGBA8);Z.bind(w.LINEAR,w.CLAMP_TO_EDGE),I=o.hillshadeFBO=y.createFramebuffer(j,j,1,"renderbuffer"),I.colorAttachment0.set(Z.texture)}y.bindFramebuffer.set(I.framebuffer),y.viewport.set([0,0,j,j]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=g.getMercatorTileBoundsBuffers(),X=[];g.linearFloatFilteringSupported()&&X.push("TERRAIN_DEM_FLOAT_FORMAT"),g.terrain&&g.terrain.renderingToTexture&&g.emissiveMode==="mrt-fallback"&&X.push("USE_MRT1"),g.getOrCreateProgram("hillshadePrepare",{defines:X}).draw(g,w.TRIANGLES,dr.disabled,Ir.disabled,Lr.unblended,Ar.disabled,((Z,J)=>{const se=J.stride,re=s.bC();return s.ce(re,0,s.al,-s.al,0,0,1),s.br(re,re,[0,-s.al,0]),{u_matrix:re,u_image:1,u_dimension:[se,se],u_zoom:Z.overscaledZ}})(o.tileID,E),f.id,O,U,q),o.needsHillshadePrepare=!1}class gi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class SO extends gi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class DE extends gi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class nw extends gi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Hv extends gi{getDefault(){return[!0,!0,!0,!0]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class iw extends gi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class qh extends gi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ap extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const f=this.current;(o.func!==f.func||o.ref!==f.ref||o.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class bg extends gi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class op extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=o,this.dirty=!1}}class LE extends gi{getDefault(){return[0,1]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class sw extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=o,this.dirty=!1}}class FE extends gi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class lp extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.BLEND):f.disable(f.BLEND),this.current=o,this.dirty=!1}}class Zv extends gi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Xv extends gi{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const f=this.current;(o.r!==f.r||o.g!==f.g||o.b!==f.b||o.a!==f.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class aw extends gi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Kv extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;o?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=o,this.dirty=!1}}class wg extends gi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class zE extends gi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let BE=class extends gi{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class $E extends gi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class cp extends gi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const f=this.current;(o[0]!==f[0]||o[1]!==f[1]||o[2]!==f[2]||o[3]!==f[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class VE extends gi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class TO extends gi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class EO extends gi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class jO extends gi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ow extends gi{getDefault(){return null}set(o){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class lw extends gi{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class cw extends gi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class uw extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class UE extends gi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Yv extends gi{constructor(o,f){super(o),this.context=o,this.parent=f}getDefault(){return null}}class Jv extends Yv{constructor(o,f,y=0){super(o,f),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+y}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachmentPoint,f.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class up extends Yv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Sg extends Yv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class qE extends up{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const xl=(g,o,f,y)=>({u_matrix:g,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:f,u_emissive_texture_available:y}),Qv=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:f,u_zoom_transition:w,u_merc_center:E,u_image0:0,u_image1:1,u_frustum_tl:j,u_frustum_tr:I,u_frustum_br:O,u_frustum_bl:U,u_globe_pos:q,u_globe_radius:X,u_viewport:Z,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:J,u_far_z_cutoff:se,u_emissive_texture_available:re});function Tg(g,o){return g!=null&&o!=null&&!(!g.hasData()||!o.hasData())&&g.demTexture!=null&&o.demTexture!=null&&g.tileID.key!==o.tileID.key}const zu=new class{constructor(){this.operations={}}newMorphing(g,o,f,y,w){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==f.tileID.key&&(E.queued=f)}else this.operations[g]={startTime:y,phase:0,duration:w,from:o,to:f,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const o=this.operations[g];return{from:o.from,to:o.to,phase:o.phase}}update(g){for(const o in this.operations){const f=this.operations[o];for(f.phase=(g-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,g)){delete this.operations[o];break}}}_nextOp(g,o){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=o,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},e_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function t_(g,o,f){if(o===0)return 0;const y=o<1&&f===514?.25/o:1;return 6*Math.pow(1.5,22-g)*Math.max(o,1)*y}function dw(g,o){const f=1<<g.z;return!o&&(g.x===0||g.x===f-1)||g.y===0||g.y===f-1}function dp(g,o){if(!g.style||!g.style.enable3dLights())return;const f=g.context,y=f.gl;f.activeTexture.set(y.TEXTURE1),o?o.bind(y.LINEAR,y.CLAMP_TO_EDGE):g.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)}const Eg=g=>({u_matrix:g});function jg(g,o,f,y,w){if(w>0){const E=s.o.now(),j=(E-g.timeAdded)/w,I=o?(E-o.timeAdded)/w:-1,O=f.getSource(),U=y.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),q=!o||Math.abs(o.tileID.overscaledZ-U)>Math.abs(g.tileID.overscaledZ-U),X=q&&g.refreshedUponExpiration?1:s.aA(q?j:1-I,0,1);return o?{opacity:1,mix:1-X,isFading:j<1}:{opacity:X,mix:0,isFading:j<1}}return{opacity:1,mix:0,isFading:!1}}class r_ extends So{constructor(o){const f=Lh("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,f){o.state="loaded",f(null)}}class hw extends So{constructor(o){const f=Lh("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,f,y){if(o.freezeTileCoverage)return;this.transform=o;const w=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,j)=>{if(E[j.key]="",!this._tiles[j.key]){const I=new Nd(j,this._source.tileSize*j.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[j.key]=I}return E},{});for(const E in this._tiles)E in w||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(o){const f=this.proxyCachedFBO[o];if(f!==void 0){const y=Object.values(f);this.renderCachePool.push(...y),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class fw extends s.aQ{constructor(o,f,y){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=f,this.projMatrix=y}}class pw extends s.bV{constructor(o,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,w,E]=function(){const O=new s.bd,U=new s.b0,q=131;O.reserve(17161),U.reserve(33800);const X=s.al/128,Z=s.al+X/2,J=Z+X;for(let re=-X;re<J;re+=X)for(let oe=-X;oe<J;oe+=X){const he=oe<0||oe>Z||re<0||re>Z?24575:0,xe=s.aA(Math.round(oe),0,s.al),_e=s.aA(Math.round(re),0,s.al);O.emplaceBack(xe+he,_e)}const se=(re,oe)=>{const he=oe*q+re;U.emplaceBack(he+1,he,he+q),U.emplaceBack(he+q,he+q+1,he+1)};for(let re=1;re<129;re++)for(let oe=1;oe<129;oe++)se(oe,re);return[0,129].forEach(re=>{for(let oe=0;oe<130;oe++)se(oe,re),se(re,oe)}),[O,U,32768]}(),j=o.context;this.gridBuffer=j.createVertexBuffer(y,s.bf.members),this.gridIndexBuffer=j.createIndexBuffer(w),this.gridSegments=s.bg.simpleSegment(0,0,y.length,w.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,y.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hw(f.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=j.gl;this._overlapStencilMode=new Ir({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new r_(f.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,f,y){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const w=o.terrain.properties,E=o.terrain.drapeRenderMode===0,j=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=o.terrain&&o.terrain.scope,O=w.get("source"),U=E?this._mockSourceCache:o.getSourceCache(O,I);if(!U)return void s.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=U,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=j?this.calculateExaggeration(f):w.get("exaggeration"),!f.projection.requiresDraping&&j&&this._exaggeration===0)return void this._disable();this.enabled=!0;const q=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const X=this.getScaledDemTileSize();this.sourceCache.update(f,X,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,q(),this._initializing=!0),q(),f.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const f=this._previousCameraAltitude,y=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=y;const w=f!=null?y-f:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const E=o.zoom,j=this._style.terrain;if(!this._previousUpdateTimestamp)return j.getExaggeration(E);let I=E-this._previousZoom;const O=this._previousUpdateTimestamp;let U=E;this._evaluationZoom!=null&&(U=this._evaluationZoom,Math.abs(E-U)>.5&&(I=.5*(E-U+I)),I*w<0&&(U+=I)),this._evaluationZoom=U;const q=j.getExaggeration(U),X=q===j.getExaggeration(Math.max(0,U-.1));if(X&&Math.abs(q-this._exaggeration)<.01)return q;let Z=Math.min(.1,.00375*(this._updateTimestamp-O));return(X||q<.1||Math.abs(I)<1e-4)&&(Z=Math.min(.2,4*Z)),s.ak(this._exaggeration,q,Z)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=f.getIds().map(O=>{const U=f.getTileByID(O).tileID;return U.projMatrix=y.calculateProjMatrix(U.toUnwrapped()),U});(function(O,U){const q=U.transform.pointCoordinate(U.transform.getCameraPoint()),X=new s.P(q.x,q.y);O.sort((Z,J)=>{if(J.overscaledZ-Z.overscaledZ)return J.overscaledZ-Z.overscaledZ;const se=new s.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),re=new s.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),oe=X.mult(1<<Z.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(se)-oe.distSqr(re)})})(w,this.painter);const E=this.proxyToSource||{};this.proxyToSource={},w.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const j=this._style._mergedSourceCaches;for(const O in j){const U=j[O];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,o[O],E),U.usedForTerrain))continue;const q=o[O];U.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[f.id]=w.map(O=>new fw(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const U=this.terrainTileForTile[O.key];if(!U)continue;const q=U.tileID.key;q in I||(this._visibleDemTiles.push(U),I[q]=q)}}_assignTerrainTiles(o){this._initializing||o.forEach(f=>{if(this.terrainTileForTile[f.key])return;const y=this._findTileCoveringTileID(f,this.sourceCache);y&&(this.terrainTileForTile[f.key]=y)})}_prepareDEMTextures(){const o=this.painter.context,f=o.gl;for(const y in this.terrainTileForTile){const w=this.terrainTileForTile[y],E=w.dem;!E||w.demTexture&&!w.needsDEMTextureUpload||(o.activeTexture.set(f.TEXTURE1),rw(this.painter,w,E))}}_prepareDemTileUniforms(o,f,y,w){if(!f||f.demTexture==null)return!1;const E=o.tileID.canonical,j=Math.pow(2,f.tileID.canonical.z-E.z),I=w||"";return y[`u_dem_tl${I}`]=[E.x*j%1,E.y*j%1],y[`u_dem_scale${I}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const f=this._visibleDemTiles.reduce((y,w)=>{if(!w.dem)return y;const E=w.dem.tree.minimums[0];return E>0&&o++,y+E},0);return o?f/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,f=o.gl;o.activeTexture.set(f.TEXTURE2);const y=this._getLoadedAreaMinimum(),w=new s.dL({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(w,{premultiply:!1}):E=this._emptyDEMTexture=new s.T(o,w,f.R32F,{premultiply:!1}),E}setupElevationDraw(o,f,y){const w=this.painter.context,E=w.gl,j={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};j.u_exaggeration=this.exaggeration();let I=null,O=null,U=1;if(y&&y.morphing&&this._useVertexMorphing){const J=y.morphing.srcDemTile,se=y.morphing.dstDemTile;U=y.morphing.phase,J&&se&&(this._prepareDemTileUniforms(o,J,j,"_prev")&&(O=J),this._prepareDemTileUniforms(o,se,j)&&(I=se))}const q=J=>J&&J.demTexture&&this.painter.linearFloatFilteringSupported()?E.LINEAR:E.NEAREST;let X=null;var Z;if(this.enabled?O&&I?(X=I.demTexture,w.activeTexture.set(E.TEXTURE4),O.demTexture.bind(q(O),E.CLAMP_TO_EDGE),j.u_dem_lerp=U):(I=this.terrainTileForTile[o.tileID.key],X=this._prepareDemTileUniforms(o,I,j)?I.demTexture:this.emptyDEMTexture):X=this.emptyDEMTexture,w.activeTexture.set(E.TEXTURE2),X&&(j.u_dem_size=(Z=X).size[0]===1?1:Z.size[0]-2,X.bind(q(I),E.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,f,j),y&&y.useMeterToDem&&I){const J=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=J}if(y&&y.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),f.setTerrainUniformValues(w,j),this.painter.transform.projection.name==="globe"){const J=this.globeUniformValues(this.painter.transform,o.tileID.canonical,y&&y.useDenormalizedUpVectorScale);f.setGlobeUniformValues(w,J)}}globeUniformValues(o,f,y){const w=o.projection;return{u_tile_tl_up:w.upVector(f,0,0),u_tile_tr_up:w.upVector(f,s.al,0),u_tile_br_up:w.upVector(f,s.al,s.al),u_tile_bl_up:w.upVector(f,0,s.al),u_tile_up_scale:y?s.dM(1):w.upVectorScale(f,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const f=this.painter,y=this.painter.context;o.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,E,j,I,O){if(w.transform.projection.name==="globe")(function(U,q,X,Z,J){const se=U.context,re=se.gl;let oe,he;const xe=U.transform,_e=s.dE(U,se,xe),ye=(it,tt)=>{if(he===tt)return;const vt=[e_[tt],"PROJECTION_GLOBE_VIEW"];_e&&vt.push("CUSTOM_ANTIALIASING");const At=U.isTileAffectedByFog(it);oe=U.getOrCreateProgram("globeRaster",{defines:vt,overrideFog:At}),he=tt},Le=U.colorModeForRenderPass(),ke=new dr(re.LEQUAL,dr.ReadWrite,U.depthRangeFor3D);zu.update(J);const Re=s.dF(xe),Ae=[s.aF(xe.center.lng),s.aJ(xe.center.lat)],Te=U.globeSharedBuffers,$e=[xe.width*s.o.devicePixelRatio,xe.height*s.o.devicePixelRatio],Ze=Float32Array.from(xe.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};{const it=U.transform,tt=t_(it.zoom,q.exaggeration(),q.sourceCache._source.tileSize);he=-1;const vt=re.TRIANGLES;for(const At of Z){const et=X.getTile(At),Ue=Ir.disabled,ft=q.prevTerrainTileForTile[At.key],st=q.terrainTileForTile[At.key];Tg(ft,st)&&zu.newMorphing(At.key,ft,st,J,250),dp(U,et.emissiveTexture),se.activeTexture.set(re.TEXTURE0),et.texture&&et.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const It=zu.getMorphValuesForProxy(At.key),Mt=It?1:0;It&&Object.assign(Ye,{morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:s.dD(It.phase)}});const Zt=s.dG(At.canonical),Dt=s.dH(Zt.getCenter().lat),$t=s.dI(At.canonical,Zt,Dt,it.worldSize/it._pixelsPerMercatorPixel),lr=s.bk(s.dJ(At.canonical)),or=U.emissiveMode==="mrt-fallback"?1:0,Jt=Qv(it.expandedFarZProjMatrix,Ze,Re,lr,s.aj(it.zoom),Ae,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,$e,tt,it._farZ,or,$t);if(ye(At,Mt),oe&&(q.setupElevationDraw(et,oe,Ye),U.uploadCommonUniforms(se,oe,At.toUnwrapped()),Te)){const[sr,vr,Cr]=Te.getGridBuffers(Dt,tt!==0);oe.draw(U,vt,ke,Ue,Le,Ar.backCCW,Jt,"globe_raster",sr,vr,Cr)}}}if(Te&&(U.renderDefaultNorthPole||U.renderDefaultSouthPole)){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&it.push("CUSTOM_ANTIALIASING"),oe=U.getOrCreateProgram("globeRaster",{defines:it});for(const tt of Z){const{x:vt,y:At,z:et}=tt.canonical,Ue=At===0,ft=At===(1<<et)-1,[st,It,Mt,Zt]=Te.getPoleBuffers(et,!1);if(Zt&&(Ue||ft)){const Dt=X.getTile(tt);dp(U,Dt.emissiveTexture),se.activeTexture.set(re.TEXTURE0),Dt.texture&&Dt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let $t=s.dK(et,vt,xe);const lr=s.bk(s.dJ(tt.canonical)),or=U.emissiveMode==="mrt-fallback"?1:0,Jt=(sr,vr)=>sr.draw(U,re.TRIANGLES,ke,Ir.disabled,Le,Ar.disabled,Qv(xe.expandedFarZProjMatrix,$t,$t,lr,0,Ae,xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.globeCenterInViewSpace,xe.globeRadius,$e,0,xe._farZ,or),"globe_pole_raster",vr,Mt,Zt);q.setupElevationDraw(Dt,oe,Ye),U.uploadCommonUniforms(se,oe,tt.toUnwrapped()),Ue&&U.renderDefaultNorthPole&&Jt(oe,st),ft&&U.renderDefaultSouthPole&&($t=s.cS(s.bC(),$t,[1,-1,1]),Jt(oe,It))}}}})(w,E,j,I,O);else{const U=w.context,q=U.gl;let X,Z;const J=w.shadowRenderer,se=Xl(w,w.longestCutoffRange),re=Le=>{if(Z===Le)return;const ke=[];ke.push(e_[Le]),se.shouldRenderCutoff&&ke.push("RENDER_CUTOFF"),J&&(ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&ke.push("NORMAL_OFFSET")),X=w.getOrCreateProgram("terrainRaster",{defines:ke}),Z=Le},oe=w.colorModeForRenderPass(),he=new dr(q.LEQUAL,dr.ReadWrite,w.depthRangeFor3D);zu.update(O);const xe=w.transform,_e=t_(xe.zoom,E.exaggeration(),E.sourceCache._source.tileSize);let ye=[0,0,0];if(J){const Le=w.style.directionalLight,ke=w.style.ambientLight;Le&&ke&&(ye=Kl(w.style,Le,ke))}{Z=-1;const Le=q.TRIANGLES,[ke,Re]=[E.gridIndexBuffer,E.gridSegments];for(const Ae of I){const Te=j.getTile(Ae),$e=Ir.disabled,Ze=E.prevTerrainTileForTile[Ae.key],Ye=E.terrainTileForTile[Ae.key];Tg(Ze,Ye)&&zu.newMorphing(Ae.key,Ze,Ye,O,250),dp(w,Te.emissiveTexture),U.activeTexture.set(q.TEXTURE0),Te.texture&&Te.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const it=zu.getMorphValuesForProxy(Ae.key),tt=it?1:0;let vt;it&&(vt={morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:s.dD(it.phase)}});const At=w.emissiveMode==="mrt-fallback"?1:0,et=xl(Ae.projMatrix,dw(Ae.canonical,xe.renderWorldCopies)?_e/10:_e,ye,At);if(re(tt),!X)continue;E.setupElevationDraw(Te,X,vt);const Ue=Ae.toUnwrapped();J&&J.setupShadows(Ue,X),w.uploadCommonUniforms(U,X,Ue,null,se),X.draw(w,Le,he,$e,oe,Ar.backCCW,et,"terrain_raster",E.gridBuffer,ke,Re)}}}}(f,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const f=this.painter,y=this.painter.context,w=this.proxySourceCache,E=this.proxiedCoords[w.id],j=this._drapedRenderBatches.shift(),I=f.style.order,O=[];this._updateFBOs(f.emissiveMode==="mrt-fallback");let U=0;for(const q of E){const X=w.getTileByID(q.proxyTileKey),Z=w.proxyCachedFBO[q.key]?w.proxyCachedFBO[q.key][o]:void 0,J=Z!==void 0?w.renderCache[Z]:this.pool[U++],se=Z!==void 0;if(X.texture=J.tex,X.emissiveTexture=J.emissiveTex,se&&!J.dirty){O.push(X.tileID);continue}y.bindFramebuffer.set(J.fb.framebuffer);const re=y.gl;let oe;re.drawBuffers(f.emissiveMode==="mrt-fallback"?[re.COLOR_ATTACHMENT0,re.COLOR_ATTACHMENT1]:[re.COLOR_ATTACHMENT0]),this.renderedToTile=!1,J.dirty&&(y.clear({color:s.ao.transparent,stencil:0}),J.dirty=!1);for(let he=j.start;he<=j.end;++he){const xe=f.style._mergedLayers[I[he]];if(xe.isHidden(f.transform.zoom))continue;const _e=f.style.getLayerSourceCache(xe),ye=_e?this.proxyToSource[q.key][_e.id]:[q];if(!ye)continue;const Le=ye;y.viewport.set([0,0,J.fb.width,J.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(J,ye,xe,_e),oe=_e?_e.id:null),f.renderLayer(f,_e,xe,Le)}if(re.drawBuffers([re.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const he of this._pendingGroundEffectLayers){const xe=f.style._mergedLayers[I[he]];if(xe.isHidden(f.transform.zoom))continue;const _e=f.style.getLayerSourceCache(xe),ye=_e?this.proxyToSource[q.key][_e.id]:[q];if(!ye)continue;const Le=ye;y.viewport.set([0,0,J.fb.width,J.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(J,ye,xe,_e),oe=_e?_e.id:null),f.renderLayer(f,_e,xe,Le)}this.renderedToTile?(J.dirty=!0,O.push(X.tileID)):se||--U,U===5&&(U=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,f.width,f.height]),j.end+1}postRender(){}isLayerOrderingCorrect(o){const f=o.order.length;let y=-1,w=f;for(let E=0;E<f;++E)this._style.isLayerDraped(o._mergedLayers[o.order[E]])?y=Math.max(y,E):w=Math.min(w,E);return w>y}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{o=Math.min(o,f.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,f,y){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const j=E.tileID,I=1<<j.overscaledZ,{x:O,y:U}=j.canonical,q=O/I,X=(O+1)/I,Z=U/I,J=(U+1)/I;return{minx:q,miny:Z,maxx:X,maxy:J,t:E.dem.tree.raycastRoot(q,Z,X,J,o,f,y),tile:E}});w.sort((E,j)=>(E.t!==null?E.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const E of w){if(E.t==null)return null;const j=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,o,f,y);if(j!=null)return j}return null}_createFBO(){const o=this.painter.context,f=o.gl,y=this.drapeBufferSize;o.activeTexture.set(f.TEXTURE0);const w=new s.T(o,{width:y[0],height:y[1],data:null},f.RGBA8);w.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=o.createFramebuffer(y[0],y[1],1,null);let j;return E.colorAttachment0.set(w.texture),this._emissiveTexture&&(j=new s.T(o,{width:y[0],height:y[1],data:null},f.R8),j.bind(f.LINEAR,f.CLAMP_TO_EDGE),E.createColorAttachment(o,1),E.colorAttachment1.set(j.texture)),E.depthAttachment=new qE(o,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:E,tex:w,emissiveTex:j,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(const f of this.pool)this._updateFBO(f,o);for(const f of this.proxySourceCache.renderCache)this._updateFBO(f,o);this._emissiveTexture=o}}_updateFBO(o,f){const y=o.fb,w=this.painter.context,E=w.gl,j=this.drapeBufferSize;if(f){const I=new s.T(w,{width:j[0],height:j[1],data:null},E.R8);I.bind(E.LINEAR,E.CLAMP_TO_EDGE),o.emissiveTex=I,y.createColorAttachment(w,1),y.colorAttachment1.set(I.texture)}else o.emissiveTex=void 0,y.removeColorAttachment(w,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const f=this._style._mergedLayers[o],y=f.isHidden(this.painter.transform.zoom);return f.type==="hillshade"||f.type==="custom"?!y&&f.shouldRedrape():!y&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const y of this._style.getSources())if(y instanceof Hl){o=!0;break}if(!o)return;const f={};for(let y=0;y<this._style.order.length;++y){const w=this._style._mergedLayers[this._style.order[y]],E=this._style.getLayerSourceCache(w);if(!E||f[E.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="line")continue;const j=w.widthExpression(),I=w.emissiveStrengthExpression();if(j instanceof s.ad||I instanceof s.ad){f[E.id]=!0;for(const O of this.proxyCoords){const U=this.proxyToSource[O.key][E.id];if(U)for(const q of U)this._clearRenderCacheForTile(E.id,q)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof mc){o=!0;break}if(!o)return;const f={};for(let y=0;y<this._style.order.length;++y){const w=this._style._mergedLayers[this._style.order[y]],E=this._style.getLayerSourceCache(w);if(!E||f[E.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const j=w.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const O=this.proxyToSource[I.key][E.id];if(O)for(const U of O){const q=jg(E.getTile(U),E.findLoadedParent(U,0),E,this.painter.transform,j);(q.opacity!==1||q.mix!==0)&&this._clearRenderCacheForTile(E.id,U)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,f=o.length;if(f===0)return;const y=[];this._pendingGroundEffectLayers=[];let w,E=0,j=this._style._mergedLayers[o[E]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++E<f;)j=this._style._mergedLayers[o[E]];for(;E<f;++E){const I=this._style._mergedLayers[o[E]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?w===void 0&&(w=E):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(E),w!==void 0&&(y.push({start:w,end:E-1}),w=void 0)))}if(w!==void 0&&y.push({start:w,end:E-1}),y.length!==0){const I=y[y.length-1];this._pendingGroundEffectLayers.every(O=>O>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(o){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const j=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let I=0;I<j.length;++I){const O=Object.values(j[I]);f.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,w=this._tilesDirty;for(let j=y.length-1;j>=0;j--){const I=y[j];if(f.getTileByID(I.key),f.proxyCachedFBO[I.key]!==void 0){const O=o[I.key],U=this.proxyToSource[I.key];let q=0;for(const X in U){const Z=U[X],J=O[X];if(!J||J.length!==Z.length||Z.some((se,re)=>se!==J[re]||w[X]&&w[X].hasOwnProperty(se.key))){q=-1;break}++q}for(const X in f.proxyCachedFBO[I.key])f.renderCache[f.proxyCachedFBO[I.key][X]].dirty=q<0||q!==Object.values(O).length}}const E=[...this._drapedRenderBatches];E.sort((j,I)=>I.end-I.start-(j.end-j.start));for(const j of E)for(const I of y){if(f.proxyCachedFBO[I.key])continue;let O=f.renderCachePool.pop();O===void 0&&f.renderCache.length<50&&(O=f.renderCache.length,f.renderCache.push(this._createFBO())),O!==void 0&&(f.proxyCachedFBO[I.key]={},f.proxyCachedFBO[I.key][j.start]=O,f.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(o,f,y,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,j=E.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let I;if(y.isTileClipped())I=f.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Ir.disabled}_renderTileClippingMasks(o,f){const y=this.painter,w=this.painter.context,E=w.gl;y._tileClippingMaskIDs={},w.setColorMode(Lr.disabled),w.setDepthMode(dr.disabled);const j=y.getOrCreateProgram("clippingMask");for(const I of o){const O=y._tileClippingMaskIDs[I.key]=--f;j.draw(y,E.TRIANGLES,dr.disabled,new Ir({func:E.ALWAYS,mask:0},O,255,E.KEEP,E.KEEP,E.REPLACE),Lr.disabled,Ar.disabled,Eg(I.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(o){const f=this.painter.transform;if(o.x<0||o.x>f.width||o.y<0||o.y>f.height)return null;const y=[o.x,o.y,1,1];s.aC(y,y,f.pixelMatrixInverse),s.cK(y,y,1/y[3]),y[0]/=f.worldSize,y[1]/=f.worldSize;const w=f._camera.position,E=s.cf(1,f.center.lat),j=[w[0],w[1],w[2]/E,0],I=s.da([],y.slice(0,3),j);s.aw(I,I);const O=this.raycast(j,I,this._exaggeration);return O!==null&&O?(s.bH(j,j,I,O),j[3]=j[2],j[2]*=E,j):null}_setupProxiedCoordsForOrtho(o,f,y){if(o.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(o,f,y);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const w=this.proxiedCoords[o.id]=[],E=this.proxyCoords;for(let O=0;O<E.length;O++){const U=E[O],q=this._findTileCoveringTileID(U,o);if(q){const X=this._createProxiedId(U,q,y[U.key]&&y[U.key][o.id]);w.push(X),this.proxyToSource[U.key][o.id]=[X]}}let j=!1;const I=new Set;for(let O=0;O<f.length;O++){const U=o.getTile(f[O]);if(!U||!U.hasData())continue;const q=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==U.tileID.canonical.z){const X=this.proxyToSource[q.tileID.key][o.id],Z=this._createProxiedId(q.tileID,U,y[q.tileID.key]&&y[q.tileID.key][o.id]);X?X.splice(X.length-1,0,Z):this.proxyToSource[q.tileID.key][o.id]=[Z];const J=this.proxyToSource[q.tileID.key][o.id];I.has(J)||I.add(J),w.push(Z),j=!0}}if(this._sourceTilesOverlap[o.id]=j,j&&this._debugParams.sortTilesHiZFirst)for(const O of I)O.sort((U,q)=>q.overscaledZ-U.overscaledZ)}_setupProxiedCoordsForImageSource(o,f,y){if(!o.getSource().loaded())return;const w=this.proxiedCoords[o.id]=[],E=this.proxyCoords,j=o.getSource(),I=j.tileID;if(!I)return;const O=new s.P(I.x,I.y)._div(1<<I.z),U=j.coordinates.map(s.ae.fromLngLat).reduce((X,Z)=>(X.min.x=Math.min(X.min.x,Z.x-O.x),X.min.y=Math.min(X.min.y,Z.y-O.y),X.max.x=Math.max(X.max.x,Z.x-O.x),X.max.y=Math.max(X.max.y,Z.y-O.y),X),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=(X,Z)=>{const J=X.wrap+X.canonical.x/(1<<X.canonical.z),se=X.canonical.y/(1<<X.canonical.z),re=s.al/(1<<X.canonical.z),oe=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),he=Z.canonical.y/(1<<Z.canonical.z);return J+re<oe+U.min.x||J>oe+U.max.x||se+re<he+U.min.y||se>he+U.max.y};for(let X=0;X<E.length;X++){const Z=E[X];for(let J=0;J<f.length;J++){const se=o.getTile(f[J]);if(!se||!se.hasData()||q(Z,se.tileID))continue;const re=this._createProxiedId(Z,se,y[Z.key]&&y[Z.key][o.id]),oe=this.proxyToSource[Z.key][o.id];oe?oe.push(re):this.proxyToSource[Z.key][o.id]=[re],w.push(re)}}}_createProxiedId(o,f,y){let w=this.orthoMatrix;if(y){const E=y.find(j=>j.key===f.tileID.key);if(E)return E}if(f.tileID.key!==o.key){const E=o.canonical.z-f.tileID.canonical.z;let j,I,O;w=s.bC();const U=f.tileID.wrap-o.wrap<<o.overscaledZ;E>0?(j=s.al>>E,I=j*((f.tileID.canonical.x<<E)-o.canonical.x+U),O=j*((f.tileID.canonical.y<<E)-o.canonical.y)):(j=s.al<<-E,I=s.al*(f.tileID.canonical.x-(o.canonical.x+U<<-E)),O=s.al*(f.tileID.canonical.y-(o.canonical.y<<-E))),s.ce(w,0,j,0,j,0,1),s.br(w,w,[I,O,0])}return new fw(f.tileID,o.key,w)}_findTileCoveringTileID(o,f){let y=f.getTile(o);if(y&&y.hasData())return y;const w=this._findCoveringTileCache[f.id],E=w[o.key];if(y=E?f.getTileByID(E):null,y&&y.hasData()||E===null)return y;let j=y?y.tileID:o,I=j.overscaledZ;const O=f.getSource().minzoom,U=[];if(!E){const X=f.getSource().maxzoom;if(o.canonical.z>=X){const Z=o.canonical.z-X;f.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,f.transform.tileZoom),j=new s.aQ(I,o.wrap,X,o.canonical.x>>Z,o.canonical.y>>Z)):Z!==0&&(I=X,j=new s.aQ(I,o.wrap,X,o.canonical.x>>Z,o.canonical.y>>Z))}j.key!==o.key&&(U.push(j.key),y=f.getTile(j))}const q=X=>{U.forEach(Z=>{w[Z]=X}),U.length=0};for(I-=1;I>=O&&(!y||!y.hasData());I--){y&&q(y.tileID.key);const X=j.calculateScaledKey(I);if(y=f.getTileByID(X),y&&y.hasData())break;const Z=w[X];if(Z===null)break;Z===void 0?U.push(X):y=f.getTileByID(Z)}return q(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,f){let y=this._tilesDirty[o];y||(y=this._tilesDirty[o]={}),y[f.key]=!0}}function hp(g,o,f){const y=function(I,O,U){const q=s.bJ(O,I),X=s.bJ(U,[.2126,.7152,.0722]),Z=(se,re,oe)=>(1-oe)*se+oe*re,J=Z(1-.3*Math.min(X,1),1,Math.min(q+1,1));return Z(.92,1,Math.asin(s.aA(O[2],-1,1))/Math.PI+.5)*J}(g,[0,0,1],o),w=[0,0,0];s.c5(w,f.slice(0,3),y);const E=[0,0,0];s.c5(E,o.slice(0,3),g[2]);const j=[0,0,0];return s.d8(j,w,E),s.db(j)}const AO=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],CO=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class GE{static cacheKey(o,f,y,w){const E=[f];w&&E.push(w.cacheKey);for(const j of y)o.usedDefines.has(j)&&E.push(j);return E.join("/")}constructor(o,f,y,w,E,j){const I=o.gl;this.program=I.createProgram(),this.configuration=w,this.name=f,this.fixedDefines=[...j];const O=`#version 300 es
${(w?w.defines():[]).concat(j.map(re=>`#define ${re}`)).join(`
`)}`,U=[O,vO];for(const re of y.fragmentIncludes)U.push(Ld[re]);U.push(y.fragmentSource);const q=U.join(`
`),X=[O,ME];for(const re of y.vertexIncludes)X.push(Ld[re]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&y.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&X.push("uniform int u_instanceID;"),X.push(y.vertexSource);let Z=X.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(Z=Z.replaceAll("gl_InstanceID","u_instanceID"));const J=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(J,q),I.compileShader(J),I.attachShader(this.program,J);const se=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(se,Z),I.compileShader(se),I.attachShader(this.program,se),this.attributes={},I.linkProgram(this.program),I.deleteShader(se),I.deleteShader(J),this.fixedUniforms=E(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=w?w.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(re=>({u_instanceID:new s.ch(re)}))(o)),(j.includes("TERRAIN")||f.includes("symbol")||f.includes("circle"))&&(this.terrainUniforms=(re=>({u_dem:new s.ch(re),u_dem_prev:new s.ch(re),u_dem_tl:new s.ck(re),u_dem_scale:new s.cj(re),u_dem_tl_prev:new s.ck(re),u_dem_scale_prev:new s.cj(re),u_dem_size:new s.cj(re),u_dem_lerp:new s.cj(re),u_exaggeration:new s.cj(re),u_depth:new s.ch(re),u_depth_size_inv:new s.ck(re),u_depth_range_unpack:new s.ck(re),u_occluder_half_size:new s.cj(re),u_occlusion_depth_offset:new s.cj(re),u_meter_to_dem:new s.cj(re),u_label_plane_matrix_inv:new s.cl(re)}))(o)),j.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new s.ci(re),u_tile_tr_up:new s.ci(re),u_tile_br_up:new s.ci(re),u_tile_bl_up:new s.ci(re),u_tile_up_scale:new s.cj(re)}))(o)),j.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new s.cl(re),u_fog_range:new s.ck(re),u_fog_color:new s.d3(re),u_fog_horizon_blend:new s.cj(re),u_fog_vertical_limit:new s.ck(re),u_fog_temporal_offset:new s.cj(re),u_frustum_tl:new s.ci(re),u_frustum_tr:new s.ci(re),u_frustum_br:new s.ci(re),u_frustum_bl:new s.ci(re),u_globe_pos:new s.ci(re),u_globe_radius:new s.cj(re),u_globe_transition:new s.cj(re),u_is_globe:new s.ch(re),u_viewport:new s.ck(re)}))(o)),j.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new s.d3(re)}))(o)),j.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new s.ci(re),u_lighting_directional_dir:new s.ci(re),u_lighting_directional_color:new s.ci(re),u_ground_radiance:new s.ci(re)}))(o)),j.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new s.cl(re),u_light_matrix_1:new s.cl(re),u_fade_range:new s.ck(re),u_shadow_normal_offset:new s.ci(re),u_shadow_intensity:new s.cj(re),u_shadow_texel_size:new s.cj(re),u_shadow_map_resolution:new s.cj(re),u_shadow_direction:new s.ci(re),u_shadow_bias:new s.ci(re),u_shadowmap_0:new s.ch(re),u_shadowmap_1:new s.ch(re)}))(o)))}getAttributeLocation(o,f){let y=this.attributes[f];return y===void 0&&(y=this.attributes[f]=o.getAttribLocation(this.program,f)),y}setTerrainUniformValues(o,f){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in f)y[w]&&y[w].set(this.program,w,f[w])}}setGlobeUniformValues(o,f){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in f)y[w]&&y[w].set(this.program,w,f[w])}}setFogUniformValues(o,f){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in f)y[w].set(this.program,w,f[w])}}setCutoffUniformValues(o,f){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in f)y[w].set(this.program,w,f[w])}}setLightsUniformValues(o,f){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in f)y[w].set(this.program,w,f[w])}}setShadowUniformValues(o,f){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;o.program.set(this.program);for(const w in f)y[w].set(this.program,w,f[w])}_drawDebugWireframe(o,f,y,w,E,j,I,O,U,q){const X=o.options.wireframe;if(X.terrain===!1&&X.layers2D===!1&&X.layers3D===!1)return;const Z=o.context;if(!(!(!X.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!X.layers2D||o._terrain&&o._terrain.renderingToTexture||!AO.includes(this.name))||!(!X.layers3D||!CO.includes(this.name))))return;const J=Z.gl,se=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,E,Z);if(!se)return;const re=[...this.fixedDefines,"DEBUG_WIREFRAME"],oe=o.getOrCreateProgram(this.name,{config:this.configuration,defines:re});Z.program.set(oe.program);const he=(ye,Le,ke)=>{if(Le[ye]&&ke[ye])for(const Re in Le[ye])ke[ye][Re]&&ke[ye][Re].set(ke.program,Re,Le[ye][Re].current)};U&&U.setUniforms(oe.program,Z,oe.binderUniforms,I,{zoom:O}),he("fixedUniforms",this,oe),he("terrainUniforms",this,oe),he("globeUniforms",this,oe),he("fogUniforms",this,oe),he("lightsUniforms",this,oe),he("shadowUniforms",this,oe),se.bind(),Z.setColorMode(new Lr([J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ZERO,J.ONE],s.ao.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new dr(f.func===J.LESS?J.LEQUAL:f.func,dr.ReadOnly,f.range)),Z.setStencilMode(Ir.disabled);const xe=3*j.primitiveLength*2,_e=3*j.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=q||1;for(let Le=0;Le<ye;++Le)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),J.drawElements(J.LINES,xe,J.UNSIGNED_SHORT,_e)}else q&&q>1?J.drawElementsInstanced(J.LINES,xe,J.UNSIGNED_SHORT,_e,q):J.drawElements(J.LINES,xe,J.UNSIGNED_SHORT,_e);E.bind(),Z.program.set(this.program),Z.setDepthMode(f),Z.setStencilMode(y),Z.setColorMode(w)}checkUniforms(o,f,y){if(this.fixedDefines.includes(f)){for(const w of Object.keys(y))if(!y[w].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${w} not set but required by ${f} being defined`)}}draw(o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe){const he=o.context,xe=he.gl;if(this.failedToCreate)return;he.program.set(this.program),he.setDepthMode(y),he.setStencilMode(w),he.setColorMode(E),he.setCullFace(j);for(const[Ae,Te]of this.fixedUniformsEntries)Te.set(this.program,Ae,I[Ae]);se&&se.setUniforms(this.program,he,this.binderUniforms,Z,{zoom:J});const _e={[xe.POINTS]:1,[xe.LINES]:2,[xe.TRIANGLES]:3,[xe.LINE_STRIP]:1}[f];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const ye=re||[],Le=se?se.getPaintVertexBuffers():[],ke=f===xe.TRIANGLES&&q,Re=oe&&oe>0?1:void 0;for(const Ae of X.get()){const Te=Ae.vaos||(Ae.vaos={});if((Te[O]||(Te[O]=new _O)).bind(he,this,U,Le,q,Ae.vertexOffset,ye,Re),this.forceManualRenderingForInstanceIDShaders){const $e=oe||1;for(let Ze=0;Ze<$e;++Ze)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ze),q?xe.drawElements(f,Ae.primitiveLength*_e,xe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):xe.drawArrays(f,Ae.vertexOffset,Ae.vertexLength)}else oe&&oe>1?xe.drawElementsInstanced(f,Ae.primitiveLength*_e,xe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2,oe):q?xe.drawElements(f,Ae.primitiveLength*_e,xe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):xe.drawArrays(f,Ae.vertexOffset,Ae.vertexLength);ke&&this._drawDebugWireframe(o,y,w,E,q,Ae,Z,J,se,oe)}}}function WE(g,o,f=0){const y=Math.pow(2,o.tileID.overscaledZ),w=o.tileSize*Math.pow(2,g.transform.tileZoom)/y,E=w*(o.tileID.canonical.x+o.tileID.wrap*y),j=w*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(o,1,g.transform.tileZoom),u_pixel_coord_upper:[E>>16,j>>16],u_pixel_coord_lower:[65535&E,65535&j],u_pattern_transition:f}}const n_={terrain:0,flat:1},PO=s.bC(),i_=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he)=>{const xe=o.style.light,_e=xe.properties.get("position"),ye=[_e.x,_e.y,_e.z],Le=s.dO();xe.properties.get("anchor")==="viewport"&&(s.dP(Le,-o.transform.angle),s.dQ(ye,ye,Le));const ke=xe.properties.get("color").toPremultipliedRenderColor(null),Re=o.transform,Ae={u_matrix:g,u_lightpos:ye,u_lightintensity:xe.properties.get("intensity"),u_lightcolor:[ke.r,ke.g,ke.b],u_vertical_gradient:+f,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:PO,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:n_[U],u_base_type:n_[q],u_ao:w,u_edge_radius:E,u_width_scale:j,u_flood_light_color:se,u_vertical_scale:re,u_flood_light_intensity:oe,u_ground_shadow_factor:he};return Re.projection.name==="globe"&&(Ae.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Ae.u_zoom_transition=X,Ae.u_inv_rot_matrix=J,Ae.u_merc_center=Z,Ae.u_up_dir=Re.projection.upVector(new s.cD(0,0,0),Z[0]*s.al,Z[1]*s.al),Ae.u_height_lift=O),Ae},mw=(g,o,f,y,w,E)=>({u_matrix:g,u_edge_radius:o,u_width_scale:f,u_vertical_scale:y,u_height_type:n_[w],u_base_type:n_[E]}),HE=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he)=>{const xe=i_(g,o,f,y,w,E,j,I,U,q,X,Z,J,se,re,oe,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,I.overscaledZ)/O.tileSize/8};return Object.assign(xe,WE(o,O,he),_e)},Gh=(g,o,f)=>({u_matrix:g,u_emissive_strength:o,u_ground_shadow_factor:f}),gw=(g,o,f,y,w,E=0)=>Object.assign(Gh(g,o,w),WE(f,y,E)),ZE=(g,o,f,y)=>({u_matrix:g,u_world:f,u_emissive_strength:o,u_ground_shadow_factor:y}),XE=(g,o,f,y,w,E,j=0)=>Object.assign(gw(g,o,f,y,E,j),{u_world:w}),yw=(g,o)=>({u_matrix:g,u_depth_bias:o}),zd=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o}),Wh=(g,o,f,y,w)=>({u_matrix:g,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:f,u_height_scale:y,u_reset_depth:w}),s_=(g,o,f,y,w,E,j,I,O)=>({u_matrix:g,u_normal_matrix:o,u_opacity:f,u_faux_facade_ao_intensity:y,u_camera_pos:w,u_tile_to_meter:E,u_facade_emissive_chance:j,u_flood_light_color:I,u_flood_light_intensity:O}),KE=g=>({u_matrix:g}),Bd=g=>({u_matrix:g}),vw=(g,o,f,y,w,E,j,I)=>{const O=s.al/E.tileSize;return{u_matrix:g,u_inv_rot_matrix:o,u_camera_to_center_distance:f.getCameraToCenterDistance(I),u_extrude_scale:[f.pixelsToGLUnits[0]/O,f.pixelsToGLUnits[1]/O],u_zoom_transition:y,u_tile_id:j,u_merc_center:w}},a_=(g,o,f,y)=>({u_matrix:g,u_inv_matrix:o,u_camera_to_center_distance:f.getCameraToCenterDistance(y),u_viewport_size:[f.width,f.height]}),_w=(g,o,f=1)=>({u_matrix:g,u_color:o,u_overlay:0,u_overlay_scale:f}),YE=s.bC(),xw=(g,o,f,y,w,E,j)=>{const I=g.transform,O=I.projection.name==="globe",U=O?s.dR(I.zoom,o.canonical)*I._pixelsPerMercatorPixel:s.ay(f,1,E),q={u_matrix:o.projMatrix,u_extrude_scale:U,u_intensity:j,u_inv_rot_matrix:YE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){q.u_inv_rot_matrix=y,q.u_merc_center=w,q.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],q.u_zoom_transition=s.aj(I.zoom);const X=w[0]*s.al,Z=w[1]*s.al;q.u_up_dir=I.projection.upVector(new s.cD(0,0,0),X,Z)}return q};function o_(g,[o,f,y,w],[E,j]){if(E===j)return[0,0,0,0];const I=255*(g-1)/(g*(j-E));return[o*I,f*I,y*I,w*I]}function JE(g,o,[f,y]){return f===y?0:.5/g+(o-f)*(g-1)/(g*(y-f))}const bw=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe,_e,ye)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:f,u_merc_matrix:y,u_grid_matrix:w,u_tl_parent:E,u_scale_parent:U,u_fade_t:q.mix,u_opacity:q.opacity*X.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:X.paint.get("raster-brightness-min"),u_brightness_high:X.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(X.paint.get("raster-saturation")),u_contrast_factor:s.dS(X.paint.get("raster-contrast")),u_spin_weights:Ag(X.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:J,u_zoom_transition:j,u_merc_center:I,u_cutoff_params:O,u_colorization_mix:o_(s.dU,re,he),u_colorization_offset:JE(s.dU,oe,he),u_color_ramp:se,u_texture_offset:[_e/(xe+2*_e),xe/(xe+2*_e)],u_texture_res:[xe+2*_e,xe+2*_e],u_emissive_strength:ye});function Ag(g){g*=Math.PI/180;const o=Math.sin(g),f=Math.cos(g);return[(2*f+1)/3,(-Math.sqrt(3)*o-f+1)/3,(Math.sqrt(3)*o-f+1)/3]}const fp=.05,NO=(g,o,f,y,w,E,j,I,O,U,q,X)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:f,u_merc_matrix:y,u_grid_matrix:w,u_tl_parent:E,u_scale_parent:U,u_fade_t:q.mix,u_opacity:q.opacity,u_image0:0,u_image1:1,u_raster_elevation:X,u_zoom_transition:j,u_merc_center:I,u_cutoff_params:O}),QE=(g,o,f,y,w,E,j,I,O,U)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_tile_offset:f,u_velocity:y,u_color_ramp:E,u_velocity_res:w,u_max_speed:j,u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[fp,fp]}),IO=(g,o,f,y,w,E,j,I,O,U)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_velocity:f,u_velocity_res:y,u_max_speed:w,u_speed_factor:E,u_reset_rate:j,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:U,u_particle_pos_scale:1.1,u_particle_pos_offset:[fp,fp]}),l_=s.bC(),Cg=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe,_e,ye,Le,ke,Re)=>{const Ae=w.transform,Te={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(xe),u_rotate_symbol:+f,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:j,u_coord_matrix:I,u_is_text:+U,u_elevation_from_sea:O?1:0,u_pitch_with_map:+y,u_texsize:q,u_texsize_icon:X,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:l_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:l_,u_up_vector:[0,-1,0],u_color_adj_mat:Le,u_icon_transition:ke||0,u_gamma_scale:y?w.transform.getCameraToCenterDistance(xe)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Re||1,u_ground_shadow_factor:_e,u_inv_matrix:s.bl(s.bC(),j),u_normal_scale:ye,u_lutTexture:10};return xe.name==="globe"&&(Te.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],Te.u_zoom_transition=se,Te.u_inv_rot_matrix=oe,Te.u_merc_center=re,Te.u_camera_forward=Ae._camera.forward(),Te.u_ecef_origin=s.dV(Ae.globeMatrix,J.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Te.u_up_vector=he),Te},$d=(g,o,f,y)=>({u_matrix:g,u_emissive_strength:o,u_opacity:f,u_color:y}),Pg=(g,o,f,y,w,E,j,I,O)=>Object.assign(function(U,q,X,Z,J,se){const{width:re,height:oe}=Z.imageManager.getPixelSize(q),he=Math.pow(2,se.tileID.overscaledZ),xe=se.tileSize*Math.pow(2,Z.transform.tileZoom)/he,_e=xe*(se.tileID.canonical.x+se.tileID.wrap*he),ye=xe*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[re,oe],u_pattern_size:X.displaySize,u_pattern_units_to_pixels:J?[Z.transform.width,-1*Z.transform.height]:[1/s.ay(se,1,Z.transform.tileZoom),1/s.ay(se,1,Z.transform.tileZoom)],u_pixel_coord_upper:[_e>>16,ye>>16],u_pixel_coord_lower:[65535&_e,65535&ye]}}(0,E,j,y,I,O),{u_matrix:g,u_emissive_strength:o,u_opacity:f}),Hh=new Float32Array(s.bA([])),c_=(g,o,f,y,w,E,j,I,O,U,q,X,Z,J=[0,0,0],se,re,oe)=>{const he=w.style.light,xe=he.properties.get("position"),_e=[-xe.x,-xe.y,xe.z],ye=s.dO();he.properties.get("anchor")==="viewport"&&(s.dP(ye,-w.transform.angle),s.dQ(_e,_e,ye));const Le=q.alphaMode==="MASK",ke=he.properties.get("color").toNonPremultipliedRenderColor(null),Re=Z.paint.get("model-ambient-occlusion-intensity"),Ae=Z.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=Z.paint.get("model-color-mix-intensity").constantOr(0),oe&&(Ae.r=oe[0],Ae.g=oe[1],Ae.b=oe[2],Ae.a=oe[3]),re&&(Ae.r=re.color.r,Ae.g=re.color.g,Ae.b=re.color.b,Ae.a=re.colorMix,X=re.emissionStrength,E*=re.opacity),{u_matrix:g,u_lighting_matrix:o,u_normal_matrix:f,u_node_matrix:y||Hh,u_lightpos:_e,u_lightintensity:he.properties.get("intensity"),u_lightcolor:[ke.r,ke.g,ke.b],u_camera_pos:J,u_opacity:E,u_baseTextureIsAlpha:0,u_alphaMask:+Le,u_alphaCutoff:q.alphaCutoff,u_baseColorFactor:j.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:U,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:Ae.toArray01(),u_aoIntensity:Re,u_emissive_strength:X,u_occlusionTextureTransform:se||[0,0,0,0]}},Ng=(g,o=Hh,f=Hh)=>({u_matrix:g,u_instance:o,u_node_matrix:f}),u_={fillExtrusion:g=>({u_matrix:new s.cl(g),u_lightpos:new s.ci(g),u_lightintensity:new s.cj(g),u_lightcolor:new s.ci(g),u_vertical_gradient:new s.cj(g),u_opacity:new s.cj(g),u_edge_radius:new s.cj(g),u_width_scale:new s.cj(g),u_ao:new s.ck(g),u_height_type:new s.ch(g),u_base_type:new s.ch(g),u_tile_id:new s.ci(g),u_zoom_transition:new s.cj(g),u_inv_rot_matrix:new s.cl(g),u_merc_center:new s.ck(g),u_up_dir:new s.ci(g),u_height_lift:new s.cj(g),u_flood_light_color:new s.ci(g),u_vertical_scale:new s.cj(g),u_flood_light_intensity:new s.cj(g),u_ground_shadow_factor:new s.ci(g)}),fillExtrusionDepth:g=>({u_matrix:new s.cl(g),u_edge_radius:new s.cj(g),u_width_scale:new s.cj(g),u_vertical_scale:new s.cj(g),u_height_type:new s.ch(g),u_base_type:new s.ch(g)}),fillExtrusionPattern:g=>({u_matrix:new s.cl(g),u_lightpos:new s.ci(g),u_lightintensity:new s.cj(g),u_lightcolor:new s.ci(g),u_vertical_gradient:new s.cj(g),u_height_factor:new s.cj(g),u_edge_radius:new s.cj(g),u_width_scale:new s.cj(g),u_ao:new s.ck(g),u_height_type:new s.ch(g),u_base_type:new s.ch(g),u_tile_id:new s.ci(g),u_zoom_transition:new s.cj(g),u_inv_rot_matrix:new s.cl(g),u_merc_center:new s.ck(g),u_up_dir:new s.ci(g),u_height_lift:new s.cj(g),u_image:new s.ch(g),u_texsize:new s.ck(g),u_pixel_coord_upper:new s.ck(g),u_pixel_coord_lower:new s.ck(g),u_tile_units_to_pixels:new s.cj(g),u_opacity:new s.cj(g),u_pattern_transition:new s.cj(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new s.cl(g),u_opacity:new s.cj(g),u_ao_pass:new s.cj(g),u_meter_to_tile:new s.cj(g),u_ao:new s.ck(g),u_flood_light_intensity:new s.cj(g),u_flood_light_color:new s.ci(g),u_attenuation:new s.cj(g),u_edge_radius:new s.cj(g),u_fb:new s.ch(g),u_fb_size:new s.cj(g),u_dynamic_offset:new s.cj(g)}),fill:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_ground_shadow_factor:new s.ci(g)}),fillPattern:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_image:new s.ch(g),u_texsize:new s.ck(g),u_pixel_coord_upper:new s.ck(g),u_pixel_coord_lower:new s.ck(g),u_tile_units_to_pixels:new s.cj(g),u_ground_shadow_factor:new s.ci(g),u_pattern_transition:new s.cj(g)}),fillOutline:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_world:new s.ck(g),u_ground_shadow_factor:new s.ci(g)}),fillOutlinePattern:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_world:new s.ck(g),u_image:new s.ch(g),u_texsize:new s.ck(g),u_pixel_coord_upper:new s.ck(g),u_pixel_coord_lower:new s.ck(g),u_tile_units_to_pixels:new s.cj(g),u_ground_shadow_factor:new s.ci(g),u_pattern_transition:new s.cj(g)}),building:g=>({u_matrix:new s.cl(g),u_normal_matrix:new s.cl(g),u_opacity:new s.cj(g),u_faux_facade_ao_intensity:new s.cj(g),u_camera_pos:new s.ci(g),u_tile_to_meter:new s.cj(g),u_facade_emissive_chance:new s.cj(g),u_flood_light_color:new s.ci(g),u_flood_light_intensity:new s.cj(g)}),buildingBloom:g=>({u_matrix:new s.cl(g)}),buildingDepth:g=>({u_matrix:new s.cl(g)}),elevatedStructuresDepth:g=>({u_matrix:new s.cl(g),u_depth_bias:new s.cj(g)}),elevatedStructures:g=>({u_matrix:new s.cl(g),u_ground_shadow_factor:new s.ci(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new s.cl(g),u_camera_pos:new s.ci(g),u_depth_bias:new s.cj(g),u_height_scale:new s.cj(g),u_reset_depth:new s.cj(g)}),circle:s.dY,collisionBox:g=>({u_matrix:new s.cl(g),u_inv_rot_matrix:new s.cl(g),u_camera_to_center_distance:new s.cj(g),u_extrude_scale:new s.ck(g),u_zoom_transition:new s.cj(g),u_merc_center:new s.ck(g),u_tile_id:new s.ci(g)}),collisionCircle:g=>({u_matrix:new s.cl(g),u_inv_matrix:new s.cl(g),u_camera_to_center_distance:new s.cj(g),u_viewport_size:new s.ck(g)}),debug:g=>({u_color:new s.dB(g),u_matrix:new s.cl(g),u_overlay:new s.ch(g),u_overlay_scale:new s.cj(g)}),clippingMask:g=>({u_matrix:new s.cl(g)}),heatmap:g=>({u_extrude_scale:new s.cj(g),u_intensity:new s.cj(g),u_matrix:new s.cl(g),u_inv_rot_matrix:new s.cl(g),u_merc_center:new s.ck(g),u_tile_id:new s.ci(g),u_zoom_transition:new s.cj(g),u_up_dir:new s.ci(g)}),heatmapTexture:g=>({u_image:new s.ch(g),u_color_ramp:new s.ch(g),u_opacity:new s.cj(g)}),hillshade:g=>({u_matrix:new s.cl(g),u_image:new s.ch(g),u_latrange:new s.ck(g),u_light:new s.ck(g),u_shadow:new s.dB(g),u_highlight:new s.dB(g),u_emissive_strength:new s.cj(g),u_accent:new s.dB(g)}),hillshadePrepare:g=>({u_matrix:new s.cl(g),u_image:new s.ch(g),u_dimension:new s.ck(g),u_zoom:new s.cj(g)}),line:s.dX,linePattern:s.dW,raster:g=>({u_matrix:new s.cl(g),u_normalize_matrix:new s.cl(g),u_globe_matrix:new s.cl(g),u_merc_matrix:new s.cl(g),u_grid_matrix:new s.dC(g),u_tl_parent:new s.ck(g),u_scale_parent:new s.cj(g),u_fade_t:new s.cj(g),u_opacity:new s.cj(g),u_image0:new s.ch(g),u_image1:new s.ch(g),u_brightness_low:new s.cj(g),u_brightness_high:new s.cj(g),u_saturation_factor:new s.cj(g),u_contrast_factor:new s.cj(g),u_spin_weights:new s.ci(g),u_perspective_transform:new s.ck(g),u_raster_elevation:new s.cj(g),u_zoom_transition:new s.cj(g),u_merc_center:new s.ck(g),u_cutoff_params:new s.d3(g),u_colorization_mix:new s.d3(g),u_colorization_offset:new s.cj(g),u_color_ramp:new s.ch(g),u_texture_offset:new s.ck(g),u_texture_res:new s.ck(g),u_emissive_strength:new s.cj(g)}),rasterParticle:g=>({u_matrix:new s.cl(g),u_normalize_matrix:new s.cl(g),u_globe_matrix:new s.cl(g),u_merc_matrix:new s.cl(g),u_grid_matrix:new s.dC(g),u_tl_parent:new s.ck(g),u_scale_parent:new s.cj(g),u_fade_t:new s.cj(g),u_opacity:new s.cj(g),u_image0:new s.ch(g),u_image1:new s.ch(g),u_raster_elevation:new s.cj(g),u_zoom_transition:new s.cj(g),u_merc_center:new s.ck(g),u_cutoff_params:new s.d3(g)}),rasterParticleTexture:g=>({u_texture:new s.ch(g),u_opacity:new s.cj(g)}),rasterParticleDraw:g=>({u_particle_texture:new s.ch(g),u_particle_texture_side_len:new s.cj(g),u_tile_offset:new s.ck(g),u_velocity:new s.ch(g),u_color_ramp:new s.ch(g),u_velocity_res:new s.ck(g),u_max_speed:new s.cj(g),u_uv_offset:new s.ck(g),u_data_scale:new s.ck(g),u_data_offset:new s.cj(g),u_particle_pos_scale:new s.cj(g),u_particle_pos_offset:new s.ck(g)}),rasterParticleUpdate:g=>({u_particle_texture:new s.ch(g),u_particle_texture_side_len:new s.cj(g),u_velocity:new s.ch(g),u_velocity_res:new s.ck(g),u_max_speed:new s.cj(g),u_speed_factor:new s.cj(g),u_reset_rate:new s.cj(g),u_rand_seed:new s.cj(g),u_uv_offset:new s.ck(g),u_data_scale:new s.ck(g),u_data_offset:new s.cj(g),u_particle_pos_scale:new s.cj(g),u_particle_pos_offset:new s.ck(g)}),symbol:g=>({u_is_size_zoom_constant:new s.ch(g),u_is_size_feature_constant:new s.ch(g),u_size_t:new s.cj(g),u_size:new s.cj(g),u_camera_to_center_distance:new s.cj(g),u_rotate_symbol:new s.ch(g),u_aspect_ratio:new s.cj(g),u_fade_change:new s.cj(g),u_matrix:new s.cl(g),u_label_plane_matrix:new s.cl(g),u_coord_matrix:new s.cl(g),u_is_text:new s.ch(g),u_elevation_from_sea:new s.ch(g),u_pitch_with_map:new s.ch(g),u_texsize:new s.ck(g),u_texsize_icon:new s.ck(g),u_texture:new s.ch(g),u_texture_icon:new s.ch(g),u_gamma_scale:new s.cj(g),u_device_pixel_ratio:new s.cj(g),u_tile_id:new s.ci(g),u_zoom_transition:new s.cj(g),u_inv_rot_matrix:new s.cl(g),u_merc_center:new s.ck(g),u_camera_forward:new s.ci(g),u_tile_matrix:new s.cl(g),u_up_vector:new s.ci(g),u_ecef_origin:new s.ci(g),u_is_halo:new s.ch(g),u_icon_transition:new s.cj(g),u_color_adj_mat:new s.cl(g),u_scale_factor:new s.cj(g),u_ground_shadow_factor:new s.ci(g),u_inv_matrix:new s.cl(g),u_normal_scale:new s.cj(g),u_lutTexture:new s.ch(g)}),background:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_opacity:new s.cj(g),u_color:new s.dB(g)}),backgroundPattern:g=>({u_matrix:new s.cl(g),u_emissive_strength:new s.cj(g),u_opacity:new s.cj(g),u_image:new s.ch(g),u_pattern_tl:new s.ck(g),u_pattern_br:new s.ck(g),u_texsize:new s.ck(g),u_pattern_size:new s.ck(g),u_pixel_coord_upper:new s.ck(g),u_pixel_coord_lower:new s.ck(g),u_pattern_units_to_pixels:new s.ck(g)}),terrainRaster:g=>({u_matrix:new s.cl(g),u_image0:new s.ch(g),u_image1:new s.ch(g),u_skirt_height:new s.cj(g),u_ground_shadow_factor:new s.ci(g),u_emissive_texture_available:new s.cj(g)}),skybox:g=>({u_matrix:new s.cl(g),u_sun_direction:new s.ci(g),u_cubemap:new s.ch(g),u_opacity:new s.cj(g),u_temporal_offset:new s.cj(g)}),skyboxGradient:g=>({u_matrix:new s.cl(g),u_color_ramp:new s.ch(g),u_center_direction:new s.ci(g),u_radius:new s.cj(g),u_opacity:new s.cj(g),u_temporal_offset:new s.cj(g)}),skyboxCapture:g=>({u_matrix_3f:new s.dC(g),u_sun_direction:new s.ci(g),u_sun_intensity:new s.cj(g),u_color_tint_r:new s.d3(g),u_color_tint_m:new s.d3(g),u_luminance:new s.cj(g)}),globeRaster:g=>({u_proj_matrix:new s.cl(g),u_globe_matrix:new s.cl(g),u_normalize_matrix:new s.cl(g),u_merc_matrix:new s.cl(g),u_zoom_transition:new s.cj(g),u_merc_center:new s.ck(g),u_image0:new s.ch(g),u_image1:new s.ch(g),u_grid_matrix:new s.dC(g),u_skirt_height:new s.cj(g),u_far_z_cutoff:new s.cj(g),u_frustum_tl:new s.ci(g),u_frustum_tr:new s.ci(g),u_frustum_br:new s.ci(g),u_frustum_bl:new s.ci(g),u_globe_pos:new s.ci(g),u_globe_radius:new s.cj(g),u_viewport:new s.ck(g),u_emissive_texture_available:new s.cj(g)}),globeAtmosphere:g=>({u_frustum_tl:new s.ci(g),u_frustum_tr:new s.ci(g),u_frustum_br:new s.ci(g),u_frustum_bl:new s.ci(g),u_horizon:new s.cj(g),u_transition:new s.cj(g),u_fadeout_range:new s.cj(g),u_atmosphere_fog_color:new s.d3(g),u_high_color:new s.d3(g),u_space_color:new s.d3(g),u_temporal_offset:new s.cj(g),u_horizon_angle:new s.cj(g)}),model:g=>({u_matrix:new s.cl(g),u_lighting_matrix:new s.cl(g),u_normal_matrix:new s.cl(g),u_node_matrix:new s.cl(g),u_lightpos:new s.ci(g),u_lightintensity:new s.cj(g),u_lightcolor:new s.ci(g),u_camera_pos:new s.ci(g),u_opacity:new s.cj(g),u_baseColorFactor:new s.d3(g),u_emissiveFactor:new s.d3(g),u_metallicFactor:new s.cj(g),u_roughnessFactor:new s.cj(g),u_baseTextureIsAlpha:new s.ch(g),u_alphaMask:new s.ch(g),u_alphaCutoff:new s.cj(g),u_baseColorTexture:new s.ch(g),u_metallicRoughnessTexture:new s.ch(g),u_normalTexture:new s.ch(g),u_occlusionTexture:new s.ch(g),u_emissionTexture:new s.ch(g),u_lutTexture:new s.ch(g),u_color_mix:new s.d3(g),u_aoIntensity:new s.cj(g),u_emissive_strength:new s.cj(g),u_occlusionTextureTransform:new s.d3(g)}),modelDepth:g=>({u_matrix:new s.cl(g),u_instance:new s.cl(g),u_node_matrix:new s.cl(g)}),groundShadow:g=>({u_matrix:new s.cl(g),u_ground_shadow_factor:new s.ci(g)}),stars:g=>({u_matrix:new s.cl(g),u_up:new s.ci(g),u_right:new s.ci(g),u_intensity_multiplier:new s.cj(g)}),snowParticle:g=>({u_modelview:new s.cl(g),u_projection:new s.cl(g),u_time:new s.cj(g),u_cam_pos:new s.ci(g),u_velocityConeAperture:new s.cj(g),u_velocity:new s.cj(g),u_horizontalOscillationRadius:new s.cj(g),u_horizontalOscillationRate:new s.cj(g),u_boxSize:new s.cj(g),u_billboardSize:new s.cj(g),u_simpleShapeParameters:new s.ck(g),u_screenSize:new s.ck(g),u_thinningCenterPos:new s.ck(g),u_thinningShape:new s.ci(g),u_thinningAffectedRatio:new s.cj(g),u_thinningParticleOffset:new s.cj(g),u_particleColor:new s.d3(g),u_direction:new s.ci(g)}),rainParticle:g=>({u_modelview:new s.cl(g),u_projection:new s.cl(g),u_time:new s.cj(g),u_cam_pos:new s.ci(g),u_texScreen:new s.ch(g),u_velocityConeAperture:new s.cj(g),u_velocity:new s.cj(g),u_boxSize:new s.cj(g),u_rainDropletSize:new s.ck(g),u_distortionStrength:new s.cj(g),u_rainDirection:new s.ci(g),u_color:new s.d3(g),u_screenSize:new s.ck(g),u_thinningCenterPos:new s.ck(g),u_thinningShape:new s.ci(g),u_thinningAffectedRatio:new s.cj(g),u_thinningParticleOffset:new s.cj(g),u_shapeDirectionalPower:new s.cj(g),u_shapeNormalPower:new s.cj(g),u_mode:new s.cj(g)}),vignette:g=>({u_vignetteShape:new s.ci(g),u_vignetteColor:new s.d3(g)}),occlusion:g=>({u_matrix:new s.cl(g),u_anchorPos:new s.ci(g),u_screenSizePx:new s.ck(g),u_occluderSizePx:new s.ck(g),u_color:new s.d3(g)})};class Qc{constructor(o,f,y,w){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++,this.context=o;const E=o.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||w||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++;const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Qc.uniqueIdxCounter=0;const ej={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kO{constructor(o,f,y,w,E,j){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.instanceCount=j,this.context=o;const I=o.gl;this.buffer=I.createBuffer(),o.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||E||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,f){for(let y=0;y<this.attributes.length;y++){const w=f.getAttributeLocation(o,this.attributes[y].name);w!==-1&&o.enableVertexAttribArray(w)}}setVertexAttribPointers(o,f,y){for(let w=0;w<this.attributes.length;w++){const E=this.attributes[w],j=f.getAttributeLocation(o,E.name);j!==-1&&o.vertexAttribPointer(j,E.components,o[ej[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(o,f,y){for(let w=0;w<this.attributes.length;w++){const E=f.getAttributeLocation(o,this.attributes[w].name);E!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(E,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zh{constructor(o,f,y,w,E){this.context=o,this.width=f,this.height=y;const j=this.framebuffer=o.gl.createFramebuffer();w>0&&(this.colorAttachment0=new Jv(o,j,0)),w>1&&(this.colorAttachment1=new Jv(o,j,1)),E&&(this.depthAttachmentType=E,this.depthAttachment=E==="renderbuffer"?new up(o,j):new Sg(o,j))}createColorAttachment(o,f){f===0?this.colorAttachment0=new Jv(o,this.framebuffer,0):f===1&&(this.colorAttachment1=new Jv(o,this.framebuffer,1))}removeColorAttachment(o,f){const y=this.context.gl;let w;f===0?(w=this.colorAttachment0.get(),this.colorAttachment0=void 0):f===1&&(w=this.colorAttachment1.get(),this.colorAttachment1=void 0),w&&y.deleteTexture(w)}destroy(){const o=this.context.gl;if(this.colorAttachment0){const f=this.colorAttachment0.get();f&&o.deleteTexture(f)}if(this.colorAttachment1){const f=this.colorAttachment1.get();f&&o.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&o.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&o.deleteTexture(f)}o.deleteFramebuffer(this.framebuffer)}}class d_{constructor(o,f){this.gl=o,this.clearColor=new SO(this),this.clearDepth=new DE(this),this.clearStencil=new nw(this),this.colorMask=new Hv(this),this.depthMask=new iw(this),this.stencilMask=new qh(this),this.stencilFunc=new ap(this),this.stencilOp=new bg(this),this.stencilTest=new op(this),this.depthRange=new LE(this),this.depthTest=new sw(this),this.depthFunc=new FE(this),this.blend=new lp(this),this.blendFunc=new Zv(this),this.blendColor=new Xv(this),this.blendEquation=new aw(this),this.cullFace=new Kv(this),this.cullFaceSide=new wg(this),this.frontFace=new zE(this),this.program=new BE(this),this.activeTexture=new $E(this),this.viewport=new cp(this),this.bindFramebuffer=new VE(this),this.bindRenderbuffer=new TO(this),this.bindTexture=new EO(this),this.bindVertexBuffer=new jO(this),this.bindElementBuffer=new ow(this),this.bindVertexArrayOES=new lw(this),this.pixelStoreUnpack=new cw(this),this.pixelStoreUnpackPremultiplyAlpha=new uw(this),this.pixelStoreUnpackFlipY=new UE(this),this.options=f?Object.assign({},f):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=f&&!!f.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,f,y){return new Qc(this,o,f,y)}createVertexBuffer(o,f,y,w,E){return new kO(this,o,f,y,w,E)}createRenderbuffer(o,f,y){const w=this.gl,E=w.createRenderbuffer();return this.bindRenderbuffer.set(E),w.renderbufferStorage(w.RENDERBUFFER,o,f,y),this.bindRenderbuffer.set(null),E}createFramebuffer(o,f,y,w){return new Zh(this,o,f,y,w)}clear({color:o,depth:f,stencil:y,colorMask:w}){const E=this.gl;let j=0;o&&(j|=E.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(w||[!0,!0,!0,!0])),f!==void 0&&(j|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(j|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),E.clear(j)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.by(o.blendFunction,Lr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ir;function ww(g,o,f,y,w,E,j){const I=g.context,O=I.gl,U=g.transform,q=[s.aF(U.center.lng),s.aJ(U.center.lat)],X=f.layout.get("symbol-placement"),Z=f.layout.get("text-variable-anchor"),J=f.layout.get("icon-rotation-alignment")==="map",se=f.layout.get("text-rotation-alignment")==="map",re=X!=="point",oe=[];let he=0,xe=0;for(let Ae=0;Ae<y.length;Ae++){const Te=y[Ae],$e=o.getTile(Te),Ze=$e.getBucket(f);if(!Ze)continue;const Ye=Ze.getProjection().createInversionMatrix(U,Te.canonical),it=[],tt=hO(Te,Ze,U),vt=!j&&J&&re,At=j&&se&&re,et=Z&&Ze.hasTextData(),Ue=Ze.hasIconTextFit()&&et&&Ze.hasIconData(),ft=vt||At||j&&et||Ue,st=Ze.projection.name==="globe",It=st?s.aj(U.zoom):0;st&&(it.push("PROJECTION_GLOBE_VIEW"),ft&&it.push("PROJECTED_POS_ON_VIEWPORT"));const Mt=g.getOrCreateProgram("collisionBox",{defines:it});let Zt=tt;w[0]===0&&w[1]===0||(Zt=g.translatePosMatrix(tt,$e,w,E));const Dt=j?Ze.textCollisionBox:Ze.iconCollisionBox,$t=Ze.collisionCircleArray;if($t.length>0){const or=s.bC(),Jt=Zt;s.cP(or,Ze.placementInvProjMatrix,U.glCoordMatrix),s.cP(or,or,Ze.placementViewportMatrix),oe.push({circleArray:$t,circleOffset:xe,transform:Jt,invTransform:or,projection:Ze.getProjection()}),he+=$t.length/4,xe=he}if(!Dt)continue;g.terrain&&g.terrain.setupElevationDraw($e,Mt);const lr=st?[Te.canonical.x,Te.canonical.y,1<<Te.canonical.z]:[0,0,0];Mt.draw(g,O.LINES,dr.disabled,Ir.disabled,g.colorModeForRenderPass(),Ar.disabled,vw(Zt,Ye,U,It,q,$e,lr,Ze.getProjection()),f.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,null,U.zoom,null,[Dt.collisionVertexBuffer,Dt.collisionVertexBufferExt])}if(!j||!oe.length)return;const _e=g.getOrCreateProgram("collisionCircle"),ye=new s.dZ;ye.resize(4*he),ye._trim();let Le=0;for(const Ae of oe)for(let Te=0;Te<Ae.circleArray.length/4;Te++){const $e=4*Te,Ze=Ae.circleArray[$e+0],Ye=Ae.circleArray[$e+1],it=Ae.circleArray[$e+2],tt=Ae.circleArray[$e+3];ye.emplace(Le++,Ze,Ye,it,tt,0),ye.emplace(Le++,Ze,Ye,it,tt,1),ye.emplace(Le++,Ze,Ye,it,tt,2),ye.emplace(Le++,Ze,Ye,it,tt,3)}(!ir||ir.length<2*he)&&(ir=function(Ae){const Te=2*Ae,$e=new s.b0;$e.resize(Te),$e._trim();for(let Ze=0;Ze<Te;Ze++){const Ye=6*Ze;$e.uint16[Ye+0]=4*Ze+0,$e.uint16[Ye+1]=4*Ze+1,$e.uint16[Ye+2]=4*Ze+2,$e.uint16[Ye+3]=4*Ze+2,$e.uint16[Ye+4]=4*Ze+3,$e.uint16[Ye+5]=4*Ze+0}return $e}(he));const ke=I.createIndexBuffer(ir,!0),Re=I.createVertexBuffer(ye,s.d_.members,!0);for(const Ae of oe){const Te=a_(Ae.transform,Ae.invTransform,U,Ae.projection);_e.draw(g,O.TRIANGLES,dr.disabled,Ir.disabled,g.colorModeForRenderPass(),Ar.disabled,Te,f.id,Re,ke,s.bg.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,U.zoom)}Re.destroy(),ke.destroy()}const gc=s.bC();function Bu(g){const o=g._camera.getWorldToCamera(g.worldSize,1),f=s.aB([],o,g.globeMatrix);s.bl(f,f);const y=[0,0,0],w=[0,1,0,0];return s.aC(w,w,f),y[0]=w[0],y[1]=w[1],y[2]=w[2],s.aw(y,y),y}function tj({width:g,height:o,anchor:f,textOffset:y,textScale:w},E){const{horizontalAlign:j,verticalAlign:I}=s.c1(f),O=-(j-.5)*g,U=-(I-.5)*o,q=s.c2(f,y);return new s.P((O/w+q[0])*E,(U/w+q[1])*E)}function rj(g,o,f,y,w,E,j,I,O,U){const q=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,J={},se=g.getProjection(),re=Qf(j,se,w),oe=w.elevation,he=se.upVectorScale(j.canonical,w.center.lat,w.worldSize).metersToTile;X.clear();for(let xe=0;xe<q.length;xe++){const _e=q.get(xe),{tileAnchorX:ye,tileAnchorY:Le,numGlyphs:ke}=_e,Re=_e.hidden||!_e.crossTileID||g.allowVerticalPlacement&&!_e.placedOrientation?null:y[_e.crossTileID];if(Re){let Ae=0,Te=0,$e=0;const Ze=g.elevationType==="road";if(oe||Ze){const st=Ze?g.getElevationFeatureForText(xe):null,It=s.bV.getAtTileOffset(j,new s.P(ye,Le),oe,st),[Mt,Zt,Dt]=se.upVector(j.canonical,ye,Le);Ae=It*Mt*he,Te=It*Zt*he,$e=It*Dt*he}let[Ye,it,tt,vt]=Zl(_e.projectedAnchorX+Ae,_e.projectedAnchorY+Te,_e.projectedAnchorZ+$e,f?re:E);const At=Rv(w.getCameraToCenterDistance(se),vt);let et=s.bM(g.textSizeData,O,_e)*At/s.bY;f&&(et*=g.tilePixelRatio/I);const Ue=tj(Re,et);f?({x:Ye,y:it,z:tt}=se.projectTilePoint(ye+Ue.x,Le+Ue.y,j.canonical),[Ye,it,tt]=Zl(Ye+Ae,it+Te,tt+$e,E)):(o&&Ue._rotate(-w.angle),Ye+=Ue.x,it+=Ue.y,tt=0);const ft=g.allowVerticalPlacement&&_e.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let st=0;st<ke;st++)s.bO(X,Ye,it,tt,ft);U&&_e.associatedIconIndex>=0&&(J[_e.associatedIconIndex]={x:Ye,y:it,z:tt,angle:ft})}else so(ke,X)}if(U){Z.clear();const xe=g.icon.placedSymbolArray;for(let _e=0;_e<xe.length;_e++){const ye=xe.get(_e),{numGlyphs:Le}=ye,ke=J[_e];if(ye.hidden||!ke)so(Le,Z);else{const{x:Re,y:Ae,z:Te,angle:$e}=ke;for(let Ze=0;Ze<Le;Ze++)s.bO(Z,Re,Ae,Te,$e)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function h_(g,o,f,y,w,E,j={}){const I=f.paint.get("icon-translate"),O=f.paint.get("text-translate"),U=f.paint.get("icon-translate-anchor"),q=f.paint.get("text-translate-anchor"),X=f.layout.get("icon-rotation-alignment"),Z=f.layout.get("text-rotation-alignment"),J=f.layout.get("icon-pitch-alignment"),se=f.layout.get("text-pitch-alignment"),re=f.layout.get("icon-keep-upright"),oe=f.layout.get("text-keep-upright"),he=f.paint.get("icon-color-saturation"),xe=f.paint.get("icon-color-contrast"),_e=f.paint.get("icon-color-brightness-min"),ye=f.paint.get("icon-color-brightness-max"),Le=f.layout.get("symbol-elevation-reference")==="sea",ke=f.layout.get("icon-image-use-theme")==="none",Re=g.context,Ae=Re.gl,Te=g.transform,$e=X==="map",Ze=Z==="map",Ye=J==="map",it=se==="map",tt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let vt=!1;const At=g.depthModeForSublayer(0,dr.ReadOnly),et=new dr(g.context.gl.LEQUAL,dr.ReadOnly,g.depthRangeFor3D),Ue=[s.aF(Te.center.lng),s.aJ(Te.center.lat)],ft=f.layout.get("text-variable-anchor"),st=Te.projection.name==="globe",It=[],Mt=[0,-1,0];for(const Zt of y){const Dt=o.getTile(Zt),$t=Dt.getBucket(f);if(!$t||$t.projection.name==="mercator"&&st||$t.fullyClipped)continue;const lr=$t.projection.name==="globe",or=lr?s.aj(Te.zoom):0,Jt=Qf(Zt,$t.getProjection(),Te),sr=Te.calculatePixelsToTileUnitsMatrix(Dt),vr=ft&&$t.hasTextData(),Cr=$t.hasIconTextFit()&&vr&&$t.hasIconData(),Gr=$t.getProjection().createInversionMatrix(Te,Zt.canonical),un=(1<<Dt.tileID.canonical.z)*s.al/g.transform.worldSize,Mr=Cn=>{let an=[0,0,0];if(Cn){const Ur=g.style.directionalLight,si=g.style.ambientLight;Ur&&si&&(an=Kl(g.style,Ur,si))}return an},xn=Cn=>{Te.depthOcclusionForSymbolsAndCircles&&(f.hasOcclusionOpacityProperties||g.terrain)&&(Cn.push("DEPTH_D24"),Cn.push("DEPTH_OCCLUSION"))},Br=Cn=>{f.lut&&!ke&&(f.lut.texture||(f.lut.texture=new s.d$(g.context,f.lut.image,[f.lut.image.height,f.lut.image.height,f.lut.image.height],Re.gl.RGBA8)),Re.activeTexture.set(Re.gl.TEXTURE0+10),f.lut.texture&&f.lut.texture.bind(Re.gl.LINEAR,Re.gl.CLAMP_TO_EDGE),Cn.push("APPLY_LUT_ON_GPU"))},$n=()=>{const Cn=$e&&f.layout.get("symbol-placement")!=="point",an=[];xn(an),Br(an);const Ur=Cn||Cr,si=$t.elevationType==="road",Di=g.shadowRenderer,ci=si&&Ye&&!!Di&&Di.enabled,fi=Mr(ci),uo=si&&Ye&&!g.terrain?et:At,No=f.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&Ye&&an.push("PITCH_WITH_MAP_TERRAIN"),lr&&(an.push("PROJECTION_GLOBE_VIEW"),Ur&&an.push("PROJECTED_POS_ON_VIEWPORT")),No>0&&$t.hasAnySecondaryIcon&&an.push("ICON_TRANSITION"),!$t.icon.zOffsetVertexBuffer||si&&g.terrain||an.push("Z_OFFSET"),he===0&&xe===0&&_e===0&&ye===1||an.push("COLOR_ADJUSTMENT"),$t.sdfIcons&&an.push("RENDER_SDF"),ci&&an.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),si&&Ye&&!g.terrain&&$t.icon.orientationVertexBuffer&&an.push("ELEVATED_ROADS");const Hs=$t.icon.programConfigurations.get(f.id),Pn=g.getOrCreateProgram("symbol",{config:Hs,defines:an}),Zo=Dt.imageAtlasTexture?Dt.imageAtlasTexture.size:[0,0],va=$t.iconSizeData,Io=s.bK(va,Te.zoom),Jl=Ye||!Te.isOrthographic,ho=zh(Jt,Dt.tileID.canonical,Ye,$e,Te,$t.getProjection(),sr),ji=To(Jt,Dt.tileID.canonical,Ye,$e,Te,$t.getProjection(),sr),ts=g.translatePosMatrix(ji,Dt,I,U,!0),ui=g.translatePosMatrix(Jt,Dt,I,U),ms=Ur?gc:ho,ja=$e&&!Ye&&!Cn;let Zi=Mt;!st&&!Te.mercatorFromTransition||$e||(Zi=Bu(Te));const Xo=lr?Zi:Mt,Wg=f.getColorAdjustmentMatrix(he,xe,_e,ye),nu=Cg(va.kind,Io,ja,Ye,g,ui,ms,ts,Le,!1,Zo,[0,0],0,Zt,or,Ue,Gr,Xo,$t.getProjection(),fi,un,Wg,No,null),Ep=Dt.imageAtlasTexture?Dt.imageAtlasTexture:null,jp=f.layout.get("icon-size").constantOr(0)!==1||$t.iconsNeedLinear,Ko=$t.sdfIcons||g.options.rotating||g.options.zooming||jp||Jl?Ae.LINEAR:Ae.NEAREST,iu=$t.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,su=g.terrain&&Ye&&Cn?s.bl(s.bC(),ho):gc;if(Cn&&$t.icon){const Tl=s.bV.getAtTileOffsetFunc(Zt,Te.center.lat,Te.worldSize,$t.getProjection()),Uu=Du(Jt,Dt.tileID.canonical,Ye,$e,Te,$t.getProjection(),sr),Qh=f.layout.get("icon-size-scale-range"),j_=s.aA(g.scaleFactor,Qh[0],Qh[1]);Dn($t,Jt,g,!1,Uu,ji,Ye,re,Tl,Zt,j_)}return{program:Pn,buffers:$t.icon,uniformValues:nu,atlasTexture:Ep,atlasTextureIcon:null,atlasInterpolation:Ko,atlasInterpolationIcon:null,isSDF:$t.sdfIcons,hasHalo:iu,depthMode:uo,tile:Dt,renderWithShadows:ci,labelPlaneMatrixInv:su}},Ln=()=>{const Cn=Ze&&f.layout.get("symbol-placement")!=="point",an=[],Ur=Cn||ft||Cr,si=$t.elevationType==="road",Di=g.shadowRenderer,ci=si&&it&&!!Di&&Di.enabled,fi=Mr(ci),uo=si&&it&&!g.terrain?et:At;g.terrainRenderModeElevated()&&it&&an.push("PITCH_WITH_MAP_TERRAIN"),lr&&(an.push("PROJECTION_GLOBE_VIEW"),Ur&&an.push("PROJECTED_POS_ON_VIEWPORT")),!$t.text.zOffsetVertexBuffer||si&&g.terrain||an.push("Z_OFFSET"),$t.iconsInText&&an.push("RENDER_TEXT_AND_SYMBOL"),an.push("RENDER_SDF"),ci&&an.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),si&&it&&!g.terrain&&$t.text.orientationVertexBuffer&&an.push("ELEVATED_ROADS"),xn(an);const No=$t.text.programConfigurations.get(f.id),Hs=g.getOrCreateProgram("symbol",{config:No,defines:an});let Pn,Zo=[0,0],va=null;const Io=$t.textSizeData;$t.iconsInText&&(Zo=Dt.imageAtlasTexture?Dt.imageAtlasTexture.size:[0,0],va=Dt.imageAtlasTexture?Dt.imageAtlasTexture:null,Pn=it||!Te.isOrthographic||g.options.rotating||g.options.zooming||Io.kind==="composite"||Io.kind==="camera"?Ae.LINEAR:Ae.NEAREST);const Jl=Dt.glyphAtlasTexture?Dt.glyphAtlasTexture.size:[0,0],ho=f.layout.get("text-size-scale-range"),ji=s.aA(g.scaleFactor,ho[0],ho[1]),ts=s.bK(Io,Te.zoom,ji),ui=zh(Jt,Dt.tileID.canonical,it,Ze,Te,$t.getProjection(),sr),ms=To(Jt,Dt.tileID.canonical,it,Ze,Te,$t.getProjection(),sr),ja=g.translatePosMatrix(ms,Dt,O,q,!0),Zi=g.translatePosMatrix(Jt,Dt,O,q),Xo=Ur?gc:ui,Wg=Ze&&!it&&!Cn;let nu=Mt;!st&&!Te.mercatorFromTransition||Ze||(nu=Bu(Te));const Ep=Cg(Io.kind,ts,Wg,it,g,Zi,Xo,ja,Le,!0,Jl,Zo,0,Zt,or,Ue,Gr,lr?nu:Mt,$t.getProjection(),fi,un,null,null,ji),jp=Dt.glyphAtlasTexture?Dt.glyphAtlasTexture:null,Ko=Ae.LINEAR,iu=f.paint.get("text-halo-width").constantOr(1)!==0,su=g.terrain&&it&&Cn?s.bl(s.bC(),ui):gc;if(Cn&&$t.text){const Tl=s.bV.getAtTileOffsetFunc(Zt,Te.center.lat,Te.worldSize,$t.getProjection()),Uu=Du(Jt,Dt.tileID.canonical,it,Ze,Te,$t.getProjection(),sr);Dn($t,Jt,g,!0,Uu,ms,it,oe,Tl,Zt,ji)}return{program:Hs,buffers:$t.text,uniformValues:Ep,atlasTexture:jp,atlasTextureIcon:va,atlasInterpolation:Ko,atlasInterpolationIcon:Pn,isSDF:!0,hasHalo:iu,depthMode:uo,tile:Dt,renderWithShadows:ci,labelPlaneMatrixInv:su}},Un=$t.icon.segments.get().length,hn=$t.text.segments.get().length,Vr=Un&&!j.onlyText?$n():null,An=hn&&!j.onlyIcons?Ln():null,wi=f.paint.get("icon-opacity").constantOr(1),Si=f.paint.get("text-opacity").constantOr(1);if(tt&&$t.canOverlap){vt=!0;const Cn=wi&&!j.onlyText?$t.icon.segments.get():[],an=Si&&!j.onlyIcons?$t.text.segments.get():[];for(const Ur of Cn)It.push({segments:new s.bg([Ur]),sortKey:Ur.sortKey,state:Vr});for(const Ur of an)It.push({segments:new s.bg([Ur]),sortKey:Ur.sortKey,state:An})}else j.onlyText||It.push({segments:wi?$t.icon.segments:new s.bg([]),sortKey:0,state:Vr}),j.onlyIcons||It.push({segments:Si?$t.text.segments:new s.bg([]),sortKey:0,state:An})}vt&&It.sort((Zt,Dt)=>Zt.sortKey-Dt.sortKey);for(const Zt of It){const Dt=Zt.state;if(Dt)if(g.terrain?g.terrain.setupElevationDraw(Dt.tile,Dt.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Dt.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Dt.program),Re.activeTexture.set(Ae.TEXTURE0),Dt.atlasTexture&&Dt.atlasTexture.bind(Dt.atlasInterpolation,Ae.CLAMP_TO_EDGE,!0),Dt.atlasTextureIcon&&(Re.activeTexture.set(Ae.TEXTURE1),Dt.atlasTextureIcon&&Dt.atlasTextureIcon.bind(Dt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE,!0)),Dt.renderWithShadows&&g.shadowRenderer.setupShadows(Dt.tile.tileID.toUnwrapped(),Dt.program,"vector-tile"),g.uploadCommonLightUniforms(g.context,Dt.program),Dt.hasHalo){const $t=Dt.uniformValues;$t.u_is_halo=1,f_(Dt.buffers,Zt.segments,f,g,Dt.program,Dt.depthMode,w,E,$t,2),$t.u_is_halo=0}else{if(Dt.isSDF){const $t=Dt.uniformValues;Dt.hasHalo&&($t.u_is_halo=1,f_(Dt.buffers,Zt.segments,f,g,Dt.program,Dt.depthMode,w,E,$t,1)),$t.u_is_halo=0}f_(Dt.buffers,Zt.segments,f,g,Dt.program,Dt.depthMode,w,E,Dt.uniformValues,1)}}}function f_(g,o,f,y,w,E,j,I,O,U){const q=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];w.draw(y,y.context.gl.TRIANGLES,E,j,I,Ar.disabled,O,f.id,g.layoutVertexBuffer,g.indexBuffer,o,f.paint,y.transform.zoom,g.programConfigurations.get(f.id),q,U)}function Sw(g,o){const f=1<<g.canonical.z,y=(o.x*f-g.canonical.x-g.wrap*f)*s.al,w=(o.y*f-g.canonical.y)*s.al,E=s.e8(o.z,o.y);return s.d5(y,w,E)}function Tw(g,o,f,y,w){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const E=g.context.gl,j=new dr(g.context.gl.LEQUAL,dr.ReadWrite,g.depthRangeFor3D),I=new dr(g.context.gl.GREATER,dr.ReadWrite,g.depthRangeFor3D),O=function(J){let se=.01;return J.isOrthographic&&(se=s.ak(1e-4,se,s.d0(J.pitch>=Yc?1:J.pitch/Yc))),2*se}(g.transform),U=g.transform.getFreeCameraOptions().position,q="elevatedStructuresDepthReconstruct",X=g.getOrCreateProgram(q,{defines:["DEPTH_RECONSTRUCTION"]}),Z=g.getOrCreateProgram(q);for(const J of y){const se=o.getTile(J),re=se.getBucket(f);if(!re)continue;const oe=re.elevatedStructures;if(!oe)continue;const he=re.elevationBufferData.heightRange,xe=Sw(J.toUnwrapped(),U),_e=g.translatePosMatrix(J.projMatrix,se,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));let ye,Le,ke,Re;if(w==="initialize"){if(!he||he.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;ye=Wh(_e,xe,O,1,0),Le=j,ke=oe.depthSegments,Re=X}else if(w==="reset"){if(!he||he.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;ye=Wh(_e,xe,0,0,1),Le=I,ke=oe.maskSegments,Re=X}else if(w==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;ye=Wh(_e,xe,O,1,0),Le=j,ke=oe.depthSegments,Re=Z}Re.draw(g,E.TRIANGLES,Le,Ir.disabled,Lr.disabled,Ar.disabled,ye,f.id,oe.vertexBuffer,oe.indexBuffer,ke,f.paint,g.transform.zoom)}}function pp(g,o,f,y){const{painter:w,sourceCache:E,layer:j,coords:I,colorMode:O,elevationType:U,terrainEnabled:q,pass:X}=g,Z=w.context.gl,J=j.paint.get("fill-pattern"),se=j.paint.get("fill-pattern-cross-fade"),re=J.constantOr(null);let oe=U;U!=="road"||o&&!q||(oe="none");const he=oe==="road",xe=g.painter.shadowRenderer,_e=he&&!!xe&&xe.enabled,ye=new dr(w.context.gl.LEQUAL,dr.ReadOnly,w.depthRangeFor3D);let Le=[0,0,0];if(_e){const Te=w.style.directionalLight,$e=w.style.ambientLight;Te&&$e&&(Le=Kl(w.style,Te,$e))}const ke=J&&J.constantOr(1),Re=w.terrain&&w.terrain.renderingToTexture,Ae=(Te,$e)=>{let Ze,Ye,it,tt,vt;$e?(Ze=ke&&!j.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",it=Z.LINES):(Ze=ke?"fillPattern":"fill",it=Z.TRIANGLES);for(const At of I){const et=E.getTile(At);if(ke&&!et.patternsLoaded())continue;const Ue=et.getBucket(j);if(!Ue)continue;const ft=o?Ue.elevationBufferData:Ue.bufferData;if(ft.isEmpty())continue;w.prepareDrawTile();const st=ft.programConfigurations.get(j.id),It=w.isTileAffectedByFog(At),Mt=[],Zt=[];he&&(Mt.push("ELEVATED_ROADS"),Zt.push(ft.elevatedLayoutVertexBuffer)),_e&&Mt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Re&&f&&Mt.push("USE_MRT1"),ke&&(w.context.activeTexture.set(Z.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),st.updatePaintBuffers());let Dt=!1;if(re&&et.imageAtlas){const sr=et.imageAtlas,vr=s.e3.from(re),Cr=vr.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Gr=vr.getSecondary(),un=sr.patternPositions.get(Cr),Mr=Gr?sr.patternPositions.get(Gr.scaleSelf(s.o.devicePixelRatio).toString()):null;Dt=!!un&&!!Mr,un&&st.setConstantPatternPositions(un,Mr)}se>0&&(Dt||st.getPatternTransitionVertexBuffer("fill-pattern"))&&Mt.push("FILL_PATTERN_TRANSITION");const $t=w.getOrCreateProgram(Ze,{config:st,overrideFog:It,defines:Mt}),lr=w.translatePosMatrix(At.projMatrix,et,j.paint.get("fill-translate"),j.paint.get("fill-translate-anchor"));_e&&xe.setupShadows(et.tileID.toUnwrapped(),$t,"vector-tile");const or=j.paint.get("fill-emissive-strength");if($e){tt=ft.lineIndexBuffer,vt=ft.lineSegments;const sr=w.terrain&&w.terrain.renderingToTexture?w.terrain.drapeBufferSize:[Z.drawingBufferWidth,Z.drawingBufferHeight];Ye=Ze==="fillOutlinePattern"&&ke?XE(lr,or,w,et,sr,Le,se):ZE(lr,or,sr,Le)}else tt=ft.indexBuffer,vt=ft.triangleSegments,Ye=ke?gw(lr,or,w,et,Le,se):Gh(lr,or,Le);w.uploadCommonUniforms(w.context,$t,At.toUnwrapped());let Jt=Te;(U==="road"&&!q||U==="offset")&&(Jt=ye),$t.draw(w,it,Jt,y||w.stencilModeForClipping(At),O,Ar.disabled,Ye,j.id,ft.layoutVertexBuffer,tt,vt,j.paint,w.transform.zoom,st,Zt)}};w.renderPass===X&&Ae(w.depthModeForSublayer(1,w.renderPass==="opaque"?dr.ReadWrite:dr.ReadOnly),!1),oe==="none"&&w.renderPass==="translucent"&&j.paint.get("fill-antialias")&&Ae(w.depthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,dr.ReadOnly),!0)}function mp(g,o,f,y,w,E,j,I){f.resetLayerRenderingStats(g);const O=g.context,U=O.gl,q=g.transform,X=f.paint.get("fill-extrusion-pattern"),Z=f.paint.get("fill-extrusion-pattern-cross-fade"),J=X.constantOr(null),se=X.constantOr(1),re=f.paint.get("fill-extrusion-opacity"),oe=g.style.enable3dLights(),he=f.paint.get(oe&&!se?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),xe=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),he],_e=f.layout.get("fill-extrusion-edge-radius"),ye=_e>0&&!f.paint.get("fill-extrusion-rounded-roof"),Le=ye?0:_e,ke=q.projection.name==="globe"?s.eb():0,Re=q.projection.name==="globe",Ae=Re?s.aj(q.zoom):0,Te=[s.aF(q.center.lng),s.aJ(q.center.lat)],$e=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ze=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor($e?null:f.lut).toArray01().slice(0,3),Ye=f.paint.get("fill-extrusion-flood-light-intensity"),it=f.paint.get("fill-extrusion-vertical-scale"),tt=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,vt=f.paint.get("fill-extrusion-height-alignment"),At=f.paint.get("fill-extrusion-base-alignment"),et=Xl(g,f.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let ft;Re&&Ue.push("PROJECTION_GLOBE_VIEW"),xe[0]>0&&Ue.push("FAUX_AO"),ye&&Ue.push("ZERO_ROOF_RADIUS"),I&&Ue.push("HAS_CENTROID"),Ye>0&&Ue.push("FLOOD_LIGHT"),et.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),tt&&Ue.push("RENDER_WALL_MODE");const st=g.renderPass==="shadow",It=g.shadowRenderer,Mt=st&&!!It,Zt=st?Ar.disabled:Ar.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Dt=[0,0,0];if(It){const or=g.style.directionalLight,Jt=g.style.ambientLight;or&&Jt&&(Dt=Kl(g.style,or,Jt)),st||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),It.useNormalOffset&&Ue.push("NORMAL_OFFSET")),ft=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const $t=Mt?"fillExtrusionDepth":se?"fillExtrusionPattern":"fillExtrusion",lr=f.getLayerRenderingStats();for(const or of y){const Jt=o.getTile(or),sr=Jt.getBucket(f);if(!sr||sr.projection.name!==q.projection.name)continue;let vr=!1;It&&(vr=It.getMaxCascadeForTile(or.toUnwrapped())===0);const Cr=g.isTileAffectedByFog(or),Gr=sr.programConfigurations.get(f.id);let un=!1;if(J&&Jt.imageAtlas){const hn=Jt.imageAtlas,Vr=s.e3.from(J),An=Vr.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),wi=Vr.getSecondary(),Si=hn.patternPositions.get(An),Cn=wi?hn.patternPositions.get(wi.scaleSelf(s.o.devicePixelRatio).toString()):null;un=!!Si&&!!Cn,Si&&Gr.setConstantPatternPositions(Si,Cn)}Z>0&&(un||Gr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Mr=g.getOrCreateProgram($t,{config:Gr,defines:vr?ft:Ue,overrideFog:Cr});if(g.terrain&&g.terrain.setupElevationDraw(Jt,Mr,{useMeterToDem:!0}),!sr.centroidVertexBuffer){const hn=Mr.getAttributeLocation(U,"a_centroid_pos");hn!==-1&&U.vertexAttrib2f(hn,0,0)}!st&&It&&It.setupShadows(Jt.tileID.toUnwrapped(),Mr,"vector-tile"),se&&(g.context.activeTexture.set(U.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Gr.updatePaintBuffers());const xn=f.paint.get("fill-extrusion-vertical-gradient"),Br=1/sr.tileToMeter;let $n;if(st&&It){if(Ew(Jt.tileID,sr.maxHeight,g))continue;const hn=It.calculateShadowPassMatrixFromTile(Jt.tileID.toUnwrapped());$n=mw(hn,Le,Br,it,vt,At)}else{const hn=g.translatePosMatrix(or.expandedProjMatrix,Jt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Vr=q.projection.createInversionMatrix(q,or.canonical);$n=se?HE(hn,g,xn,re,xe,Le,Br,or,Jt,ke,vt,At,Ae,Te,Vr,Ze,it,Z):i_(hn,g,xn,re,xe,Le,Br,or,ke,vt,At,Ae,Te,Vr,Ze,it,Ye,Dt)}g.uploadCommonUniforms(O,Mr,or.toUnwrapped(),null,et);let Ln=sr.segments;if(q.projection.name==="mercator"&&!st&&(Ln=sr.getVisibleSegments(Jt.tileID,g.terrain,g.transform.getFrustum(0)),!Ln.get().length))continue;if(lr)if(st)for(const hn of Ln.get())lr.numRenderedVerticesInShadowPass+=hn.primitiveLength;else for(const hn of Ln.get())lr.numRenderedVerticesInTransparentPass+=hn.primitiveLength;const Un=[];(g.terrain||I)&&Un.push(sr.centroidVertexBuffer),Re&&Un.push(sr.layoutVertexExtBuffer),tt&&Un.push(sr.wallVertexBuffer),Mr.draw(g,O.gl.TRIANGLES,w,E,j,Zt,$n,f.id,sr.layoutVertexBuffer,sr.indexBuffer,Ln,f.paint,g.transform.zoom,Gr,Un)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}class Ig{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function eu(g,o,f,y,w,E,j,I,O,U,q,X,Z,J,se,re,oe,he,xe,_e){const ye=o.context,Le=ye.gl,ke=o.transform,Re=o.transform.zoom,Ae=[],Te=g.translate,$e=g.translateAnchor,Ze=g.edgeRadius,Ye=Xl(o,g.cutoffFadeRange);q==="clear"?(Ae.push("CLEAR_SUBPASS"),_e&&(Ae.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE))):q==="sdf"?Ae.push("SDF_SUBPASS"):q==="emissive"&&(Ae.push("USE_MRT1"),ye.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)),he&&Ae.push("HAS_CENTROID"),Ye.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const it=(tt,vt,At,et,Ue)=>{let ft=Ae;vt.groundRadiusBuffer!=null&&(ft=Ae.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const st=vt.programConfigurations.get(y.id),It=o.isTileAffectedByFog(tt),Mt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:st,defines:ft,overrideFog:It}),Zt=(($t,lr,or,Jt,sr,vr,Cr,Gr,un,Mr,xn)=>({u_matrix:lr,u_opacity:or,u_ao_pass:Jt?1:0,u_meter_to_tile:sr,u_ao:vr,u_flood_light_intensity:Cr,u_flood_light_color:Gr,u_attenuation:un,u_edge_radius:Mr,u_fb:0,u_fb_size:xn,u_dynamic_offset:1}))(0,et,X,U,Ue,[Z,J*Ue],se,re,oe,Re>=17?0:Ze*Ue,_e?_e.size[0]:0),Dt=[];he&&Dt.push(vt.hiddenByLandmarkVertexBuffer),vt.groundRadiusBuffer!=null&&Dt.push(vt.groundRadiusBuffer),o.uploadCommonUniforms(ye,Mt,tt.toUnwrapped(),null,Ye),Mt.draw(o,ye.gl.TRIANGLES,E,j,I,O,Zt,y.id,vt.vertexBuffer,vt.indexBuffer,At,y.paint,Re,st,Dt)};for(const tt of w){const vt=f.getTile(tt),At=vt.getBucket(y);if(!At||At.projection.name!==ke.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const et=At.groundEffect,Ue=1/At.tileToMeter;{const ft=o.translatePosMatrix(tt.projMatrix,vt,Te,$e),st=et.getDefaultSegment();it(tt,et,st,ft,Ue)}if(xe)for(let ft=0;ft<4;ft++){const st=s.e9[ft](tt),It=f.getTile(st);if(!It)continue;const Mt=It.getBucket(y);if(!Mt||Mt.projection.name!==ke.projection.name||!Mt.groundEffect||Mt.groundEffect&&!Mt.groundEffect.hasData())continue;const Zt=Mt.groundEffect;let Dt,$t;ft===0?(Dt=[-s.al,0,0],$t=1):ft===1?(Dt=[s.al,0,0],$t=0):ft===2?(Dt=[0,-s.al,0],$t=3):(Dt=[0,s.al,0],$t=2);const lr=Zt.regionSegments[$t];if(!lr)continue;const or=new Float32Array(16);s.br(or,tt.projMatrix,Dt),it(tt,Zt,lr,o.translatePosMatrix(or,vt,Te,$e),Ue)}}}function nj(g,o,f,y,w,E,j){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const I=E?E.findDEMTileFor(f):null;if(!(I&&I.dem||j))return;E&&I&&I.dem&&y.selfDEMTileTimestamp!==I.dem._timestamp&&(y.borderDoneWithNeighborZ=[-1,-1,-1,-1],y.selfDEMTileTimestamp=I.dem._timestamp);const O=(oe,he)=>{(oe.flags|he.flags)&s.ec?(oe.flags|=s.ec,he.flags|=s.ec):(oe.flags&=~s.ec,he.flags&=~s.ec)},U=oe=>new s.P(Math.ceil((oe+s.ed)*s.ee),0),q=oe=>{const he=o.getSource().minzoom,xe=ye=>{const Le=o.getTileByID(ye);if(Le&&Le.hasData())return Le.getBucket(w)},_e=[0,-1,1];for(const ye of _e){if(oe.overscaledZ+ye<he)continue;const Le=xe(oe.calculateScaledKey(oe.overscaledZ+ye));if(Le)return Le}},X=[0,0,0],Z=(oe,he)=>(X[0]=Math.min(oe.min.y,he.min.y),X[1]=Math.max(oe.max.y,he.max.y),X[2]=s.al-he.min.x>oe.max.x?he.min.x-s.al:oe.max.x,X),J=(oe,he)=>(X[0]=Math.min(oe.min.x,he.min.x),X[1]=Math.max(oe.max.x,he.max.x),X[2]=s.al-he.min.y>oe.max.y?he.min.y-s.al:oe.max.y,X),se=[(oe,he)=>Z(oe,he),(oe,he)=>Z(he,oe),(oe,he)=>J(oe,he),(oe,he)=>J(he,oe)],re=(oe,he,xe,_e,ye,Le,ke)=>{if(!E)return 0;const Re=[[Le?xe:oe,Le?oe:xe,0],[Le?xe:he,Le?he:xe,0]],Ae=ke<0?s.al+ke:ke,Te=[Le?Ae:(oe+he)/2,Le?(oe+he)/2:Ae,0];return xe===0&&ke<0||xe!==0&&ke>0?E.getForTilePoints(ye,[Te],!0,_e):Re.push(Te),E.getForTilePoints(f,Re,!0,I),Math.max(Re[0][2],Re[1][2],Te[2])/E.exaggeration()};for(let oe=0;oe<4;oe++){const he=y.borderFeatureIndices[oe];if(he.length===0)continue;const xe=s.e9[oe](f),_e=q(xe);if(!(_e&&_e instanceof s.ea))continue;const ye=E?E.findDEMTileFor(xe):null;if(!(ye&&ye.dem||j)||(E&&ye&&ye.dem&&y.borderDEMTileTimestamp[oe]!==ye.dem._timestamp&&(y.borderDoneWithNeighborZ[oe]=-1,y.borderDEMTileTimestamp[oe]=ye.dem._timestamp),y.borderDoneWithNeighborZ[oe]===_e.canonical.z))continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const Le=(oe<2?1:5)-oe,ke=_e.borderDoneWithNeighborZ[Le]!==y.canonical.z,Re=_e.borderFeatureIndices[Le];let Ae=0;if(y.canonical.z!==_e.canonical.z){for(const Te of he)y.showCentroid(y.featuresOnBorder[Te]);if(ke)for(const Te of Re)_e.showCentroid(_e.featuresOnBorder[Te]);y.borderDoneWithNeighborZ[oe]=_e.canonical.z,_e.borderDoneWithNeighborZ[Le]=y.canonical.z}for(const Te of he){const $e=y.featuresOnBorder[Te],Ze=y.centroidData[$e.centroidDataIndex],Ye=$e.borders[oe];let it;for(;Ae<Re.length;){it=_e.featuresOnBorder[Re[Ae]];const tt=it.borders[Le];if(tt[1]>Ye[0]+3||tt[0]>Ye[0]-3)break;_e.showCentroid(it),Ae++}if(it&&Ae<Re.length){const tt=Ae;let vt=0;for(;!(it.borders[Le][0]>Ye[1]-3)&&(vt++,++Ae!==Re.length);)it=_e.featuresOnBorder[Re[Ae]];it=_e.featuresOnBorder[Re[tt]];let At=!1;if(vt>=1){const ft=it.borders[Le];Math.abs(Ye[0]-ft[0])<3&&Math.abs(Ye[1]-ft[1])<3&&(vt=1,At=!0,Ae=tt+1)}else if(vt===0){y.showCentroid($e);continue}const et=_e.centroidData[it.centroidDataIndex];j&&At&&O(Ze,et);const Ue=$e.intersectsCount()>1||it.intersectsCount()>1;if(vt>1)Ae=tt,Ze.centroidXY=et.centroidXY=new s.P(0,0);else if(ye&&ye.dem&&!Ue){const ft=se[oe](Ze,et),st=oe%2?s.al-1:0,It=re(ft[0],Math.min(s.al-1,ft[1]),st,ye,xe,oe<2,ft[2]);Ze.centroidXY=et.centroidXY=U(It)}else Ue?Ze.centroidXY=et.centroidXY=new s.P(0,0):(Ze.centroidXY=y.encodeBorderCentroid($e),et.centroidXY=_e.encodeBorderCentroid(it));y.writeCentroidToBuffer(Ze),_e.writeCentroidToBuffer(et)}else y.showCentroid($e)}y.borderDoneWithNeighborZ[oe]=_e.canonical.z,_e.borderDoneWithNeighborZ[Le]=y.canonical.z}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const ij=[1,0,0],sj=[0,1,0],aj=[0,0,1];function Ew(g,o,f){const y=f.transform,w=f.shadowRenderer;if(!w)return!0;const E=g.toUnwrapped(),j=y.tileSize*w._cascades[f.currentShadowCascade].scale;let I=o;if(y.elevation){const re=y.elevation.getMinMaxForTile(g);re&&(I+=re.max)}const O=[...w.shadowDirection];O[2]=-O[2];const U=w.computeSimplifiedTileShadowVolume(E,I,j,O);if(!U)return!1;const q=[ij,sj,aj,O,[O[0],0,O[2]],[0,O[1],O[2]]],X=y.projection.name==="globe",Z=y.scaleZoom(j),J=s.cB.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,Z,!X),se=w.getCurrentCascadeFrustum();return J.intersectsPrecise(U.vertices,U.planes,q)===0||se.intersectsPrecise(U.vertices,U.planes,q)===0}function gp(g){const{painter:o,source:f,layer:y,coords:w}=g;let E=g.defines;const j=o.context,I=o.renderPass==="shadow",O=o.renderPass==="light-beam",U=o.shadowRenderer,q=s.ef(o.transform.center.lat,o.transform.zoom),X=Xl(o,y.paint.get("building-cutoff-fade-range"));X.shouldRenderCutoff&&(E=E.concat("RENDER_CUTOFF")),g.floodLightIntensity>0&&(E=E.concat("FLOOD_LIGHT"));for(const Z of w){const J=f.getTile(Z),se=J.getBucket(y);if(!se)continue;U&&U.getMaxCascadeForTile(Z.toUnwrapped())===0&&(E=E.concat("SHADOWS_SINGLE_CASCADE"));const re=se.programConfigurations.get(y.id);let oe,he,xe,_e=o.translatePosMatrix(Z.expandedProjMatrix,J,[0,0],"map");if(_e=s.cS(s.bC(),_e,[1,1,g.verticalScale]),I&&U){if(Ew(J.tileID,se.maxHeight*q,o))continue;let Le=U.calculateShadowPassMatrixFromTile(J.tileID.toUnwrapped());Le=s.cS(s.bC(),Le,[1,1,g.verticalScale]),xe=Bd(Le),oe=he=o.getOrCreateProgram("buildingDepth",{config:re,defines:E,overrideFog:!1})}else if(O)oe=he=o.getOrCreateProgram("buildingBloom",{config:re,defines:E,overrideFog:!1}),xe=KE(_e);else{const Le=o.transform.calculatePosMatrix(Z.toUnwrapped(),o.transform.worldSize);s.cS(Le,Le,[1,1,g.verticalScale]);const ke=s.bC();s.cS(ke,Le,[1,-1,1/q]),s.bl(ke,ke),s.eg(ke,ke);const Re=o.transform.getFreeCameraOptions().position,Ae=1<<Z.canonical.z;if(xe=s_(_e,ke,g.opacity,g.facadeAOIntensity,[((Re.x-Z.wrap)*Ae-Z.canonical.x)*s.al,(Re.y*Ae-Z.canonical.y)*s.al,Re.z*Ae*s.al],se.tileToMeter,g.facadeEmissiveChance,g.floodLightColor,g.floodLightIntensity),he=o.getOrCreateProgram("building",{config:re,defines:E,overrideFog:!1}),g.depthOnly===!0)oe=he;else{const Te=E.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);oe=o.getOrCreateProgram("building",{config:re,defines:Te,overrideFog:!1})}U&&(U.setupShadowsFromMatrix(Le,he,!0),oe!==he&&U.setupShadowsFromMatrix(Le,oe,!0))}const ye=(Le,ke)=>{if(O){const Re=Le.entranceBloom;ke.draw(o,j.gl.TRIANGLES,g.depthMode,Ir.disabled,g.blendMode,Ar.disabled,xe,y.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segmentsBucket,y.paint,o.transform.zoom,re,[Re.layoutAttenuationBuffer,Re.layoutColorBuffer])}else{const Re=Le.segmentsBucket;let Ae=[Le.layoutNormalBuffer,Le.layoutCentroidBuffer,Le.layoutColorBuffer,Le.layoutFloodLightDataBuffer];Le.layoutFacadePaintBuffer&&(Ae=Ae.concat([Le.layoutFacadeDataBuffer,Le.layoutFacadeVerticalRangeBuffer,Le.layoutFacadePaintBuffer])),ke.draw(o,j.gl.TRIANGLES,g.depthMode,Ir.disabled,g.blendMode,I?Ar.disabled:Ar.backCW,xe,y.id,Le.layoutVertexBuffer,Le.indexBuffer,Re,y.paint,o.transform.zoom,re,Ae)}};o.uploadCommonUniforms(j,he,Z.toUnwrapped(),null,X),se.buildingWithoutFacade&&ye(se.buildingWithoutFacade,he),se.buildingWithFacade&&(oe!==he&&o.uploadCommonUniforms(j,oe,Z.toUnwrapped(),null,X),ye(se.buildingWithFacade,oe))}}function p_(g,o,f,y,w,E,j,I,O,U,q,X,Z){const J=g.context.gl,se=g.depthModeForSublayer(1,dr.ReadOnly,J.LEQUAL,!0),re=.1*(1-(oe=q))+3*oe;var oe;const he=g._showOverdrawInspector,xe=X,_e=new Ig;he||eu(_e,g,o,f,y,se,new Ir({func:J.ALWAYS,mask:255},255,255,J.KEEP,J.KEEP,J.REPLACE),new Lr([J.ONE,J.ONE,J.ONE,J.ONE],s.ao.transparent,[!1,!1,!1,!0],J.MIN),Ar.disabled,w,"sdf",E,j,I,O,U,re,xe,!1);{const ye=he?Ir.disabled:new Ir({func:J.EQUAL,mask:255},255,255,J.KEEP,J.DECR,J.DECR),Le=he?g.colorModeForRenderPass():new Lr([J.ONE_MINUS_DST_ALPHA,J.DST_ALPHA,J.ONE,J.ONE],s.ao.transparent,[!0,!0,!0,!0]);eu(_e,g,o,f,y,se,ye,Le,Ar.disabled,w,"color",E,j,I,O,U,re,xe,!1)}}function jw(g){return[g[0]*s.eh,g[1]*s.eh,g[2]*s.eh,0]}function m_(g,o,f,y,w,E,j,I,O){const U=y.getSource(),q=f.globeSharedBuffers;if(!q)return;let X,Z,J;if(o&&(X=y.getTile(o)),U instanceof s.aU?(Z=U.texture,J=s.dK(0,0,f.transform)):X&&o&&(Z=X.texture,J=s.dK(o.canonical.z,o.canonical.x,f.transform)),!Z||!J)return;g||(J=s.cS(s.bC(),J,[1,-1,1]));const se=f.context,re=se.gl,oe=w.paint.get("raster-resampling")==="nearest"?re.NEAREST:re.LINEAR,he=f.colorModeForDrapableLayerRenderPass(E),xe=j.defines;xe.push("GLOBE_POLES");const _e=new dr(re.LEQUAL,dr.ReadWrite,f.depthRangeFor3D),ye=Float32Array.from(f.transform.expandedFarZProjMatrix),Le=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),se.activeTexture.set(re.TEXTURE0),Z.bind(oe,re.CLAMP_TO_EDGE),se.activeTexture.set(re.TEXTURE1),Z.bind(oe,re.CLAMP_TO_EDGE),"useMipmap"in Z&&se.extTextureFilterAnisotropic&&f.transform.pitch>20&&re.texParameterf(re.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[ke,Re,Ae,Te]=o?q.getPoleBuffers(o.canonical.z,!1):q.getPoleBuffers(0,!0),$e=w.paint.get("raster-elevation");let Ze;g?(Ze=ke,f.renderDefaultNorthPole=$e!==0):(Ze=Re,f.renderDefaultSouthPole=$e!==0);const Ye=jw(j.mix),it=((vt,At,et,Ue,ft,st,It,Mt,Zt,Dt,$t,lr,or)=>bw(vt,At,et,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},st,[0,0],Mt,2,Dt,$t,lr,1,0,or))(ye,Le,J,s.aj(f.transform.zoom),0,w,0,$e,0,Ye,j.offset,j.range,E),tt=f.getOrCreateProgram("raster",{defines:xe});f.uploadCommonUniforms(se,tt,null),tt.draw(f,re.TRIANGLES,_e,O,he,I,it,w.id,Ze,Ae,Te)}function oj(g){if(g.isOrthographic)return[0,0,0,0];const o=g._nearZ,f=g.projection.farthestPixelDistance(g),y=f-o,w=.2*g.height,E=o+w;return[o,f,(E-w-o)/y,(E-o)/y]}function lj(g,o,f,y){if(g)return o instanceof io&&g instanceof Iv?o.getTextureDescriptor(g,f,!0):{texture:g.texture,mix:jw(y.mix),offset:y.offset,buffer:0,tileSize:1}}var Aw=s.ei([{name:"a_index",type:"Int16",components:1}]);class cj{constructor(o,f,y,w){const E={width:y[0],height:y[1],data:null},j=o.gl;this.targetColorTexture=new s.T(o,E,j.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(o,E,j.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(f,w),this.lastInvalidatedAt=0}updateParticleTexture(o,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,w=f.width*f.height;this.particleTexture0=new s.T(this.context,f,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,f,y.RGBA8,{premultiply:!1,useMipmap:!1});const E=new s.ej;E.reserve(w);for(let j=0;j<w;j++)E.emplaceBack(j);this.particleIndexBuffer=this.context.createVertexBuffer(E,Aw.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Cw(g,o,f){if(!g)return null;const y=o.getTextureDescriptor(g,f,!0);if(!y)return null;let{texture:w,mix:E,offset:j,tileSize:I,buffer:O,format:U}=y;if(!w||!U)return null;let q=!1;return U==="uint32"&&(q=!0,E[3]=0,E=o_(s.ek,E,[0,f.paint.get("raster-particle-max-speed")]),j=JE(s.ek,j,[0,f.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[O/(I+2*O),I/(I+2*O)],tileSize:I,scalarData:q,scale:E,offset:j,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[U]]}}function uj(g){const o=g._nearZ,f=g.projection.farthestPixelDistance(g),y=f-o,w=.2*g.height,E=o+w;return[o,f,(E-w-o)/y,(E-o)/y]}const Pw=new s.ao(1,0,0,1),Nw=new s.ao(0,1,0,1),Iw=new s.ao(0,0,1,1),OO=new s.ao(1,0,1,1),RO=new s.ao(0,1,1,1);function dj(g,o,f,y,w,E){for(let j=0;j<f.length;j++)if(w){const U=new s.ao(y.r*.8,y.g*.8,y.b*.8,1);Vd(g,o,f[j],y,-1,-1,E),Vd(g,o,f[j],y,-1,1,E),Vd(g,o,f[j],y,1,1,E),Vd(g,o,f[j],y,1,-1,E),Vd(g,o,f[j],U,0,0,E)}else Vd(g,o,f[j],y,0,0,E)}function Vd(g,o,f,y,w,E,j){const I=g.context,O=g.transform,U=I.gl,q=O.projection.name==="globe",X=q?["PROJECTION_GLOBE_VIEW"]:[];let Z=s.bz(f.projMatrix);if(q&&s.aj(O.zoom)>0){const Ye=s.bj(f.canonical,O),it=s.el(Ye);Z=s.aB(new Float32Array(16),O.globeMatrix,it),s.aB(Z,O.projMatrix,Z)}const J=s.bC();J[12]+=2*w/(s.o.devicePixelRatio*O.width),J[13]+=2*E/(s.o.devicePixelRatio*O.height),s.aB(Z,J,Z);const se=g.getOrCreateProgram("debug",{defines:X}),re=o.getTileByID(f.key);g.terrain&&g.terrain.setupElevationDraw(re,se);const oe=dr.disabled,he=Ir.disabled,xe=g.colorModeForRenderPass(),_e="$debug";I.activeTexture.set(U.TEXTURE0),g.emptyTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),q?re._makeGlobeTileDebugBuffers(g.context,O):re._makeDebugTileBoundsBuffers(g.context,O.projection);const ye=re._tileDebugBuffer||g.debugBuffer,Le=re._tileDebugIndexBuffer||g.debugIndexBuffer,ke=re._tileDebugSegments||g.debugSegments;if(se.draw(g,U.LINE_STRIP,oe,he,xe,Ar.disabled,_w(Z,y.toPremultipliedRenderColor(null)),_e,ye,Le,ke,null,null,null,[re._globeTileDebugBorderBuffer]),j){const Ye=re.latestRawTileData,it=Math.floor((Ye&&Ye.byteLength||0)/1024);let tt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(tt+=` => ${f.overscaledZ}`),tt+=` ${re.state}`,tt+=` ${it}kb`,function(vt,At){vt.initDebugOverlayCanvas();const et=vt.debugOverlayCanvas,Ue=vt.context.gl,ft=vt.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,et.width,et.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(At,5,5),ft.strokeText(At,5,5),vt.debugOverlayTexture.update(et),vt.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(g,tt)}const Re=o.getTile(f).tileSize,Ae=512/Math.min(Re,512)*(f.overscaledZ/O.zoom)*.5,Te=re._tileDebugTextBuffer||g.debugBuffer,$e=re._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Ze=re._tileDebugTextSegments||g.debugSegments;se.draw(g,U.TRIANGLES,oe,he,Lr.alphaBlended,Ar.disabled,_w(Z,s.ao.transparent.toPremultipliedRenderColor(null),Ae),_e,Te,$e,Ze,null,null,null,[re._globeTileDebugTextBuffer])}function hj(g,o,f,y){g_(g,0,o+f/2,g.transform.width,f,y)}function kw(g,o,f,y){g_(g,o-f/2,0,f,g.transform.height,y)}function g_(g,o,f,y,w,E){const j=g.context,I=j.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*s.o.devicePixelRatio,f*s.o.devicePixelRatio,y*s.o.devicePixelRatio,w*s.o.devicePixelRatio),j.clear({color:E}),I.disable(I.SCISSOR_TEST)}const fj=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:MO}=fj;function Ud(g,o,f,y){g.emplaceBack(o,f,y)}class Po{constructor(o){this.vertexArray=new s.em,this.indices=new s.b0,Ud(this.vertexArray,-1,-1,1),Ud(this.vertexArray,1,-1,1),Ud(this.vertexArray,-1,1,1),Ud(this.vertexArray,1,1,1),Ud(this.vertexArray,-1,-1,-1),Ud(this.vertexArray,1,-1,-1),Ud(this.vertexArray,-1,1,-1),Ud(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,MO),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function qd(g,o,f,y,w,E){const j=g.context.gl,I=o.paint.get("sky-atmosphere-color"),O=o.paint.get("sky-atmosphere-halo-color"),U=o.paint.get("sky-atmosphere-sun-intensity"),q=((X,Z,J,se,re)=>({u_matrix_3f:X,u_sun_direction:Z,u_sun_intensity:J,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[re.r,re.g,re.b,re.a],u_luminance:5e-5}))(s.eo(s.dO(),y),w,U,I.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+E,o.skyboxTexture,0),f.draw(g,j.TRIANGLES,dr.disabled,Ir.disabled,Lr.unblended,Ar.frontCW,q,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const oo=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gd{constructor(o){const f=new s.ep;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const y=new s.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(f,oo.members),this.indexBuffer=o.createIndexBuffer(y),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pj=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ow{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Rw{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Lr([1,Od,1,Od],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Lr([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Ow,this.updateNeeded=!0}update(o){const f=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Gd(f);const y=this.params.sizeRange,w=this.params.intensityRange,E=function(q){const X=s.eq(30),Z=[];for(let J=0;J<q;++J){const se=2*Math.PI*X(),re=Math.acos(1-2*X())-.5*Math.PI;Z.push(s.d5(Math.cos(re)*Math.cos(se),Math.cos(re)*Math.sin(se),Math.sin(re)))}return Z}(this.params.starsCount),j=s.eq(300),I=new s.er,O=new s.b0;let U=0;for(let q=0;q<E.length;++q){const X=s.c5([],E[q],200),Z=Math.max(0,1+.01*y*(1*j()-.5)),J=Math.max(0,1+.01*w*(1*j()-.5));I.emplaceBack(X[0],X[1],X[2],-1,-1,Z,J),I.emplaceBack(X[0],X[1],X[2],1,-1,Z,J),I.emplaceBack(X[0],X[1],X[2],1,1,Z,J),I.emplaceBack(X[0],X[1],X[2],-1,1,Z,J),O.emplaceBack(U+0,U+1,U+2),O.emplaceBack(U+0,U+2,U+3),U+=4}this.starsVx=f.createVertexBuffer(I,pj.members),this.starsIdx=f.createIndexBuffer(O),this.starsSegments=s.bg.simpleSegment(0,0,I.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,f){const y=o.context,w=y.gl,E=o.transform,j=new dr(w.LEQUAL,dr.ReadOnly,[0,1]),I=s.aj(E.zoom),O=o.style.getLut(f.scope),U=f.properties.get("color-use-theme")==="none",q=f.properties.get("color").toNonPremultipliedRenderColor(U?null:O),X=f.properties.get("high-color-use-theme")==="none",Z=f.properties.get("high-color").toNonPremultipliedRenderColor(X?null:O),J=f.properties.get("space-color-use-theme")==="none",se=f.properties.get("space-color").toNonPremultipliedRenderColor(J?null:O),re=5e-4,oe=s.es(f.properties.get("horizon-blend"),0,1,re,.25),he=s.dE(o,y,E)&&oe===re?E.worldSize/(2*Math.PI*1.025)-1:E.globeRadius,xe=o.frameCounter/1e3%1,_e=s.ag(E.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(_e,2)-Math.pow(he,2)),Le=Math.acos(ye/_e),ke=Re=>{const Ae=E.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Re&&Ae.push("ALPHA_PASS");const Te=o.getOrCreateProgram("globeAtmosphere",{defines:Ae}),$e=((Ye,it,tt,vt,At,et,Ue,ft,st,It,Mt,Zt)=>({u_frustum_tl:Ye,u_frustum_tr:it,u_frustum_br:tt,u_frustum_bl:vt,u_horizon:At,u_transition:et,u_fadeout_range:Ue,u_atmosphere_fog_color:ft.toArray01(),u_high_color:st.toArray01(),u_space_color:It.toArray01(),u_temporal_offset:Mt,u_horizon_angle:Zt}))(E.frustumCorners.TL,E.frustumCorners.TR,E.frustumCorners.BR,E.frustumCorners.BL,E.frustumCorners.horizon,I,oe,q,Z,se,xe,Le);o.uploadCommonUniforms(y,Te);const Ze=this.atmosphereBuffer;Ze&&Te.draw(o,w.TRIANGLES,j,Ir.disabled,Re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ar.backCW,$e,Re?"atmosphere_glow_alpha":"atmosphere_glow",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)};ke(!1),ke(!0)}drawStars(o,f){const y=s.aA(f.properties.get("star-intensity"),0,1);if(y===0)return;const w=o.context,E=w.gl,j=o.transform,I=o.getOrCreateProgram("stars"),O=s.c7([]);s.c9(O,O,-j._pitch),s.c8(O,O,-j.angle),s.c9(O,O,s.an(j._center.lat)),s.et(O,O,-s.an(j._center.lng));const U=s.cc(new Float32Array(16),O),q=s.aB([],j.starsProjMatrix,U),X=s.eo([],U),Z=s.eu([],X),J=[0,1,0];s.dQ(J,J,Z),s.c5(J,J,this.params.sizeMultiplier);const se=[1,0,0];s.dQ(se,se,Z),s.c5(se,se,this.params.sizeMultiplier);const re=(oe=J,he=se,xe=y,{u_matrix:Float32Array.from(q),u_up:oe,u_right:he,u_intensity_multiplier:xe});var oe,he,xe;o.uploadCommonUniforms(w,I),this.starsVx&&this.starsIdx&&I.draw(o,E.TRIANGLES,dr.disabled,Ir.disabled,this.colorModeAlphaBlendedWriteRGB,Ar.disabled,re,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Mw{constructor(){this.visibleTiles=[]}updateBorders(o,f){const y=[],w=[],E=o._getRenderableCoordinates(!1,!0);for(const O of E){const U=o.getTile(O);if(!U.hasData())continue;const q=U.getBucket(f);q&&(q.isEmpty()||(y.push(O.key),w.push({bucket:q,tileID:O.canonical})))}let j=y.length!==this.visibleTiles.length;if(!j){y.sort();for(let O=0;O<y.length;O++)if(y[O]!==this.visibleTiles[O]){j=!0;break}}if(!j)return;const I=new Set;this.visibleTiles=y,w.sort((O,U)=>O.tileID.z-U.tileID.z||O.tileID.x-U.tileID.x||O.tileID.y-U.tileID.y);for(const O of w){const U=new Array,q=new Array,X=O.bucket;for(const Z of X.featuresOnBorder)I.has(Z.featureId)?q.push(Z.footprintIndex):(I.add(Z.featureId),U.push(Z.footprintIndex));X.updateFootprintHiddenFlags(U,s.ev,!1),X.updateFootprintHiddenFlags(q,s.ev,!0)}}}function Dw(g,o){const f=[...g],y=o.cameraWorldSizeForFog/o.worldSize,w=s.bA([]);return s.cS(w,w,[y,y,1]),s.aB(f,w,f),s.aB(f,o.worldToFogMatrix,f),f}function yc(g,o,f,y,w){const E=f.material,j=y.context,{baseColorTexture:I,metallicRoughnessTexture:O}=E.pbrMetallicRoughness,{normalTexture:U,occlusionTexture:q,emissionTexture:X}=E;function Z(se,re,oe){if(se&&(g.push(re),j.activeTexture.set(j.gl.TEXTURE0+oe),se.gfxTexture)){const{minFilter:he,magFilter:xe,wrapS:_e,wrapT:ye}=se.sampler;se.gfxTexture.bindExtraParam(he,xe,_e,ye)}}Z(I,"HAS_TEXTURE_u_baseColorTexture",5),Z(O,"HAS_TEXTURE_u_metallicRoughnessTexture",6),Z(U,"HAS_TEXTURE_u_normalTexture",7),Z(q,"HAS_TEXTURE_u_occlusionTexture",8),Z(X,"HAS_TEXTURE_u_emissionTexture",9),w&&(w.texture||(w.texture=new s.d$(y.context,w.image,[w.image.height,w.image.height,w.image.height],j.gl.RGBA8)),j.activeTexture.set(j.gl.TEXTURE0+10),w.texture&&w.texture.bind(j.gl.LINEAR,j.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(f.texcoordBuffer)),f.colorBuffer&&(g.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(f.colorBuffer)),f.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(f.normalBuffer)),f.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(f.pbrBuffer)),E.alphaMode!=="OPAQUE"&&E.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),E.defined||g.push("DIFFUSE_SHADED");const J=y.shadowRenderer;J&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&g.push("NORMAL_OFFSET"))}function Wn(g,o,f,y,w,E){const j=g.modelOpacity,I=o.context,O=new dr(o.context.gl.LEQUAL,g.isLightMesh?dr.ReadOnly:dr.ReadWrite,o.depthRangeFor3D),U=o.transform,q=g.mesh,X=q.material,Z=X.pbrMetallicRoughness,J=o.style.fog;let se;se=o.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:s.aB([],y.zScaleMatrix,g.nodeModelMatrix),s.aB(se,y.negCameraPosMatrix,se);const re=s.bl([],se);s.eg(re,re);const oe=f.paint.get("model-color-use-theme").constantOr("default")==="none",he=f.paint.get("model-emissive-strength").constantOr(0),xe=c_(new Float32Array(g.worldViewProjection),new Float32Array(se),new Float32Array(re),null,o,j,Z.baseColorFactor,X.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,X,he,f,void 0,void 0,g.materialOverride,g.modelColor),_e={defines:[]},ye=[],Le=o.shadowRenderer;Le&&(Le.useNormalOffset=!1),yc(_e.defines,ye,q,o,oe?null:f.lut);let ke=null;if(J){const Te=Dw(g.nodeModelMatrix,o.transform);if(ke=new Float32Array(Te),U.projection.name!=="globe"){const $e=q.aabb.min,Ze=q.aabb.max,[Ye,it]=J.getOpacityForBounds(Te,$e[0],$e[1],Ze[0],Ze[1]);_e.overrideFog=Ye>=tr||it>=tr}}const Re=Xl(o,f.paint.get("model-cutoff-fade-range"));Re.shouldRenderCutoff&&_e.defines.push("RENDER_CUTOFF");const Ae=o.getOrCreateProgram("model",_e);o.uploadCommonUniforms(I,Ae,null,ke,Re),o.renderPass!=="shadow"&&Le&&Le.setupShadowsFromMatrix(g.nodeModelMatrix,Ae),Ae.draw(o,I.gl.TRIANGLES,O,w,E,q.material.doubleSided?Ar.disabled:Ar.backCCW,xe,f.id,q.vertexBuffer,q.indexBuffer,q.segments,f.paint,o.transform.zoom,void 0,ye)}function kg(g,o){return g.style._importedAsBasemap?"basemap":o.scope}function Og(g,o,f,y,w,E,j,I,O,U){const q=g.transform,X=!!o.isGeometryBloom&&o.isGeometryBloom;if(X&&g.renderPass==="shadow")return;const Z=q.projection.name==="globe"?s.eD(f,q):[...f];s.aB(Z,Z,o.globalMatrix);const J=s.aB([],y,Z);if(o.meshes)for(const se of o.meshes){const re=I.get(se.material.name);if(re&&re.opacity<=0)continue;if(se.material.alphaMode!=="BLEND"){j.push({mesh:se,depth:0,modelIndex:w,worldViewProjection:J,nodeModelMatrix:Z,isLightMesh:X,materialOverride:re,modelOpacity:O,modelColor:U});continue}const oe=s.af([],se.centroid,J);!q.isOrthographic&&oe[2]<=0||E.push({mesh:se,depth:oe[2],modelIndex:w,worldViewProjection:J,nodeModelMatrix:Z,isLightMesh:X,materialOverride:re,modelOpacity:O,modelColor:U})}if(o.children)for(const se of o.children)Og(g,se,f,y,w,E,j,I,O,U)}function yp(g,o,f,y){const w=f.shadowRenderer;if(!w)return;const E=w.getShadowPassDepthMode(),j=w.getShadowPassColorMode(),I=w.calculateShadowPassMatrixFromMatrix(o),O=Ng(I);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,E,Ir.disabled,j,Ar.disabled,O,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,f.transform.zoom,void 0,void 0)}function mj(g,o,f,y,w,E){for(const j of w){const I=Object.assign({},y);I.part=j;const O={type:"Unknown",id:o,properties:I},U={orientation:g.paint.get("model-rotation").evaluate(O,f)};E.set(j,U)}}function gj(g,o,f,y,w,E){for(const j of w){const I=Object.assign({},y);I.part=j;const O={type:"Unknown",id:o,properties:I},U={color:g.paint.get("model-color").evaluate(O,f),colorMix:g.paint.get("model-color-mix-intensity").evaluate(O,f),opacity:g.paint.get("model-opacity").evaluate(O,f),emissionStrength:g.paint.get("model-emissive-strength").evaluate(O,f)};E.set(j,U)}}function Lw(g,o,f,y,w){let E=!1;for(const I of y)I.modelOpacity!==1&&(Wn(I,g,o,w[I.modelIndex],Ir.disabled,Lr.disabled),E=!0);for(const I of y)Wn(I,g,o,w[I.modelIndex],I.modelOpacity!==1?g.stencilModeFor3D():Ir.disabled,g.colorModeForRenderPass());E&&g.resetStencilClippingMasks();const j=Lr.additive;for(const I of f)Wn(I,g,o,w[I.modelIndex],Ir.disabled,I.isLightMesh?j:g.colorModeForRenderPass())}function Xh(g,o,f){const y=o.updateZoomBasedPaintProperties(),w=function(E,j,I){let O,U,q,X=E.terrain?E.terrain.exaggeration():0;if(E.terrain&&X>0){const Z=E.terrain,J=Z.findDEMTileFor(I);J&&J.dem?O=s.eF.create(Z,I,J):X=0}if(X===0&&(j.terrainElevationMin=0,j.terrainElevationMax=0),X===j.validForExaggeration&&(X===0||O&&O._demTile&&O._demTile.tileID===j.validForDEMTile.id&&O._dem._timestamp===j.validForDEMTile.timestamp))return!1;for(const Z in j.instancesPerModel){const J=j.instancesPerModel[Z];for(let se=0;se<J.instancedDataArray.length;++se){const re=(O?X*O.getElevationAt(0|J.instancedDataArray.float32[16*se],0|J.instancedDataArray.float32[16*se+1],!0,!0):0)+J.instancesEvaluatedElevation[se];J.instancedDataArray.float32[16*se+6]=re,U=U?Math.min(j.terrainElevationMin,re):re,q=q?Math.max(j.terrainElevationMax,re):re}}return j.terrainElevationMin=U||0,j.terrainElevationMax=q||0,j.validForExaggeration=X,j.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,o,f);(y||w)&&(o.uploaded=!1,o.upload(g.context))}const lo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function Lt(g,o){const f=1<<g.canonical.z,y=o.getFreeCameraOptions().position,w=o.elevation,E=g.canonical.x/f,j=(g.canonical.x+1)/f,I=g.canonical.y/f,O=(g.canonical.y+1)/f;let U=o._centerAltitude;if(w){const J=w.getMinMaxForTile(g);J&&J.max>U&&(U=J.max)}const q=s.aA(y.x,E,j)-y.x,X=s.aA(y.y,I,O)-y.y,Z=s.cf(U,o.center.lat)-y.z;return o._zoomFromMercatorZ(Math.sqrt(q*q+X*X+Z*Z))}function Kt(g,o,f,y,w,E,j){const I=g.context,O=g.renderPass==="shadow",U=g.shadowRenderer,q=O&&U?U.getShadowPassDepthMode():new dr(I.gl.LEQUAL,dr.ReadWrite,g.depthRangeFor3D),X=g.isTileAffectedByFog(E),Z=g.transform.projection.name==="globe";if(f.meshes)for(const J of f.meshes){const se=Z?[]:["MODEL_POSITION_ON_GPU"],re=[];let oe,he,xe;const _e=!Z&&y.instancedDataArray.length>20;_e&&se.push("INSTANCED_ARRAYS");const ye=Xl(g,o.paint.get("model-cutoff-fade-range"));if(ye.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),O&&U)oe=g.getOrCreateProgram("modelDepth",{defines:se}),he=Ng(j.shadowTileMatrix,j.shadowTileMatrix,Float32Array.from(f.globalMatrix)),xe=U.getShadowPassColorMode();else{yc(se,re,J,g,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),oe=g.getOrCreateProgram("model",{defines:se,overrideFog:X});const ke=J.material,Re=ke.pbrMetallicRoughness,Ae=o.paint.get("model-opacity").constantOr(1),Te=o.paint.get("model-emissive-strength").constantOr(0);he=c_(E.expandedProjMatrix,Float32Array.from(f.globalMatrix),new Float32Array(16),null,g,Ae,Re.baseColorFactor,ke.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,ke,Te,o,w),U&&(j.shadowUniformsInitialized?oe.setShadowUniformValues(I,U.getShadowUniformValues()):(U.setupShadows(E.toUnwrapped(),oe,"model-tile"),j.shadowUniformsInitialized=!0)),xe=ye.shouldRenderCutoff||Ae<1||ke.alphaMode!=="OPAQUE"?Lr.alphaBlended:Lr.unblended}g.uploadCommonUniforms(I,oe,E.toUnwrapped(),null,ye);const Le=J.material.doubleSided?Ar.disabled:Ar.backCCW;if(_e)re.push(y.instancedDataBuffer),oe.draw(g,I.gl.TRIANGLES,q,Ir.disabled,xe,Le,he,o.id,J.vertexBuffer,J.indexBuffer,J.segments,o.paint,g.transform.zoom,void 0,re,y.instancedDataArray.length);else{const ke=O?"u_instance":"u_normal_matrix";for(let Re=0;Re<y.instancedDataArray.length;++Re)he[ke]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Re,16),oe.draw(g,I.gl.TRIANGLES,q,Ir.disabled,xe,Le,he,o.id,J.vertexBuffer,J.indexBuffer,J.segments,o.paint,g.transform.zoom,void 0,re)}}if(f.children)for(const J of f.children)Kt(g,o,J,y,w,E,j)}const vp=[1,-1,1];function Mi(g,o,f,y){if(!f.modelManager)return!0;const w=f.modelManager;if(!f.shadowRenderer)return!0;const E=f.shadowRenderer,j=o.aabb;let I=!0,O=g.maxHeight;if(O===0){let q=0;for(const X in g.instancesPerModel){const Z=w.getModel(X,y);Z?q=Math.max(q,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):I=!1}O=g.maxScale*q*1.41+g.maxVerticalOffset,I&&(g.maxHeight=O)}j.max[2]=O,j.min[2]+=g.terrainElevationMin,j.max[2]+=g.terrainElevationMax,s.af(j.min,j.min,o.tileMatrix),s.af(j.max,j.max,o.tileMatrix);const U=j.intersects(E.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=U===2),U===0}function Qe(g,o){const f=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],w=g.uniformValues.u_cutoff_params[2],E=g.uniformValues.u_cutoff_params[3];return y===f||E===w?1:s.aA(((o-f)/(y-f)-w)/(E-w),0,1)}function yj(g,o,f,y){if(o.pitch<20)return 1;const w=o.getWorldToCameraMatrix();s.aB(w,w,g);const E=s.bU(f.min[0],f.min[1],f.min[2],1);let j=s.aC(s.eG(),E,w),I=j,O=j;E[1]=f.max[1],j=s.aC(s.eG(),E,w),I=j[1]<I[1]?j:I,O=j[1]>O[1]?j:O,E[0]=f.max[0],j=s.aC(s.eG(),E,w),I=j[1]<I[1]?j:I,O=j[1]>O[1]?j:O,E[1]=f.min[1],j=s.aC(s.eG(),E,w),I=j[1]<I[1]?j:I,O=j[1]>O[1]?j:O;const U=s.aA(y[0],0,1),q=100*o.pixelsPerMeter*s.aA(y[1],0,1),X=s.aA(y[2],0,1),Z=s.eH(s.eG(),I,O,U),J=Math.tan(.5*o.fovX),se=-Z[2]*J;if(q===0)return Z[1]<-Math.abs(se)?X:1;const re=(-Math.abs(se)-Z[1])/q,oe=(xe,_e,ye)=>(1-ye)*xe+ye*_e,he=s.aA(oe(1,X,re),X,1);return oe(1,he,s.aA((o.pitch-20)/20,0,1))}class y_{}class Fw{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,f,y){{const X=this._storage.get(f.id);if(X)return X.lastUsedFrameIdx=o,X.buf}const w=y.gl,E=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),j=new ArrayBuffer(E),I=new Int16Array(j);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(j));const O=new s.eJ;for(let X=0;X<E/2;X+=3){const Z=I[X],J=I[X+1],se=I[X+2];O.emplaceBack(Z,J),O.emplaceBack(J,se),O.emplaceBack(se,Z)}const U=y.bindVertexArrayOES.current,q=new y_;return q.buf=new Qc(y,O),q.lastUsedFrameIdx=o,this._storage.set(f.id,q),y.bindVertexArrayOES.set(U),q.buf}update(o){for(const[f,y]of this._storage)o-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(f))}destroy(){for(const[o,f]of this._storage)f.buf.destroy(),this._storage.delete(o)}}class zw{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const vj=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Bw{constructor(o){this.revealStart=11,this.revealRange=2}}const _p=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class DO{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,f){const y=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const j=new s.eK,I=new s.b0;j.emplaceBack(-1,-1),j.emplaceBack(1,-1),j.emplaceBack(1,1),j.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(j,_p.members),this.vignetteIdx=o.context.createIndexBuffer(I)}const w=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,y);const j={u_vignetteShape:(E={vignetteShape:[f.start,f.range,Math.pow(10,f.fadePower)],vignetteColor:[f.color.r,f.color.g,f.color.b,f.color.a*f.strength]}).vignetteShape,u_vignetteColor:E.vignetteColor};y.draw(o,o.context.gl.TRIANGLES,dr.disabled,Ir.disabled,Lr.alphaBlended,Ar.disabled,j,"vignette",this.vignetteVx,this.vignetteIdx,w)}var E}}class LO{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,f){const y=o.getFreeCameraOptions().position,w=y.toAltitude(),E=y.toLngLat(),j=s.an(E.lng),I=s.an(E.lat),O=o.pixelsPerMeter/f,U=j*s.eM,q=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const X=-this._offsetYPrev+q,Z=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+U)*O,this._accumulatedOffsetY+=X*O,this._accumulatedElevation+=Z*O,this._offsetXPrev=U,this._offsetYPrev=q,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function $w(g,o){return[-(g[0]-Math.floor(g[0]/o)*o),-(g[1]-Math.floor(g[1]/o)*o),-(g[2]-Math.floor(g[2]/o)*o)]}function Rg(g){const o=s.eq(1323123451230),f=[];for(let y=0;y<g;++y){const w=2*o()-1,E=2*o()-1,j=2*o()-1;f.push(s.d5(w,E,j))}return f}function tu(g,o,f,y,w){const E=s.aA((w-f)/(y-f),0,1);return(1-E)*g+E*o}class Vw{constructor(o){this._movement=new LO,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new DO,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,f){const y=o.transform;this._movement.update(y,this._ppmScaleFactor);const w=y.starsProjMatrix,E=s.c7([]);s.c9(E,E,s.an(90)-y._pitch),s.c8(E,E,-y.angle);const j=s.cc(new Float32Array(16),E),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=s.eg([],I),U=s.aB([],O,j),q=Date.now()/1e3;return this._accumulatedTimeFromStart+=(q-this._prevTime)*f,this._prevTime=q,{projectionMatrix:w,modelviewMatrix:U}}}class _j extends Vw{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Bw("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const f=o.context;if(!this.particlesVx){const y=Rg(this.particlesCount),w=new s.eN,E=new s.b0;let j=0;const I=s.eq(1323123451230);for(let O=0;O<y.length;++O){const U=y[O],q=[2*I()-1,I(),I(),I()];w.emplaceBack(U[0],U[1],U[2],-1,-1,...q),w.emplaceBack(U[0],U[1],U[2],1,-1,...q),w.emplaceBack(U[0],U[1],U[2],1,1,...q),w.emplaceBack(U[0],U[1],U[2],-1,1,...q),E.emplaceBack(j+0,j+1,j+2),E.emplaceBack(j+0,j+2,j+3),j+=4}this.particlesVx=f.createVertexBuffer(w,vj.members),this.particlesIdx=f.createIndexBuffer(E)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const f=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=o.transform.zoom;if(f.revealStart>y)return;const w=tu(0,1,f.revealStart,f.revealStart+f.revealRange,y);if(!this.particlesVx||!this.particlesIdx)return;const E=structuredClone(this._params);let j=[-E.direction.x,E.direction.y,-100];s.aw(j,j);const I=structuredClone(this._vignetteParams);I.strength*=w,E.overrideStyleParameters||(E.intensity=o.style.rain.state.density,E.timeFactor=o.style.rain.state.intensity,E.color=structuredClone(o.style.rain.state.color),j=structuredClone(o.style.rain.state.direction),E.screenThinning.intensity=o.style.rain.state.centerThinning,E.dropletSizeX=o.style.rain.state.dropletSize[0],E.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],E.distortionStrength=100*o.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(o.style.rain.state.vignetteColor));const O=this.updateOnRender(o,E.timeFactor),U=o.context,q=U.gl,X=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new s.T(U,{width:o.width,height:o.height,data:null},q.RGBA8)),E.distortionStrength>0&&(U.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),q.copyTexSubImage2D(q.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Z=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(U,Z),U.activeTexture.set(q.TEXTURE0),this.screenTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const J=[E.color.r,E.color.g,E.color.b,E.color.a],se=(re,oe)=>{const he=$w(this._movement.getPosition(),re),xe=E.dropletSizeX,_e=E.dropletSizeX*E.dropletSizeYScale,ye=o.width/2,Le=o.height/2,ke=tu(0,E.screenThinning.start,0,1,E.screenThinning.intensity),Re=tu(.001,E.screenThinning.range,0,1,E.screenThinning.intensity),Ae=tu(0,E.screenThinning.particleOffset,0,1,E.screenThinning.intensity),Te=($e={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:he,velocityConeAperture:E.velocityConeAperture,velocity:E.velocity,boxSize:re,rainDropletSize:[xe,_e],distortionStrength:E.distortionStrength,rainDirection:j,color:J,screenSize:[X.width,X.height],thinningCenterPos:[ye,Le],thinningShape:[ke,Re,Math.pow(10,E.screenThinning.fadePower)],thinningAffectedRatio:E.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:E.shapeDirPower,shapeNormalPower:E.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from($e.modelview),u_projection:Float32Array.from($e.projection),u_time:$e.time,u_cam_pos:$e.camPos,u_texScreen:0,u_velocityConeAperture:$e.velocityConeAperture,u_velocity:$e.velocity,u_boxSize:$e.boxSize,u_rainDropletSize:$e.rainDropletSize,u_distortionStrength:$e.distortionStrength,u_rainDirection:$e.rainDirection,u_color:$e.color,u_screenSize:$e.screenSize,u_thinningCenterPos:$e.thinningCenterPos,u_thinningShape:$e.thinningShape,u_thinningAffectedRatio:$e.thinningAffectedRatio,u_thinningParticleOffset:$e.thinningParticleOffset,u_shapeDirectionalPower:$e.shapeDirectionalPower,u_shapeNormalPower:$e.shapeNormalPower,u_mode:$e.mode});var $e;const Ze=Math.round(E.intensity*this.particlesCount),Ye=s.bg.simpleSegment(0,0,4*Ze,2*Ze);Z.draw(o,q.TRIANGLES,dr.disabled,Ir.disabled,Lr.alphaBlended,Ar.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Ye)};E.distortionStrength>0&&se(E.boxSize,!0),se(E.boxSize,!1),this._vignette.draw(o,I)}}const v_=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Mg extends Vw{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Bw("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const f=o.context;if(!this.particlesVx){const y=Rg(this.particlesCount),w=new s.eO,E=new s.b0;let j=0;const I=s.eq(1323123451230);for(let O=0;O<y.length;++O){const U=y[O],q=I(),X=I(),Z=I(),J=[O/y.length,q,X,Z],se=[I(),I()];w.emplaceBack(U[0],U[1],U[2],-1,-1,...J,...se),w.emplaceBack(U[0],U[1],U[2],1,-1,...J,...se),w.emplaceBack(U[0],U[1],U[2],1,1,...J,...se),w.emplaceBack(U[0],U[1],U[2],-1,1,...J,...se),E.emplaceBack(j+0,j+1,j+2),E.emplaceBack(j+0,j+2,j+3),j+=4}this.particlesVx=f.createVertexBuffer(w,v_.members),this.particlesIdx=f.createIndexBuffer(E)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const f=structuredClone(this._params);let y=[-f.direction.x,f.direction.y,-100];s.aw(y,y);const w=structuredClone(this._vignetteParams),E=f.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},j=o.transform.zoom;if(E.revealStart>j)return;const I=tu(0,1,E.revealStart,E.revealStart+E.revealRange,j);w.strength*=I,f.overrideStyleParameters||(f.intensity=o.style.snow.state.density,f.timeFactor=o.style.snow.state.intensity,f.color=structuredClone(o.style.snow.state.color),y=structuredClone(o.style.snow.state.direction),f.screenThinning.intensity=o.style.snow.state.centerThinning,f.billboardSize=2.79*o.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(o.style.snow.state.vignetteColor));const O=this.updateOnRender(o,f.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const U=o.context,q=U.gl,X=o.transform,Z=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(U,Z),((J,se,re)=>{const oe=$w(this._movement.getPosition(),J),he=X.width/2,xe=X.height/2,_e=tu(0,re.screenThinning.start,0,1,re.screenThinning.intensity),ye=tu(.001,re.screenThinning.range,0,1,re.screenThinning.intensity),Le=tu(0,re.screenThinning.particleOffset,0,1,re.screenThinning.intensity),ke=(Re={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:re.velocityConeAperture,velocity:re.velocity,horizontalOscillationRadius:re.horizontalOscillationRadius,horizontalOscillationRate:re.horizontalOscillationRate,boxSize:J,billboardSize:1*re.billboardSize,simpleShapeParameters:[re.shapeFadeStart,re.shapeFadePower],screenSize:[X.width,X.height],thinningCenterPos:[he,xe],thinningShape:[_e,ye,Math.pow(10,re.screenThinning.fadePower)],thinningAffectedRatio:re.screenThinning.affectedRatio,thinningParticleOffset:Le,color:[re.color.r,re.color.g,re.color.b,re.color.a],direction:y},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_horizontalOscillationRadius:Re.horizontalOscillationRadius,u_horizontalOscillationRate:Re.horizontalOscillationRate,u_boxSize:Re.boxSize,u_billboardSize:Re.billboardSize,u_simpleShapeParameters:Re.simpleShapeParameters,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_particleColor:Re.color,u_direction:Re.direction});var Re;const Ae=Math.round(re.intensity*this.particlesCount),Te=s.bg.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&Z.draw(o,q.TRIANGLES,dr.disabled,Ir.disabled,Lr.alphaBlended,Ar.disabled,ke,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(f.boxSize,0,f),this._vignette.draw(o,w)}}const Kh={symbol:function(g,o,f,y,w){if(g.renderPass!=="translucent")return;const E=Ir.disabled,j=g.colorModeForRenderPass(),I=f.layout.get("text-variable-anchor"),O=f.layout.get("text-size-scale-range"),U=s.aA(g.scaleFactor,O[0],O[1]);I&&function(Z,J,se,re,oe,he,xe,_e){const ye=J.transform,Le=oe==="map",ke=he==="map";for(const Re of Z){const Ae=re.getTile(Re),Te=Ae.getBucket(se);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const $e=s.bK(Te.textSizeData,ye.zoom,_e),Ze=Qf(Re,Te.getProjection(),ye),Ye=ye.calculatePixelsToTileUnitsMatrix(Ae),it=zh(Ze,Ae.tileID.canonical,ke,Le,ye,Te.getProjection(),Ye),tt=Te.hasIconTextFit()&&Te.hasIconData();$e&&rj(Te,Le,ke,xe,ye,it,Re,Math.pow(2,ye.zoom-Ae.tileID.overscaledZ),$e,tt)}}(y,g,f,o,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),w,U);const q=f.paint.get("icon-opacity").constantOr(1)!==0,X=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(q||X)?h_(g,o,f,y,E,j):(q&&h_(g,o,f,y,E,j,{onlyIcons:!0}),X&&h_(g,o,f,y,E,j,{onlyText:!0})),o.map.showCollisionBoxes&&(ww(g,o,f,y,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ww(g,o,f,y,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,f,y){if(g.renderPass!=="translucent")return;const w=f.paint.get("circle-opacity"),E=f.paint.get("circle-stroke-width"),j=f.paint.get("circle-stroke-opacity"),I=f.layout.get("circle-sort-key").constantOr(1)!==void 0,O=f.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(E.constantOr(1)===0||j.constantOr(1)===0))return;const U=g.context,q=U.gl,X=g.transform,Z=!(!g.terrain||!g.terrain.enabled),J=f.layout.get("circle-elevation-reference"),se=g.depthModeForSublayer(0,dr.ReadOnly),re=new dr(g.context.gl.LEQUAL,dr.ReadOnly,g.depthRangeFor3D),oe=J==="none"||Z?se:re,he=Ir.disabled,xe=g.colorModeForDrapableLayerRenderPass(O),_e=X.projection.name==="globe",ye=[s.aF(X.center.lng),s.aJ(X.center.lat)],Le=[];for(let Re=0;Re<y.length;Re++){const Ae=y[Re],Te=o.getTile(Ae),$e=Te.getBucket(f);if(!$e||$e.projection.name!==X.projection.name)continue;const Ze=$e.programConfigurations.get(f.id),Ye=$e.layoutVertexBuffer,it=$e.globeExtVertexBuffer,tt=$e.indexBuffer,vt=s.e0(f),At=[it],et=g.isTileAffectedByFog(Ae);_e&&vt.push("PROJECTION_GLOBE_VIEW"),vt.push("DEPTH_D24"),g.terrain&&X.depthOcclusionForSymbolsAndCircles&&vt.push("DEPTH_OCCLUSION"),$e.hasElevation&&!g.terrain&&(vt.push("ELEVATED_ROADS"),At.push($e.elevatedLayoutVertexBuffer));const Ue=g.getOrCreateProgram("circle",{config:Ze,defines:vt,overrideFog:et}),ft=X.projection.createInversionMatrix(X,Ae.canonical),st={programConfiguration:Ze,program:Ue,layoutVertexBuffer:Ye,dynamicBuffers:At,indexBuffer:tt,uniformValues:s.e1(g,Ae,Te,ft,ye,f),tile:Te};if(I){const It=$e.segments.get();for(const Mt of It)Le.push({segments:new s.bg([Mt]),sortKey:Mt.sortKey,state:st})}else Le.push({segments:$e.segments,sortKey:0,state:st})}I&&Le.sort((Re,Ae)=>Re.sortKey-Ae.sortKey);const ke={useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles};for(const Re of Le){const{programConfiguration:Ae,program:Te,layoutVertexBuffer:$e,dynamicBuffers:Ze,indexBuffer:Ye,uniformValues:it,tile:tt}=Re.state,vt=Re.segments;g.terrain&&g.terrain.setupElevationDraw(tt,Te,ke),g.uploadCommonUniforms(U,Te,tt.tileID.toUnwrapped()),Te.draw(g,q.TRIANGLES,oe,he,xe,Ar.disabled,it,f.id,$e,Ye,vt,f.paint,X.zoom,Ae,Ze)}},heatmap:function(g,o,f,y){if(f.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const w=g.context,E=w.gl,j=Ir.disabled,I=new Lr([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(J,se,re,oe){const he=J.gl,xe=se.width*oe,_e=se.height*oe;J.activeTexture.set(he.TEXTURE1),J.viewport.set([0,0,xe,_e]);let ye=re.heatmapFbo;if(!ye||ye&&(ye.width!==xe||ye.height!==_e)){ye&&ye.destroy();const Le=he.createTexture();he.bindTexture(he.TEXTURE_2D,Le),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.LINEAR),ye=re.heatmapFbo=J.createFramebuffer(xe,_e,1,null),function(ke,Re,Ae,Te,$e,Ze){const Ye=ke.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,ke.extRenderToTextureHalfFloat?Ye.RGBA16F:Ye.RGBA,$e,Ze,0,Ye.RGBA,ke.extRenderToTextureHalfFloat?Ye.HALF_FLOAT:Ye.UNSIGNED_BYTE,null),Te.colorAttachment0.set(Ae)}(J,0,Le,ye,xe,_e)}else he.bindTexture(he.TEXTURE_2D,ye.colorAttachment0.get()),J.bindFramebuffer.set(ye.framebuffer)})(w,g,f,g.transform.projection.name==="globe"?.5:.25),w.clear({color:s.ao.transparent});const O=g.transform,U=O.projection.name==="globe",q=U?["PROJECTION_GLOBE_VIEW"]:[],X=U?Ar.frontCCW:Ar.disabled,Z=[s.aF(O.center.lng),s.aJ(O.center.lat)];for(let J=0;J<y.length;J++){const se=y[J];if(o.hasRenderableParent(se))continue;const re=o.getTile(se),oe=re.getBucket(f);if(!oe||oe.projection.name!==O.projection.name)continue;const he=g.isTileAffectedByFog(se),xe=oe.programConfigurations.get(f.id),_e=g.getOrCreateProgram("heatmap",{config:xe,defines:q,overrideFog:he}),{zoom:ye}=g.transform;g.terrain&&g.terrain.setupElevationDraw(re,_e),g.uploadCommonUniforms(w,_e,se.toUnwrapped());const Le=O.projection.createInversionMatrix(O,se.canonical);_e.draw(g,E.TRIANGLES,dr.disabled,j,I,X,xw(g,se,re,Le,Z,ye,f.paint.get("heatmap-intensity")),f.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,f.paint,g.transform.zoom,xe,U?[oe.globeExtVertexBuffer]:null)}w.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(w,E){const j=w.context,I=j.gl,O=E.heatmapFbo;if(!O)return;j.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment0.get()),j.activeTexture.set(I.TEXTURE1);let U=E.colorRampTexture;U||(U=E.colorRampTexture=new s.T(j,E.colorRamp,I.RGBA8)),U.bind(I.LINEAR,I.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,I.TRIANGLES,dr.disabled,Ir.disabled,w.colorModeForRenderPass(),Ar.disabled,((q,X)=>({u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}))(0,E),E.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,E.paint,w.transform.zoom)}(g,f))},line:function(g,o,f,y){if(g.renderPass!=="translucent")return;const w=f.paint.get("line-opacity"),E=f.paint.get("line-width");if(w.constantOr(1)===0||E.constantOr(1)===0)return;const j=f.paint.get("line-emissive-strength").isConstant(),I=f.paint.get("line-emissive-strength").constantOr(0),O=f.paint.get("line-occlusion-opacity"),U=f.layout.get("line-elevation-reference"),q=f.layout.get("line-width-unit")==="meters",X=U==="sea",Z=!(!g.terrain||!g.terrain.enabled),J=g.context,se=J.gl;if(f.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const re=f.layout.get("line-cross-slope"),oe=re!==void 0,he=re<1,xe=g.colorModeForDrapableLayerRenderPass(j?I:null),_e=g.terrain&&g.terrain.renderingToTexture,ye=_e?1:s.o.devicePixelRatio,Le=f.paint.get("line-dasharray"),ke=Le.constantOr(1),Re=f.layout.get("line-cap"),Ae=Le.constantOr(null),Te=Re.constantOr(null),$e=f.paint.get("line-pattern"),Ze=$e.constantOr(1),Ye=f.paint.get("line-pattern-cross-fade"),it=$e.constantOr(null),tt=f.paint.get("line-opacity").constantOr(1);let vt=!Ze&&tt!==1||g.depthOcclusion&&O>0&&O<1;const At=f.paint.get("line-gradient"),et=Ze?"linePattern":"line",Ue=s.e2(f);let ft;if(_e&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(vt=!1),O!==0&&g.depthOcclusion){const Zt=f.paint._values["line-opacity"];Zt&&Zt.value&&Zt.value.kind==="constant"?ft=Zt.value:s.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}E.value.kind!=="constant"&&E.value.isLineProgressConstant===!1&&Ue.push("VARIABLE_LINE_WIDTH"),_e&&(g.emissiveMode!=="dual-source-blending"||j?g.emissiveMode==="mrt-fallback"&&Ue.push("USE_MRT1"):Ue.push("DUAL_SOURCE_BLENDING"));const st=(Zt,Dt,$t,lr,or,Jt)=>{for(const sr of Zt){const vr=o.getTile(sr);if(Ze&&!vr.patternsLoaded())continue;const Cr=vr.getBucket(f);if(!Cr||Cr.elevationType!=="none"&&!or||Cr.elevationType==="none"&&or)continue;g.prepareDrawTile();const Gr=[...Dt],un=g.shadowRenderer,Mr=Cr.elevationType==="road"&&!!un&&un.enabled;let xn=[0,0,0];if(Mr){const Ur=g.style.directionalLight,si=g.style.ambientLight;Ur&&si&&(xn=Kl(g.style,Ur,si)),Gr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Br=Cr.programConfigurations.get(f.id);let $n=!1;if(it&&vr.imageAtlas){const Ur=s.e3.from(it),si=Ur.getPrimary().scaleSelf(ye).toString(),Di=vr.imageAtlas.patternPositions.get(si),ci=Ur.getSecondary(),fi=ci?vr.imageAtlas.patternPositions.get(ci.scaleSelf(ye).toString()):null;$n=!!Di&&!!fi,Di&&Br.setConstantPatternPositions(Di,fi)}Ye>0&&($n||Br.getPatternTransitionVertexBuffer("line-pattern"))&&Gr.push("LINE_PATTERN_TRANSITION");const Ln=g.isTileAffectedByFog(sr),Un=g.getOrCreateProgram(et,{config:Br,defines:Gr,overrideFog:Ln});if(!Ze&&Ae&&Te&&vr.lineAtlas){const Ur=vr.lineAtlas.getDash(Ae,Te);Ur&&Br.setConstantPatternPositions(Ur)}Mr&&un.setupShadows(vr.tileID.toUnwrapped(),Un,"vector-tile");let[hn,Vr]=f.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&hn!==Vr&&(hn===0&&(hn-=1),Vr===1&&(Vr+=1));const An=_e?sr.projMatrix:null,wi=q?1/Cr.tileToMeter/s.ay(vr,1,g.transform.zoom):1,Si=q?1/Cr.tileToMeter/s.ay(vr,1,Math.floor(g.transform.zoom)):1,Cn=Ze?s.e4(g,vr,f,An,ye,wi,Si,[hn,Vr],xn,Ye):s.e5(g,vr,f,An,Cr.lineClipsArray.length,ye,wi,Si,[hn,Vr],xn);if(At){const Ur=Cr.gradients[f.id];let si=Ur.texture;if(f.gradientVersion!==Ur.version){let Di=256;if(f.stepInterpolant){const ci=o.getSource().maxzoom,fi=sr.canonical.z===ci?Math.ceil(1<<g.transform.maxZoom-sr.canonical.z):1;Di=s.aA(s.e6(Cr.maxLineLength/s.al*1024*fi),256,J.maxTextureSize)}Ur.gradient=s.e7({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Di,image:Ur.gradient||void 0,clips:Cr.lineClipsArray}),Ur.texture?Ur.texture.update(Ur.gradient):Ur.texture=new s.T(J,Ur.gradient,se.RGBA8),Ur.version=f.gradientVersion,si=Ur.texture}J.activeTexture.set(se.TEXTURE1),si.bind(f.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}ke&&(J.activeTexture.set(se.TEXTURE0),vr.lineAtlasTexture&&vr.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Br.updatePaintBuffers()),Ze&&(J.activeTexture.set(se.TEXTURE0),vr.imageAtlasTexture&&vr.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Br.updatePaintBuffers()),or&&!X&&g.terrain.setupElevationDraw(vr,Un),g.uploadCommonUniforms(J,Un,sr.toUnwrapped());const an=Ur=>{ft!=null&&(ft.value=tt*O),Un.draw(g,se.TRIANGLES,$t,Ur,xe,Ar.disabled,Cn,f.id,Cr.layoutVertexBuffer,Cr.indexBuffer,Cr.segments,f.paint,g.transform.zoom,Br,[Cr.layoutVertexBuffer2,Cr.patternVertexBuffer,Cr.zOffsetVertexBuffer]),ft!=null&&(ft.value=tt)};if(vt&&!or){const Ur=g.stencilModeForClipping(sr).ref;Ur===0&&_e&&J.clear({stencil:0});const si={func:se.EQUAL,mask:255};Cn.u_alpha_discard_threshold=.8,an(new Ir(si,Ur,255,se.KEEP,se.KEEP,se.INVERT)),Cn.u_alpha_discard_threshold=0,an(new Ir(si,Ur,255,se.KEEP,se.KEEP,se.KEEP))}else Cn.u_alpha_discard_threshold=vt&&or&&Jt?.8:0,an(or?lr:g.stencilModeForClipping(sr))}};let It=g.depthModeForSublayer(0,dr.ReadOnly);const Mt=new dr(g.depthOcclusion?se.GREATER:se.LEQUAL,dr.ReadOnly,g.depthRangeFor3D);if(f.hasNonElevatedBuckets){const Zt=!_e&&g.terrain;O!==0&&Zt?s.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has line-z-offset enabled.`):Zt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${f.id}.`):st(y,Ue,It,Ir.disabled,!1,!0)}if(f.hasElevatedBuckets){U==="hd-road-markup"?Z||(It=Mt,Ue.push("ELEVATED_ROADS")):(Ue.push("ELEVATED"),It=Mt,oe&&Ue.push(he?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),X&&Ue.push("ELEVATION_REFERENCE_SEA"));const Zt=vt?g.stencilModeFor3D():Ir.disabled;g.forceTerrainMode=!0,st(y,Ue,It,Zt,!0,!0),vt&&st(y,Ue,It,Zt,!0,!1),g.forceTerrainMode=!1}vt&&(g.resetStencilClippingMasks(),_e&&J.clear({stencil:0})),O===0||g.depthOcclusion||_e||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,o,f,y){const w=f.paint.get("fill-color"),E=f.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const j=f.paint.get("fill-emissive-strength"),I=g.colorModeForDrapableLayerRenderPass(j),O=f.paint.get("fill-pattern"),U=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&w.constantOr(s.ao.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";let q="none";f.layout.get("fill-elevation-reference")!=="none"?q="road":f.paint.get("fill-z-offset").constantOr(1)!==0&&(q="offset");const X=!(!g.terrain||!g.terrain.enabled),Z={painter:g,sourceCache:o,layer:f,coords:y,colorMode:I,elevationType:q,terrainEnabled:X,pass:U};if(g.renderPass==="shadow")return void(g.shadowRenderer&&q==="road"&&!X&&function(se){const{painter:re,sourceCache:oe,layer:he,coords:xe}=se,_e=re.context.gl,ye=se.painter.shadowRenderer;for(const Le of xe){const ke=oe.getTile(Le),Re=ke.getBucket(he);if(!Re)continue;const Ae=Re.elevatedStructures;if(!Ae||!Ae.shadowCasterSegments||Ae.shadowCasterSegments.segments[0].primitiveLength===0)continue;re.prepareDrawTile();const Te=Re.bufferData.programConfigurations.get(he.id),$e=re.isTileAffectedByFog(Le),Ze=re.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:$e}),Ye=ye.calculateShadowPassMatrixFromTile(ke.tileID.toUnwrapped());re.uploadCommonUniforms(re.context,Ze,Le.toUnwrapped());const it=yw(Ye,0);Ze.draw(re,_e.TRIANGLES,ye.getShadowPassDepthMode(),Ir.disabled,ye.getShadowPassColorMode(),Ar.disabled,it,he.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.shadowCasterSegments,he.paint,re.transform.zoom,Te)}}(Z));const J=g.emissiveMode==="mrt-fallback";if(q!=="offset"){if(pp(Z,!1,J),q==="road"){const se=!X&&g.renderPass==="translucent";se&&Tw(g,o,f,y,"geometry"),pp(Z,!0,J,Ir.disabled),se&&function(re){const{painter:oe,sourceCache:he,layer:xe,coords:_e,colorMode:ye}=re,Le=oe.context.gl,ke=re.painter.shadowRenderer,Re=!!ke&&ke.enabled,Ae=new dr(oe.context.gl.LEQUAL,dr.ReadOnly,oe.depthRangeFor3D);let Te=[0,0,0];if(Re){const Ze=oe.style.directionalLight,Ye=oe.style.ambientLight;Ze&&Ye&&(Te=Kl(oe.style,Ze,Ye))}const $e=Ze=>{for(const Ye of _e){const it=he.getTile(Ye),tt=it.getBucket(xe);if(!tt)continue;const vt=tt.elevatedStructures;if(!vt)continue;let At,et;if(Ze?(At=vt.renderableBridgeSegments,et=vt.bridgeProgramConfigurations.get(xe.id)):(At=vt.renderableTunnelSegments,et=vt.tunnelProgramConfigurations.get(xe.id)),!At||At.segments[0].primitiveLength===0)continue;et.updatePaintBuffers(),oe.prepareDrawTile();const Ue=oe.isTileAffectedByFog(Ye),ft=[];Re&&ft.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const st=oe.getOrCreateProgram("elevatedStructures",{config:et,overrideFog:Ue,defines:ft}),It=oe.translatePosMatrix(Ye.projMatrix,it,xe.paint.get("fill-translate"),xe.paint.get("fill-translate-anchor"));Re&&ke.setupShadows(it.tileID.toUnwrapped(),st,"vector-tile");const Mt=zd(It,Te);oe.uploadCommonUniforms(oe.context,st,Ye.toUnwrapped()),st.draw(oe,Le.TRIANGLES,Ae,Ir.disabled,ye,Ar.backCCW,Mt,xe.id,vt.vertexBuffer,vt.indexBuffer,At,xe.paint,oe.transform.zoom,et,[vt.vertexBufferNormal])}};$e(!0),$e(!1)}(Z)}}else pp(Z,!1,J,g.stencilModeFor3D())},"fill-extrusion":function(g,o,f,y){const w=f.paint.get("fill-extrusion-opacity"),E=g.context,j=E.gl,I=g.terrain,O=I&&I.renderingToTexture;if(w===0)return;const U=g.emissiveMode==="mrt-fallback",q=g.conflationActive&&g.style.isLayerClipped(f,o.getSource()),X=g.style.order.indexOf(f.fqid);if(q&&function(Z,J,se,re,oe){for(const he of re){const xe=J.getTile(he).getBucket(se);xe&&(xe.updateReplacement(he,Z.replacementSource,oe),xe.uploadCentroid(Z.context))}}(g,o,f,y,X),I||q)for(const Z of y){const J=o.getTile(Z).getBucket(f);J&&nj(g.context,o,Z,J,f,I,q)}if(g.renderPass==="shadow"&&g.shadowRenderer){const Z=g.shadowRenderer;if(I&&w<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const J=Z.getShadowPassDepthMode(),se=Z.getShadowPassColorMode();mp(g,o,f,y,J,Ir.disabled,se,q)}else if(g.renderPass==="translucent"){const Z=!f.paint.get("fill-extrusion-pattern").constantOr(1),J=f.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!O&&J.a!==0){const se=new dr(g.context.gl.LEQUAL,dr.ReadWrite,g.depthRangeFor3D);w===1&&Z?mp(g,o,f,y,se,Ir.disabled,Lr.unblended,q):(mp(g,o,f,y,se,Ir.disabled,Lr.disabled,q),mp(g,o,f,y,se,g.stencilModeFor3D(),g.colorModeForRenderPass(),q),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&Z&&(!I&&g.transform.projection.name!=="globe"||O)){const se=f.paint.get("fill-extrusion-opacity"),re=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),he=f.paint.get("fill-extrusion-flood-light-intensity"),xe=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",_e=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:f.lut).toArray01().slice(0,3),ye=re>0&&oe>0,Le=he>0,ke=(Te,$e,Ze)=>(1-Ze)*Te+Ze*$e,Re=new Ig;Re.translate=f.paint.get("fill-extrusion-translate"),Re.translateAnchor=f.paint.get("fill-extrusion-translate-anchor"),Re.edgeRadius=f.layout.get("fill-extrusion-edge-radius"),Re.cutoffFadeRange=f.paint.get("fill-extrusion-cutoff-fade-range");const Ae=Te=>{const $e=g.depthModeForSublayer(1,dr.ReadOnly,j.LEQUAL,!0),Ze=f.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=ke(.1,3,Ze),it=g._showOverdrawInspector;if(!it){const tt=new Ir({func:j.ALWAYS,mask:255},255,255,j.KEEP,j.KEEP,j.REPLACE),vt=new Lr([j.ONE,j.ONE,j.ONE,j.ONE],s.ao.transparent,[!1,!1,!1,!0],j.MIN);eu(Re,g,o,f,y,$e,tt,vt,Ar.disabled,Te,"sdf",se,re,oe,he,_e,Ye,q,!1)}{const tt=it?Ir.disabled:new Ir({func:j.EQUAL,mask:255},255,255,j.KEEP,j.DECR,j.DECR),vt=it?g.colorModeForRenderPass():new Lr([j.ONE_MINUS_DST_ALPHA,j.DST_ALPHA,j.ONE,j.ONE],s.ao.transparent,[!0,!0,!0,!0]);eu(Re,g,o,f,y,$e,tt,vt,Ar.disabled,Te,"color",se,re,oe,he,_e,Ye,q,!1)}};if(O){const Te=()=>{const Ze=I.drapeBufferSize[0],Ye=I.drapeBufferSize[1];let it=I.framebufferCopyTexture;return it&&(!it||it.size[0]===Ze&&it.size[1]===Ye)||(it&&it.destroy(),it=I.framebufferCopyTexture=new s.T(E,new s.q({width:Ze,height:Ye}),j.RGBA8)),it.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,Ze,Ye),it},$e=(Ze,Ye,it)=>{const tt=g.depthModeForSublayer(1,dr.ReadOnly,j.LEQUAL,!1),vt=f.paint.get(Ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),At=ke(.1,3,vt);{const et=new Lr([j.ONE,j.ONE,j.ONE,j.ONE],s.ao.transparent,[!1,!1,!1,!0]);eu(Re,g,o,f,y,tt,Ir.disabled,et,Ar.disabled,Ze,"clear",se,re,oe,he,_e,At,q,Ye)}{const et=new Ir({func:j.ALWAYS,mask:255},255,255,j.KEEP,j.KEEP,j.REPLACE),Ue=new Lr([j.ONE,j.ONE,j.ONE,j.ONE],s.ao.transparent,[!1,!1,!1,!0],j.MIN);eu(Re,g,o,f,y,tt,et,Ue,Ar.disabled,Ze,"sdf",se,re,oe,he,_e,At,q,Ye)}U&&!Ze&&(it=Te());{const et=Ze?j.ZERO:j.ONE_MINUS_DST_ALPHA,Ue=new Ir({func:j.EQUAL,mask:255},255,255,j.KEEP,j.DECR,j.DECR),ft=new Lr([et,j.DST_ALPHA,j.ONE_MINUS_DST_ALPHA,j.ZERO],s.ao.transparent,[!0,!0,!0,!0]);eu(Re,g,o,f,y,tt,Ue,ft,Ar.disabled,Ze,"color",se,re,oe,he,_e,At,q,Ye)}if(!U||Ze){const et=new Lr([j.ONE,j.ONE,j.ONE,Ze?j.ZERO:j.ONE],s.ao.transparent,[!1,!1,!1,!0],Ze?j.FUNC_ADD:j.MAX);eu(Re,g,o,f,y,tt,Ir.disabled,et,Ar.disabled,Ze,"clear",se,re,oe,he,_e,At,q,Ye,it)}else{j.drawBuffers([j.NONE,j.COLOR_ATTACHMENT1]);const et=new Ir({func:j.EQUAL,mask:255},254,255,j.KEEP,j.DECR,j.DECR),Ue=new Lr([j.ONE,j.ONE,j.ONE,j.ONE],s.ao.transparent,[!0,!1,!1,!1],j.MAX);eu(Re,g,o,f,y,tt,et,Ue,Ar.disabled,Ze,"emissive",se,re,oe,he,_e,At,q,Ye,it),j.drawBuffers([j.COLOR_ATTACHMENT0])}};if(ye||Le){let Ze;g.prepareDrawTile(),U&&!ye||(Ze=Te()),ye&&$e(!0,!1,Ze),Le&&$e(!1,!0,Ze)}}else ye&&Ae(!0),Le&&Ae(!1),(ye||Le)&&g.resetStencilClippingMasks()}}},building:function(g,o,f,y){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);const w=f.paint.get("building-ambient-occlusion-ground-intensity"),E=f.paint.get("building-ambient-occlusion-ground-radius"),j=f.paint.get("building-ambient-occlusion-ground-attenuation"),I=f.paint.get("building-opacity");if(I<=0)return;let O=w>0&&E>0,U=!0;const q=f.paint.get("building-vertical-scale");if(q<=0)return;g.shadowRenderer||(U=!1);const X=g.conflationActive&&g.style.isLayerClipped(f,o.getSource()),Z=g.style.order.indexOf(f.fqid);if(function(J,se,re,oe,he,xe){for(const _e of xe){const ye=se.getTile(_e).getBucket(re);ye&&(he&&ye.updateReplacement(_e,J.replacementSource,oe),ye.uploadUpdatedIndexBuffer(J.context))}}(g,o,f,Z,X,y),function(J,se,re,oe){for(const he of oe){const xe=se.getTile(he).getBucket(re);xe&&xe.needsEvaluation()&&xe.uploadUpdatedColorBuffer(J.context)}}(g,o,f,y),f.resetLayerRenderingStats(g),g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0),g.renderPass==="shadow"&&g.shadowRenderer){const J=g.shadowRenderer,se=[],re=J.getShadowPassDepthMode();gp({painter:g,source:o,layer:f,coords:y,defines:se,blendMode:J.getShadowPassColorMode(),depthMode:re,opacity:I,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(g.renderPass==="translucent"){let J=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];U&&(J=J.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),g.shadowRenderer&&g.shadowRenderer.useNormalOffset&&(J=J.concat("NORMAL_OFFSET"));const se=f.paint.get("building-facade-emissive-chance"),re=f.paint.get("building-ambient-occlusion-intensity"),oe=f.paint.get("building-flood-light-intensity"),he=f.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",xe=f.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(he?null:f.lut).toArray01().slice(0,3),_e=f.paint.get("building-flood-light-ground-attenuation"),ye=oe>0,Le=new dr(g.context.gl.LEQUAL,dr.ReadWrite,g.depthRangeFor3D);I<1&&gp({painter:g,source:o,layer:f,coords:y,defines:J,blendMode:Lr.disabled,depthMode:Le,opacity:I,verticalScale:q,facadeEmissiveChance:se,facadeAOIntensity:re,floodLightIntensity:oe,floodLightColor:xe,depthOnly:!0});const ke=g.colorModeForRenderPass();gp({painter:g,source:o,layer:f,coords:y,defines:J,blendMode:ke,depthMode:Le,opacity:I,verticalScale:q,facadeEmissiveChance:se,facadeAOIntensity:re,floodLightIntensity:oe,floodLightColor:xe}),O&&p_(g,o,f,y,!0,I,w,E,oe,xe,j,X),ye&&p_(g,o,f,y,!1,I,w,E,oe,xe,_e,X)}else if(g.renderPass==="light-beam"){const J=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],se=new dr(g.context.gl.LEQUAL,dr.ReadOnly,g.depthRangeFor3D);gp({painter:g,source:o,layer:f,coords:y,defines:J,blendMode:Lr.alphaBlended,depthMode:se,opacity:I,verticalScale:q,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1),g.resetStencilClippingMasks()},hillshade:function(g,o,f,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const w=g.context,E=g.terrain&&g.terrain.renderingToTexture,[j,I]=g.renderPass!=="translucent"||E?[{},y]:g.stencilConfigForOverlap(y);for(const O of I){const U=o.getTile(O);if(U.needsHillshadePrepare&&g.renderPass==="offscreen")wO(g,U,f);else if(g.renderPass==="translucent"){const q=g.depthModeForSublayer(0,dr.ReadOnly),X=f.paint.get("hillshade-emissive-strength"),Z=g.colorModeForDrapableLayerRenderPass(X),J=E&&g.terrain?g.terrain.stencilModeForRTTOverlap(O):j[O.overscaledZ];bO(g,O,U,f,q,J,Z)}}w.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,o,f,y,w,E){if(g.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const j=g.transform.projection.name==="globe",I=f.paint.get("raster-elevation")!==0,O=I&&j;if(g.renderElevatedRasterBackface&&!O)return;const U=g.context,q=U.gl,X=o.getSource(),Z=function(ke,Re,Ae,Te,$e){const Ze=Re.paint.get("raster-color"),Ye=ke.type==="raster-array",it=[],tt=Re.paint.get("raster-resampling"),vt=Re.paint.get("raster-color-mix");let At=Re.paint.get("raster-color-range");const et=[vt[0],vt[1],vt[2],0],Ue=vt[3];let ft=tt==="nearest"?Te.NEAREST:Te.LINEAR;if(Ye&&(it.push("RASTER_ARRAY"),Ze||it.push("RASTER_COLOR"),tt==="linear"&&it.push("RASTER_ARRAY_LINEAR"),ft=Te.NEAREST,!At&&ke.rasterLayers)){const st=ke.rasterLayers.find(({id:It})=>It===Re.sourceLayer);st&&st.fields&&st.fields.range&&(At=st.fields.range)}if(At=At||[0,1],Ze){it.push("RASTER_COLOR"),Ae.activeTexture.set(Te.TEXTURE2),Re.updateColorRamp(At);let st=Re.colorRampTexture;st||(st=Re.colorRampTexture=new s.T(Ae,Re.colorRamp,Te.RGBA8)),st.bind(ft,Te.CLAMP_TO_EDGE)}return $e&&it.push("USE_MRT1"),{mix:et,range:At,offset:Ue,defines:it,resampling:ft}}(X,f,U,q,g.terrain&&g.terrain.renderingToTexture&&g.emissiveMode==="mrt-fallback");if(X instanceof s.aU&&!y.length&&!j)return;const J=f.paint.get("raster-emissive-strength"),se=g.colorModeForDrapableLayerRenderPass(J),re=g.terrain&&g.terrain.renderingToTexture,oe=!g.options.moving,he=f.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;if(X instanceof s.aU&&!y.length&&(X.onNorthPole||X.onSouthPole)){const ke=I?g.stencilModeFor3D():Ir.disabled;return void m_(!!X.onNorthPole,null,g,o,f,J,Z,Ar.disabled,ke)}if(!y.length)return;const[xe,_e]=X instanceof s.aU||re?[{},y]:g.stencilConfigForOverlap(y),ye=_e[_e.length-1].overscaledZ;O&&Z.defines.push("PROJECTION_GLOBE_VIEW"),I&&Z.defines.push("RENDER_CUTOFF");const Le=(ke,Re,Ae)=>{for(const Te of ke){const $e=Te.toUnwrapped(),Ze=o.getTile(Te);if(re&&(!Ze||!Ze.hasData()))continue;U.activeTexture.set(q.TEXTURE0);const Ye=lj(Ze,X,f,Z);if(!Ye||!Ye.texture)continue;const{texture:it,mix:tt,offset:vt,tileSize:At,buffer:et}=Ye;let Ue,ft;re?(Ue=dr.disabled,ft=Te.projMatrix):I?(Ue=new dr(q.LEQUAL,dr.ReadWrite,g.depthRangeFor3D),ft=j?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix($e,oe)):(Ue=g.depthModeForSublayer(Te.overscaledZ-ye,f.paint.get("raster-opacity")===1?dr.ReadWrite:dr.ReadOnly,q.LESS),ft=g.transform.calculateProjMatrix($e,oe));const st=g.terrain&&re?g.terrain.stencilModeForRTTOverlap(Te):xe[Te.overscaledZ],It=E?0:f.paint.get("raster-fade-duration");Ze.registerFadeDuration(It);const Mt=o.findLoadedParent(Te,0),Zt=jg(Ze,Mt,o,g.transform,It);let Dt,$t;!Zt.isFading&&Ze.refreshedUponExpiration&&(Ze.refreshedUponExpiration=!1),g.terrain&&g.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),it.bind(he,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),Mt?(Mt.texture&&Mt.texture.bind(he,q.CLAMP_TO_EDGE),Dt=Math.pow(2,Mt.tileID.overscaledZ-Ze.tileID.overscaledZ),$t=[Ze.tileID.canonical.x*Dt%1,Ze.tileID.canonical.y*Dt%1]):it.bind(he,q.CLAMP_TO_EDGE),"useMipmap"in it&&U.extTextureFilterAnisotropic&&g.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const lr=g.transform;let or;const Jt=I?oj(lr):[0,0,0,0];let sr,vr,Cr,Gr,un,Mr=0;if(O&&X instanceof s.aU&&X.coordinates.length>3)sr=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),vr=Float32Array.from(lr.globeMatrix),Cr=Float32Array.from(s.dF(lr)),Gr=[s.aF(lr.center.lng),s.aJ(lr.center.lat)],or=X.elevatedGlobePerspectiveTransform,un=X.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Ln=s.dG(Te.canonical);Mr=s.dH(Ln.getCenter().lat),sr=Float32Array.from(s.bk(s.dJ(Te.canonical))),vr=Float32Array.from(lr.globeMatrix),Cr=Float32Array.from(s.dF(lr)),Gr=[s.aF(lr.center.lng),s.aJ(lr.center.lat)],or=[0,0],un=Float32Array.from(s.dI(Te.canonical,Ln,Mr,lr.worldSize/lr._pixelsPerMercatorPixel))}else or=X instanceof s.aU?X.perspectiveTransform:[0,0],sr=new Float32Array(16),vr=new Float32Array(9),Cr=new Float32Array(16),Gr=[0,0],un=new Float32Array(9);const xn=bw(ft,sr,vr,Cr,un,$t||[0,0],s.aj(g.transform.zoom),Gr,Jt,Dt||1,Zt,f,or,I?f.paint.get("raster-elevation"):0,2,tt,vt,Z.range,At,et,J),Br=g.isTileAffectedByFog(Te),$n=g.getOrCreateProgram("raster",{defines:Z.defines,overrideFog:Br});if(g.uploadCommonUniforms(U,$n,$e),X instanceof s.aU){const Ln=X.elevatedGlobeVertexBuffer,Un=X.elevatedGlobeIndexBuffer;if(re||!j)X.boundsBuffer&&X.boundsSegments&&$n.draw(g,q.TRIANGLES,Ue,Ir.disabled,se,Ar.disabled,xn,f.id,X.boundsBuffer,g.quadTriangleIndexBuffer,X.boundsSegments);else if(Ln&&Un){const hn=lr.zoom<=s.c_?X.elevatedGlobeSegments:X.getSegmentsForLongitude(lr.center.lng);hn&&$n.draw(g,q.TRIANGLES,Ue,Ir.disabled,se,Re,xn,f.id,Ln,Un,hn)}}else if(O){Ue=new dr(q.LEQUAL,dr.ReadOnly,g.depthRangeFor3D);const Ln=g.globeSharedBuffers;if(Ln){const[Un,hn,Vr]=Ln.getGridBuffers(Mr,!1);$n.draw(g,q.TRIANGLES,Ue,Ae||st,g.colorModeForRenderPass(),Re,xn,f.id,Un,hn,Vr)}}else{const{tileBoundsBuffer:Ln,tileBoundsIndexBuffer:Un,tileBoundsSegments:hn}=g.getTileBoundsBuffers(Ze);$n.draw(g,q.TRIANGLES,Ue,st,se,Ar.disabled,xn,f.id,Ln,Un,hn)}}if(!(X instanceof s.aU)&&O)for(const Te of ke){const $e=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&m_(!0,Te,g,o,f,J,Z,Re,Ae||Ir.disabled),$e&&m_(!1,Te,g,o,f,J,Z,Re===Ar.frontCW?Ar.backCW:Ar.frontCW,Ae||Ir.disabled)}};O?Le(_e,g.renderElevatedRasterBackface?Ar.backCW:Ar.frontCW,g.stencilModeFor3D()):Le(_e,Ar.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,o,f,y,w,E){g.renderPass==="offscreen"&&function(j,I,O,U){if(!U.length)return;const q=j.context,X=q.gl,Z=I.getSource();if(!(Z instanceof io))return;const J=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let se=O.particlePositionRGBAImage;if(!se||se.width!==J){const _e=function(ye){const Le=ye*ye,ke=new Uint8Array(4*Le),Re=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ae=.9090909090909091;for(let Te=0;Te<Le;Te++){const $e=Ae*(Re(2*Te+0)+fp),Ze=Ae*(Re(2*Te+1)+fp),Ye=255*$e%1,it=255*Ze%1,tt=Ye,vt=Ze-it/255,At=it;ke[4*Te+0]=255*($e-Ye/255),ke[4*Te+1]=255*tt,ke[4*Te+2]=255*vt,ke[4*Te+3]=255*At}return ke}(J);se=O.particlePositionRGBAImage=new s.q({width:J,height:J},_e)}let re=O.particleFramebuffer;re?re.width!==J&&(re.destroy(),re=O.particleFramebuffer=q.createFramebuffer(J,J,1,null)):re=O.particleFramebuffer=q.createFramebuffer(J,J,1,null);const oe=[];for(const _e of U){const ye=I.getTile(_e);if(!(ye instanceof Iv))continue;const Le=Cw(ye,Z,O);if(!Le)continue;const ke=[ye.tileSize,ye.tileSize];let Re=O.tileFramebuffer;Re||(Re=O.tileFramebuffer=q.createFramebuffer(ke[0],ke[1],1,null));let Ae=ye.rasterParticleState;Ae||(Ae=ye.rasterParticleState=new cj(q,_e,ke,se));const Te=Ae.update(O.lastInvalidatedAt);Ae.particleTextureDimension!==J&&Ae.updateParticleTexture(_e,se);const $e=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=$e;const Ze=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=Ze,oe.push([_e,Le,Ae,Te])}if(oe.length===0)return;const he=s.o.now(),xe=O.previousDrawTimestamp?.001*(he-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=he,O.hasColorMap()){q.activeTexture.set(X.TEXTURE0+2);let _e=O.colorRampTexture;_e||(_e=O.colorRampTexture=new s.T(q,O.colorRamp,X.RGBA8)),_e.bind(X.LINEAR,X.CLAMP_TO_EDGE)}q.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(_e,ye,Le){const ke=_e.context,Re=ke.gl,Ae=ye.tileFramebuffer;ke.activeTexture.set(Re.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Ze=ye.paint.get("raster-particle-fade-opacity-factor"))/(Ze+.05)},$e=_e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ze;for(const Ye of Le){const[,,it,tt]=Ye;Ae.colorAttachment0.set(it.targetColorTexture.texture),ke.viewport.set([0,0,Ae.width,Ae.height]),ke.clear({color:s.ao.transparent}),tt&&(it.backgroundColorTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE),$e.draw(_e,Re.TRIANGLES,dr.disabled,Ir.disabled,Lr.alphaBlended,Ar.disabled,Te,ye.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments))}}(j,O,oe),function(_e,ye,Le,ke){const Re=_e.context,Ae=Re.gl,Te=Le.tileFramebuffer,$e=_e.transform.projection.name==="globe",Ze=Le.paint.get("raster-particle-max-speed");for(const Ye of ke){const[it,tt,vt]=Ye;Re.activeTexture.set(Ae.TEXTURE0+0),tt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Te.colorAttachment0.set(vt.targetColorTexture.texture);const At=_e.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});Re.activeTexture.set(Ae.TEXTURE0+1);const et=tt.scalarData?[]:[0,1,2,3].map(st=>s.e9[st](it));et.push(it);const Ue=it.canonical.x,ft=it.canonical.y;for(const st of et){const It=ye.getTile($e?st.wrapped():st);if(!It)continue;const Mt=It.rasterParticleState;if(!Mt)continue;const Zt=st.canonical.x+(1<<st.canonical.z)*(st.wrap-it.wrap),Dt=st.canonical.y;Mt.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const $t=QE(1,Mt.particleTexture0.size[0],[Zt-Ue,Dt-ft],0,tt.texture.size,2,Ze,tt.textureOffset,tt.scale,tt.offset);At.draw(_e,Ae.POINTS,dr.disabled,Ir.disabled,Lr.alphaBlended,Ar.disabled,$t,Le.id,Mt.particleIndexBuffer,void 0,Mt.particleSegment)}}}(j,I,O,oe),q.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(_e,ye,Le,ke){const Re=_e.context,Ae=Re.gl,Te=ye.paint.get("raster-particle-max-speed"),$e=ke*ye.paint.get("raster-particle-speed-factor")*.15,Ze=function(it){return Math.pow(it,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Ye=ye.particleFramebuffer;Re.viewport.set([0,0,Ye.width,Ye.height]);for(const it of Le){const[,tt,vt]=it;Re.activeTexture.set(Ae.TEXTURE0+0),tt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.activeTexture.set(Ae.TEXTURE0+1);const At=vt.particleTexture0;At.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const et=IO(1,At.size[0],0,tt.texture.size,Te,$e,Ze,tt.textureOffset,tt.scale,tt.offset);Ye.colorAttachment0.set(vt.particleTexture1.texture),Re.clear({color:s.ao.transparent}),_e.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(_e,Ae.TRIANGLES,dr.disabled,Ir.disabled,Lr.unblended,Ar.disabled,et,ye.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments)}}(j,O,oe,xe)}(g,o,f,y),g.renderPass==="translucent"&&(function(j,I,O,U){const q=j.context,X=q.gl,Z=I.getSource().tileSize,J=5*(1-s.ah(s.cL,s.cL+1,j.transform.zoom))*Z+O.paint.get("raster-particle-elevation"),se=!j.options.moving,re=j.transform.projection.name==="globe";if(!U.length)return;const[oe,he]=j.stencilConfigForOverlap(U),xe=[];re&&xe.push("PROJECTION_GLOBE_VIEW");const _e=j.stencilModeFor3D();for(const ye of he){const Le=ye.toUnwrapped(),ke=I.getTile(ye);if(!ke.rasterParticleState)continue;const Re=ke.rasterParticleState,Ae=100;ke.registerFadeDuration(Ae);const Te=I.findLoadedParent(ye,0),$e=jg(ke,Te,I,j.transform,Ae);let Ze,Ye;j.terrain&&j.terrain.prepareDrawTile(),q.activeTexture.set(X.TEXTURE0),Re.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),q.activeTexture.set(X.TEXTURE1),Te&&Te.rasterParticleState?(Te.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Ze=Math.pow(2,Te.tileID.overscaledZ-ke.tileID.overscaledZ),Ye=[ke.tileID.canonical.x*Ze%1,ke.tileID.canonical.y*Ze%1]):Re.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const it=re?Float32Array.from(j.transform.expandedFarZProjMatrix):j.transform.calculateProjMatrix(Le,se),tt=j.transform,vt=uj(tt),At=s.dG(ye.canonical),et=s.dH(At.getCenter().lat);let Ue,ft,st,It,Mt;re?(Ue=Float32Array.from(s.bk(s.dJ(ye.canonical))),ft=Float32Array.from(tt.globeMatrix),st=Float32Array.from(s.dF(tt)),It=[s.aF(tt.center.lng),s.aJ(tt.center.lat)],Mt=Float32Array.from(s.dI(ye.canonical,At,et,tt.worldSize/tt._pixelsPerMercatorPixel))):(Ue=new Float32Array(16),ft=new Float32Array(9),st=new Float32Array(16),It=[0,0],Mt=new Float32Array(9));const Zt=NO(it,Ue,ft,st,Mt,Ye||[0,0],s.aj(j.transform.zoom),It,vt,Ze||1,$e,J),Dt=j.isTileAffectedByFog(ye),$t=j.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:Dt});if(j.uploadCommonUniforms(q,$t,Le),re){const lr=new dr(X.LEQUAL,dr.ReadOnly,j.depthRangeFor3D),or=0,Jt=j.globeSharedBuffers;if(Jt){const[sr,vr,Cr]=Jt.getGridBuffers(et,or!==0);$t.draw(j,X.TRIANGLES,lr,_e,Lr.alphaBlended,j.renderElevatedRasterBackface?Ar.frontCCW:Ar.backCCW,Zt,O.id,sr,vr,Cr)}}else{const lr=j.depthModeForSublayer(0,dr.ReadOnly),or=oe[ye.overscaledZ],{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:sr,tileBoundsSegments:vr}=j.getTileBoundsBuffers(ke);$t.draw(j,X.TRIANGLES,lr,or,Lr.alphaBlended,Ar.disabled,Zt,O.id,Jt,sr,vr)}}j.resetStencilClippingMasks()}(g,o,f,y),g.style.map.triggerRepaint())},background:function(g,o,f,y){const w=f.paint.get("background-color"),E=f.paint.get("background-color-use-theme").constantOr("default")==="none",j=f.paint.get("background-opacity"),I=f.paint.get("background-emissive-strength"),O=f.paint.get("background-pitch-alignment")==="viewport";if(j===0)return;const U=g.context,q=U.gl,X=g.transform,Z=X.tileSize,J=f.paint.get("background-pattern");let se;if(J!==void 0&&(J===null||(se=g.imageManager.getPattern(s.I.from(J.toString()),f.scope,g.style.getLut(f.scope)),!se)))return;const re=!J&&w.a===1&&j===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==re)return;const oe=Ir.disabled,he=g.depthModeForSublayer(0,re==="opaque"?dr.ReadWrite:dr.ReadOnly),xe=g.colorModeForDrapableLayerRenderPass(I),_e=J?"backgroundPattern":"background";let ye,Le=y;Le||(ye=g.getBackgroundTiles(),Le=Object.values(ye).map(Re=>Re.tileID)),J&&(U.activeTexture.set(q.TEXTURE0),g.imageManager.bind(g.context,f.scope));const ke=[];if(g.terrain&&g.terrain.renderingToTexture&&g.emissiveMode==="mrt-fallback"&&ke.push("USE_MRT1"),O){const Re=g.getOrCreateProgram(_e,{overrideFog:!1,overrideRtt:!0,defines:ke}),Ae=new Float32Array(s.bA([])),Te=new s.aQ(0,0,0,0,0),$e=J?Pg(Ae,I,j,g,0,f.scope,se,O,{tileID:Te,tileSize:Z}):$d(Ae,I,j,w.toPremultipliedRenderColor(E?null:f.lut));return void Re.draw(g,q.TRIANGLES,he,oe,xe,Ar.disabled,$e,f.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}for(const Re of Le){const Ae=g.isTileAffectedByFog(Re),Te=g.getOrCreateProgram(_e,{overrideFog:Ae,defines:ke}),$e=Re.toUnwrapped(),Ze=y?Re.projMatrix:g.transform.calculateProjMatrix($e);g.prepareDrawTile();const Ye=o?o.getTile(Re):ye?ye[Re.key]:new Nd(Re,Z,X.zoom,g),it=J?Pg(Ze,I,j,g,0,f.scope,se,O,{tileID:Re,tileSize:Z}):$d(Ze,I,j,w.toPremultipliedRenderColor(E?null:f.lut));g.uploadCommonUniforms(U,Te,$e);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:vt,tileBoundsSegments:At}=g.getTileBoundsBuffers(Ye);Te.draw(g,q.TRIANGLES,he,oe,xe,Ar.disabled,it,f.id,tt,vt,At)}},sky:function(g,o,f){const y=g._atmosphere?s.aj(g.transform.zoom):1,w=f.paint.get("sky-opacity")*y;if(w===0)return;const E=g.context,j=f.paint.get("sky-type"),I=new dr(E.gl.LEQUAL,dr.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;j==="atmosphere"?g.renderPass==="offscreen"?f.needsSkyboxCapture(g)&&(function(U,q){const X=U.context,Z=X.gl;let J=q.skyboxFbo;if(!J){J=q.skyboxFbo=X.createFramebuffer(32,32,1,null),q.skyboxGeometry=new Po(X),q.skyboxTexture=X.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,q.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let he=0;he<6;++he)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(J.framebuffer),X.viewport.set([0,0,32,32]);const se=q.getCenter(U,!0),re=U.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);s.bA(oe),s.en(oe,oe,.5*-Math.PI),qd(U,q,re,oe,se,0),s.bA(oe),s.en(oe,oe,.5*Math.PI),qd(U,q,re,oe,se,1),s.bA(oe),s.cU(oe,oe,.5*-Math.PI),qd(U,q,re,oe,se,2),s.bA(oe),s.cU(oe,oe,.5*Math.PI),qd(U,q,re,oe,se,3),s.bA(oe),qd(U,q,re,oe,se,4),s.bA(oe),s.en(oe,oe,Math.PI),qd(U,q,re,oe,se,5),X.viewport.set([0,0,U.width,U.height])}(g,f),f.markSkyboxValid(g)):g.renderPass==="sky"&&function(U,q,X,Z,J){const se=U.context,re=se.gl,oe=U.transform,he=U.getOrCreateProgram("skybox");se.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,q.skyboxTexture);const xe=((_e,ye,Le,ke,Re)=>({u_matrix:_e,u_sun_direction:ye,u_cubemap:0,u_opacity:ke,u_temporal_offset:Re}))(oe.skyboxMatrix,q.getCenter(U,!1),0,Z,J);U.uploadCommonUniforms(se,he),he.draw(U,re.TRIANGLES,X,Ir.disabled,U.colorModeForRenderPass(),Ar.backCW,xe,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(g,f,I,w,O):j==="gradient"&&g.renderPass==="sky"&&function(U,q,X,Z,J){const se=U.context,re=se.gl,oe=U.transform,he=U.getOrCreateProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new Po(se)),se.activeTexture.set(re.TEXTURE0);let xe=q.colorRampTexture;xe||(xe=q.colorRampTexture=new s.T(se,q.colorRamp,re.RGBA8)),xe.bind(re.LINEAR,re.CLAMP_TO_EDGE);const _e=((ye,Le,ke,Re,Ae)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Le,u_radius:s.an(ke),u_opacity:Re,u_temporal_offset:Ae}))(oe.skyboxMatrix,q.getCenter(U,!1),q.paint.get("sky-gradient-radius"),Z,J);U.uploadCommonUniforms(se,he),he.draw(U,re.TRIANGLES,X,Ir.disabled,U.colorModeForRenderPass(),Ar.backCW,_e,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(g,f,I,w,O)},custom:function(g,o,f,y){const w=g.context,E=f.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&f.isDraped(o)){if(g.renderPass==="offscreen"){const j=E.prerender;if(j){if(g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;j.call(E,w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else j.call(E,w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const I=E.renderToTile;if(I){const O=y[0].canonical,U={x:O.x+y[0].wrap*(E.wrapTileId?0:1<<O.z),y:O.y,z:O.z};w.setDepthMode(dr.disabled),w.setStencilMode(Ir.disabled),w.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(E,w.gl,U),w.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),w.setColorMode(g.colorModeForRenderPass()),w.setStencilMode(Ir.disabled);const j=E.renderingMode==="3d"?new dr(g.context.gl.LEQUAL,dr.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,dr.ReadOnly);if(w.setDepthMode(j),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;E.render(w.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else E.render(w.gl,g.transform.customLayerMatrix());w.setDirty(),g.setBaseState(),w.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,o,f,y){if(g.renderPass==="opaque")return;const w=f.paint.get("model-opacity").constantOr(1),E=f.paint.get("model-elevation-reference"),j=E==="ground",I=E==="ground";if(w===0)return;const O=f.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!O||g.terrain&&w<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const U=g.shadowRenderer,q=f.paint.get("model-receive-shadows");U&&(U.useNormalOffset=!0,q||(U.enabled=!1));const X=()=>{U&&(U.useNormalOffset=!0,q||(U.enabled=!0))},Z=o.getSource();if(g.renderPass==="light-beam"&&Z.type!=="batched-model")return;if(Z.type==="vector"||Z.type==="geojson")return function(ye,Le,ke,Re,Ae){const Te=ye.transform,$e=Te.projection.name==="globe",Ze=Te.getFreeCameraOptions().position;if(!ye.modelManager)return;const Ye=ye.modelManager;ke.modelManager=Ye;const it=ye.shadowRenderer;if(!ke._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const tt=ke._unevaluatedLayout._values["model-id"],vt=Object.assign({},ke.layout.get("model-id").parameters),At=ye.style.order.indexOf(ke.fqid),et=ke.paint.get("model-opacity").constantOr(1);for(const Ue of Re){const ft=Le.getTile(Ue).getBucket(ke);if(!ft||ft.projection.name!==Te.projection.name)continue;const st=ft.getModelUris();if(st&&!ft.modelsRequested&&(Ye.addModelsFromBucket(st,Ae),ft.modelsRequested=!0),$e)vt.zoom=Ue.overscaledZ;else{const Jt=Lt(Ue,Te);vt.zoom=Jt}const It=tt.possiblyEvaluate(vt);if(Xh(ye,ft,Ue),lo.shadowUniformsInitialized=!1,lo.useSingleShadowCascade=!!it&&it.getMaxCascadeForTile(Ue.toUnwrapped())===0,ye.renderPass==="shadow"&&it){if(ye.currentShadowCascade===1&&ft.isInsideFirstShadowMapFrustum)continue;const Jt=Te.calculatePosMatrix(Ue.toUnwrapped(),Te.worldSize);if(lo.tileMatrix.set(Jt),lo.shadowTileMatrix=Float32Array.from(it.calculateShadowPassMatrixFromMatrix(Jt)),lo.aabb.min=[0,0,0],lo.aabb.max[0]=lo.aabb.max[1]=s.al,lo.aabb.max[2]=0,Mi(ft,lo,ye,ke.scope))continue}const Mt=1<<Ue.canonical.z,Zt=[((Ze.x-Ue.wrap)*Mt-Ue.canonical.x)*s.al,(Ze.y*Mt-Ue.canonical.y)*s.al,Ze.z*Mt*s.al];ye.conflationActive&&Object.keys(ft.instancesPerModel).length>0&&ye.style.isLayerClipped(ke,Le.getSource())&&ft.updateReplacement(Ue,ye.replacementSource,At,ke.scope)&&(ft.uploaded=!1,ft.upload(ye.context));let Dt=0;const $t=new Array,lr=new Array,or=new Array;for(let Jt in ft.instancesPerModel){const sr=ft.instancesPerModel[Jt];sr.features.length>0&&!$e&&(Jt=It.evaluate(sr.features[0].feature,{}));const vr=Ye.getModel(Jt,Ae);if(vr||Ye.hasURLBeenRequested(Jt)||ft.modelUris.includes(Jt)||(ft.modelUris.push(Jt),ft.modelsRequested=!1),vr&&vr.uploaded)if($e){const Cr=s.c5([],[Ze.x,Ze.y,Ze.z],ye.transform.worldSize);s.ew(Cr,Cr);for(let Gr=0;Gr<sr.instancedDataArray.length;++Gr){const un=[0,0,0],Mr=[1,1,1],xn=s.ex(),Br=sr.tileCoordinatesForInstance(Gr),$n=sr.transformForInstance(Gr);s.ey(Mr,$n),s.ez(xn,$n),s.eA(un,xn);const Ln=sr.translationForInstance(Gr),Un=new s.aT(0,0);s.eB(ft.canonical,Un,Br.x,Br.y);const hn=s.bC();s.eC(hn,vr,ye.transform,Un,un,Mr,Ln,!0,!1,!1);const Vr=sr.colorForInstance(Gr),An=s.bA([]),wi=s.ef(Un.lat,ye.transform.zoom),Si=s.bq([],[1,1,1/wi]);s.br(An,An,Cr),or.push({zScaleMatrix:Si,negCameraPosMatrix:An});for(const Cn of vr.nodes)Og(ye,Cn,hn,ye.transform.expandedFarZProjMatrix,Dt,$t,lr,vr.materialOverrides,et,Vr);++Dt}}else for(const Cr of vr.nodes)Kt(ye,ke,Cr,sr,Zt,Ue,lo)}if($e)if(ye.renderPass==="shadow"){for(const Jt of lr)yp(Jt.mesh,Jt.nodeModelMatrix,ye,ke);for(const Jt of $t)yp(Jt.mesh,Jt.nodeModelMatrix,ye,ke)}else Lw(ye,ke,$t,lr,or)}}(g,o,f,y,kg(g,f)),void X();if(!Z.loaded())return;if(Z.type==="batched-model")return function(ye,Le,ke,Re){ke.resetLayerRenderingStats(ye);const Ae=ye.context,Te=ye.transform,$e=ye.style.fog,Ze=ye.shadowRenderer;if(Te.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ye=ye.transform.getFreeCameraOptions().position,it=s.c5([],[Ye.x,Ye.y,Ye.z],ye.transform.worldSize),tt=s.ew([],it),vt=s.bA([]),At=s.ef(Te.center.lat,Te.zoom),et=s.bq([],[1,1,1/At]);s.br(vt,vt,tt);const Ue=ke.paint.get("model-opacity").constantOr(1),ft=new dr(Ae.gl.LEQUAL,dr.ReadWrite,ye.depthRangeFor3D),st=new dr(Ae.gl.LEQUAL,dr.ReadOnly,ye.depthRangeFor3D),It=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Mt=ye.renderPass==="shadow",Zt=Mt&&Ze?Ze.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),Dt=ke.paint.get("model-front-cutoff"),$t=Dt[2]<1,lr=Xl(ye,ke.paint.get("model-cutoff-fade-range")),or=ke.getLayerRenderingStats();(function(Jt,sr,vr,Cr){const Gr=Jt.terrain?Jt.terrain.exaggeration():0,un=Jt.transform.zoom;for(const Mr of Cr){const xn=sr.getTile(Mr).getBucket(vr);xn&&(xn.setFilter(vr.filter),Jt.conflationActive&&xn.updateReplacement(Mr,Jt.replacementSource),xn.evaluateTransform(Jt,vr),Jt.terrain&&Gr>0&&xn.elevationUpdate(Jt.terrain,Gr,Mr,vr.source),xn.needsReEvaluation(Jt,un,vr)&&xn.evaluate(vr))}})(ye,Le,ke,Re),function(){let Jt,sr,vr;$t?(Jt=Re.length-1,sr=-1,vr=-1):(Jt=0,sr=Re.length,vr=1);const Cr=new Float64Array(16),Gr=s.cA(),un=new s.P(0,0);for(let Mr=Jt;Mr!==sr;Mr+=vr){const xn=Re[Mr],Br=Le.getTile(xn).getBucket(ke);if(!Br||!Br.uploaded)continue;let $n=!1;Ze&&($n=Ze.getMaxCascadeForTile(xn.toUnwrapped())===0);const Ln=Te.calculatePosMatrix(xn.toUnwrapped(),Te.worldSize),Un=Br.modelTraits;!Mt&&$t&&(s.bl(Cr,Ln),s.af(Gr,it,Cr),un.x=Gr[0],un.y=Gr[1]);const hn=[];Br.setFilter(ke.filter);for(const Vr of Br.getNodesInfo()){if(Vr.hiddenByReplacement||!Vr.node.meshes)continue;const An=Vr.node;let wi=0;ye.terrain&&An.elevation&&(wi=An.elevation*ye.terrain.exaggeration());const Si=(()=>{const Pn=Vr.aabb;return It.min=[...Pn.min],It.max=[...Pn.max],It.min[2]+=wi,It.max[2]+=wi,s.af(It.min,It.min,Ln),s.af(It.max,It.max,Ln),It})(),Cn=Vr.evaluatedScale;if(Cn[0]<=1&&Cn[1]<=1&&Cn[2]<=1&&Si.intersects(Zt)===0)continue;if(!Mt&&$t){const Pn=.16666666666666666;Vr.cameraCollisionOpacity=it[0]>Si.min[0]&&it[0]<Si.max[0]&&it[1]>Si.min[1]&&it[1]<Si.max[1]&&it[2]*At<Si.max[2]&&An.footprint&&s.c0(un,An.footprint)?Math.max(Vr.cameraCollisionOpacity-Pn,0):Math.min(1,Vr.cameraCollisionOpacity+Pn)}const an=[...Ln],Ur=1/s.d7(xn.canonical),si=An.anchor?An.anchor[0]:0,Di=An.anchor?An.anchor[1]:0;s.br(an,an,[si*(Cn[0]-1)+Vr.evaluatedTranslation[0]*Ur,Di*(Cn[1]-1)+Vr.evaluatedTranslation[1]*Ur,wi+Vr.evaluatedTranslation[2]]),s.cq(Cn,s.eE)||s.cS(an,an,Cn);const ci=s.aB([],an,An.globalMatrix),fi=s.aB([],Te.expandedFarZProjMatrix,ci),uo=s.aB([],Te.expandedFarZProjMatrix,an),No=s.aC([],[si,Di,wi,1],fi)[2];An.hidden=!1;let Hs=Ue;Mt||($t&&(Hs*=Vr.cameraCollisionOpacity,Hs*=yj(an,Te,Vr.aabb,Dt)),Hs*=Qe(lr,No)),Hs!==0?hn.push({nodeInfo:Vr,depth:No,opacity:Hs,wvpForNode:fi,wvpForTile:uo,nodeModelMatrix:ci,tileModelMatrix:an}):An.hidden=!0}Mt||hn.sort((Vr,An)=>!$t||Vr.opacity===1&&An.opacity===1?Vr.depth<An.depth?-1:1:Vr.opacity===1?-1:An.opacity===1?1:Vr.depth>An.depth?-1:1);for(const Vr of hn){const An=Vr.nodeInfo,wi=An.node;let Si=s.aB([],et,Vr.tileModelMatrix);s.aB(Si,vt,Si);const Cn=s.bl([],Si);s.eg(Cn,Cn),s.cS(Cn,Cn,vp),Si=s.aB(Si,Si,wi.globalMatrix);const an=ye.renderPass==="light-beam",Ur=ke.paint.get("model-color-use-theme").constantOr("default")==="none",si=Un&s.eI.HasMapboxMeshFeatures,Di=si?0:An.evaluatedRMEA[0][2];for(let ci=0;ci<wi.meshes.length;++ci){const fi=wi.meshes[ci],uo=ci===wi.lightMeshIndex;let No=Vr.wvpForNode;if(uo){if(!an&&!ye.terrain&&ye.shadowRenderer){ye.currentLayer<ye.firstLightBeamLayer&&(ye.firstLightBeamLayer=ye.currentLayer);continue}No=Vr.wvpForTile}else if(an)continue;const Hs={defines:[]},Pn=[];if(!Mt&&Ze&&(Ze.useNormalOffset=!!fi.normalBuffer),yc(Hs.defines,Pn,fi,ye,Ur?null:ke.lut),si||Hs.defines.push("DIFFUSE_SHADED"),$n&&Hs.defines.push("SHADOWS_SINGLE_CASCADE"),or&&(Mt?or.numRenderedVerticesInShadowPass+=fi.vertexArray.length:or.numRenderedVerticesInTransparentPass+=fi.vertexArray.length),Mt){yp(fi,Vr.nodeModelMatrix,ye,ke);continue}let Zo=null;if($e){const ts=Dw(Vr.nodeModelMatrix,ye.transform);if(Zo=new Float32Array(ts),Te.projection.name!=="globe"){const ui=fi.aabb.min,ms=fi.aabb.max,[ja,Zi]=$e.getOpacityForBounds(ts,ui[0],ui[1],ms[0],ms[1]);Hs.overrideFog=ja>=tr||Zi>=tr}}const va=fi.material;let Io;va.occlusionTexture&&va.occlusionTexture.offsetScale&&(Io=va.occlusionTexture.offsetScale,Hs.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Jl=ye.getOrCreateProgram("model",Hs);!Mt&&Ze&&Ze.setupShadowsFromMatrix(Vr.tileModelMatrix,Jl,Ze.useNormalOffset),ye.uploadCommonUniforms(Ae,Jl,null,Zo);const ho=va.pbrMetallicRoughness;ho.metallicFactor=.9,ho.roughnessFactor=.5;const ji=c_(new Float32Array(No),new Float32Array(Si),new Float32Array(Cn),new Float32Array(wi.globalMatrix),ye,Vr.opacity,ho.baseColorFactor,va.emissiveFactor,ho.metallicFactor,ho.roughnessFactor,va,Di,ke,[0,0,0],Io);!uo&&(An.hasTranslucentParts||Vr.opacity<1)&&Jl.draw(ye,Ae.gl.TRIANGLES,ft,Ir.disabled,Lr.disabled,Ar.backCCW,ji,ke.id,fi.vertexBuffer,fi.indexBuffer,fi.segments,ke.paint,ye.transform.zoom,void 0,Pn),Jl.draw(ye,Ae.gl.TRIANGLES,uo?st:ft,Ir.disabled,uo||Vr.opacity<1||An.hasTranslucentParts?Lr.alphaBlended:Lr.unblended,Ar.backCCW,ji,ke.id,fi.vertexBuffer,fi.indexBuffer,fi.segments,ke.paint,ye.transform.zoom,void 0,Pn)}}}}()}(g,o,f,y),void X();if(Z.type!=="model")return;const J=Z.getModels(),se=[],re=g.transform.getFreeCameraOptions().position,oe=s.c5([],[re.x,re.y,re.z],g.transform.worldSize);s.ew(oe,oe);const he=[],xe=[];let _e=0;for(const ye of J){const Le=o.getFeatureState("",ye.id),ke={type:"Unknown",id:ye.id,properties:ye.featureProperties},Re=f.paint.get("model-rotation").evaluate(ke,Le),Ae=f.paint.get("model-scale").evaluate(ke,Le),Te=f.paint.get("model-translation").evaluate(ke,Le),$e=f.paint.get("model-opacity").evaluate(ke,Le);mj(f,ye.id,Le,ye.featureProperties,ye.nodeOverrideNames,ye.nodeOverrides),gj(f,ye.id,Le,ye.featureProperties,ye.materialOverrideNames,ye.materialOverrides),ye.nodeOverrides.size>0&&ye.computeBoundsAndApplyParent(),ye.computeModelMatrix(g,Re,Ae,Te,I,j,!1);const Ze=s.bA([]),Ye=s.ef(ye.position.lat,g.transform.zoom),it=s.bq([],[1,1,1/Ye]);s.br(Ze,Ze,oe),se.push({zScaleMatrix:it,negCameraPosMatrix:Ze});for(const tt of ye.nodes)Og(g,tt,ye.matrix,g.transform.expandedFarZProjMatrix,_e,he,xe,ye.materialOverrides,$e);_e++}if(he.sort((ye,Le)=>Le.depth-ye.depth),g.renderPass!=="shadow")Lw(g,f,he,xe,se),X();else{for(const ye of xe)yp(ye.mesh,ye.nodeModelMatrix,g,f);for(const ye of he)yp(ye.mesh,ye.nodeModelMatrix,g,f);X()}}},Uw={line:function(g,o,f){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const y=o.getVisibleCoordinates();for(const w of y){const E=o.getTile(w).getBucket(g);if(E&&(E.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,o,f){const y=o.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(f.modelManager&&f.modelManager.upload(f,kg(f,g)));if(y.type==="batched-model"||y.type!=="model")return;const w=y.getModels();for(const E of w)E.upload(f.context)},raster:function(g,o,f){const y=o.getSource();if(!(y instanceof io&&y.loaded()))return;const w=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!w)return;const E=g.paint.get("raster-array-band")||y.getInitialBand(w);if(E==null)return;const j=o.getIds().map(I=>o.getTileByID(I));for(const I of j)I.updateNeeded(g.id,E)&&y.prepareTile(I,w,g.id,E)},"raster-particle":function(g,o,f){const y=o.getSource();if(!(y instanceof io&&y.loaded()))return;const w=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!w)return;const E=g.paint.get("raster-particle-array-band")||y.getInitialBand(w);if(E==null)return;const j=o.getIds().map(I=>o.getTileByID(I));for(const I of j)I.updateNeeded(g.id,E)&&y.prepareTile(I,w,g.id,E)}},qw={fill:Tw},xj={fill:function(g,o,f,y){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const w=g.context.gl,E=new dr(w.LEQUAL,dr.ReadOnly,g.depthRangeFor3D),j=new Ir({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),I=g.transform.getFreeCameraOptions().position,O=g.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const U of y){const q=o.getTile(U),X=q.getBucket(f);if(!X)continue;const Z=X.elevatedStructures;if(!Z||Z.depthSegments.segments[0].primitiveLength===0)continue;const J=Sw(U.toUnwrapped(),I),se=g.translatePosMatrix(U.projMatrix,q,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),re=Wh(se,J,0,1,0);O.draw(g,w.TRIANGLES,E,j,Lr.disabled,Ar.disabled,re,f.id,Z.vertexBuffer,Z.indexBuffer,Z.depthSegments,f.paint,g.transform.zoom)}}};class bj{constructor(o,f,y,w,E){this.context=new d_(o,f),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const j=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of j)this._debugParams.enabledLayers[O]=!0;for(const O of j);this.occlusionParams=new zw,this.setup(),this.numSublayers=So.maxUnderzooming+So.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yg(this),this._wireframeDebugCache=new Fw,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w,this.worldview=E,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,f){const y=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new pw(this,o));const w=this._terrain;this.transform.elevation=y?w:null,w.update(o,this.transform,f),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(o){const f=o.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,w]=f.getFovAdjustedRange(this.transform._fov);if(y>w)return void(this.transform.fogCullDistSq=null);const E=y+.78*(w-y);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new pw(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,f){if(this.width=o*s.o.devicePixelRatio,this.height=f*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const o=this.context,f=new s.bd;f.emplaceBack(0,0),f.emplaceBack(s.al,0),f.emplaceBack(0,s.al),f.emplaceBack(s.al,s.al),this.tileExtentBuffer=o.createVertexBuffer(f,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const y=new s.bd;y.emplaceBack(0,0),y.emplaceBack(s.al,0),y.emplaceBack(0,s.al),y.emplaceBack(s.al,s.al),this.debugBuffer=o.createVertexBuffer(y,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const w=new s.bd;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(w,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const E=new s.b1;E.emplaceBack(0,0,0,0),E.emplaceBack(s.al,0,s.al,0),E.emplaceBack(0,s.al,0,s.al),E.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=o.createVertexBuffer(E,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const j=new s.b0;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(j);const I=new s.be;for(const U of[0,1,3,2,0])I.emplaceBack(U);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new s.T(o,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=s.bC();const O=this.context.gl;this.stencilClearMode=new Ir({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,dr.disabled,this.stencilClearMode,Lr.disabled,Ar.disabled,Eg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,f,y){if(!f||this.currentStencilSource===f.id||!o.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const O of y)if(this._tileClippingMaskIDs[O.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=f.id;const w=this.context,E=w.gl;this.nextStencilID+y.length>256&&this.clearStencil(),w.setColorMode(Lr.disabled),w.setDepthMode(dr.disabled);const j=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of y){const O=f.getTile(I),U=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=this.getTileBoundsBuffers(O);j.draw(this,E.TRIANGLES,dr.disabled,new Ir({func:E.ALWAYS,mask:0},U,255,E.KEEP,E.KEEP,E.REPLACE),Lr.disabled,Ar.disabled,Eg(I.projMatrix),"$clipping",q,X,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,f=this.context.gl;return new Ir({func:f.NOTEQUAL,mask:255},o,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const f=this.context.gl;return new Ir({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(o){const f=this.context.gl,y=o.sort((j,I)=>I.overscaledZ-j.overscaledZ),w=y[y.length-1].overscaledZ,E=y[0].overscaledZ-w+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const j={};for(let I=0;I<E;I++)j[I+w]=new Ir({func:f.GEQUAL,mask:255},I+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=E,[j,y]}return[{[w]:Ir.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Lr([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lr.unblended:Lr.alphaBlended}colorModeForDrapableLayerRenderPass(o){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Lr([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Lr([f.ONE,f.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,f.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,f,y,w=!1){if(this.depthOcclusion)return new dr(this.context.gl.GREATER,dr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return dr.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new dr(y||this.context.gl.LEQUAL,f,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,f=Math.ceil(this.width),y=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),E=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&y!==0&&(this.depthFBO=new Zh(this.context,f,y,0,"texture"),this.depthTexture=new s.T(this.context,{width:f,height:y,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),o.bindTexture(o.TEXTURE_2D,E),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,f,y,0,0,f,y,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,f)=>o+f/this._fpsHistory.length,0))}render(o,f){const y=s.o.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=f;const w=this.style._mergedLayers,E=!(!this.terrain||!this.terrain.enabled),j=()=>this.style._getOrder(E).filter(et=>{const Ue=w[et];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]});let I=j(),O=!1,U=!1,q=null,X=0,Z=!1;for(const et of I){const Ue=w[et];Ue.visibility!=="none"&&(Ue.type==="circle"?O=!0:Ue.type==="building"?(q=Ue,++X):Ue.type==="symbol"&&(Ue.hasOcclusionOpacityProperties?U=!0:O=!0))}this.updateEmissiveMode();let J=I.map(et=>w[et]);const se=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const et in se){const Ue=se[et];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++X)}let re=!1;for(const et of J)et.isHidden(this.transform.zoom)||(et.type==="clip"&&(re=!0),this.prepareLayer(et));const oe={},he={},xe={},_e={},ye={};for(const et in se){const Ue=se[et];oe[et]=Ue.getVisibleCoordinates(),he[et]=oe[et].slice().reverse(),xe[et]=Ue.getVisibleCoordinates(!0).reverse(),_e[et]=Ue.getShadowCasterCoordinates(),ye[et]=Ue.sortCoordinatesByDistance(oe[et])}const Le=et=>{const Ue=this.style.getLayerSourceCache(et);return Ue&&Ue.used?Ue.getSource():null};if(X||re||this._clippingActiveLastFrame){const et=[],Ue=[];let ft=0;for(const st of J)this.isSourceForClippingOrConflation(st,Le(st))&&(et.push(st),Ue.push(ft)),ft++;if(et&&(re||et.length>1)||this._clippingActiveLastFrame){re=!1;const st=[];for(let It=0;It<et.length;It++){const Mt=et[It],Zt=Ue[It],Dt=this.style.getLayerSourceCache(Mt);if(!Dt||!Dt.used||!Dt.getSource().usedInConflation&&Mt.type!=="clip"&&Mt.type!=="building")continue;let $t=s.eQ,lr=s.b_.None;const or=[];let Jt=!0;if(Mt.type==="building")$t=s.eS;else if(Mt.type==="clip"){$t=Zt;for(const sr of Mt.layout.get("clip-layer-types"))lr|=sr==="model"?s.b_.Model:sr==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const sr of Mt.layout.get("clip-layer-scope"))or.push(sr);Mt.isHidden(this.transform.zoom)?Jt=!1:re=!0}Jt&&st.push({layer:Mt.fqid,cache:Dt,order:$t,clipMask:lr,clipScope:or})}this.replacementSource.setSources(st),Z=!0}}this._clippingActiveLastFrame=re,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let et=0;et<J.length;et++){const Ue=J[et];if(Ue.visibility==="none")continue;const ft=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(ft,this.longestCutoffRange),ft>0){const st=Le(Ue);st&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(E)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=et),this._lastOcclusionLayer=et)}const ke=this.style&&this.style.fog;ke?(this._fogVisible=ke.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ke.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(xe),this.opaquePassCutoff=0,I=j(),J=I.map(et=>w[et]));const Re=this._shadowRenderer;if(Re){Re.updateShadowParameters(this.transform,this.style.directionalLight);for(const et in se)for(const Ue of oe[et]){let ft={min:0,max:0};this.terrain&&(ft=this.terrain.getMinMaxForTile(Ue)||ft),Re.addShadowReceiver(Ue.toUnwrapped(),ft.min,ft.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Rw(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ae&&!this._snow&&(this._snow=new Mg(this)),!Ae&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new _j(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),q){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Mw);const et=this.style.getLayerSourceCache(q);this.buildingTileBorderManager.updateBorders(et,q)}if(!Jn.has(this.context.gl))return;this.renderPass="offscreen";for(const et of J){const Ue=o.getLayerSourceCache(et);if(!et.hasOffscreenPass()||et.isHidden(this.transform.zoom))continue;const ft=Ue?he[Ue.id]:void 0;(et.type==="custom"||et.type==="raster"||et.type==="raster-particle"||et.isSky()||ft&&ft.length)&&this.renderLayer(this,Ue,et,ft)}this.depthRangeFor3D=[0,1-(J.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const $e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ze=(()=>{if(f.showOverdrawInspector)return s.ao.black;const et=this.style.fog;if(et&&this.transform.projection.supportsFog){const Ue=this.style.getLut(et.scope);if(!$e){const ft=et.properties.get("color-use-theme")==="none",st=et.properties.get("color").toNonPremultipliedRenderColor(ft?null:Ue).toArray01();return new s.ao(...st)}if($e){const ft=et.properties.get("space-color-use-theme")==="none",st=et.properties.get("space-color").toNonPremultipliedRenderColor(ft?null:Ue).toArray01();return new s.ao(...st)}}return s.ao.transparent})();if(this.context.clear({color:Ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const et=J[this.currentLayer],Ue=o.getLayerSourceCache(et);if(et.isSky())continue;const ft=Ue?(et.is3D(E)?ye:he)[Ue.id]:void 0;this._renderTileClippingMasks(et,Ue,ft),this.renderLayer(this,Ue,et,ft)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const et=J[this.currentLayer],Ue=o.getLayerSourceCache(et);et.isSky()&&this.renderLayer(this,Ue,et,Ue?he[Ue.id]:void 0)}function Ye(et,Ue){let ft;return Ue&&(ft=(et.type==="symbol"?xe:et.is3D(E)?ye:he)[Ue.id]),ft}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const et=J[this.currentLayer];if(et.type==="raster"||et.type==="raster-particle"){const Ue=o.getLayerSourceCache(et);this.renderLayer(this,Ue,et,Ye(et,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const it=Re?Re.getGroundShadowLayerIndex():-1;let tt=!1,vt=-1;for(let et=0;et<I.length;++et){const Ue=J[et];Ue.isHidden(this.transform.zoom)||Ue.is3D(E)&&(vt=et)}U&&vt===-1&&(O=!0);let At=!1;for(;this.currentLayer<I.length;){const et=J[this.currentLayer],Ue=o.getLayerSourceCache(et);if(et.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(et)){if(et.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!At&&et.is3D(E)&&!E){const ft=this.currentLayer,st=It=>{for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const Mt=J[this.currentLayer];if(qw[Mt.type]){const Zt=this.style.getLayerSourceCache(Mt);qw[Mt.type](this,Zt,Mt,Ye(Mt,Zt),It)}}};st("initialize"),st("reset"),this.currentLayer=ft,At=!0}if(O&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),U&&vt!==-1&&this.currentLayer===vt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(et,Ue,Ue?oe[Ue.id]:void 0),this.renderLayer(this,Ue,et,Ye(et,Ue)),!this.terrain&&Re&&this.currentLayer===it){{this.clearStencil(),this.resetStencilClippingMasks();const ft=this.currentLayer;for(this.currentLayer=0;this.currentLayer<J.length;this.currentLayer++){const st=J[this.currentLayer];if(xj[st.type]){const It=this.style.getLayerSourceCache(st);xj[st.type](this,It,st,Ye(st,It))}}this.currentLayer=ft}if(Re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ft=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ft;this.currentLayer++){const st=J[this.currentLayer];if(!st.hasLightBeamPass())continue;const It=o.getLayerSourceCache(st);this.renderLayer(this,It,st,It?he[It.id]:void 0)}this.currentLayer=ft,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ft=this.currentLayer;this.depthOcclusion=!0;for(const st of this.layersWithOcclusionOpacity){this.currentLayer=st;const It=J[this.currentLayer],Mt=o.getLayerSourceCache(It),Zt=Mt?he[Mt.id]:void 0;this.terrain||this._renderTileClippingMasks(It,Mt,Mt?oe[Mt.id]:void 0),this.renderLayer(this,Mt,It,Zt)}this.depthOcclusion=!1,this.currentLayer=ft,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let et=null;J.forEach(Ue=>{const ft=o.getLayerSourceCache(Ue);ft&&!Ue.isHidden(this.transform.zoom)&&ft.getVisibleCoordinates().length&&(!et||et.getSource().maxzoom<ft.getSource().maxzoom)&&(et=ft)}),et&&this.options.showTileBoundaries&&dj(this,et,et.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&dj(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(et){const Ue=et.transform.padding;hj(et,et.transform.height-(Ue.top||0),3,Pw),hj(et,Ue.bottom||0,3,Nw),kw(et,Ue.left||0,3,Iw),kw(et,et.transform.width-(Ue.right||0),3,OO);const ft=et.transform.centerPoint;(function(st,It,Mt,Zt){g_(st,It-1,Mt-10,2,20,Zt),g_(st,It-10,Mt-1,20,2,Zt)})(et,ft.x,et.transform.height-ft.y,RO)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:f}=this.transform.projection,y=!f||!f.includes(o.type);if(Uw[o.type]&&(y||this.terrain&&o.type==="custom")){const w=this.style.getLayerSourceCache(o);Uw[o.type](o,w,this)}this.gpuTimingEnd()}renderLayer(o,f,y,w){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||w&&w.length)&&(this.id=y.id,this.gpuTimingStart(y),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(y.type)&&(!o.terrain||y.type!=="custom")||y.type==="clip"||Kh[y.type](o,f,y,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,y=this.context.gl;let w=this.gpuTimers[o.id];w||(w=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:y.createQuery()}),w.calls++,y.beginQuery(f.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,f=this.context.gl,y=f.createQuery();this.deferredRenderGpuTimeQueries.push(y),f.beginQuery(o.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const f={};for(const y in o){const w=o[y],E=this.context.extTimerQuery,j=E.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;E.deleteQueryEXT(w.query),f[y]=j}return f}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.gl;let y=0;for(const w of o)y+=f.getQueryParameter(w,f.QUERY_RESULT)/1e6,f.deleteQuery(w);return y}translatePosMatrix(o,f,y,w,E){if(!y[0]&&!y[1])return o;const j=E?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(j){const U=Math.sin(j),q=Math.cos(j);y=[y[0]*q-y[1]*U,y[0]*U+y[1]*q]}const I=[E?y[0]:s.ay(f,y[0],this.transform.zoom),E?y[1]:s.ay(f,y[1],this.transform.zoom),0],O=new Float32Array(16);return s.br(O,o,I),O}saveTileTexture(o){if(o.context!==this.context)return;const f=o.size[0],y=this._tileTextures[f];y?y.push(o):this._tileTextures[f]=[o]}getTileTexture(o){const f=this._tileTextures[o];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,f,y){const w=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,E=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||E.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||w||f!==void 0&&!f||E.push("FOG","FOG_DITHERING"),w&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(o,f){this.cache=this.cache||{};const y=f&&f.defines||[],w=f&&f.config,E=this.currentGlobalDefines(o,f&&f.overrideFog,f&&f.overrideRtt).concat(y),j=GE.cacheKey(tw[o],o,E,w);return this.cache[j]||(this.cache[j]=new GE(this.context,o,tw[o],w,u_[o],E)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,f){if(this.style.enable3dLights()){const y=this.style.directionalLight,w=this.style.ambientLight;if(y&&w){const E=((j,I,O)=>{const U=j.properties.get("direction"),q=j.properties.get("color-use-theme")==="none",X=j.properties.get("color").toNonPremultipliedRenderColor(q?null:O.getLut(j.scope)).toArray01(),Z=j.properties.get("intensity"),J=I.properties.get("color-use-theme")==="none",se=I.properties.get("color").toNonPremultipliedRenderColor(J?null:O.getLut(I.scope)).toArray01(),re=I.properties.get("intensity"),oe=[U.x,U.y,U.z],he=s.dN(se,re),xe=s.dN(X,Z);return{u_lighting_ambient_color:he,u_lighting_directional_dir:oe,u_lighting_directional_color:xe,u_ground_radiance:hp(oe,xe,he)}})(y,w,this.style);f.setLightsUniformValues(o,E)}}}uploadCommonUniforms(o,f,y,w,E){if(this.uploadCommonLightUniforms(o,f),this.terrain&&this.terrain.renderingToTexture)return;const j=this.style.fog;if(j){const I=j.getOpacity(this.transform.pitch),O=((U,q,X,Z,J,se,re,oe,he,xe,_e,ye)=>{const Le=U.transform,ke=q.properties.get("color-use-theme")==="none",Re=q.properties.get("color").toNonPremultipliedRenderColor(ke?null:U.style.getLut(q.scope)).toArray01();Re[3]=Z;const Ae=U.frameCounter/1e3%1,[Te,$e]=q.properties.get("vertical-range");return{u_fog_matrix:X?Le.calculateFogTileMatrix(X):ye||U.identityMat,u_fog_range:q.getFovAdjustedRange(Le._fov),u_fog_color:Re,u_fog_horizon_blend:q.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,$e),$e],u_fog_temporal_offset:Ae,u_frustum_tl:J,u_frustum_tr:se,u_frustum_br:re,u_frustum_bl:oe,u_globe_pos:he,u_globe_radius:xe,u_viewport:_e,u_globe_transition:s.aj(Le.zoom),u_is_globe:+(Le.projection.name==="globe")}})(this,j,y,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],w);f.setFogUniformValues(o,O)}E&&f.setCutoffUniformValues(o,E.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,f=o.createTexture();return o.bindTexture(o.TEXTURE_2D,f),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,f=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const w of y)f[w.key]=o[w.key]||new Nd(w,512,this.transform.tileZoom,this,void 0,this.worldview);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,f){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!f||f.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[o.key];return f||(this._cachedTileFogOpacities[o.key]=f=this.style.fog.getOpacityForTile(o)),f[0]>=tr||f[1]>=tr}setupDepthForOcclusion(o,f,y){const w=this.context,E=w.gl,j=!!y;var I;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(E.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),w.activeTexture.set(E.TEXTURE0),j||f.setTerrainUniformValues(w,y)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function wj(g,o){let f=!1,y=null;const w=()=>{y=null,f&&(g(),y=setTimeout(w,o),f=!1)};return()=>(f=!0,y||w(),y)}class co{constructor(o){this._hashName=o&&encodeURIComponent(o),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wj(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const f=Sj(o);if(this._hashName){const y=this._hashName;let w=!1;const E=location.hash.slice(1).split("&").map(j=>{const I=j.split("=")[0];return I===y?(w=!0,`${I}=${f}`):j}).filter(j=>j);return w||E.push(`${y}=${f}`),`#${E.join("&")}`}return`#${f}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let f;return o.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(f=y)}),(f&&f[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(y=>isNaN(Number(y)))){const y=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(f[3]||0):o.getBearing();return o.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:y,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Sj(g,o){const f=g.getCenter(),y=Math.round(100*g.getZoom())/100,w=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,w),j=Math.round(f.lng*E)/E,I=Math.round(f.lat*E)/E,O=g.getBearing(),U=g.getPitch();let q=o?`/${j}/${I}/${y}`:`${y}/${I}/${j}`;return(O||U)&&(q+="/"+Math.round(10*O)/10),U&&(q+=`/${Math.round(U)}`),q}const Wd={linearity:.3,easing:s.eT(0,0,.3,1)},FO=Object.assign({deceleration:2500,maxSpeed:1400},Wd),hi=Object.assign({deceleration:20,maxSpeed:1400},Wd),ln=Object.assign({deceleration:1e3,maxSpeed:360},Wd),Tj=Object.assign({deceleration:1e3,maxSpeed:90},Wd);class Hd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,f=s.o.now();for(;o.length>0&&f-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const E=Vu(f.pan.mag(),y,Object.assign({},FO,o||{}));w.offset=f.pan.mult(E.amount/f.pan.mag()),w.center=this._map.transform.center,$u(w,E)}if(f.zoom){const E=Vu(f.zoom,y,hi);w.zoom=this._map.transform.zoom+E.amount,$u(w,E)}if(f.bearing){const E=Vu(f.bearing,y,ln);w.bearing=this._map.transform.bearing+s.aA(E.amount,-179,179),$u(w,E)}if(f.pitch){const E=Vu(f.pitch,y,Tj);w.pitch=this._map.transform.pitch+E.amount,$u(w,E)}if(w.zoom||w.bearing){const E=f.pinchAround===void 0?f.around:f.pinchAround;w.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function $u(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function Vu(g,o,f){const{maxSpeed:y,linearity:w,deceleration:E}=f,j=s.aA(g*w/(o/1e3),-y,y),I=Math.abs(j)/(E*w);return{easing:f.easing,duration:1e3*I,amount:j*(I/2)}}class aa extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y,w={}){const E=ie(f.getCanvasContainer(),y),j=f.unproject(E);super(o,Object.assign({point:E,lngLat:j,originalEvent:y},w)),this._defaultPrevented=!1,this.target=f}}class xp extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f,y){const w=o==="touchend"?y.changedTouches:y.touches,E=ge(f.getCanvasContainer(),w),j=E.map(O=>f.unproject(O)),I=E.reduce((O,U,q,X)=>O.add(U.div(X.length)),new s.P(0,0));super(o,{points:E,point:I,lngLats:j,lngLat:f.unproject(I),originalEvent:y}),this._defaultPrevented=!1}}class Gw extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class Ww{constructor(o,f){this._map=o,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Gw(this._map,o))}mousedown(o,f){return this._mousedownPos=f,this._firePreventable(new aa(o.type,this._map,o))}mouseup(o){this._map.fire(new aa(o.type,this._map,o))}preclick(o){const f=new MouseEvent("preclick",o);this._map.fire(new aa(f.type,this._map,f))}click(o,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(o),this._map.fire(new aa(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new aa(o.type,this._map,o))}mouseover(o){this._map.fire(new aa(o.type,this._map,o))}mouseout(o){this._map.fire(new aa(o.type,this._map,o))}touchstart(o){return this._firePreventable(new xp(o.type,this._map,o))}touchmove(o){this._map.fire(new xp(o.type,this._map,o))}touchend(o){this._map.fire(new xp(o.type,this._map,o))}touchcancel(o){this._map.fire(new xp(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hw{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new aa(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new aa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new aa(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yl{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,f){this.isEnabled()&&o.shiftKey&&o.button===0&&(K(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(o,f){if(!this._active)return;const y=f,w=this._startPos,E=this._lastPos;if(!w||!E||E.equals(y)||!this._box&&y.dist(w)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=R("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const j=Math.min(w.x,y.x),I=Math.max(w.x,y.x),O=Math.min(w.y,y.y),U=Math.max(w.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${O}px)`,this._box.style.width=I-j+"px",this._box.style.height=U-O+"px")})}mouseupWindow(o,f){if(!this._active)return;const y=this._startPos,w=f;if(y&&o.button===0){if(this.reset(),ae(),y.x!==w.x||y.y!==w.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:o})),{cameraAnimation:E=>E.fitScreenCoordinates(y,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Y(),delete this._startPos,delete this._lastPos}_fireEvent(o,f){return this._map.fire(new s.z(o,{originalEvent:f}))}}function ru(g,o){const f={};for(let y=0;y<g.length;y++)f[g[y].identifier]=o[y];return f}class bp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(w){const E=new s.P(0,0);for(const j of w)E._add(j);return E.div(w.length)}(f),this.touches=ru(y,f)))}touchmove(o,f,y){if(this.aborted||!this.centroid)return;const w=ru(y,f);for(const E in this.touches){const j=w[E];(!j||j.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(o,f,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class wp{constructor(o){this.singleTap=new bp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,f,y){this.singleTap.touchstart(o,f,y)}touchmove(o,f,y){this.singleTap.touchmove(o,f,y)}touchend(o,f,y){const w=this.singleTap.touchend(o,f,y);if(w){const E=o.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(w)<30;if(E&&j||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Zw{constructor(){this._zoomIn=new wp({numTouches:1,numTaps:2}),this._zoomOut=new wp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,f,y){this._zoomIn.touchstart(o,f,y),this._zoomOut.touchstart(o,f,y)}touchmove(o,f,y){this._zoomIn.touchmove(o,f,y),this._zoomOut.touchmove(o,f,y)}touchend(o,f,y){const w=this._zoomIn.touchend(o,f,y),E=this._zoomOut.touchend(o,f,y);return w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(w)},{originalEvent:o})}):E?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(E)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xw=0,Zd=2,Kw={[Xw]:1,[Zd]:2},bl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Dg{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,f){return!1}_move(o,f){return{}}mousedown(o,f){if(this._lastPoint)return;const y=fe(o);this._correctButton(o,y)&&(this._lastPoint=f,this._eventButton=y)}mousemoveWindow(o,f){const y=this._lastPoint;if(y){if(o.preventDefault(),this._eventButton!=null&&function(w,E){const j=Kw[E];return w.buttons===void 0||(w.buttons&j)!==j}(o,this._eventButton))this.reset();else if(this._moved||!(f.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(y,f)}}mouseupWindow(o){this._lastPoint&&fe(o)===this._eventButton&&(this._moved&&ae(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class __ extends Dg{mousedown(o,f){super.mousedown(o,f),this._lastPoint&&(this._active=!0)}_correctButton(o,f){return f===0&&!o.ctrlKey}_move(o,f){return{around:f,panDelta:f.sub(o)}}}class x_ extends Dg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?bl[o.pitchRotateKey]:void 0}_correctButton(o,f){return this._pitchRotateKey?f===0&&o[this._pitchRotateKey]:f===0&&o.ctrlKey||f===2}_move(o,f){const y=.8*(f.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class b_ extends Dg{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?bl[o.pitchRotateKey]:void 0}_correctButton(o,f){return this._pitchRotateKey?f===0&&o[this._pitchRotateKey]:f===0&&o.ctrlKey||f===2}_move(o,f){const y=-.5*(f.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Ps{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(o,f,y){return this._calculateTransform(o,f,y)}touchmove(o,f,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,f,y)}}touchend(o,f,y){this._calculateTransform(o,f,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,f,y){y.length>0&&(this._active=!0);const w=ru(y,f),E=new s.P(0,0),j=new s.P(0,0);let I=0;for(const U in w){const q=w[U],X=this._touches[U];X&&(E._add(q),j._add(q.sub(X)),I++,w[U]=q)}if(this._touches=w,I<this._minTouches||!j.mag())return;const O=j.div(I);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(I),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Lg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,f,y){return{}}touchstart(o,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(o,f,y){const w=this._firstTwoTouches;if(!w)return;o.preventDefault();const[E,j]=w,I=Sp(y,f,E),O=Sp(y,f,j);if(!I||!O)return;const U=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],U,o)}touchend(o,f,y){if(!this._firstTwoTouches)return;const[w,E]=this._firstTwoTouches,j=Sp(y,f,w),I=Sp(y,f,E);j&&I||(this._active&&ae(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sp(g,o,f){for(let y=0;y<g.length;y++)if(g[y].identifier===f)return o[y]}function w_(g,o){return Math.log2(g/o)}class Yh extends Lg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,f){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(w_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:w_(this._distance,y),pinchAround:f}}}function S_(g,o){return 180*g.angleWith(o)/Math.PI}class Yw extends Lg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,f){const y=this._vector;if(this._vector=o[0].sub(o[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:S_(this._vector,y),pinchAround:f}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const f=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const w=S_(o,y);return Math.abs(w)<f}}function Fg(g){return Math.abs(g.y)>Math.abs(g.x)}class Jh extends Lg{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Fg(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,f,y){const w=this._lastPoints;if(!w)return;const E=o[0].sub(w[0]),j=o[1].sub(w[1]);return this._map._cooperativeGestures&&!s.eU()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(E,j,y.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(E.y+j.y)/2*-.5})}gestureBeginsVertically(o,f,y){if(this._valid!==void 0)return this._valid;const w=o.mag()>=2,E=f.mag()>=2;if(!w&&!E)return;if(!w||!E)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const j=o.y>0==f.y>0;return Fg(o)&&Fg(f)&&j}}const Jw={panStep:100,bearingStep:15,pitchStep:10};class zg{constructor(){const o=Jw;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let f=0,y=0,w=0,E=0,j=0;switch(o.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),E=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),E=1);break;case 38:o.shiftKey?w=1:(o.preventDefault(),j=-1);break;case 40:o.shiftKey?w=-1:(o.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(y=0,w=0),{cameraAnimation:I=>{const O=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Qw,zoom:f?Math.round(O)+f*(o.shiftKey?2:1):O,bearing:I.getBearing()+y*this._bearingStep,pitch:I.getPitch()+w*this._pitchStep,offset:[-E*this._panStep,-j*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qw(g){return g*(2-g)}const Bg=4.000244140625,e1=1/450;class T_{constructor(o,f){this._map=o,this._el=o.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=e1,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=s.o.now(),w=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,f!==0&&f%Bg===0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),o.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=o,this._delta-=f,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ie(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const U=this._type==="wheel"&&Math.abs(this._delta)>Bg?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&q!==0&&(q=1/q);const X=f(),Z=Math.pow(2,X),J=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(J*q))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:f(),w=this._startZoom,E=this._easing;let j,I=!1;if(this._type==="wheel"&&w&&E){const U=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),q=E(U);j=s.ak(w,y,q),U<1?this._frameId||(this._frameId=!0):I=!0}else j=y,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=j-f();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let f=s.eV;if(this._prevEase){const y=this._prevEase,w=(s.o.now()-y.start)/y.duration,E=y.easing(w+.01)-y.easing(w),j=.27/Math.sqrt(E*E+1e-4)*.01,I=Math.sqrt(.0729-j*j);f=s.eT(j,I,.25,1)}return this._prevEase={start:s.o.now(),duration:o,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ej{constructor(o,f){this._clickZoom=o,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jj{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,f){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(f)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Aj{constructor(){this._tap=new wp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,f,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=f[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,f,y))}touchmove(o,f,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const w=f[0],E=w.y-this._swipePoint.y;return this._swipePoint=w,o.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(o,f,y)}touchend(o,f,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,f,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cj{constructor(o,f,y){this._el=o,this._mousePan=f,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pj{constructor(o,f,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nj{constructor(o,f,y,w){this._el=o,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $g=g=>g.zoom||g.drag||g.pitch||g.rotate;class Ij extends s.z{}class kj{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,f){const y=s.av([],f,o);this.radius=s.ag(y[2]<0?s.eX([],y,this.constants):[y[0],y[1],0])}projectRay(o){s.eX(o,o,this.constants),s.aw(o,o),s.eY(o,o,this.constants);const f=s.c5([],o,this.radius);if(f[2]>0){const y=s.c5([],[0,0,1],s.bJ(f,[0,0,1])),w=s.c5([],s.aw([],[f[0],f[1],0]),this.radius),E=s.d8([],f,s.c5([],s.av([],s.d8([],w,y),f),2));f[0]=E[0],f[1]=E[1]}return f}}function Vg(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Oj{constructor(o,f){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hd(o),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kj,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.aY(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,E,j]of this._listeners){const I=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(E,I,j)}}destroy(){for(const[o,f,y]of this._listeners){const w=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(f,w,y)}}_addDefaultHandlers(o){const f=this._map,y=f.getCanvasContainer();this._add("mapEvent",new Ww(f,o));const w=f.boxZoom=new Yl(f,o);this._add("boxZoom",w);const E=new Zw,j=new jj;f.doubleClickZoom=new Ej(j,E),this._add("tapZoom",E),this._add("clickZoom",j);const I=new Aj;this._add("tapDragZoom",I);const O=f.touchPitch=new Jh(f);this._add("touchPitch",O);const U=new x_(o),q=new b_(o);f.dragRotate=new Pj(o,U,q),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const X=new __(o),Z=new Ps(f,o);f.dragPan=new Cj(y,X,Z),this._add("mousePan",X),this._add("touchPan",Z,["touchZoom","touchRotate"]);const J=new Yw,se=new Yh;f.touchZoomRotate=new Nj(y,se,J,I),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hw(f));const re=f.scrollZoom=new T_(f,this);this._add("scrollZoom",re,["mousePan"]);const oe=f.keyboard=new zg;this._add("keyboard",oe);for(const he of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[he]&&f[he].enable(o[he])}_add(o,f,y){this._handlers.push({handlerName:o,handler:f,allowed:y}),this._handlersById[o]=f}stop(o){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$g(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,f,y){for(const w in o)if(w!==y&&(!f||f.indexOf(w)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const f=[];for(const y of o)this._el.contains(y.target)&&f.push(y);return f}handleEvent(o,f){this._updatingCamera=!0;const y=o.type==="renderFrame",w=y?void 0:o,E={needsRenderFrame:!1},j={},I={},O=o.touches?this._getMapTouches(o.touches):void 0,U=O?ge(this._el,O):y?void 0:ie(this._el,o);for(const{handlerName:Z,handler:J,allowed:se}of this._handlers){if(!J.isEnabled())continue;let re;this._blockedByActive(I,se,Z)?J.reset():J[f||o.type]&&(re=J[f||o.type](o,U,O),this.mergeHandlerResult(E,j,re,Z,w),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||J.isActive())&&(I[Z]=J)}const q={};for(const Z in this._previousActiveHandlers)I[Z]||(q[Z]=w);this._previousActiveHandlers=I,(Object.keys(q).length||Vg(E))&&(this._changes.push([E,j,q]),this._triggerRenderFrame()),(Object.keys(I).length||Vg(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=E;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(o,f,y,w,E){if(!y)return;Object.assign(o,y);const j={handlerName:w,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(f.zoom=j),y.panDelta!==void 0&&(f.drag=j),y.pitchDelta!==void 0&&(f.pitch=j),y.bearingDelta!==void 0&&(f.rotate=j)}_applyChanges(){const o={},f={},y={};for(const[w,E,j]of this._changes)w.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(o.around=w.around),w.aroundCoord!==void 0&&(o.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(o.pinchAround=w.pinchAround),w.noInertia&&(o.noInertia=w.noInertia),Object.assign(f,E),Object.assign(y,j);this._updateMapTransform(o,f,y),this._changes=[]}_updateMapTransform(o,f,y){const w=this._map,E=w.transform,j=xe=>[xe.x,xe.y,xe.z];if((()=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!Vg(o)){const xe=E.zoom;E.cameraElevationReference="sea",this._originalZoom!=null&&E._orthographicProjectionAtLowPitch&&E.projection.name!=="globe"&&E.pitch===0?(E.cameraElevationReference="ground",E.zoom=this._originalZoom):(E.recenterOnTerrain(),E.cameraElevationReference="ground"),xe!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&w._stop(!0),!Vg(o))return void this._fireEvents(f,y,!0);let{panDelta:I,zoomDelta:O,bearingDelta:U,pitchDelta:q,around:X,aroundCoord:Z,pinchAround:J}=o;E._isCameraConstrained&&(O>0&&(O=0),E._isCameraConstrained=!1),J!==void 0&&(X=J),(O||(xe=>f[xe]&&!this._eventsInProgress[xe])("drag"))&&X&&(this._dragOrigin=j(E.pointCoordinate3D(X)),this._originalZoom=E.zoom,this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",w._stop(!0),X=X||w.transform.centerPoint,U&&(E.bearing+=U),q&&(E.pitch+=q),E._updateCameraState();const se=[0,0,0];if(I)if(E.projection.name==="mercator"){const xe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(X).dir),_e=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(X.sub(I)).dir);se[0]=_e[0]-xe[0],se[1]=_e[1]-xe[1]}else{const xe=E.pointCoordinate(X);if(E.projection.name==="globe"){I=I.rotate(-E.angle);const _e=E._pixelsPerMercatorPixel/E.worldSize;se[0]=-I.x*s.eW(s.a$(xe.y))*_e,se[1]=-I.y*s.eW(E.center.lat)*_e}else{const _e=E.pointCoordinate(X.sub(I));xe&&_e&&(se[0]=_e.x-xe.x,se[1]=_e.y-xe.y)}}const re=E.zoom,oe=[0,0,0];if(O){const xe=j(Z||E.pointCoordinate3D(X)),_e={dir:s.aw([],s.av([],xe,E._camera.position))};if(_e.dir[2]<0){const ye=E.zoomDeltaToMovement(xe,O);s.c5(oe,_e.dir,ye)}}const he=s.d8(se,se,oe);E._translateCameraConstrained(he),O&&Math.abs(E.zoom-re)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(f,y,!0)}_fireEvents(o,f,y){const w=$g(this._eventsInProgress),E=$g(o),j={};for(const q in o){const{originalEvent:X}=o[q];this._eventsInProgress[q]||(j[`${q}start`]=X),this._eventsInProgress[q]=o[q]}!w&&E&&this._fireEvent("movestart",E.originalEvent);for(const q in j)this._fireEvent(q,j[q]);E&&this._fireEvent("move",E.originalEvent);for(const q in o){const{originalEvent:X}=o[q];this._fireEvent(q,X)}const I={};let O;for(const q in this._eventsInProgress){const{handlerName:X,originalEvent:Z}=this._eventsInProgress[q];this._handlersById[X].isActive()||(delete this._eventsInProgress[q],O=f[X]||Z,I[`${q}end`]=O)}for(const q in I)this._fireEvent(q,I[q]);const U=$g(this._eventsInProgress);if(y&&(w||E)&&!U){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;q?(X(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:O})):(this._map.fire(new s.z("moveend",{originalEvent:O})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,f){this._map.fire(new s.z(o,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Ij("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const t1="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rj extends s.E{constructor(o,f){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,f){return this.jumpTo({center:o},f)}panBy(o,f,y){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},f),y)}panTo(o,f,y){return this.easeTo(Object.assign({center:o},f),y)}getZoom(){return this.transform.zoom}setZoom(o,f){return this.jumpTo({zoom:o},f),this}zoomTo(o,f,y){return this.easeTo(Object.assign({zoom:o},f),y)}zoomIn(o,f){return this.zoomTo(this.getZoom()+1,o,f),this}zoomOut(o,f){return this.zoomTo(this.getZoom()-1,o,f),this}getBearing(){return this.transform.bearing}setBearing(o,f){return this.jumpTo({bearing:o},f),this}getPadding(){return this.transform.padding}setPadding(o,f){return this.jumpTo({padding:o},f),this}rotateTo(o,f,y){return this.easeTo(Object.assign({bearing:o},f),y)}resetNorth(o,f){return this.rotateTo(0,Object.assign({duration:1e3},o),f),this}resetNorthPitch(o,f){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),f),this}snapToNorth(o,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,f):this}getPitch(){return this.transform.pitch}setPitch(o,f){return this.jumpTo({pitch:o},f),this}cameraForBounds(o,f){o=s.aI.convert(o);const y=f&&f.bearing||0,w=f&&f.pitch||0,E=o.getNorthWest(),j=o.getSouthEast();return this._cameraForBounds(this.transform,E,j,y,w,f)}_extendPadding(o){const f={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},f,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},f,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,f){const y=f.max[0]-f.min[0],w=f.max[1]-f.min[1];return y/w>o.aspect?y/(2*Math.tan(.5*o.fovX)*o.aspect):w/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,f,y,w,E,j){const I=o.clone(),O=this._extendCameraOptions(j);I.bearing=w,I.pitch=E;const U=s.aT.convert(f),q=s.aT.convert(y),X=.5*(U.lat+q.lat),Z=.5*(U.lng+q.lng),J=s.eZ(X,Z),se=s.aw([],J),re=s.aw([],s.bI([],se,[0,1,0])),oe=s.bI([],re,se),he=[re[0],re[1],re[2],0,oe[0],oe[1],oe[2],0,se[0],se[1],se[2],0,0,0,0,1],xe=[J,s.eZ(U.lat,U.lng),s.eZ(q.lat,U.lng),s.eZ(q.lat,q.lng),s.eZ(U.lat,q.lng),s.eZ(X,U.lng),s.eZ(X,q.lng),s.eZ(U.lat,Z),s.eZ(q.lat,Z)];let _e=s.d9.fromPoints(xe.map(st=>[s.bJ(re,st),s.bJ(oe,st),s.bJ(se,st)]));const ye=s.af([],_e.center,he);s.e_(ye)===0&&s.e$(ye,0,0,1),s.aw(ye,ye),s.c5(ye,ye,s.aD),I.center=s.f0(ye);const Le=I.getWorldToCameraMatrix(),ke=s.bl(new Float64Array(16),Le);_e=s.d9.applyTransform(_e,s.aB([],Le,he));const Re=this._extendAABB(_e,I,O,w);if(!Re)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Re,s.af(ye,ye,Le);const Ae=.5*(_e.max[2]-_e.min[2]),Te=this._minimumAABBFrustumDistance(I,_e),$e=s.c5([],[0,0,1],Ae),Ze=s.d8($e,ye,$e),Ye=Te+(I.pitch===0?0:s.bG(ye,Ze)),it=I.globeCenterInViewSpace,tt=s.av([],ye,[it[0],it[1],it[2]]);s.aw(tt,tt),s.c5(tt,tt,Ye);const vt=s.d8([],ye,tt);s.af(vt,vt,ke);const At=s.eM/s.aD,et=s.ag(vt),Ue=s.cf(Math.max(et*At-s.eM,Number.EPSILON),0),ft=Math.min(I.zoomFromMercatorZAdjusted(Ue),O.maxZoom);return ft>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=ft,this._cameraForBounds(I,f,y,w,E,j)):{center:I.center,zoom:ft,bearing:w,pitch:E}}_extendAABB(o,f,y,w){const E=.5*((y.padding.left||0)+(y.padding.right||0)),j=.5*((y.padding.top||0)+(y.padding.bottom||0)),I=j,O=E,U=E,q=j,X=f.width-(O+U),Z=f.height-(I+q),J=s.av([],o.max,o.min),se=Math.min(X/J[0],Z/J[1]),re=Math.min(f.scaleZoom(f.scale*se),y.maxZoom);if(isNaN(re))return null;const oe=f.scale/f.zoomScale(re),he=new s.d9([o.min[0]-O*oe,o.min[1]-q*oe,o.min[2]],[o.max[0]+U*oe,o.max[1]+I*oe,o.max[2]]),xe=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new s.P(y.offset.x,y.offset.y):s.P.convert(y.offset)).rotate(-s.an(w));return he.center[0]-=xe.x*oe,he.center[1]+=xe.y*oe,he}queryTerrainElevation(o,f){const y=this.transform.elevation;return y?(f=Object.assign({},{exaggerated:!0},f),y.getAtPoint(s.ae.fromLngLat(o),null,f.exaggerated)):null}_cameraForBounds(o,f,y,w,E,j){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,f,y,w,E,j);const I=o.clone(),O=this._extendCameraOptions(j);I.bearing=w,I.pitch=E;const U=s.aT.convert(f),q=s.aT.convert(y),X=new s.aT(U.lng,q.lat),Z=new s.aT(q.lng,U.lat),J=I.project(U),se=I.project(q),re=this.queryTerrainElevation(U),oe=this.queryTerrainElevation(q),he=this.queryTerrainElevation(X),xe=this.queryTerrainElevation(Z),_e=[[J.x,J.y,Math.min(re||0,oe||0,he||0,xe||0)],[se.x,se.y,Math.max(re||0,oe||0,he||0,xe||0)]];let ye=s.d9.fromPoints(_e);const Le=I.getWorldToCameraMatrix(),ke=s.bl(new Float64Array(16),Le);ye=s.d9.applyTransform(ye,Le);const Re=this._extendAABB(ye,I,O,w);if(!Re)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Re;const Ae=.5*s.av([],ye.max,ye.min)[2],Te=this._minimumAABBFrustumDistance(I,ye),$e=[0,0,1,0];s.aC($e,$e,Le),s.f1($e,$e);const Ze=s.c5([],$e,Te+Ae),Ye=s.d8([],ye.center,Ze);s.af(ye.center,ye.center,ke),s.af(Ye,Ye,ke);const it=I.unproject(new s.P(ye.center[0],ye.center[1])),tt=s.f2(I.projection,it),vt=Math.pow(2,tt),At=Math.min(I._zoomFromMercatorZ(Ye[2]*I.pixelsPerMeter*vt/I.worldSize),O.maxZoom);return I.mercatorFromTransition&&At<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=At,this._cameraForBounds(I,f,y,w,E,j)):{center:it,zoom:At,bearing:w,pitch:E}}fitBounds(o,f,y){const w=this.cameraForBounds(o,f);return this._fitInternal(w,f,y)}fitScreenCoordinates(o,f,y,w,E){const j=s.P.convert(o),I=s.P.convert(f),O=new s.P(Math.min(j.x,I.x),Math.min(j.y,I.y)),U=new s.P(Math.max(j.x,I.x),Math.max(j.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,I))return this;const q=this.transform.pointLocation3D(O),X=this.transform.pointLocation3D(U),Z=this.transform.pointLocation3D(new s.P(O.x,U.y)),J=this.transform.pointLocation3D(new s.P(U.x,O.y)),se=[Math.min(q.lng,X.lng,Z.lng,J.lng),Math.min(q.lat,X.lat,Z.lat,J.lat)],re=[Math.max(q.lng,X.lng,Z.lng,J.lng),Math.max(q.lat,X.lat,Z.lat,J.lat)],oe=w&&w.pitch?w.pitch:this.getPitch(),he=this._cameraForBounds(this.transform,se,re,y,oe,w);return this._fitInternal(he,w,E)}_fitInternal(o,f,y){return o?(f=Object.assign(o,f)).linear?this.easeTo(f,y):this.flyTo(f,y):this}jumpTo(o,f){this.stop();const y=o.preloadOnly?this.transform.clone():this.transform;let w=!1,E=!1,j=!1;"zoom"in o&&y.zoom!==+o.zoom&&(w=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=s.aT.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(E=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(j=!0,y.pitch=+o.pitch);const I=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!y.isPaddingEqual(I))if(o.retainPadding===!1){const O=y.clone();O.padding=I,y.setLocationAtPoint(y.center,O.centerPoint)}else y.padding=I;return o.preloadOnly?(this._preloadTiles(y),this):(this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),w&&this.fire(new s.z("zoomstart",f)).fire(new s.z("zoom",f)).fire(new s.z("zoomend",f)),E&&this.fire(new s.z("rotatestart",f)).fire(new s.z("rotate",f)).fire(new s.z("rotateend",f)),j&&this.fire(new s.z("pitchstart",f)).fire(new s.z("pitch",f)).fire(new s.z("pitchend",f)),this.fire(new s.z("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(t1),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,f){const y=this.transform;if(!y.projection.supportsFreeCamera)return s.w(t1),this;this.stop();const w=y.zoom,E=y.pitch,j=y.bearing;y.setFreeCameraOptions(o);const I=w!==y.zoom,O=E!==y.pitch,U=j!==y.bearing;return this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),I&&this.fire(new s.z("zoomstart",f)).fire(new s.z("zoom",f)).fire(new s.z("zoomend",f)),U&&this.fire(new s.z("rotatestart",f)).fire(new s.z("rotate",f)).fire(new s.z("rotateend",f)),O&&this.fire(new s.z("pitchstart",f)).fire(new s.z("pitch",f)).fire(new s.z("pitchend",f)),this.fire(new s.z("moveend",f)),this}easeTo(o,f){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:s.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const y=this.transform,w=this.getZoom(),E=this.getBearing(),j=this.getPitch(),I=this.getPadding(),O="zoom"in o?+o.zoom:w,U="bearing"in o?this._normalizeBearing(o.bearing,E):E,q="pitch"in o?+o.pitch:j,X=this._extendPadding(o.padding),Z=s.P.convert(o.offset);let J,se,re;if(y.projection.name==="globe"){const $e=s.ae.fromLngLat(y.center),Ze=Z.rotate(-y.angle);$e.x+=Ze.x/y.worldSize,$e.y+=Ze.y/y.worldSize;const Ye=$e.toLngLat(),it=s.aT.convert(o.center||Ye);this._normalizeCenter(it),J=y.centerPoint.add(Ze),se=new s.P($e.x,$e.y).mult(y.worldSize),re=new s.P(s.aF(it.lng),s.aJ(it.lat)).mult(y.worldSize).sub(se)}else{J=y.centerPoint.add(Z);const $e=y.pointLocation(J),Ze=s.aT.convert(o.center||$e);this._normalizeCenter(Ze),se=y.project($e),re=y.project(Ze).sub(se)}const oe=y.zoomScale(O-w);let he,xe;o.around&&(he=s.aT.convert(o.around),xe=y.locationPoint(he));const _e=this._zooming||O!==w,ye=this._rotating||E!==U,Le=this._pitching||q!==j,ke=!y.isPaddingEqual(X),Re=o.retainPadding===!1?y.clone():y,Ae=$e=>Ze=>{if(_e&&($e.zoom=s.ak(w,O,Ze)),ye&&($e.bearing=s.ak(E,U,Ze)),Le&&($e.pitch=s.ak(j,q,Ze)),ke&&(Re.interpolatePadding(I,X,Ze),J=Re.centerPoint.add(Z)),he)$e.setLocationAtPoint(he,xe);else{const Ye=$e.zoomScale($e.zoom-w),it=O>w?Math.min(2,oe):Math.max(.5,oe),tt=Math.pow(it,1-Ze),vt=$e.unproject(se.add(re.mult(Ze*tt)).mult(Ye));$e.setLocationAtPoint($e.renderWorldCopies?vt.wrap():vt,J)}return o.preloadOnly||this._fireMoveEvents(f),$e};if(o.preloadOnly){const $e=this._emulate(Ae,o.duration,y);return this._preloadTiles($e),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=ye,this._pitching=Le,this._padding=ke,this._easeId=o.easeId,this._prepareEase(f,o.noMoveStart,Te),this._ease(Ae(y),$e=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(f,$e)},o),this}_prepareEase(o,f,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||y.moving||this.fire(new s.z("movestart",o)),this._zooming&&!y.zooming&&this.fire(new s.z("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new s.z("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new s.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.z("move",o)),this._zooming&&this.fire(new s.z("zoom",o)),this._rotating&&this.fire(new s.z("rotate",o)),this._pitching&&this.fire(new s.z("pitch",o))}_afterEase(o,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,w=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.z("zoomend",o)),w&&this.fire(new s.z("rotateend",o)),E&&this.fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o))}flyTo(o,f){if(this._prefersReducedMotion(o)){const st=s.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(st,f)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},o);const y=this.transform,w=this.getZoom(),E=this.getBearing(),j=this.getPitch(),I=this.getPadding(),O="zoom"in o?s.aA(+o.zoom,y.minZoom,y.maxZoom):w,U="bearing"in o?this._normalizeBearing(o.bearing,E):E,q="pitch"in o?+o.pitch:j,X=this._extendPadding(o.padding),Z=y.zoomScale(O-w),J=s.P.convert(o.offset);let se=y.centerPoint.add(J);const re=y.pointLocation(se),oe=s.aT.convert(o.center||re);this._normalizeCenter(oe);const he=y.project(re),xe=y.project(oe).sub(he);let _e=o.curve;const ye=Math.max(y.width,y.height),Le=ye/Z,ke=xe.mag();if("minZoom"in o){const st=s.aA(Math.min(o.minZoom,w,O),y.minZoom,y.maxZoom),It=ye/y.zoomScale(st-w);_e=Math.sqrt(It/ke*2)}const Re=_e*_e;function Ae(st){const It=(Le*Le-ye*ye+(st?-1:1)*Re*Re*ke*ke)/(2*(st?Le:ye)*Re*ke);return Math.log(Math.sqrt(It*It+1)-It)}function Te(st){return(Math.exp(st)-Math.exp(-st))/2}function $e(st){return(Math.exp(st)+Math.exp(-st))/2}const Ze=Ae(0);let Ye=function(st){return $e(Ze)/$e(Ze+_e*st)},it=function(st){return ye*(($e(Ze)*(Te(It=Ze+_e*st)/$e(It))-Te(Ze))/Re)/ke;var It},tt=(Ae(1)-Ze)/_e;if(Math.abs(ke)<1e-6||!isFinite(tt)){if(Math.abs(ye-Le)<1e-6)return this.easeTo(o,f);const st=Le<ye?-1:1;tt=Math.abs(Math.log(Le/ye))/_e,it=function(){return 0},Ye=function(It){return Math.exp(st*_e*It)}}o.duration="duration"in o?+o.duration:1e3*tt/("screenSpeed"in o?+o.screenSpeed/_e:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const vt=E!==U,At=q!==j,et=!y.isPaddingEqual(X),Ue=o.retainPadding===!1?y.clone():y,ft=st=>It=>{const Mt=It*tt,Zt=1/Ye(Mt);st.zoom=It===1?O:w+st.scaleZoom(Zt),vt&&(st.bearing=s.ak(E,U,It)),At&&(st.pitch=s.ak(j,q,It)),et&&(Ue.interpolatePadding(I,X,It),se=Ue.centerPoint.add(J));const Dt=It===1?oe:st.unproject(he.add(xe.mult(it(Mt))).mult(Zt));return st.setLocationAtPoint(st.renderWorldCopies?Dt.wrap():Dt,se),st._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(f),st};if(o.preloadOnly){const st=this._emulate(ft,o.duration,y);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=vt,this._pitching=At,this._padding=et,this._prepareEase(f,!1),this._ease(ft(y),()=>this._afterEase(f),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,f)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,f,y){y.animate===!1||y.duration===0?(o(1),f()):(this._easeStart=s.o.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,f){o=s.bT(o,-180,180);const y=Math.abs(o-f);return Math.abs(o-360-f)<y&&(o-=360),Math.abs(o+360-f)<y&&(o+=360),o}_normalizeCenter(o){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const y=o.lng-f.center.lng;o.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,f,y){const w=Math.ceil(15*f/1e3),E=[],j=o(y.clone());for(let I=0;I<=w;I++){const O=j(I/w);E.push(O.clone())}return E}_preloadTiles(o,f){}}class Mj{constructor(o={}){this.options=o,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const f=this.options&&this.options.compact,y=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=R("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const w=R("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",y),this._innerContainer=R("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(o){const y=f.reduce((w,E,j)=>(E.value&&(w+=`${E.key}=${E.value}${j<f.length-1?"&":""}`),w),"?");o.href=`${s.e.FEEDBACK_URL}/${y}#${Sj(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style._mergedSourceCaches;for(const w in f){const E=f[w];if(E.used){const j=E.getSource();j.attribution&&o.indexOf(j.attribution)<0&&o.push(j.attribution)}}o.sort((w,E)=>w.length-E.length),o=o.filter((w,E)=>{for(let j=E+1;j<o.length;j++)if(o[j].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const y=o.map(w=>function(E){const j=new DOMParser().parseFromString(E,"text/html");return Array.from(j.body.querySelectorAll("*")).reverse().forEach(I=>{const O=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(...I.childNodes);const U=I.getAttribute("href");if(!U||!/^(https?:|mailto:)/i.test(U))return void I.replaceWith(j.createTextNode(O));const q=j.createElement("a");q.href=U,q.textContent=O,q.rel="noopener nofollow";const X=I.getAttribute("class");X&&(q.className=X),I.replaceWith(q)}),j.body.innerHTML}(w)).join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Dj{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=R("div","mapboxgl-ctrl");const f=R("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const f in o){const y=o[f].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const f=o[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Lj{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const f=++this._id;return this._queue.push({callback:o,id:f,cancelled:!1}),f}remove(o){const f=this._currentlyRunning,y=f?this._queue.concat(f):this._queue;for(const w of y)if(w.id===o)return void(w.cancelled=!0)}run(o=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class bi{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const f=s.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,f,y){this._start=this.getValue(f),this._end=o,this._startTime=f,this._endTime=f+y}}const Fj={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class zj extends s.z{constructor(o,f,y,w){const{point:E,lngLat:j,originalEvent:I,target:O}=o;super(o.type,{point:E,lngLat:j,originalEvent:I,target:O}),this.preventDefault=()=>{o.preventDefault()},this.id=f,this.interaction=y,this.feature=w}}class zO{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,f){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const y=f.filter;let w=f.type;y&&this.filters.set(o,s.b6(y)),w==="mouseover"&&(w="mouseenter"),w==="mouseout"&&(w="mouseleave");const E=this.interactionsByType.get(w)||new Map;w==="mouseenter"||w==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,f)):E.size===0&&this.map.on(w,this.handleType),E.size===0&&this.interactionsByType.set(w,E),E.set(o,f),this.typeById.set(o,w)}get(o){const f=this.typeById.get(o);if(!f)return;const y=this.interactionsByType.get(f);return y?y.get(o):void 0}remove(o){const f=this.typeById.get(o);if(!f)return;this.typeById.delete(o),this.filters.delete(o);const y=this.interactionsByType.get(f);y&&(y.delete(o),f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):y.size===0&&this.map.off(f,this.handleType))}queryTargets(o,f){const y=[];for(const[w,E]of f)E.target&&y.push({targetId:w,target:E.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(o,y,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const f=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());f.length&&(o.type="mouseenter",this.handleType(o,f));const y=new Map;for(const[w,{feature:E}]of this.prevHoveredFeatures)this.hoveredFeatures.has(w)||y.set(E.id,E);y.size&&(o.type="mouseleave",this.handleType(o,Array.from(y.values())))}handleOut(o){const f=Array.from(this.hoveredFeatures.values()).map(({feature:y})=>y);f.length&&(o.type="mouseleave",this.handleType(o,f)),this.hoveredFeatures.clear()}handleType(o,f){const y=o.type==="mouseenter";if(y&&!this.interactionsByType.has(o.type))return void s.w("mouseenter interaction required for mouseleave to work.");const w=Array.from(this.interactionsByType.get(o.type)).reverse(),E=!!f;f=f||this.queryTargets(o.point,w);let j=!1;const I=new Set;for(const O of f){for(const[U,q]of w){if(!q.target)continue;const X=O.variants?O.variants[U]:null;if(X){for(const Z of X){if(sg(Z,O,I,U))continue;const J=new s.dx(O,Z),se=gl(Z,O,U);E&&J.id!==void 0&&(J.state=this.map.getFeatureState(J));const re=y?this.prevHoveredFeatures.get(se):null,oe=new zj(o,U,q,J),he=re?re.stop:q.handler(oe);if(y&&this.hoveredFeatures.set(se,{feature:O,stop:he}),he!==!1){j=!0;break}}if(j)break}}if(j)break}if(!j)for(const[O,U]of w){const{handler:q,target:X}=U;if(!X&&q(new zj(o,O,U,null))!==!1)break}}}function BO(g,o){if(Array.isArray(g)&&Array.isArray(o)){const f=new Set(g),y=new Set(o);return f.size===y.size&&g.every(w=>y.has(w))}return s.by(g,o)}const Ug={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Bj={showCompass:!0,showZoom:!0,visualizePitch:!1};class r1{constructor(o,f,y=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new x_({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new b_({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(o,f){this.mouseRotate.mousedown(o,f),this.mousePitch&&this.mousePitch.mousedown(o,f),K()}move(o,f){const y=this.map,w=this.mouseRotate.mousemoveWindow(o,f),E=w&&w.bearingDelta;if(E&&y.setBearing(y.getBearing()+E),this.mousePitch){const j=this.mousePitch.mousemoveWindow(o,f),I=j&&j.pitchDelta;I&&y.setPitch(y.getPitch()+I)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Y(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ie(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ie(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ge(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=ge(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function qg(g,o,f){if(g=new s.aT(g.lng,g.lat),o){const y=new s.aT(g.lng-360,g.lat),w=new s.aT(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-f.center.lng)/360),j=f.locationPoint3D(g).distSqr(o),I=o.x<0||o.y<0||o.x>f.width||o.y>f.height;f.locationPoint3D(y).distSqr(o)<j&&(I||Math.abs(y.lng-f.center.lng)<E)?g=y:f.locationPoint3D(w).distSqr(o)<j&&(I||Math.abs(w.lng-f.center.lng)<E)&&(g=w)}for(;Math.abs(g.lng-f.center.lng)>180;){const y=f.locationPoint3D(g);if(y.x>=0&&y.y>=0&&y.x<=f.width&&y.y<=f.height)break;g.lng>f.center.lng?g.lng-=360:g.lng+=360}return g}const vc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},wl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ps extends s.E{constructor(o,f){super(),(o instanceof HTMLElement||f)&&(o=Object.assign({element:o},f)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:y="center",color:w="#3FB1CE",scale:E=1,draggable:j=!1,clickTolerance:I=0,rotation:O=wl.rotation,rotationAlignment:U=wl.rotationAlignment,pitchAlignment:q=wl.pitchAlignment,occludedOpacity:X=wl.occludedOpacity,altitude:Z=wl.altitude}=o||{};this._anchor=y,this._color=w,this._scale=E,this._draggable=j,this._clickTolerance=I,this._rotation=O,this._rotationAlignment=U,this._pitchAlignment=q,this._occludedOpacity=X,this._altitude=Z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",re=>{re.preventDefault()}),this._element.addEventListener("mousedown",re=>{re.preventDefault()});const J=this._element.classList;for(const re in vc)J.remove(`mapboxgl-marker-anchor-${re}`);J.add(`mapboxgl-marker-anchor-${this._anchor}`);const se=o&&o.className?o.className.trim().split(/\s+/):[];J.add(...se),this._popup=null}_createDefaultMarker(){const o=R("div"),f=D("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const y=D("radialGradient",{id:"shadowGradient"},D("defs",{},f));D("stop",{offset:"10%","stop-opacity":.4},y),D("stop",{offset:"100%","stop-opacity":.05},y),D("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f)}return D("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),D("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),D("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||wl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const f=o.code,y=o.charCode||o.keyCode;f!=="Space"&&f!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const f=o.originalEvent.target,y=this._element;this._popup&&(f===y||y.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,f=this._pos;if(!o||!f)return!1;const y=o.unproject(f,this._altitude),w=o.getFreeCameraOptions();if(!w.position)return!1;const E=w.position.toLngLat();return E.distanceTo(y)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const f=this._pos;if(!f||f.x<0||f.x>o.transform.width||f.y<0||f.y>o.transform.height)return void this._clearFadeTimer();const y=o.unproject(f,this._altitude);let w;o._showingGlobe()&&s.f5(o.transform,this._lngLat)?w=0:(w=1-o._queryFogOpacity(y),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${vc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const o=this._pos,f=this._map,y=this.getPitchAlignment();if(!f||!o||y!=="map")return"";if(!f._showingGlobe()){const O=f.getPitch();return O?`rotateX(${O}deg)`:""}const w=s.cX(s.f6(f.transform,this._lngLat)),E=o.sub(s.f7(f.transform)),j=Math.abs(E.x)+Math.abs(E.y);if(j===0)return"";const I=w/j;return`rotateX(${-E.y*I}deg) rotateY(${E.x*I}deg)`}_calculateZTransform(){const o=this._pos,f=this._map;if(!f||!o)return"";let y=0;const w=this.getRotationAlignment();if(w==="map")if(f._showingGlobe()){const E=f.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),j=f.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(E);y=s.cX(Math.atan2(j.y,j.x))-90}else y=-f.getBearing();else if(w==="horizon"){const E=s.ah(4,6,f.getZoom()),j=s.f7(f.transform);j.y+=E*f.transform.height;const I=o.sub(j),O=s.cX(Math.atan2(I.y,I.x));y=(O>90?O-270:O+90)*(1-E)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=qg(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const f=this._map;if(!f)return;const y=this._pointerdownPos,w=this._positionDelta;if(y&&w){if(!this._isDragging){const E=this._clickTolerance||f._clickTolerance;if(o.point.dist(y)<E)return;this._isDragging=!0}this._pos=o.point.sub(w),this._lngLat=f.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(o){const f=this._map,y=this._pos;f&&y&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(y),this._pointerdownPos=o.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const f=this._map;return f&&(o?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||wl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||wl.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||wl.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||wl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Sl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Gg={maxWidth:100,unit:"metric"},E_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$j={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},$O=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tp(g=new s.P(0,0),o="bottom"){if(typeof g=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(o){case"top":return new s.P(0,g);case"top-left":return new s.P(f,f);case"top-right":return new s.P(-f,f);case"bottom":return new s.P(0,-g);case"bottom-left":return new s.P(f,-f);case"bottom-right":return new s.P(-f,-f);case"left":return new s.P(g,0);case"right":return new s.P(-g,0)}return new s.P(0,0)}return g instanceof s.P||Array.isArray(g)?s.P.convert(g):s.P.convert(g[o]||[0,0])}return{version:_,supported:B.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends Rj{constructor(g){T.mark(b.create);const o=g;if((g=Object.assign({},Ug,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&s.f3(window)&&(g.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bv(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Lj,this._domRenderTaskQueue=new Lj,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Fj,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bi(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new ve(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const f=document.getElementById(g.container);if(!f)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=f}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Oj(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||s.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new co(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const f=g.bounds;f&&(this.resize(),this.fitBounds(f,Object.assign({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Mj({customAttribution:g.customAttribution})),this._logoControl=new Dj,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new s.z(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new s.z(`${f.dataType}dataloading`,f))}),this._interactions=new zO(this)}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(f,y.firstChild):y.appendChild(f),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.z("movestart",g)).fire(new s.z("move",g)),this.fire(new s.z("resize",g)),o&&this.fire(new s.z("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(s.aI.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(o=>o==="auto"?navigator.language:o):g}setLanguage(g){const o=this._parseLanguage(g);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,o=g.projection.name;let f;o==="globe"&&g.zoom>=s.cL?(g.setMercatorFromTransition(),f=!0):o==="mercator"&&g.zoom<s.cL&&(g.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,o){return this._updateProjection(g||o||{name:"mercator"})}_updateProjection(g){let o;const f=this.transform.mercatorFromTransition;o=g.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate();const y=this.transform.getProjection().name==="mercator"&&f!==this.transform.mercatorFromTransition;return(o||y)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,o){return this.transform.locationPoint3D(s.aT.convert(g),o)}unproject(g,o){return this.transform.pointLocation3D(s.P.convert(g),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,o,f){const y=w=>{let E=[];if(Array.isArray(o)){const j=o.filter(I=>this.getLayer(I));E=j.length?this.queryRenderedFeatures(w,{layers:j}):[]}else E=this.queryRenderedFeatures(w,{target:o});return E};if(g==="mouseenter"||g==="mouseover"){let w=!1;return{listener:f,targets:o,delegates:{mousemove:j=>{const I=y(j.point);I.length?w||(w=!0,f.call(this,new aa(g,this,j.originalEvent,{features:I}))):w=!1},mouseout:()=>{w=!1}}}}if(g==="mouseleave"||g==="mouseout"){let w=!1;return{listener:f,targets:o,delegates:{mousemove:I=>{y(I.point).length?w=!0:w&&(w=!1,f.call(this,new aa(g,this,I.originalEvent)))},mouseout:I=>{w&&(w=!1,f.call(this,new aa(g,this,I.originalEvent)))}}}}{const w=E=>{const j=y(E.point);j.length&&(E.features=j,f.call(this,E),delete E.features)};return{listener:f,targets:o,delegates:{[g]:w}}}}on(g,o,f){if(typeof o=="function"||f===void 0)return super.on(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const w in y.delegates)this.on(w,y.delegates[w]);return this}once(g,o,f){if(typeof o=="function"||f===void 0)return super.once(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,f);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(g,o,f){if(typeof o=="function"||f===void 0)return super.off(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._delegatedListeners?this._delegatedListeners[g]:void 0;return y&&(w=>{for(let E=0;E<w.length;E++){const j=w[E];if(j.listener===f&&BO(j.targets,o)){for(const I in j.delegates)this.off(I,j.delegates[I]);return w.splice(E,1),this}}})(y),this}queryRenderedFeatures(g,o){if(!this.style)return[];if(g===void 0||g instanceof s.P||Array.isArray(g)||o!==void 0||(o=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!o){const E=this.style.queryRenderedFeatures(g,void 0,this.transform),j=this.style.queryRenderedFeatureset(g,void 0,this.transform);return E.concat(j)}let f=!0;if(o.target&&(f=this._isTargetValid(o.target),f&&!o.layers))return this.style.queryRenderedFeatureset(g,o,this.transform);let y=!0;if(o.layers&&Array.isArray(o.layers)){for(const E of o.layers)if(!this._isValidId(E)){y=!1;break}if(y&&!o.target)return this.style.queryRenderedFeatures(g,o,this.transform)}let w=[];return y&&(w=w.concat(this.style.queryRenderedFeatures(g,o,this.transform))),f&&(w=w.concat(this.style.queryRenderedFeatureset(g,o,this.transform))),w}querySourceFeatures(g,o){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,o)}queryRasterValue(g,o,f){return this._isValidId(g)?this.style.queryRasterValue(g,o,f):Promise.resolve(null)}isPointOnSurface(g){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(g))}addInteraction(g,o){return this._interactions.add(g,o),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&g&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(g,(f,y)=>{if(f){const w=typeof f=="string"?f:f instanceof Error?f.message:f.error;s.w(`Unable to perform style diff: ${w}. Rebuilding the style from scratch.`),this._updateStyle(g,o)}else y&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(g,o))}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const f=Object.assign({},o);o&&o.config&&(f.initialConfig=o.config,delete f.config),this.style=new Ho(this,f).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(g)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const o of g)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(g)}addSource(g,o){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,o,f){this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,f)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,o,{pixelRatio:f=1,sdf:y=!1,stretchX:w,stretchY:E,content:j}={}){this._lazyInitEmptyStyle();const I=s.I.from(g);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:O,height:U,data:q}=s.o.getImageData(o);this.style.addImage(I,{data:new s.q({width:O,height:U},q),pixelRatio:f,stretchX:w,stretchY:E,content:j,sdf:y,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:U}=o,q=o;this.style.addImage(I,{data:new s.q({width:O,height:U},new Uint8Array(q.data)),pixelRatio:f,stretchX:w,stretchY:E,content:j,sdf:y,usvg:!1,version:0,userImage:q}),q.onAdd&&q.onAdd(this,g)}}updateImage(g,o){this._lazyInitEmptyStyle();const f=s.I.from(g),y=this.style.getImage(f);if(!y)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?s.o.getImageData(o):o,{width:E,height:j,data:I}=w;if(E===void 0||j===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(E!==(y.usvg?y.icon.usvg_tree.width:y.data.width)||j!==(y.usvg?y.icon.usvg_tree.height:y.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${E}, ${j})
                must be that same as the previous version of the image
                (${y.data.width}, ${y.data.height})`)));const O=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let U=!1;y.usvg?(y.data=new s.q({width:E,height:j},new Uint8Array(I)),y.usvg=!1,y.icon=void 0,U=!0):y.data.replace(I,O),this.style.updateImage(f,y,U)}hasImage(g){return g?!!this.style&&!!this.style.getImage(s.I.from(g)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(s.I.from(g))}loadImage(g,o){s.n(this._requestManager.transformRequest(g,s.R.Image),(f,y)=>{o(f,y instanceof HTMLImageElement?s.o.getImageData(y):y)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,o){this._lazyInitEmptyStyle(),this.style.addModel(g,o)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,o){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)):this}getSlot(g){const o=this.getLayer(g);return o&&o.slot||null}setSlot(g,o){return this.style.setSlot(g,o),this.style.mergeLayers(),this._update(!0)}addImport(g,o){return this.style.addImport(g,o).catch(f=>this.fire(new s.y(new Error("Failed to add import",f)))),this}updateImport(g,o){return typeof o!="string"&&o.id!==g?(this.removeImport(g),this.addImport(o)):(this.style.updateImport(g,o),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,o){return this.style.moveImport(g,o),this._update(!0)}moveLayer(g,o){return this._isValidId(g)?(this.style.moveLayer(g,o),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const o=this.style.getOwnLayer(g);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,o,f){return this._isValidId(g)?(this.style.setLayerZoomRange(g,o,f),this._update(!0)):this}setFilter(g,o,f={}){return this._isValidId(g)?(this.style.setFilter(g,o,f),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,o,f,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,o,f,y),this._update(!0)):this}getPaintProperty(g,o){return this._isValidId(g)?this.style.getPaintProperty(g,o):null}setLayoutProperty(g,o,f,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,o,f,y),this._update(!0)):this}getLayoutProperty(g,o){return this._isValidId(g)?this.style.getLayoutProperty(g,o):null}setLayerProperty(g,o,f,y={}){return this._isValidId(g)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(g,o,f,y),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,o){return this.style.setSchema(g,o),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,o){return this.style.setConfig(g,o),this._update(!0)}getConfigProperty(g,o){return this.style.getConfigProperty(g,o)}setConfigProperty(g,o,f){return this.style.setConfigProperty(g,o,f),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const o=g[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,o),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(g),this.transform):0}setFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,o),this._update())}removeFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,o),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_selectIndoorFloor(g){this.style.indoorManager.selectFloor(g)}_setIndoorActiveFloorsVisibility(g){this.style.indoorManager.setActiveFloorsVisibility(g)}getIndoorTileOptions(g,o){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(g,o):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let f,y,w,E=this._container;for(;E&&(!y||!w);){const j=window.getComputedStyle(E).transform;j&&j!=="none"&&(f=j.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(y=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(w=f[3])),E=E.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=w?Math.abs(o/w):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=R("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=R("div","mapboxgl-canvas-container",g);this._canvas=R("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=R("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{y[w]=R("div",`mapboxgl-ctrl-${w}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o){const f=s.o.devicePixelRatio||1;this._canvas.width=f*Math.ceil(g),this._canvas.height=f*Math.ceil(o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const o=this._markers.indexOf(g);o!==-1&&this._markers.splice(o,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const o=this._popups.indexOf(g);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const g=Object.assign({},B.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",g);o?(ni(o,!0),this.painter=new bj(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",f=>{if(f.dataType==="source"){const y=this.transform.elevation?this.transform.elevation._source():null;y&&f.sourceCacheId===y.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(o)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let o;this.fire(new s.z("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,y=s.o.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=w.createQuery(),w.beginQuery(f.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,U=this.transform.pitch,q=s.o.now(),X=new s.ac(O,{now:q,fadeDuration:E,pitch:U,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let j=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),j=this._updateAverageElevation(y),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):j=this._updateAverageElevation(y),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,T.mark(b.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const O=s.o.now()-y;w.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const U=w.getQueryParameter(o,w.QUERY_RESULT)/1e6;w.deleteQuery(o),this.fire(new s.z("gpu-timing-frame",{cpuTime:O,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(O);this.fire(new s.z("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(O);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:U}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||j;if(I||this._repaint)this.triggerRepaint();else{const O=this.idle();if(O&&(j=this._updateAverageElevation(y,!0)),j)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,T.mark(b.fullLoad),this._performanceMetricsCollection&&pr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const o of this._markers)g&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!g||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(g,o=!1){const f=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(o||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const w=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=g;const j=Math.abs(w-E);if(j>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(E),f(E);this._averageElevation.easeTo(E,g,300)}else if(j>1e-4)return this._averageElevation.jumpTo(E),f(E)}return!!this._averageElevation.isEasing(g)&&f(this._averageElevation.getValue(g))}_authenticate(){Xn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===Ce||g.status===401)){const o=this.painter.context.gl;ni(o,!1),this._logoControl instanceof Dj&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Pt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Gt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ot(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){ur(this._requestManager._customAccessToken)}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const f=this.painter.context.gl,y=f.createFramebuffer();function w(E){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,E,0);const j=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,j),j}return f.bindFramebuffer(f.FRAMEBUFFER,y),this._canvasPixelComparison(w(g),o.canvasCopies.map(w),o.timeStamps)}_canvasPixelComparison(g,o,f){let y=f[1]-f[0];const w=g.length/4;for(let E=0;E<o.length;E++){const j=o[E];let I=0;for(let O=0;O<j.length;O+=4)j[O]===g[O]&&j[O+1]===g[O+1]&&j[O+2]===g[O+2]&&j[O+3]===g[O+3]&&(I+=1);y+=(f[E+2]-f[E+1])*(1-I/w)}return y}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Jn.delete(this.painter.context.gl),Kr.remove(),Bt.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=s.o.frame(o=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(o)}))}_preloadTiles(g){const o=this.style?this.style.getSourceCaches():[];return s.bw(o,(f,y)=>f._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this.style&&g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,o){s.f4(g,o)}get version(){return _}},NavigationControl:class{constructor(g={}){this.options=Object.assign({},Bj,g),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),R("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),R("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:o}):f.resetNorth({},{originalEvent:o}))}),this._compassIcon=R("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const o=g.getZoom(),f=o===g.getMaxZoom(),y=o===g.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new r1(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,o){const f=R("button",g,this._container);return f.type="button",f.addEventListener("click",o),f}_setButtonTitle(g,o){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${o}`);g.setAttribute("aria-label",f),g.firstElementChild&&g.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.E{constructor(g={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},Sl,g),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wj(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const o=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,g(f)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>o(f.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),f=g.coords;return!!o&&(f.longitude<o.getWest()||f.longitude>o.getEast()||f.latitude<o.getSouth()||f.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:g.coords,timestamp:g.timestamp},g.toJSON?{toJSON:g.toJSON.bind(g)}:{}))),this._finish()}}_updateCamera(g){const o=new s.aT(g.coords.longitude,g.coords.latitude),f=g.coords.accuracy,y=this._map.getBearing(),w=Object.assign({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(f),w,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new s.aT(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,o=s.cf(1,g._center.lat)*g.worldSize,f=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:g.code,message:g.message,PERMISSION_DENIED:g.PERMISSION_DENIED,POSITION_UNAVAILABLE:g.POSITION_UNAVAILABLE,TIMEOUT:g.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const g=this.options.positionOptions.timeout;g&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},g))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=R("button","mapboxgl-ctrl-geolocate",this._container),R("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R("div","mapboxgl-user-location"),this._dotElement.appendChild(R("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(R("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ps({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=R("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ps({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(g){return this.options.followUserLocation=g??Sl.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const g=()=>{const o="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(o,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mj,ScaleControl:class{constructor(g={}){this.options=Object.assign({},Gg,g),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,o=this._map,f=o._containerHeight/2,y=o._containerWidth/2-g/2,w=o.unproject([y,f]),E=o.unproject([y+g,f]),j=w.distanceTo(E);if(this.options.unit==="imperial"){const I=3.2808*j;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else this.options.unit==="nautical"?this._setScale(g,j/1852,"nautical-mile"):j>=1e3?this._setScale(g,j/1e3,"kilometer"):this._setScale(g,j,"meter")}_setScale(g,o,f){this._map._requestDomTask(()=>{const y=function(E){const j=Math.pow(10,`${Math.floor(E)}`.length-1);let I=E/j;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(O){const U=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*U)/U}(I),j*I}(o),w=y/o;this._container.innerHTML=f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(y):`${y}&nbsp;${E_[f]}`,this._container.style.width=g*w+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=R("button","mapboxgl-ctrl-fullscreen",this._controlContainer);R("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Hb,Popup:class extends s.E{constructor(g){super(),this.options=Object.assign(Object.create($j),g),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=s.aT.convert(g),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),f=document.createElement("body");let y;for(f.innerHTML=g;y=f.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=R("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(g),this.options.closeButton){const f=this._closeButton=R("button","mapboxgl-popup-close-button",o);f.type="button",f.setAttribute("aria-label","Close popup"),f.innerHTML='<span aria-hidden="true">&#215;</span>',f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let o;return this._classList.delete(g)?o=!1:(this._classList.add(g),o=!0),this._updateClassList(),o}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const o=this._map,f=this._container,y=this._pos;if(!o||!f||!y)return"bottom";const w=f.offsetWidth,E=f.offsetHeight,j=y.x<w/2,I=y.x>o.transform.width-w/2;if(y.y+g<E)return j?"top-left":I?"top-right":"top";if(y.y>o.transform.height-E){if(j)return"bottom-left";if(I)return"bottom-right"}return j?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),g.className=o.join(" ")}_update(g){const o=this._map,f=this._content;if(!o||!this._lngLat&&!this._trackPointer||!f)return;let y=this._container;if(y||(y=this._container=R("div","mapboxgl-popup",o.getContainer()),this._tip=R("div","mapboxgl-popup-tip",y),y.appendChild(f)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qg(this._lngLat,this._pos,o.transform)),!this._trackPointer||g){const w=this._pos=this._trackPointer&&g instanceof s.P?g:o.project(this._lngLat,this._altitude),E=Tp(this.options.offset),j=this._anchor=this._getAnchor(E.y),I=Tp(this.options.offset,j),O=w.add(I).round();o._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${vc[j]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&o._showingGlobe()){const w=s.f5(o.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector($O);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:ps,Style:Ho,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:CE,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(g){s.e.ACCESS_TOKEN=g},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(g){s.e.API_URL=g},get workerCount(){return s.fi.workerCount},set workerCount(g){s.fi.workerCount=g},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){s.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){s.fh(g)},get workerUrl(){return s.fg.workerUrl},set workerUrl(g){s.fg.workerUrl=g},get workerClass(){return s.fg.workerClass},set workerClass(g){s.fg.workerClass=g},get workerParams(){return s.fg.workerParams},set workerParams(g){s.fg.workerParams=g},get dracoUrl(){return s.ff()},set dracoUrl(g){s.fe(g)},get meshoptUrl(){return s.fd()},set meshoptUrl(g){s.fc(g)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var p=a;return p})})(Aue);var qrt=Aue.exports;const ch=es(qrt),Grt=({orderId:e,enabled:t=!0})=>{const[r,n]=F.useState(null),[a,d]=F.useState(!1),[p,s]=F.useState(null),_=F.useCallback(async()=>{const{data:b,error:T}=await dt.from("driver_locations").select("*").eq("order_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(T){console.error("Error fetching location:",T),s(T.message);return}b&&n(b)},[e]);return F.useEffect(()=>{if(!t||!e)return;_();const b=dt.channel(`driver-location-${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"driver_locations",filter:`order_id=eq.${e}`},T=>{console.log("New location received:",T.new),n(T.new)}).subscribe(T=>{console.log("Realtime subscription status:",T),d(T==="SUBSCRIBED"),T==="CHANNEL_ERROR"&&s("Erro ao conectar ao rastreamento em tempo real")});return()=>{dt.removeChannel(b)}},[e,t,_]),{location:r,isConnected:a,error:p,refetch:_}},Pue=({orderId:e,deliveryLatitude:t,deliveryLongitude:r,establishmentLatitude:n,establishmentLongitude:a,className:d=""})=>{const p=F.useRef(null),s=F.useRef(null),_=F.useRef(null),[b,T]=F.useState(null),[C,P]=F.useState(!0),{location:k,isConnected:B,error:R}=Grt({orderId:e,enabled:!!b});return F.useEffect(()=>{(async()=>{var G;try{const{data:V,error:$}=await dt.functions.invoke("mapbox",{body:{action:"get_token"}});if($)throw $;V!=null&&V.success&&((G=V==null?void 0:V.data)!=null&&G.token)&&T(V.data.token)}catch(V){console.error("Error fetching Mapbox token:",V)}finally{P(!1)}})()},[]),F.useEffect(()=>{if(!b||!p.current||s.current)return;ch.accessToken=b;const D=[r||-46.6333,t||-23.5505];if(s.current=new ch.Map({container:p.current,style:"mapbox://styles/mapbox/streets-v12",center:D,zoom:14}),s.current.addControl(new ch.NavigationControl,"top-right"),t&&r){const G=document.createElement("div");G.innerHTML=`
        <div class="flex items-center justify-center w-10 h-10 bg-primary rounded-full shadow-lg border-2 border-white">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
        </div>
      `,new ch.Marker({element:G}).setLngLat([r,t]).addTo(s.current)}if(n&&a){const G=document.createElement("div");G.innerHTML=`
        <div class="flex items-center justify-center w-10 h-10 bg-orange-500 rounded-full shadow-lg border-2 border-white">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
            <path d="M9 22V12h6v10"/>
          </svg>
        </div>
      `,new ch.Marker({element:G}).setLngLat([a,n]).addTo(s.current)}return()=>{s.current&&(s.current.remove(),s.current=null)}},[b,t,r,n,a]),F.useEffect(()=>{if(!s.current||!k)return;const{latitude:D,longitude:G}=k;if(_.current)_.current.setLngLat([G,D]);else{const V=document.createElement("div");V.innerHTML=`
        <div class="relative">
          <div class="flex items-center justify-center w-12 h-12 bg-green-500 rounded-full shadow-lg border-3 border-white animate-pulse">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <circle cx="18.5" cy="17.5" r="3.5"/>
              <circle cx="5.5" cy="17.5" r="3.5"/>
              <circle cx="15" cy="5" r="1"/>
              <path d="M12 17.5V14l-3-3 4-3 2 3h2"/>
            </svg>
          </div>
          <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-8 border-l-transparent border-r-transparent border-t-green-500"></div>
        </div>
      `,_.current=new ch.Marker({element:V}).setLngLat([G,D]).addTo(s.current),s.current.flyTo({center:[G,D],zoom:15,duration:1e3})}},[k]),C?c.jsx("div",{className:`flex items-center justify-center bg-muted rounded-xl ${d}`,children:c.jsx(Ma,{className:"w-8 h-8 animate-spin text-primary"})}):b?c.jsxs("div",{className:`relative rounded-xl overflow-hidden ${d}`,children:[c.jsx("div",{ref:p,className:"w-full h-full"}),c.jsx("div",{className:"absolute top-3 left-3 z-10",children:c.jsxs(dn,{variant:B?"default":"secondary",className:B?"bg-green-500 text-white":"",children:[c.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${B?"bg-white animate-pulse":"bg-gray-400"}`}),B?"Ao vivo":"Conectando..."]})}),c.jsxs("div",{className:"absolute bottom-3 left-3 z-10 bg-white/90 backdrop-blur-sm rounded-lg p-2 text-xs space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),c.jsx("span",{children:"Entregador"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-4 h-4 bg-primary rounded-full"}),c.jsx("span",{children:"Destino"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded-full"}),c.jsx("span",{children:"Loja"})]})]}),R&&c.jsx("div",{className:"absolute top-3 right-3 z-10 bg-red-500 text-white text-xs px-2 py-1 rounded",children:R})]}):c.jsx("div",{className:`flex items-center justify-center bg-muted rounded-xl ${d}`,children:c.jsx("p",{className:"text-muted-foreground",children:"Mapa no disponvel"})})},Wrt=()=>{const e=di(),{user:t,loading:r,isDriver:n,isDriverApproved:a}=$i(),[d,p]=F.useState(null),[s,_]=F.useState([]),[b,T]=F.useState(null),[C,P]=F.useState(!0),[k,B]=F.useState(!1),[R,D]=F.useState(!1),{isTracking:G,lastUpdate:V,startTracking:$,stopTracking:K,isSupported:Y}=Urt({orderId:(d==null?void 0:d.id)||"",driverId:(t==null?void 0:t.id)||"",updateIntervalMs:5e3,onError:be=>console.error("Tracking error:",be)});F.useEffect(()=>{d&&t&&Y&&!G&&$()},[d,t,Y]),F.useEffect(()=>()=>{G&&K()},[G,K]),F.useEffect(()=>{if(!r&&(!t||!n)){e("/auth");return}if(!r&&t&&n&&!a){e("/entregador");return}t&&ee()},[t,r,n,e]);const ee=async()=>{try{const{data:be}=await dt.from("orders").select("*").eq("driver_id",t.id).eq("status","out_for_delivery").maybeSingle();if(be){p(be);const{data:ue}=await dt.from("order_items").select("*").eq("order_id",be.id);_(ue||[]);const{data:Ce}=await dt.from("establishments").select("*").eq("id",be.establishment_id).maybeSingle();T(Ce)}}catch{gt.error("Erro ao carregar pedido")}finally{P(!1)}},ae=async()=>{if(!d)return;const{error:be}=await dt.from("orders").update({status:"delivered",delivered_at:new Date().toISOString()}).eq("id",d.id);be?gt.error("Erro ao confirmar entrega"):(gt.success("Entrega confirmada com sucesso! "),B(!1),e("/entregador"))},ie=be=>{const ue=encodeURIComponent(be);window.open(`https://www.google.com/maps/search/?api=1&query=${ue}`,"_blank")},ge=be=>{window.open(`tel:${be}`,"_self")};if(r||C)return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})});if(!d)return c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Bm,{open:R,onClose:()=>D(!1)}),c.jsx("main",{className:"flex-1 flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx(Bc,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),c.jsx("h2",{className:"text-xl font-bold mb-2",children:"Nenhuma entrega em andamento"}),c.jsx("p",{className:"text-muted-foreground mb-4",children:"Aceite um pedido para iniciar uma entrega"}),c.jsx(Ft,{onClick:()=>e("/entregador/disponiveis"),children:"Ver Pedidos Disponveis"})]})})]});const fe=d.out_for_delivery_at?Math.round((Date.now()-new Date(d.out_for_delivery_at).getTime())/6e4):0;return c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Bm,{open:R,onClose:()=>D(!1)}),c.jsxs("main",{className:"flex-1",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>D(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"font-bold text-lg",children:"Entrega em Andamento"}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",d.order_number]})]}),c.jsxs(dn,{className:"bg-purple-500 animate-pulse",children:[c.jsx(T0,{className:"w-3 h-3 mr-1"}),"Em Rota"]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 max-w-2xl mx-auto space-y-4",children:[c.jsx(gr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-2",children:c.jsxs(Hr,{className:"text-base flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(a_e,{className:"w-4 h-4"}),"Rastreamento ao Vivo"]}),c.jsx(dn,{variant:G?"default":"secondary",className:G?"bg-green-500":"",children:G?"Ativo":"Pausado"})]})}),c.jsxs(Ut,{className:"pt-0",children:[c.jsx(Pue,{orderId:d.id,deliveryLatitude:d.delivery_latitude,deliveryLongitude:d.delivery_longitude,establishmentLatitude:b!=null&&b.latitude?Number(b.latitude):void 0,establishmentLongitude:b!=null&&b.longitude?Number(b.longitude):void 0,className:"h-48 rounded-lg"}),V&&c.jsxs("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:["ltima atualizao: ",V.toLocaleTimeString()]}),c.jsx("div",{className:"flex gap-2 mt-3",children:G?c.jsx(Ft,{variant:"outline",size:"sm",className:"flex-1",onClick:K,children:"Pausar Rastreamento"}):c.jsx(Ft,{size:"sm",className:"flex-1",onClick:$,children:"Ativar Rastreamento"})})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.05},children:c.jsx(Vt,{className:"border-primary bg-primary/5",children:c.jsx(Ut,{className:"py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(ki,{className:"w-5 h-5 text-primary"}),c.jsx("span",{className:"font-medium",children:"Tempo em rota"})]}),c.jsxs("span",{className:"text-2xl font-bold text-primary",children:[fe," min"]})]})})})}),b&&c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(Bi,{className:"w-4 h-4"}),"Local de Retirada"]})}),c.jsxs(Ut,{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[b.logo_url?c.jsx("img",{src:b.logo_url,alt:b.name,className:"w-12 h-12 rounded-lg object-cover"}):c.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:c.jsx(Bi,{className:"w-6 h-6 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold",children:b.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:b.address})]})]}),b.phone&&c.jsxs(Ft,{variant:"outline",className:"w-full",onClick:()=>ge(b.phone),children:[c.jsx($c,{className:"w-4 h-4 mr-2"}),"Ligar para Estabelecimento"]})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsxs(Vt,{className:"border-2 border-primary",children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(zi,{className:"w-4 h-4 text-primary"}),"Entregar em"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"bg-muted/50 rounded-xl p-4 space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(to,{className:"w-4 h-4 text-muted-foreground"}),c.jsx("span",{className:"font-bold",children:d.customer_name})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(zi,{className:"w-4 h-4 text-primary mt-0.5"}),c.jsx("span",{children:d.delivery_address})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs(Ft,{variant:"outline",onClick:()=>ge(d.customer_phone),children:[c.jsx($c,{className:"w-4 h-4 mr-2"}),"Ligar"]}),c.jsxs(Ft,{variant:"outline",onClick:()=>ie(d.delivery_address),children:[c.jsx(T0,{className:"w-4 h-4 mr-2"}),"GPS"]})]})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(cs,{className:"w-4 h-4"}),"Itens do Pedido"]})}),c.jsxs(Ut,{children:[c.jsx("div",{className:"space-y-2",children:s.map(be=>c.jsx("div",{className:"flex justify-between items-center p-2 bg-muted/30 rounded-lg",children:c.jsxs("span",{children:[be.quantity,"x ",be.product_name]})},be.id))}),d.notes&&c.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(t_e,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-medium text-yellow-700 dark:text-yellow-300",children:"Observaes"}),c.jsx("p",{className:"text-sm",children:d.notes})]})]})})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:c.jsxs(Ft,{className:"w-full h-14 text-lg",onClick:()=>B(!0),children:[c.jsx(Da,{className:"w-5 h-5 mr-2"}),"Confirmar Entrega"]})})]}),c.jsx($l,{open:k,onOpenChange:B,children:c.jsxs(ul,{children:[c.jsxs(dl,{children:[c.jsx(hl,{children:"Confirmar Entrega"}),c.jsxs(Dm,{children:["Voc confirma que o pedido #",d.order_number," foi entregue ao cliente"," ",c.jsx("strong",{children:d.customer_name}),"?"]})]}),c.jsxs(Ff,{children:[c.jsx(Ft,{variant:"outline",onClick:()=>B(!1),children:"Cancelar"}),c.jsxs(Ft,{onClick:ae,children:[c.jsx(Da,{className:"w-4 h-4 mr-2"}),"Confirmar Entrega"]})]})]})})]})]})},Hrt=()=>{const e=di(),{user:t,isDriver:r,isDriverApproved:n,loading:a}=$i(),[d,p]=F.useState(!0),[s,_]=F.useState(!1),[b,T]=F.useState([]),[C,P]=F.useState("week");F.useEffect(()=>{if(!a&&(!t||!r)){e("/entregador/auth");return}if(!a&&t&&r&&!n){e("/entregador");return}t&&k()},[t,a,r,e,C]);const k=async()=>{p(!0);try{let G=dt.from("orders").select("*").eq("driver_id",t.id).eq("status","delivered").order("delivered_at",{ascending:!1});if(C==="week"){const K=new Date;K.setDate(K.getDate()-7),G=G.gte("delivered_at",K.toISOString())}else if(C==="month"){const K=new Date;K.setMonth(K.getMonth()-1),G=G.gte("delivered_at",K.toISOString())}const{data:V,error:$}=await G;if($)throw $;T(V||[])}catch{gt.error("Erro ao carregar histrico")}finally{p(!1)}},B=b.reduce((G,V)=>G+Number(V.delivery_fee),0),R=()=>{const G=b.filter($=>$.out_for_delivery_at&&$.delivered_at);if(G.length===0)return 0;const V=G.reduce(($,K)=>{const Y=new Date(K.out_for_delivery_at).getTime(),ee=new Date(K.delivered_at).getTime();return $+(ee-Y)/6e4},0);return Math.round(V/G.length)},D=G=>{if(!G.out_for_delivery_at||!G.delivered_at)return"";const V=new Date(G.out_for_delivery_at).getTime(),$=new Date(G.delivered_at).getTime();return`${Math.round(($-V)/6e4)} min`};return a||d?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-green-500"})}):c.jsxs("div",{className:"min-h-screen bg-background flex w-full",children:[c.jsx(Bm,{open:s,onClose:()=>_(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>_(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ki,{className:"w-5 h-5 text-green-600"}),c.jsx("h1",{className:"font-bold text-lg",children:"Histrico"})]})]})})}),c.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:c.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[c.jsx("div",{className:"flex gap-2",children:[{key:"week",label:"ltima Semana"},{key:"month",label:"ltimo Ms"},{key:"all",label:"Todas"}].map(G=>c.jsx(Ft,{variant:C===G.key?"default":"outline",size:"sm",onClick:()=>P(G.key),className:C===G.key?"bg-green-500 hover:bg-green-600":"",children:G.label},G.key))}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:c.jsx(Vt,{children:c.jsxs(Ut,{className:"pt-6 text-center",children:[c.jsx(cs,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),c.jsx("p",{className:"text-2xl font-bold",children:b.length}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Entregas"})]})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsx(Vt,{children:c.jsxs(Ut,{className:"pt-6 text-center",children:[c.jsx($o,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),c.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",B.toFixed(2)]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Ganhos"})]})})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsx(Vt,{children:c.jsxs(Ut,{className:"pt-6 text-center",children:[c.jsx(ki,{className:"w-8 h-8 mx-auto mb-2 text-orange-500"}),c.jsxs("p",{className:"text-2xl font-bold",children:[R()," min"]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Tempo Mdio"})]})})})]}),b.length===0?c.jsxs("div",{className:"text-center py-16",children:[c.jsx(cs,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/30"}),c.jsx("h3",{className:"text-lg font-medium mb-2",children:"Nenhuma entrega encontrada"}),c.jsx("p",{className:"text-muted-foreground",children:"Suas entregas concludas aparecero aqui"})]}):c.jsx("div",{className:"space-y-3",children:b.map((G,V)=>c.jsx(gr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:V*.05},children:c.jsx(Vt,{className:"hover:border-green-500/50 transition-colors",children:c.jsxs(Ut,{className:"p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Da,{className:"w-4 h-4 text-green-500"}),c.jsxs("span",{className:"font-bold",children:["#",G.order_number]}),c.jsxs(dn,{className:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",children:["R$ ",Number(G.delivery_fee).toFixed(2)]})]}),c.jsxs(dn,{variant:"outline",children:[c.jsx(ki,{className:"w-3 h-3 mr-1"}),D(G)]})]}),c.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mb-1",children:[c.jsx(zi,{className:"w-3 h-3"}),c.jsx("span",{className:"truncate",children:G.delivery_address})]}),c.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[c.jsx(B2,{className:"w-3 h-3"}),c.jsx("span",{children:il(new Date(G.delivered_at),"dd 'de' MMMM 's' HH:mm",{locale:wf})})]})]})})},G.id))})]})})]})]})},Zrt=()=>{const e=di(),{user:t,loading:r,isDriver:n,isDriverApproved:a}=$i(),[d,p]=F.useState([]),[s,_]=F.useState(!0),[b,T]=F.useState("week"),[C,P]=F.useState([]),[k,B]=F.useState(!1),[R,D]=F.useState({totalEarnings:0,totalDeliveries:0,avgPerDelivery:0,bestDay:{date:"",amount:0},weeklyChange:0,avgRating:0,pendingBalance:0});F.useEffect(()=>{if(!r&&(!t||!n)){e("/auth");return}if(!r&&t&&n&&!a){e("/entregador");return}t&&G()},[t,r,n,e,b]);const G=async()=>{_(!0);try{const $=new Date;let K,Y=$;b==="week"?K=mv($,{weekStartsOn:0}):b==="month"?K=ott($):K=oL($,365);const{data:ee}=await dt.from("orders").select("*").eq("driver_id",t.id).eq("status","delivered").gte("delivered_at",K.toISOString()).lte("delivered_at",Y.toISOString()).order("delivered_at",{ascending:!1}),ae=ee||[];p(ae);const ie=ae.reduce((Bt,Pt)=>Bt+Number(Pt.delivery_fee),0),ge=ae.length,fe=ge>0?ie/ge:0,be={};ae.forEach(Bt=>{const Pt=il(new Date(Bt.delivered_at),"yyyy-MM-dd");be[Pt]=(be[Pt]||0)+Number(Bt.delivery_fee)});let ue={date:"",amount:0};Object.entries(be).forEach(([Bt,Pt])=>{Pt>ue.amount&&(ue={date:Bt,amount:Pt})});const Ce=mv($,{weekStartsOn:0}),ve=oL(Ce,7),ze=oL(Ce,1),{data:Me}=await dt.from("orders").select("delivery_fee").eq("driver_id",t.id).eq("status","delivered").gte("delivered_at",ve.toISOString()).lte("delivered_at",ze.toISOString()),Be=ae.filter(Bt=>new Date(Bt.delivered_at)>=Ce).reduce((Bt,Pt)=>Bt+Number(Pt.delivery_fee),0),Ve=(Me||[]).reduce((Bt,Pt)=>Bt+Number(Pt.delivery_fee),0),We=Ve>0?(Be-Ve)/Ve*100:Be>0?100:0,{data:Ee}=await dt.from("reviews").select("driver_rating").eq("driver_id",t.id).not("driver_rating","is",null),ot=Ee&&Ee.length>0?Ee.reduce((Bt,Pt)=>Bt+(Pt.driver_rating||0),0)/Ee.length:0;D({totalEarnings:ie,totalDeliveries:ge,avgPerDelivery:fe,bestDay:ue,weeklyChange:We,avgRating:ot,pendingBalance:ie});const Je=att({start:K,end:Y}).map(Bt=>{const Pt=ae.filter(pt=>ntt(new Date(pt.delivered_at),Bt));return{date:il(Bt,"yyyy-MM-dd"),dayLabel:il(Bt,b==="year"?"MMM":"EEE",{locale:wf}),earnings:Pt.reduce((pt,Gt)=>pt+Number(Gt.delivery_fee),0),deliveries:Pt.length}});if(b==="year"){const Bt={};Je.forEach(Pt=>{const pt=il(new Date(Pt.date),"yyyy-MM");Bt[pt]||(Bt[pt]={date:pt,dayLabel:il(new Date(Pt.date),"MMM",{locale:wf}),earnings:0,deliveries:0}),Bt[pt].earnings+=Pt.earnings,Bt[pt].deliveries+=Pt.deliveries}),P(Object.values(Bt))}else P(Je)}catch($){console.error("Error fetching earnings:",$)}finally{_(!1)}},V=$=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format($);return r||s?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex",children:[c.jsx(Bm,{open:k,onClose:()=>B(!1)}),c.jsxs("main",{className:"flex-1",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>B(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(bd,{className:"w-6 h-6 text-primary"}),c.jsx("h1",{className:"font-bold text-lg",children:"Meus Ganhos"})]})]}),c.jsxs(ns,{value:b,onValueChange:$=>T($),children:[c.jsx(Ji,{className:"w-36",children:c.jsx(is,{})}),c.jsxs(Qi,{children:[c.jsx(sn,{value:"week",children:"Esta Semana"}),c.jsx(sn,{value:"month",children:"Este Ms"}),c.jsx(sn,{value:"year",children:"Este Ano"})]})]})]})}),c.jsxs("div",{className:"p-4 lg:p-6 max-w-6xl mx-auto space-y-6",children:[c.jsx(gr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:c.jsxs(Vt,{className:"bg-gradient-to-br from-primary to-primary/80 text-primary-foreground overflow-hidden relative",children:[c.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),c.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"}),c.jsx(Ut,{className:"pt-6 relative",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-primary-foreground/80 text-sm mb-1",children:"Saldo Disponvel"}),c.jsx("p",{className:"text-4xl font-bold mb-2",children:V(R.pendingBalance)}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[R.weeklyChange>=0?c.jsx(Ey,{className:"w-4 h-4"}):c.jsx(g_e,{className:"w-4 h-4"}),c.jsxs("span",{children:[R.weeklyChange>=0?"+":"",R.weeklyChange.toFixed(1),"% vs semana anterior"]})]})]}),c.jsx("div",{className:"text-right",children:c.jsx(n_e,{className:"w-16 h-16 opacity-30"})})]})})]})}),c.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Total de Entregas",value:R.totalDeliveries.toString(),icon:cs,color:"text-blue-500"},{label:"Ganhos no Perodo",value:V(R.totalEarnings),icon:$o,color:"text-green-500"},{label:"Mdia por Entrega",value:V(R.avgPerDelivery),icon:Ey,color:"text-purple-500"},{label:"Avaliao Mdia",value:R.avgRating>0?R.avgRating.toFixed(1):"",icon:Mc,color:"text-yellow-500"}].map(($,K)=>c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:K*.1},children:c.jsx(Vt,{children:c.jsx(Ut,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:$.label}),c.jsx("p",{className:"text-xl font-bold",children:$.value})]}),c.jsx($.icon,{className:`w-8 h-8 ${$.color}`})]})})})},$.label))}),R.bestDay.date&&c.jsx(gr.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:c.jsx(Vt,{className:"bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border-yellow-500/30",children:c.jsx(Ut,{className:"py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"bg-yellow-500/20 p-2 rounded-full",children:c.jsx(Mc,{className:"w-5 h-5 text-yellow-500"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Melhor dia"}),c.jsx("p",{className:"font-medium",children:il(new Date(R.bestDay.date),"dd 'de' MMMM",{locale:wf})})]})]}),c.jsx("p",{className:"text-xl font-bold text-yellow-600",children:V(R.bestDay.amount)})]})})})}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(Ey,{className:"w-5 h-5"}),"Evoluo dos Ganhos"]})}),c.jsx(Ut,{children:C.length>0?c.jsx("div",{className:"h-64",children:c.jsx(AS,{width:"100%",height:"100%",children:c.jsxs(Fet,{data:C,children:[c.jsx("defs",{children:c.jsxs("linearGradient",{id:"colorEarnings",x1:"0",y1:"0",x2:"0",y2:"1",children:[c.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),c.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),c.jsx(QN,{strokeDasharray:"3 3",className:"stroke-muted"}),c.jsx(Lm,{dataKey:"dayLabel",tick:{fontSize:12},tickLine:!1,className:"text-muted-foreground"}),c.jsx(Fm,{tick:{fontSize:12},tickLine:!1,tickFormatter:$=>`R$${$}`,className:"text-muted-foreground"}),c.jsx(nc,{content:({active:$,payload:K})=>{if($&&K&&K.length){const Y=K[0].payload;return c.jsxs("div",{className:"bg-popover border rounded-lg p-3 shadow-lg",children:[c.jsx("p",{className:"font-medium",children:Y.dayLabel}),c.jsx("p",{className:"text-green-600 font-bold",children:V(Y.earnings)}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[Y.deliveries," entrega",Y.deliveries!==1?"s":""]})]})}return null}}),c.jsx(ig,{type:"monotone",dataKey:"earnings",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#colorEarnings)"})]})})}):c.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:c.jsxs("div",{className:"text-center",children:[c.jsx(Ey,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),c.jsx("p",{children:"Sem dados para exibir"})]})})})]}),c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(cs,{className:"w-5 h-5"}),"Entregas Recentes"]}),c.jsx(Ft,{variant:"ghost",size:"sm",onClick:()=>e("/entregador/historico"),children:"Ver Todas"})]})}),c.jsx(Ut,{children:d.length===0?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(cs,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),c.jsx("p",{children:"Nenhuma entrega no perodo"})]}):c.jsx("div",{className:"space-y-3",children:d.slice(0,5).map(($,K)=>{const Y=$.out_for_delivery_at&&$.delivered_at?Math.round((new Date($.delivered_at).getTime()-new Date($.out_for_delivery_at).getTime())/6e4):null;return c.jsxs(gr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:K*.05},className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/30 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"bg-green-500/10 p-2 rounded-full",children:c.jsx(cs,{className:"w-4 h-4 text-green-500"})}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs(dn,{variant:"outline",className:"text-xs",children:["#",$.order_number]}),Y&&c.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[c.jsx(ki,{className:"w-3 h-3"}),Y," min"]})]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:il(new Date($.delivered_at),"dd/MM 's' HH:mm",{locale:wf})})]})]}),c.jsxs("span",{className:"font-bold text-green-600",children:["+",V(Number($.delivery_fee))]})]},$.id)})})})]})]})]})]})},Xrt=()=>{const e=di(),{user:t,isDriver:r,loading:n,signOut:a,isDriverApproved:d}=$i(),[p,s]=F.useState(!0),[_,b]=F.useState(!1),[T,C]=F.useState(!1),[P,k]=F.useState({full_name:"",phone:""}),[B,R]=F.useState({newOrders:!0,sound:!0});F.useEffect(()=>{if(!n&&(!t||!r)){e("/entregador/auth");return}if(!n&&t&&r&&!d){e("/entregador");return}t&&D()},[t,n,r,e]);const D=async()=>{try{const{data:$,error:K}=await dt.from("profiles").select("full_name, phone").eq("user_id",t.id).maybeSingle();if(K&&K.code!=="PGRST116")throw K;$&&k({full_name:$.full_name||"",phone:$.phone||""})}catch{gt.error("Erro ao carregar perfil")}finally{s(!1)}},G=async()=>{b(!0);try{const{error:$}=await dt.from("profiles").upsert({user_id:t.id,full_name:P.full_name,phone:P.phone,updated_at:new Date().toISOString()},{onConflict:"user_id"});if($)throw $;gt.success("Perfil salvo com sucesso!")}catch{gt.error("Erro ao salvar perfil")}finally{b(!1)}},V=async()=>{await a(),e("/entregador/auth")};return n||p?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-green-500"})}):c.jsxs("div",{className:"min-h-screen bg-background flex w-full",children:[c.jsx(Bm,{open:T,onClose:()=>C(!1)}),c.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[c.jsx("header",{className:"sticky top-0 z-30 bg-background/95 backdrop-blur border-b px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>C(!0),className:"p-2 hover:bg-muted rounded-lg lg:hidden",children:c.jsx(Ri,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(V2,{className:"w-5 h-5 text-green-600"}),c.jsx("h1",{className:"font-bold text-lg",children:"Configuraes"})]})]})})}),c.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:c.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(to,{className:"w-5 h-5 text-green-600"}),"Perfil do Entregador"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsx("div",{className:"flex justify-center mb-6",children:c.jsx("div",{className:"w-24 h-24 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:c.jsx(Bc,{className:"w-12 h-12 text-green-600"})})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"name",children:"Nome Completo"}),c.jsxs("div",{className:"relative",children:[c.jsx(to,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"name",value:P.full_name,onChange:$=>k({...P,full_name:$.target.value}),className:"pl-10",placeholder:"Seu nome"})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"phone",children:"Telefone"}),c.jsxs("div",{className:"relative",children:[c.jsx($c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"phone",value:P.phone,onChange:$=>k({...P,phone:$.target.value}),className:"pl-10",placeholder:"(00) 00000-0000"})]})]}),c.jsxs("div",{children:[c.jsx(zt,{htmlFor:"email",children:"E-mail"}),c.jsxs("div",{className:"relative",children:[c.jsx(fb,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),c.jsx(ar,{id:"email",value:(t==null?void 0:t.email)||"",disabled:!0,className:"pl-10 bg-muted"})]})]}),c.jsxs(Ft,{onClick:G,disabled:_,className:"w-full bg-green-500 hover:bg-green-600",children:[c.jsx(E0,{className:"w-4 h-4 mr-2"}),_?"Salvando...":"Salvar Alteraes"]})]})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(z2,{className:"w-5 h-5 text-green-600"}),"Notificaes"]})}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Novos Pedidos"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Receber notificaes de novos pedidos"})]}),c.jsx(Bs,{checked:B.newOrders,onCheckedChange:$=>R({...B,newOrders:$}),className:"data-[state=checked]:bg-green-500"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Som"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Reproduzir som ao receber notificaes"})]}),c.jsx(Bs,{checked:B.sound,onCheckedChange:$=>R({...B,sound:$}),className:"data-[state=checked]:bg-green-500"})]})]})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsxs(Vt,{children:[c.jsx(Wr,{children:c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(rv,{className:"w-5 h-5 text-green-600"}),"Segurana"]})}),c.jsx(Ut,{children:c.jsx(Ft,{variant:"destructive",className:"w-full",onClick:V,children:"Sair da Conta"})})]})})]})})]})]})},Krt=e=>ote({queryKey:["order-review",e],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await dt.from("reviews").select("*").eq("order_id",e).maybeSingle();if(r)throw r;return t},enabled:!!e}),Yrt={pending:{title:"Pedido Recebido",body:"Seu pedido foi recebido e est aguardando confirmao.",icon:""},confirmed:{title:"Pedido Confirmado! ",body:"timo! O estabelecimento confirmou seu pedido.",icon:""},preparing:{title:"Em Preparo! ",body:"Seu pedido est sendo preparado com carinho.",icon:""},ready:{title:"Pedido Pronto! ",body:"Seu pedido est pronto e aguardando o entregador.",icon:""},out_for_delivery:{title:"Saiu para Entrega! ",body:"Seu pedido est a caminho! Acompanhe no mapa.",icon:""},delivered:{title:"Entregue! ",body:"Seu pedido foi entregue. Bom apetite!",icon:""},cancelled:{title:"Pedido Cancelado",body:"Infelizmente seu pedido foi cancelado.",icon:""}},Jrt=({orderId:e,onStatusChange:t})=>{const r=F.useRef(null),n=F.useRef(!1),a=F.useCallback(()=>{try{const _=new(window.AudioContext||window.webkitAudioContext),b=_.createOscillator(),T=_.createGain();b.connect(T),T.connect(_.destination),b.frequency.value=587.33,b.type="sine",T.gain.setValueAtTime(.3,_.currentTime),T.gain.exponentialRampToValueAtTime(.01,_.currentTime+.3),b.start(_.currentTime),b.stop(_.currentTime+.3),setTimeout(()=>{const C=_.createOscillator(),P=_.createGain();C.connect(P),P.connect(_.destination),C.frequency.value=880,C.type="sine",P.gain.setValueAtTime(.3,_.currentTime),P.gain.exponentialRampToValueAtTime(.01,_.currentTime+.4),C.start(_.currentTime),C.stop(_.currentTime+.4)},150)}catch{console.log("Audio notification not supported")}},[]),d=F.useCallback((_,b=!1)=>{const T=Yrt[_.status];if(!T)return;if(b){r.current=_.status;return}a(),(_.status==="cancelled"?gt.error:gt.success)(c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-lg",children:T.icon})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold text-base",children:T.title}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",_.order_number]})]})]}),{duration:8e3,position:"top-center",className:"border-2 border-primary bg-card shadow-lg"}),"Notification"in window&&Notification.permission==="granted"&&new Notification(T.title,{body:`${T.body}
Pedido #${_.order_number}`,icon:"/favicon.ico",tag:`order-${_.id}-${_.status}`,requireInteraction:_.status==="out_for_delivery"})},[a]),p=F.useCallback(async()=>{"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()==="granted"&&gt.success("Notificaes ativadas! Voc ser avisado sobre atualizaes do pedido.")},[]);F.useEffect(()=>{if(!e)return;p();const _=dt.channel(`customer-order-${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`id=eq.${e}`},b=>{const T=b.new;b.old.status!==T.status&&(d(T,!1),t==null||t(T,r.current),r.current=T.status)}).subscribe();return()=>{dt.removeChannel(_)}},[e,d,t,p]);const s=F.useCallback(_=>{n.current||(r.current=_,n.current=!0)},[]);return{requestNotificationPermission:p,playNotificationSound:a,initializeStatus:s}};var yE=e=>e.type==="checkbox",Ry=e=>e instanceof Date,Ol=e=>e==null;const Nue=e=>typeof e=="object";var wa=e=>!Ol(e)&&!Array.isArray(e)&&Nue(e)&&!Ry(e),Iue=e=>wa(e)&&e.target?yE(e.target)?e.target.checked:e.target.value:e,Qrt=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,kue=(e,t)=>e.has(Qrt(t)),ent=e=>{const t=e.constructor&&e.constructor.prototype;return wa(t)&&t.hasOwnProperty("isPrototypeOf")},U$=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ka(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(U$&&(e instanceof Blob||n))&&(r||wa(e)))if(t=r?[]:{},!r&&!ent(e))t=e;else for(const a in e)e.hasOwnProperty(a)&&(t[a]=Ka(e[a]));else return e;return t}var oO=e=>/^\w*$/.test(e),_a=e=>e===void 0,q$=e=>Array.isArray(e)?e.filter(Boolean):[],G$=e=>q$(e.replace(/["|']|\]/g,"").split(/\.|\[/)),zr=(e,t,r)=>{if(!t||!wa(e))return r;const n=(oO(t)?[t]:G$(t)).reduce((a,d)=>Ol(a)?a:a[d],e);return _a(n)||n===e?_a(e[t])?r:e[t]:n},Ac=e=>typeof e=="boolean",os=(e,t,r)=>{let n=-1;const a=oO(t)?[t]:G$(t),d=a.length,p=d-1;for(;++n<d;){const s=a[n];let _=r;if(n!==p){const b=e[s];_=wa(b)||Array.isArray(b)?b:isNaN(+a[n+1])?{}:[]}if(s==="__proto__"||s==="constructor"||s==="prototype")return;e[s]=_,e=e[s]}};const oI={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},dd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},W$=De.createContext(null);W$.displayName="HookFormContext";const lO=()=>De.useContext(W$),tnt=e=>{const{children:t,...r}=e;return De.createElement(W$.Provider,{value:r},t)};var Oue=(e,t,r,n=!0)=>{const a={defaultValues:t._defaultValues};for(const d in e)Object.defineProperty(a,d,{get:()=>{const p=d;return t._proxyFormState[p]!==dd.all&&(t._proxyFormState[p]=!n||dd.all),r&&(r[p]=!0),e[p]}});return a};const H$=typeof window<"u"?De.useLayoutEffect:De.useEffect;function rnt(e){const t=lO(),{control:r=t.control,disabled:n,name:a,exact:d}=e||{},[p,s]=De.useState(r._formState),_=De.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return H$(()=>r._subscribe({name:a,formState:_.current,exact:d,callback:b=>{!n&&s({...r._formState,...b})}}),[a,n,d]),De.useEffect(()=>{_.current.isValid&&r._setValid(!0)},[r]),De.useMemo(()=>Oue(p,r,_.current,!1),[p,r])}var yh=e=>typeof e=="string",Rue=(e,t,r,n,a)=>yh(e)?(n&&t.watch.add(e),zr(r,e,a)):Array.isArray(e)?e.map(d=>(n&&t.watch.add(d),zr(r,d))):(n&&(t.watchAll=!0),r),Kz=e=>Ol(e)||!Nue(e);function gf(e,t,r=new WeakSet){if(Kz(e)||Kz(t))return e===t;if(Ry(e)&&Ry(t))return e.getTime()===t.getTime();const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const d of n){const p=e[d];if(!a.includes(d))return!1;if(d!=="ref"){const s=t[d];if(Ry(p)&&Ry(s)||wa(p)&&wa(s)||Array.isArray(p)&&Array.isArray(s)?!gf(p,s,r):p!==s)return!1}}return!0}function nnt(e){const t=lO(),{control:r=t.control,name:n,defaultValue:a,disabled:d,exact:p,compute:s}=e||{},_=De.useRef(a),b=De.useRef(s),T=De.useRef(void 0);b.current=s;const C=De.useMemo(()=>r._getWatch(n,_.current),[r,n]),[P,k]=De.useState(b.current?b.current(C):C);return H$(()=>r._subscribe({name:n,formState:{values:!0},exact:p,callback:B=>{if(!d){const R=Rue(n,r._names,B.values||r._formValues,!1,_.current);if(b.current){const D=b.current(R);gf(D,T.current)||(k(D),T.current=D)}else k(R)}}}),[r,d,n,p]),De.useEffect(()=>r._removeUnmounted()),P}function int(e){const t=lO(),{name:r,disabled:n,control:a=t.control,shouldUnregister:d,defaultValue:p}=e,s=kue(a._names.array,r),_=De.useMemo(()=>zr(a._formValues,r,zr(a._defaultValues,r,p)),[a,r,p]),b=nnt({control:a,name:r,defaultValue:_,exact:!0}),T=rnt({control:a,name:r,exact:!0}),C=De.useRef(e),P=De.useRef(a.register(r,{...e.rules,value:b,...Ac(e.disabled)?{disabled:e.disabled}:{}}));C.current=e;const k=De.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!zr(T.errors,r)},isDirty:{enumerable:!0,get:()=>!!zr(T.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!zr(T.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!zr(T.validatingFields,r)},error:{enumerable:!0,get:()=>zr(T.errors,r)}}),[T,r]),B=De.useCallback(V=>P.current.onChange({target:{value:Iue(V),name:r},type:oI.CHANGE}),[r]),R=De.useCallback(()=>P.current.onBlur({target:{value:zr(a._formValues,r),name:r},type:oI.BLUR}),[r,a._formValues]),D=De.useCallback(V=>{const $=zr(a._fields,r);$&&V&&($._f.ref={focus:()=>V.focus&&V.focus(),select:()=>V.select&&V.select(),setCustomValidity:K=>V.setCustomValidity(K),reportValidity:()=>V.reportValidity()})},[a._fields,r]),G=De.useMemo(()=>({name:r,value:b,...Ac(n)||T.disabled?{disabled:T.disabled||n}:{},onChange:B,onBlur:R,ref:D}),[r,n,T.disabled,B,R,D,b]);return De.useEffect(()=>{const V=a._options.shouldUnregister||d;a.register(r,{...C.current.rules,...Ac(C.current.disabled)?{disabled:C.current.disabled}:{}});const $=(K,Y)=>{const ee=zr(a._fields,K);ee&&ee._f&&(ee._f.mount=Y)};if($(r,!0),V){const K=Ka(zr(a._options.defaultValues,r));os(a._defaultValues,r,K),_a(zr(a._formValues,r))&&os(a._formValues,r,K)}return!s&&a.register(r),()=>{(s?V&&!a._state.action:V)?a.unregister(r):$(r,!1)}},[r,a,s,d]),De.useEffect(()=>{a._setDisabledField({disabled:n,name:r})},[n,r,a]),De.useMemo(()=>({field:G,formState:T,fieldState:k}),[G,T,k])}const snt=e=>e.render(int(e));var Mue=(e,t,r,n,a)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:a||!0}}:{},iT=e=>Array.isArray(e)?e:[e],CK=()=>{let e=[];return{get observers(){return e},next:a=>{for(const d of e)d.next&&d.next(a)},subscribe:a=>(e.push(a),{unsubscribe:()=>{e=e.filter(d=>d!==a)}}),unsubscribe:()=>{e=[]}}},ec=e=>wa(e)&&!Object.keys(e).length,Z$=e=>e.type==="file",hd=e=>typeof e=="function",lI=e=>{if(!U$)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Due=e=>e.type==="select-multiple",X$=e=>e.type==="radio",ant=e=>X$(e)||yE(e),lL=e=>lI(e)&&e.isConnected;function ont(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=_a(e)?n++:e[t[n++]];return e}function lnt(e){for(const t in e)if(e.hasOwnProperty(t)&&!_a(e[t]))return!1;return!0}function Pa(e,t){const r=Array.isArray(t)?t:oO(t)?[t]:G$(t),n=r.length===1?e:ont(e,r),a=r.length-1,d=r[a];return n&&delete n[d],a!==0&&(wa(n)&&ec(n)||Array.isArray(n)&&lnt(n))&&Pa(e,r.slice(0,-1)),e}var Lue=e=>{for(const t in e)if(hd(e[t]))return!0;return!1};function cI(e,t={}){const r=Array.isArray(e);if(wa(e)||r)for(const n in e)Array.isArray(e[n])||wa(e[n])&&!Lue(e[n])?(t[n]=Array.isArray(e[n])?[]:{},cI(e[n],t[n])):Ol(e[n])||(t[n]=!0);return t}function Fue(e,t,r){const n=Array.isArray(e);if(wa(e)||n)for(const a in e)Array.isArray(e[a])||wa(e[a])&&!Lue(e[a])?_a(t)||Kz(r[a])?r[a]=Array.isArray(e[a])?cI(e[a],[]):{...cI(e[a])}:Fue(e[a],Ol(t)?{}:t[a],r[a]):r[a]=!gf(e[a],t[a]);return r}var pS=(e,t)=>Fue(e,t,cI(t));const PK={value:!1,isValid:!1},NK={value:!0,isValid:!0};var zue=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!_a(e[0].attributes.value)?_a(e[0].value)||e[0].value===""?NK:{value:e[0].value,isValid:!0}:NK:PK}return PK},Bue=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>_a(e)?e:t?e===""?NaN:e&&+e:r&&yh(e)?new Date(e):n?n(e):e;const IK={isValid:!1,value:null};var $ue=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,IK):IK;function kK(e){const t=e.ref;return Z$(t)?t.files:X$(t)?$ue(e.refs).value:Due(t)?[...t.selectedOptions].map(({value:r})=>r):yE(t)?zue(e.refs).value:Bue(_a(t.value)?e.ref.value:t.value,e)}var cnt=(e,t,r,n)=>{const a={};for(const d of e){const p=zr(t,d);p&&os(a,d,p._f)}return{criteriaMode:r,names:[...e],fields:a,shouldUseNativeValidation:n}},uI=e=>e instanceof RegExp,mS=e=>_a(e)?e:uI(e)?e.source:wa(e)?uI(e.value)?e.value.source:e.value:e,OK=e=>({isOnSubmit:!e||e===dd.onSubmit,isOnBlur:e===dd.onBlur,isOnChange:e===dd.onChange,isOnAll:e===dd.all,isOnTouch:e===dd.onTouched});const RK="AsyncFunction";var unt=e=>!!e&&!!e.validate&&!!(hd(e.validate)&&e.validate.constructor.name===RK||wa(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===RK)),dnt=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),MK=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const sT=(e,t,r,n)=>{for(const a of r||Object.keys(e)){const d=zr(e,a);if(d){const{_f:p,...s}=d;if(p){if(p.refs&&p.refs[0]&&t(p.refs[0],a)&&!n)return!0;if(p.ref&&t(p.ref,p.name)&&!n)return!0;if(sT(s,t))break}else if(wa(s)&&sT(s,t))break}}};function DK(e,t,r){const n=zr(e,r);if(n||oO(r))return{error:n,name:r};const a=r.split(".");for(;a.length;){const d=a.join("."),p=zr(t,d),s=zr(e,d);if(p&&!Array.isArray(p)&&r!==d)return{name:r};if(s&&s.type)return{name:d,error:s};if(s&&s.root&&s.root.type)return{name:`${d}.root`,error:s.root};a.pop()}return{name:r}}var hnt=(e,t,r,n)=>{r(e);const{name:a,...d}=e;return ec(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(p=>t[p]===(!n||dd.all))},fnt=(e,t,r)=>!e||!t||e===t||iT(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),pnt=(e,t,r,n,a)=>a.isOnAll?!1:!r&&a.isOnTouch?!(t||e):(r?n.isOnBlur:a.isOnBlur)?!e:(r?n.isOnChange:a.isOnChange)?e:!0,mnt=(e,t)=>!q$(zr(e,t)).length&&Pa(e,t),gnt=(e,t,r)=>{const n=iT(zr(e,r));return os(n,"root",t[r]),os(e,r,n),e},oP=e=>yh(e);function LK(e,t,r="validate"){if(oP(e)||Array.isArray(e)&&e.every(oP)||Ac(e)&&!e)return{type:r,message:oP(e)?e:"",ref:t}}var fx=e=>wa(e)&&!uI(e)?e:{value:e,message:""},FK=async(e,t,r,n,a,d)=>{const{ref:p,refs:s,required:_,maxLength:b,minLength:T,min:C,max:P,pattern:k,validate:B,name:R,valueAsNumber:D,mount:G}=e._f,V=zr(r,R);if(!G||t.has(R))return{};const $=s?s[0]:p,K=ue=>{a&&$.reportValidity&&($.setCustomValidity(Ac(ue)?"":ue||""),$.reportValidity())},Y={},ee=X$(p),ae=yE(p),ie=ee||ae,ge=(D||Z$(p))&&_a(p.value)&&_a(V)||lI(p)&&p.value===""||V===""||Array.isArray(V)&&!V.length,fe=Mue.bind(null,R,n,Y),be=(ue,Ce,ve,ze=cf.maxLength,Me=cf.minLength)=>{const Be=ue?Ce:ve;Y[R]={type:ue?ze:Me,message:Be,ref:p,...fe(ue?ze:Me,Be)}};if(d?!Array.isArray(V)||!V.length:_&&(!ie&&(ge||Ol(V))||Ac(V)&&!V||ae&&!zue(s).isValid||ee&&!$ue(s).isValid)){const{value:ue,message:Ce}=oP(_)?{value:!!_,message:_}:fx(_);if(ue&&(Y[R]={type:cf.required,message:Ce,ref:$,...fe(cf.required,Ce)},!n))return K(Ce),Y}if(!ge&&(!Ol(C)||!Ol(P))){let ue,Ce;const ve=fx(P),ze=fx(C);if(!Ol(V)&&!isNaN(V)){const Me=p.valueAsNumber||V&&+V;Ol(ve.value)||(ue=Me>ve.value),Ol(ze.value)||(Ce=Me<ze.value)}else{const Me=p.valueAsDate||new Date(V),Be=Ee=>new Date(new Date().toDateString()+" "+Ee),Ve=p.type=="time",We=p.type=="week";yh(ve.value)&&V&&(ue=Ve?Be(V)>Be(ve.value):We?V>ve.value:Me>new Date(ve.value)),yh(ze.value)&&V&&(Ce=Ve?Be(V)<Be(ze.value):We?V<ze.value:Me<new Date(ze.value))}if((ue||Ce)&&(be(!!ue,ve.message,ze.message,cf.max,cf.min),!n))return K(Y[R].message),Y}if((b||T)&&!ge&&(yh(V)||d&&Array.isArray(V))){const ue=fx(b),Ce=fx(T),ve=!Ol(ue.value)&&V.length>+ue.value,ze=!Ol(Ce.value)&&V.length<+Ce.value;if((ve||ze)&&(be(ve,ue.message,Ce.message),!n))return K(Y[R].message),Y}if(k&&!ge&&yh(V)){const{value:ue,message:Ce}=fx(k);if(uI(ue)&&!V.match(ue)&&(Y[R]={type:cf.pattern,message:Ce,ref:p,...fe(cf.pattern,Ce)},!n))return K(Ce),Y}if(B){if(hd(B)){const ue=await B(V,r),Ce=LK(ue,$);if(Ce&&(Y[R]={...Ce,...fe(cf.validate,Ce.message)},!n))return K(Ce.message),Y}else if(wa(B)){let ue={};for(const Ce in B){if(!ec(ue)&&!n)break;const ve=LK(await B[Ce](V,r),$,Ce);ve&&(ue={...ve,...fe(Ce,ve.message)},K(ve.message),n&&(Y[R]=ue))}if(!ec(ue)&&(Y[R]={ref:$,...ue},!n))return Y}}return K(!0),Y};const ynt={mode:dd.onSubmit,reValidateMode:dd.onChange,shouldFocusError:!0};function vnt(e={}){let t={...ynt,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:hd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},a=wa(t.defaultValues)||wa(t.values)?Ka(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Ka(a),p={action:!1,mount:!1,watch:!1},s={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},_,b=0;const T={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let C={...T};const P={array:CK(),state:CK()},k=t.criteriaMode===dd.all,B=lt=>Ct=>{clearTimeout(b),b=setTimeout(lt,Ct)},R=async lt=>{if(!t.disabled&&(T.isValid||C.isValid||lt)){const Ct=t.resolver?ec((await ae()).errors):await ge(n,!0);Ct!==r.isValid&&P.state.next({isValid:Ct})}},D=(lt,Ct)=>{!t.disabled&&(T.isValidating||T.validatingFields||C.isValidating||C.validatingFields)&&((lt||Array.from(s.mount)).forEach(Xt=>{Xt&&(Ct?os(r.validatingFields,Xt,Ct):Pa(r.validatingFields,Xt))}),P.state.next({validatingFields:r.validatingFields,isValidating:!ec(r.validatingFields)}))},G=(lt,Ct=[],Xt,Sr,yr=!0,hr=!0)=>{if(Sr&&Xt&&!t.disabled){if(p.action=!0,hr&&Array.isArray(zr(n,lt))){const Or=Xt(zr(n,lt),Sr.argA,Sr.argB);yr&&os(n,lt,Or)}if(hr&&Array.isArray(zr(r.errors,lt))){const Or=Xt(zr(r.errors,lt),Sr.argA,Sr.argB);yr&&os(r.errors,lt,Or),mnt(r.errors,lt)}if((T.touchedFields||C.touchedFields)&&hr&&Array.isArray(zr(r.touchedFields,lt))){const Or=Xt(zr(r.touchedFields,lt),Sr.argA,Sr.argB);yr&&os(r.touchedFields,lt,Or)}(T.dirtyFields||C.dirtyFields)&&(r.dirtyFields=pS(a,d)),P.state.next({name:lt,isDirty:be(lt,Ct),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else os(d,lt,Ct)},V=(lt,Ct)=>{os(r.errors,lt,Ct),P.state.next({errors:r.errors})},$=lt=>{r.errors=lt,P.state.next({errors:r.errors,isValid:!1})},K=(lt,Ct,Xt,Sr)=>{const yr=zr(n,lt);if(yr){const hr=zr(d,lt,_a(Xt)?zr(a,lt):Xt);_a(hr)||Sr&&Sr.defaultChecked||Ct?os(d,lt,Ct?hr:kK(yr._f)):ve(lt,hr),p.mount&&R()}},Y=(lt,Ct,Xt,Sr,yr)=>{let hr=!1,Or=!1;const Mn={name:lt};if(!t.disabled){if(!Xt||Sr){(T.isDirty||C.isDirty)&&(Or=r.isDirty,r.isDirty=Mn.isDirty=be(),hr=Or!==Mn.isDirty);const oi=gf(zr(a,lt),Ct);Or=!!zr(r.dirtyFields,lt),oi?Pa(r.dirtyFields,lt):os(r.dirtyFields,lt,!0),Mn.dirtyFields=r.dirtyFields,hr=hr||(T.dirtyFields||C.dirtyFields)&&Or!==!oi}if(Xt){const oi=zr(r.touchedFields,lt);oi||(os(r.touchedFields,lt,Xt),Mn.touchedFields=r.touchedFields,hr=hr||(T.touchedFields||C.touchedFields)&&oi!==Xt)}hr&&yr&&P.state.next(Mn)}return hr?Mn:{}},ee=(lt,Ct,Xt,Sr)=>{const yr=zr(r.errors,lt),hr=(T.isValid||C.isValid)&&Ac(Ct)&&r.isValid!==Ct;if(t.delayError&&Xt?(_=B(()=>V(lt,Xt)),_(t.delayError)):(clearTimeout(b),_=null,Xt?os(r.errors,lt,Xt):Pa(r.errors,lt)),(Xt?!gf(yr,Xt):yr)||!ec(Sr)||hr){const Or={...Sr,...hr&&Ac(Ct)?{isValid:Ct}:{},errors:r.errors,name:lt};r={...r,...Or},P.state.next(Or)}},ae=async lt=>{D(lt,!0);const Ct=await t.resolver(d,t.context,cnt(lt||s.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return D(lt),Ct},ie=async lt=>{const{errors:Ct}=await ae(lt);if(lt)for(const Xt of lt){const Sr=zr(Ct,Xt);Sr?os(r.errors,Xt,Sr):Pa(r.errors,Xt)}else r.errors=Ct;return Ct},ge=async(lt,Ct,Xt={valid:!0})=>{for(const Sr in lt){const yr=lt[Sr];if(yr){const{_f:hr,...Or}=yr;if(hr){const Mn=s.array.has(hr.name),oi=yr._f&&unt(yr._f);oi&&T.validatingFields&&D([Sr],!0);const $s=await FK(yr,s.disabled,d,k,t.shouldUseNativeValidation&&!Ct,Mn);if(oi&&T.validatingFields&&D([Sr]),$s[hr.name]&&(Xt.valid=!1,Ct))break;!Ct&&(zr($s,hr.name)?Mn?gnt(r.errors,$s,hr.name):os(r.errors,hr.name,$s[hr.name]):Pa(r.errors,hr.name))}!ec(Or)&&await ge(Or,Ct,Xt)}}return Xt.valid},fe=()=>{for(const lt of s.unMount){const Ct=zr(n,lt);Ct&&(Ct._f.refs?Ct._f.refs.every(Xt=>!lL(Xt)):!lL(Ct._f.ref))&&Gt(lt)}s.unMount=new Set},be=(lt,Ct)=>!t.disabled&&(lt&&Ct&&os(d,lt,Ct),!gf(Ee(),a)),ue=(lt,Ct,Xt)=>Rue(lt,s,{...p.mount?d:_a(Ct)?a:yh(lt)?{[lt]:Ct}:Ct},Xt,Ct),Ce=lt=>q$(zr(p.mount?d:a,lt,t.shouldUnregister?zr(a,lt,[]):[])),ve=(lt,Ct,Xt={})=>{const Sr=zr(n,lt);let yr=Ct;if(Sr){const hr=Sr._f;hr&&(!hr.disabled&&os(d,lt,Bue(Ct,hr)),yr=lI(hr.ref)&&Ol(Ct)?"":Ct,Due(hr.ref)?[...hr.ref.options].forEach(Or=>Or.selected=yr.includes(Or.value)):hr.refs?yE(hr.ref)?hr.refs.forEach(Or=>{(!Or.defaultChecked||!Or.disabled)&&(Array.isArray(yr)?Or.checked=!!yr.find(Mn=>Mn===Or.value):Or.checked=yr===Or.value||!!yr)}):hr.refs.forEach(Or=>Or.checked=Or.value===yr):Z$(hr.ref)?hr.ref.value="":(hr.ref.value=yr,hr.ref.type||P.state.next({name:lt,values:Ka(d)})))}(Xt.shouldDirty||Xt.shouldTouch)&&Y(lt,yr,Xt.shouldTouch,Xt.shouldDirty,!0),Xt.shouldValidate&&We(lt)},ze=(lt,Ct,Xt)=>{for(const Sr in Ct){if(!Ct.hasOwnProperty(Sr))return;const yr=Ct[Sr],hr=lt+"."+Sr,Or=zr(n,hr);(s.array.has(lt)||wa(yr)||Or&&!Or._f)&&!Ry(yr)?ze(hr,yr,Xt):ve(hr,yr,Xt)}},Me=(lt,Ct,Xt={})=>{const Sr=zr(n,lt),yr=s.array.has(lt),hr=Ka(Ct);os(d,lt,hr),yr?(P.array.next({name:lt,values:Ka(d)}),(T.isDirty||T.dirtyFields||C.isDirty||C.dirtyFields)&&Xt.shouldDirty&&P.state.next({name:lt,dirtyFields:pS(a,d),isDirty:be(lt,hr)})):Sr&&!Sr._f&&!Ol(hr)?ze(lt,hr,Xt):ve(lt,hr,Xt),MK(lt,s)&&P.state.next({...r,name:lt}),P.state.next({name:p.mount?lt:void 0,values:Ka(d)})},Be=async lt=>{p.mount=!0;const Ct=lt.target;let Xt=Ct.name,Sr=!0;const yr=zr(n,Xt),hr=oi=>{Sr=Number.isNaN(oi)||Ry(oi)&&isNaN(oi.getTime())||gf(oi,zr(d,Xt,oi))},Or=OK(t.mode),Mn=OK(t.reValidateMode);if(yr){let oi,$s;const fs=Ct.type?kK(yr._f):Iue(lt),za=lt.type===oI.BLUR||lt.type===oI.FOCUS_OUT,Ta=!dnt(yr._f)&&!t.resolver&&!zr(r.errors,Xt)&&!yr._f.deps||pnt(za,zr(r.touchedFields,Xt),r.isSubmitted,Mn,Or),fl=MK(Xt,s,za);os(d,Xt,fs),za?(yr._f.onBlur&&yr._f.onBlur(lt),_&&_(0)):yr._f.onChange&&yr._f.onChange(lt);const na=Y(Xt,fs,za),js=!ec(na)||fl;if(!za&&P.state.next({name:Xt,type:lt.type,values:Ka(d)}),Ta)return(T.isValid||C.isValid)&&(t.mode==="onBlur"?za&&R():za||R()),js&&P.state.next({name:Xt,...fl?{}:na});if(!za&&fl&&P.state.next({...r}),t.resolver){const{errors:ga}=await ae([Xt]);if(hr(fs),Sr){const pl=DK(r.errors,n,Xt),ml=DK(ga,n,pl.name||Xt);oi=ml.error,Xt=ml.name,$s=ec(ga)}}else D([Xt],!0),oi=(await FK(yr,s.disabled,d,k,t.shouldUseNativeValidation))[Xt],D([Xt]),hr(fs),Sr&&(oi?$s=!1:(T.isValid||C.isValid)&&($s=await ge(n,!0)));Sr&&(yr._f.deps&&We(yr._f.deps),ee(Xt,$s,oi,na))}},Ve=(lt,Ct)=>{if(zr(r.errors,Ct)&&lt.focus)return lt.focus(),1},We=async(lt,Ct={})=>{let Xt,Sr;const yr=iT(lt);if(t.resolver){const hr=await ie(_a(lt)?lt:yr);Xt=ec(hr),Sr=lt?!yr.some(Or=>zr(hr,Or)):Xt}else lt?(Sr=(await Promise.all(yr.map(async hr=>{const Or=zr(n,hr);return await ge(Or&&Or._f?{[hr]:Or}:Or)}))).every(Boolean),!(!Sr&&!r.isValid)&&R()):Sr=Xt=await ge(n);return P.state.next({...!yh(lt)||(T.isValid||C.isValid)&&Xt!==r.isValid?{}:{name:lt},...t.resolver||!lt?{isValid:Xt}:{},errors:r.errors}),Ct.shouldFocus&&!Sr&&sT(n,Ve,lt?yr:s.mount),Sr},Ee=lt=>{const Ct={...p.mount?d:a};return _a(lt)?Ct:yh(lt)?zr(Ct,lt):lt.map(Xt=>zr(Ct,Xt))},ot=(lt,Ct)=>({invalid:!!zr((Ct||r).errors,lt),isDirty:!!zr((Ct||r).dirtyFields,lt),error:zr((Ct||r).errors,lt),isValidating:!!zr(r.validatingFields,lt),isTouched:!!zr((Ct||r).touchedFields,lt)}),yt=lt=>{lt&&iT(lt).forEach(Ct=>Pa(r.errors,Ct)),P.state.next({errors:lt?r.errors:{}})},Je=(lt,Ct,Xt)=>{const Sr=(zr(n,lt,{_f:{}})._f||{}).ref,yr=zr(r.errors,lt)||{},{ref:hr,message:Or,type:Mn,...oi}=yr;os(r.errors,lt,{...oi,...Ct,ref:Sr}),P.state.next({name:lt,errors:r.errors,isValid:!1}),Xt&&Xt.shouldFocus&&Sr&&Sr.focus&&Sr.focus()},Bt=(lt,Ct)=>hd(lt)?P.state.subscribe({next:Xt=>"values"in Xt&&lt(ue(void 0,Ct),Xt)}):ue(lt,Ct,!0),Pt=lt=>P.state.subscribe({next:Ct=>{fnt(lt.name,Ct.name,lt.exact)&&hnt(Ct,lt.formState||T,ni,lt.reRenderRoot)&&lt.callback({values:{...d},...r,...Ct,defaultValues:a})}}).unsubscribe,pt=lt=>(p.mount=!0,C={...C,...lt.formState},Pt({...lt,formState:C})),Gt=(lt,Ct={})=>{for(const Xt of lt?iT(lt):s.mount)s.mount.delete(Xt),s.array.delete(Xt),Ct.keepValue||(Pa(n,Xt),Pa(d,Xt)),!Ct.keepError&&Pa(r.errors,Xt),!Ct.keepDirty&&Pa(r.dirtyFields,Xt),!Ct.keepTouched&&Pa(r.touchedFields,Xt),!Ct.keepIsValidating&&Pa(r.validatingFields,Xt),!t.shouldUnregister&&!Ct.keepDefaultValue&&Pa(a,Xt);P.state.next({values:Ka(d)}),P.state.next({...r,...Ct.keepDirty?{isDirty:be()}:{}}),!Ct.keepIsValid&&R()},Pr=({disabled:lt,name:Ct})=>{(Ac(lt)&&p.mount||lt||s.disabled.has(Ct))&&(lt?s.disabled.add(Ct):s.disabled.delete(Ct))},Ot=(lt,Ct={})=>{let Xt=zr(n,lt);const Sr=Ac(Ct.disabled)||Ac(t.disabled);return os(n,lt,{...Xt||{},_f:{...Xt&&Xt._f?Xt._f:{ref:{name:lt}},name:lt,mount:!0,...Ct}}),s.mount.add(lt),Xt?Pr({disabled:Ac(Ct.disabled)?Ct.disabled:t.disabled,name:lt}):K(lt,!0,Ct.value),{...Sr?{disabled:Ct.disabled||t.disabled}:{},...t.progressive?{required:!!Ct.required,min:mS(Ct.min),max:mS(Ct.max),minLength:mS(Ct.minLength),maxLength:mS(Ct.maxLength),pattern:mS(Ct.pattern)}:{},name:lt,onChange:Be,onBlur:Be,ref:yr=>{if(yr){Ot(lt,Ct),Xt=zr(n,lt);const hr=_a(yr.value)&&yr.querySelectorAll&&yr.querySelectorAll("input,select,textarea")[0]||yr,Or=ant(hr),Mn=Xt._f.refs||[];if(Or?Mn.find(oi=>oi===hr):hr===Xt._f.ref)return;os(n,lt,{_f:{...Xt._f,...Or?{refs:[...Mn.filter(lL),hr,...Array.isArray(zr(a,lt))?[{}]:[]],ref:{type:hr.type,name:lt}}:{ref:hr}}}),K(lt,!1,void 0,hr)}else Xt=zr(n,lt,{}),Xt._f&&(Xt._f.mount=!1),(t.shouldUnregister||Ct.shouldUnregister)&&!(kue(s.array,lt)&&p.action)&&s.unMount.add(lt)}}},nr=()=>t.shouldFocusError&&sT(n,Ve,s.mount),ur=lt=>{Ac(lt)&&(P.state.next({disabled:lt}),sT(n,(Ct,Xt)=>{const Sr=zr(n,Xt);Sr&&(Ct.disabled=Sr._f.disabled||lt,Array.isArray(Sr._f.refs)&&Sr._f.refs.forEach(yr=>{yr.disabled=Sr._f.disabled||lt}))},0,!1))},Et=(lt,Ct)=>async Xt=>{let Sr;Xt&&(Xt.preventDefault&&Xt.preventDefault(),Xt.persist&&Xt.persist());let yr=Ka(d);if(P.state.next({isSubmitting:!0}),t.resolver){const{errors:hr,values:Or}=await ae();r.errors=hr,yr=Ka(Or)}else await ge(n);if(s.disabled.size)for(const hr of s.disabled)Pa(yr,hr);if(Pa(r.errors,"root"),ec(r.errors)){P.state.next({errors:{}});try{await lt(yr,Xt)}catch(hr){Sr=hr}}else Ct&&await Ct({...r.errors},Xt),nr(),setTimeout(nr);if(P.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ec(r.errors)&&!Sr,submitCount:r.submitCount+1,errors:r.errors}),Sr)throw Sr},pr=(lt,Ct={})=>{zr(n,lt)&&(_a(Ct.defaultValue)?Me(lt,Ka(zr(a,lt))):(Me(lt,Ct.defaultValue),os(a,lt,Ka(Ct.defaultValue))),Ct.keepTouched||Pa(r.touchedFields,lt),Ct.keepDirty||(Pa(r.dirtyFields,lt),r.isDirty=Ct.defaultValue?be(lt,Ka(zr(a,lt))):be()),Ct.keepError||(Pa(r.errors,lt),T.isValid&&R()),P.state.next({...r}))},Kr=(lt,Ct={})=>{const Xt=lt?Ka(lt):a,Sr=Ka(Xt),yr=ec(lt),hr=yr?a:Sr;if(Ct.keepDefaultValues||(a=Xt),!Ct.keepValues){if(Ct.keepDirtyValues){const Or=new Set([...s.mount,...Object.keys(pS(a,d))]);for(const Mn of Array.from(Or))zr(r.dirtyFields,Mn)?os(hr,Mn,zr(d,Mn)):Me(Mn,zr(hr,Mn))}else{if(U$&&_a(lt))for(const Or of s.mount){const Mn=zr(n,Or);if(Mn&&Mn._f){const oi=Array.isArray(Mn._f.refs)?Mn._f.refs[0]:Mn._f.ref;if(lI(oi)){const $s=oi.closest("form");if($s){$s.reset();break}}}}if(Ct.keepFieldsRef)for(const Or of s.mount)Me(Or,zr(hr,Or));else n={}}d=t.shouldUnregister?Ct.keepDefaultValues?Ka(a):{}:Ka(hr),P.array.next({values:{...hr}}),P.state.next({values:{...hr}})}s={mount:Ct.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!T.isValid||!!Ct.keepIsValid||!!Ct.keepDirtyValues,p.watch=!!t.shouldUnregister,P.state.next({submitCount:Ct.keepSubmitCount?r.submitCount:0,isDirty:yr?!1:Ct.keepDirty?r.isDirty:!!(Ct.keepDefaultValues&&!gf(lt,a)),isSubmitted:Ct.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:yr?{}:Ct.keepDirtyValues?Ct.keepDefaultValues&&d?pS(a,d):r.dirtyFields:Ct.keepDefaultValues&&lt?pS(a,lt):Ct.keepDirty?r.dirtyFields:{},touchedFields:Ct.keepTouched?r.touchedFields:{},errors:Ct.keepErrors?r.errors:{},isSubmitSuccessful:Ct.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Xn=(lt,Ct)=>Kr(hd(lt)?lt(d):lt,Ct),Jn=(lt,Ct={})=>{const Xt=zr(n,lt),Sr=Xt&&Xt._f;if(Sr){const yr=Sr.refs?Sr.refs[0]:Sr.ref;yr.focus&&(yr.focus(),Ct.shouldSelect&&hd(yr.select)&&yr.select())}},ni=lt=>{r={...r,...lt}},hs={control:{register:Ot,unregister:Gt,getFieldState:ot,handleSubmit:Et,setError:Je,_subscribe:Pt,_runSchema:ae,_focusError:nr,_getWatch:ue,_getDirty:be,_setValid:R,_setFieldArray:G,_setDisabledField:Pr,_setErrors:$,_getFieldArray:Ce,_reset:Kr,_resetDefaultValues:()=>hd(t.defaultValues)&&t.defaultValues().then(lt=>{Xn(lt,t.resetOptions),P.state.next({isLoading:!1})}),_removeUnmounted:fe,_disableForm:ur,_subjects:P,_proxyFormState:T,get _fields(){return n},get _formValues(){return d},get _state(){return p},set _state(lt){p=lt},get _defaultValues(){return a},get _names(){return s},set _names(lt){s=lt},get _formState(){return r},get _options(){return t},set _options(lt){t={...t,...lt}}},subscribe:pt,trigger:We,register:Ot,handleSubmit:Et,watch:Bt,setValue:Me,getValues:Ee,reset:Xn,resetField:pr,clearErrors:yt,unregister:Gt,setError:Je,setFocus:Jn,getFieldState:ot};return{...hs,formControl:hs}}function _nt(e={}){const t=De.useRef(void 0),r=De.useRef(void 0),[n,a]=De.useState({isDirty:!1,isValidating:!1,isLoading:hd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:hd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!hd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:p,...s}=vnt(e);t.current={...s,formState:n}}const d=t.current.control;return d._options=e,H$(()=>{const p=d._subscribe({formState:d._proxyFormState,callback:()=>a({...d._formState}),reRenderRoot:!0});return a(s=>({...s,isReady:!0})),d._formState.isReady=!0,p},[d]),De.useEffect(()=>d._disableForm(e.disabled),[d,e.disabled]),De.useEffect(()=>{e.mode&&(d._options.mode=e.mode),e.reValidateMode&&(d._options.reValidateMode=e.reValidateMode)},[d,e.mode,e.reValidateMode]),De.useEffect(()=>{e.errors&&(d._setErrors(e.errors),d._focusError())},[d,e.errors]),De.useEffect(()=>{e.shouldUnregister&&d._subjects.state.next({values:d._getWatch()})},[d,e.shouldUnregister]),De.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==n.isDirty&&d._subjects.state.next({isDirty:p})}},[d,n.isDirty]),De.useEffect(()=>{e.values&&!gf(e.values,r.current)?(d._reset(e.values,{keepFieldsRef:!0,...d._options.resetOptions}),r.current=e.values,a(p=>({...p}))):d._resetDefaultValues()},[d,e.values]),De.useEffect(()=>{d._state.mount||(d._setValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),t.current.formState=Oue(n,d),t.current}const zK=(e,t,r)=>{if(e&&"reportValidity"in e){const n=zr(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},Vue=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?zK(n.ref,r,e):n.refs&&n.refs.forEach(a=>zK(a,r,e))}},xnt=(e,t)=>{t.shouldUseNativeValidation&&Vue(e,t);const r={};for(const n in e){const a=zr(t.fields,n),d=Object.assign(e[n]||{},{ref:a&&a.ref});if(bnt(t.names||Object.keys(e),n)){const p=Object.assign({},zr(r,n));os(p,"root",d),os(r,n,p)}else os(r,n,d)}return r},bnt=(e,t)=>e.some(r=>r.startsWith(t+"."));var wnt=function(e,t){for(var r={};e.length;){var n=e[0],a=n.code,d=n.message,p=n.path.join(".");if(!r[p])if("unionErrors"in n){var s=n.unionErrors[0].errors[0];r[p]={message:s.message,type:s.code}}else r[p]={message:d,type:a};if("unionErrors"in n&&n.unionErrors.forEach(function(T){return T.errors.forEach(function(C){return e.push(C)})}),t){var _=r[p].types,b=_&&_[n.code];r[p]=Mue(p,t,r,a,b?[].concat(b,n.message):n.message)}e.shift()}return r},Snt=function(e,t,r){return r===void 0&&(r={}),function(n,a,d){try{return Promise.resolve(function(p,s){try{var _=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(b){return d.shouldUseNativeValidation&&Vue({},d),{errors:{},values:r.raw?n:b}})}catch(b){return s(b)}return _&&_.then?_.then(void 0,s):_}(0,function(p){if(function(s){return Array.isArray(s==null?void 0:s.errors)}(p))return{values:{},errors:xnt(wnt(p.errors,!d.shouldUseNativeValidation&&d.criteriaMode==="all"),d)};throw p}))}catch(p){return Promise.reject(p)}}},qi;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function r(a){throw new Error}e.assertNever=r,e.arrayToEnum=a=>{const d={};for(const p of a)d[p]=p;return d},e.getValidEnumValues=a=>{const d=e.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),p={};for(const s of d)p[s]=a[s];return e.objectValues(p)},e.objectValues=a=>e.objectKeys(a).map(function(d){return a[d]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const d=[];for(const p in a)Object.prototype.hasOwnProperty.call(a,p)&&d.push(p);return d},e.find=(a,d)=>{for(const p of a)if(d(p))return p},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,d=" | "){return a.map(p=>typeof p=="string"?`'${p}'`:p).join(d)}e.joinValues=n,e.jsonStringifyReplacer=(a,d)=>typeof d=="bigint"?d.toString():d})(qi||(qi={}));var BK;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(BK||(BK={}));const on=qi.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Kp=e=>{switch(typeof e){case"undefined":return on.undefined;case"string":return on.string;case"number":return Number.isNaN(e)?on.nan:on.number;case"boolean":return on.boolean;case"function":return on.function;case"bigint":return on.bigint;case"symbol":return on.symbol;case"object":return Array.isArray(e)?on.array:e===null?on.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?on.promise:typeof Map<"u"&&e instanceof Map?on.map:typeof Set<"u"&&e instanceof Set?on.set:typeof Date<"u"&&e instanceof Date?on.date:on.object;default:return on.unknown}},Tr=qi.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Vf extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(d){return d.message},n={_errors:[]},a=d=>{for(const p of d.issues)if(p.code==="invalid_union")p.unionErrors.map(a);else if(p.code==="invalid_return_type")a(p.returnTypeError);else if(p.code==="invalid_arguments")a(p.argumentsError);else if(p.path.length===0)n._errors.push(r(p));else{let s=n,_=0;for(;_<p.path.length;){const b=p.path[_];_===p.path.length-1?(s[b]=s[b]||{_errors:[]},s[b]._errors.push(r(p))):s[b]=s[b]||{_errors:[]},s=s[b],_++}}};return a(this),n}static assert(t){if(!(t instanceof Vf))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,qi.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const a of this.issues)if(a.path.length>0){const d=a.path[0];r[d]=r[d]||[],r[d].push(t(a))}else n.push(t(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Vf.create=e=>new Vf(e);const Yz=(e,t)=>{let r;switch(e.code){case Tr.invalid_type:e.received===on.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Tr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,qi.jsonStringifyReplacer)}`;break;case Tr.unrecognized_keys:r=`Unrecognized key(s) in object: ${qi.joinValues(e.keys,", ")}`;break;case Tr.invalid_union:r="Invalid input";break;case Tr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${qi.joinValues(e.options)}`;break;case Tr.invalid_enum_value:r=`Invalid enum value. Expected ${qi.joinValues(e.options)}, received '${e.received}'`;break;case Tr.invalid_arguments:r="Invalid function arguments";break;case Tr.invalid_return_type:r="Invalid function return type";break;case Tr.invalid_date:r="Invalid date";break;case Tr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:qi.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Tr.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Tr.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Tr.custom:r="Invalid input";break;case Tr.invalid_intersection_types:r="Intersection results could not be merged";break;case Tr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Tr.not_finite:r="Number must be finite";break;default:r=t.defaultError,qi.assertNever(e)}return{message:r}};let Tnt=Yz;function Ent(){return Tnt}const jnt=e=>{const{data:t,path:r,errorMaps:n,issueData:a}=e,d=[...r,...a.path||[]],p={...a,path:d};if(a.message!==void 0)return{...a,path:d,message:a.message};let s="";const _=n.filter(b=>!!b).slice().reverse();for(const b of _)s=b(p,{data:t,defaultError:s}).message;return{...a,path:d,message:s}};function qr(e,t){const r=Ent(),n=jnt({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===Yz?void 0:Yz].filter(a=>!!a)});e.common.issues.push(n)}class Uc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const a of r){if(a.status==="aborted")return Kn;a.status==="dirty"&&t.dirty(),n.push(a.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const a of r){const d=await a.key,p=await a.value;n.push({key:d,value:p})}return Uc.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const a of r){const{key:d,value:p}=a;if(d.status==="aborted"||p.status==="aborted")return Kn;d.status==="dirty"&&t.dirty(),p.status==="dirty"&&t.dirty(),d.value!=="__proto__"&&(typeof p.value<"u"||a.alwaysSet)&&(n[d.value]=p.value)}return{status:t.value,value:n}}}const Kn=Object.freeze({status:"aborted"}),PS=e=>({status:"dirty",value:e}),Iu=e=>({status:"valid",value:e}),$K=e=>e.status==="aborted",VK=e=>e.status==="dirty",ib=e=>e.status==="valid",dI=e=>typeof Promise<"u"&&e instanceof Promise;var cn;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(cn||(cn={}));class $m{constructor(t,r,n,a){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const UK=(e,t)=>{if(ib(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Vf(e.common.issues);return this._error=r,this._error}}};function pi(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(p,s)=>{const{message:_}=e;return p.code==="invalid_enum_value"?{message:_??s.defaultError}:typeof s.data>"u"?{message:_??n??s.defaultError}:p.code!=="invalid_type"?{message:s.defaultError}:{message:_??r??s.defaultError}},description:a}}class Vi{get description(){return this._def.description}_getType(t){return Kp(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Kp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Uc,ctx:{common:t.parent.common,data:t.data,parsedType:Kp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(dI(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kp(t)},a=this._parseSync({data:t,path:n.path,parent:n});return UK(n,a)}"~validate"(t){var n,a;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kp(t)};if(!this["~standard"].async)try{const d=this._parseSync({data:t,path:[],parent:r});return ib(d)?{value:d.value}:{issues:r.common.issues}}catch(d){(a=(n=d==null?void 0:d.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(d=>ib(d)?{value:d.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kp(t)},a=this._parse({data:t,path:n.path,parent:n}),d=await(dI(a)?a:Promise.resolve(a));return UK(n,d)}refine(t,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,d)=>{const p=t(a),s=()=>d.addIssue({code:Tr.custom,...n(a)});return typeof Promise<"u"&&p instanceof Promise?p.then(_=>_?!0:(s(),!1)):p?!0:(s(),!1)})}refinement(t,r){return this._refinement((n,a)=>t(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(t){return new ob({schema:this,typeName:Yn.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Am.create(this,this._def)}nullable(){return lb.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jh.create(this)}promise(){return mI.create(this,this._def)}or(t){return fI.create([this,t],this._def)}and(t){return pI.create(this,t,this._def)}transform(t){return new ob({...pi(this._def),schema:this,typeName:Yn.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new Qz({...pi(this._def),innerType:this,defaultValue:r,typeName:Yn.ZodDefault})}brand(){return new Xnt({typeName:Yn.ZodBranded,type:this,...pi(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new eB({...pi(this._def),innerType:this,catchValue:r,typeName:Yn.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return K$.create(this,t)}readonly(){return tB.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ant=/^c[^\s-]{8,}$/i,Cnt=/^[0-9a-z]+$/,Pnt=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Nnt=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Int=/^[a-z0-9_-]{21}$/i,knt=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ont=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Rnt=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Mnt="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let cL;const Dnt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Lnt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Fnt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,znt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Bnt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$nt=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Uue="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Vnt=new RegExp(`^${Uue}$`);function que(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Unt(e){return new RegExp(`^${que(e)}$`)}function qnt(e){let t=`${Uue}T${que(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Gnt(e,t){return!!((t==="v4"||!t)&&Dnt.test(e)||(t==="v6"||!t)&&Fnt.test(e))}function Wnt(e,t){if(!knt.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Hnt(e,t){return!!((t==="v4"||!t)&&Lnt.test(e)||(t==="v6"||!t)&&znt.test(e))}class mm extends Vi{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==on.string){const d=this._getOrReturnCtx(t);return qr(d,{code:Tr.invalid_type,expected:on.string,received:d.parsedType}),Kn}const n=new Uc;let a;for(const d of this._def.checks)if(d.kind==="min")t.data.length<d.value&&(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="max")t.data.length>d.value&&(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="length"){const p=t.data.length>d.value,s=t.data.length<d.value;(p||s)&&(a=this._getOrReturnCtx(t,a),p?qr(a,{code:Tr.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):s&&qr(a,{code:Tr.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),n.dirty())}else if(d.kind==="email")Rnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"email",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="emoji")cL||(cL=new RegExp(Mnt,"u")),cL.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"emoji",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="uuid")Nnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"uuid",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="nanoid")Int.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"nanoid",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid")Ant.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"cuid",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid2")Cnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"cuid2",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="ulid")Pnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"ulid",code:Tr.invalid_string,message:d.message}),n.dirty());else if(d.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),qr(a,{validation:"url",code:Tr.invalid_string,message:d.message}),n.dirty()}else d.kind==="regex"?(d.regex.lastIndex=0,d.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"regex",code:Tr.invalid_string,message:d.message}),n.dirty())):d.kind==="trim"?t.data=t.data.trim():d.kind==="includes"?t.data.includes(d.value,d.position)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),n.dirty()):d.kind==="toLowerCase"?t.data=t.data.toLowerCase():d.kind==="toUpperCase"?t.data=t.data.toUpperCase():d.kind==="startsWith"?t.data.startsWith(d.value)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:{startsWith:d.value},message:d.message}),n.dirty()):d.kind==="endsWith"?t.data.endsWith(d.value)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:{endsWith:d.value},message:d.message}),n.dirty()):d.kind==="datetime"?qnt(d).test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:"datetime",message:d.message}),n.dirty()):d.kind==="date"?Vnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:"date",message:d.message}),n.dirty()):d.kind==="time"?Unt(d).test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.invalid_string,validation:"time",message:d.message}),n.dirty()):d.kind==="duration"?Ont.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"duration",code:Tr.invalid_string,message:d.message}),n.dirty()):d.kind==="ip"?Gnt(t.data,d.version)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"ip",code:Tr.invalid_string,message:d.message}),n.dirty()):d.kind==="jwt"?Wnt(t.data,d.alg)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"jwt",code:Tr.invalid_string,message:d.message}),n.dirty()):d.kind==="cidr"?Hnt(t.data,d.version)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"cidr",code:Tr.invalid_string,message:d.message}),n.dirty()):d.kind==="base64"?Bnt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"base64",code:Tr.invalid_string,message:d.message}),n.dirty()):d.kind==="base64url"?$nt.test(t.data)||(a=this._getOrReturnCtx(t,a),qr(a,{validation:"base64url",code:Tr.invalid_string,message:d.message}),n.dirty()):qi.assertNever(d);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(a=>t.test(a),{validation:r,code:Tr.invalid_string,...cn.errToObj(n)})}_addCheck(t){return new mm({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...cn.errToObj(t)})}url(t){return this._addCheck({kind:"url",...cn.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...cn.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...cn.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...cn.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...cn.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...cn.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...cn.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...cn.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...cn.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...cn.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...cn.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...cn.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...cn.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...cn.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...cn.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...cn.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...cn.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...cn.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...cn.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...cn.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...cn.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...cn.errToObj(r)})}nonempty(t){return this.min(1,cn.errToObj(t))}trim(){return new mm({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new mm({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new mm({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}mm.create=e=>new mm({checks:[],typeName:Yn.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...pi(e)});function Znt(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n,d=Number.parseInt(e.toFixed(a).replace(".","")),p=Number.parseInt(t.toFixed(a).replace(".",""));return d%p/10**a}class sb extends Vi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==on.number){const d=this._getOrReturnCtx(t);return qr(d,{code:Tr.invalid_type,expected:on.number,received:d.parsedType}),Kn}let n;const a=new Uc;for(const d of this._def.checks)d.kind==="int"?qi.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.invalid_type,expected:"integer",received:"float",message:d.message}),a.dirty()):d.kind==="min"?(d.inclusive?t.data<d.value:t.data<=d.value)&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),a.dirty()):d.kind==="max"?(d.inclusive?t.data>d.value:t.data>=d.value)&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),a.dirty()):d.kind==="multipleOf"?Znt(t.data,d.value)!==0&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.not_multiple_of,multipleOf:d.value,message:d.message}),a.dirty()):d.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.not_finite,message:d.message}),a.dirty()):qi.assertNever(d);return{status:a.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,cn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,cn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,cn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,cn.toString(r))}setLimit(t,r,n,a){return new sb({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:cn.toString(a)}]})}_addCheck(t){return new sb({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:cn.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:cn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:cn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:cn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:cn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:cn.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:cn.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:cn.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:cn.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&qi.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}sb.create=e=>new sb({checks:[],typeName:Yn.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...pi(e)});class j2 extends Vi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==on.bigint)return this._getInvalidInput(t);let n;const a=new Uc;for(const d of this._def.checks)d.kind==="min"?(d.inclusive?t.data<d.value:t.data<=d.value)&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),a.dirty()):d.kind==="max"?(d.inclusive?t.data>d.value:t.data>=d.value)&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),a.dirty()):d.kind==="multipleOf"?t.data%d.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),qr(n,{code:Tr.not_multiple_of,multipleOf:d.value,message:d.message}),a.dirty()):qi.assertNever(d);return{status:a.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return qr(r,{code:Tr.invalid_type,expected:on.bigint,received:r.parsedType}),Kn}gte(t,r){return this.setLimit("min",t,!0,cn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,cn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,cn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,cn.toString(r))}setLimit(t,r,n,a){return new j2({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:cn.toString(a)}]})}_addCheck(t){return new j2({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:cn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:cn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:cn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:cn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:cn.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}j2.create=e=>new j2({checks:[],typeName:Yn.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...pi(e)});class qK extends Vi{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==on.boolean){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.boolean,received:n.parsedType}),Kn}return Iu(t.data)}}qK.create=e=>new qK({typeName:Yn.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...pi(e)});class hI extends Vi{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==on.date){const d=this._getOrReturnCtx(t);return qr(d,{code:Tr.invalid_type,expected:on.date,received:d.parsedType}),Kn}if(Number.isNaN(t.data.getTime())){const d=this._getOrReturnCtx(t);return qr(d,{code:Tr.invalid_date}),Kn}const n=new Uc;let a;for(const d of this._def.checks)d.kind==="min"?t.data.getTime()<d.value&&(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),n.dirty()):d.kind==="max"?t.data.getTime()>d.value&&(a=this._getOrReturnCtx(t,a),qr(a,{code:Tr.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),n.dirty()):qi.assertNever(d);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new hI({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:cn.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:cn.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}hI.create=e=>new hI({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Yn.ZodDate,...pi(e)});class GK extends Vi{_parse(t){if(this._getType(t)!==on.symbol){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.symbol,received:n.parsedType}),Kn}return Iu(t.data)}}GK.create=e=>new GK({typeName:Yn.ZodSymbol,...pi(e)});class WK extends Vi{_parse(t){if(this._getType(t)!==on.undefined){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.undefined,received:n.parsedType}),Kn}return Iu(t.data)}}WK.create=e=>new WK({typeName:Yn.ZodUndefined,...pi(e)});class HK extends Vi{_parse(t){if(this._getType(t)!==on.null){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.null,received:n.parsedType}),Kn}return Iu(t.data)}}HK.create=e=>new HK({typeName:Yn.ZodNull,...pi(e)});class ZK extends Vi{constructor(){super(...arguments),this._any=!0}_parse(t){return Iu(t.data)}}ZK.create=e=>new ZK({typeName:Yn.ZodAny,...pi(e)});class XK extends Vi{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Iu(t.data)}}XK.create=e=>new XK({typeName:Yn.ZodUnknown,...pi(e)});class Vm extends Vi{_parse(t){const r=this._getOrReturnCtx(t);return qr(r,{code:Tr.invalid_type,expected:on.never,received:r.parsedType}),Kn}}Vm.create=e=>new Vm({typeName:Yn.ZodNever,...pi(e)});class KK extends Vi{_parse(t){if(this._getType(t)!==on.undefined){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.void,received:n.parsedType}),Kn}return Iu(t.data)}}KK.create=e=>new KK({typeName:Yn.ZodVoid,...pi(e)});class jh extends Vi{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),a=this._def;if(r.parsedType!==on.array)return qr(r,{code:Tr.invalid_type,expected:on.array,received:r.parsedType}),Kn;if(a.exactLength!==null){const p=r.data.length>a.exactLength.value,s=r.data.length<a.exactLength.value;(p||s)&&(qr(r,{code:p?Tr.too_big:Tr.too_small,minimum:s?a.exactLength.value:void 0,maximum:p?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(qr(r,{code:Tr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(qr(r,{code:Tr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((p,s)=>a.type._parseAsync(new $m(r,p,r.path,s)))).then(p=>Uc.mergeArray(n,p));const d=[...r.data].map((p,s)=>a.type._parseSync(new $m(r,p,r.path,s)));return Uc.mergeArray(n,d)}get element(){return this._def.type}min(t,r){return new jh({...this._def,minLength:{value:t,message:cn.toString(r)}})}max(t,r){return new jh({...this._def,maxLength:{value:t,message:cn.toString(r)}})}length(t,r){return new jh({...this._def,exactLength:{value:t,message:cn.toString(r)}})}nonempty(t){return this.min(1,t)}}jh.create=(e,t)=>new jh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Yn.ZodArray,...pi(t)});function yx(e){if(e instanceof Oa){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Am.create(yx(n))}return new Oa({...e._def,shape:()=>t})}else return e instanceof jh?new jh({...e._def,type:yx(e.element)}):e instanceof Am?Am.create(yx(e.unwrap())):e instanceof lb?lb.create(yx(e.unwrap())):e instanceof gv?gv.create(e.items.map(t=>yx(t))):e}class Oa extends Vi{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=qi.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==on.object){const b=this._getOrReturnCtx(t);return qr(b,{code:Tr.invalid_type,expected:on.object,received:b.parsedType}),Kn}const{status:n,ctx:a}=this._processInputParams(t),{shape:d,keys:p}=this._getCached(),s=[];if(!(this._def.catchall instanceof Vm&&this._def.unknownKeys==="strip"))for(const b in a.data)p.includes(b)||s.push(b);const _=[];for(const b of p){const T=d[b],C=a.data[b];_.push({key:{status:"valid",value:b},value:T._parse(new $m(a,C,a.path,b)),alwaysSet:b in a.data})}if(this._def.catchall instanceof Vm){const b=this._def.unknownKeys;if(b==="passthrough")for(const T of s)_.push({key:{status:"valid",value:T},value:{status:"valid",value:a.data[T]}});else if(b==="strict")s.length>0&&(qr(a,{code:Tr.unrecognized_keys,keys:s}),n.dirty());else if(b!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const b=this._def.catchall;for(const T of s){const C=a.data[T];_.push({key:{status:"valid",value:T},value:b._parse(new $m(a,C,a.path,T)),alwaysSet:T in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const b=[];for(const T of _){const C=await T.key,P=await T.value;b.push({key:C,value:P,alwaysSet:T.alwaysSet})}return b}).then(b=>Uc.mergeObjectSync(n,b)):Uc.mergeObjectSync(n,_)}get shape(){return this._def.shape()}strict(t){return cn.errToObj,new Oa({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var d,p;const a=((p=(d=this._def).errorMap)==null?void 0:p.call(d,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:cn.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new Oa({...this._def,unknownKeys:"strip"})}passthrough(){return new Oa({...this._def,unknownKeys:"passthrough"})}extend(t){return new Oa({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Oa({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Yn.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Oa({...this._def,catchall:t})}pick(t){const r={};for(const n of qi.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Oa({...this._def,shape:()=>r})}omit(t){const r={};for(const n of qi.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Oa({...this._def,shape:()=>r})}deepPartial(){return yx(this)}partial(t){const r={};for(const n of qi.objectKeys(this.shape)){const a=this.shape[n];t&&!t[n]?r[n]=a:r[n]=a.optional()}return new Oa({...this._def,shape:()=>r})}required(t){const r={};for(const n of qi.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let d=this.shape[n];for(;d instanceof Am;)d=d._def.innerType;r[n]=d}return new Oa({...this._def,shape:()=>r})}keyof(){return Gue(qi.objectKeys(this.shape))}}Oa.create=(e,t)=>new Oa({shape:()=>e,unknownKeys:"strip",catchall:Vm.create(),typeName:Yn.ZodObject,...pi(t)});Oa.strictCreate=(e,t)=>new Oa({shape:()=>e,unknownKeys:"strict",catchall:Vm.create(),typeName:Yn.ZodObject,...pi(t)});Oa.lazycreate=(e,t)=>new Oa({shape:e,unknownKeys:"strip",catchall:Vm.create(),typeName:Yn.ZodObject,...pi(t)});class fI extends Vi{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function a(d){for(const s of d)if(s.result.status==="valid")return s.result;for(const s of d)if(s.result.status==="dirty")return r.common.issues.push(...s.ctx.common.issues),s.result;const p=d.map(s=>new Vf(s.ctx.common.issues));return qr(r,{code:Tr.invalid_union,unionErrors:p}),Kn}if(r.common.async)return Promise.all(n.map(async d=>{const p={...r,common:{...r.common,issues:[]},parent:null};return{result:await d._parseAsync({data:r.data,path:r.path,parent:p}),ctx:p}})).then(a);{let d;const p=[];for(const _ of n){const b={...r,common:{...r.common,issues:[]},parent:null},T=_._parseSync({data:r.data,path:r.path,parent:b});if(T.status==="valid")return T;T.status==="dirty"&&!d&&(d={result:T,ctx:b}),b.common.issues.length&&p.push(b.common.issues)}if(d)return r.common.issues.push(...d.ctx.common.issues),d.result;const s=p.map(_=>new Vf(_));return qr(r,{code:Tr.invalid_union,unionErrors:s}),Kn}}get options(){return this._def.options}}fI.create=(e,t)=>new fI({options:e,typeName:Yn.ZodUnion,...pi(t)});function Jz(e,t){const r=Kp(e),n=Kp(t);if(e===t)return{valid:!0,data:e};if(r===on.object&&n===on.object){const a=qi.objectKeys(t),d=qi.objectKeys(e).filter(s=>a.indexOf(s)!==-1),p={...e,...t};for(const s of d){const _=Jz(e[s],t[s]);if(!_.valid)return{valid:!1};p[s]=_.data}return{valid:!0,data:p}}else if(r===on.array&&n===on.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let d=0;d<e.length;d++){const p=e[d],s=t[d],_=Jz(p,s);if(!_.valid)return{valid:!1};a.push(_.data)}return{valid:!0,data:a}}else return r===on.date&&n===on.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class pI extends Vi{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=(d,p)=>{if($K(d)||$K(p))return Kn;const s=Jz(d.value,p.value);return s.valid?((VK(d)||VK(p))&&r.dirty(),{status:r.value,value:s.data}):(qr(n,{code:Tr.invalid_intersection_types}),Kn)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([d,p])=>a(d,p)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}pI.create=(e,t,r)=>new pI({left:e,right:t,typeName:Yn.ZodIntersection,...pi(r)});class gv extends Vi{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==on.array)return qr(n,{code:Tr.invalid_type,expected:on.array,received:n.parsedType}),Kn;if(n.data.length<this._def.items.length)return qr(n,{code:Tr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Kn;!this._def.rest&&n.data.length>this._def.items.length&&(qr(n,{code:Tr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const d=[...n.data].map((p,s)=>{const _=this._def.items[s]||this._def.rest;return _?_._parse(new $m(n,p,n.path,s)):null}).filter(p=>!!p);return n.common.async?Promise.all(d).then(p=>Uc.mergeArray(r,p)):Uc.mergeArray(r,d)}get items(){return this._def.items}rest(t){return new gv({...this._def,rest:t})}}gv.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new gv({items:e,typeName:Yn.ZodTuple,rest:null,...pi(t)})};class YK extends Vi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==on.map)return qr(n,{code:Tr.invalid_type,expected:on.map,received:n.parsedType}),Kn;const a=this._def.keyType,d=this._def.valueType,p=[...n.data.entries()].map(([s,_],b)=>({key:a._parse(new $m(n,s,n.path,[b,"key"])),value:d._parse(new $m(n,_,n.path,[b,"value"]))}));if(n.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const _ of p){const b=await _.key,T=await _.value;if(b.status==="aborted"||T.status==="aborted")return Kn;(b.status==="dirty"||T.status==="dirty")&&r.dirty(),s.set(b.value,T.value)}return{status:r.value,value:s}})}else{const s=new Map;for(const _ of p){const b=_.key,T=_.value;if(b.status==="aborted"||T.status==="aborted")return Kn;(b.status==="dirty"||T.status==="dirty")&&r.dirty(),s.set(b.value,T.value)}return{status:r.value,value:s}}}}YK.create=(e,t,r)=>new YK({valueType:t,keyType:e,typeName:Yn.ZodMap,...pi(r)});class A2 extends Vi{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==on.set)return qr(n,{code:Tr.invalid_type,expected:on.set,received:n.parsedType}),Kn;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(qr(n,{code:Tr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(qr(n,{code:Tr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const d=this._def.valueType;function p(_){const b=new Set;for(const T of _){if(T.status==="aborted")return Kn;T.status==="dirty"&&r.dirty(),b.add(T.value)}return{status:r.value,value:b}}const s=[...n.data.values()].map((_,b)=>d._parse(new $m(n,_,n.path,b)));return n.common.async?Promise.all(s).then(_=>p(_)):p(s)}min(t,r){return new A2({...this._def,minSize:{value:t,message:cn.toString(r)}})}max(t,r){return new A2({...this._def,maxSize:{value:t,message:cn.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}A2.create=(e,t)=>new A2({valueType:e,minSize:null,maxSize:null,typeName:Yn.ZodSet,...pi(t)});class JK extends Vi{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}JK.create=(e,t)=>new JK({getter:e,typeName:Yn.ZodLazy,...pi(t)});class QK extends Vi{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return qr(r,{received:r.data,code:Tr.invalid_literal,expected:this._def.value}),Kn}return{status:"valid",value:t.data}}get value(){return this._def.value}}QK.create=(e,t)=>new QK({value:e,typeName:Yn.ZodLiteral,...pi(t)});function Gue(e,t){return new ab({values:e,typeName:Yn.ZodEnum,...pi(t)})}class ab extends Vi{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return qr(r,{expected:qi.joinValues(n),received:r.parsedType,code:Tr.invalid_type}),Kn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return qr(r,{received:r.data,code:Tr.invalid_enum_value,options:n}),Kn}return Iu(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return ab.create(t,{...this._def,...r})}exclude(t,r=this._def){return ab.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}ab.create=Gue;class eY extends Vi{_parse(t){const r=qi.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==on.string&&n.parsedType!==on.number){const a=qi.objectValues(r);return qr(n,{expected:qi.joinValues(a),received:n.parsedType,code:Tr.invalid_type}),Kn}if(this._cache||(this._cache=new Set(qi.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=qi.objectValues(r);return qr(n,{received:n.data,code:Tr.invalid_enum_value,options:a}),Kn}return Iu(t.data)}get enum(){return this._def.values}}eY.create=(e,t)=>new eY({values:e,typeName:Yn.ZodNativeEnum,...pi(t)});class mI extends Vi{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==on.promise&&r.common.async===!1)return qr(r,{code:Tr.invalid_type,expected:on.promise,received:r.parsedType}),Kn;const n=r.parsedType===on.promise?r.data:Promise.resolve(r.data);return Iu(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}mI.create=(e,t)=>new mI({type:e,typeName:Yn.ZodPromise,...pi(t)});class ob extends Vi{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Yn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),a=this._def.effect||null,d={addIssue:p=>{qr(n,p),p.fatal?r.abort():r.dirty()},get path(){return n.path}};if(d.addIssue=d.addIssue.bind(d),a.type==="preprocess"){const p=a.transform(n.data,d);if(n.common.async)return Promise.resolve(p).then(async s=>{if(r.value==="aborted")return Kn;const _=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return _.status==="aborted"?Kn:_.status==="dirty"||r.value==="dirty"?PS(_.value):_});{if(r.value==="aborted")return Kn;const s=this._def.schema._parseSync({data:p,path:n.path,parent:n});return s.status==="aborted"?Kn:s.status==="dirty"||r.value==="dirty"?PS(s.value):s}}if(a.type==="refinement"){const p=s=>{const _=a.refinement(s,d);if(n.common.async)return Promise.resolve(_);if(_ instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Kn:(s.status==="dirty"&&r.dirty(),p(s.value),{status:r.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?Kn:(s.status==="dirty"&&r.dirty(),p(s.value).then(()=>({status:r.value,value:s.value}))))}if(a.type==="transform")if(n.common.async===!1){const p=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!ib(p))return Kn;const s=a.transform(p.value,d);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(p=>ib(p)?Promise.resolve(a.transform(p.value,d)).then(s=>({status:r.value,value:s})):Kn);qi.assertNever(a)}}ob.create=(e,t,r)=>new ob({schema:e,typeName:Yn.ZodEffects,effect:t,...pi(r)});ob.createWithPreprocess=(e,t,r)=>new ob({schema:t,effect:{type:"preprocess",transform:e},typeName:Yn.ZodEffects,...pi(r)});class Am extends Vi{_parse(t){return this._getType(t)===on.undefined?Iu(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Am.create=(e,t)=>new Am({innerType:e,typeName:Yn.ZodOptional,...pi(t)});class lb extends Vi{_parse(t){return this._getType(t)===on.null?Iu(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}lb.create=(e,t)=>new lb({innerType:e,typeName:Yn.ZodNullable,...pi(t)});class Qz extends Vi{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===on.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Qz.create=(e,t)=>new Qz({innerType:e,typeName:Yn.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...pi(t)});class eB extends Vi{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return dI(a)?a.then(d=>({status:"valid",value:d.status==="valid"?d.value:this._def.catchValue({get error(){return new Vf(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Vf(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}eB.create=(e,t)=>new eB({innerType:e,typeName:Yn.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...pi(t)});class tY extends Vi{_parse(t){if(this._getType(t)!==on.nan){const n=this._getOrReturnCtx(t);return qr(n,{code:Tr.invalid_type,expected:on.nan,received:n.parsedType}),Kn}return{status:"valid",value:t.data}}}tY.create=e=>new tY({typeName:Yn.ZodNaN,...pi(e)});class Xnt extends Vi{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class K$ extends Vi{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const d=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return d.status==="aborted"?Kn:d.status==="dirty"?(r.dirty(),PS(d.value)):this._def.out._parseAsync({data:d.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?Kn:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(t,r){return new K$({in:t,out:r,typeName:Yn.ZodPipeline})}}class tB extends Vi{_parse(t){const r=this._def.innerType._parse(t),n=a=>(ib(a)&&(a.value=Object.freeze(a.value)),a);return dI(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}tB.create=(e,t)=>new tB({innerType:e,typeName:Yn.ZodReadonly,...pi(t)});var Yn;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Yn||(Yn={}));const rY=mm.create,nY=sb.create;Vm.create;jh.create;const Knt=Oa.create;fI.create;pI.create;gv.create;ab.create;mI.create;Am.create;lb.create;const Ynt=tnt,Wue=F.createContext({}),DC=({...e})=>c.jsx(Wue.Provider,{value:{name:e.name},children:c.jsx(snt,{...e})}),cO=()=>{const e=F.useContext(Wue),t=F.useContext(Hue),{getFieldState:r,formState:n}=lO(),a=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:d}=t;return{id:d,name:e.name,formItemId:`${d}-form-item`,formDescriptionId:`${d}-form-item-description`,formMessageId:`${d}-form-item-message`,...a}},Hue=F.createContext({}),NS=F.forwardRef(({className:e,...t},r)=>{const n=F.useId();return c.jsx(Hue.Provider,{value:{id:n},children:c.jsx("div",{ref:r,className:Dr("space-y-2",e),...t})})});NS.displayName="FormItem";const IS=F.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:a}=cO();return c.jsx(zt,{ref:r,className:Dr(n&&"text-destructive",e),htmlFor:a,...t})});IS.displayName="FormLabel";const kS=F.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:a,formMessageId:d}=cO();return c.jsx(PQ,{ref:t,id:n,"aria-describedby":r?`${a} ${d}`:`${a}`,"aria-invalid":!!r,...e})});kS.displayName="FormControl";const Jnt=F.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=cO();return c.jsx("p",{ref:r,id:n,className:Dr("text-sm text-muted-foreground",e),...t})});Jnt.displayName="FormDescription";const OS=F.forwardRef(({className:e,children:t,...r},n)=>{const{error:a,formMessageId:d}=cO(),p=a?String(a==null?void 0:a.message):t;return p?c.jsx("p",{ref:n,id:d,className:Dr("text-sm font-medium text-destructive",e),...r,children:p}):null});OS.displayName="FormMessage";const gI=({rating:e,maxRating:t=5,size:r="md",interactive:n=!1,onRatingChange:a,className:d})=>{const p={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"},s=_=>{n&&a&&a(_+1)};return c.jsx("div",{className:Dr("flex gap-1",d),children:Array.from({length:t}).map((_,b)=>c.jsx(Mc,{className:Dr(p[r],n&&"cursor-pointer transition-colors hover:text-yellow-400",b<e?"fill-yellow-400 text-yellow-400":"fill-muted text-muted-foreground"),onClick:()=>s(b)},b))})},Qnt=Knt({establishmentRating:nY().min(1,"Avalie o estabelecimento").max(5),establishmentComment:rY().optional(),driverRating:nY().min(1,"Avalie o entregador").max(5).optional(),driverComment:rY().optional()}),eit=({orderId:e,establishmentId:t,establishmentName:r,driverId:n,driverName:a,onSuccess:d})=>{const[p,s]=F.useState(!1),[_,b]=F.useState(!1),T=_nt({resolver:Snt(Qnt),defaultValues:{establishmentRating:0,establishmentComment:"",driverRating:0,driverComment:""}}),C=async P=>{s(!0);try{const{data:k}=await dt.auth.getUser();if(!k.user){gt.error("Voc precisa estar logado para avaliar"),s(!1);return}const{error:B}=await dt.from("reviews").insert({order_id:e,customer_id:k.user.id,establishment_id:t,driver_id:n||null,establishment_rating:P.establishmentRating,establishment_comment:P.establishmentComment||null,driver_rating:n?P.driverRating:null,driver_comment:n?P.driverComment:null});if(B){if(B.code==="23505")gt.error("Voc j avaliou este pedido");else throw B;s(!1);return}gt.success("Avaliao enviada com sucesso!"),b(!0),setTimeout(()=>{d==null||d()},1500),console.error("Error submitting review:",B),gt.error("Erro ao enviar avaliao")}finally{s(!1)}};return c.jsx(Vt,{className:"w-full max-w-lg mx-auto overflow-hidden",children:c.jsx(ju,{mode:"wait",children:_?c.jsxs(gr.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"py-12 px-6 flex flex-col items-center justify-center",children:[c.jsx(gr.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15,delay:.1},className:"w-20 h-20 rounded-full bg-success/20 flex items-center justify-center mb-4",children:c.jsx(gr.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,delay:.2},children:c.jsx(Fve,{className:"w-12 h-12 text-success"})})}),c.jsx(gr.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-xl font-display font-bold text-center",children:"Obrigado pela avaliao!"}),c.jsx(gr.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-muted-foreground text-center mt-2",children:"Sua opinio  muito importante para ns"})]},"success"):c.jsxs(gr.div,{initial:{opacity:1},exit:{opacity:0},children:[c.jsx(Wr,{children:c.jsx(Hr,{className:"text-center",children:"Como foi seu pedido?"})}),c.jsx(Ut,{children:c.jsx(Ynt,{...T,children:c.jsxs("form",{onSubmit:T.handleSubmit(C),className:"space-y-6",children:[c.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-muted/50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bi,{className:"w-5 h-5 text-primary"}),c.jsx("span",{className:"font-medium",children:r})]}),c.jsx(DC,{control:T.control,name:"establishmentRating",render:({field:P,fieldState:k})=>c.jsxs(NS,{children:[c.jsx(IS,{children:"Avaliao *"}),c.jsx(kS,{children:c.jsxs("div",{children:[c.jsx(gI,{rating:P.value,interactive:!0,size:"lg",onRatingChange:P.onChange}),P.value===0&&k.error&&c.jsx("p",{className:"text-sm text-destructive mt-2",children:"Toque nas estrelas para avaliar"})]})}),c.jsx(OS,{})]})}),c.jsx(DC,{control:T.control,name:"establishmentComment",render:({field:P})=>c.jsxs(NS,{children:[c.jsx(IS,{children:"Comentrio (opcional)"}),c.jsx(kS,{children:c.jsx(Ih,{placeholder:"Conte como foi sua experincia...",className:"resize-none",...P})}),c.jsx(OS,{})]})})]}),n&&c.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-muted/50",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Bc,{className:"w-5 h-5 text-primary"}),c.jsx("span",{className:"font-medium",children:a||"Entregador"})]}),c.jsx(DC,{control:T.control,name:"driverRating",render:({field:P,fieldState:k})=>c.jsxs(NS,{children:[c.jsx(IS,{children:"Avaliao da entrega *"}),c.jsx(kS,{children:c.jsxs("div",{children:[c.jsx(gI,{rating:P.value||0,interactive:!0,size:"lg",onRatingChange:P.onChange}),(P.value===0||!P.value)&&k.error&&c.jsx("p",{className:"text-sm text-destructive mt-2",children:"Toque nas estrelas para avaliar"})]})}),c.jsx(OS,{})]})}),c.jsx(DC,{control:T.control,name:"driverComment",render:({field:P})=>c.jsxs(NS,{children:[c.jsx(IS,{children:"Comentrio (opcional)"}),c.jsx(kS,{children:c.jsx(Ih,{placeholder:"Como foi a entrega...",className:"resize-none",...P})}),c.jsx(OS,{})]})})]}),c.jsx(Ft,{type:"submit",className:"w-full",disabled:p,children:p?c.jsxs(c.Fragment,{children:[c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando..."]}):"Enviar Avaliao"})]})})})]},"form")})})},tit=({open:e,onOpenChange:t,orderId:r,establishmentId:n,establishmentName:a,driverId:d,driverName:p,onSuccess:s})=>c.jsx($l,{open:e,onOpenChange:t,children:c.jsxs(ul,{className:"max-w-lg",children:[c.jsx(dl,{children:c.jsx(hl,{className:"sr-only",children:"Avaliar pedido"})}),c.jsx(eit,{orderId:r,establishmentId:n,establishmentName:a,driverId:d,driverName:p,onSuccess:()=>{s==null||s(),t(!1)}})]})}),LC={pending:{label:"Aguardando confirmao",color:"bg-yellow-500",icon:ki},confirmed:{label:"Pedido confirmado",color:"bg-blue-500",icon:Da},preparing:{label:"Em preparo",color:"bg-orange-500",icon:cs},ready:{label:"Pronto para entrega",color:"bg-purple-500",icon:Bi},out_for_delivery:{label:"Saiu para entrega",color:"bg-green-500",icon:Bc},delivered:{label:"Entregue",color:"bg-green-700",icon:Da},cancelled:{label:"Cancelado",color:"bg-red-500",icon:cs}},iY=["pending","confirmed","preparing","ready","out_for_delivery","delivered"],rit=()=>{var ge,fe,be;const{orderId:e}=GI(),t=di(),{user:r,loading:n}=$i(),[a,d]=F.useState(null),[p,s]=F.useState([]),[_,b]=F.useState(null),[T,C]=F.useState(!0),[P,k]=F.useState(!1),[B,R]=F.useState("Notification"in window&&Notification.permission==="granted"),{data:D,refetch:G}=Krt(e),{requestNotificationPermission:V,initializeStatus:$}=Jrt({orderId:e||null,onStatusChange:ue=>{d(ue)}});F.useEffect(()=>{if(!n&&!r){t("/auth");return}e&&r&&K()},[e,r,n]);const K=async()=>{try{const{data:ue,error:Ce}=await dt.from("orders").select("*").eq("id",e).single();if(Ce)throw Ce;d(ue),$(ue.status);const{data:ve}=await dt.from("order_items").select("*").eq("order_id",e);if(s(ve||[]),ue.establishment_id){const{data:ze}=await dt.from("establishments").select("*").eq("id",ue.establishment_id).single();b(ze)}}catch(ue){console.error("Error fetching order:",ue)}finally{C(!1)}},Y=async()=>{await V(),R("Notification"in window&&Notification.permission==="granted")};if(n||T)return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx(Ma,{className:"w-8 h-8 animate-spin text-primary"})});if(!a)return c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx("header",{className:"sticky top-0 z-50 bg-card/95 backdrop-blur-lg border-b border-border",children:c.jsxs("div",{className:"container flex items-center gap-4 h-16",children:[c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"ghost",size:"icon",children:c.jsx(uc,{className:"w-5 h-5"})})}),c.jsx("h1",{className:"font-display font-bold text-lg",children:"Acompanhar Pedido"})]})}),c.jsxs("div",{className:"container py-20 text-center",children:[c.jsx(cs,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),c.jsx("h2",{className:"text-xl font-bold mb-2",children:"Pedido no encontrado"}),c.jsx("p",{className:"text-muted-foreground mb-4",children:"No foi possvel encontrar este pedido."}),c.jsx(Oi,{to:"/",children:c.jsx(Ft,{children:"Voltar ao incio"})})]})]});const ee=iY.indexOf(a.status);(ge=LC[a.status])!=null&&ge.icon;const ae=a.status==="out_for_delivery",ie=a.status==="delivered";return c.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[c.jsx("header",{className:"sticky top-0 z-50 bg-card/95 backdrop-blur-lg border-b border-border",children:c.jsxs("div",{className:"container flex items-center gap-4 h-16",children:[c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"ghost",size:"icon",children:c.jsx(uc,{className:"w-5 h-5"})})}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("h1",{className:"font-display font-bold text-lg",children:["Pedido #",a.order_number]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.created_at).toLocaleDateString("pt-BR")})]}),!ie&&c.jsx(Ft,{variant:"ghost",size:"icon",onClick:Y,className:B?"text-primary":"text-muted-foreground",title:B?"Notificaes ativadas":"Ativar notificaes",children:B?c.jsx(z2,{className:"w-5 h-5"}):c.jsx(Rve,{className:"w-5 h-5"})}),c.jsx(dn,{className:(fe=LC[a.status])==null?void 0:fe.color,children:(be=LC[a.status])==null?void 0:be.label})]})}),c.jsxs("div",{className:"container py-6 space-y-6",children:[ae&&c.jsx(gr.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-2",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(Bc,{className:"w-4 h-4 text-green-500"}),"Acompanhe seu entregador"]})}),c.jsx(Ut,{className:"pt-0",children:c.jsx(Pue,{orderId:a.id,deliveryLatitude:a.delivery_latitude,deliveryLongitude:a.delivery_longitude,establishmentLatitude:_!=null&&_.latitude?Number(_.latitude):void 0,establishmentLongitude:_!=null&&_.longitude?Number(_.longitude):void 0,className:"h-64 rounded-lg"})})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsx(Hr,{className:"text-base",children:"Status do Pedido"})}),c.jsx(Ut,{children:c.jsx("div",{className:"space-y-4",children:iY.slice(0,-1).map((ue,Ce)=>{const ve=Ce<=ee,ze=Ce===ee,Me=LC[ue],Be=Me.icon;return c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:`
                          w-10 h-10 rounded-full flex items-center justify-center transition-all
                          ${ve?Me.color:"bg-muted"}
                          ${ze?"ring-2 ring-offset-2 ring-primary":""}
                        `,children:c.jsx(Be,{className:`w-5 h-5 ${ve?"text-white":"text-muted-foreground"}`})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:`font-medium ${ve?"":"text-muted-foreground"}`,children:Me.label}),ze&&c.jsx("p",{className:"text-xs text-primary animate-pulse",children:"Em andamento..."})]}),ve&&!ze&&c.jsx(Da,{className:"w-5 h-5 text-green-500"})]},ue)})})})]})}),_&&c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(Bi,{className:"w-4 h-4"}),"Estabelecimento"]})}),c.jsx(Ut,{children:c.jsxs("div",{className:"flex items-center gap-3",children:[_.logo_url?c.jsx("img",{src:_.logo_url,alt:_.name,className:"w-12 h-12 rounded-lg object-cover"}):c.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:c.jsx(Bi,{className:"w-6 h-6 text-muted-foreground"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold",children:_.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:_.address})]})]})})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(zi,{className:"w-4 h-4"}),"Endereo de Entrega"]})}),c.jsx(Ut,{children:c.jsx("p",{children:a.delivery_address})})]})}),c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:c.jsxs(Vt,{children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(cs,{className:"w-4 h-4"}),"Itens do Pedido"]})}),c.jsxs(Ut,{children:[c.jsx("div",{className:"space-y-2",children:p.map(ue=>c.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-border last:border-0",children:[c.jsxs("span",{children:[ue.quantity,"x ",ue.product_name]}),c.jsxs("span",{className:"font-medium",children:["R$ ",ue.subtotal.toFixed(2)]})]},ue.id))}),c.jsxs("div",{className:"mt-4 pt-4 border-t border-border space-y-2",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:"Subtotal"}),c.jsxs("span",{children:["R$ ",a.subtotal.toFixed(2)]})]}),c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{children:"Taxa de entrega"}),c.jsxs("span",{children:["R$ ",a.delivery_fee.toFixed(2)]})]}),c.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[c.jsx("span",{children:"Total"}),c.jsxs("span",{children:["R$ ",a.total.toFixed(2)]})]})]})]})]})}),ie&&c.jsx(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:c.jsxs(Vt,{className:"border-primary/20",children:[c.jsx(Wr,{className:"pb-3",children:c.jsxs(Hr,{className:"text-base flex items-center gap-2",children:[c.jsx(Mc,{className:"w-4 h-4 text-yellow-500"}),"Avaliao"]})}),c.jsx(Ut,{children:D?c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Estabelecimento"}),c.jsx(gI,{rating:D.establishment_rating||0,size:"sm"})]}),D.establishment_comment&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:['"',D.establishment_comment,'"']}),D.driver_rating&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Entregador"}),c.jsx(gI,{rating:D.driver_rating,size:"sm"})]}),D.driver_comment&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:['"',D.driver_comment,'"']})]})]}):c.jsxs("div",{className:"text-center py-4",children:[c.jsx("p",{className:"text-muted-foreground mb-4",children:"Seu pedido foi entregue! Que tal avaliar?"}),c.jsxs(Ft,{onClick:()=>k(!0),children:[c.jsx(Mc,{className:"w-4 h-4 mr-2"}),"Avaliar Pedido"]})]})})]})})]}),_&&c.jsx(tit,{open:P,onOpenChange:k,orderId:a.id,establishmentId:_.id,establishmentName:_.name,driverId:a.driver_id,onSuccess:()=>{k(!1),G()}})]})},nit=()=>{const[e,t]=F.useState(null),[r,n]=F.useState(!1),[a,d]=F.useState(!1),[p,s]=F.useState(!1);return F.useEffect(()=>{const b=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0;d(b);const T=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;s(T);const C=k=>{k.preventDefault(),t(k),n(!0)},P=()=>{d(!0),n(!1),t(null)};return window.addEventListener("beforeinstallprompt",C),window.addEventListener("appinstalled",P),()=>{window.removeEventListener("beforeinstallprompt",C),window.removeEventListener("appinstalled",P)}},[]),{isInstallable:r,isInstalled:a,isIOS:p,promptInstall:async()=>{if(!e)return!1;try{await e.prompt();const{outcome:b}=await e.userChoice;return b==="accepted"&&(d(!0),n(!1)),t(null),b==="accepted"}catch(b){return console.error("Error prompting install:",b),!1}}}},iit=()=>{const{isInstallable:e,isInstalled:t,isIOS:r,promptInstall:n}=nit(),a=async()=>{await n()&&console.log("App installed successfully")};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-orange-100",children:[c.jsx("header",{className:"p-4 text-center",children:c.jsx(Oi,{to:"/",className:"inline-block",children:c.jsx("img",{src:wv,alt:"Vai J Delivery",className:"h-20 w-auto object-contain mx-auto animate-logo-pulse"})})}),c.jsxs("main",{className:"container max-w-2xl mx-auto px-4 py-8",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("div",{className:"w-24 h-24 bg-orange-500 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:c.jsx(f_e,{className:"w-12 h-12 text-white"})}),c.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Instale o Vai J"}),c.jsx("p",{className:"text-gray-600 text-lg",children:"Tenha acesso rpido ao app direto da tela inicial do seu celular"})]}),t?c.jsx(Vt,{className:"mb-8 border-green-200 bg-green-50",children:c.jsxs(Ut,{className:"flex items-center gap-4 p-6",children:[c.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center",children:c.jsx(w0,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-green-800",children:"App j instalado!"}),c.jsx("p",{className:"text-green-600 text-sm",children:"O Vai J est pronto para uso na sua tela inicial"})]})]})}):e?c.jsx(Vt,{className:"mb-8 border-orange-200",children:c.jsxs(Ut,{className:"p-6 text-center",children:[c.jsxs(Ft,{onClick:a,size:"lg",className:"w-full bg-orange-500 hover:bg-orange-600 text-white text-lg py-6",children:[c.jsx(qve,{className:"w-5 h-5 mr-2"}),"Instalar Agora"]}),c.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Sem custo e sem usar espao da loja de apps"})]})}):r?c.jsxs(Vt,{className:"mb-8 border-orange-200",children:[c.jsxs(Wr,{children:[c.jsx(Hr,{className:"text-lg",children:"Como instalar no iPhone/iPad"}),c.jsx(zo,{children:"Siga os passos abaixo para adicionar  tela inicial"})]}),c.jsxs(Ut,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center shrink-0",children:c.jsx(c_e,{className:"w-5 h-5 text-orange-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"1. Toque em Compartilhar"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Clique no cone de compartilhar no Safari"})]})]}),c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center shrink-0",children:c.jsx(dc,{className:"w-5 h-5 text-orange-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"2. Adicionar  Tela de Incio"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Role para baixo e selecione esta opo"})]})]}),c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center shrink-0",children:c.jsx(w0,{className:"w-5 h-5 text-orange-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"3. Confirmar"}),c.jsx("p",{className:"text-sm text-gray-500",children:'Toque em "Adicionar" no canto superior direito'})]})]})]})]}):c.jsx(Vt,{className:"mb-8 border-gray-200",children:c.jsx(Ut,{className:"p-6 text-center",children:c.jsx("p",{className:"text-gray-600",children:"Acesse este site pelo navegador do seu celular para instalar o app"})})}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h2",{className:"text-xl font-semibold text-center mb-6",children:"Um app para cada necessidade"}),c.jsx(Vt,{children:c.jsxs(Ut,{className:"flex items-center gap-4 p-4",children:[c.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:c.jsx(xh,{className:"w-6 h-6 text-orange-600"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:"Para Clientes"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Pea comida e acompanhe em tempo real"})]})]})}),c.jsx(Vt,{children:c.jsxs(Ut,{className:"flex items-center gap-4 p-4",children:[c.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:c.jsx(Bc,{className:"w-6 h-6 text-green-600"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:"Para Entregadores"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Receba pedidos e navegue at o destino"})]})]})}),c.jsx(Vt,{children:c.jsxs(Ut,{className:"flex items-center gap-4 p-4",children:[c.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:c.jsx(nee,{className:"w-6 h-6 text-amber-600"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:"Para Estabelecimentos"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Gerencie pedidos e cardpio facilmente"})]})]})})]}),c.jsxs("div",{className:"mt-8 grid grid-cols-2 gap-4 text-center",children:[c.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm",children:[c.jsx("p",{className:"text-2xl font-bold text-orange-500",children:"100%"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Gratuito"})]}),c.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm",children:[c.jsx("p",{className:"text-2xl font-bold text-orange-500",children:"0 MB"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Na loja de apps"})]}),c.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm",children:[c.jsx("p",{className:"text-2xl font-bold text-orange-500",children:"Offline"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Funciona sem internet"})]}),c.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-sm",children:[c.jsx("p",{className:"text-2xl font-bold text-orange-500",children:"Rpido"}),c.jsx("p",{className:"text-sm text-gray-500",children:"Carrega instantneo"})]})]}),c.jsx("div",{className:"text-center mt-8",children:c.jsx(Oi,{to:"/",className:"text-orange-600 hover:underline",children:" Voltar para o site"})})]})]})},sit=()=>{const e=qf();return F.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),c.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),c.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),c.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},ait=()=>c.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[c.jsx(Ph,{}),c.jsx("main",{className:"flex-1 container py-8",children:c.jsxs("div",{className:"max-w-3xl mx-auto",children:[c.jsx("h1",{className:"text-3xl font-display font-bold mb-6",children:"Termos de Uso"}),c.jsxs("div",{className:"prose prose-sm max-w-none space-y-6 text-muted-foreground",children:[c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"1. Aceitao dos Termos"}),c.jsx("p",{children:"Ao acessar e utilizar a plataforma Vai J Delivery, voc concorda em cumprir e estar vinculado aos presentes Termos de Uso. Se voc no concordar com qualquer parte destes termos, no dever utilizar nossos servios."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"2. Descrio do Servio"}),c.jsx("p",{children:"O Vai J Delivery  uma plataforma que conecta usurios a estabelecimentos comerciais, facilitando a realizao de pedidos e entregas. Atuamos como intermedirios entre consumidores, estabelecimentos parceiros e entregadores."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"3. Cadastro e Conta"}),c.jsx("p",{children:"Para utilizar nossos servios, voc deve criar uma conta fornecendo informaes precisas e atualizadas. Voc  responsvel por manter a confidencialidade de suas credenciais de acesso e por todas as atividades realizadas em sua conta."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"4. Uso da Plataforma"}),c.jsx("p",{children:"Ao utilizar nossa plataforma, voc concorda em:"}),c.jsxs("ul",{className:"list-disc pl-6 mt-2 space-y-1",children:[c.jsx("li",{children:"Fornecer informaes verdadeiras e precisas"}),c.jsx("li",{children:"No utilizar o servio para fins ilegais"}),c.jsx("li",{children:"No interferir no funcionamento da plataforma"}),c.jsx("li",{children:"Respeitar os direitos de outros usurios"}),c.jsx("li",{children:"Manter suas informaes de contato atualizadas"})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"5. Pedidos e Pagamentos"}),c.jsx("p",{children:"Os preos dos produtos so definidos pelos estabelecimentos parceiros. O Vai J Delivery no se responsabiliza por alteraes de preos ou disponibilidade de produtos. Os pagamentos so processados de forma segura atravs de nossos parceiros de pagamento."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"6. Entregas"}),c.jsx("p",{children:"Os prazos de entrega so estimativas e podem variar conforme demanda, condies climticas e trnsito. No nos responsabilizamos por atrasos causados por fatores externos ao nosso controle."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"7. Cancelamentos e Reembolsos"}),c.jsx("p",{children:"Pedidos podem ser cancelados antes do incio da preparao. Aps este momento, o cancelamento est sujeito s polticas do estabelecimento. Reembolsos sero processados conforme o mtodo de pagamento utilizado."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"8. Limitao de Responsabilidade"}),c.jsx("p",{children:"O Vai J Delivery no se responsabiliza pela qualidade dos produtos fornecidos pelos estabelecimentos parceiros. Problemas com produtos devem ser reportados diretamente atravs da plataforma para anlise."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"9. Modificaes dos Termos"}),c.jsx("p",{children:"Reservamo-nos o direito de modificar estes termos a qualquer momento. As alteraes entraro em vigor imediatamente aps sua publicao na plataforma. O uso continuado dos servios aps tais alteraes constitui aceitao dos novos termos."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"10. Contato"}),c.jsx("p",{children:"Para dvidas sobre estes Termos de Uso, entre em contato conosco atravs do WhatsApp (79) 98832-0546 ou pelo e-mail vaijadeliveryoficial@gmail.com."})]}),c.jsx("p",{className:"text-sm text-muted-foreground pt-4 border-t",children:"ltima atualizao: Fevereiro de 2025"})]})]})}),c.jsx(Nh,{})]}),oit=()=>c.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[c.jsx(Ph,{}),c.jsx("main",{className:"flex-1 container py-8",children:c.jsxs("div",{className:"max-w-3xl mx-auto",children:[c.jsx("h1",{className:"text-3xl font-display font-bold mb-6",children:"Poltica de Privacidade"}),c.jsxs("div",{className:"prose prose-sm max-w-none space-y-6 text-muted-foreground",children:[c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"1. Introduo"}),c.jsx("p",{children:"A sua privacidade  importante para ns. Esta Poltica de Privacidade descreve como o Vai J Delivery coleta, usa, armazena e protege suas informaes pessoais quando voc utiliza nossa plataforma e servios."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"2. Informaes que Coletamos"}),c.jsx("p",{children:"Podemos coletar as seguintes informaes:"}),c.jsxs("ul",{className:"list-disc pl-6 mt-2 space-y-1",children:[c.jsxs("li",{children:[c.jsx("strong",{children:"Dados de identificao:"})," nome completo, CPF, e-mail e telefone"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Dados de localizao:"})," endereo de entrega e coordenadas GPS (quando autorizado)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Dados de pagamento:"})," informaes necessrias para processar transaes"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Dados de uso:"})," histrico de pedidos, preferncias e interaes com a plataforma"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Dados do dispositivo:"})," modelo, sistema operacional e identificadores nicos"]})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"3. Como Usamos suas Informaes"}),c.jsx("p",{children:"Utilizamos suas informaes para:"}),c.jsxs("ul",{className:"list-disc pl-6 mt-2 space-y-1",children:[c.jsx("li",{children:"Processar e entregar seus pedidos"}),c.jsx("li",{children:"Comunicar sobre status de pedidos e atualizaes"}),c.jsx("li",{children:"Melhorar nossos servios e experincia do usurio"}),c.jsx("li",{children:"Personalizar recomendaes e ofertas"}),c.jsx("li",{children:"Prevenir fraudes e garantir a segurana da plataforma"}),c.jsx("li",{children:"Cumprir obrigaes legais e regulatrias"})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"4. Compartilhamento de Dados"}),c.jsx("p",{children:"Podemos compartilhar suas informaes com:"}),c.jsxs("ul",{className:"list-disc pl-6 mt-2 space-y-1",children:[c.jsxs("li",{children:[c.jsx("strong",{children:"Estabelecimentos parceiros:"})," para preparao e entrega de pedidos"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Entregadores:"})," para realizao das entregas"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Processadores de pagamento:"})," para efetuar transaes financeiras"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"Autoridades:"})," quando exigido por lei ou ordem judicial"]})]}),c.jsx("p",{className:"mt-2",children:"No vendemos suas informaes pessoais a terceiros."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"5. Segurana dos Dados"}),c.jsx("p",{children:"Implementamos medidas tcnicas e organizacionais apropriadas para proteger suas informaes contra acesso no autorizado, alterao, divulgao ou destruio. Isso inclui criptografia de dados, controles de acesso e monitoramento contnuo de segurana."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"6. Seus Direitos (LGPD)"}),c.jsx("p",{children:"De acordo com a Lei Geral de Proteo de Dados (LGPD), voc tem direito a:"}),c.jsxs("ul",{className:"list-disc pl-6 mt-2 space-y-1",children:[c.jsx("li",{children:"Confirmar a existncia de tratamento de seus dados"}),c.jsx("li",{children:"Acessar seus dados pessoais"}),c.jsx("li",{children:"Corrigir dados incompletos ou desatualizados"}),c.jsx("li",{children:"Solicitar a excluso de dados desnecessrios"}),c.jsx("li",{children:"Solicitar a portabilidade dos dados"}),c.jsx("li",{children:"Revogar consentimento a qualquer momento"})]})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"7. Cookies e Tecnologias"}),c.jsx("p",{children:"Utilizamos cookies e tecnologias similares para melhorar sua experincia, analisar o uso da plataforma e personalizar contedo. Voc pode gerenciar suas preferncias de cookies atravs das configuraes do seu navegador."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"8. Reteno de Dados"}),c.jsx("p",{children:"Mantemos suas informaes pelo tempo necessrio para fornecer nossos servios e cumprir obrigaes legais. Aps este perodo, os dados sero excludos ou anonimizados de forma segura."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"9. Alteraes nesta Poltica"}),c.jsx("p",{children:"Podemos atualizar esta Poltica de Privacidade periodicamente. Notificaremos sobre mudanas significativas atravs da plataforma ou por e-mail. Recomendamos que voc revise esta poltica regularmente."})]}),c.jsxs("section",{children:[c.jsx("h2",{className:"text-xl font-semibold text-foreground mb-3",children:"10. Contato"}),c.jsx("p",{children:"Para exercer seus direitos ou esclarecer dvidas sobre esta Poltica de Privacidade, entre em contato conosco:"}),c.jsxs("ul",{className:"list-none mt-2 space-y-1",children:[c.jsxs("li",{children:[c.jsx("strong",{children:"WhatsApp:"})," (79) 98832-0546"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"E-mail:"})," vaijadeliveryoficial@gmail.com"]})]})]}),c.jsx("p",{className:"text-sm text-muted-foreground pt-4 border-t",children:"ltima atualizao: Fevereiro de 2025"})]})]})}),c.jsx(Nh,{})]}),lit=()=>c.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[c.jsx(Ph,{}),c.jsxs("main",{className:"flex-1",children:[c.jsx("section",{className:"bg-gradient-to-br from-primary/10 via-background to-secondary/20 py-16",children:c.jsx("div",{className:"container",children:c.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[c.jsxs("h1",{className:"text-4xl md:text-5xl font-display font-bold mb-6",children:["Sobre o ",c.jsx("span",{className:"text-primary",children:"Vai J Delivery"})]}),c.jsx("p",{className:"text-lg text-muted-foreground",children:"Conectando voc aos melhores estabelecimentos da sua cidade com rapidez, qualidade e a convenincia que voc merece."})]})})}),c.jsx("section",{className:"py-16 container",children:c.jsxs("div",{className:"max-w-3xl mx-auto",children:[c.jsx("h2",{className:"text-2xl font-display font-bold mb-6 text-center",children:"Nossa Histria"}),c.jsxs("div",{className:"prose prose-sm max-w-none text-muted-foreground space-y-4",children:[c.jsx("p",{children:"O Vai J Delivery nasceu da vontade de transformar a forma como as pessoas pedem delivery em suas cidades. Percebemos que havia uma lacuna entre os consumidores e os estabelecimentos locais, e decidimos criar uma ponte que beneficiasse a todos."}),c.jsx("p",{children:"Nossa misso  simples: entregar felicidade na porta da sua casa. Seja aquela pizza quentinha no domingo  noite, o almoo no escritrio ou aquele lanche especial, estamos aqui para tornar sua experincia mais prtica e saborosa."}),c.jsx("p",{children:"Trabalhamos incansavelmente para apoiar os negcios locais, criar oportunidades para entregadores e oferecer aos nossos clientes a melhor experincia de delivery possvel."})]})]})}),c.jsx("section",{className:"py-16 bg-secondary/30",children:c.jsxs("div",{className:"container",children:[c.jsx("h2",{className:"text-2xl font-display font-bold mb-10 text-center",children:"Nossos Valores"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto",children:[c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(j0,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Rapidez"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Entregamos seu pedido com agilidade, respeitando seu tempo e garantindo que sua comida chegue sempre fresca."})]}),c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(Kve,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Qualidade"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecionamos cuidadosamente nossos parceiros para garantir que voc receba sempre o melhor."})]}),c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(Rf,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Comunidade"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Valorizamos os negcios locais e criamos oportunidades de renda para entregadores da regio."})]}),c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(rv,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Segurana"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Seus dados e pagamentos so protegidos com as melhores prticas de segurana do mercado."})]}),c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(zi,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Cobertura"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Expandindo constantemente para levar nosso servio a mais bairros e cidades."})]}),c.jsxs("div",{className:"bg-background rounded-xl p-6 shadow-sm",children:[c.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:c.jsx(ki,{className:"w-6 h-6 text-primary"})}),c.jsx("h3",{className:"font-semibold mb-2",children:"Disponibilidade"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Estamos prontos para atender voc nos horrios que mais precisa, inclusive aos finais de semana."})]})]})]})}),c.jsx("section",{className:"py-16 container",children:c.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[c.jsx("h2",{className:"text-2xl font-display font-bold mb-4",children:"Faa parte dessa histria"}),c.jsx("p",{className:"text-muted-foreground mb-8",children:"Seja como cliente, estabelecimento parceiro ou entregador, voc  parte fundamental do nosso sucesso. Juntos, estamos revolucionando o delivery local."}),c.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:c.jsx("a",{href:"https://wa.me/5579988320546",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center rounded-lg bg-primary px-6 py-3 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",children:"Fale Conosco"})})]})})]}),c.jsx(Nh,{})]}),cit={pending:{title:"Pedido Recebido",body:"Seu pedido foi recebido e est aguardando confirmao.",icon:""},confirmed:{title:"Pedido Confirmado! ",body:"timo! O estabelecimento confirmou seu pedido.",icon:""},preparing:{title:"Em Preparo! ",body:"Seu pedido est sendo preparado com carinho.",icon:""},ready:{title:"Pedido Pronto! ",body:"Seu pedido est pronto e aguardando o entregador.",icon:""},out_for_delivery:{title:"Saiu para Entrega! ",body:"Seu pedido est a caminho! Acompanhe no mapa.",icon:""},delivered:{title:"Entregue! ",body:"Seu pedido foi entregue. Bom apetite!",icon:""},cancelled:{title:"Pedido Cancelado",body:"Infelizmente seu pedido foi cancelado.",icon:""}},uit=()=>{const{user:e}=$i(),t=di(),r=F.useRef(new Map),n=F.useRef(!1),a=F.useCallback(()=>{try{const p=new(window.AudioContext||window.webkitAudioContext),s=p.createOscillator(),_=p.createGain();s.connect(_),_.connect(p.destination),s.frequency.value=587.33,s.type="sine",_.gain.setValueAtTime(.3,p.currentTime),_.gain.exponentialRampToValueAtTime(.01,p.currentTime+.3),s.start(p.currentTime),s.stop(p.currentTime+.3),setTimeout(()=>{const b=p.createOscillator(),T=p.createGain();b.connect(T),T.connect(p.destination),b.frequency.value=880,b.type="sine",T.gain.setValueAtTime(.3,p.currentTime),T.gain.exponentialRampToValueAtTime(.01,p.currentTime+.4),b.start(p.currentTime),b.stop(p.currentTime+.4)},150)}catch{console.log("Audio notification not supported")}},[]),d=F.useCallback(p=>{const s=cit[p.status];if(!s)return;if(a(),(p.status==="cancelled"?gt.error:gt.success)(c.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>t(`/pedido/${p.id}`),children:[c.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-primary rounded-full flex items-center justify-center",children:c.jsx("span",{className:"text-lg",children:s.icon})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold text-base",children:s.title}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",p.order_number,"  Clique para ver"]})]})]}),{duration:1e4,position:"top-center",className:"border-2 border-primary bg-card shadow-lg cursor-pointer"}),"Notification"in window&&Notification.permission==="granted"){const b=new Notification(s.title,{body:`${s.body}
Pedido #${p.order_number}`,icon:"/pwa-192x192.png",tag:`order-${p.id}-${p.status}`,requireInteraction:p.status==="out_for_delivery"});b.onclick=()=>{window.focus(),t(`/pedido/${p.id}`),b.close()}}},[a,t]);return F.useEffect(()=>{if(!e)return;(async()=>{const{data:_}=await dt.from("orders").select("id, status").eq("customer_id",e.id).not("status","in",'("delivered","cancelled")');_&&_.forEach(b=>{r.current.set(b.id,b.status)}),n.current=!0})();const s=dt.channel(`global-orders-${e.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`customer_id=eq.${e.id}`},_=>{const b=_.new,T=r.current.get(b.id);n.current&&T&&T!==b.status&&d(b),b.status==="delivered"||b.status==="cancelled"?r.current.delete(b.id):r.current.set(b.id,b.status)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"orders",filter:`customer_id=eq.${e.id}`},_=>{const b=_.new;r.current.set(b.id,b.status)}).subscribe();return"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),()=>{dt.removeChannel(s)}},[e,d]),null},dit=()=>(uit(),null),hit={monday:"Segunda",tuesday:"Tera",wednesday:"Quarta",thursday:"Quinta",friday:"Sexta",saturday:"Sbado",sunday:"Domingo"},fit=()=>{const{id:e}=GI(),{addItem:t,items:r,total:n}=WI(),[a,d]=F.useState(null),[p,s]=F.useState([]),[_,b]=F.useState([]),[T,C]=F.useState(null),[P,k]=F.useState(!0),[B,R]=F.useState(!1),D=r.reduce((fe,be)=>fe+be.quantity,0);F.useEffect(()=>{e&&(G(),V(),$())},[e]);const G=async()=>{try{const{data:fe,error:be}=await dt.from("establishments").select("*").eq("id",e).maybeSingle();if(be)throw be;d(fe)}catch(fe){console.error("Erro ao carregar estabelecimento:",fe)}finally{k(!1)}},V=async()=>{try{const{data:fe,error:be}=await dt.from("products").select("*").eq("establishment_id",e).eq("is_available",!0).order("sort_order");if(be)throw be;s(fe||[])}catch(fe){console.error("Erro ao carregar produtos:",fe)}},$=async()=>{try{const{data:fe,error:be}=await dt.from("product_categories").select("*").eq("establishment_id",e).eq("is_active",!0).order("sort_order");if(be)throw be;b(fe||[]),fe&&fe.length>0&&C(fe[0].id)}catch(fe){console.error("Erro ao carregar categorias:",fe)}},K=fe=>{if(r.length>0&&r.some(ue=>ue.establishmentId!==e)){gt.error("Voc j possui itens de outro restaurante no carrinho. Limpe o carrinho para adicionar itens deste restaurante.",{position:"bottom-center",duration:4e3});return}t({id:fe.id,name:fe.name,price:Number(fe.price),image:fe.image_url||"",establishmentId:e}),gt.success(`${fe.name} adicionado ao carrinho!`,{position:"bottom-center"})},Y=()=>a!=null&&a.opening_hours?a.opening_hours:null,ee=()=>{const fe=Y();if(!fe)return null;const ue=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],Ce=fe[ue];return!Ce||!Ce.isOpen?{isOpen:!1,text:"Fechado hoje"}:{isOpen:!0,text:`${Ce.openTime} - ${Ce.closeTime}`}},ae=T?p.filter(fe=>fe.category_id===T):p;if(P)return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-primary"})});if(!a)return c.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background gap-4",children:[c.jsx(Bi,{className:"w-16 h-16 text-muted-foreground"}),c.jsx("h1",{className:"text-xl font-semibold",children:"Estabelecimento no encontrado"}),c.jsx(Oi,{to:"/",children:c.jsx(Ft,{children:"Voltar para incio"})})]});const ie=ee(),ge=Y();return c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsxs("div",{className:"relative h-48 md:h-64",children:[a.cover_url?c.jsx("img",{src:a.cover_url,alt:a.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 to-primary/5"}),c.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-foreground/60 to-transparent"}),c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"secondary",size:"icon",className:"absolute top-4 left-4 rounded-full bg-card/90 backdrop-blur-sm",children:c.jsx(uc,{className:"w-5 h-5"})})})]}),c.jsxs("div",{className:"container relative -mt-16",children:[c.jsxs(gr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-2xl shadow-card p-6",children:[c.jsxs("div",{className:"flex gap-4",children:[a.logo_url?c.jsx("img",{src:a.logo_url,alt:a.name,className:"w-20 h-20 rounded-xl object-cover shadow-soft"}):c.jsx("div",{className:"w-20 h-20 rounded-xl bg-muted flex items-center justify-center shadow-soft",children:c.jsx(Bi,{className:"w-8 h-8 text-muted-foreground"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h1",{className:"font-display text-xl md:text-2xl font-bold mb-1",children:a.name}),c.jsx("p",{className:"text-sm text-muted-foreground mb-2 capitalize",children:a.category}),c.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Mc,{className:"w-4 h-4 fill-warning text-warning"}),c.jsx("span",{className:"font-semibold",children:a.rating||0}),c.jsxs("span",{className:"text-muted-foreground",children:["(",a.total_reviews||0,")"]})]}),c.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[c.jsx(ki,{className:"w-4 h-4"}),c.jsxs("span",{children:[a.min_delivery_time,"-",a.max_delivery_time," min"]})]}),c.jsxs("div",{className:"flex items-center gap-1 text-success",children:[c.jsx(Bc,{className:"w-4 h-4"}),c.jsx("span",{className:"font-medium",children:Number(a.delivery_fee)===0?"Grtis":`R$ ${Number(a.delivery_fee).toFixed(2).replace(".",",")}`})]})]})]})]}),a.description&&c.jsxs("div",{className:"flex items-center gap-2 mt-4 p-3 rounded-xl bg-accent/50",children:[c.jsx(Jve,{className:"w-4 h-4 text-accent-foreground shrink-0"}),c.jsx("p",{className:"text-sm text-accent-foreground",children:a.description})]}),ge&&c.jsxs("div",{className:"mt-4",children:[c.jsxs("button",{onClick:()=>R(!B),className:"flex items-center gap-2 text-sm font-medium text-primary hover:underline",children:[c.jsx(ki,{className:"w-4 h-4"}),c.jsxs("span",{children:[ie!=null&&ie.isOpen?"Aberto":"Fechado",(ie==null?void 0:ie.text)&&`  ${ie.text}`]}),c.jsx("span",{className:"text-muted-foreground",children:B?"":""})]}),c.jsx(ju,{children:B&&c.jsx(gr.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:c.jsx("div",{className:"mt-3 p-3 bg-muted/50 rounded-lg space-y-1",children:Object.entries(hit).map(([fe,be])=>{const ue=ge[fe];return c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:be}),c.jsx("span",{className:ue!=null&&ue.isOpen?"":"text-muted-foreground",children:ue!=null&&ue.isOpen?`${ue.openTime} - ${ue.closeTime}`:"Fechado"})]},fe)})})})})]}),(a.address||a.neighborhood)&&c.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-muted-foreground",children:[c.jsx(zi,{className:"w-4 h-4"}),c.jsxs("span",{children:[a.address,a.address&&a.neighborhood&&", ",a.neighborhood,a.city&&` - ${a.city}`]})]})]}),_.length>0&&c.jsx("div",{className:"sticky top-16 z-40 bg-background py-4 -mx-4 px-4 md:mx-0 md:px-0",children:c.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:_.map(fe=>c.jsx("button",{onClick:()=>C(fe.id),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${T===fe.id?"gradient-primary text-primary-foreground shadow-glow":"bg-muted text-muted-foreground hover:bg-accent"}`,children:fe.name},fe.id))})}),c.jsx("div",{className:"py-4 space-y-4 pb-32",children:ae.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Bi,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"Nenhum produto disponvel no momento"})]}):ae.map((fe,be)=>c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:be*.05},className:"flex gap-4 p-4 bg-card rounded-xl shadow-soft hover:shadow-card transition-shadow",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("h3",{className:"font-semibold",children:fe.name}),fe.is_featured&&c.jsx("span",{className:"px-2 py-0.5 text-[10px] font-bold gradient-primary text-primary-foreground rounded-full",children:"TOP"})]}),fe.description&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:fe.description}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[fe.original_price&&Number(fe.original_price)>Number(fe.price)&&c.jsxs("span",{className:"text-sm text-muted-foreground line-through",children:["R$ ",Number(fe.original_price).toFixed(2).replace(".",",")]}),c.jsxs("p",{className:"font-display font-bold text-lg text-primary",children:["R$ ",Number(fe.price).toFixed(2).replace(".",",")]})]})]}),c.jsxs("div",{className:"relative shrink-0",children:[fe.image_url?c.jsx("img",{src:fe.image_url,alt:fe.name,className:"w-24 h-24 rounded-xl object-cover"}):c.jsx("div",{className:"w-24 h-24 rounded-xl bg-muted flex items-center justify-center",children:c.jsx(Bi,{className:"w-8 h-8 text-muted-foreground"})}),c.jsx(Ft,{size:"icon",variant:"hero",className:"absolute -bottom-2 -right-2 w-8 h-8 rounded-full",onClick:()=>K(fe),children:c.jsx(dc,{className:"w-4 h-4"})})]})]},fe.id))})]}),c.jsx(ju,{children:D>0&&c.jsx(gr.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border",children:c.jsx("div",{className:"container",children:c.jsx(Oi,{to:"/cart",children:c.jsxs(Ft,{variant:"hero",size:"lg",className:"w-full justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-foreground/20 flex items-center justify-center text-sm font-bold",children:D}),c.jsx("span",{children:"Ver carrinho"})]}),c.jsxs("span",{className:"font-display font-bold",children:["R$ ",n.toFixed(2).replace(".",",")]})]})})})})})]})};var uO="Tabs",[pit]=hc(uO,[ak]),Zue=ak(),[mit,Y$]=pit(uO),Xue=F.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:a,defaultValue:d,orientation:p="horizontal",dir:s,activationMode:_="automatic",...b}=e,T=QI(s),[C,P]=kf({prop:n,onChange:a,defaultProp:d??"",caller:uO});return c.jsx(mit,{scope:r,baseId:gd(),value:C,onValueChange:P,orientation:p,dir:T,activationMode:_,children:c.jsx(vn.div,{dir:T,"data-orientation":p,...b,ref:t})})});Xue.displayName=uO;var Kue="TabsList",Yue=F.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...a}=e,d=Y$(Kue,r),p=Zue(r);return c.jsx(Iie,{asChild:!0,...p,orientation:d.orientation,dir:d.dir,loop:n,children:c.jsx(vn.div,{role:"tablist","aria-orientation":d.orientation,...a,ref:t})})});Yue.displayName=Kue;var Jue="TabsTrigger",Que=F.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:a=!1,...d}=e,p=Y$(Jue,r),s=Zue(r),_=rde(p.baseId,n),b=nde(p.baseId,n),T=n===p.value;return c.jsx(kie,{asChild:!0,...s,focusable:!a,active:T,children:c.jsx(vn.button,{type:"button",role:"tab","aria-selected":T,"aria-controls":b,"data-state":T?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:_,...d,ref:t,onMouseDown:Fr(e.onMouseDown,C=>{!a&&C.button===0&&C.ctrlKey===!1?p.onValueChange(n):C.preventDefault()}),onKeyDown:Fr(e.onKeyDown,C=>{[" ","Enter"].includes(C.key)&&p.onValueChange(n)}),onFocus:Fr(e.onFocus,()=>{const C=p.activationMode!=="manual";!T&&!a&&C&&p.onValueChange(n)})})})});Que.displayName=Jue;var ede="TabsContent",tde=F.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:a,children:d,...p}=e,s=Y$(ede,r),_=rde(s.baseId,n),b=nde(s.baseId,n),T=n===s.value,C=F.useRef(T);return F.useEffect(()=>{const P=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(P)},[]),c.jsx(Cu,{present:a||T,children:({present:P})=>c.jsx(vn.div,{"data-state":T?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":_,hidden:!P,id:b,tabIndex:0,...p,ref:t,style:{...e.style,animationDuration:C.current?"0s":void 0},children:P&&d})})});tde.displayName=ede;function rde(e,t){return`${e}-trigger-${t}`}function nde(e,t){return`${e}-content-${t}`}var git=Xue,ide=Yue,sde=Que,ade=tde;const yit=git,ode=F.forwardRef(({className:e,...t},r)=>c.jsx(ide,{ref:r,className:Dr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));ode.displayName=ide.displayName;const rB=F.forwardRef(({className:e,...t},r)=>c.jsx(sde,{ref:r,className:Dr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));rB.displayName=sde.displayName;const nB=F.forwardRef(({className:e,...t},r)=>c.jsx(ade,{ref:r,className:Dr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));nB.displayName=ade.displayName;const lde=()=>{const[e,t]=F.useState(!1),[r,n]=F.useState(null),a=F.useCallback(async(b,T)=>{t(!0),n(null);try{const{data:C,error:P}=await dt.functions.invoke("mapbox",{body:{action:b,...T}});if(P)throw P;if(!C.success)throw new Error(C.error);return C.data}catch(C){const P=C instanceof Error?C.message:"Erro desconhecido";throw n(P),C}finally{t(!1)}},[]),d=F.useCallback(async b=>a("reverse_geocode",{longitude:b.longitude,latitude:b.latitude}),[a]),p=F.useCallback(async b=>a("geocode",{address:b}),[a]),s=F.useCallback(async(b,T)=>a("calculate_route",{origin:b,destination:T}),[a]),_=F.useCallback(async(b,T,C)=>a("calculate_delivery_fee",{origin:b,destination:T,...C}),[a]);return{isLoading:e,error:r,reverseGeocode:d,geocode:p,calculateRoute:s,calculateDeliveryFee:_}},vit=({initialCoordinates:e,onLocationSelect:t,height:r="300px"})=>{const n=F.useRef(null),a=F.useRef(null),d=F.useRef(null),[p,s]=F.useState(!1),[_,b]=F.useState(null),[T,C]=F.useState(e||null),{getCurrentPosition:P,isLoading:k}=jue(),{reverseGeocode:B,isLoading:R}=lde(),D=k||R,G=e?[e.longitude,e.latitude]:[-49.2648,-25.4284],V=F.useCallback(async(ee,ae)=>{C({latitude:ae,longitude:ee});try{const ie=await B({latitude:ae,longitude:ee});ie&&t(ie)}catch(ie){console.error("Error reverse geocoding:",ie)}},[B,t]),$=F.useCallback(()=>{try{const ee=document.createElement("canvas");return!!(ee.getContext("webgl")||ee.getContext("experimental-webgl"))}catch{return!1}},[]),K=F.useCallback(async()=>{var ge;const{data:ee,error:ae}=await dt.functions.invoke("mapbox",{body:{action:"get_token"}});if(ae)throw ae;if(!(ee!=null&&ee.success))throw new Error((ee==null?void 0:ee.error)||"Falha ao obter token do mapa");const ie=(ge=ee.data)==null?void 0:ge.token;if(!ie)throw new Error("Token do mapa no retornado");return ie},[]);F.useEffect(()=>{if(!n.current||a.current)return;let ee=!1;return(async()=>{if(!$()){b("Seu navegador no suporta WebGL. Tente abrir em uma nova aba ou use outro navegador.");return}try{const ie=await K();if(ee)return;ch.accessToken=ie,a.current=new ch.Map({container:n.current,style:"mapbox://styles/mapbox/streets-v12",center:G,zoom:15}),a.current.addControl(new ch.NavigationControl,"top-right"),d.current=new ch.Marker({draggable:!0,color:"hsl(var(--primary))"}).setLngLat(G).addTo(a.current),d.current.on("dragend",()=>{const ge=d.current.getLngLat();V(ge.lng,ge.lat)}),a.current.on("click",ge=>{var ue;const{lng:fe,lat:be}=ge.lngLat;(ue=d.current)==null||ue.setLngLat([fe,be]),V(fe,be)}),a.current.on("load",()=>{s(!0)}),a.current.on("error",ge=>{console.error("Map error:",ge),b("Erro ao carregar o mapa. Verifique sua conexo e tente novamente.")})}catch(ie){console.error("Error initializing map:",ie),b("Erro ao carregar o mapa. Tente novamente em instantes.")}})(),()=>{var ie;ee=!0,(ie=a.current)==null||ie.remove(),a.current=null}},[$,G,K,V]);const Y=async()=>{var ee,ae;try{const ie=await P(),ge=[ie.longitude,ie.latitude];(ee=a.current)==null||ee.flyTo({center:ge,zoom:17}),(ae=d.current)==null||ae.setLngLat(ge),V(ie.longitude,ie.latitude),gt.success("Localizao encontrada!")}catch(ie){ie instanceof Error&&gt.error(ie.message)}};return _?c.jsxs("div",{className:"relative rounded-xl overflow-hidden border border-border bg-muted flex flex-col items-center justify-center gap-4 p-6",style:{height:r},children:[c.jsx(qS,{className:"w-12 h-12 text-muted-foreground"}),c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"font-medium text-sm mb-1",children:"Mapa indisponvel"}),c.jsx("p",{className:"text-xs text-muted-foreground max-w-[250px]",children:_})]}),c.jsxs(Ft,{type:"button",variant:"outline",size:"sm",onClick:Y,disabled:D,children:[k?c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}):c.jsx(OG,{className:"w-4 h-4 mr-2"}),"Usar minha localizao"]})]}):c.jsxs("div",{className:"relative rounded-xl overflow-hidden border border-border",children:[c.jsx("div",{ref:n,style:{height:r},className:"w-full"}),c.jsxs(Ft,{type:"button",variant:"secondary",size:"sm",className:"absolute bottom-4 left-4 shadow-lg",onClick:Y,disabled:D||!!_,children:[k?c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}):c.jsx(OG,{className:"w-4 h-4 mr-2"}),"Usar minha localizao"]}),R&&c.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center",children:c.jsxs("div",{className:"flex items-center gap-2 bg-card px-4 py-2 rounded-lg shadow-lg",children:[c.jsx(Ma,{className:"w-4 h-4 animate-spin"}),c.jsx("span",{className:"text-sm",children:"Buscando endereo..."})]})}),!p&&!_&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:c.jsx(Ma,{className:"w-8 h-8 animate-spin text-muted-foreground"})})]})},uL={baseFee:5,feePerKm:2,freeUpToKm:2},_it=()=>{const[e,t]=F.useState(!1),[r,n]=F.useState(null),[a,d]=F.useState(null),{calculateDeliveryFee:p}=lde();return{calculateFee:F.useCallback(async(_,b)=>{t(!0),n(null);try{const{data:T,error:C}=await dt.from("establishments").select("latitude, longitude, delivery_fee").eq("id",_).single();if(C)throw new Error("Estabelecimento no encontrado");if(!T.latitude||!T.longitude){const B={distanceKm:0,durationMinutes:0,fee:T.delivery_fee||uL.baseFee,breakdown:{baseFee:T.delivery_fee||uL.baseFee,feePerKm:0,freeUpToKm:0,additionalKm:0}};return d(B),B}const P={latitude:T.latitude,longitude:T.longitude},k=await p(P,b,uL);return d(k),k}catch(T){const C=T instanceof Error?T.message:"Erro ao calcular taxa";return n(C),console.error("Delivery fee calculation error:",T),null}finally{t(!1)}},[p]),isLoading:e,error:r,lastResult:a}},xit=({selectedAddress:e,onAddressChange:t})=>{const[r,n]=F.useState(!1),[a,d]=F.useState(()=>{const ve=localStorage.getItem("deliveryAddresses");return ve?JSON.parse(ve):[]}),[p,s]=F.useState(!1),[_,b]=F.useState([]),[T,C]=F.useState(!1),{selectedCityId:P,selectedCityName:k}=H2(),[B,R]=F.useState("manual"),[D,G]=F.useState(null),{calculateFee:V}=_it(),{establishmentId:$}=WI(),[K,Y]=F.useState({label:"",street:"",number:"",complement:"",neighborhoodId:"",neighborhoodName:"",type:"home"});F.useEffect(()=>{(async()=>{if(!P)return;C(!0);const{data:ze,error:Me}=await dt.from("neighborhoods").select("id, name, delivery_fee, city_id").eq("city_id",P).eq("is_active",!0).order("name");!Me&&ze&&b(ze),C(!1)})()},[P]),F.useEffect(()=>{localStorage.setItem("deliveryAddresses",JSON.stringify(a))},[a]);const ee=ve=>{switch(ve){case"home":return kG;case"work":return NG;default:return zi}},ae=F.useCallback(async ve=>{if(ve.coordinates&&$){const ze=await V($,ve.coordinates);if(ze){const Me={...ve,deliveryFee:ze.fee,distanceKm:ze.distanceKm,durationMinutes:ze.durationMinutes};t(Me),n(!1);return}}t(ve),n(!1)},[$,V,t]),ie=ve=>{if(G(ve),Y(ze=>({...ze,street:ve.street||ve.address.split(",")[0]||"",neighborhoodName:ve.neighborhood||ze.neighborhoodName})),ve.neighborhood){const ze=_.find(Me=>{var Be,Ve;return Me.name.toLowerCase().includes(((Be=ve.neighborhood)==null?void 0:Be.toLowerCase())||"")||((Ve=ve.neighborhood)==null?void 0:Ve.toLowerCase().includes(Me.name.toLowerCase()))});ze&&Y(Me=>({...Me,street:ve.street||ve.address.split(",")[0]||"",neighborhoodId:ze.id,neighborhoodName:ze.name}))}},ge=()=>{const ve=_.length>0,ze=ve?_.find(Be=>Be.id===K.neighborhoodId):null,Me=ve?ze==null?void 0:ze.name:K.neighborhoodName.trim();if(K.street&&K.number&&Me&&P){const Be={id:Date.now().toString(),label:K.label||`${K.street}, ${K.number}`,street:K.street,number:K.number,complement:K.complement||void 0,neighborhoodId:ze==null?void 0:ze.id,neighborhoodName:Me,cityId:P,cityName:k||"",deliveryFee:(ze==null?void 0:ze.delivery_fee)||0,type:K.type};be(Be)}},fe=async()=>{if(!D||!P){gt.error("Selecione um local no mapa");return}if(!K.number){gt.error("Informe o nmero do endereo");return}const ve=_.length>0,ze=ve?_.find(ot=>ot.id===K.neighborhoodId):null,Me=ve?ze==null?void 0:ze.name:(K.neighborhoodName||D.neighborhood||"").trim();if(!Me){gt.error("Informe o bairro");return}let Be=(ze==null?void 0:ze.delivery_fee)||5,Ve,We;if($&&D.coordinates){const ot=await V($,D.coordinates);ot&&(Be=ot.fee,Ve=ot.distanceKm,We=ot.durationMinutes)}const Ee={id:Date.now().toString(),label:K.label||`${D.street}, ${K.number}`,street:D.street||D.address.split(",")[0],number:K.number,complement:K.complement||void 0,neighborhoodId:ze==null?void 0:ze.id,neighborhoodName:Me,cityId:P,cityName:D.city||k||"",deliveryFee:Be,type:K.type,coordinates:D.coordinates,distanceKm:Ve,durationMinutes:We};be(Ee)},be=ve=>{d(ze=>[...ze,ve]),t(ve),ue(),n(!1),gt.success("Endereo salvo com sucesso!")},ue=()=>{Y({label:"",street:"",number:"",complement:"",neighborhoodId:"",neighborhoodName:"",type:"home"}),G(null),s(!1),R("manual")},Ce=a.filter(ve=>ve.cityId===P);return c.jsxs(c.Fragment,{children:[c.jsx(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 bg-card rounded-xl shadow-soft",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:c.jsx(zi,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Entregar em"}),e?c.jsxs("p",{className:"font-semibold text-sm",children:[e.street,", ",e.number,e.complement&&` - ${e.complement}`]}):c.jsx("p",{className:"font-semibold text-destructive",children:"Selecione um endereo"}),e&&c.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[c.jsx("span",{children:e.neighborhoodName}),e.distanceKm&&c.jsxs(c.Fragment,{children:[c.jsx("span",{children:""}),c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(RG,{className:"w-3 h-3"}),e.distanceKm.toFixed(1)," km"]})]}),c.jsx("span",{children:""}),c.jsxs("span",{className:"text-success font-medium",children:["R$ ",e.deliveryFee.toFixed(2).replace(".",",")]})]})]})]}),c.jsx(Ft,{variant:"ghost",size:"sm",className:"text-primary",onClick:()=>n(!0),children:e?"Alterar":"Selecionar"})]})}),c.jsx($l,{open:r,onOpenChange:ve=>{n(ve),ve||ue()},children:c.jsxs(ul,{className:"sm:max-w-lg bg-card max-h-[90vh] overflow-y-auto",children:[c.jsx(dl,{children:c.jsx(hl,{className:"font-display",children:p?"Novo Endereo":"Onde voc quer receber?"})}),c.jsx(ju,{mode:"wait",children:p?c.jsxs(gr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[c.jsxs(yit,{value:B,onValueChange:ve=>R(ve),children:[c.jsxs(ode,{className:"grid w-full grid-cols-2",children:[c.jsxs(rB,{value:"manual",className:"gap-2",children:[c.jsx(zi,{className:"w-4 h-4"}),"Manual"]}),c.jsxs(rB,{value:"map",className:"gap-2",children:[c.jsx(e_e,{className:"w-4 h-4"}),"No mapa"]})]}),c.jsxs(nB,{value:"map",className:"space-y-4 mt-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs(zt,{className:"flex items-center gap-2",children:[c.jsx(T0,{className:"w-4 h-4"}),"Arraste o pino ou clique no mapa"]}),c.jsx(vit,{onLocationSelect:ie,height:"250px"})]}),D&&c.jsxs("div",{className:"p-3 bg-accent/50 rounded-lg text-sm",children:[c.jsx("p",{className:"font-medium",children:D.address}),D.neighborhood&&c.jsxs("p",{className:"text-muted-foreground",children:["Detectado: ",D.neighborhood]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"neighborhood-map",children:"Bairro *"}),T?c.jsx("div",{className:"p-3 rounded-lg bg-muted text-sm text-muted-foreground",children:"Carregando bairros..."}):_.length>0?c.jsxs(ns,{value:K.neighborhoodId,onValueChange:ve=>Y({...K,neighborhoodId:ve,neighborhoodName:""}),children:[c.jsx(Ji,{className:"bg-background",children:c.jsx(is,{placeholder:"Selecione o bairro"})}),c.jsxs(Qi,{className:"bg-popover border border-border z-50 max-h-[200px]",children:[(D==null?void 0:D.neighborhood)&&(()=>{const ve=_.find(ze=>{var Me,Be;return ze.name.toLowerCase().includes(((Me=D.neighborhood)==null?void 0:Me.toLowerCase())||"")||((Be=D.neighborhood)==null?void 0:Be.toLowerCase().includes(ze.name.toLowerCase()))});return ve?c.jsxs(sn,{value:ve.id,className:"bg-primary/10 font-medium",children:[" ",ve.name," (Sugerido)"]},`suggested-${ve.id}`):null})(),_.filter(ve=>{var ze,Me;return D!=null&&D.neighborhood?!(ve.name.toLowerCase().includes(((ze=D.neighborhood)==null?void 0:ze.toLowerCase())||"")||((Me=D.neighborhood)==null?void 0:Me.toLowerCase().includes(ve.name.toLowerCase()))):!0}).map(ve=>c.jsxs(sn,{value:ve.id,children:[ve.name," - R$ ",(ve.delivery_fee||0).toFixed(2).replace(".",",")]},ve.id))]})]}):c.jsx(ar,{id:"neighborhood-map",placeholder:D!=null&&D.neighborhood?D.neighborhood:"Ex: Centro",value:K.neighborhoodName,onChange:ve=>Y({...K,neighborhoodName:ve.target.value,neighborhoodId:""})}),(D==null?void 0:D.neighborhood)&&_.length>0&&!_.some(ve=>{var ze,Me;return ve.name.toLowerCase().includes(((ze=D.neighborhood)==null?void 0:ze.toLowerCase())||"")||((Me=D.neighborhood)==null?void 0:Me.toLowerCase().includes(ve.name.toLowerCase()))})&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:['Bairro "',D.neighborhood,'" no encontrado. Selecione o mais prximo.']}),!T&&_.length===0&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"No h bairros cadastrados para esta cidade  voc pode digitar o bairro."})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"number-map",children:"Nmero *"}),c.jsx(ar,{id:"number-map",placeholder:"123",value:K.number,onChange:ve=>Y({...K,number:ve.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"complement-map",children:"Complemento"}),c.jsx(ar,{id:"complement-map",placeholder:"Apto, Bloco...",value:K.complement,onChange:ve=>Y({...K,complement:ve.target.value})})]})]})]}),c.jsxs(nB,{value:"manual",className:"space-y-4 mt-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Cidade"}),c.jsx("div",{className:"p-3 rounded-lg bg-muted text-sm",children:k||"Nenhuma cidade selecionada"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"neighborhood",children:"Bairro *"}),T?c.jsx("div",{className:"p-3 rounded-lg bg-muted text-sm text-muted-foreground",children:"Carregando bairros..."}):_.length>0?c.jsxs(ns,{value:K.neighborhoodId,onValueChange:ve=>Y({...K,neighborhoodId:ve,neighborhoodName:""}),children:[c.jsx(Ji,{className:"bg-background",children:c.jsx(is,{placeholder:"Selecione o bairro"})}),c.jsx(Qi,{className:"bg-popover border border-border z-50",children:_.map(ve=>c.jsxs(sn,{value:ve.id,children:[ve.name," - Taxa: R$ ",(ve.delivery_fee||0).toFixed(2).replace(".",",")]},ve.id))})]}):c.jsx(ar,{id:"neighborhood",placeholder:"Ex: Centro",value:K.neighborhoodName,onChange:ve=>Y({...K,neighborhoodName:ve.target.value,neighborhoodId:""})}),!T&&_.length===0&&c.jsx("p",{className:"text-xs text-muted-foreground",children:"No h bairros cadastrados para esta cidade  voc pode digitar o bairro."})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsxs("div",{className:"col-span-2 space-y-2",children:[c.jsx(zt,{htmlFor:"street",children:"Rua *"}),c.jsx(ar,{id:"street",placeholder:"Nome da rua",value:K.street,onChange:ve=>Y({...K,street:ve.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"number",children:"N *"}),c.jsx(ar,{id:"number",placeholder:"123",value:K.number,onChange:ve=>Y({...K,number:ve.target.value})})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"complement",children:"Complemento"}),c.jsx(ar,{id:"complement",placeholder:"Apto, Bloco, Casa...",value:K.complement,onChange:ve=>Y({...K,complement:ve.target.value})})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{htmlFor:"label",children:"Apelido"}),c.jsx(ar,{id:"label",placeholder:"Ex: Casa, Trabalho...",value:K.label,onChange:ve=>Y({...K,label:ve.target.value})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{children:"Tipo"}),c.jsx("div",{className:"flex gap-2",children:[{value:"home",label:"Casa",icon:kG},{value:"work",label:"Trabalho",icon:NG},{value:"other",label:"Outro",icon:zi}].map(ve=>c.jsxs("button",{type:"button",onClick:()=>Y({...K,type:ve.value}),className:`flex-1 p-2 rounded-lg border-2 transition-all ${K.type===ve.value?"border-primary bg-primary/10":"border-transparent bg-muted"}`,children:[c.jsx(ve.icon,{className:`w-4 h-4 mx-auto mb-1 ${K.type===ve.value?"text-primary":"text-muted-foreground"}`}),c.jsx("p",{className:"text-xs",children:ve.label})]},ve.value))})]}),c.jsxs("div",{className:"flex gap-3 pt-2",children:[c.jsx(Ft,{variant:"outline",className:"flex-1",onClick:ue,children:"Cancelar"}),c.jsx(Ft,{className:"flex-1",onClick:B==="map"?fe:ge,disabled:B==="map"?!D||!K.number||(_.length>0?!K.neighborhoodId:!K.neighborhoodName.trim()&&!((D==null?void 0:D.neighborhood)||"").trim()):!K.street||!K.number||(_.length>0?!K.neighborhoodId:!K.neighborhoodName.trim()),children:"Salvar Endereo"})]})]},"new-address"):c.jsxs(gr.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-3",children:[Ce.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:["Endereos salvos em ",k]}),Ce.map(ve=>{const ze=ee(ve.type),Me=(e==null?void 0:e.id)===ve.id;return c.jsxs("button",{onClick:()=>ae(ve),className:`w-full flex items-center gap-3 p-4 rounded-xl transition-colors text-left ${Me?"bg-primary/10 ring-2 ring-primary":"bg-muted hover:bg-accent"}`,children:[c.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${Me?"bg-primary text-primary-foreground":"bg-card"}`,children:c.jsx(ze,{className:"w-5 h-5"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"font-medium text-sm",children:ve.label}),c.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[ve.street,", ",ve.number,ve.complement?` - ${ve.complement}`:"","  ",ve.neighborhoodName]}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[ve.distanceKm&&c.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[c.jsx(RG,{className:"w-3 h-3"}),ve.distanceKm.toFixed(1)," km"]}),c.jsxs("span",{className:"text-success font-medium",children:["R$ ",ve.deliveryFee.toFixed(2).replace(".",",")]})]})]}),Me&&c.jsx(w0,{className:"w-5 h-5 text-primary shrink-0"})]},ve.id)})]}),Ce.length===0&&c.jsxs("div",{className:"text-center py-6",children:[c.jsx(zi,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),c.jsxs("p",{className:"text-muted-foreground text-sm",children:["Nenhum endereo salvo em ",k]})]}),c.jsxs(Ft,{variant:"outline",className:"w-full",onClick:()=>s(!0),disabled:!P,children:[c.jsx(dc,{className:"w-4 h-4 mr-2"}),"Adicionar novo endereo"]})]},"address-list")})]})})]})},bit=({subtotal:e,cityId:t,neighborhoodId:r,establishmentId:n,appliedCoupon:a,onApplyCoupon:d})=>{const[p,s]=F.useState(""),[_,b]=F.useState(!1),[T,C]=F.useState(!1),P=async()=>{if(!p.trim()){gt.error("Digite um cdigo de cupom");return}b(!0);try{const{data:R,error:D}=await dt.from("coupons").select("*").eq("code",p.toUpperCase().trim()).eq("is_active",!0).maybeSingle();if(D)throw D;if(!R){gt.error("Cupom invlido ou expirado");return}if(R.valid_until&&new Date(R.valid_until)<new Date){gt.error("Este cupom expirou");return}if(R.usage_limit&&R.usage_count>=R.usage_limit){gt.error("Este cupom atingiu o limite de uso");return}if(R.min_order_value&&e<Number(R.min_order_value)){gt.error(`Pedido mnimo de R$ ${Number(R.min_order_value).toFixed(2)} para usar este cupom`);return}if(R.city_id&&R.city_id!==t){gt.error("Este cupom no  vlido para sua regio");return}if(R.neighborhood_id&&R.neighborhood_id!==r){gt.error("Este cupom no  vlido para seu bairro");return}if(R.establishment_id&&R.establishment_id!==n){gt.error("Este cupom no  vlido para este estabelecimento");return}d(R),gt.success("Cupom aplicado com sucesso! "),s(""),C(!1)}catch(R){console.error("Error validating coupon:",R),gt.error("Erro ao validar cupom")}finally{b(!1)}},k=()=>{d(null),gt.info("Cupom removido")},B=()=>{if(!a)return 0;if(a.discount_type==="percentage"){const R=e*a.discount_value/100;return a.max_discount?Math.min(R,a.max_discount):R}return Math.min(a.discount_value,e)};if(a){const R=B();return c.jsx(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-success/10 border border-success/30 rounded-xl p-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-success/20 flex items-center justify-center",children:c.jsx(w0,{className:"w-5 h-5 text-success"})}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-semibold text-success flex items-center gap-2",children:[c.jsx(MG,{className:"w-4 h-4"}),a.code]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:a.discount_type==="percentage"?`${a.discount_value}% de desconto`:`R$ ${Number(a.discount_value).toFixed(2)} de desconto`})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("span",{className:"font-bold text-success",children:["-R$ ",R.toFixed(2).replace(".",",")]}),c.jsx(Ft,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:k,children:c.jsx(wd,{className:"w-4 h-4"})})]})]})})}return c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl shadow-soft overflow-hidden",children:[c.jsxs("button",{onClick:()=>C(!T),className:"w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-accent flex items-center justify-center",children:c.jsx($2,{className:"w-5 h-5 text-primary"})}),c.jsx("span",{className:"font-medium",children:"Adicionar cupom de desconto"})]}),c.jsx(MG,{className:`w-5 h-5 text-muted-foreground transition-transform ${T?"rotate-90":""}`})]}),c.jsx(ju,{children:T&&c.jsx(gr.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:c.jsxs("div",{className:"p-4 pt-0 flex gap-2",children:[c.jsx(ar,{placeholder:"Digite o cdigo do cupom",value:p,onChange:R=>s(R.target.value.toUpperCase()),onKeyDown:R=>R.key==="Enter"&&P(),className:"uppercase"}),c.jsx(Ft,{onClick:P,disabled:_||!p.trim(),children:_?c.jsx(Ma,{className:"w-4 h-4 animate-spin"}):"Aplicar"})]})})})]})},wit=(e,t)=>{if(!e)return 0;if(e.discount_type==="percentage"){const r=t*e.discount_value/100;return e.max_discount?Math.min(r,Number(e.max_discount)):r}return Math.min(Number(e.discount_value),t)},Sit=({cityId:e,neighborhoodId:t,establishmentId:r,subtotal:n,onPromotionApply:a})=>{const[d,p]=F.useState([]),[s,_]=F.useState(!0);F.useEffect(()=>{b()},[e,t,r]);const b=async()=>{try{let P=dt.from("promotions").select("*").eq("is_active",!0);const{data:k,error:B}=await P;if(B)throw B;const R=(k||[]).filter(G=>!!(!G.city_id&&!G.neighborhood_id&&!G.establishment_id||G.city_id&&G.city_id===e||G.neighborhood_id&&G.neighborhood_id===t||G.establishment_id&&G.establishment_id===r));p(R);const D=R.find(G=>!G.min_order_value||n>=Number(G.min_order_value));a==null||a(D||null)}catch(P){console.error("Error fetching promotions:",P)}finally{_(!1)}};if(s||d.length===0)return null;const T=P=>{switch(P){case"free_delivery":return c.jsx(Tf,{className:"w-4 h-4"});case"percentage":return c.jsx(FI,{className:"w-4 h-4"});default:return c.jsx($2,{className:"w-4 h-4"})}},C=P=>{switch(P.discount_type){case"free_delivery":return"Entrega Grtis";case"percentage":return`${P.discount_value}% OFF`;case"fixed":return`R$ ${Number(P.discount_value).toFixed(2)} OFF`;default:return P.title}};return c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Promoes disponveis"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(P=>{const k=!P.min_order_value||n>=Number(P.min_order_value);return c.jsxs(dn,{variant:k?"default":"outline",className:`gap-1.5 py-1.5 px-3 ${k?"bg-success/10 text-success border-success/30 hover:bg-success/20":"opacity-60"}`,children:[T(P.discount_type),c.jsx("span",{children:C(P)}),!k&&P.min_order_value&&c.jsxs("span",{className:"text-xs ml-1",children:["(min R$ ",Number(P.min_order_value).toFixed(0),")"]})]},P.id)})})]})},Tit=e=>{const[t,r]=F.useState([]),[n,a]=F.useState(!0);return F.useEffect(()=>{if(!e){r([]),a(!1);return}(async()=>{a(!0);const{data:p}=await dt.from("establishment_payment_methods").select("method_key, method_name, description, is_enabled").eq("establishment_id",e).eq("is_enabled",!0);r(p||[]),a(!1)})()},[e]),{methods:t,loading:n}},Eit={pix:a4,credit_card:Nm,debit_card:Nm,cash:Ty,wallet:bd},jit=({establishmentId:e,selectedPayment:t,onSelect:r,userBalance:n})=>{const{methods:a,loading:d}=Tit(e);return d?c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl shadow-soft overflow-hidden",children:[c.jsx("div",{className:"p-4 border-b border-border",children:c.jsx("h2",{className:"font-display font-bold",children:"Forma de pagamento"})}),c.jsx("div",{className:"p-8 flex justify-center",children:c.jsx(Ma,{className:"w-6 h-6 animate-spin text-muted-foreground"})})]}):a.length===0?c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl shadow-soft overflow-hidden",children:[c.jsx("div",{className:"p-4 border-b border-border",children:c.jsx("h2",{className:"font-display font-bold",children:"Forma de pagamento"})}),c.jsx("div",{className:"p-4 text-sm text-muted-foreground text-center",children:"Nenhuma forma de pagamento disponvel"})]}):(!a.some(s=>s.method_key===t)&&a.length>0&&setTimeout(()=>r(a[0].method_key),0),a.length<=3&&`${a.length}`,c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"bg-card rounded-xl shadow-soft overflow-hidden",children:[c.jsx("div",{className:"p-4 border-b border-border",children:c.jsx("h2",{className:"font-display font-bold",children:"Forma de pagamento"})}),c.jsx("div",{className:"p-4 grid gap-3",style:{gridTemplateColumns:`repeat(${Math.min(a.length,3)}, 1fr)`},children:a.map(s=>{const _=Eit[s.method_key]||Nm,b=s.method_key==="pix"||s.method_key==="credit_card";return c.jsxs("button",{onClick:()=>r(s.method_key),className:`p-4 rounded-xl border-2 transition-all ${t===s.method_key?"border-primary bg-accent":"border-transparent bg-muted hover:bg-accent/50"}`,children:[c.jsx(_,{className:`w-6 h-6 mx-auto mb-2 ${t===s.method_key?"text-primary":"text-muted-foreground"}`}),c.jsx("p",{className:"text-sm font-medium",children:s.method_name}),c.jsx("p",{className:"text-[10px] text-muted-foreground",children:b?"Pague online":s.method_key==="wallet"?`Saldo: R$ ${(n==null?void 0:n.toFixed(2))||"0,00"}`:s.description||""})]},s.method_key)})})]}))},cde=({open:e,onClose:t,pixData:r,onPaymentConfirmed:n})=>{const[a,d]=F.useState("waiting"),[p,s]=F.useState(!1);F.useEffect(()=>{if(!e||!r)return;d("waiting");const b=setInterval(async()=>{var T,C,P,k;s(!0);try{const{data:{session:B}}=await dt.auth.getSession(),R=await dt.functions.invoke("asaas-payment",{body:{action:"check_status",paymentId:r.paymentId}});((T=R.data)==null?void 0:T.status)==="RECEIVED"||((C=R.data)==null?void 0:C.status)==="CONFIRMED"?(d("confirmed"),clearInterval(b),setTimeout(()=>n(),2e3)):(((P=R.data)==null?void 0:P.status)==="OVERDUE"||((k=R.data)==null?void 0:k.status)==="REFUNDED")&&(d("failed"),clearInterval(b))}catch(B){console.error("Error checking payment status:",B)}s(!1)},5e3);return()=>clearInterval(b)},[e,r]);const _=()=>{r!=null&&r.pixCopyPaste&&(navigator.clipboard.writeText(r.pixCopyPaste),gt.success("Cdigo PIX copiado!"))};return r?c.jsx($l,{open:e,onOpenChange:t,children:c.jsxs(ul,{className:"max-w-sm",children:[c.jsx(dl,{children:c.jsx(hl,{className:"text-center",children:"Pagamento via PIX"})}),a==="waiting"&&c.jsxs("div",{className:"space-y-4 text-center",children:[c.jsx("div",{className:"mx-auto w-48 h-48 bg-white rounded-lg p-2",children:c.jsx("img",{src:`data:image/png;base64,${r.pixQrCode}`,alt:"QR Code PIX",className:"w-full h-full"})}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Escaneie o QR Code ou copie o cdigo para pagar"}),c.jsxs(Ft,{variant:"outline",className:"w-full",onClick:_,children:[c.jsx($ve,{className:"w-4 h-4 mr-2"}),"Copiar cdigo PIX"]}),c.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[c.jsx(Ma,{className:"w-4 h-4 animate-spin"}),"Aguardando pagamento..."]})]}),a==="confirmed"&&c.jsxs("div",{className:"text-center space-y-4 py-6",children:[c.jsx(Da,{className:"w-16 h-16 text-green-500 mx-auto"}),c.jsx("p",{className:"font-semibold text-lg",children:"Pagamento confirmado!"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecionando..."})]}),a==="failed"&&c.jsxs("div",{className:"text-center space-y-4 py-6",children:[c.jsx(Of,{className:"w-16 h-16 text-destructive mx-auto"}),c.jsx("p",{className:"font-semibold text-lg",children:"Pagamento expirado"}),c.jsx(Ft,{variant:"outline",onClick:t,children:"Fechar"})]})]})}):null},Ait=({open:e,onClose:t,onSubmit:r,isProcessing:n})=>{const[a,d]=F.useState({cardHolder:"",cardNumber:"",expiryMonth:"",expiryYear:"",ccv:"",cpfCnpj:"",phone:"",postalCode:"",addressNumber:""}),p=(_,b)=>d(T=>({...T,[_]:b})),s=_=>{_.preventDefault(),r(a)};return c.jsx($l,{open:e,onOpenChange:t,children:c.jsxs(ul,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[c.jsx(dl,{children:c.jsxs(hl,{className:"flex items-center gap-2",children:[c.jsx(Nm,{className:"w-5 h-5"}),"Pagamento com Carto"]})}),c.jsxs("form",{onSubmit:s,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Nome no carto"}),c.jsx(ar,{value:a.cardHolder,onChange:_=>p("cardHolder",_.target.value),placeholder:"Nome como no carto",required:!0})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Nmero do carto"}),c.jsx(ar,{value:a.cardNumber,onChange:_=>p("cardNumber",_.target.value.replace(/\D/g,"")),placeholder:"0000 0000 0000 0000",maxLength:16,required:!0})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Ms"}),c.jsx(ar,{value:a.expiryMonth,onChange:_=>p("expiryMonth",_.target.value.replace(/\D/g,"")),placeholder:"MM",maxLength:2,required:!0})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Ano"}),c.jsx(ar,{value:a.expiryYear,onChange:_=>p("expiryYear",_.target.value.replace(/\D/g,"")),placeholder:"AAAA",maxLength:4,required:!0})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"CVV"}),c.jsx(ar,{value:a.ccv,onChange:_=>p("ccv",_.target.value.replace(/\D/g,"")),placeholder:"123",maxLength:4,required:!0})]})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"CPF/CNPJ do titular"}),c.jsx(ar,{value:a.cpfCnpj,onChange:_=>p("cpfCnpj",_.target.value.replace(/\D/g,"")),placeholder:"000.000.000-00",required:!0})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx(zt,{children:"Telefone"}),c.jsx(ar,{value:a.phone,onChange:_=>p("phone",_.target.value),placeholder:"(00) 00000-0000"})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"CEP"}),c.jsx(ar,{value:a.postalCode,onChange:_=>p("postalCode",_.target.value.replace(/\D/g,"")),placeholder:"00000-000",maxLength:8,required:!0})]})]}),c.jsxs("div",{children:[c.jsx(zt,{children:"Nmero do endereo"}),c.jsx(ar,{value:a.addressNumber,onChange:_=>p("addressNumber",_.target.value),placeholder:"123",required:!0})]}),c.jsx(Ft,{type:"submit",className:"w-full",disabled:n,children:n?c.jsxs(c.Fragment,{children:[c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):"Pagar com carto"})]})]})})},Cit=()=>{const{items:e,updateQuantity:t,removeItem:r,total:n,clearCart:a,establishmentId:d}=WI(),[p,s]=F.useState("pix"),[_,b]=F.useState(null),[T,C]=F.useState(null),[P,k]=F.useState(null),[B,R]=F.useState(!1),[D,G]=F.useState(!1),[V,$]=F.useState(null),[K,Y]=F.useState(!1),[ee,ae]=F.useState(!1),[ie,ge]=F.useState(null),[fe,be]=F.useState(""),[ue,Ce]=F.useState(!1),{user:ve}=$i(),ze=di(),Me=(_==null?void 0:_.deliveryFee)??0,Be=wit(T,n),Ve=()=>P?P.discount_type==="free_delivery"?{discount:0,freeDelivery:!0}:P.discount_type==="percentage"?{discount:n*P.discount_value/100,freeDelivery:!1}:{discount:P.discount_value,freeDelivery:!1}:{discount:0,freeDelivery:!1},{discount:We,freeDelivery:Ee}=Ve(),ot=Be+We,yt=Ee?0:Me,Je=Math.max(0,n-ot)+yt,Bt=p==="pix"||p==="credit_card",Pt=async(Et="pending")=>{var hs,lt;const{data:pr}=await dt.from("profiles").select("full_name, phone").eq("user_id",ve.id).single(),Kr=`${_.street}, ${_.number}${_.complement?` - ${_.complement}`:""}, ${_.neighborhoodName}, ${_.cityName}`,{data:Xn,error:Jn}=await dt.from("orders").insert({customer_id:ve.id,customer_name:(pr==null?void 0:pr.full_name)||"Cliente",customer_phone:(pr==null?void 0:pr.phone)||"",establishment_id:d,delivery_address:Kr,delivery_latitude:((hs=_.coordinates)==null?void 0:hs.latitude)||null,delivery_longitude:((lt=_.coordinates)==null?void 0:lt.longitude)||null,subtotal:n,delivery_fee:yt,discount:ot,total:Je,payment_method:p,status:"pending",payment_status:Et}).select().single();if(Jn)throw Jn;const ni=e.map(Ct=>({order_id:Xn.id,product_id:Ct.id,product_name:Ct.name,product_price:Ct.price,quantity:Ct.quantity,subtotal:Ct.price*Ct.quantity,notes:Ct.notes||null})),{error:zn}=await dt.from("order_items").insert(ni);if(zn)throw zn;return Xn},[pt,Gt]=F.useState(0);F.useEffect(()=>{ve&&Pr()},[ve]);const Pr=async()=>{Ce(!0);const{data:Et}=await dt.from("profiles").select("wallet_balance, cpf_cnpj").eq("user_id",ve.id).single();Et&&(Gt(Number(Et.wallet_balance)),be(Et.cpf_cnpj||"")),Ce(!1)},Ot=async()=>{if(!_){gt.error("Selecione um endereo de entrega");return}if(!ve){gt.error("Faa login para finalizar o pedido"),ze("/auth");return}if(!d){gt.error("Erro ao identificar o estabelecimento");return}if(p==="wallet"&&Je>pt){gt.error("Saldo insuficiente na carteira digital");return}if(Bt&&(!fe||fe.length<11)){gt.error("CPF/CNPJ  obrigatrio para pagamentos online");return}R(!0);try{if(p==="pix"){const Et=await Pt("awaiting_payment");ge(Et.id);const{data:pr,error:Kr}=await dt.functions.invoke("asaas-payment",{body:{action:"create_pix",orderId:Et.id,amount:Je,cpfCnpj:fe}});if(Kr||pr!=null&&pr.error)throw new Error((pr==null?void 0:pr.error)||"Erro ao criar pagamento PIX");$({paymentId:pr.paymentId,pixQrCode:pr.pixQrCode,pixCopyPaste:pr.pixCopyPaste}),G(!0)}else if(p==="credit_card"){const Et=await Pt("awaiting_payment");ge(Et.id),Y(!0)}else if(p==="wallet"){const Et=await Pt("paid"),{error:pr}=await dt.from("wallet_transactions").insert({user_id:ve.id,amount:Je,type:"debit",description:`Pagamento do Pedido #${Et.order_number}`,order_id:Et.id});if(pr)throw pr;gt.success("Pedido pago com saldo digital! "),a(),ze(`/pedido/${Et.id}`)}else{const Et=await Pt("pending");gt.success("Pedido realizado com sucesso! ",{description:"Voc receber atualizaes sobre seu pedido."}),a(),ze(`/pedido/${Et.id}`)}}catch(Et){console.error("Erro ao criar pedido:",Et),gt.error("Erro ao finalizar pedido. Tente novamente.")}finally{R(!1)}},nr=async Et=>{if(ie){ae(!0);try{const{data:pr,error:Kr}=await dt.functions.invoke("asaas-payment",{body:{action:"create_credit_card",orderId:ie,amount:Je,cardHolder:Et.cardHolder,cardNumber:Et.cardNumber,expiryMonth:Et.expiryMonth,expiryYear:Et.expiryYear,ccv:Et.ccv,holderInfo:{cpfCnpj:Et.cpfCnpj,phone:Et.phone,postalCode:Et.postalCode,addressNumber:Et.addressNumber}}});if(Kr||pr!=null&&pr.error)throw new Error((pr==null?void 0:pr.error)||"Erro no pagamento");pr.status==="CONFIRMED"||pr.status==="RECEIVED"?(await dt.from("orders").update({payment_status:"paid"}).eq("id",ie),gt.success("Pagamento aprovado! "),a(),ze(`/pedido/${ie}`)):pr.status==="PENDING"?(await dt.from("orders").update({payment_status:"processing"}).eq("id",ie),gt.success("Pedido realizado! Pagamento em processamento."),a(),ze(`/pedido/${ie}`)):gt.error("Pagamento recusado. Verifique os dados do carto.")}catch(pr){console.error("Credit card payment error:",pr),gt.error("Erro no pagamento. Verifique os dados e tente novamente.")}finally{ae(!1)}}},ur=async()=>{ie&&(await dt.from("orders").update({payment_status:"paid"}).eq("id",ie),a(),ze(`/pedido/${ie}`))};return e.length===0?c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx("header",{className:"sticky top-0 z-50 bg-card/95 backdrop-blur-lg border-b border-border",children:c.jsxs("div",{className:"container flex items-center gap-4 h-16",children:[c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"ghost",size:"icon",children:c.jsx(uc,{className:"w-5 h-5"})})}),c.jsx("h1",{className:"font-display font-bold text-lg",children:"Carrinho"})]})}),c.jsx("div",{className:"container py-20 text-center",children:c.jsxs(gr.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-sm mx-auto",children:[c.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-muted flex items-center justify-center",children:c.jsx(Bc,{className:"w-12 h-12 text-muted-foreground"})}),c.jsx("h2",{className:"font-display text-xl font-bold mb-2",children:"Carrinho vazio"}),c.jsx("p",{className:"text-muted-foreground mb-6",children:"Adicione itens de um restaurante para comear seu pedido."}),c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"hero",size:"lg",children:"Explorar restaurantes"})})]})})]}):c.jsxs("div",{className:"min-h-screen bg-background pb-40",children:[c.jsx("header",{className:"sticky top-0 z-50 bg-card/95 backdrop-blur-lg border-b border-border",children:c.jsxs("div",{className:"container flex items-center gap-4 h-16",children:[c.jsx(Oi,{to:"/",children:c.jsx(Ft,{variant:"ghost",size:"icon",children:c.jsx(uc,{className:"w-5 h-5"})})}),c.jsx("h1",{className:"font-display font-bold text-lg",children:"Carrinho"})]})}),c.jsxs("div",{className:"container py-6 space-y-6",children:[c.jsx(xit,{selectedAddress:_,onAddressChange:b}),c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},className:"flex items-center gap-3 p-4 bg-accent/50 rounded-xl",children:[c.jsx(ki,{className:"w-5 h-5 text-accent-foreground"}),c.jsxs("p",{className:"text-sm text-accent-foreground",children:["Tempo estimado: ",c.jsx("span",{className:"font-semibold",children:"25-35 min"})]})]}),c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl shadow-soft overflow-hidden",children:[c.jsx("div",{className:"p-4 border-b border-border",children:c.jsx("h2",{className:"font-display font-bold",children:"Seu pedido"})}),c.jsx("div",{className:"divide-y divide-border",children:c.jsx(ju,{children:e.map(Et=>c.jsxs(gr.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 flex gap-4",children:[c.jsx("img",{src:Et.image,alt:Et.name,className:"w-16 h-16 rounded-lg object-cover"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold",children:Et.name}),c.jsxs("p",{className:"text-primary font-display font-bold mt-1",children:["R$ ",(Et.price*Et.quantity).toFixed(2).replace(".",",")]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ft,{variant:"outline",size:"icon",className:"w-8 h-8",onClick:()=>t(Et.id,Et.quantity-1),children:Et.quantity===1?c.jsx(xd,{className:"w-4 h-4 text-destructive"}):c.jsx(r_e,{className:"w-4 h-4"})}),c.jsx("span",{className:"w-8 text-center font-semibold",children:Et.quantity}),c.jsx(Ft,{variant:"outline",size:"icon",className:"w-8 h-8",onClick:()=>t(Et.id,Et.quantity+1),children:c.jsx(dc,{className:"w-4 h-4"})})]})]},Et.id))})})]}),c.jsx(Sit,{cityId:_==null?void 0:_.cityId,neighborhoodId:_==null?void 0:_.neighborhoodId,establishmentId:d,subtotal:n,onPromotionApply:k}),c.jsx(bit,{subtotal:n,cityId:_==null?void 0:_.cityId,neighborhoodId:_==null?void 0:_.neighborhoodId,establishmentId:d,appliedCoupon:T,onApplyCoupon:C}),c.jsx(jit,{establishmentId:d,selectedPayment:p,onSelect:s,userBalance:pt}),Bt&&c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card rounded-xl shadow-soft p-4 space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(a4,{className:"w-5 h-5 text-primary"}),c.jsx("h2",{className:"font-display font-bold",children:"Dados para pagamento"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-sm font-medium",children:"CPF ou CNPJ (apenas nmeros)"}),c.jsx("input",{type:"text",value:fe,onChange:Et=>be(Et.target.value.replace(/\D/g,"")),placeholder:"000.000.000-00",maxLength:14,className:"w-full h-12 px-4 rounded-xl border border-input bg-background focus:outline-none focus:ring-2 focus:ring-primary/20"}),c.jsx("p",{className:"text-[10px] text-muted-foreground italic",children:"Necessrio para emisso do comprovante de pagamento via Asaas."})]})]}),c.jsxs(gr.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl shadow-soft p-4 space-y-3",children:[c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),c.jsxs("span",{children:["R$ ",n.toFixed(2).replace(".",",")]})]}),Be>0&&c.jsxs("div",{className:"flex justify-between text-sm text-success",children:[c.jsxs("span",{children:["Cupom (",T==null?void 0:T.code,")"]}),c.jsxs("span",{children:["-R$ ",Be.toFixed(2).replace(".",",")]})]}),We>0&&c.jsxs("div",{className:"flex justify-between text-sm text-success",children:[c.jsx("span",{children:"Promoo"}),c.jsxs("span",{children:["-R$ ",We.toFixed(2).replace(".",",")]})]}),c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[c.jsx("span",{children:"Taxa de entrega"}),(_==null?void 0:_.distanceKm)&&c.jsxs("span",{className:"text-xs bg-muted px-2 py-0.5 rounded-full",children:[_.distanceKm.toFixed(1)," km"]})]}),c.jsx("span",{className:yt===0?"text-success":"",children:_?yt===0?Ee?"Grtis (promoo)":"Grtis":`R$ ${yt.toFixed(2).replace(".",",")}`:"Selecione o endereo"})]}),ot>0&&c.jsxs("div",{className:"flex justify-between text-sm font-medium text-success bg-success/10 -mx-4 px-4 py-2",children:[c.jsx("span",{children:"Voc est economizando"}),c.jsxs("span",{children:["R$ ",(ot+(Ee?Me:0)).toFixed(2).replace(".",",")]})]}),c.jsxs("div",{className:"border-t border-border pt-3 flex justify-between",children:[c.jsx("span",{className:"font-semibold",children:"Total"}),c.jsxs("span",{className:"font-display font-bold text-lg text-primary",children:["R$ ",Je.toFixed(2).replace(".",",")]})]})]})]}),c.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-card/95 backdrop-blur-lg border-t border-border",children:c.jsx("div",{className:"container",children:c.jsx(Ft,{variant:"hero",size:"lg",className:"w-full",onClick:Ot,disabled:!_||B,children:B?c.jsxs(c.Fragment,{children:[c.jsx(Ma,{className:"w-4 h-4 mr-2 animate-spin"}),"Finalizando..."]}):`Finalizar pedido  R$ ${Je.toFixed(2).replace(".",",")}`})})}),c.jsx(cde,{open:D,onClose:()=>G(!1),pixData:V,onPaymentConfirmed:ur}),c.jsx(Ait,{open:K,onClose:()=>Y(!1),onSubmit:nr,isProcessing:ee})]})},Pit=()=>{const{user:e,loading:t}=$i(),r=di(),[n,a]=F.useState(!0),[d,p]=F.useState(0),[s,_]=F.useState(""),[b,T]=F.useState([]),[C,P]=F.useState(!1),[k,B]=F.useState("50.00"),[R,D]=F.useState(!1),[G,V]=F.useState(null);F.useEffect(()=>{if(!t&&!e){r("/auth");return}e&&$()},[e,t]);const $=async()=>{try{a(!0);const{data:ee}=await dt.from("profiles").select("wallet_balance, cpf_cnpj").eq("user_id",e.id).single();ee&&(p(Number(ee.wallet_balance)),_(ee.cpf_cnpj||""));const{data:ae}=await dt.from("wallet_transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});T(ae||[])}catch(ee){console.error("Error fetching wallet data:",ee),gt.error("Erro ao carregar dados da carteira")}finally{a(!1)}},K=async()=>{const ee=Number(k);if(isNaN(ee)||ee<15){gt.error("O valor mnimo para recarga  R$ 15,00");return}if(!s||s.length<11){gt.error("Informe um CPF/CNPJ vlido para continuar");return}D(!0);try{const{error:ae}=await dt.from("profiles").update({cpf_cnpj:s}).eq("user_id",e.id);ae&&console.error("Error updating CPF:",ae);const{data:ie,error:ge}=await dt.functions.invoke("asaas-payment",{body:{action:"create_recharge",amount:ee,billingType:"PIX",cpfCnpj:s}});if(ge)throw console.error("Invoke error:",ge),new Error(`Erro na conexo: ${ge.message}`);if(ie!=null&&ie.error)throw console.error("Function error:",ie.error),new Error(ie.error);V({paymentId:ie.paymentId,pixQrCode:ie.pixQrCode,pixCopyPaste:ie.pixCopyPaste}),P(!0)}catch(ae){console.error("Complete error details:",ae),gt.error(ae.message||"Erro inesperado ao processar recarga")}finally{D(!1)}},Y=()=>{P(!1),gt.success("Saldo recarregado com sucesso! "),$()};return t||n?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(Ma,{className:"h-8 w-8 animate-spin text-primary"})}):c.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[c.jsx(Ph,{}),c.jsx("main",{className:"flex-1 container mx-auto px-4 py-8",children:c.jsxs("div",{className:"max-w-2xl mx-auto",children:[c.jsxs(Ft,{variant:"ghost",onClick:()=>r(-1),className:"mb-6",children:[c.jsx(uc,{className:"h-4 w-4 mr-2"})," Voltar"]}),c.jsxs("div",{className:"flex items-center justify-between mb-8",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Minha Carteira"}),c.jsx(bd,{className:"h-8 w-8 text-primary"})]}),c.jsxs(Vt,{className:"bg-primary text-primary-foreground mb-8 overflow-hidden relative",children:[c.jsx("div",{className:"absolute -right-8 -top-8 w-32 h-32 bg-white/10 rounded-full blur-2xl"}),c.jsx("div",{className:"absolute -left-8 -bottom-8 w-32 h-32 bg-white/10 rounded-full blur-2xl"}),c.jsx(Wr,{children:c.jsxs(Hr,{className:"text-lg opacity-90 flex items-center gap-2",children:[c.jsx(bd,{className:"h-5 w-5"}),"Saldo Disponvel"]})}),c.jsxs(Ut,{className:"relative z-10",children:[c.jsxs("div",{className:"space-y-4 mb-8",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{className:"text-white/90",children:"Valor da Recarga (R$)"}),c.jsxs("div",{className:"relative",children:[c.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/50 font-bold",children:"R$"}),c.jsx(ar,{type:"number",step:"0.01",value:k,onChange:ee=>B(ee.target.value),className:"bg-white/10 border-white/20 text-white text-2xl font-bold pl-10 h-14 focus:bg-white/20 transition-all placeholder:text-white/30",placeholder:"0,00"})]}),c.jsx("p",{className:"text-xs text-white/60 mt-1",children:"* Valor mnimo para recarga: R$ 15,00"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(zt,{className:"text-white/90",children:"CPF ou CNPJ (apenas nmeros)"}),c.jsx(ar,{type:"text",value:s,onChange:ee=>_(ee.target.value.replace(/\D/g,"")),className:"bg-white/10 border-white/20 text-white h-12 focus:bg-white/20 transition-all placeholder:text-white/30",placeholder:"00000000000",maxLength:14})]}),c.jsxs("div",{className:"p-4 bg-white/10 rounded-xl border border-white/10",children:[c.jsx("p",{className:"text-sm opacity-80 mb-1",children:"Seu saldo atual"}),c.jsxs("p",{className:"text-3xl font-bold text-white",children:["R$ ",d.toFixed(2).replace(".",",")]})]})]}),c.jsxs(Ft,{className:"w-full bg-white text-primary hover:bg-white/90 h-12 text-lg font-bold shadow-lg",onClick:()=>K(),disabled:R,children:[R?c.jsx(Ma,{className:"h-4 w-4 animate-spin"}):c.jsx(dc,{className:"h-5 w-5 mr-3"}),"Recarregar Agora"]})]})]}),c.jsxs(Vt,{children:[c.jsxs(Wr,{children:[c.jsxs(Hr,{className:"flex items-center gap-2",children:[c.jsx(l3,{className:"h-5 w-5"}),"Histrico de Transaes"]}),c.jsx(zo,{children:"Suas ltimas movimentaes na carteira"})]}),c.jsx(Ut,{children:b.length===0?c.jsxs("div",{className:"text-center py-12",children:[c.jsx(l3,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-20"}),c.jsx("p",{className:"text-muted-foreground",children:"Nenhuma transao encontrada"})]}):c.jsx("div",{className:"space-y-4",children:b.map(ee=>c.jsxs("div",{className:"flex items-center justify-between border-b border-border pb-4 last:border-0 last:pb-0",children:[c.jsxs("div",{className:"flex gap-4 items-center",children:[c.jsx("div",{className:`p-2 rounded-full ${ee.type==="credit"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:c.jsx(dc,{className:`h-4 w-4 ${ee.type==="debit"?"rotate-45":""}`})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium text-sm sm:text-base",children:ee.description||(ee.type==="credit"?"Recarga de Saldo":"Pagamento de Pedido")}),c.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(ee.created_at).toLocaleString("pt-BR")})]})]}),c.jsxs("p",{className:`font-bold ${ee.type==="credit"?"text-green-600":"text-red-600"}`,children:[ee.type==="credit"?"+":"-"," R$ ",Number(ee.amount).toFixed(2).replace(".",",")]})]},ee.id))})})]})]})}),c.jsx(Nh,{}),c.jsx(cde,{open:C,onClose:()=>P(!1),pixData:G,onPaymentConfirmed:Y})]})},Nit=new Dbe,Iit=()=>{const[e,t]=F.useState(!0),[r,n]=F.useState(!1);F.useEffect(()=>{sessionStorage.getItem("splashShown")&&(t(!1),n(!0))},[]);const a=()=>{sessionStorage.setItem("splashShown","true"),n(!0)};return c.jsx($be,{client:Nit,children:c.jsx(zTe,{children:c.jsx(n1e,{children:c.jsxs(ybe,{children:[e&&!sessionStorage.getItem("splashShown")&&c.jsx(bCe,{onComplete:a,duration:3e3}),c.jsx(txe,{}),c.jsx(Oxe,{}),c.jsxs(Ywe,{children:[c.jsx(dit,{}),c.jsxs(Uwe,{children:[c.jsx(Sn,{path:"/",element:c.jsx(LIe,{})}),c.jsx(Sn,{path:"/restaurant/:id",element:c.jsx(fit,{})}),c.jsx(Sn,{path:"/cart",element:c.jsx(Cit,{})}),c.jsx(Sn,{path:"/carteira",element:c.jsx(Pit,{})}),c.jsx(Sn,{path:"/auth",element:c.jsx(BIe,{})}),c.jsx(Sn,{path:"/estabelecimento/auth",element:c.jsx($Ie,{})}),c.jsx(Sn,{path:"/entregador/auth",element:c.jsx(VIe,{})}),c.jsx(Sn,{path:"/perfil",element:c.jsx(GIe,{})}),c.jsx(Sn,{path:"/buscar",element:c.jsx(WIe,{})}),c.jsx(Sn,{path:"/categorias",element:c.jsx(gH,{})}),c.jsx(Sn,{path:"/categorias/:slug",element:c.jsx(gH,{})}),c.jsx(Sn,{path:"/restaurantes",element:c.jsx(HIe,{})}),c.jsx(Sn,{path:"/estabelecimento",element:c.jsx(eke,{})}),c.jsx(Sn,{path:"/estabelecimento/pedidos",element:c.jsx(tke,{})}),c.jsx(Sn,{path:"/estabelecimento/cardapio",element:c.jsx(rke,{})}),c.jsx(Sn,{path:"/estabelecimento/avaliacoes",element:c.jsx(ske,{})}),c.jsx(Sn,{path:"/estabelecimento/pagamentos",element:c.jsx(ake,{})}),c.jsx(Sn,{path:"/estabelecimento/cashback",element:c.jsx(oke,{})}),c.jsx(Sn,{path:"/estabelecimento/fidelidade",element:c.jsx(lke,{})}),c.jsx(Sn,{path:"/estabelecimento/faturas",element:c.jsx(cke,{})}),c.jsx(Sn,{path:"/estabelecimento/saques",element:c.jsx(uke,{})}),c.jsx(Sn,{path:"/estabelecimento/extratos",element:c.jsx(dke,{})}),c.jsx(Sn,{path:"/estabelecimento/conta-bancaria",element:c.jsx(hke,{})}),c.jsx(Sn,{path:"/estabelecimento/extrato-entregas",element:c.jsx(fke,{})}),c.jsx(Sn,{path:"/estabelecimento/entregadores",element:c.jsx(pke,{})}),c.jsx(Sn,{path:"/estabelecimento/entregas",element:c.jsx(mke,{})}),c.jsx(Sn,{path:"/estabelecimento/configuracoes",element:c.jsx(ike,{})}),c.jsx(Sn,{path:"/admin",element:c.jsx(gke,{})}),c.jsx(Sn,{path:"/admin/estabelecimentos",element:c.jsx(qke,{})}),c.jsx(Sn,{path:"/admin/estabelecimentos/novo",element:c.jsx(Gke,{})}),c.jsx(Sn,{path:"/admin/estabelecimentos/:id/editar",element:c.jsx(Hke,{})}),c.jsx(Sn,{path:"/admin/usuarios",element:c.jsx(Zke,{})}),c.jsx(Sn,{path:"/admin/regioes",element:c.jsx(Yet,{})}),c.jsx(Sn,{path:"/admin/cupons",element:c.jsx(Mrt,{})}),c.jsx(Sn,{path:"/admin/promocoes",element:c.jsx(Drt,{})}),c.jsx(Sn,{path:"/admin/faturas",element:c.jsx(Lrt,{})}),c.jsx(Sn,{path:"/admin/saques",element:c.jsx(Frt,{})}),c.jsx(Sn,{path:"/admin/relatorios",element:c.jsx(bK,{})}),c.jsx(Sn,{path:"/admin/relatorios",element:c.jsx(bK,{})}),c.jsx(Sn,{path:"/admin/configuracoes",element:c.jsx(Vet,{})}),c.jsx(Sn,{path:"/entregador",element:c.jsx($rt,{})}),c.jsx(Sn,{path:"/entregador/disponiveis",element:c.jsx(Vrt,{})}),c.jsx(Sn,{path:"/entregador/em-rota",element:c.jsx(Wrt,{})}),c.jsx(Sn,{path:"/entregador/historico",element:c.jsx(Hrt,{})}),c.jsx(Sn,{path:"/entregador/ganhos",element:c.jsx(Zrt,{})}),c.jsx(Sn,{path:"/entregador/configuracoes",element:c.jsx(Xrt,{})}),c.jsx(Sn,{path:"/pedido/:orderId",element:c.jsx(rit,{})}),c.jsx(Sn,{path:"/instalar",element:c.jsx(iit,{})}),c.jsx(Sn,{path:"/termos-de-uso",element:c.jsx(ait,{})}),c.jsx(Sn,{path:"/politica-de-privacidade",element:c.jsx(oit,{})}),c.jsx(Sn,{path:"/sobre-nos",element:c.jsx(lit,{})}),c.jsx(Sn,{path:"*",element:c.jsx(sit,{})})]})]})]})})})})};AQ(document.getElementById("root")).render(c.jsx(Iit,{}));
